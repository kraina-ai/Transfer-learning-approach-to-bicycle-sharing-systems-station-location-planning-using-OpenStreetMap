(self.webpackChunkangular_kepler_test_app=self.webpackChunkangular_kepler_test_app||[]).push([[179],{255:_d=>{function Bs(Ra){return Promise.resolve().then(()=>{var Ns=new Error("Cannot find module '"+Ra+"'");throw Ns.code="MODULE_NOT_FOUND",Ns})}Bs.keys=()=>[],Bs.resolve=Bs,Bs.id=255,_d.exports=Bs},958:function(_d){_d.exports=function(){"use strict";var Bs,Ra,Ns;function yd(g,yo){if(Bs)if(Ra){var Vo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+Bs+")(sharedChunk); ("+Ra+")(sharedChunk); self.onerror = null;",lo={};Bs(lo),Ns=yo(lo),"undefined"!=typeof window&&(Ns.workerUrl=window.URL.createObjectURL(new Blob([Vo],{type:"text/javascript"})))}else Ra=yo;else Bs=yo}return yd(0,function(g){var Vo=lo;function lo(a,i,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=l,this.p2y=u}lo.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},lo.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},lo.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},lo.prototype.solveCurveX=function(a,i){var l,u,f,x,b;for(void 0===i&&(i=1e-6),f=a,b=0;b<8;b++){if(x=this.sampleCurveX(f)-a,Math.abs(x)<i)return f;var M=this.sampleCurveDerivativeX(f);if(Math.abs(M)<1e-6)break;f-=x/M}if((f=a)<(l=0))return l;if(f>(u=1))return u;for(;l<u;){if(x=this.sampleCurveX(f),Math.abs(x-a)<i)return f;a>x?l=f:u=f,f=.5*(u-l)+l}return f},lo.prototype.solve=function(a,i){return this.sampleCurveY(this.solveCurveX(a,i))};var ct=ot;function ot(a,i){this.x=a,this.y=i}ot.prototype={clone:function(){return new ot(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,i){return this.clone()._rotateAround(a,i)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var i=a.x-this.x,l=a.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult:function(a){var i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var i=Math.cos(a),l=Math.sin(a),u=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,i){var l=Math.cos(a),u=Math.sin(a),f=i.y+u*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-u*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ot.convert=function(a){return a instanceof ot?a:Array.isArray(a)?new ot(a[0],a[1]):a};var Ct="undefined"!=typeof self?self:{};const hs=Math.pow(2,53)-1,Fa=Math.PI/180,iu=180/Math.PI;function Wn(a){return a*Fa}const ou=[[0,0],[1,0],[1,1],[0,1]];function su(a){if(a<=0)return 0;if(a>=1)return 1;const i=a*a,l=i*a;return 4*(a<.5?l:3*(a-i)+l-.75)}function Oa(a,i,l,u){const f=new Vo(a,i,l,u);return function(x){return f.solve(x)}}const ds=Oa(.25,.1,.25,1);function li(a,i,l){return Math.min(l,Math.max(i,a))}function La(a,i,l){const u=l-i,f=((a-i)%u+u)%u+i;return f===i?l:f}function au(a,i,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let x=null;a.forEach((b,M)=>{i(b,(P,F)=>{P&&(x=P),f[M]=F,0==--u&&l(x,f)})})}function jn(a){const i=[];for(const l in a)i.push(a[l]);return i}function ci(a,...i){for(const l of i)for(const u in l)a[u]=l[u];return a}let tf=1;function zs(){return tf++}function nc(){return function a(i){return i?(i^16*Math.random()>>i/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Al(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function co(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function rc(a,i){a.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function As(a,i){return-1!==a.indexOf(i,a.length-i.length)}function fn(a,i,l){const u={};for(const f in a)u[f]=i.call(l||this,a[f],f,a);return u}function Uo(a,i,l){const u={};for(const f in a)i.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function kr(a){return Array.isArray(a)?a.map(kr):"object"==typeof a&&a?fn(a,kr):a}const Ba={};function Lr(a){Ba[a]||("undefined"!=typeof console&&console.warn(a),Ba[a]=!0)}function fs(a,i,l){return(l.y-a.y)*(i.x-a.x)>(i.y-a.y)*(l.x-a.x)}function Na(a){let i=0;for(let l,u,f=0,x=a.length,b=x-1;f<x;b=f++)l=a[f],u=a[b],i+=(u.x-l.x)*(l.y+u.y);return i}function fl(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function za(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,x)=>{const b=f||x;return i[u]=!b||b.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let Va,Ln,pl,ml=null;function lu(a){if(null==ml){const i=a.navigator?a.navigator.userAgent:null;ml=!!a.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return ml}function cu(a){try{const i=Ct[a];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(i){return!1}}const uo={now:()=>void 0!==pl?pl:Ct.performance.now(),setNow(a){pl=a},restoreNow(){pl=void 0},frame(a){const i=Ct.requestAnimationFrame(a);return{cancel:()=>Ct.cancelAnimationFrame(i)}},getImageData(a,i=0){const l=Ct.document.createElement("canvas"),u=l.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,u.drawImage(a,0,0,a.width,a.height),u.getImageData(-i,-i,a.width+2*i,a.height+2*i)},resolveURL:a=>(Va||(Va=Ct.document.createElement("a")),Va.href=a,Va.href),get devicePixelRatio(){return Ct.devicePixelRatio},get prefersReducedMotion(){return!!Ct.matchMedia&&(null==Ln&&(Ln=Ct.matchMedia("(prefers-reduced-motion: reduce)")),Ln.matches)}};let ha;const Qn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ha){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ha=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(i){ha=a}}return ha},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Vs={supported:!1,testSupport:function(a){!da&&Pr&&(vd?Us(a):Ua=a)}};let Ua,Pr,da=!1,vd=!1;function Us(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Pr),a.isContextLost())return;Vs.supported=!0}catch(l){}a.deleteTexture(i),da=!0}Ct.document&&(Pr=Ct.document.createElement("img"),Pr.onload=function(){Ua&&Us(Ua),Ua=null,vd=!0},Pr.onerror=function(){da=!0,Ua=null},Pr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const uu="01",Aa="NO_ACCESS_TOKEN";function mr(a){return 0===a.indexOf("mapbox:")}function ja(a){return Qn.API_URL_REGEX.test(a)}const hu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ps(a){const i=a.match(hu);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function jo(a){const i=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${i}`}function vo(a){if(!a)return null;const i=a.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Ct.atob(i[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class du{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=vo(Qn.ACCESS_TOKEN);let u="";return u=l&&l.u?Ct.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,x)=>String.fromCharCode(Number("0x"+x)))):Qn.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const i=cu("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{const f=Ct.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const x=Ct.localStorage.getItem(u);x&&(this.anonId=x)}catch(f){Lr("Unable to read from LocalStorage")}}saveEventData(){const i=cu("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{Ct.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&Ct.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){Lr("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,u,f){if(!Qn.EVENTS_URL)return;const x=ps(Qn.EVENTS_URL);x.params.push(`access_token=${f||Qn.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.5.1",skuId:uu,userId:this.anonId},M=l?ci(b,l):b,P={url:jo(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Y(P,F=>{this.pendingRequest=null,u(F),this.saveEventData(),this.processRequests(f)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const gl=new class extends du{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,i){Qn.EVENTS_URL&&Qn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>mr(l)||ja(l))&&this.queueRequest(Date.now(),i)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=vo(Qn.ACCESS_TOKEN),l=i?i.u:Qn.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;co(this.anonId)||(this.anonId=nc(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),b=new Date(f),M=(f-this.eventData.lastSuccess)/864e5;u=u||M>=1||M<-1||x.getDate()!==b.getDate()}else u=!0;if(!u)return this.processRequests();this.postEvent(f,{"enabled.telemetry":!1},x=>{x||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a)}},fh=gl.postTurnstileEvent.bind(gl),ic=new class extends du{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,i,l,u){this.skuToken=i,this.errorCb=u,Qn.EVENTS_URL&&(l||Qn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Aa)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),co(this.anonId)||(this.anonId=nc()),this.postEvent(l,{skuToken:this.skuToken},u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},a))}},oc=ic.postMapLoadEvent.bind(ic),ph=new class extends du{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,i,l,u){if(!Qn.API_URL||!Qn.SESSION_PATH)return;const f=ps(Qn.API_URL+Qn.SESSION_PATH);f.params.push(`sku=${i||""}`),f.params.push(`access_token=${u||Qn.ACCESS_TOKEN||""}`);const x={url:jo(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ae(x,b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(u)})}getSessionAPI(a,i,l,u){this.skuToken=i,this.errorCb=u,Qn.SESSION_PATH&&Qn.API_URL&&(l||Qn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Aa)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},a)}},xd=ph.getSessionAPI.bind(ph),sc=new Set,ac="mapbox-tiles";let $o,$a,mh=500,Au=50;function Pn(){Ct.caches&&!$o&&($o=Ct.caches.open(ac))}function fa(a){const i=a.indexOf("?");return i<0?a:a.slice(0,i)}let sn=1/0;const pa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(pa);class lc extends Error{constructor(i,l,u){401===l&&ja(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $n=fl()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ct.location.protocol?Ct.parent:Ct).location.href,ne=function(a,i){if(!(/^file:/.test(l=a.url)||/^file:/.test($n())&&!/^\w+:/.test(l))){if(Ct.fetch&&Ct.Request&&Ct.AbortController&&Ct.Request.prototype.hasOwnProperty("signal"))return function(u,f){const x=new Ct.AbortController,b=new Ct.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:$n(),signal:x.signal});let M=!1,P=!1;const F=(N=b.url).indexOf("sku=")>0&&ja(N);var N;"json"===u.type&&b.headers.set("Accept","application/json");const V=(q,re,oe)=>{if(P)return;if(q&&"SecurityError"!==q.message&&Lr(q),re&&oe)return j(re);const Ae=Date.now();Ct.fetch(b).then(xe=>{if(xe.ok){const Me=F?xe.clone():null;return j(xe,Me,Ae)}return f(new lc(xe.statusText,xe.status,u.url))}).catch(xe=>{20!==xe.code&&f(new Error(xe.message))})},j=(q,re,oe)=>{("arrayBuffer"===u.type?q.arrayBuffer():"json"===u.type?q.json():q.text()).then(Ae=>{P||(re&&oe&&function(xe,Me,Le){if(Pn(),!$o)return;const Be={status:Me.status,statusText:Me.statusText,headers:new Ct.Headers};Me.headers.forEach((Ue,Ze)=>Be.headers.set(Ze,Ue));const Ne=za(Me.headers.get("Cache-Control")||"");Ne["no-store"]||(Ne["max-age"]&&Be.headers.set("Expires",new Date(Le+1e3*Ne["max-age"]).toUTCString()),new Date(Be.headers.get("Expires")).getTime()-Le<42e4||function(Ue,Ze){if(void 0===$a)try{new Response(new ReadableStream),$a=!0}catch(it){$a=!1}$a?Ze(Ue.body):Ue.blob().then(Ze)}(Me,Ue=>{const Ze=new Ct.Response(Ue,Be);Pn(),$o&&$o.then(it=>it.put(fa(xe.url),Ze)).catch(it=>Lr(it.message))}))}(b,re,oe),M=!0,f(null,Ae,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(Ae=>{P||f(new Error(Ae.message))})};return F?function(q,re){if(Pn(),!$o)return re(null);const oe=fa(q.url);$o.then(Ae=>{Ae.match(oe).then(xe=>{const Me=function(Le){if(!Le)return!1;const Be=new Date(Le.headers.get("Expires")||0),Ne=za(Le.headers.get("Cache-Control")||"");return Be>Date.now()&&!Ne["no-cache"]}(xe);Ae.delete(oe),Me&&Ae.put(oe,xe.clone()),re(null,xe,Me)}).catch(re)}).catch(re)}(b,V):V(null,null),{cancel:()=>{P=!0,M||x.abort()}}}(a,i);if(fl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var l;return function(u,f){const x=new Ct.XMLHttpRequest;x.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(x.responseType="arraybuffer");for(const b in u.headers)x.setRequestHeader(b,u.headers[b]);return"json"===u.type&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials="include"===u.credentials,x.onerror=()=>{f(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||0===x.status)&&null!==x.response){let b=x.response;if("json"===u.type)try{b=JSON.parse(x.response)}catch(M){return f(M)}f(null,b,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else f(new lc(x.statusText,x.status,u.url))},x.send(u.body),{cancel:()=>x.abort()}}(a,i)},Z=function(a,i){return ne(ci(a,{type:"arrayBuffer"}),i)},Y=function(a,i){return ne(ci(a,{method:"POST"}),i)},ae=function(a,i){return ne(ci(a,{method:"GET"}),i)};function he(a){const i=Ct.document.createElement("a");return i.href=a,i.protocol===Ct.document.location.protocol&&i.host===Ct.document.location.host}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let we,ke;we=[],ke=0;const Ee=function(a,i){if(Vs.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ke>=Qn.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return we.push(x),x}ke++;let l=!1;const u=()=>{if(!l)for(l=!0,ke--;we.length&&ke<Qn.MAX_PARALLEL_IMAGE_REQUESTS;){const x=we.shift(),{requestParameters:b,callback:M,cancelled:P}=x;P||(x.cancel=Ee(b,M).cancel)}},f=Z(a,(x,b,M,P)=>{u(),x?i(x):b&&(Ct.createImageBitmap?function(F,N){const V=new Ct.Blob([new Uint8Array(F)],{type:"image/png"});Ct.createImageBitmap(V).then(j=>{N(null,j)}).catch(j=>{N(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(F,N)=>i(F,N,M,P)):function(F,N){const V=new Ct.Image,j=Ct.URL;V.onload=()=>{N(null,V),j.revokeObjectURL(V.src),V.onload=null,Ct.requestAnimationFrame(()=>{V.src=be})},V.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const q=new Ct.Blob([new Uint8Array(F)],{type:"image/png"});V.src=F.byteLength?j.createObjectURL(q):be}(b,(F,N)=>i(F,N,M,P)))});return{cancel:()=>{f.cancel(),u()}}};function Oe(a,i,l){l[a]&&-1!==l[a].indexOf(i)||(l[a]=l[a]||[],l[a].push(i))}function Ye(a,i,l){if(l&&l[a]){const u=l[a].indexOf(i);-1!==u&&l[a].splice(u,1)}}class ft{constructor(i,l={}){ci(this,l),this.type=i}}class Xe extends ft{constructor(i,l={}){super("error",ci({error:i},l))}}class jt{on(i,l){return this._listeners=this._listeners||{},Oe(i,l,this._listeners),this}off(i,l){return Ye(i,l,this._listeners),Ye(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Oe(i,l,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,l){"string"==typeof i&&(i=new ft(i,l||{}));const u=i.type;if(this.listens(u)){i.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const M of f)M.call(this,i);const x=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const M of x)Ye(u,M,this._oneTimeListeners),M.call(this,i);const b=this._eventedParent;b&&(ci(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(i))}else i instanceof Xe&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ge{constructor(i,l,u,f){this.message=(i?`${i}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function $t(a){const i=a.value;return i?[new Ge(a.key,i,"constants have been deprecated as of v8")]:[]}function pn(a,...i){for(const l of i)for(const u in l)a[u]=l[u];return a}function tn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Yn(a){if(Array.isArray(a))return a.map(Yn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const l in a)i[l]=Yn(a[l]);return i}return tn(a)}class Bn extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class gr{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(i){return new gr(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Ga={kind:"null"},vt={kind:"number"},yn={kind:"string"},Ht={kind:"boolean"},Gn={kind:"color"},Gi={kind:"object"},vn={kind:"value"},bd={kind:"collator"},qt={kind:"formatted"},fu={kind:"resolvedImage"};function _r(a,i){return{kind:"array",itemType:a,N:i}}function Kn(a){if("array"===a.kind){const i=Kn(a.itemType);return"number"==typeof a.N?`array<${i}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${i}>`}return a.kind}const wd=[Ga,vt,yn,Ht,Gn,qt,Gi,_r(vn),fu];function cc(a,i){if("error"===i.kind)return null;if("array"===a.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!cc(a.itemType,i.itemType))&&("number"!=typeof a.N||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if("value"===a.kind)for(const l of wd)if(!cc(l,i))return null}return`Expected ${Kn(a)} but found ${Kn(i)} instead.`}function uc(a,i){return i.some(l=>l.kind===a.kind)}function hc(a,i){return i.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}function Go(a){var i={exports:{}};return a(i,i.exports),i.exports}var pu=Go(function(a,i){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(M){return(M=Math.round(M))<0?0:M>255?255:M}function f(M){return u("%"===M[M.length-1]?parseFloat(M)/100*255:parseInt(M))}function x(M){return(P="%"===M[M.length-1]?parseFloat(M)/100:parseFloat(M))<0?0:P>1?1:P;var P}function b(M,P,F){return F<0?F+=1:F>1&&(F-=1),6*F<1?M+(P-M)*F*6:2*F<1?P:3*F<2?M+(P-M)*(2/3-F)*6:M}try{i.parseCSSColor=function(M){var P,F=M.replace(/ /g,"").toLowerCase();if(F in l)return l[F].slice();if("#"===F[0])return 4===F.length?(P=parseInt(F.substr(1),16))>=0&&P<=4095?[(3840&P)>>4|(3840&P)>>8,240&P|(240&P)>>4,15&P|(15&P)<<4,1]:null:7===F.length&&(P=parseInt(F.substr(1),16))>=0&&P<=16777215?[(16711680&P)>>16,(65280&P)>>8,255&P,1]:null;var N=F.indexOf("("),V=F.indexOf(")");if(-1!==N&&V+1===F.length){var j=F.substr(0,N),q=F.substr(N+1,V-(N+1)).split(","),re=1;switch(j){case"rgba":if(4!==q.length)return null;re=x(q.pop());case"rgb":return 3!==q.length?null:[f(q[0]),f(q[1]),f(q[2]),re];case"hsla":if(4!==q.length)return null;re=x(q.pop());case"hsl":if(3!==q.length)return null;var oe=(parseFloat(q[0])%360+360)%360/360,Ae=x(q[1]),xe=x(q[2]),Me=xe<=.5?xe*(Ae+1):xe+Ae-xe*Ae,Le=2*xe-Me;return[u(255*b(Le,Me,oe+1/3)),u(255*b(Le,Me,oe)),u(255*b(Le,Me,oe-1/3)),re];default:return null}}return null}}catch(M){}});class ln{constructor(i,l,u,f=1){this.r=i,this.g=l,this.b=u,this.a=f}static parse(i){if(!i)return;if(i instanceof ln)return i;if("string"!=typeof i)return;const l=pu.parseCSSColor(i);return l?new ln(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,u,f]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:i,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*i/f,255*l/f,255*u/f,f]}}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1),ln.blue=new ln(0,0,1,1);class Cd{constructor(i,l,u){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zt{constructor(i,l,u,f,x){this.text=i,this.image=l,this.scale=u,this.fontStack=f,this.textColor=x}}class ui{constructor(i){this.sections=i}static fromString(i){return new ui([new Zt(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof ui?i:ui.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(u)}return i}}class Po{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Po({name:i,available:!1}):null}serialize(){return["image",this.name]}}function ma(a,i,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,i,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,i,l,u]:[a,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mu(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof ln||a instanceof Cd||a instanceof ui||a instanceof Po)return!0;if(Array.isArray(a)){for(const i of a)if(!mu(i))return!1;return!0}if("object"==typeof a){for(const i in a)if(!mu(a[i]))return!1;return!0}return!1}function pi(a){if(null===a)return Ga;if("string"==typeof a)return yn;if("boolean"==typeof a)return Ht;if("number"==typeof a)return vt;if(a instanceof ln)return Gn;if(a instanceof Cd)return bd;if(a instanceof ui)return qt;if(a instanceof Po)return fu;if(Array.isArray(a)){const i=a.length;let l;for(const u of a){const f=pi(u);if(l){if(l===f)continue;l=vn;break}l=f}return _r(l||vn,i)}return Gi}function Ro(a){const i=typeof a;return null===a?"":"string"===i||"number"===i||"boolean"===i?String(a):a instanceof ln||a instanceof ui||a instanceof Po?a.toString():JSON.stringify(a)}class hi{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!mu(i[1]))return l.error("invalid value");const u=i[1];let f=pi(u);const x=l.expectedType;return"array"!==f.kind||0!==f.N||!x||"array"!==x.kind||"number"==typeof x.N&&0!==x.N||(f=x),new hi(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ln?["rgba"].concat(this.value.toArray()):this.value instanceof ui?this.value.serialize():this.value}}class Hi{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const gu={string:yn,number:vt,boolean:Ht,object:Gi};class Ar{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let u,f=1;const x=i[0];if("array"===x){let M,P;if(i.length>2){const F=i[1];if("string"!=typeof F||!(F in gu)||"object"===F)return l.error('The item type argument of "array" must be one of string, number, boolean',1);M=gu[F],f++}else M=vn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=i[2],f++}u=_r(M,P)}else u=gu[x];const b=[];for(;f<i.length;f++){const M=l.parse(i[f],f,vn);if(!M)return null;b.push(M)}return new Ar(u,b)}evaluate(i){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(i);if(!cc(this.type,pi(u)))return u;if(l===this.args.length-1)throw new Hi(`Expected value to be of type ${Kn(this.type)}, but found ${Kn(pi(u))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if("array"===i.kind){const u=i.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=i.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}class _u{constructor(i){this.type=qt,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let x=!1;for(let b=1;b<=i.length-1;++b){const M=i[b];if(x&&"object"==typeof M&&!Array.isArray(M)){x=!1;let P=null;if(M["font-scale"]&&(P=l.parse(M["font-scale"],1,vt),!P))return null;let F=null;if(M["text-font"]&&(F=l.parse(M["text-font"],1,_r(yn)),!F))return null;let N=null;if(M["text-color"]&&(N=l.parse(M["text-color"],1,Gn),!N))return null;const V=f[f.length-1];V.scale=P,V.font=F,V.textColor=N}else{const P=l.parse(i[b],1,vn);if(!P)return null;const F=P.type.kind;if("string"!==F&&"value"!==F&&"null"!==F&&"resolvedImage"!==F)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,f.push({content:P,scale:null,font:null,textColor:null})}}return new _u(f)}evaluate(i){return new ui(this.sections.map(l=>{const u=l.content.evaluate(i);return pi(u)===fu?new Zt("",u,null,null,null):new Zt(Ro(u),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),i.push(u)}return i}}class gh{constructor(i){this.type=fu,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const u=l.parse(i[1],1,yn);return u?new gh(u):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),u=Po.fromString(l);return u&&i.availableImages&&(u.available=i.availableImages.indexOf(l)>-1),u}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Xp={"to-boolean":Ht,"to-color":Gn,"to-number":vt,"to-string":yn};class _l{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const u=i[0];if(("to-boolean"===u||"to-string"===u)&&2!==i.length)return l.error("Expected one argument.");const f=Xp[u],x=[];for(let b=1;b<i.length;b++){const M=l.parse(i[b],b,vn);if(!M)return null;x.push(M)}return new _l(f,x)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(i),u=null,l instanceof ln)return l;if("string"==typeof l){const x=i.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:ma(l[0],l[1],l[2],l[3]),!u))return new ln(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Hi(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(i),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Hi(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?ui.fromString(Ro(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Po.fromString(Ro(this.args[0].evaluate(i))):Ro(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new _u([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new gh(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const sr=["Unknown","Point","LineString","Polygon"];class Yp{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?sr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=ln.parse(i)),l}}class Ho{constructor(i,l,u,f){this.name=i,this.type=l,this._evaluate=u,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const u=i[0],f=Ho.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(f)?f[0]:f.type,b=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,M=b.filter(([F])=>!Array.isArray(F)||F.length===i.length-1);let P=null;for(const[F,N]of M){P=new $s(l.registry,l.path,null,l.scope);const V=[];let j=!1;for(let q=1;q<i.length;q++){const re=i[q],oe=Array.isArray(F)?F[q-1]:F.type,Ae=P.parse(re,1+V.length,oe);if(!Ae){j=!0;break}V.push(Ae)}if(!j)if(Array.isArray(F)&&F.length!==V.length)P.error(`Expected ${F.length} arguments, but found ${V.length} instead.`);else{for(let q=0;q<V.length;q++){const re=Array.isArray(F)?F[q]:F.type,oe=V[q];P.concat(q+1).checkSubtype(re,oe.type)}if(0===P.errors.length)return new Ho(u,x,N,V)}}if(1===M.length)l.errors.push(...P.errors);else{const F=(M.length?M:b).map(([V])=>{return j=V,Array.isArray(j)?`(${j.map(Kn).join(", ")})`:`(${Kn(j.type)}...)`;var j}).join(" | "),N=[];for(let V=1;V<i.length;V++){const j=l.parse(i[V],1+N.length);if(!j)return null;N.push(Kn(j.type))}l.error(`Expected arguments of type ${F}, but found (${N.join(", ")}) instead.`)}return null}static register(i,l){Ho.definitions=l;for(const u in l)i[u]=Ho}}class qo{constructor(i,l,u){this.type=bd,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const u=i[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Ht);if(!f)return null;const x=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Ht);if(!x)return null;let b=null;return u.locale&&(b=l.parse(u.locale,1,yn),!b)?null:new qo(f,x,b)}evaluate(i){return new Cd(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Hn=8192;function dc(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function Ac(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function Ed(a,i){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(l*f*Hn),Math.round(u*f*Hn)]}function nf(a,i,l){const u=a[0]-i[0],f=a[1]-i[1],x=a[0]-l[0],b=a[1]-l[1];return u*b-x*f==0&&u*x<=0&&f*b<=0}function Dd(a,i){let l=!1;for(let b=0,M=i.length;b<M;b++){const P=i[b];for(let F=0,N=P.length;F<N-1;F++){if(nf(a,P[F],P[F+1]))return!1;(f=P[F])[1]>(u=a)[1]!=(x=P[F+1])[1]>u[1]&&u[0]<(x[0]-f[0])*(u[1]-f[1])/(x[1]-f[1])+f[0]&&(l=!l)}}var u,f,x;return l}function js(a,i){for(let l=0;l<i.length;l++)if(Dd(a,i[l]))return!0;return!1}function ga(a,i,l,u){const f=u[0]-l[0],x=u[1]-l[1],b=(a[0]-l[0])*x-f*(a[1]-l[1]),M=(i[0]-l[0])*x-f*(i[1]-l[1]);return b>0&&M<0||b<0&&M>0}function Kp(a,i,l){for(const F of l)for(let N=0;N<F.length-1;++N)if((M=[(b=F[N+1])[0]-(x=F[N])[0],b[1]-x[1]])[0]*(P=[(f=i)[0]-(u=a)[0],f[1]-u[1]])[1]-M[1]*P[0]!=0&&ga(u,f,x,b)&&ga(x,b,u,f))return!0;var u,f,x,b,M,P;return!1}function Ha(a,i){for(let l=0;l<a.length;++l)if(!Dd(a[l],i))return!1;for(let l=0;l<a.length-1;++l)if(Kp(a[l],a[l+1],i))return!1;return!0}function Jp(a,i){for(let l=0;l<i.length;l++)if(Ha(a,i[l]))return!0;return!1}function _h(a,i,l){const u=[];for(let f=0;f<a.length;f++){const x=[];for(let b=0;b<a[f].length;b++){const M=Ed(a[f][b],l);dc(i,M),x.push(M)}u.push(x)}return u}function Zo(a,i,l){const u=[];for(let f=0;f<a.length;f++){const x=_h(a[f],i,l);u.push(x)}return u}function yh(a,i,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let x=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===x&&(x=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=x}dc(i,a)}function qi(a,i,l,u){const f=Math.pow(2,u.z)*Hn,x=[u.x*Hn,u.y*Hn],b=[];for(const M of a)for(const P of M){const F=[P.x+x[0],P.y+x[1]];yh(F,i,l,f),b.push(F)}return b}function yu(a,i,l,u){const f=Math.pow(2,u.z)*Hn,x=[u.x*Hn,u.y*Hn],b=[];for(const P of a){const F=[];for(const N of P){const V=[N.x+x[0],N.y+x[1]];dc(i,V),F.push(V)}b.push(F)}if(i[2]-i[0]<=f/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of b)for(const F of P)yh(F,i,l,f)}var M;return b}class Wo{constructor(i,l){this.type=Ht,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(mu(i[1])){const u=i[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const x=u.features[f].geometry.type;if("Polygon"===x||"MultiPolygon"===x)return new Wo(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Wo(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Wo(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if("Polygon"===u.type){const M=_h(u.coordinates,x,b),P=qi(l.geometry(),f,x,b);if(!Ac(f,x))return!1;for(const F of P)if(!Dd(F,M))return!1}if("MultiPolygon"===u.type){const M=Zo(u.coordinates,x,b),P=qi(l.geometry(),f,x,b);if(!Ac(f,x))return!1;for(const F of P)if(!js(F,M))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if("Polygon"===u.type){const M=_h(u.coordinates,x,b),P=yu(l.geometry(),f,x,b);if(!Ac(f,x))return!1;for(const F of P)if(!Ha(F,M))return!1}if("MultiPolygon"===u.type){const M=Zo(u.coordinates,x,b),P=yu(l.geometry(),f,x,b);if(!Ac(f,x))return!1;for(const F of P)if(!Jp(F,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Wt(a){if(a instanceof Ho&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Wo)return!1;let i=!0;return a.eachChild(l=>{i&&!Wt(l)&&(i=!1)}),i}function mi(a){if(a instanceof Ho&&"feature-state"===a.name)return!1;let i=!0;return a.eachChild(l=>{i&&!mi(l)&&(i=!1)}),i}function Mi(a,i){if(a instanceof Ho&&i.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!Mi(u,i)&&(l=!1)}),l}class hn{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const u=i[1];return l.scope.has(u)?new hn(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class $s{constructor(i,l=[],u,f=new gr,x=[]){this.registry=i,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=f,this.errors=x,this.expectedType=u}parse(i,l,u,f,x={}){return l?this.concat(l,u,f)._parse(i,x):this._parse(i,x)}_parse(i,l){function u(f,x,b){return"assert"===b?new Ar(x,[f]):"coerce"===b?new _l(x,[f]):f}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=i[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[f];if(x){let b=x.parse(i,this);if(!b)return null;if(this.expectedType){const M=this.expectedType,P=b.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==P.kind)if("color"!==M.kind&&"formatted"!==M.kind&&"resolvedImage"!==M.kind||"value"!==P.kind&&"string"!==P.kind){if(this.checkSubtype(M,P))return null}else b=u(b,M,l.typeAnnotation||"coerce");else b=u(b,M,l.typeAnnotation||"assert")}if(!(b instanceof hi)&&"resolvedImage"!==b.type.kind&&xo(b)){const M=new Yp;try{b=new hi(b.type,b.evaluate(M))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,u){const f="number"==typeof i?this.path.concat(i):this.path,x=u?this.scope.concat(u):this.scope;return new $s(this.registry,f,l||null,x,this.errors)}error(i,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Bn(u,i))}checkSubtype(i,l){const u=cc(i,l);return u&&this.error(u),u}}function xo(a){if(a instanceof hn)return xo(a.boundExpression);if(a instanceof Ho&&"error"===a.name||a instanceof qo||a instanceof Wo)return!1;const i=a instanceof _l||a instanceof Ar;let l=!0;return a.eachChild(u=>{l=i?l&&xo(u):l&&u instanceof hi}),!!l&&Wt(a)&&Mi(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function vh(a,i){const l=a.length-1;let u,f,x=0,b=l,M=0;for(;x<=b;)if(M=Math.floor((x+b)/2),u=a[M],f=a[M+1],u<=i){if(M===l||i<f)return M;x=M+1}else{if(!(u>i))throw new Hi("Input is not a number.");b=M-1}return 0}class Bi{constructor(i,l,u){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[f,x]of u)this.labels.push(f),this.outputs.push(x)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(i[1],1,vt);if(!u)return null;const f=[];let x=null;l.expectedType&&"value"!==l.expectedType.kind&&(x=l.expectedType);for(let b=1;b<i.length;b+=2){const M=1===b?-1/0:i[b],P=i[b+1],F=b,N=b+1;if("number"!=typeof M)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(f.length&&f[f.length-1][0]>=M)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const V=l.parse(P,N,x);if(!V)return null;x=x||V.type,f.push([M,V])}return new Bi(x,u,f)}evaluate(i){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return u[0].evaluate(i);const x=l.length;return f>=l[x-1]?u[x-1].evaluate(i):u[vh(l,f)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}function ut(a,i,l){return a*(1-l)+i*l}var xn=Object.freeze({__proto__:null,number:ut,color:function(a,i,l){return new ln(ut(a.r,i.r,l),ut(a.g,i.g,l),ut(a.b,i.b,l),ut(a.a,i.a,l))},array:function(a,i,l){return a.map((u,f)=>ut(u,i[f],l))}});const _a=4/29,di=6/29,Gs=3*di*di,qr=Math.PI/180,vu=180/Math.PI;function ya(a){return a>.008856451679035631?Math.pow(a,1/3):a/Gs+_a}function mn(a){return a>di?a*a*a:Gs*(a-_a)}function yl(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function va(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function xu(a){const i=va(a.r),l=va(a.g),u=va(a.b),f=ya((.4124564*i+.3575761*l+.1804375*u)/.95047),x=ya((.2126729*i+.7151522*l+.072175*u)/1);return{l:116*x-16,a:500*(f-x),b:200*(x-ya((.0193339*i+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function qa(a){let i=(a.l+16)/116,l=isNaN(a.a)?i:i+a.a/500,u=isNaN(a.b)?i:i-a.b/200;return i=1*mn(i),l=.95047*mn(l),u=1.08883*mn(u),new ln(yl(3.2404542*l-1.5371385*i-.4985314*u),yl(-.969266*l+1.8760108*i+.041556*u),yl(.0556434*l-.2040259*i+1.0572252*u),a.alpha)}function bo(a,i,l){const u=i-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Hs={forward:xu,reverse:qa,interpolate:function(a,i,l){return{l:ut(a.l,i.l,l),a:ut(a.a,i.a,l),b:ut(a.b,i.b,l),alpha:ut(a.alpha,i.alpha,l)}}},ms={forward:function(a){const{l:i,a:l,b:u}=xu(a),f=Math.atan2(u,l)*vu;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:i,alpha:a.a}},reverse:function(a){const i=a.h*qr,l=a.c;return qa({l:a.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:a.alpha})},interpolate:function(a,i,l){return{h:bo(a.h,i.h,l),c:ut(a.c,i.c,l),l:ut(a.l,i.l,l),alpha:ut(a.alpha,i.alpha,l)}}};var Qo=Object.freeze({__proto__:null,lab:Hs,hcl:ms});class Rn{constructor(i,l,u,f,x){this.type=i,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[b,M]of x)this.labels.push(b),this.outputs.push(M)}static interpolationFactor(i,l,u,f){let x=0;if("exponential"===i.name)x=Sd(l,i.base,u,f);else if("linear"===i.name)x=Sd(l,1,u,f);else if("cubic-bezier"===i.name){const b=i.controlPoints;x=new Vo(b[0],b[1],b[2],b[3]).solve(Sd(l,1,u,f))}return x}static parse(i,l){let[u,f,x,...b]=i;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const F=f[1];if("number"!=typeof F)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:F}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const F=f.slice(1);if(4!==F.length||F.some(N=>"number"!=typeof N||N<0||N>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:F}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,vt),!x)return null;const M=[];let P=null;"interpolate-hcl"===u||"interpolate-lab"===u?P=Gn:l.expectedType&&"value"!==l.expectedType.kind&&(P=l.expectedType);for(let F=0;F<b.length;F+=2){const N=b[F],V=b[F+1],j=F+3,q=F+4;if("number"!=typeof N)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(M.length&&M[M.length-1][0]>=N)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const re=l.parse(V,q,P);if(!re)return null;P=P||re.type,M.push([N,re])}return"number"===P.kind||"color"===P.kind||"array"===P.kind&&"number"===P.itemType.kind&&"number"==typeof P.N?new Rn(P,u,f,x,M):l.error(`Type ${Kn(P)} is not interpolatable.`)}evaluate(i){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return u[0].evaluate(i);const x=l.length;if(f>=l[x-1])return u[x-1].evaluate(i);const b=vh(l,f),M=Rn.interpolationFactor(this.interpolation,f,l[b],l[b+1]),P=u[b].evaluate(i),F=u[b+1].evaluate(i);return"interpolate"===this.operator?xn[this.type.kind.toLowerCase()](P,F,M):"interpolate-hcl"===this.operator?ms.reverse(ms.interpolate(ms.forward(P),ms.forward(F),M)):Hs.reverse(Hs.interpolate(Hs.forward(P),Hs.forward(F),M))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Sd(a,i,l,u){const f=u-l,x=a-l;return 0===f?0:1===i?x/f:(Math.pow(i,x)-1)/(Math.pow(i,f)-1)}class xh{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const x=[];for(const M of i.slice(1)){const P=l.parse(M,1+x.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,x.push(P)}const b=f&&x.some(M=>cc(f,M.type));return new xh(b?vn:u,x)}evaluate(i){let l,u=null,f=0;for(const x of this.args)if(f++,u=x.evaluate(i),u&&u instanceof Po&&!u.available&&(l||(l=u.name),u=null,f===this.args.length&&(u=l)),null!==u)break;return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class vl{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let x=1;x<i.length-1;x+=2){const b=i[x];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const M=l.parse(i[x+1],x+1);if(!M)return null;u.push([b,M])}const f=l.parse(i[i.length-1],i.length-1,l.expectedType,u);return f?new vl(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,u]of this.bindings)i.push(l,u.serialize());return i.push(this.result.serialize()),i}}class fc{constructor(i,l,u){this.type=i,this.index=l,this.input=u}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,vt),f=l.parse(i[2],2,_r(l.expectedType||vn));return u&&f?new fc(f.type.itemType,u,f):null}evaluate(i){const l=this.index.evaluate(i),u=this.input.evaluate(i);if(l<0)throw new Hi(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new Hi(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new Hi(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class xl{constructor(i,l){this.type=Ht,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,vn),f=l.parse(i[2],2,vn);return u&&f?uc(u.type,[Ht,yn,vt,Ga,vn])?new xl(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(u.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!u)return!1;if(!hc(l,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(pi(l))} instead.`);if(!hc(u,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${Kn(pi(u))} instead.`);return u.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class bl{constructor(i,l,u){this.type=vt,this.needle=i,this.haystack=l,this.fromIndex=u}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,vn),f=l.parse(i[2],2,vn);if(!u||!f)return null;if(!uc(u.type,[Ht,yn,vt,Ga,vn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(u.type)} instead`);if(4===i.length){const x=l.parse(i[3],3,vt);return x?new bl(u,f,x):null}return new bl(u,f)}evaluate(i){const l=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!hc(l,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${Kn(pi(l))} instead.`);if(!hc(u,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${Kn(pi(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class xa{constructor(i,l,u,f,x,b){this.inputType=i,this.type=l,this.input=u,this.cases=f,this.outputs=x,this.otherwise=b}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const x={},b=[];for(let F=2;F<i.length-1;F+=2){let N=i[F];const V=i[F+1];Array.isArray(N)||(N=[N]);const j=l.concat(F);if(0===N.length)return j.error("Expected at least one branch label.");for(const re of N){if("number"!=typeof re&&"string"!=typeof re)return j.error("Branch labels must be numbers or strings.");if("number"==typeof re&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof re&&Math.floor(re)!==re)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,pi(re)))return null}else u=pi(re);if(void 0!==x[String(re)])return j.error("Branch labels must be unique.");x[String(re)]=b.length}const q=l.parse(V,F,f);if(!q)return null;f=f||q.type,b.push(q)}const M=l.parse(i[1],1,vn);if(!M)return null;const P=l.parse(i[i.length-1],i.length-1,f);return P?"value"!==M.type.kind&&l.concat(1).checkSubtype(u,M.type)?null:new xa(u,f,M,x,b,P):null}evaluate(i){const l=this.input.evaluate(i);return(pi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const b of l){const M=f[this.cases[b]];void 0===M?(f[this.cases[b]]=u.length,u.push([this.cases[b],[b]])):u[M][1].push(b)}const x=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,M]of u)i.push(1===M.length?x(M[0]):M.map(x)),i.push(this.outputs[b].serialize());return i.push(this.otherwise.serialize()),i}}class gi{constructor(i,l,u){this.type=i,this.branches=l,this.otherwise=u}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let b=1;b<i.length-1;b+=2){const M=l.parse(i[b],b,Ht);if(!M)return null;const P=l.parse(i[b+1],b+1,u);if(!P)return null;f.push([M,P]),u=u||P.type}const x=l.parse(i[i.length-1],i.length-1,u);return x?new gi(u,f,x):null}evaluate(i){for(const[l,u]of this.branches)if(l.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,u]of this.branches)i(l),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class bu{constructor(i,l,u,f){this.type=i,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,vn),f=l.parse(i[2],2,vt);if(!u||!f)return null;if(!uc(u.type,[_r(vn),yn,vn]))return l.error(`Expected first argument to be of type array or string, but found ${Kn(u.type)} instead`);if(4===i.length){const x=l.parse(i[3],3,vt);return x?new bu(u.type,u,f,x):null}return new bu(u.type,u,f)}evaluate(i){const l=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!hc(l,["string","array"]))throw new Hi(`Expected first argument to be of type array or string, but found ${Kn(pi(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return l.slice(u,f)}return l.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function gs(a,i){return"=="===a||"!="===a?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Fo(a,i,l,u){return 0===u.compare(i,l)}function Za(a,i,l){const u="=="!==a&&"!="!==a;return class Ok{constructor(x,b,M){this.type=Ht,this.lhs=x,this.rhs=b,this.collator=M,this.hasUntypedArgument="value"===x.type.kind||"value"===b.type.kind}static parse(x,b){if(3!==x.length&&4!==x.length)return b.error("Expected two or three arguments.");const M=x[0];let P=b.parse(x[1],1,vn);if(!P)return null;if(!gs(M,P.type))return b.concat(1).error(`"${M}" comparisons are not supported for type '${Kn(P.type)}'.`);let F=b.parse(x[2],2,vn);if(!F)return null;if(!gs(M,F.type))return b.concat(2).error(`"${M}" comparisons are not supported for type '${Kn(F.type)}'.`);if(P.type.kind!==F.type.kind&&"value"!==P.type.kind&&"value"!==F.type.kind)return b.error(`Cannot compare types '${Kn(P.type)}' and '${Kn(F.type)}'.`);u&&("value"===P.type.kind&&"value"!==F.type.kind?P=new Ar(F.type,[P]):"value"!==P.type.kind&&"value"===F.type.kind&&(F=new Ar(P.type,[F])));let N=null;if(4===x.length){if("string"!==P.type.kind&&"string"!==F.type.kind&&"value"!==P.type.kind&&"value"!==F.type.kind)return b.error("Cannot use collator to compare non-string types.");if(N=b.parse(x[3],3,bd),!N)return null}return new Ok(P,F,N)}evaluate(x){const b=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(u&&this.hasUntypedArgument){const P=pi(b),F=pi(M);if(P.kind!==F.kind||"string"!==P.kind&&"number"!==P.kind)throw new Hi(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${P.kind}, ${F.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const P=pi(b),F=pi(M);if("string"!==P.kind||"string"!==F.kind)return i(x,b,M)}return this.collator?l(x,b,M,this.collator.evaluate(x)):i(x,b,M)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[a];return this.eachChild(b=>{x.push(b.serialize())}),x}}}const bh=Za("==",function(a,i,l){return i===l},Fo),wu=Za("!=",function(a,i,l){return i!==l},function(a,i,l,u){return!Fo(0,i,l,u)}),Xo=Za("<",function(a,i,l){return i<l},function(a,i,l,u){return u.compare(i,l)<0}),em=Za(">",function(a,i,l){return i>l},function(a,i,l,u){return u.compare(i,l)>0}),x0=Za("<=",function(a,i,l){return i<=l},function(a,i,l,u){return u.compare(i,l)<=0}),tm=Za(">=",function(a,i,l){return i>=l},function(a,i,l,u){return u.compare(i,l)>=0});class Md{constructor(i,l,u,f,x){this.type=yn,this.number=i,this.locale=l,this.currency=u,this.minFractionDigits=f,this.maxFractionDigits=x}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const u=l.parse(i[1],1,vt);if(!u)return null;const f=i[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let x=null;if(f.locale&&(x=l.parse(f.locale,1,yn),!x))return null;let b=null;if(f.currency&&(b=l.parse(f.currency,1,yn),!b))return null;let M=null;if(f["min-fraction-digits"]&&(M=l.parse(f["min-fraction-digits"],1,vt),!M))return null;let P=null;return f["max-fraction-digits"]&&(P=l.parse(f["max-fraction-digits"],1,vt),!P)?null:new Md(u,x,b,M,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Cu{constructor(i){this.type=vt,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=l.parse(i[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Kn(u.type)} instead.`):new Cu(u):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new Hi(`Expected value to be of type string or array, but found ${Kn(pi(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const pc={"==":bh,"!=":wu,">":em,"<":Xo,">=":tm,"<=":x0,array:Ar,at:fc,boolean:Ar,case:gi,coalesce:xh,collator:qo,format:_u,image:gh,in:xl,"index-of":bl,interpolate:Rn,"interpolate-hcl":Rn,"interpolate-lab":Rn,length:Cu,let:vl,literal:hi,match:xa,number:Ar,"number-format":Md,object:Ar,slice:bu,step:Bi,string:Ar,"to-boolean":_l,"to-color":_l,"to-number":_l,"to-string":_l,var:hn,within:Wo};function rf(a,[i,l,u,f]){i=i.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const x=f?f.evaluate(a):1,b=ma(i,l,u,x);if(b)throw new Hi(b);return new ln(i/255*x,l/255*x,u/255*x,x)}function nm(a,i){return a in i}function of(a,i){const l=i[a];return void 0===l?null:l}function mc(a){return{type:a}}function sf(a){return{result:"success",value:a}}function gc(a){return{result:"error",value:a}}function _c(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function Td(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function af(a){return!!a.expression&&a.expression.interpolated}function nr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Id(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function b0(a){return a}function kd(a,i){const l="color"===i.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),x=a.type||(af(i)?"exponential":"interval");if(l&&((a=pn({},a)).stops&&(a.stops=a.stops.map(F=>[F[0],ln.parse(F[1])])),a.default=ln.parse(a.default?a.default:i.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Qo[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,M,P;if("exponential"===x)b=wh;else if("interval"===x)b=im;else if("categorical"===x){b=rm,M=Object.create(null);for(const F of a.stops)M[F[0]]=F[1];P=typeof a.stops[0][0]}else{if("identity"!==x)throw new Error(`Unknown function type "${x}"`);b=Cl}if(u){const F={},N=[];for(let q=0;q<a.stops.length;q++){const re=a.stops[q],oe=re[0].zoom;void 0===F[oe]&&(F[oe]={zoom:oe,type:a.type,property:a.property,default:a.default,stops:[]},N.push(oe)),F[oe].stops.push([re[0].value,re[1]])}const V=[];for(const q of N)V.push([F[q].zoom,kd(F[q],i)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Rn.interpolationFactor.bind(void 0,j),zoomStops:V.map(q=>q[0]),evaluate:({zoom:q},re)=>wh({stops:V,base:a.base},i,q).evaluate(q,re)}}if(f){const F="exponential"===x?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Rn.interpolationFactor.bind(void 0,F),zoomStops:a.stops.map(N=>N[0]),evaluate:({zoom:N})=>b(a,i,N,M,P)}}return{kind:"source",evaluate(F,N){const V=N&&N.properties?N.properties[a.property]:void 0;return void 0===V?wl(a.default,i.default):b(a,i,V,M,P)}}}function wl(a,i,l){return void 0!==a?a:void 0!==i?i:void 0!==l?l:void 0}function rm(a,i,l,u,f){return wl(typeof l===f?u[l]:void 0,a.default,i.default)}function im(a,i,l){if("number"!==nr(l))return wl(a.default,i.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=vh(a.stops.map(x=>x[0]),l);return a.stops[f][1]}function wh(a,i,l){const u=void 0!==a.base?a.base:1;if("number"!==nr(l))return wl(a.default,i.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const x=vh(a.stops.map(N=>N[0]),l),b=function(N,V,j,q){const re=q-j,oe=N-j;return 0===re?0:1===V?oe/re:(Math.pow(V,oe)-1)/(Math.pow(V,re)-1)}(l,u,a.stops[x][0],a.stops[x+1][0]),M=a.stops[x][1],P=a.stops[x+1][1];let F=xn[i.type]||b0;if(a.colorSpace&&"rgb"!==a.colorSpace){const N=Qo[a.colorSpace];F=(V,j)=>N.reverse(N.interpolate(N.forward(V),N.forward(j),b))}return"function"==typeof M.evaluate?{evaluate(...N){const V=M.evaluate.apply(void 0,N),j=P.evaluate.apply(void 0,N);if(void 0!==V&&void 0!==j)return F(V,j,b)}}:F(M,P,b)}function Cl(a,i,l){return"color"===i.type?l=ln.parse(l):"formatted"===i.type?l=ui.fromString(l.toString()):"resolvedImage"===i.type?l=Po.fromString(l.toString()):nr(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0),wl(l,a.default,i.default)}Ho.register(pc,{error:[{kind:"error"},[yn],(a,[i])=>{throw new Hi(i.evaluate(a))}],typeof:[yn,[vn],(a,[i])=>Kn(pi(i.evaluate(a)))],"to-rgba":[_r(vt,4),[Gn],(a,[i])=>i.evaluate(a).toArray()],rgb:[Gn,[vt,vt,vt],rf],rgba:[Gn,[vt,vt,vt,vt],rf],has:{type:Ht,overloads:[[[yn],(a,[i])=>nm(i.evaluate(a),a.properties())],[[yn,Gi],(a,[i,l])=>nm(i.evaluate(a),l.evaluate(a))]]},get:{type:vn,overloads:[[[yn],(a,[i])=>of(i.evaluate(a),a.properties())],[[yn,Gi],(a,[i,l])=>of(i.evaluate(a),l.evaluate(a))]]},"feature-state":[vn,[yn],(a,[i])=>of(i.evaluate(a),a.featureState||{})],properties:[Gi,[],a=>a.properties()],"geometry-type":[yn,[],a=>a.geometryType()],id:[vn,[],a=>a.id()],zoom:[vt,[],a=>a.globals.zoom],"heatmap-density":[vt,[],a=>a.globals.heatmapDensity||0],"line-progress":[vt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[vt,[],a=>a.globals.skyRadialProgress||0],accumulated:[vn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[vt,mc(vt),(a,i)=>{let l=0;for(const u of i)l+=u.evaluate(a);return l}],"*":[vt,mc(vt),(a,i)=>{let l=1;for(const u of i)l*=u.evaluate(a);return l}],"-":{type:vt,overloads:[[[vt,vt],(a,[i,l])=>i.evaluate(a)-l.evaluate(a)],[[vt],(a,[i])=>-i.evaluate(a)]]},"/":[vt,[vt,vt],(a,[i,l])=>i.evaluate(a)/l.evaluate(a)],"%":[vt,[vt,vt],(a,[i,l])=>i.evaluate(a)%l.evaluate(a)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(a,[i,l])=>Math.pow(i.evaluate(a),l.evaluate(a))],sqrt:[vt,[vt],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[vt,[vt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[vt,[vt],(a,[i])=>Math.log(i.evaluate(a))],log2:[vt,[vt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[vt,[vt],(a,[i])=>Math.sin(i.evaluate(a))],cos:[vt,[vt],(a,[i])=>Math.cos(i.evaluate(a))],tan:[vt,[vt],(a,[i])=>Math.tan(i.evaluate(a))],asin:[vt,[vt],(a,[i])=>Math.asin(i.evaluate(a))],acos:[vt,[vt],(a,[i])=>Math.acos(i.evaluate(a))],atan:[vt,[vt],(a,[i])=>Math.atan(i.evaluate(a))],min:[vt,mc(vt),(a,i)=>Math.min(...i.map(l=>l.evaluate(a)))],max:[vt,mc(vt),(a,i)=>Math.max(...i.map(l=>l.evaluate(a)))],abs:[vt,[vt],(a,[i])=>Math.abs(i.evaluate(a))],round:[vt,[vt],(a,[i])=>{const l=i.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[vt,[vt],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[vt,[vt],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Ht,[yn,vn],(a,[i,l])=>a.properties()[i.value]===l.value],"filter-id-==":[Ht,[vn],(a,[i])=>a.id()===i.value],"filter-type-==":[Ht,[yn],(a,[i])=>a.geometryType()===i.value],"filter-<":[Ht,[yn,vn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Ht,[vn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l<u}],"filter->":[Ht,[yn,vn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Ht,[vn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l>u}],"filter-<=":[Ht,[yn,vn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Ht,[vn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l<=u}],"filter->=":[Ht,[yn,vn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Ht,[vn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l>=u}],"filter-has":[Ht,[vn],(a,[i])=>i.value in a.properties()],"filter-has-id":[Ht,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Ht,[_r(yn)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ht,[_r(vn)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Ht,[yn,_r(vn)],(a,[i,l])=>l.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Ht,[yn,_r(vn)],(a,[i,l])=>function(u,f,x,b){for(;x<=b;){const M=x+b>>1;if(f[M]===u)return!0;f[M]>u?b=M-1:x=M+1}return!1}(a.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Ht,overloads:[[[Ht,Ht],(a,[i,l])=>i.evaluate(a)&&l.evaluate(a)],[mc(Ht),(a,i)=>{for(const l of i)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(a,[i,l])=>i.evaluate(a)||l.evaluate(a)],[mc(Ht),(a,i)=>{for(const l of i)if(l.evaluate(a))return!0;return!1}]]},"!":[Ht,[Ht],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Ht,[yn],(a,[i])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(i.evaluate(a))}],upcase:[yn,[yn],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[yn,[yn],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[yn,mc(vn),(a,i)=>i.map(l=>Ro(l.evaluate(a))).join("")],"resolved-locale":[yn,[bd],(a,[i])=>i.evaluate(a).resolvedLocale()]});class Ch{constructor(i,l){var u;this.expression=i,this._warningHistory={},this._evaluator=new Yp,this._defaultValue=l?"color"===(u=l).type&&Id(u.default)?new ln(0,0,0,0):"color"===u.type?ln.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,u,f,x,b){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(i,l,u,f,x,b){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Hi(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,"undefined"!=typeof console&&console.warn(M.message)),this._defaultValue}}}function Zr(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in pc}function Yo(a,i){const l=new $s(pc,[],i?function(f){const x={color:Gn,string:yn,number:vt,enum:yn,boolean:Ht,formatted:qt,resolvedImage:fu};return"array"===f.type?_r(x[f.value]||vn,f.length):x[f.type]}(i):void 0),u=l.parse(a,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return u?sf(new Ch(u,i)):gc(l.errors)}class Eh{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!mi(l.expression)}evaluateWithoutErrorHandling(i,l,u,f,x,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,u,f,x,b)}evaluate(i,l,u,f,x,b){return this._styleExpression.evaluate(i,l,u,f,x,b)}}class Wa{constructor(i,l,u,f){this.kind=i,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==i&&!mi(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,u,f,x,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,u,f,x,b)}evaluate(i,l,u,f,x,b){return this._styleExpression.evaluate(i,l,u,f,x,b)}interpolationFactor(i,l,u){return this.interpolationType?Rn.interpolationFactor(this.interpolationType,i,l,u):0}}function Dh(a,i){if("error"===(a=Yo(a,i)).result)return a;const l=a.value.expression,u=Wt(l);if(!u&&!_c(i))return gc([new Bn("","data expressions not supported")]);const f=Mi(l,["zoom"]);if(!f&&!Td(i))return gc([new Bn("","zoom expressions not supported")]);const x=yc(l);return x||f?x instanceof Bn?gc([x]):x instanceof Rn&&!af(i)?gc([new Bn("",'"interpolate" expressions cannot be used with this property')]):sf(x?new Wa(u?"camera":"composite",a.value,x.labels,x instanceof Rn?x.interpolation:void 0):new Eh(u?"constant":"source",a.value)):gc([new Bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Eu{constructor(i,l){this._parameters=i,this._specification=l,pn(this,kd(this._parameters,this._specification))}static deserialize(i){return new Eu(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function yc(a){let i=null;if(a instanceof vl)i=yc(a.result);else if(a instanceof xh){for(const l of a.args)if(i=yc(l),i)break}else(a instanceof Bi||a instanceof Rn)&&a.input instanceof Ho&&"zoom"===a.input.name&&(i=a);return i instanceof Bn||a.eachChild(l=>{const u=yc(l);u instanceof Bn?i=u:!i&&u?i=new Bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&u&&i!==u&&(i=new Bn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Ni(a){const i=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},x=a.style,b=a.styleSpec;let M=[];const P=nr(l);if("object"!==P)return[new Ge(i,l,`object expected, ${P} found`)];for(const F in l){const N=F.split(".")[0],V=u[N]||u["*"];let j;if(f[N])j=f[N];else if(u[N])j=Co;else if(f["*"])j=f["*"];else{if(!u["*"]){M.push(new Ge(i,l[F],`unknown property "${F}"`));continue}j=Co}M=M.concat(j({key:(i&&`${i}.`)+F,value:l[F],valueSpec:V,style:x,styleSpec:b,object:l,objectKey:F},l))}for(const F in u)f[F]||u[F].required&&void 0===u[F].default&&void 0===l[F]&&M.push(new Ge(i,l,`missing required property "${F}"`));return M}function Pd(a){const i=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,x=a.key,b=a.arrayElementValidator||Co;if("array"!==nr(i))return[new Ge(x,i,`array expected, ${nr(i)} found`)];if(l.length&&i.length!==l.length)return[new Ge(x,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Ge(x,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let M={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum};f.$version<7&&(M.function=l.function),"object"===nr(l.value)&&(M=l.value);let P=[];for(let F=0;F<i.length;F++)P=P.concat(b({array:i,arrayIndex:F,value:i[F],valueSpec:M,style:u,styleSpec:f,key:`${x}[${F}]`}));return P}function ho(a){const i=a.key,l=a.value,u=a.valueSpec;let f=nr(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new Ge(i,l,`number expected, ${f} found`)];if("minimum"in u){let x=u.minimum;if("array"===nr(u.minimum)&&(x=u.minimum[a.arrayIndex]),l<x)return[new Ge(i,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in u){let x=u.maximum;if("array"===nr(u.maximum)&&(x=u.maximum[a.arrayIndex]),l>x)return[new Ge(i,l,`${l} is greater than the maximum value ${x}`)]}return[]}function Sh(a){const i=a.valueSpec,l=tn(a.value.type);let u,f,x,b={};const M="categorical"!==l&&void 0===a.value.property,P=!M,F="array"===nr(a.value.stops)&&"array"===nr(a.value.stops[0])&&"object"===nr(a.value.stops[0][0]),N=Ni({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(q){if("identity"===l)return[new Ge(q.key,q.value,'identity function may not have a "stops" property')];let re=[];const oe=q.value;return re=re.concat(Pd({key:q.key,value:oe,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:V})),"array"===nr(oe)&&0===oe.length&&re.push(new Ge(q.key,oe,"array must have at least one stop")),re},default:function(q){return Co({key:q.key,value:q.value,valueSpec:i,style:q.style,styleSpec:q.styleSpec})}}});return"identity"===l&&M&&N.push(new Ge(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||N.push(new Ge(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!af(a.valueSpec)&&N.push(new Ge(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!_c(a.valueSpec)?N.push(new Ge(a.key,a.value,"property functions not supported")):M&&!Td(a.valueSpec)&&N.push(new Ge(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!F||void 0!==a.value.property||N.push(new Ge(a.key,a.value,'"property" property is required')),N;function V(q){let re=[];const oe=q.value,Ae=q.key;if("array"!==nr(oe))return[new Ge(Ae,oe,`array expected, ${nr(oe)} found`)];if(2!==oe.length)return[new Ge(Ae,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if("object"!==nr(oe[0]))return[new Ge(Ae,oe,`object expected, ${nr(oe[0])} found`)];if(void 0===oe[0].zoom)return[new Ge(Ae,oe,"object stop key must have zoom")];if(void 0===oe[0].value)return[new Ge(Ae,oe,"object stop key must have value")];if(x&&x>tn(oe[0].zoom))return[new Ge(Ae,oe[0].zoom,"stop zoom values must appear in ascending order")];tn(oe[0].zoom)!==x&&(x=tn(oe[0].zoom),f=void 0,b={}),re=re.concat(Ni({key:`${Ae}[0]`,value:oe[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:ho,value:j}}))}else re=re.concat(j({key:`${Ae}[0]`,value:oe[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},oe));return Zr(Yn(oe[1]))?re.concat([new Ge(`${Ae}[1]`,oe[1],"expressions are not allowed in function stops.")]):re.concat(Co({key:`${Ae}[1]`,value:oe[1],valueSpec:i,style:q.style,styleSpec:q.styleSpec}))}function j(q,re){const oe=nr(q.value),Ae=tn(q.value),xe=null!==q.value?q.value:re;if(u){if(oe!==u)return[new Ge(q.key,xe,`${oe} stop domain type must match previous stop domain type ${u}`)]}else u=oe;if("number"!==oe&&"string"!==oe&&"boolean"!==oe)return[new Ge(q.key,xe,"stop domain value must be a number, string, or boolean")];if("number"!==oe&&"categorical"!==l){let Me=`number expected, ${oe} found`;return _c(i)&&void 0===l&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(q.key,xe,Me)]}return"categorical"!==l||"number"!==oe||isFinite(Ae)&&Math.floor(Ae)===Ae?"categorical"!==l&&"number"===oe&&void 0!==f&&Ae<f?[new Ge(q.key,xe,"stop domain values must appear in ascending order")]:(f=Ae,"categorical"===l&&Ae in b?[new Ge(q.key,xe,"stop domain values must be unique")]:(b[Ae]=!0,[])):[new Ge(q.key,xe,`integer expected, found ${Ae}`)]}}function ba(a){const i=("property"===a.expressionContext?Dh:Yo)(Yn(a.value),a.valueSpec);if("error"===i.result)return i.value.map(u=>new Ge(`${a.key}${u.key}`,a.value,u.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Ge(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!mi(l))return[new Ge(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!mi(l))return[new Ge(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Mi(l,["zoom","feature-state"]))return[new Ge(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Wt(l))return[new Ge(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qa(a){const i=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(tn(l))&&f.push(new Ge(i,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(tn(l))&&f.push(new Ge(i,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Mh(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!Mh(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}const Du={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Su(a){if(null==a)return{filter:()=>!0,needGeometry:!1};Mh(a)||(a=Xa(a));const i=Yo(a,Du);if("error"===i.result)throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,u,f)=>i.value.evaluate(l,u,{},f),needGeometry:om(a)}}function $r(a,i){return a<i?-1:a>i?1:0}function om(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let i=1;i<a.length;i++)if(om(a[i]))return!0;return!1}function Xa(a){if(!a)return!0;const i=a[0];return a.length<=1?"any"!==i:"=="===i?Rd(a[1],a[2],"=="):"!="===i?Fd(Rd(a[1],a[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Rd(a[1],a[2],i):"any"===i?(l=a.slice(1),["any"].concat(l.map(Xa))):"all"===i?["all"].concat(a.slice(1).map(Xa)):"none"===i?["all"].concat(a.slice(1).map(Xa).map(Fd)):"in"===i?ri(a[1],a.slice(2)):"!in"===i?Fd(ri(a[1],a.slice(2))):"has"===i?lf(a[1]):"!has"===i?Fd(lf(a[1])):"within"!==i||a;var l}function Rd(a,i,l){switch(a){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,a,i]}}function ri(a,i){if(0===i.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",a,["literal",i.sort($r)]]:["filter-in-small",a,["literal",i]]}}function lf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Fd(a){return["!",a]}function vc(a){return Mh(Yn(a.value))?ba(pn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wi(a)}function Wi(a){const i=a.value,l=a.key;if("array"!==nr(i))return[new Ge(l,i,`array expected, ${nr(i)} found`)];const u=a.styleSpec;let f,x=[];if(i.length<1)return[new Ge(l,i,"filter array must have at least 1 element")];switch(x=x.concat(Qa({key:`${l}[0]`,value:i[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),tn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===tn(i[1])&&x.push(new Ge(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&x.push(new Ge(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=nr(i[1]),"string"!==f&&x.push(new Ge(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let b=2;b<i.length;b++)f=nr(i[b]),"$type"===tn(i[1])?x=x.concat(Qa({key:`${l}[${b}]`,value:i[b],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&x.push(new Ge(`${l}[${b}]`,i[b],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)x=x.concat(Wi({key:`${l}[${b}]`,value:i[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=nr(i[1]),2!==i.length?x.push(new Ge(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==f&&x.push(new Ge(`${l}[1]`,i[1],`string expected, ${f} found`));break;case"within":f=nr(i[1]),2!==i.length?x.push(new Ge(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==f&&x.push(new Ge(`${l}[1]`,i[1],`object expected, ${f} found`))}return x}function Mu(a,i){const l=a.key,u=a.style,f=a.styleSpec,x=a.value,b=a.objectKey,M=f[`${i}_${a.layerType}`];if(!M)return[];const P=b.match(/^(.*)-transition$/);if("paint"===i&&P&&M[P[1]]&&M[P[1]].transition)return Co({key:l,value:x,valueSpec:f.transition,style:u,styleSpec:f});const F=a.valueSpec||M[b];if(!F)return[new Ge(l,x,`unknown property "${b}"`)];let N;if("string"===nr(x)&&_c(F)&&!F.tokens&&(N=/^{([^}]+)}$/.exec(x)))return[new Ge(l,x,`"${b}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const V=[];return"symbol"===a.layerType&&("text-field"===b&&u&&!u.glyphs&&V.push(new Ge(l,x,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&Id(Yn(x))&&"identity"===tn(x.type)&&V.push(new Ge(l,x,'"text-font" does not support identity functions'))),V.concat(Co({key:a.key,value:x,valueSpec:F,style:u,styleSpec:f,expressionContext:"property",propertyType:i,propertyKey:b}))}function Qi(a){return Mu(a,"paint")}function qs(a){return Mu(a,"layout")}function wo(a){let i=[];const l=a.value,u=a.key,f=a.style,x=a.styleSpec;l.type||l.ref||i.push(new Ge(u,l,'either "type" or "ref" is required'));let b=tn(l.type);const M=tn(l.ref);if(l.id){const P=tn(l.id);for(let F=0;F<a.arrayIndex;F++){const N=f.layers[F];tn(N.id)===P&&i.push(new Ge(u,l.id,`duplicate layer id "${l.id}", previously used at line ${N.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach(F=>{F in l&&i.push(new Ge(u,l[F],`"${F}" is prohibited for ref layers`))}),f.layers.forEach(F=>{tn(F.id)===M&&(P=F)}),P?P.ref?i.push(new Ge(u,l.ref,"ref cannot reference another ref layer")):b=tn(P.type):i.push(new Ge(u,l.ref,`ref layer "${M}" not found`))}else if("background"!==b&&"sky"!==b)if(l.source){const P=f.sources&&f.sources[l.source],F=P&&tn(P.type);P?"vector"===F&&"raster"===b?i.push(new Ge(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===F&&"raster"!==b?i.push(new Ge(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==F||l["source-layer"]?"raster-dem"===F&&"hillshade"!==b?i.push(new Ge(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]||"geojson"===F&&P.lineMetrics||i.push(new Ge(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ge(u,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Ge(u,l.source,`source "${l.source}" not found`))}else i.push(new Ge(u,l,'missing required property "source"'));return i=i.concat(Ni({key:u,value:l,valueSpec:x.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Co({key:`${u}.type`,value:l.type,valueSpec:x.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:vc,layout:P=>Ni({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":F=>qs(pn({layerType:b},F))}}),paint:P=>Ni({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":F=>Qi(pn({layerType:b},F))}})}})),i}function El(a){const i=a.value,l=a.key,u=nr(i);return"string"!==u?[new Ge(l,i,`string expected, ${u} found`)]:[]}const Th={promoteId:function({key:a,value:i}){if("string"===nr(i))return El({key:a,value:i});{const l=[];for(const u in i)l.push(...El({key:`${a}.${u}`,value:i[u]}));return l}}};function cf(a){const i=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!i.type)return[new Ge(l,i,'"type" is required')];const x=tn(i.type);let b;switch(x){case"vector":case"raster":case"raster-dem":return b=Ni({key:l,value:i,valueSpec:u[`source_${x.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Th}),b;case"geojson":if(b=Ni({key:l,value:i,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:Th}),i.cluster)for(const M in i.clusterProperties){const[P,F]=i.clusterProperties[M],N="string"==typeof P?[P,["accumulated"],["get",M]]:P;b.push(...ba({key:`${l}.${M}.map`,value:F,expressionContext:"cluster-map"})),b.push(...ba({key:`${l}.${M}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return b;case"video":return Ni({key:l,value:i,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Ni({key:l,value:i,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new Ge(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qa({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:u})}}function _s(a){const i=a.value,l=a.styleSpec,u=l.light,f=a.style;let x=[];const b=nr(i);if(void 0===i)return x;if("object"!==b)return x=x.concat([new Ge("light",i,`object expected, ${b} found`)]),x;for(const M in i){const P=M.match(/^(.*)-transition$/);x=x.concat(P&&u[P[1]]&&u[P[1]].transition?Co({key:M,value:i[M],valueSpec:l.transition,style:f,styleSpec:l}):u[M]?Co({key:M,value:i[M],valueSpec:u[M],style:f,styleSpec:l}):[new Ge(M,i[M],`unknown property "${M}"`)])}return x}function Od(a){const i=a.value,l=a.key,u=a.style,f=a.styleSpec,x=f.terrain;let b=[];const M=nr(i);if(void 0===i)return b;if("object"!==M)return b=b.concat([new Ge("terrain",i,`object expected, ${M} found`)]),b;for(const P in i){const F=P.match(/^(.*)-transition$/);b=b.concat(F&&x[F[1]]&&x[F[1]].transition?Co({key:P,value:i[P],valueSpec:f.transition,style:u,styleSpec:f}):x[P]?Co({key:P,value:i[P],valueSpec:x[P],style:u,styleSpec:f}):[new Ge(P,i[P],`unknown property "${P}"`)])}if(i.source){const P=u.sources&&u.sources[i.source],F=P&&tn(P.type);P?"raster-dem"!==F&&b.push(new Ge(l,i.source,`terrain cannot be used with a source of type ${F}, it only be used with a "raster-dem" source type`)):b.push(new Ge(l,i.source,`source "${i.source}" not found`))}else b.push(new Ge(l,i,'terrain is missing required property "source"'));return b}function xc(a){const i=a.value,l=a.style,u=a.styleSpec,f=u.fog;let x=[];const b=nr(i);if(void 0===i)return x;if("object"!==b)return x=x.concat([new Ge("fog",i,`object expected, ${b} found`)]),x;for(const M in i){const P=M.match(/^(.*)-transition$/);x=x.concat(P&&f[P[1]]&&f[P[1]].transition?Co({key:M,value:i[M],valueSpec:u.transition,style:l,styleSpec:u}):f[M]?Co({key:M,value:i[M],valueSpec:f[M],style:l,styleSpec:u}):[new Ge(M,i[M],`unknown property "${M}"`)])}return x}const nn={"*":()=>[],array:Pd,boolean:function(a){const i=a.value,l=a.key,u=nr(i);return"boolean"!==u?[new Ge(l,i,`boolean expected, ${u} found`)]:[]},number:ho,color:function(a){const i=a.key,l=a.value,u=nr(l);return"string"!==u?[new Ge(i,l,`color expected, ${u} found`)]:null===pu.parseCSSColor(l)?[new Ge(i,l,`color expected, "${l}" found`)]:[]},constants:$t,enum:Qa,filter:vc,function:Sh,layer:wo,object:Ni,source:cf,light:_s,terrain:Od,fog:xc,string:El,formatted:function(a){return 0===El(a).length?[]:ba(a)},resolvedImage:function(a){return 0===El(a).length?[]:ba(a)}};function Co(a){const i=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Id(tn(i))?Sh(a):l.expression&&Zr(Yn(i))?ba(a):l.type&&nn[l.type]?nn[l.type](a):Ni(pn({},a,{valueSpec:l.type?u[l.type]:l}))}function Ld(a){const i=a.value,l=a.key,u=El(a);return u.length||(-1===i.indexOf("{fontstack}")&&u.push(new Ge(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&u.push(new Ge(l,i,'"glyphs" url must include a "{range}" token'))),u}function wa(a,i=Ce){let l=[];return l=l.concat(Co({key:"",value:a,valueSpec:i.$root,styleSpec:i,style:a,objectElementValidators:{glyphs:Ld,"*":()=>[]}})),a.constants&&(l=l.concat($t({key:"constants",value:a.constants,style:a,styleSpec:i}))),Bd(l)}function Bd(a){return[].concat(a).sort((i,l)=>i.line-l.line)}function Zs(a){return function(...i){return Bd(a.apply(this,i))}}wa.source=Zs(cf),wa.light=Zs(_s),wa.terrain=Zs(Od),wa.fog=Zs(xc),wa.layer=Zs(wo),wa.filter=Zs(vc),wa.paintProperty=Zs(Qi),wa.layoutProperty=Zs(qs);const bc=wa,Nd=bc.light,at=bc.fog,qn=bc.paintProperty,Dl=bc.layoutProperty;function ii(a,i){let l=!1;if(i&&i.length)for(const u of i)a.fire(new Xe(new Error(u.message))),l=!0;return l}var wc=Xi;function Xi(a,i,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(i=f[1])+2*(l=f[2]);for(var x=0;x<this.d*this.d;x++){var b=f[3+x],M=f[3+x+1];u.push(b===M?null:f.subarray(b,M))}var P=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],P),this.bboxes=f.subarray(P),this.insert=this._insertReadonly}else{this.d=i+2*l;for(var F=0;F<this.d*this.d;F++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=a,this.padding=l,this.scale=i/a,this.uid=0;var N=l/i*a;this.min=-N,this.max=a+N}Xi.prototype.insert=function(a,i,l,u,f){this._forEachCell(i,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},Xi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xi.prototype._insertCell=function(a,i,l,u,f,x){this.cells[f].push(x)},Xi.prototype.query=function(a,i,l,u,f){var x=this.min,b=this.max;if(a<=x&&i<=x&&b<=l&&b<=u&&!f)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,i,l,u,this._queryCell,M,{},f),M},Xi.prototype._queryCell=function(a,i,l,u,f,x,b,M){var P=this.cells[f];if(null!==P)for(var F=this.keys,N=this.bboxes,V=0;V<P.length;V++){var j=P[V];if(void 0===b[j]){var q=4*j;(M?M(N[q+0],N[q+1],N[q+2],N[q+3]):a<=N[q+2]&&i<=N[q+3]&&l>=N[q+0]&&u>=N[q+1])?(b[j]=!0,x.push(F[j])):b[j]=!1}}},Xi.prototype._forEachCell=function(a,i,l,u,f,x,b,M){for(var P=this._convertToCellCoord(a),F=this._convertToCellCoord(i),N=this._convertToCellCoord(l),V=this._convertToCellCoord(u),j=P;j<=N;j++)for(var q=F;q<=V;q++){var re=this.d*q+j;if((!M||M(this._convertFromCellCoord(j),this._convertFromCellCoord(q),this._convertFromCellCoord(j+1),this._convertFromCellCoord(q+1)))&&f.call(this,a,i,l,u,re,x,b,M))return}},Xi.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Xi.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Xi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,i=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(i+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var x=i,b=0;b<a.length;b++){var M=a[b];f[3+b]=x,f.set(M,x),x+=M.length}return f[3+a.length]=x,f.set(this.keys,x),f[3+a.length+1]=x+=this.keys.length,f.set(this.bboxes,x),x+=this.bboxes.length,f.buffer};const{ImageData:ys,ImageBitmap:Ih}=Ct,Sl={};function Pt(a,i,l={}){Object.defineProperty(i,"_classRegistryKey",{value:a,writeable:!1}),Sl[a]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Pt("Object",Object),wc.serialize=function(a,i){const l=a.toArrayBuffer();return i&&i.push(l),{buffer:l}},wc.deserialize=function(a){return new wc(a.buffer)},Pt("Grid",wc),Pt("Color",ln),Pt("Error",Error),Pt("ResolvedImage",Po),Pt("StylePropertyFunction",Eu),Pt("StyleExpression",Ch,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",Wa),Pt("ZoomConstantExpression",Eh),Pt("CompoundExpression",Ho,{omit:["_evaluate"]});for(const a in pc)pc[a]._classRegistryKey||Pt(`Expression_${a}`,pc[a]);function zd(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Tu(a){return Ih&&a instanceof Ih}function Ya(a,i){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(zd(a)||Tu(a))return i&&i.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return i&&i.push(l.buffer),l}if(a instanceof ys)return i&&i.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(Ya(u,i));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");const f=l.serialize?l.serialize(a,i):{};if(!l.serialize){for(const x in a){if(!a.hasOwnProperty(x)||Sl[u].omit.indexOf(x)>=0)continue;const b=a[x];f[x]=Sl[u].shallow.indexOf(x)>=0?b:Ya(b,i)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function _i(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||zd(a)||Tu(a)||ArrayBuffer.isView(a)||a instanceof ys)return a;if(Array.isArray(a))return a.map(_i);if("object"==typeof a){const i=a.$name||"Object",{klass:l}=Sl[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a)){if("$name"===f)continue;const x=a[f];u[f]=Sl[i].shallow.indexOf(f)>=0?x:_i(x)}return u}throw new Error("can't deserialize object of type "+typeof a)}class vs{constructor(){this.first=!0}update(i,l){const u=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=u,!0))}}const Vd=a=>a>=1536&&a<=1791,Ml=a=>a>=1872&&a<=1919,Ws=a=>a>=2208&&a<=2303,Iu=a=>a>=11904&&a<=12031,Ud=a=>a>=12032&&a<=12255,uf=a=>a>=12272&&a<=12287,Tl=a=>a>=12288&&a<=12351,ku=a=>a>=12352&&a<=12447,Cc=a=>a>=12448&&a<=12543,kh=a=>a>=12544&&a<=12591,Pu=a=>a>=12704&&a<=12735,jd=a=>a>=12736&&a<=12783,Ph=a=>a>=12784&&a<=12799,Il=a=>a>=12800&&a<=13055,Ru=a=>a>=13056&&a<=13311,$d=a=>a>=13312&&a<=19903,Rh=a=>a>=19968&&a<=40959,Ec=a=>a>=40960&&a<=42127,Fu=a=>a>=42128&&a<=42191,kl=a=>a>=44032&&a<=55215,hf=a=>a>=63744&&a<=64255,yi=a=>a>=64336&&a<=65023,Ca=a=>a>=65040&&a<=65055,Br=a=>a>=65072&&a<=65103,df=a=>a>=65104&&a<=65135,Ka=a=>a>=65136&&a<=65279,Dc=a=>a>=65280&&a<=65519;function Pl(a){for(const i of a)if(Qs(i.charCodeAt(0)))return!0;return!1}function sm(a){for(const i of a)if(!Af(i.charCodeAt(0)))return!1;return!0}function Af(a){return!(Vd(a)||Ml(a)||Ws(a)||yi(a)||Ka(a))}function Qs(a){return!(746!==a&&747!==a&&(a<4352||!(Pu(a)||kh(a)||Br(a)&&!(a>=65097&&a<=65103)||hf(a)||Ru(a)||Iu(a)||jd(a)||!(!Tl(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||$d(a)||Rh(a)||Il(a)||(i=a,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(a)||(i=>i>=55216&&i<=55295)(a)||(i=>i>=4352&&i<=4607)(a)||kl(a)||ku(a)||uf(a)||(i=>i>=12688&&i<=12703)(a)||Ud(a)||Ph(a)||Cc(a)&&12540!==a||!(!Dc(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!df(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(i=>i>=5120&&i<=5759)(a)||(i=>i>=6320&&i<=6399)(a)||Ca(a)||(i=>i>=19904&&i<=19967)(a)||Ec(a)||Fu(a))));var i}function Ou(a){return!(Qs(a)||(i=a,(l=i)>=128&&l<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(l=>l>=8192&&l<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(l=>l>=8448&&l<=8527)(i)||(l=>l>=8528&&l<=8591)(i)||(l=>l>=8960&&l<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(l=>l>=9216&&l<=9279)(i)&&9251!==i||(l=>l>=9280&&l<=9311)(i)||(l=>l>=9312&&l<=9471)(i)||(l=>l>=9632&&l<=9727)(i)||(l=>l>=9728&&l<=9983)(i)&&!(i>=9754&&i<=9759)||(l=>l>=11008&&l<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Tl(i)||Cc(i)||(l=>l>=57344&&l<=63743)(i)||Br(i)||df(i)||Dc(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,l}function Lu(a){return a>=1424&&a<=2303||yi(a)||Ka(a)}function Sc(a,i){return!(!i&&Lu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function _(a){for(const i of a)if(Lu(i.charCodeAt(0)))return!0;return!1}const o="deferred",h="loading",v="loaded";let E=null,D="unavailable",R=null;const B=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(D="error"),E&&E(a)};function z(){G.fire(new ft("pluginStateChange",{pluginStatus:D,pluginURL:R}))}const G=new jt,H=function(){return D},Q=function(){if(D!==o||!R)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");D=h,z(),R&&Z({url:R},a=>{a?B(a):(D=v,z())})},J={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>D===v||null!=J.applyArabicShaping,isLoading:()=>D===h,setState(a){D=a.pluginStatus,R=a.pluginURL},isParsed:()=>null!=J.applyArabicShaping&&null!=J.processBidirectionalText&&null!=J.processStyledBidirectionalText,getPluginURL:()=>R};class te{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vs,this.transition={})}isSupportedScript(i){return function(l,u){for(const f of l)if(!Sc(f.charCodeAt(0),u))return!1;return!0}(i,J.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),u=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*l}}}class le{constructor(i,l){this.property=i,this.value=l,this.expression=function(u,f){if(Id(u))return new Eu(u,f);if(Zr(u)){const x=Dh(u,f);if("error"===x.result)throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=u;return"string"==typeof u&&"color"===f.type&&(x=ln.parse(u)),{kind:"constant",evaluate:()=>x}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,u){return this.property.possiblyEvaluate(this,i,l,u)}}class ce{constructor(i){this.property=i,this.value=new le(i,void 0)}transitioned(i,l){return new se(this.property,this.value,l,ci({},i.transition,this.transition),i.now)}untransitioned(){return new se(this.property,this.value,null,{},0)}}class _e{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return kr(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ce(this._values[i].property)),this._values[i].value=new le(this._values[i].property,null===l?void 0:kr(l))}getTransition(i){return kr(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ce(this._values[i].property)),this._values[i].transition=kr(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(i[l]=u);const f=this.getTransition(l);void 0!==f&&(i[`${l}-transition`]=f)}return i}transitioned(i,l){const u=new ue(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(i,l._values[f]);return u}untransitioned(){const i=new ue(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class se{constructor(i,l,u,f,x){const b=f.delay||0,M=f.duration||0;x=x||0,this.property=i,this.value=l,this.begin=x+b,this.end=this.begin+M,i.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(i,l,u){const f=i.now||0,x=this.value.possiblyEvaluate(i,l,u),b=this.prior;if(b){if(f>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(f<this.begin)return b.possiblyEvaluate(i,l,u);{const M=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(i,l,u),x,su(M))}}return x}}class ue{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,u){const f=new Se(this._properties);for(const x of Object.keys(this._values))f._values[x]=this._values[x].possiblyEvaluate(i,l,u);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ge{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return kr(this._values[i].value)}setValue(i,l){this._values[i]=new le(this._values[i].property,null===l?void 0:kr(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(i[l]=u)}return i}possiblyEvaluate(i,l,u){const f=new Se(this._properties);for(const x of Object.keys(this._values))f._values[x]=this._values[x].possiblyEvaluate(i,l,u);return f}}class ve{constructor(i,l,u){this.property=i,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,u,f){return this.property.evaluate(this.value,this.parameters,i,l,u,f)}}class Se{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class de{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,u){const f=xn[this.specification.type];return f?f(i,l,u):i}}class Fe{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,u,f){return new ve(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},u,f)}:i.expression,l)}interpolate(i,l,u){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new ve(this,{kind:"constant",value:void 0},i.parameters);const f=xn[this.specification.type];return f?new ve(this,{kind:"constant",value:f(i.value.value,l.value.value,u)},i.parameters):i}evaluate(i,l,u,f,x,b){return"constant"===i.kind?i.value:i.evaluate(l,u,f,x,b)}}class We extends Fe{possiblyEvaluate(i,l,u,f){if(void 0===i.value)return new ve(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const x=i.expression.evaluate(l,null,{},u,f),b="resolvedImage"===i.property.specification.type&&"string"!=typeof x?x.name:x,M=this._calculate(b,b,b,l);return new ve(this,{kind:"constant",value:M},l)}if("camera"===i.expression.kind){const x=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new ve(this,{kind:"constant",value:x},l)}return new ve(this,i.expression,l)}evaluate(i,l,u,f,x,b){if("source"===i.kind){const M=i.evaluate(l,u,f,x,b);return this._calculate(M,M,M,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},u,f),i.evaluate({zoom:Math.floor(l.zoom)},u,f),i.evaluate({zoom:Math.floor(l.zoom)+1},u,f),l):i.value}_calculate(i,l,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l,other:u}:{from:u,to:l,other:i}}interpolate(i){return i}}class tt{constructor(i){this.specification=i}possiblyEvaluate(i,l,u,f){if(void 0!==i.value){if("constant"===i.expression.kind){const x=i.expression.evaluate(l,null,{},u,f);return this._calculate(x,x,x,l)}return this._calculate(i.expression.evaluate(new te(Math.floor(l.zoom-1),l)),i.expression.evaluate(new te(Math.floor(l.zoom),l)),i.expression.evaluate(new te(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:u,to:l}}interpolate(i){return i}}class Pe{constructor(i){this.specification=i}possiblyEvaluate(i,l,u,f){return!!i.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class $e{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const u=i[l];u.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new le(u,void 0),x=this.defaultTransitionablePropertyValues[l]=new ce(u);this.defaultTransitioningPropertyValues[l]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate({})}}}function xt(a,i){return 256*(a=li(Math.floor(a),0,255))+li(Math.floor(i),0,255)}Pt("DataDrivenProperty",Fe),Pt("DataConstantProperty",de),Pt("CrossFadedDataDrivenProperty",We),Pt("CrossFadedProperty",tt),Pt("ColorRampProperty",Pe);const Dt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Et{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ht{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mt(a,i=1){let l=0,u=0;return{members:a.map(f=>{const x=Dt[f.type].BYTES_PER_ELEMENT,b=l=bn(l,Math.max(i,x)),M=f.components||1;return u=Math.max(u,x),l+=x*M,{name:f.name,type:f.type,components:M,offset:b}}),size:bn(l,Math.max(u,i)),alignment:i}}function bn(a,i){return Math.ceil(a/i)*i}class Yt extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const u=this.length;return this.resize(u+1),this.emplace(u,i,l)}emplace(i,l,u){const f=2*i;return this.int16[f+0]=l,this.int16[f+1]=u,i}}Yt.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",Yt);class Nr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=4*i;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,this.int16[b+3]=x,i}}Nr.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",Nr);class xr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,l,u,f,x,b,M)}emplace(i,l,u,f,x,b,M,P){const F=6*i,N=12*i,V=3*i;return this.int16[F+0]=l,this.int16[F+1]=u,this.uint8[N+4]=f,this.uint8[N+5]=x,this.uint8[N+6]=b,this.uint8[N+7]=M,this.float32[V+2]=P,i}}xr.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4ub1f12",xr);class an extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,u)}emplace(i,l,u,f){const x=3*i;return this.float32[x+0]=l,this.float32[x+1]=u,this.float32[x+2]=f,i}}an.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",an);class wn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N){const V=this.length;return this.resize(V+1),this.emplace(V,i,l,u,f,x,b,M,P,F,N)}emplace(i,l,u,f,x,b,M,P,F,N,V){const j=10*i;return this.uint16[j+0]=l,this.uint16[j+1]=u,this.uint16[j+2]=f,this.uint16[j+3]=x,this.uint16[j+4]=b,this.uint16[j+5]=M,this.uint16[j+6]=P,this.uint16[j+7]=F,this.uint16[j+8]=N,this.uint16[j+9]=V,i}}wn.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",wn);class Rr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P){const F=this.length;return this.resize(F+1),this.emplace(F,i,l,u,f,x,b,M,P)}emplace(i,l,u,f,x,b,M,P,F){const N=8*i;return this.uint16[N+0]=l,this.uint16[N+1]=u,this.uint16[N+2]=f,this.uint16[N+3]=x,this.uint16[N+4]=b,this.uint16[N+5]=M,this.uint16[N+6]=P,this.uint16[N+7]=F,i}}Rr.prototype.bytesPerElement=16,Pt("StructArrayLayout8ui16",Rr);class Ao extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae){const xe=this.length;return this.resize(xe+1),this.emplace(xe,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe){const Me=16*i;return this.int16[Me+0]=l,this.int16[Me+1]=u,this.int16[Me+2]=f,this.int16[Me+3]=x,this.uint16[Me+4]=b,this.uint16[Me+5]=M,this.uint16[Me+6]=P,this.uint16[Me+7]=F,this.int16[Me+8]=N,this.int16[Me+9]=V,this.int16[Me+10]=j,this.int16[Me+11]=q,this.int16[Me+12]=re,this.int16[Me+13]=oe,this.int16[Me+14]=Ae,this.int16[Me+15]=xe,i}}Ao.prototype.bytesPerElement=32,Pt("StructArrayLayout4i4ui4i4i32",Ao);class Eo extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Eo.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",Eo);class Yi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q){const re=this.length;return this.resize(re+1),this.emplace(re,i,l,u,f,x,b,M,P,F,N,V,j,q)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re){const oe=20*i,Ae=10*i;return this.int16[oe+0]=l,this.int16[oe+1]=u,this.int16[oe+2]=f,this.int16[oe+3]=x,this.int16[oe+4]=b,this.float32[Ae+3]=M,this.float32[Ae+4]=P,this.float32[Ae+5]=F,this.float32[Ae+6]=N,this.int16[oe+14]=V,this.uint32[Ae+8]=j,this.uint16[oe+18]=q,this.uint16[oe+19]=re,i}}Yi.prototype.bytesPerElement=40,Pt("StructArrayLayout5i4f1i1ul2ui40",Yi);class fo extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,l,u,f,x,b,M)}emplace(i,l,u,f,x,b,M,P){const F=8*i;return this.int16[F+0]=l,this.int16[F+1]=u,this.int16[F+2]=f,this.int16[F+4]=x,this.int16[F+5]=b,this.int16[F+6]=M,this.int16[F+7]=P,i}}fo.prototype.bytesPerElement=16,Pt("StructArrayLayout3i2i2i16",fo);class xs extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,u,f,x)}emplace(i,l,u,f,x,b){const M=4*i,P=8*i;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=f,this.int16[P+6]=x,this.int16[P+7]=b,i}}xs.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",xs);class Do extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=12*i,M=3*i;return this.uint8[b+0]=l,this.uint8[b+1]=u,this.float32[M+1]=f,this.float32[M+2]=x,i}}Do.prototype.bytesPerElement=12,Pt("StructArrayLayout2ub2f12",Do);class Tn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,u)}emplace(i,l,u,f){const x=3*i;return this.uint16[x+0]=l,this.uint16[x+1]=u,this.uint16[x+2]=f,i}}Tn.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",Tn);class Cr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue){const Ze=30*i,it=15*i,dt=60*i;return this.int16[Ze+0]=l,this.int16[Ze+1]=u,this.int16[Ze+2]=f,this.float32[it+2]=x,this.float32[it+3]=b,this.uint16[Ze+8]=M,this.uint16[Ze+9]=P,this.uint32[it+5]=F,this.uint32[it+6]=N,this.uint32[it+7]=V,this.uint16[Ze+16]=j,this.uint16[Ze+17]=q,this.uint16[Ze+18]=re,this.float32[it+10]=oe,this.float32[it+11]=Ae,this.uint8[dt+48]=xe,this.uint8[dt+49]=Me,this.uint8[dt+50]=Le,this.uint32[it+13]=Be,this.int16[Ze+28]=Ne,this.uint8[dt+58]=Ue,i}}Cr.prototype.bytesPerElement=60,Pt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Cr);class Nn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue,Ze,it,dt,pt,et,rt,_t,nt){const Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue,Ze,it,dt,pt,et,rt,_t,nt)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue,Ze,it,dt,pt,et,rt,_t,nt,Qt){const St=38*i,Jn=19*i;return this.int16[St+0]=l,this.int16[St+1]=u,this.int16[St+2]=f,this.float32[Jn+2]=x,this.float32[Jn+3]=b,this.int16[St+8]=M,this.int16[St+9]=P,this.int16[St+10]=F,this.int16[St+11]=N,this.int16[St+12]=V,this.int16[St+13]=j,this.uint16[St+14]=q,this.uint16[St+15]=re,this.uint16[St+16]=oe,this.uint16[St+17]=Ae,this.uint16[St+18]=xe,this.uint16[St+19]=Me,this.uint16[St+20]=Le,this.uint16[St+21]=Be,this.uint16[St+22]=Ne,this.uint16[St+23]=Ue,this.uint16[St+24]=Ze,this.uint16[St+25]=it,this.uint16[St+26]=dt,this.uint16[St+27]=pt,this.uint16[St+28]=et,this.uint32[Jn+15]=rt,this.float32[Jn+16]=_t,this.float32[Jn+17]=nt,this.float32[Jn+18]=Qt,i}}Nn.prototype.bytesPerElement=76,Pt("StructArrayLayout3i2f6i15ui1ul3f76",Nn);class yr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}yr.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",yr);class vi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,u)}emplace(i,l,u,f){const x=3*i;return this.int16[x+0]=l,this.int16[x+1]=u,this.int16[x+2]=f,i}}vi.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",vi);class rr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=6*i;return this.uint32[3*i+0]=l,this.uint16[b+2]=u,this.uint16[b+3]=f,this.uint16[b+4]=x,i}}rr.prototype.bytesPerElement=12,Pt("StructArrayLayout1ul3ui12",rr);class oi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const u=this.length;return this.resize(u+1),this.emplace(u,i,l)}emplace(i,l,u){const f=2*i;return this.uint16[f+0]=l,this.uint16[f+1]=u,i}}oi.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",oi);class So extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}So.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",So);class Ki extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,u,f,x)}emplace(i,l,u,f,x,b){const M=5*i;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=f,this.float32[M+3]=x,this.float32[M+4]=b,i}}Ki.prototype.bytesPerElement=20,Pt("StructArrayLayout5f20",Ki);class Gd extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const u=this.length;return this.resize(u+1),this.emplace(u,i,l)}emplace(i,l,u){const f=2*i;return this.float32[f+0]=l,this.float32[f+1]=u,i}}Gd.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",Gd);class ff extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=4*i;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,this.float32[b+3]=x,i}}ff.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",ff);class Fh extends Et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fh.prototype.size=40;class Mc extends Yi{get(i){return new Fh(this,i)}}Pt("CollisionBoxArray",Mc);class pf extends Et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}pf.prototype.size=60;class rn extends Cr{get(i){return new pf(this,i)}}Pt("PlacedSymbolArray",rn);class Oh extends Et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Oh.prototype.size=76;class am extends Nn{get(i){return new Oh(this,i)}}Pt("SymbolInstanceArray",am);class pv extends yr{getoffsetX(i){return this.float32[1*i+0]}}Pt("GlyphOffsetArray",pv);class mv extends vi{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Pt("SymbolLineVertexArray",mv);class gv extends Et{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gv.prototype.size=12;class _v extends rr{get(i){return new gv(this,i)}}Pt("FeatureIndexArray",_v);class yv extends Et{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}yv.prototype.size=4;class vv extends oi{get(i){return new yv(this,i)}}Pt("FillExtrusionCentroidArray",vv);const jw=Mt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),$w=Mt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var xv=Go(function(a){a.exports=function(i,l){var u,f,x,b,M,P,F,N;for(f=i.length-(u=3&i.length),x=l,M=3432918353,P=461845907,N=0;N<f;)F=255&i.charCodeAt(N)|(255&i.charCodeAt(++N))<<8|(255&i.charCodeAt(++N))<<16|(255&i.charCodeAt(++N))<<24,++N,x=27492+(65535&(b=5*(65535&(x=(x^=F=(65535&(F=(F=(65535&F)*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*P+(((F>>>16)*P&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(F=0,u){case 3:F^=(255&i.charCodeAt(N+2))<<16;case 2:F^=(255&i.charCodeAt(N+1))<<8;case 1:x^=F=(65535&(F=(F=(65535&(F^=255&i.charCodeAt(N)))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*P+(((F>>>16)*P&65535)<<16)&4294967295}return x^=i.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Hd=Go(function(a){a.exports=function(i,l){for(var u,f=i.length,x=l^f,b=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24))+((1540483477*(u>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:x^=(255&i.charCodeAt(b+2))<<16;case 2:x^=(255&i.charCodeAt(b+1))<<8;case 1:x=1540483477*(65535&(x^=255&i.charCodeAt(b)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),mf=xv,zi=Hd;mf.murmur3=xv,mf.murmur2=zi;class Bu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,u,f){this.ids.push(qd(i)),this.positions.push(l,u,f)}getPositions(i){const l=qd(i);let u=0,f=this.ids.length-1;for(;u<f;){const b=u+f>>1;this.ids[b]>=l?f=b:u=b+1}const x=[];for(;this.ids[u]===l;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x}static serialize(i,l){const u=new Float64Array(i.ids),f=new Uint32Array(i.positions);return w0(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(i){const l=new Bu;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function qd(a){const i=+a;return!isNaN(i)&&i<=hs?i:mf(String(a))}function w0(a,i,l,u){for(;l<u;){const f=a[l+u>>1];let x=l-1,b=u+1;for(;;){do{x++}while(a[x]<f);do{b--}while(a[b]>f);if(x>=b)break;gf(a,x,b),gf(i,3*x,3*b),gf(i,3*x+1,3*b+1),gf(i,3*x+2,3*b+2)}b-l<u-b?(w0(a,i,l,b),l=b+1):(w0(a,i,b+1,u),u=b)}}function gf(a,i,l){const u=a[i];a[i]=a[l],a[l]=u}Pt("FeaturePositionMap",Bu);class Vi{constructor(i,l){this.gl=i.gl,this.location=l}}class bs extends Vi{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Zd extends Vi{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Tc extends Vi{constructor(i,l){super(i,l),this.current=ln.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Ic=new Float32Array(16),C0=new Float32Array(9);function lm(a){return[xt(255*a.r,255*a.g),xt(255*a.b,255*a.a)]}class Wd{constructor(i,l,u){this.value=i,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(i,l,u){i.set(u.constantOr(this.value))}getBinding(i,l,u){return"color"===this.type?new Tc(i,l):new bs(i,l)}}class Qd{constructor(i,l){this.uniformNames=l.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tl.concat(l.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,l,u,f){const x="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;x&&i.set(x)}getBinding(i,l,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new Zd(i,l):new bs(i,l)}}class kc{constructor(i,l,u,f){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,l,u,f,x){const b=this.paintVertexArray.length,M=this.expression.evaluate(new te(0),l,{},f,[],x);this.paintVertexArray.resize(i),this._setPaintValue(b,i,M)}updatePaintArray(i,l,u,f){const x=this.expression.evaluate({zoom:0},u,f);this._setPaintValue(i,l,x)}_setPaintValue(i,l,u){if("color"===this.type){const f=lm(u);for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,f[0],f[1])}else{for(let f=i;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xs{constructor(i,l,u,f,x,b){this.expression=i,this.uniformNames=l.map(M=>`u_${M}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(i,l,u,f,x){const b=this.expression.evaluate(new te(this.zoom),l,{},f,[],x),M=this.expression.evaluate(new te(this.zoom+1),l,{},f,[],x),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,b,M)}updatePaintArray(i,l,u,f){const x=this.expression.evaluate({zoom:this.zoom},u,f),b=this.expression.evaluate({zoom:this.zoom+1},u,f);this._setPaintValue(i,l,x,b)}_setPaintValue(i,l,u,f){if("color"===this.type){const x=lm(u),b=lm(f);for(let M=i;M<l;M++)this.paintVertexArray.emplace(M,x[0],x[1],b[0],b[1])}else{for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const u=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,f=li(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(f)}getBinding(i,l,u){return new bs(i,l)}}class Ti{constructor(i,l,u,f,x,b,M){this.expression=i,this.type=u,this.useIntegerZoom=f,this.zoom=x,this.layerId=M,this.paintVertexAttributes=("array"===u?$w:jw).members;for(let P=0;P<l.length;++P);this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,l,u){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(f,i,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(i,l,u,f,x){this._setPaintValues(i,l,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(i,l,u,f){if(!f||!u)return;const{min:x,mid:b,max:M}=u,P=f[x],F=f[b],N=f[M];if(P&&F&&N)for(let V=i;V<l;V++)this._setPaintValue(this.zoomInPaintVertexArray,V,F,P),this._setPaintValue(this.zoomOutPaintVertexArray,V,F,N)}_setPaintValue(i,l,u,f){i.emplace(l,u.tl[0],u.tl[1],u.br[0],u.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],u.pixelRatio,f.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ea{constructor(i,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const x in i.paint._values){if(!u(x))continue;const b=i.paint.get(x);if(!(b instanceof ve&&_c(b.property.specification)))continue;const M=E0(x,i.type),P=b.value,F=b.property.specification.type,N=b.property.useIntegerZoom,V=b.property.specification["property-type"],j="cross-faded"===V||"cross-faded-data-driven"===V,q="line-dasharray"===String(x)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==P.kind||q)if("source"===P.kind||q||j){const re=D0(x,F,"source");this.binders[x]=j?new Ti(P,M,F,N,l,re,i.id):new kc(P,M,F,re),f.push(`/a_${x}`)}else{const re=D0(x,F,"composite");this.binders[x]=new Xs(P,M,F,N,l,re),f.push(`/z_${x}`)}else this.binders[x]=j?new Qd(P.value,M):new Wd(P.value,M,F),f.push(`/u_${x}`)}this.cacheKey=f.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof kc||l instanceof Xs?l.maxValue:0}populatePaintArrays(i,l,u,f,x){for(const b in this.binders){const M=this.binders[b];(M instanceof kc||M instanceof Xs||M instanceof Ti)&&M.populatePaintArray(i,l,u,f,x)}}setConstantPatternPositions(i,l){for(const u in this.binders){const f=this.binders[u];f instanceof Qd&&f.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,u,f,x){let b=!1;for(const M in i){const P=l.getPositions(M);for(const F of P){const N=u.feature(F.index);for(const V in this.binders){const j=this.binders[V];if((j instanceof kc||j instanceof Xs||j instanceof Ti)&&!0===j.expression.isStateDependent){const q=f.paint.get(V);j.expression=q.value,j.updatePaintArray(F.start,F.end,N,i[M],x),b=!0}}}}return b}defines(){const i=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Wd||u instanceof Qd)&&i.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof kc||u instanceof Xs||u instanceof Ti)for(let f=0;f<u.paintVertexAttributes.length;f++)i.push(u.paintVertexAttributes[f].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Wd||u instanceof Qd||u instanceof Xs)for(const f of u.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const u=[];for(const f in this.binders){const x=this.binders[f];if(x instanceof Wd||x instanceof Qd||x instanceof Xs)for(const b of x.uniformNames)if(l[b]){const M=x.getBinding(i,l[b],b);u.push({name:b,property:f,binding:M})}}return u}setUniforms(i,l,u,f){for(const{name:x,property:b,binding:M}of l)this.binders[b].setUniform(M,f,u.get(b),x)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const u=this.binders[l];if(i&&u instanceof Ti){const f=2===i.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(u instanceof kc||u instanceof Xs)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(i){for(const l in this.binders){const u=this.binders[l];(u instanceof kc||u instanceof Xs||u instanceof Ti)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof kc||l instanceof Xs||l instanceof Ti)&&l.destroy()}}}class Ys{constructor(i,l,u=(()=>!0)){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new Ea(f,l,u);this.needsUpload=!1,this._featureMap=new Bu,this._bufferOffset=0}populatePaintArrays(i,l,u,f,x,b){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,l,f,x,b);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,u,f){for(const x of u)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(i,this._featureMap,l,x,f)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Gw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function E0(a,i){return Gw[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}const bv={"line-pattern":{source:wn,composite:wn},"fill-pattern":{source:wn,composite:wn},"fill-extrusion-pattern":{source:wn,composite:wn},"line-dasharray":{source:Rr,composite:Rr}},wv={color:{source:Gd,composite:ff},number:{source:yr,composite:Gd}};function D0(a,i,l){const u=bv[a];return u&&u[l]||wv[i][l]}Pt("ConstantBinder",Wd),Pt("CrossFadedConstantBinder",Qd),Pt("SourceExpressionBinder",kc),Pt("CrossFadedCompositeBinder",Ti),Pt("CompositeExpressionBinder",Xs),Pt("ProgramConfiguration",Ea,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",Ys);const _f="-transition";class Da extends jt{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new ge(l.layout)),l.paint)){this._transitionablePaint=new _e(l.paint);for(const u in i.paint)this.setPaintProperty(u,i.paint[u],{validate:!1});for(const u in i.layout)this.setLayoutProperty(u,i.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Se(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,u={}){null!=l&&this._validate(Dl,`layers.${this.id}.layout.${i}`,i,l,u)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return As(i,_f)?this._transitionablePaint.getTransition(i.slice(0,-_f.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,u={}){if(null!=l&&this._validate(qn,`layers.${this.id}.paint.${i}`,i,l,u))return!1;if(As(i,_f))return this._transitionablePaint.setTransition(i.slice(0,-_f.length),l||void 0),!1;{const f=this._transitionablePaint._values[i],x="cross-faded-data-driven"===f.property.specification["property-type"],b=f.value.isDataDriven(),M=f.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(i,M,P)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,l,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Uo(i,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(i,l,u,f,x={}){return(!x||!1!==x.validate)&&ii(this,i.call(bc,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof ve&&_c(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const Xd=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:cm}=Xd;class Ii{constructor(i=[]){this.segments=i}prepareSegment(i,l,u,f){let x=this.segments[this.segments.length-1];return i>Ii.MAX_VERTEX_ARRAY_LENGTH&&Lr(`Max vertices per segment is ${Ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!x||x.vertexLength+i>Ii.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==f)&&(x={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(x.sortKey=f),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,u,f){return new Ii([{vertexOffset:i,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}Ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",Ii);var ar=8192;const Nu=Math.pow(2,14)-1,yf=-Nu-1;function Ks(a){const i=ar/a.extent,l=a.loadGeometry();for(let u=0;u<l.length;u++){const f=l[u];for(let x=0;x<f.length;x++){const b=f[x],M=Math.round(b.x*i),P=Math.round(b.y*i);b.x=li(M,yf,Nu),b.y=li(P,yf,Nu),(M<b.x||M>b.x+1||P<b.y||P>b.y+1)&&Lr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function zu(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?Ks(a):[]}}function vf(a,i,l,u,f){a.emplaceBack(2*i+(u+1)/2,2*l+(f+1)/2)}class um{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Yt,this.indexArray=new Tn,this.segments=new Ii,this.programConfigurations=new Ys(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,u){const f=this.layers[0],x=[];let b=null;"circle"===f.type&&(b=f.layout.get("circle-sort-key"));for(const{feature:M,id:P,index:F,sourceLayerIndex:N}of i){const V=this.layers[0]._featureFilter.needGeometry,j=zu(M,V);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),j,u))continue;const q=b?b.evaluate(j,{},u):void 0,re={id:P,properties:M.properties,type:M.type,sourceLayerIndex:N,index:F,geometry:V?j.geometry:Ks(M),patterns:{},sortKey:q};x.push(re)}b&&x.sort((M,P)=>M.sortKey-P.sortKey);for(const M of x){const{geometry:P,index:F,sourceLayerIndex:N}=M,V=i[F].feature;this.addFeature(M,P,F,u),l.featureIndex.insert(V,P,F,N,this.index)}}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,cm),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,u,f){for(const x of l)for(const b of x){const M=b.x,P=b.y;if(M<0||M>=ar||P<0||P>=ar)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),N=F.vertexLength;vf(this.layoutVertexArray,M,P,-1,-1),vf(this.layoutVertexArray,M,P,1,-1),vf(this.layoutVertexArray,M,P,1,1),vf(this.layoutVertexArray,M,P,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},f)}}function xf(a,i){for(let l=0;l<a.length;l++)if(Js(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(Js(a,i[l]))return!0;return!!Pc(a,i)}function Hw(a,i,l){return!!Js(a,i)||!!yt(i,a,l)}function bf(a,i){if(1===a.length)return Ev(i,a[0]);for(let l=0;l<i.length;l++){const u=i[l];for(let f=0;f<u.length;f++)if(Js(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(Ev(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(Pc(a,i[l]))return!0;return!1}function Yd(a,i,l){if(a.length>1){if(Pc(a,i))return!0;for(let u=0;u<i.length;u++)if(yt(i[u],a,l))return!0}for(let u=0;u<a.length;u++)if(yt(a[u],i,l))return!0;return!1}function Pc(a,i){if(0===a.length||0===i.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let x=0;x<i.length-1;x++)if(Cv(u,f,i[x],i[x+1]))return!0}return!1}function Cv(a,i,l,u){return fs(a,l,u)!==fs(i,l,u)&&fs(a,i,l)!==fs(a,i,u)}function yt(a,i,l){const u=l*l;if(1===i.length)return a.distSqr(i[0])<u;for(let f=1;f<i.length;f++)if(hm(a,i[f-1],i[f])<u)return!0;return!1}function hm(a,i,l){const u=i.distSqr(l);if(0===u)return a.distSqr(i);const f=((a.x-i.x)*(l.x-i.x)+(a.y-i.y)*(l.y-i.y))/u;return a.distSqr(f<0?i:f>1?l:l.sub(i)._mult(f)._add(i))}function Ev(a,i){let l,u,f,x=!1;for(let b=0;b<a.length;b++){l=a[b];for(let M=0,P=l.length-1;M<l.length;P=M++)u=l[M],f=l[P],u.y>i.y!=f.y>i.y&&i.x<(f.x-u.x)*(i.y-u.y)/(f.y-u.y)+u.x&&(x=!x)}return x}function Js(a,i){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const x=a[u],b=a[f];x.y>i.y!=b.y>i.y&&i.x<(b.x-x.x)*(i.y-x.y)/(b.y-x.y)+x.x&&(l=!l)}return l}function Lh(a,i,l,u,f){for(const b of a)if(i<=b.x&&l<=b.y&&u>=b.x&&f>=b.y)return!0;const x=[new ct(i,l),new ct(i,f),new ct(u,f),new ct(u,l)];if(a.length>2)for(const b of x)if(Js(a,b))return!0;for(let b=0;b<a.length-1;b++)if(Dv(a[b],a[b+1],x))return!0;return!1}function Dv(a,i,l){const u=l[0],f=l[2];if(a.x<u.x&&i.x<u.x||a.x>f.x&&i.x>f.x||a.y<u.y&&i.y<u.y||a.y>f.y&&i.y>f.y)return!1;const x=fs(a,i,l[0]);return x!==fs(a,i,l[1])||x!==fs(a,i,l[2])||x!==fs(a,i,l[3])}function Vu(a,i,l){const u=i.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(i.id).getMaxValue(a)}function Kd(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Sv(a,i,l,u,f){if(!i[0]&&!i[1])return a;const x=ct.convert(i)._mult(f);"viewport"===l&&x._rotate(-u);const b=[];for(let M=0;M<a.length;M++)b.push(a[M].sub(x));return b}function Uu(a,i,l,u){const f=ct.convert(a)._mult(u);return"viewport"===i&&f._rotate(-l),f}Pt("CircleBucket",um,{omit:["layers"]});const Ko=new $e({"circle-sort-key":new Fe(Ce.layout_circle["circle-sort-key"])});var wf={paint:new $e({"circle-radius":new Fe(Ce.paint_circle["circle-radius"]),"circle-color":new Fe(Ce.paint_circle["circle-color"]),"circle-blur":new Fe(Ce.paint_circle["circle-blur"]),"circle-opacity":new Fe(Ce.paint_circle["circle-opacity"]),"circle-translate":new de(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new de(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new de(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new de(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fe(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fe(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fe(Ce.paint_circle["circle-stroke-opacity"])}),layout:Ko},xi="undefined"!=typeof Float32Array?Float32Array:Array;function S0(){var a=new xi(9);return xi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Cf(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ef(a,i,l){var u=i[0],f=i[1],x=i[2],b=i[3],M=i[4],P=i[5],F=i[6],N=i[7],V=i[8],j=i[9],q=i[10],re=i[11],oe=i[12],Ae=i[13],xe=i[14],Me=i[15],Le=l[0],Be=l[1],Ne=l[2],Ue=l[3];return a[0]=Le*u+Be*M+Ne*V+Ue*oe,a[1]=Le*f+Be*P+Ne*j+Ue*Ae,a[2]=Le*x+Be*F+Ne*q+Ue*xe,a[3]=Le*b+Be*N+Ne*re+Ue*Me,a[4]=(Le=l[4])*u+(Be=l[5])*M+(Ne=l[6])*V+(Ue=l[7])*oe,a[5]=Le*f+Be*P+Ne*j+Ue*Ae,a[6]=Le*x+Be*F+Ne*q+Ue*xe,a[7]=Le*b+Be*N+Ne*re+Ue*Me,a[8]=(Le=l[8])*u+(Be=l[9])*M+(Ne=l[10])*V+(Ue=l[11])*oe,a[9]=Le*f+Be*P+Ne*j+Ue*Ae,a[10]=Le*x+Be*F+Ne*q+Ue*xe,a[11]=Le*b+Be*N+Ne*re+Ue*Me,a[12]=(Le=l[12])*u+(Be=l[13])*M+(Ne=l[14])*V+(Ue=l[15])*oe,a[13]=Le*f+Be*P+Ne*j+Ue*Ae,a[14]=Le*x+Be*F+Ne*q+Ue*xe,a[15]=Le*b+Be*N+Ne*re+Ue*Me,a}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var Df=Ef;function Jd(){var a=new xi(3);return xi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function M0(a){return Math.hypot(a[0],a[1],a[2])}function Bh(a,i,l){var u=new xi(3);return u[0]=a,u[1]=i,u[2]=l,u}function ju(a,i,l){return a[0]=i[0]-l[0],a[1]=i[1]-l[1],a[2]=i[2]-l[2],a}function Nh(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a}function T0(a,i,l,u){return a[0]=i[0]+l[0]*u,a[1]=i[1]+l[1]*u,a[2]=i[2]+l[2]*u,a}function Mv(a,i){var l=i[0],u=i[1],f=i[2],x=l*l+u*u+f*f;return x>0&&(x=1/Math.sqrt(x)),a[0]=i[0]*x,a[1]=i[1]*x,a[2]=i[2]*x,a}function dm(a,i,l){var u=l[0],f=l[1],x=l[2],b=i[0],M=i[1],P=i[2],F=f*P-x*M,N=x*b-u*P,V=u*M-f*b,j=f*V-x*N,q=x*F-u*V,re=u*N-f*F,oe=2*l[3];return N*=oe,V*=oe,q*=2,re*=2,a[0]=b+(F*=oe)+(j*=2),a[1]=M+N+q,a[2]=P+V+re,a}var eA,qw=ju,Tv=Nh,Iv=M0;function tA(a,i,l){var u=i[0],f=i[1],x=i[2],b=i[3];return a[0]=l[0]*u+l[4]*f+l[8]*x+l[12]*b,a[1]=l[1]*u+l[5]*f+l[9]*x+l[13]*b,a[2]=l[2]*u+l[6]*f+l[10]*x+l[14]*b,a[3]=l[3]*u+l[7]*f+l[11]*x+l[15]*b,a}function zh(){var a=new xi(4);return xi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Sf(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function $u(a,i,l){l*=.5;var u=i[0],f=i[1],x=i[2],b=i[3],M=Math.sin(l),P=Math.cos(l);return a[0]=u*P+b*M,a[1]=f*P+x*M,a[2]=x*P-f*M,a[3]=b*P-u*M,a}function I0(a,i,l,u,f,x,b,M,P){if(x&&a.queryGeometry.isAboveHorizon)return!1;x&&(P*=a.pixelToTileUnitsFactor);for(const F of i)for(const N of F){const V=N.add(M),j=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(V.x,V.y,!0):0,q=x?V:kv(V,j,u),re=x?a.tilespaceRays.map(Ae=>Am(Ae,j)):a.queryGeometry.screenGeometry,oe=tA([],[N.x,N.y,j,1],u);if(!b&&x?P*=oe[3]/l.cameraToCenterDistance:b&&!x&&(P*=l.cameraToCenterDistance/oe[3]),Hw(re,q,P))return!0}return!1}function kv(a,i,l){const u=tA([],[a.x,a.y,i,1],l);return new ct(u[0]/u[3],u[1]/u[3])}Jd(),eA=new xi(4),xi!=Float32Array&&(eA[0]=0,eA[1]=0,eA[2]=0,eA[3]=0),Jd(),Bh(1,0,0),Bh(0,1,0),zh(),zh(),S0();const Pv=Bh(0,0,0),Mf=Bh(0,0,1);function Am(a,i){const l=Jd();return Pv[2]=i,a.intersectsPlane(Pv,Mf,l),new ct(l[0],l[1])}class fm extends um{}function Tf(a,{width:i,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*l*u);return a.width=i,a.height=l,a.data=f,a}function pm(a,{width:i,height:l},u){if(i===a.width&&l===a.height)return;const f=Tf({},{width:i,height:l},u);Rl(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,i),height:Math.min(a.height,l)},u),a.width=i,a.height=l,a.data=f.data}function Rl(a,i,l,u,f,x){if(0===f.width||0===f.height)return i;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||u.x>i.width-f.width||u.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,M=i.data;for(let P=0;P<f.height;P++){const F=((l.y+P)*a.width+l.x)*x,N=((u.y+P)*i.width+u.x)*x;for(let V=0;V<f.width*x;V++)M[N+V]=b[F+V]}return i}Pt("HeatmapBucket",fm,{omit:["layers"]});class Rc{constructor(i,l){Tf(this,i,1,l)}resize(i){pm(this,i,1)}clone(){return new Rc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,u,f,x){Rl(i,l,u,f,x,1)}}class ws{constructor(i,l){Tf(this,i,4,l)}resize(i){pm(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,u,f,x){Rl(i,l,u,f,x,4)}}Pt("AlphaImage",Rc),Pt("RGBAImage",ws);var Rv={paint:new $e({"heatmap-radius":new Fe(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fe(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new de(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pe(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new de(Ce.paint_heatmap["heatmap-opacity"])})};function mm(a){const i={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new ws({width:l,height:u}),x=(b,M,P)=>{i[a.evaluationKey]=P;const F=a.expression.evaluate(i);f.data[b+M+0]=Math.floor(255*F.r/F.a),f.data[b+M+1]=Math.floor(255*F.g/F.a),f.data[b+M+2]=Math.floor(255*F.b/F.a),f.data[b+M+3]=Math.floor(255*F.a)};if(a.clips)for(let b=0,M=0;b<u;++b,M+=4*l)for(let P=0,F=0;P<l;P++,F+=4){const N=P/(l-1),{start:V,end:j}=a.clips[b];x(M,F,V*(1-N)+j*N)}else for(let b=0,M=0;b<l;b++,M+=4)x(0,M,b/(l-1));return f}var Fv={paint:new $e({"hillshade-illumination-direction":new de(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new de(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new de(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new de(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new de(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new de(Ce.paint_hillshade["hillshade-accent-color"])})};const Cs=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ja}=Cs;var If=kf,Ov=kf;function kf(a,i,l){l=l||2;var u,f,x,b,M,P,F,N=i&&i.length,V=N?i[0]*l:a.length,j=k0(a,0,V,l,!0),q=[];if(!j||j.next===j.prev)return q;if(N&&(j=function(oe,Ae,xe,Me){var Le,Be,Ne,Ue=[];for(Le=0,Be=Ae.length;Le<Be;Le++)(Ne=k0(oe,Ae[Le]*Me,Le<Be-1?Ae[Le+1]*Me:oe.length,Me,!1))===Ne.next&&(Ne.steiner=!0),Ue.push(R0(Ne));for(Ue.sort(zv),Le=0;Le<Ue.length;Le++)Zw(Ue[Le],xe),xe=Fc(xe,xe.next);return xe}(a,i,j,l)),a.length>80*l){u=x=a[0],f=b=a[1];for(var re=l;re<V;re+=l)(M=a[re])<u&&(u=M),(P=a[re+1])<f&&(f=P),M>x&&(x=M),P>b&&(b=P);F=0!==(F=Math.max(x-u,b-f))?1/F:0}return nA(j,q,l,u,f,F),q}function k0(a,i,l,u,f){var x,b;if(f===O0(a,i,l,u)>0)for(x=i;x<l;x+=u)b=Ff(x,a[x],a[x+1],b);else for(x=l-u;x>=i;x-=u)b=Ff(x,a[x],a[x+1],b);return b&&iA(b,b.next)&&(Hu(b),b=b.next),b}function Fc(a,i){if(!a)return a;i||(i=a);var l,u=a;do{if(l=!1,u.steiner||!iA(u,u.next)&&0!==Wr(u.prev,u,u.next))u=u.next;else{if(Hu(u),(u=i=u.prev)===u.next)break;l=!0}}while(l||u!==i);return i}function nA(a,i,l,u,f,x,b){if(a){!b&&x&&function(N,V,j,q){var re=N;do{null===re.z&&(re.z=Gu(re.x,re.y,V,j,q)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next}while(re!==N);re.prevZ.nextZ=null,re.prevZ=null,function(oe){var Ae,xe,Me,Le,Be,Ne,Ue,Ze,it=1;do{for(xe=oe,oe=null,Be=null,Ne=0;xe;){for(Ne++,Me=xe,Ue=0,Ae=0;Ae<it&&(Ue++,Me=Me.nextZ);Ae++);for(Ze=it;Ue>0||Ze>0&&Me;)0!==Ue&&(0===Ze||!Me||xe.z<=Me.z)?(Le=xe,xe=xe.nextZ,Ue--):(Le=Me,Me=Me.nextZ,Ze--),Be?Be.nextZ=Le:oe=Le,Le.prevZ=Be,Be=Le;xe=Me}Be.nextZ=null,it*=2}while(Ne>1)}(re)}(a,u,f,x);for(var M,P,F=a;a.prev!==a.next;)if(M=a.prev,P=a.next,x?Lv(a,u,f,x):P0(a))i.push(M.i/l),i.push(a.i/l),i.push(P.i/l),Hu(a),a=P.next,F=P.next;else if((a=P)===F){b?1===b?nA(a=Bv(Fc(a),i,l),i,l,u,f,x,2):2===b&&Nv(a,i,l,u,f,x):nA(Fc(a),i,l,u,f,x,1);break}}}function P0(a){var i=a.prev,l=a,u=a.next;if(Wr(i,l,u)>=0)return!1;for(var f=a.next.next;f!==a.prev;){if(Oo(i.x,i.y,l.x,l.y,u.x,u.y,f.x,f.y)&&Wr(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Lv(a,i,l,u){var f=a.prev,x=a,b=a.next;if(Wr(f,x,b)>=0)return!1;for(var M=f.x>x.x?f.x>b.x?f.x:b.x:x.x>b.x?x.x:b.x,P=f.y>x.y?f.y>b.y?f.y:b.y:x.y>b.y?x.y:b.y,F=Gu(f.x<x.x?f.x<b.x?f.x:b.x:x.x<b.x?x.x:b.x,f.y<x.y?f.y<b.y?f.y:b.y:x.y<b.y?x.y:b.y,i,l,u),N=Gu(M,P,i,l,u),V=a.prevZ,j=a.nextZ;V&&V.z>=F&&j&&j.z<=N;){if(V!==a.prev&&V!==a.next&&Oo(f.x,f.y,x.x,x.y,b.x,b.y,V.x,V.y)&&Wr(V.prev,V,V.next)>=0||(V=V.prevZ,j!==a.prev&&j!==a.next&&Oo(f.x,f.y,x.x,x.y,b.x,b.y,j.x,j.y)&&Wr(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;V&&V.z>=F;){if(V!==a.prev&&V!==a.next&&Oo(f.x,f.y,x.x,x.y,b.x,b.y,V.x,V.y)&&Wr(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;j&&j.z<=N;){if(j!==a.prev&&j!==a.next&&Oo(f.x,f.y,x.x,x.y,b.x,b.y,j.x,j.y)&&Wr(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function Bv(a,i,l){var u=a;do{var f=u.prev,x=u.next.next;!iA(f,x)&&gm(f,u,u.next,x)&&Pf(f,x)&&Pf(x,f)&&(i.push(f.i/l),i.push(u.i/l),i.push(x.i/l),Hu(u),Hu(u.next),u=a=x),u=u.next}while(u!==a);return Fc(u)}function Nv(a,i,l,u,f,x){var b=a;do{for(var M=b.next.next;M!==b.prev;){if(b.i!==M.i&&rA(b,M)){var P=Rf(b,M);return b=Fc(b,b.next),P=Fc(P,P.next),nA(b,i,l,u,f,x),void nA(P,i,l,u,f,x)}M=M.next}b=b.next}while(b!==a)}function zv(a,i){return a.x-i.x}function Zw(a,i){if(i=function(u,f){var x,b=f,M=u.x,P=u.y,F=-1/0;do{if(P<=b.y&&P>=b.next.y&&b.next.y!==b.y){var N=b.x+(P-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(N<=M&&N>F){if(F=N,N===M){if(P===b.y)return b;if(P===b.next.y)return b.next}x=b.x<b.next.x?b:b.next}}b=b.next}while(b!==f);if(!x)return null;if(M===F)return x;var V,j=x,q=x.x,re=x.y,oe=1/0;b=x;do{M>=b.x&&b.x>=q&&M!==b.x&&Oo(P<re?M:F,P,q,re,P<re?F:M,P,b.x,b.y)&&(V=Math.abs(P-b.y)/(M-b.x),Pf(b,u)&&(V<oe||V===oe&&(b.x>x.x||b.x===x.x&&Vv(x,b)))&&(x=b,oe=V)),b=b.next}while(b!==j);return x}(a,i)){var l=Rf(i,a);Fc(i,i.next),Fc(l,l.next)}}function Vv(a,i){return Wr(a.prev,a,i.prev)<0&&Wr(i.next,a,a.next)<0}function Gu(a,i,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*f)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-u)*f)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function R0(a){var i=a,l=a;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==a);return l}function Oo(a,i,l,u,f,x,b,M){return(f-b)*(i-M)-(a-b)*(x-M)>=0&&(a-b)*(u-M)-(l-b)*(i-M)>=0&&(l-b)*(x-M)-(f-b)*(u-M)>=0}function rA(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&gm(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,i)&&(Pf(a,i)&&Pf(i,a)&&function(l,u){var f=l,x=!1,b=(l.x+u.x)/2,M=(l.y+u.y)/2;do{f.y>M!=f.next.y>M&&f.next.y!==f.y&&b<(f.next.x-f.x)*(M-f.y)/(f.next.y-f.y)+f.x&&(x=!x),f=f.next}while(f!==l);return x}(a,i)&&(Wr(a.prev,a,i.prev)||Wr(a,i.prev,i))||iA(a,i)&&Wr(a.prev,a,a.next)>0&&Wr(i.prev,i,i.next)>0)}function Wr(a,i,l){return(i.y-a.y)*(l.x-i.x)-(i.x-a.x)*(l.y-i.y)}function iA(a,i){return a.x===i.x&&a.y===i.y}function gm(a,i,l,u){var f=ym(Wr(a,i,l)),x=ym(Wr(a,i,u)),b=ym(Wr(l,u,a)),M=ym(Wr(l,u,i));return f!==x&&b!==M||!(0!==f||!_m(a,l,i))||!(0!==x||!_m(a,u,i))||!(0!==b||!_m(l,a,u))||!(0!==M||!_m(l,i,u))}function _m(a,i,l){return i.x<=Math.max(a.x,l.x)&&i.x>=Math.min(a.x,l.x)&&i.y<=Math.max(a.y,l.y)&&i.y>=Math.min(a.y,l.y)}function ym(a){return a>0?1:a<0?-1:0}function Pf(a,i){return Wr(a.prev,a,a.next)<0?Wr(a,i,a.next)>=0&&Wr(a,a.prev,i)>=0:Wr(a,i,a.prev)<0||Wr(a,a.next,i)<0}function Rf(a,i){var l=new F0(a.i,a.x,a.y),u=new F0(i.i,i.x,i.y),f=a.next,x=i.prev;return a.next=i,i.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,x.next=u,u.prev=x,u}function Ff(a,i,l,u){var f=new F0(a,i,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Hu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function F0(a,i,l){this.i=a,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O0(a,i,l,u){for(var f=0,x=i,b=l-u;x<l;x+=u)f+=(a[b]-a[x])*(a[x+1]+a[b+1]),b=x;return f}function L0(a,i,l,u,f){B0(a,i,l||0,u||a.length-1,f||Uv)}function B0(a,i,l,u,f){for(;u>l;){if(u-l>600){var x=u-l+1,b=i-l+1,M=Math.log(x),P=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*P*(x-P)/x)*(b-x/2<0?-1:1);B0(a,i,Math.max(l,Math.floor(i-b*P/x+F)),Math.min(u,Math.floor(i+(x-b)*P/x+F)),f)}var N=a[i],V=l,j=u;for(oA(a,l,i),f(a[u],N)>0&&oA(a,l,u);V<j;){for(oA(a,V,j),V++,j--;f(a[V],N)<0;)V++;for(;f(a[j],N)>0;)j--}0===f(a[l],N)?oA(a,l,j):oA(a,++j,u),j<=i&&(l=j+1),i<=j&&(u=j-1)}}function oA(a,i,l){var u=a[i];a[i]=a[l],a[l]=u}function Uv(a,i){return a<i?-1:a>i?1:0}function vm(a,i){const l=a.length;if(l<=1)return[a];const u=[];let f,x;for(let b=0;b<l;b++){const M=Na(a[b]);0!==M&&(a[b].area=Math.abs(M),void 0===x&&(x=M<0),x===M<0?(f&&u.push(f),f=[a[b]]):f.push(a[b]))}if(f&&u.push(f),i>1)for(let b=0;b<u.length;b++)u[b].length<=i||(L0(u[b],i,1,u[b].length-1,N0),u[b]=u[b].slice(0,i));return u}function N0(a,i){return i.area-a.area}function Vh(a,i,l){const u=l.patternDependencies;let f=!1;for(const x of i){const b=x.paint.get(`${a}-pattern`);b.isConstant()||(f=!0);const M=b.constantOr(null);M&&(f=!0,u[M.to]=!0,u[M.from]=!0)}return f}function Of(a,i,l,u,f){const x=f.patternDependencies;for(const b of i){const M=b.paint.get(`${a}-pattern`).value;if("constant"!==M.kind){let P=M.evaluate({zoom:u-1},l,{},f.availableImages),F=M.evaluate({zoom:u},l,{},f.availableImages),N=M.evaluate({zoom:u+1},l,{},f.availableImages);P=P&&P.name?P.name:P,F=F&&F.name?F.name:F,N=N&&N.name?N.name:N,x[P]=!0,x[F]=!0,x[N]=!0,l.patterns[b.id]={min:P,mid:F,max:N}}}return l}kf.deviation=function(a,i,l,u){var f=i&&i.length,x=Math.abs(O0(a,0,f?i[0]*l:a.length,l));if(f)for(var b=0,M=i.length;b<M;b++)x-=Math.abs(O0(a,i[b]*l,b<M-1?i[b+1]*l:a.length,l));var P=0;for(b=0;b<u.length;b+=3){var F=u[b]*l,N=u[b+1]*l,V=u[b+2]*l;P+=Math.abs((a[F]-a[V])*(a[N+1]-a[F+1])-(a[F]-a[N])*(a[V+1]-a[F+1]))}return 0===x&&0===P?0:Math.abs((P-x)/x)},kf.flatten=function(a){for(var i=a[0][0].length,l={vertices:[],holes:[],dimensions:i},u=0,f=0;f<a.length;f++){for(var x=0;x<a[f].length;x++)for(var b=0;b<i;b++)l.vertices.push(a[f][x][b]);f>0&&l.holes.push(u+=a[f-1].length)}return l},If.default=Ov;class sA{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yt,this.indexArray=new Tn,this.indexArray2=new oi,this.programConfigurations=new Ys(i.layers,i.zoom),this.segments=new Ii,this.segments2=new Ii,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,u){this.hasPattern=Vh("fill",this.layers,l);const f=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:b,id:M,index:P,sourceLayerIndex:F}of i){const N=this.layers[0]._featureFilter.needGeometry,V=zu(b,N);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),V,u))continue;const j=f?f.evaluate(V,{},u,l.availableImages):void 0,q={id:M,properties:b.properties,type:b.type,sourceLayerIndex:F,index:P,geometry:N?V.geometry:Ks(b),patterns:{},sortKey:j};x.push(q)}f&&x.sort((b,M)=>b.sortKey-M.sortKey);for(const b of x){const{geometry:M,index:P,sourceLayerIndex:F}=b;if(this.hasPattern){const N=Of("fill",this.layers,b,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(b,M,P,u,{});l.featureIndex.insert(i[P].feature,M,P,F,this.index)}}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}addFeatures(i,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ja),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,u,f,x){for(const b of vm(l,500)){let M=0;for(const q of b)M+=q.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),F=P.vertexLength,N=[],V=[];for(const q of b){if(0===q.length)continue;q!==b[0]&&V.push(N.length/2);const re=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),oe=re.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(oe+q.length-1,oe),N.push(q[0].x),N.push(q[0].y);for(let Ae=1;Ae<q.length;Ae++)this.layoutVertexArray.emplaceBack(q[Ae].x,q[Ae].y),this.indexArray2.emplaceBack(oe+Ae-1,oe+Ae),N.push(q[Ae].x),N.push(q[Ae].y);re.vertexLength+=q.length,re.primitiveLength+=q.length}const j=If(N,V);for(let q=0;q<j.length;q+=3)this.indexArray.emplaceBack(F+j[q],F+j[q+1],F+j[q+2]);P.vertexLength+=M,P.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,f)}}Pt("FillBucket",sA,{omit:["layers","patternFeatures"]});const jv=new $e({"fill-sort-key":new Fe(Ce.layout_fill["fill-sort-key"])});var Fr={paint:new $e({"fill-antialias":new de(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Fe(Ce.paint_fill["fill-opacity"]),"fill-color":new Fe(Ce.paint_fill["fill-color"]),"fill-outline-color":new Fe(Ce.paint_fill["fill-outline-color"]),"fill-translate":new de(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new de(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new We(Ce.paint_fill["fill-pattern"])}),layout:jv};const $v=Mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gv=Mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:xm}=$v;var bm=Uh;function Uh(a,i,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(Hv,this,i)}function Hv(a,i,l){1==a?i.id=l.readVarint():2==a?function(u,f){for(var x=u.readVarint()+u.pos;u.pos<x;){var b=f._keys[u.readVarint()],M=f._values[u.readVarint()];f.properties[b]=M}}(l,i):3==a?i.type=l.readVarint():4==a&&(i._geometry=l.pos)}function qv(a){for(var i,l,u=0,f=0,x=a.length,b=x-1;f<x;b=f++)u+=((l=a[b]).x-(i=a[f]).x)*(i.y+l.y);return u}Uh.types=["Unknown","Point","LineString","Polygon"],Uh.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var i,l=a.readVarint()+a.pos,u=1,f=0,x=0,b=0,M=[];a.pos<l;){if(f<=0){var P=a.readVarint();u=7&P,f=P>>3}if(f--,1===u||2===u)x+=a.readSVarint(),b+=a.readSVarint(),1===u&&(i&&M.push(i),i=[]),i.push(new ct(x,b));else{if(7!==u)throw new Error("unknown command "+u);i&&i.push(i[0].clone())}}return i&&M.push(i),M},Uh.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var i=a.readVarint()+a.pos,l=1,u=0,f=0,x=0,b=1/0,M=-1/0,P=1/0,F=-1/0;a.pos<i;){if(u<=0){var N=a.readVarint();l=7&N,u=N>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<b&&(b=f),f>M&&(M=f),(x+=a.readSVarint())<P&&(P=x),x>F&&(F=x);else if(7!==l)throw new Error("unknown command "+l)}return[b,P,M,F]},Uh.prototype.toGeoJSON=function(a,i,l){var u,f,x=this.extent*Math.pow(2,l),b=this.extent*a,M=this.extent*i,P=this.loadGeometry(),F=Uh.types[this.type];function N(q){for(var re=0;re<q.length;re++){var oe=q[re];q[re]=[360*(oe.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(u=0;u<P.length;u++)V[u]=P[u][0];N(P=V);break;case 2:for(u=0;u<P.length;u++)N(P[u]);break;case 3:for(P=function(q){var re=q.length;if(re<=1)return[q];for(var oe,Ae,xe=[],Me=0;Me<re;Me++){var Le=qv(q[Me]);0!==Le&&(void 0===Ae&&(Ae=Le<0),Ae===Le<0?(oe&&xe.push(oe),oe=[q[Me]]):oe.push(q[Me]))}return oe&&xe.push(oe),xe}(P),u=0;u<P.length;u++)for(f=0;f<P[u].length;f++)N(P[u][f])}1===P.length?P=P[0]:F="Multi"+F;var j={type:"Feature",geometry:{type:F,coordinates:P},properties:this.properties};return"id"in this&&(j.id=this.id),j};var z0=V0;function V0(a,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Ww,this,i),this.length=this._features.length}function Ww(a,i,l){15===a?i.version=l.readVarint():1===a?i.name=l.readString():5===a?i.extent=l.readVarint():2===a?i._features.push(l.pos):3===a?i._keys.push(l.readString()):4===a&&i._values.push(function(u){for(var f=null,x=u.readVarint()+u.pos;u.pos<x;){var b=u.readVarint()>>3;f=1===b?u.readString():2===b?u.readFloat():3===b?u.readDouble():4===b?u.readVarint64():5===b?u.readVarint():6===b?u.readSVarint():7===b?u.readBoolean():null}return f}(l))}function Qw(a,i,l){if(3===a){var u=new z0(l,l.readVarint()+l.pos);u.length&&(i[u.name]=u)}}V0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var i=this._pbf.readVarint()+this._pbf.pos;return new bm(this._pbf,i,this.extent,this._keys,this._values)};var Sa={VectorTile:function(a,i){this.layers=a.readFields(Qw,{},i)},VectorTileFeature:bm,VectorTileLayer:z0};const Lo=Sa.VectorTileFeature.types,wm=Math.pow(2,13);function jh(a,i,l,u,f,x,b,M){a.emplaceBack((i<<1)+b,(l<<1)+x,(Math.floor(u*wm)<<1)+f,Math.round(M))}class Cm{constructor(){this.acc=new ct(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ct(i.x,i.y),this.max=new ct(i.x,i.y))}append(i,l){this.currentPolyCount.edges++,this.acc._add(i);let u=!!this.borders;const f=this.min,x=this.max;i.x<f.x?(f.x=i.x,u=!0):i.x>x.x&&(x.x=i.x,u=!0),i.y<f.y?(f.y=i.y,u=!0):i.y>x.y&&(x.y=i.y,u=!0),((0===i.x||i.x===ar)&&i.x===l.x)!=((0===i.y||i.y===ar)&&i.y===l.y)&&this.processBorderOverlap(i,l),u&&this.checkBorderIntersection(i,l)}checkBorderIntersection(i,l){l.x<0!=i.x<0&&this.addBorderIntersection(0,ut(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>ar!=i.x>ar&&this.addBorderIntersection(1,ut(l.y,i.y,(ar-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,ut(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>ar!=i.y>ar&&this.addBorderIntersection(3,ut(l.x,i.x,(ar-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const u=0===i.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,i.y)}else{const u=0===i.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,i.x)}}centroid(){const i=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==i?this.acc.div(i)._round():new ct(0,0)}span(){return new ct(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0)}}class Ji{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Nr,this.centroidVertexArray=new vv,this.indexArray=new Tn,this.programConfigurations=new Ys(i.layers,i.zoom),this.segments=new Ii,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=i.enableTerrain}populate(i,l,u){this.features=[],this.hasPattern=Vh("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const x=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*x/(x*x+1)/ar/(1<<f.z)}(u);for(const{feature:f,id:x,index:b,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=zu(f,P);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),F,u))continue;const N={id:x,sourceLayerIndex:M,index:b,geometry:P?F.geometry:Ks(f),properties:f.properties,type:f.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(Of("fill-extrusion",this.layers,N,this.zoom,l)):this.addFeature(N,N.geometry,b,u,{}),l.featureIndex.insert(f,N.geometry,b,M,this.index,V)}this.sortBorders()}addFeatures(i,l,u){for(const f of this.features){const{geometry:x}=f;this.addFeature(f,x,f.index,l,u)}this.sortBorders()}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xm),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Gv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,u,f,x){const b=this.enableTerrain?new Cm:null;for(const P of vm(l,500)){let F=0,N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===P.length||(M=P[0]).every(oe=>oe.x<=0)||M.every(oe=>oe.x>=ar)||M.every(oe=>oe.y<=0)||M.every(oe=>oe.y>=ar))continue;for(let oe=0;oe<P.length;oe++){const Ae=P[oe];if(0===Ae.length)continue;F+=Ae.length;let xe=0;b&&b.startRing(Ae[0]);for(let Me=0;Me<Ae.length;Me++){const Le=Ae[Me];if(Me>=1){const Be=Ae[Me-1];if(!aA(Le,Be)){b&&b.append(Le,Be),N.vertexLength+4>Ii.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ne=Le.sub(Be)._perp(),Ue=Ne.x/(Math.abs(Ne.x)+Math.abs(Ne.y)),Ze=Ne.y>0?1:0,it=Be.dist(Le);xe+it>32768&&(xe=0),jh(this.layoutVertexArray,Le.x,Le.y,Ue,Ze,0,0,xe),jh(this.layoutVertexArray,Le.x,Le.y,Ue,Ze,0,1,xe),xe+=it,jh(this.layoutVertexArray,Be.x,Be.y,Ue,Ze,0,0,xe),jh(this.layoutVertexArray,Be.x,Be.y,Ue,Ze,0,1,xe);const dt=N.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+F>Ii.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),"Polygon"!==Lo[i.type])continue;const V=[],j=[],q=N.vertexLength;for(let oe=0;oe<P.length;oe++){const Ae=P[oe];if(0!==Ae.length){Ae!==P[0]&&j.push(V.length/2);for(let xe=0;xe<Ae.length;xe++){const Me=Ae[xe];jh(this.layoutVertexArray,Me.x,Me.y,0,0,1,1,0),V.push(Me.x),V.push(Me.y),b&&b.currentPolyCount.top++}}}const re=If(V,j);for(let oe=0;oe<re.length;oe+=3)this.indexArray.emplaceBack(q+re[oe],q+re[oe+2],q+re[oe+1]);N.primitiveLength+=re.length/3,N.vertexLength+=F}var M;if(b&&b.polyCount.length>0){if(b.borders){b.vertexArrayOffset=this.centroidVertexArray.length;const P=b.borders,F=this.featuresOnBorder.push(b)-1;for(let N=0;N<4;N++)P[N][0]!==Number.MAX_VALUE&&this.borders[N].push(F)}this.encodeCentroid(b.borders?void 0:b.centroid(),b)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,f)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((l,u)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}encodeCentroid(i,l,u=!0){let f,x;if(i)if(0!==i.y){const M=l.span()._mult(this.tileToMeter);f=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(M.x/10)),x=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else f=Math.ceil(7*(i.x+450)),x=0;else f=0,x=+u;let b=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const M of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let P=0;P<2*M.edges;P++)this.centroidVertexArray.emplace(b++,0,x),this.centroidVertexArray.emplace(b++,f,x);for(let P=0;P<M.top;P++)this.centroidVertexArray.emplace(b++,f,x)}}}function aA(a,i){return a.x===i.x&&(a.x<0||a.x>ar)||a.y===i.y&&(a.y<0||a.y>ar)}Pt("FillExtrusionBucket",Ji,{omit:["layers","features"]}),Pt("PartMetadata",Cm);var Em={paint:new $e({"fill-extrusion-opacity":new de(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fe(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new de(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new de(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new We(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fe(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fe(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new de(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function lA(a,i){return a.x*i.x+a.y*i.y}function U0(a,i){if(1===a.length){let l=0;const u=i[l++];let f;for(;!f||u.equals(f);)if(f=i[l++],!f)return 1/0;for(;l<i.length;l++){const x=i[l],b=a[0],M=f.sub(u),P=x.sub(u),F=b.sub(u),N=lA(M,M),V=lA(M,P),j=lA(P,P),q=lA(F,M),re=lA(F,P),oe=N*j-V*V,Ae=(j*q-V*re)/oe,xe=(N*re-V*q)/oe,Me=u.z*(1-Ae-xe)+f.z*Ae+x.z*xe;if(isFinite(Me))return Me}return 1/0}{let l=1/0;for(const u of i)l=Math.min(l,u.z);return l}}function Dm(a){const i=new ct(a[0],a[1]);return i.z=a[2],i}function Zv(a,i,l,u,f,x,b,M){const P=b*f.getElevationAt(a,i,!0,!0),F=0!==x[0],N=F?0===x[1]?b*(x[0]/7-450):b*function(V,j,q){const re=Math.floor(j[0]/8),oe=Math.floor(j[1]/8),Ae=10*(j[0]-8*re),xe=10*(j[1]-8*oe),Me=V.getElevationAt(re,oe,!0,!0),Le=V.getMeterToDEM(q),Be=Math.floor(.5*(Ae*Le-1)),Ne=Math.floor(.5*(xe*Le-1)),Ue=V.tileCoordToPixel(re,oe),Ze=2*Be+1,it=2*Ne+1,dt=(Xt=Ze,En=it,[(Qt=V).getElevationAtPixel(St=Ue.x-Be,Jn=Ue.y-Ne,!0),Qt.getElevationAtPixel(St+En,Jn,!0),Qt.getElevationAtPixel(St,Jn+En,!0),Qt.getElevationAtPixel(St+Xt,Jn+En,!0)]),pt=Math.abs(dt[0]-dt[1]),et=Math.abs(dt[2]-dt[3]),rt=Math.abs(dt[0]-dt[2])+Math.abs(dt[1]-dt[3]),_t=Math.min(.25,.5*Le*(pt+et)/Ze),nt=Math.min(.25,.5*Le*rt/it);var Qt,St,Jn,Xt,En;return Me+Math.max(_t*Ae,nt*xe)}(f,x,M):P;return{base:P+(0===l)?-1:l,top:F?Math.max(N+u,P+l+2):P+u}}const j0=Mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Wv}=j0,$0=Mt([{name:"a_packed",components:3,type:"Float32"}]),{members:Qv}=$0,Xv=Sa.VectorTileFeature.types,Yv=Math.cos(Math.PI/180*37.5);class Lf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new xr,this.layoutVertexArray2=new an,this.indexArray=new Tn,this.programConfigurations=new Ys(i.layers,i.zoom),this.segments=new Ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,u){this.hasPattern=Vh("line",this.layers,l);const f=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:F,id:N,index:V,sourceLayerIndex:j}of i){const q=this.layers[0]._featureFilter.needGeometry,re=zu(F,q);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),re,u))continue;const oe=f?f.evaluate(re,{},u):void 0,Ae={id:N,properties:F.properties,type:F.type,sourceLayerIndex:j,index:V,geometry:q?re.geometry:Ks(F),patterns:{},sortKey:oe};x.push(Ae)}f&&x.sort((F,N)=>F.sortKey-N.sortKey);const{lineAtlas:b,featureIndex:M}=l,P=this.addConstantDashes(b);for(const F of x){const{geometry:N,index:V,sourceLayerIndex:j}=F;if(P&&this.addFeatureDashes(F,b),this.hasPattern){const q=Of("line",this.layers,F,this.zoom,l);this.patternFeatures.push(q)}else this.addFeature(F,N,V,u,b.positions);M.insert(i[V].feature,N,V,j,this.index)}}addConstantDashes(i){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,x=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==x.kind)l=!0;else{const b=x.value,M=f.value;if(!M)continue;i.addDash(M.from,b),i.addDash(M.to,b),M.other&&i.addDash(M.other,b)}}return l}addFeatureDashes(i,l){const u=this.zoom;for(const f of this.layers){const x=f.paint.get("line-dasharray").value,b=f.layout.get("line-cap").value;if("constant"===x.kind&&"constant"===b.kind)continue;let M,P,F,N,V,j;if("constant"===x.kind){const Ae=x.value;if(!Ae)continue;M=Ae.other||Ae.to,P=Ae.to,F=Ae.from}else M=x.evaluate({zoom:u-1},i),P=x.evaluate({zoom:u},i),F=x.evaluate({zoom:u+1},i);"constant"===b.kind?N=V=j=b.value:(N=b.evaluate({zoom:u-1},i),V=b.evaluate({zoom:u},i),j=b.evaluate({zoom:u+1},i)),l.addDash(M,N),l.addDash(P,V),l.addDash(F,j);const q=l.getKey(M,N),re=l.getKey(P,V),oe=l.getKey(F,j);i.patterns[f.id]={min:q,mid:re,max:oe}}}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}addFeatures(i,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Qv)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Wv),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,u,f,x){const b=this.layers[0].layout,M=b.get("line-join").evaluate(i,{}),P=b.get("line-cap").evaluate(i,{}),F=b.get("line-miter-limit"),N=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const V of l)this.addLine(V,i,M,P,F,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,f)}addLine(i,l,u,f,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M="Polygon"===Xv[l.type];let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let F=0;for(;F<P-1&&i[F].equals(i[F+1]);)F++;if(P<(M?3:2))return;"bevel"===u&&(x=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let j,q,re,oe,Ae;this.e1=this.e2=-1,M&&(j=i[P-2],Ae=i[F].sub(j)._unit()._perp());for(let xe=F;xe<P;xe++){if(re=xe===P-1?M?i[F+1]:void 0:i[xe+1],re&&i[xe].equals(re))continue;Ae&&(oe=Ae),j&&(q=j),j=i[xe],Ae=re?re.sub(j)._unit()._perp():oe,oe=oe||Ae;let Me=oe.add(Ae);0===Me.x&&0===Me.y||Me._unit();const Le=oe.x*Ae.x+oe.y*Ae.y,Be=Me.x*Ae.x+Me.y*Ae.y,Ne=0!==Be?1/Be:1/0,Ue=2*Math.sqrt(2-2*Be),Ze=Be<Yv&&q&&re,it=oe.x*Ae.y-oe.y*Ae.x>0;if(Ze&&xe>F){const et=j.dist(q);if(et>2*N){const rt=j.sub(j.sub(q)._mult(N/et)._round());this.updateDistance(q,rt),this.addCurrentVertex(rt,oe,0,0,V),q=rt}}const dt=q&&re;let pt=dt?u:M?"butt":f;if(dt&&"round"===pt&&(Ne<b?pt="miter":Ne<=2&&(pt="fakeround")),"miter"===pt&&Ne>x&&(pt="bevel"),"bevel"===pt&&(Ne>2&&(pt="flipbevel"),Ne<x&&(pt="miter")),q&&this.updateDistance(q,j),"miter"===pt)Me._mult(Ne),this.addCurrentVertex(j,Me,0,0,V);else if("flipbevel"===pt){if(Ne>100)Me=Ae.mult(-1);else{const et=Ne*oe.add(Ae).mag()/oe.sub(Ae).mag();Me._perp()._mult(et*(it?-1:1))}this.addCurrentVertex(j,Me,0,0,V),this.addCurrentVertex(j,Me.mult(-1),0,0,V)}else if("bevel"===pt||"fakeround"===pt){const et=-Math.sqrt(Ne*Ne-1),rt=it?et:0,_t=it?0:et;if(q&&this.addCurrentVertex(j,oe,rt,_t,V),"fakeround"===pt){const nt=Math.round(180*Ue/Math.PI/20);for(let Qt=1;Qt<nt;Qt++){let St=Qt/nt;if(.5!==St){const Xt=St-.5;St+=St*Xt*(St-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*Xt*Xt+(.848013+Le*(.215638*Le-1.06021)))}const Jn=Ae.sub(oe)._mult(St)._add(oe)._unit()._mult(it?-1:1);this.addHalfVertex(j,Jn.x,Jn.y,!1,it,0,V)}}re&&this.addCurrentVertex(j,Ae,-rt,-_t,V)}else if("butt"===pt)this.addCurrentVertex(j,Me,0,0,V);else if("square"===pt){const et=q?1:-1;q||this.addCurrentVertex(j,Me,et,et,V),this.addCurrentVertex(j,Me,0,0,V),q&&this.addCurrentVertex(j,Me,et,et,V)}else"round"===pt&&(q&&(this.addCurrentVertex(j,oe,0,0,V),this.addCurrentVertex(j,oe,1,1,V,!0)),re&&(this.addCurrentVertex(j,Ae,-1,-1,V,!0),this.addCurrentVertex(j,Ae,0,0,V)));if(Ze&&xe<P-1){const et=j.dist(re);if(et>2*N){const rt=j.add(re.sub(j)._mult(N/et)._round());this.updateDistance(j,rt),this.addCurrentVertex(rt,Ae,0,0,V),j=rt}}}}addCurrentVertex(i,l,u,f,x,b=!1){const M=l.y*f-l.x,P=-l.y-l.x*f;this.addHalfVertex(i,l.x+l.y*u,l.y-l.x*u,b,!1,u,x),this.addHalfVertex(i,M,P,b,!0,-f,x)}addHalfVertex({x:i,y:l},u,f,x,b,M,P){this.layoutVertexArray.emplaceBack((i<<1)+(x?1:0),(l<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===M?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const F=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),P.primitiveLength++),b?this.e2=F:this.e1=F}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}Pt("LineBucket",Lf,{omit:["layers","patternFeatures"]});const Sm=new $e({"line-cap":new Fe(Ce.layout_line["line-cap"]),"line-join":new Fe(Ce.layout_line["line-join"]),"line-miter-limit":new de(Ce.layout_line["line-miter-limit"]),"line-round-limit":new de(Ce.layout_line["line-round-limit"]),"line-sort-key":new Fe(Ce.layout_line["line-sort-key"])});var Mm={paint:new $e({"line-opacity":new Fe(Ce.paint_line["line-opacity"]),"line-color":new Fe(Ce.paint_line["line-color"]),"line-translate":new de(Ce.paint_line["line-translate"]),"line-translate-anchor":new de(Ce.paint_line["line-translate-anchor"]),"line-width":new Fe(Ce.paint_line["line-width"]),"line-gap-width":new Fe(Ce.paint_line["line-gap-width"]),"line-offset":new Fe(Ce.paint_line["line-offset"]),"line-blur":new Fe(Ce.paint_line["line-blur"]),"line-dasharray":new We(Ce.paint_line["line-dasharray"]),"line-pattern":new We(Ce.paint_line["line-pattern"]),"line-gradient":new Pe(Ce.paint_line["line-gradient"])}),layout:Sm};const G0=new class extends Fe{possiblyEvaluate(a,i){return i=new te(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(a,i)}evaluate(a,i,l,u){return i=ci({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(a,i,l,u)}}(Mm.paint.properties["line-width"].specification);function Kv(a,i){return i>0?i+2*a:a}G0.useIntegerZoom=!0;const H0=Mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Bf=Mt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jv=Mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e1=Mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Oc=Mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),t1=Mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mt([{name:"triangle",components:3,type:"Uint16"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mt([{type:"Float32",name:"offsetX"}]),Mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const el=128;function Tm(a,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new te(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let x=0;for(;x<u.length&&u[x]<=a;)x++;x=Math.max(0,x-1);let b=x;for(;b<u.length&&u[b]<a+1;)b++;b=Math.min(u.length-1,b);const M=u[x],P=u[b];return"composite"===l.kind?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:f}:{kind:"camera",minZoom:M,maxZoom:P,minSize:l.evaluate(new te(M)),maxSize:l.evaluate(new te(P)),interpolationType:f}}}function Nf(a,{uSize:i,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/el:"composite"===a.kind?ut(u/el,f/el,l):i}function Fl(a,i){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:x,maxZoom:b}=a,M=f?li(Rn.interpolationFactor(f,i,x,b),0,1):0;"camera"===a.kind?u=ut(a.minSize,a.maxSize,M):l=M}return{uSizeT:l,uSize:u}}var ea=Object.freeze({__proto__:null,getSizeData:Tm,evaluateSizeForFeature:Nf,evaluateSizeForZoom:Fl,SIZE_PACK_FACTOR:el});function q0(a,i,l){return a.sections.forEach(u=>{u.text=function(f,x,b){const M=x.layout.get("text-transform").evaluate(b,{});return"uppercase"===M?f=f.toLocaleUpperCase():"lowercase"===M&&(f=f.toLocaleLowerCase()),J.applyArabicShaping&&(f=J.applyArabicShaping(f)),f}(u.text,i,l)}),a}const cA={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function n1(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Z0(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var r1=function(a,i,l,u,f){var x,b,M=8*f-u-1,P=(1<<M)-1,F=P>>1,N=-7,V=l?f-1:0,j=l?-1:1,q=a[i+V];for(V+=j,x=q&(1<<-N)-1,q>>=-N,N+=M;N>0;x=256*x+a[i+V],V+=j,N-=8);for(b=x&(1<<-N)-1,x>>=-N,N+=u;N>0;b=256*b+a[i+V],V+=j,N-=8);if(0===x)x=1-F;else{if(x===P)return b?NaN:1/0*(q?-1:1);b+=Math.pow(2,u),x-=F}return(q?-1:1)*b*Math.pow(2,x-u)},Im=function(a,i,l,u,f,x){var b,M,P,F=8*x-f-1,N=(1<<F)-1,V=N>>1,j=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,q=u?0:x-1,re=u?1:-1,oe=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,b=N):(b=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-b))<1&&(b--,P*=2),(i+=b+V>=1?j/P:j*Math.pow(2,1-V))*P>=2&&(b++,P/=2),b+V>=N?(M=0,b=N):b+V>=1?(M=(i*P-1)*Math.pow(2,f),b+=V):(M=i*Math.pow(2,V-1)*Math.pow(2,f),b=0));f>=8;a[l+q]=255&M,q+=re,M/=256,f-=8);for(b=b<<f|M,F+=f;F>0;a[l+q]=255&b,q+=re,b/=256,F-=8);a[l+q-re]|=128*oe},uA=fr;function fr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}fr.Varint=0,fr.Fixed64=1,fr.Bytes=2,fr.Fixed32=5;var km=4294967296,qu=1/km,Ma="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Lc(a){return a.type===fr.Bytes?a.readVarint()+a.pos:a.pos+1}function Pm(a,i,l){var u=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function Xw(a,i){for(var l=0;l<a.length;l++)i.writeVarint(a[l])}function Es(a,i){for(var l=0;l<a.length;l++)i.writeSVarint(a[l])}function Rm(a,i){for(var l=0;l<a.length;l++)i.writeFloat(a[l])}function Fm(a,i){for(var l=0;l<a.length;l++)i.writeDouble(a[l])}function i1(a,i){for(var l=0;l<a.length;l++)i.writeBoolean(a[l])}function W0(a,i){for(var l=0;l<a.length;l++)i.writeFixed32(a[l])}function dA(a,i){for(var l=0;l<a.length;l++)i.writeSFixed32(a[l])}function Q0(a,i){for(var l=0;l<a.length;l++)i.writeFixed64(a[l])}function X0(a,i){for(var l=0;l<a.length;l++)i.writeSFixed64(a[l])}function $h(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+16777216*a[i+3]}function Bc(a,i,l){a[l]=i,a[l+1]=i>>>8,a[l+2]=i>>>16,a[l+3]=i>>>24}function Om(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+(a[i+3]<<24)}function Yw(a,i,l){i.glyphs=[],1===a&&l.readMessage(Gh,i)}function Gh(a,i,l){if(3===a){const{id:u,bitmap:f,width:x,height:b,left:M,top:P,advance:F}=l.readMessage(Lm,{});i.glyphs.push({id:u,bitmap:new Rc({width:x+6,height:b+6},f),metrics:{width:x,height:b,left:M,top:P,advance:F}})}else 4===a?i.ascender=l.readSVarint():5===a&&(i.descender=l.readSVarint())}function Lm(a,i,l){1===a?i.id=l.readVarint():2===a?i.bitmap=l.readBytes():3===a?i.width=l.readVarint():4===a?i.height=l.readVarint():5===a?i.left=l.readSVarint():6===a?i.top=l.readSVarint():7===a&&(i.advance=l.readVarint())}function zf(a){let i=0,l=0;for(const b of a)i+=b.w*b.h,l=Math.max(l,b.w);a.sort((b,M)=>M.h-b.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let f=0,x=0;for(const b of a)for(let M=u.length-1;M>=0;M--){const P=u[M];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,x=Math.max(x,b.y+b.h),f=Math.max(f,b.x+b.w),b.w===P.w&&b.h===P.h){const F=u.pop();M<u.length&&(u[M]=F)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(u.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:f,h:x,fill:i/(f*x)||0}}fr.prototype={destroy:function(){this.buf=null},readFields:function(a,i,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,x=this.pos;this.type=7&u,a(f,i,this),this.pos===x&&this.skip(u)}return i},readMessage:function(a,i){return this.readFields(a,i,this.readVarint()+this.pos)},readFixed32:function(){var a=$h(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Om(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=$h(this.buf,this.pos)+$h(this.buf,this.pos+4)*km;return this.pos+=8,a},readSFixed64:function(){var a=$h(this.buf,this.pos)+Om(this.buf,this.pos+4)*km;return this.pos+=8,a},readFloat:function(){var a=r1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=r1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var i,l,u=this.buf;return i=127&(l=u[this.pos++]),l<128?i:(i|=(127&(l=u[this.pos++]))<<7,l<128?i:(i|=(127&(l=u[this.pos++]))<<14,l<128?i:(i|=(127&(l=u[this.pos++]))<<21,l<128?i:function(f,x,b){var M,P,F=b.buf;if(M=(112&(P=F[b.pos++]))>>4,P<128||(M|=(127&(P=F[b.pos++]))<<3,P<128)||(M|=(127&(P=F[b.pos++]))<<10,P<128)||(M|=(127&(P=F[b.pos++]))<<17,P<128)||(M|=(127&(P=F[b.pos++]))<<24,P<128)||(M|=(1&(P=F[b.pos++]))<<31,P<128))return function(a,i,l){return l?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}(f,M,x);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&Ma?Ma.decode(this.buf.subarray(i,a)):function(l,u,f){for(var x="",b=u;b<f;){var M,P,F,N=l[b],V=null,j=N>239?4:N>223?3:N>191?2:1;if(b+j>f)break;1===j?N<128&&(V=N):2===j?128==(192&(M=l[b+1]))&&(V=(31&N)<<6|63&M)<=127&&(V=null):3===j?(P=l[b+2],128==(192&(M=l[b+1]))&&128==(192&P)&&((V=(15&N)<<12|(63&M)<<6|63&P)<=2047||V>=55296&&V<=57343)&&(V=null)):4===j&&(P=l[b+2],F=l[b+3],128==(192&(M=l[b+1]))&&128==(192&P)&&128==(192&F)&&((V=(15&N)<<18|(63&M)<<12|(63&P)<<6|63&F)<=65535||V>=1114112)&&(V=null)),null===V?(V=65533,j=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),b+=j}return x}(this.buf,i,a)},readBytes:function(){var a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i},readPackedVarint:function(a,i){if(this.type!==fr.Bytes)return a.push(this.readVarint(i));var l=Lc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(i));return a},readPackedSVarint:function(a){if(this.type!==fr.Bytes)return a.push(this.readSVarint());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==fr.Bytes)return a.push(this.readBoolean());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==fr.Bytes)return a.push(this.readFloat());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==fr.Bytes)return a.push(this.readDouble());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==fr.Bytes)return a.push(this.readFixed32());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==fr.Bytes)return a.push(this.readSFixed32());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==fr.Bytes)return a.push(this.readFixed64());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==fr.Bytes)return a.push(this.readSFixed64());var i=Lc(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed64());return a},skip:function(a){var i=7&a;if(i===fr.Varint)for(;this.buf[this.pos++]>127;);else if(i===fr.Bytes)this.pos=this.readVarint()+this.pos;else if(i===fr.Fixed32)this.pos+=4;else{if(i!==fr.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(a,i){this.writeVarint(a<<3|i)},realloc:function(a){for(var i=this.length||16;i<this.pos+a;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Bc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Bc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Bc(this.buf,-1&a,this.pos),Bc(this.buf,Math.floor(a*qu),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Bc(this.buf,-1&a,this.pos),Bc(this.buf,Math.floor(a*qu),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(i,l){var u,f,x,M;if(i>=0?(u=i%4294967296|0,f=i/4294967296|0):(f=~(-i/4294967296),4294967295^(u=~(-i%4294967296))?u=u+1|0:(u=0,f=f+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),x=u,(M=l).buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7),function(x,b){var M=(7&x)<<4;b.buf[b.pos++]|=M|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var i=this.pos;this.pos=function(u,f,x){for(var b,M,P=0;P<f.length;P++){if((b=f.charCodeAt(P))>55295&&b<57344){if(!M){b>56319||P+1===f.length?(u[x++]=239,u[x++]=191,u[x++]=189):M=b;continue}if(b<56320){u[x++]=239,u[x++]=191,u[x++]=189,M=b;continue}b=M-55296<<10|b-56320|65536,M=null}else M&&(u[x++]=239,u[x++]=191,u[x++]=189,M=null);b<128?u[x++]=b:(b<2048?u[x++]=b>>6|192:(b<65536?u[x++]=b>>12|224:(u[x++]=b>>18|240,u[x++]=b>>12&63|128),u[x++]=b>>6&63|128),u[x++]=63&b|128)}return x}(this.buf,a,this.pos);var l=this.pos-i;l>=128&&Pm(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Im(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Im(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var i=a.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,i){this.pos++;var l=this.pos;a(i,this);var u=this.pos-l;u>=128&&Pm(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,i,l){this.writeTag(a,fr.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(a,i){i.length&&this.writeMessage(a,Xw,i)},writePackedSVarint:function(a,i){i.length&&this.writeMessage(a,Es,i)},writePackedBoolean:function(a,i){i.length&&this.writeMessage(a,i1,i)},writePackedFloat:function(a,i){i.length&&this.writeMessage(a,Rm,i)},writePackedDouble:function(a,i){i.length&&this.writeMessage(a,Fm,i)},writePackedFixed32:function(a,i){i.length&&this.writeMessage(a,W0,i)},writePackedSFixed32:function(a,i){i.length&&this.writeMessage(a,dA,i)},writePackedFixed64:function(a,i){i.length&&this.writeMessage(a,Q0,i)},writePackedSFixed64:function(a,i){i.length&&this.writeMessage(a,X0,i)},writeBytesField:function(a,i){this.writeTag(a,fr.Bytes),this.writeBytes(i)},writeFixed32Field:function(a,i){this.writeTag(a,fr.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(a,i){this.writeTag(a,fr.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(a,i){this.writeTag(a,fr.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(a,i){this.writeTag(a,fr.Fixed64),this.writeSFixed64(i)},writeVarintField:function(a,i){this.writeTag(a,fr.Varint),this.writeVarint(i)},writeSVarintField:function(a,i){this.writeTag(a,fr.Varint),this.writeSVarint(i)},writeStringField:function(a,i){this.writeTag(a,fr.Bytes),this.writeString(i)},writeFloatField:function(a,i){this.writeTag(a,fr.Fixed32),this.writeFloat(i)},writeDoubleField:function(a,i){this.writeTag(a,fr.Fixed64),this.writeDouble(i)},writeBooleanField:function(a,i){this.writeVarintField(a,Boolean(i))}};class Bm{constructor(i,{pixelRatio:l,version:u,stretchX:f,stretchY:x,content:b}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=f,this.stretchY=x,this.content=b,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Vf{constructor(i,l){const u={},f={};this.haveRenderCallbacks=[];const x=[];this.addImages(i,u,x),this.addImages(l,f,x);const{w:b,h:M}=zf(x),P=new ws({width:b||1,height:M||1});for(const F in i){const N=i[F],V=u[F].paddedRect;ws.copy(N.data,P,{x:0,y:0},{x:V.x+1,y:V.y+1},N.data)}for(const F in l){const N=l[F],V=f[F].paddedRect,j=V.x+1,q=V.y+1,re=N.data.width,oe=N.data.height;ws.copy(N.data,P,{x:0,y:0},{x:j,y:q},N.data),ws.copy(N.data,P,{x:0,y:oe-1},{x:j,y:q-1},{width:re,height:1}),ws.copy(N.data,P,{x:0,y:0},{x:j,y:q+oe},{width:re,height:1}),ws.copy(N.data,P,{x:re-1,y:0},{x:j-1,y:q},{width:1,height:oe}),ws.copy(N.data,P,{x:0,y:0},{x:j+re,y:q},{width:1,height:oe})}this.image=P,this.iconPositions=u,this.patternPositions=f}addImages(i,l,u){for(const f in i){const x=i[f],b={x:0,y:0,w:x.data.width+2,h:x.data.height+2};u.push(b),l[f]=new Bm(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in i.updatedImages)this.patchUpdatedImage(this.iconPositions[u],i.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u),l)}patchUpdatedImage(i,l,u){if(!i||!l||i.version===l.version)return;i.version=l.version;const[f,x]=i.tl;u.update(l.data,void 0,{x:f,y:x})}}Pt("ImagePosition",Bm),Pt("ImageAtlas",Vf);const Ds={horizontal:1,vertical:2,horizontalOnly:3};class AA{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const u=new AA;return u.scale=i||1,u.fontStack=l,u}static forImage(i){const l=new AA;return l.imageName=i,l}}class Hh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const u=new Hh;for(let f=0;f<i.sections.length;f++){const x=i.sections[f];x.image?u.addImageSection(x):u.addTextSection(x,l)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(l,u){let f="";for(let x=0;x<l.length;x++){const b=l.charCodeAt(x+1)||null,M=l.charCodeAt(x-1)||null;f+=!u&&(b&&Ou(b)&&!cA[l[x+1]]||M&&Ou(M)&&!cA[l[x-1]])||!cA[l[x]]?l[x]:cA[l[x]]}return f}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&Uf[this.text.charCodeAt(u)];u++)i++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&Uf[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const u=new Hh;return u.text=this.text.substring(i,l),u.sectionIndex=this.sectionIndex.slice(i,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(AA.forText(i.scale,i.fontStack||l));const u=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(u)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void Lr("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(AA.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Lr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Nm(a,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe){const Ae=Hh.fromFeature(a,f);let xe;V===Ds.vertical&&Ae.verticalizePunctuation(j);const{processBidirectionalText:Me,processStyledBidirectionalText:Le}=J;if(Me&&1===Ae.sections.length){xe=[];const Ue=Me(Ae.toString(),Vm(Ae,F,x,i,u,q,re));for(const Ze of Ue){const it=new Hh;it.text=Ze,it.sections=Ae.sections;for(let dt=0;dt<Ze.length;dt++)it.sectionIndex.push(0);xe.push(it)}}else if(Le){xe=[];const Ue=Le(Ae.text,Ae.sectionIndex,Vm(Ae,F,x,i,u,q,re));for(const Ze of Ue){const it=new Hh;it.text=Ze[0],it.sectionIndex=Ze[1],it.sections=Ae.sections,xe.push(it)}}else xe=function(Ue,Ze){const it=[],dt=Ue.text;let pt=0;for(const et of Ze)it.push(Ue.substring(pt,et)),pt=et;return pt<dt.length&&it.push(Ue.substring(pt,dt.length)),it}(Ae,Vm(Ae,F,x,i,u,q,re));const Be=[],Ne={positionedLines:Be,text:Ae.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ue,Ze,it,dt,pt,et,rt,_t,nt,Qt,St,Jn){let Xt=0,En=0,Ut=0;const Kt="right"===_t?1:"left"===_t?0:.5;let Fn=!1;for(const lr of pt){const cr=lr.getSections();for(const Ri of cr){if(Ri.imageName)continue;const Gr=Ze[Ri.fontStack];if(Gr&&(Fn=void 0!==Gr.ascender&&void 0!==Gr.descender,!Fn))break}if(!Fn)break}let bi=0;for(const lr of pt){lr.trim();const cr=lr.getMaxScale(),Ri=24*(cr-1),Gr={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[bi]=Gr;const Fi=Gr.positionedGlyphs;let wi=0;if(!lr.length()){En+=et,++bi;continue}let ur=0,Xr=0;for(let Dr=0;Dr<lr.length();Dr++){const Yr=lr.getSection(Dr),Bo=lr.getSectionIndex(Dr),Kr=lr.getCharCode(Dr);let Jr=Yr.scale,zn=null,Oi=null,es=null,Ms=24,Ts=0;const Ia=!(nt===Ds.horizontal||!St&&!Qs(Kr)||St&&(Uf[Kr]||(zr=Kr,Vd(zr)||Ml(zr)||Ws(zr)||yi(zr)||Ka(zr))));if(Yr.imageName){const ka=dt[Yr.imageName];if(!ka)continue;es=Yr.imageName,Ue.iconsInText=Ue.iconsInText||!0,Oi=ka.paddedRect;const po=ka.displaySize;Jr=24*Jr/Jn,zn={width:po[0],height:po[1],left:1,top:-3,advance:Ia?po[1]:po[0],localGlyph:!1},Ts=Fn?-zn.height*Jr:24*cr-17-po[1]*Jr,Ms=zn.advance;const ra=(Ia?po[0]:po[1])*Jr-24*cr;ra>0&&ra>wi&&(wi=ra)}else{const ka=it[Yr.fontStack];if(!ka)continue;ka[Kr]&&(Oi=ka[Kr]);const po=Ze[Yr.fontStack];if(!po)continue;const ra=po.glyphs[Kr];if(!ra)continue;if(zn=ra.metrics,Ms=8203!==Kr?24:0,Fn){const Yu=void 0!==po.ascender?Math.abs(po.ascender):0,Is=void 0!==po.descender?Math.abs(po.descender):0,Zh=(Yu+Is)*Jr;ur<Zh&&(ur=Zh,Xr=(Yu-Is)/2*Jr),Ts=-Yu*Jr}else Ts=24*(cr-Jr)-17}Ia?(Ue.verticalizable=!0,Fi.push({glyph:Kr,imageName:es,x:Xt,y:En+Ts,vertical:Ia,scale:Jr,localGlyph:zn.localGlyph,fontStack:Yr.fontStack,sectionIndex:Bo,metrics:zn,rect:Oi}),Xt+=Ms*Jr+Qt):(Fi.push({glyph:Kr,imageName:es,x:Xt,y:En+Ts,vertical:Ia,scale:Jr,localGlyph:zn.localGlyph,fontStack:Yr.fontStack,sectionIndex:Bo,metrics:zn,rect:Oi}),Xt+=zn.advance*Jr+Qt)}0!==Fi.length&&(Ut=Math.max(Xt-Qt,Ut),Fn?Um(Fi,Kt,wi,Xr,et*cr/2):Um(Fi,Kt,wi,0,et/2)),Xt=0;const Er=et*cr+wi;Gr.lineOffset=Math.max(wi,Ri),En+=Er,++bi}var zr;const ki=En,{horizontalAlign:Pi,verticalAlign:Vr}=Gf(rt);(function(lr,cr,Ri,Gr,Fi,wi){const ur=(cr-Ri)*Fi,Xr=-wi*Gr;for(const Er of lr)for(const Dr of Er.positionedGlyphs)Dr.x+=ur,Dr.y+=Xr})(Ue.positionedLines,Kt,Pi,Vr,Ut,ki),Ue.top+=-Vr*ki,Ue.bottom=Ue.top+ki,Ue.left+=-Pi*Ut,Ue.right=Ue.left+Ut,Ue.hasBaseline=Fn}(Ne,i,l,u,xe,b,M,P,V,F,j,oe),!function(Ue){for(const Ze of Ue)if(0!==Ze.positionedGlyphs.length)return!1;return!0}(Be)&&Ne}const Uf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},o1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zm(a,i,l,u,f,x){if(i.imageName){const b=u[i.imageName];return b?b.displaySize[0]*i.scale*24/x+f:0}{const b=l[i.fontStack],M=b&&b.glyphs[a];return M?M.metrics.advance*i.scale+f:0}}function jf(a,i,l,u){const f=Math.pow(a-i,2);return u?a<i?f/2:2*f:f+Math.abs(l)*l}function Y0(a,i,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==i&&65289!==i||(u+=50),u}function $f(a,i,l,u,f,x){let b=null,M=jf(i,l,f,x);for(const P of u){const F=jf(i-P.x,l,f,x)+P.badness;F<=M&&(b=P,M=F)}return{index:a,x:i,priorBreak:b,badness:M}}function K0(a){return a?K0(a.priorBreak).concat(a.index):[]}function Vm(a,i,l,u,f,x,b){if("point"!==x)return[];if(!a)return[];const M=[],P=function(j,q,re,oe,Ae,xe){let Me=0;for(let Le=0;Le<j.length();Le++){const Be=j.getSection(Le);Me+=zm(j.getCharCode(Le),Be,oe,Ae,q,xe)}return Me/Math.max(1,Math.ceil(Me/re))}(a,i,l,u,f,b),F=a.text.indexOf("\u200b")>=0;let N=0;for(let j=0;j<a.length();j++){const q=a.getSection(j),re=a.getCharCode(j);if(Uf[re]||(N+=zm(re,q,u,f,i,b)),j<a.length()-1){const oe=!((V=re)<11904||!(Pu(V)||kh(V)||Br(V)||hf(V)||Ru(V)||Iu(V)||jd(V)||Tl(V)||$d(V)||Rh(V)||Il(V)||Dc(V)||ku(V)||uf(V)||Ud(V)||Ph(V)||Cc(V)||Ca(V)||Fu(V)||Ec(V)));(o1[re]||oe||q.imageName)&&M.push($f(j+1,N,P,M,Y0(re,a.getCharCode(j+1),oe&&F),!1))}}var V;return K0($f(a.length(),N,P,M,0,!0))}function Gf(a){let i=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Um(a,i,l,u,f){if(!(i||l||u||f))return;const x=a.length-1,b=a[x],M=(b.x+b.metrics.advance*b.scale)*i;for(let P=0;P<=x;P++)a[P].x-=M,a[P].y+=l+u+f}function Zu(a,i,l){const{horizontalAlign:u,verticalAlign:f}=Gf(l),x=i[0]-a.displaySize[0]*u,b=i[1]-a.displaySize[1]*f;return{image:a,top:b,bottom:b+a.displaySize[1],left:x,right:x+a.displaySize[0]}}function jm(a,i,l,u,f,x){const b=a.image;let M;if(b.content){const Ae=b.content,xe=b.pixelRatio||1;M=[Ae[0]/xe,Ae[1]/xe,b.displaySize[0]-Ae[2]/xe,b.displaySize[1]-Ae[3]/xe]}const P=i.left*x,F=i.right*x;let N,V,j,q;"width"===l||"both"===l?(q=f[0]+P-u[3],V=f[0]+F+u[1]):(q=f[0]+(P+F-b.displaySize[0])/2,V=q+b.displaySize[0]);const re=i.top*x,oe=i.bottom*x;return"height"===l||"both"===l?(N=f[1]+re-u[0],j=f[1]+oe+u[2]):(N=f[1]+(re+oe-b.displaySize[1])/2,j=N+b.displaySize[1]),{image:b,top:N,right:V,bottom:j,left:q,collisionPadding:M}}class Ol extends ct{constructor(i,l,u,f,x){super(i,l),this.angle=f,this.z=u,void 0!==x&&(this.segment=x)}clone(){return new Ol(this.x,this.y,this.z,this.angle,this.segment)}}function J0(a,i,l,u,f){if(void 0===i.segment)return!0;let x=i,b=i.segment+1,M=0;for(;M>-l/2;){if(b--,b<0)return!1;M-=a[b].dist(x),x=a[b]}M+=a[b].dist(a[b+1]),b++;const P=[];let F=0;for(;M<l/2;){const N=a[b],V=a[b+1];if(!V)return!1;let j=a[b-1].angleTo(N)-N.angleTo(V);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:j}),F+=j;M-P[0].distance>u;)F-=P.shift().angleDelta;if(F>f)return!1;b++,M+=N.dist(V)}return!0}function fA(a){let i=0;for(let l=0;l<a.length-1;l++)i+=a[l].dist(a[l+1]);return i}function e_(a,i,l){return a?.6*i*l:0}function $m(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function t_(a,i,l,u,f,x){const b=e_(l,f,x),M=$m(l,u)*x;let P=0;const F=fA(a)/2;for(let N=0;N<a.length-1;N++){const V=a[N],j=a[N+1],q=V.dist(j);if(P+q>F){const re=(F-P)/q,oe=ut(V.x,j.x,re),Ae=ut(V.y,j.y,re),xe=new Ol(oe,Ae,0,j.angleTo(V),N);return!b||J0(a,xe,M,b,i)?xe:void 0}P+=q}}function n_(a,i,l,u,f,x,b,M,P){const F=e_(u,x,b),N=$m(u,f),V=N*b,j=0===a[0].x||a[0].x===P||0===a[0].y||a[0].y===P;return i-V<i/4&&(i=V+i/4),Hf(a,j?i/2*M%i:(N/2+2*x)*b*M%i,i,F,l,V,j,!1,P)}function Hf(a,i,l,u,f,x,b,M,P){const F=x/2,N=fA(a);let V=0,j=i-l,q=[];for(let re=0;re<a.length-1;re++){const oe=a[re],Ae=a[re+1],xe=oe.dist(Ae),Me=Ae.angleTo(oe);for(;j+l<V+xe;){j+=l;const Le=(j-V)/xe,Be=ut(oe.x,Ae.x,Le),Ne=ut(oe.y,Ae.y,Le);if(Be>=0&&Be<P&&Ne>=0&&Ne<P&&j-F>=0&&j+F<=N){const Ue=new Ol(Be,Ne,0,Me,re);Ue._round(),u&&!J0(a,Ue,x,u,f)||q.push(Ue)}}V+=xe}return M||q.length||b||(q=Hf(a,V/2,l,u,f,x,b,!0,P)),q}function Gm(a,i,l,u,f){const x=[];for(let b=0;b<a.length;b++){const M=a[b];let P;for(let F=0;F<M.length-1;F++){let N=M[F],V=M[F+1];N.x<i&&V.x<i||(N.x<i?N=new ct(i,N.y+(i-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x<i&&(V=new ct(i,N.y+(i-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y<l&&V.y<l||(N.y<l?N=new ct(N.x+(l-N.y)/(V.y-N.y)*(V.x-N.x),l)._round():V.y<l&&(V=new ct(N.x+(l-N.y)/(V.y-N.y)*(V.x-N.x),l)._round()),N.x>=u&&V.x>=u||(N.x>=u?N=new ct(u,N.y+(u-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x>=u&&(V=new ct(u,N.y+(u-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y>=f&&V.y>=f||(N.y>=f?N=new ct(N.x+(f-N.y)/(V.y-N.y)*(V.x-N.x),f)._round():V.y>=f&&(V=new ct(N.x+(f-N.y)/(V.y-N.y)*(V.x-N.x),f)._round()),P&&N.equals(P[P.length-1])||(P=[N],x.push(P)),P.push(V)))))}}return x}Pt("Anchor",Ol);const Nc=1e20;function pA(a,i,l,u,f,x,b,M,P){for(let F=i;F<i+u;F++)Hm(a,l*x+F,x,f,b,M,P);for(let F=l;F<l+f;F++)Hm(a,F*x+i,1,u,b,M,P)}function Hm(a,i,l,u,f,x,b){x[0]=0,b[0]=-Nc,b[1]=Nc,f[0]=a[i];for(let M=1,P=0,F=0;M<u;M++){f[M]=a[i+M*l];const N=M*M;do{const V=x[P];F=(f[M]-f[V]+N-V*V)/(M-V)/2}while(F<=b[P]&&--P>-1);P++,x[P]=M,b[P]=F,b[P+1]=Nc}for(let M=0,P=0;M<u;M++){for(;b[P+1]<M;)P++;const F=x[P],N=M-F;a[i+M*l]=f[F]+N*N}}const mA={none:0,ideographs:1,all:2};class Wu{constructor(i,l,u){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const u=[];for(const f in i)for(const x of i[f])u.push({stack:f,id:x});au(u,({stack:f,id:x},b)=>{let M=this.entries[f];M||(M=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=M.glyphs[x];if(void 0!==P)return void b(null,{stack:f,id:x,glyph:P});if(P=this._tinySDF(M,f,x),P)return M.glyphs[x]=P,void b(null,{stack:f,id:x,glyph:P});const F=Math.floor(x/256);if(256*F>65535)return void b(new Error("glyphs > 65535 not supported"));if(M.ranges[F])return void b(null,{stack:f,id:x,glyph:P});let N=M.requests[F];N||(N=M.requests[F]=[],Wu.loadGlyphRange(f,F,this.url,this.requestManager,(V,j)=>{if(j){M.ascender=j.ascender,M.descender=j.descender;for(const q in j.glyphs)this._doesCharSupportLocalGlyph(+q)||(M.glyphs[+q]=j.glyphs[+q]);M.ranges[F]=!0}for(const q of N)q(V,j);delete M.requests[F]})),N.push((V,j)=>{V?b(V):j&&b(null,{stack:f,id:x,glyph:j.glyphs[x]||null})})},(f,x)=>{if(f)l(f);else if(x){const b={};for(const{stack:M,id:P,glyph:F}of x)void 0===b[M]&&(b[M]={}),void 0===b[M].glyphs&&(b[M].glyphs={}),b[M].glyphs[P]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},b[M].ascender=this.entries[M].ascender,b[M].descender=this.entries[M].descender;l(null,b)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==mA.none&&(this.localGlyphMode===mA.all?!!this.localFontFamily:!!this.localFontFamily&&(Rh(i)||kl(i)||ku(i)||Cc(i))||Tl(i))}_tinySDF(i,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let x=i.tinySDF;if(!x){let oe="400";/bold/i.test(l)?oe="900":/medium/i.test(l)?oe="500":/light/i.test(l)&&(oe="200"),x=i.tinySDF=new Wu.TinySDF({fontFamily:f,fontWeight:oe,fontSize:48,buffer:6,radius:16}),x.fontWeight=oe}if(this.localGlyphs[x.fontWeight][u])return this.localGlyphs[x.fontWeight][u];const b=String.fromCharCode(u),{data:M,width:P,height:F,glyphWidth:N,glyphHeight:V,glyphLeft:j,glyphTop:q,glyphAdvance:re}=x.draw(b);return this.localGlyphs[x.fontWeight][u]={id:u,bitmap:new Rc({width:P,height:F},M),metrics:{width:N/2,height:V/2,left:j/2,top:q/2-27,advance:re/2,localGlyph:!0}}}}function qf(a,i,l,u){const f=[],x=a.image,b=x.pixelRatio,M=x.paddedRect.w-2,P=x.paddedRect.h-2,F=a.right-a.left,N=a.bottom-a.top,V=x.stretchX||[[0,M]],j=x.stretchY||[[0,P]],q=(et,rt)=>et+rt[1]-rt[0],re=V.reduce(q,0),oe=j.reduce(q,0),Ae=M-re,xe=P-oe;let Me=0,Le=re,Be=0,Ne=oe,Ue=0,Ze=Ae,it=0,dt=xe;if(x.content&&u){const et=x.content;Me=zc(V,0,et[0]),Be=zc(j,0,et[1]),Le=zc(V,et[0],et[2]),Ne=zc(j,et[1],et[3]),Ue=et[0]-Me,it=et[1]-Be,Ze=et[2]-et[0]-Le,dt=et[3]-et[1]-Ne}const pt=(et,rt,_t,nt)=>{const Qt=gA(et.stretch-Me,Le,F,a.left),St=Zf(et.fixed-Ue,Ze,et.stretch,re),Jn=gA(rt.stretch-Be,Ne,N,a.top),Xt=Zf(rt.fixed-it,dt,rt.stretch,oe),En=gA(_t.stretch-Me,Le,F,a.left),Ut=Zf(_t.fixed-Ue,Ze,_t.stretch,re),Kt=gA(nt.stretch-Be,Ne,N,a.top),Fn=Zf(nt.fixed-it,dt,nt.stretch,oe),bi=new ct(Qt,Jn),zr=new ct(En,Jn),ki=new ct(En,Kt),Pi=new ct(Qt,Kt),Vr=new ct(St/b,Xt/b),lr=new ct(Ut/b,Fn/b),cr=i*Math.PI/180;if(cr){const Fi=Math.sin(cr),wi=Math.cos(cr),ur=[wi,-Fi,Fi,wi];bi._matMult(ur),zr._matMult(ur),Pi._matMult(ur),ki._matMult(ur)}const Ri=et.stretch+et.fixed,Gr=rt.stretch+rt.fixed;return{tl:bi,tr:zr,bl:Pi,br:ki,tex:{x:x.paddedRect.x+1+Ri,y:x.paddedRect.y+1+Gr,w:_t.stretch+_t.fixed-Ri,h:nt.stretch+nt.fixed-Gr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:lr,minFontScaleX:Ze/b/F,minFontScaleY:dt/b/N,isSDF:l}};if(u&&(x.stretchX||x.stretchY)){const et=r_(V,Ae,re),rt=r_(j,xe,oe);for(let _t=0;_t<et.length-1;_t++){const nt=et[_t],Qt=et[_t+1];for(let St=0;St<rt.length-1;St++)f.push(pt(nt,rt[St],Qt,rt[St+1]))}}else f.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return f}function zc(a,i,l){let u=0;for(const f of a)u+=Math.max(i,Math.min(l,f[1]))-Math.max(i,Math.min(l,f[0]));return u}function r_(a,i,l){const u=[{fixed:-1,stretch:0}];for(const[f,x]of a){const b=u[u.length-1];u.push({fixed:f-b.stretch,stretch:b.stretch}),u.push({fixed:f-b.stretch,stretch:b.stretch+(x-f)})}return u.push({fixed:i+1,stretch:l}),u}function gA(a,i,l,u){return a/i*l+u}function Zf(a,i,l,u){return a-i*l/u}function s1(a,i,l,u){const f=i+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(i+a.positionedLines[u-1].lineOffset))/2}Wu.loadGlyphRange=function(a,i,l,u,f){const x=256*i,b=x+255,M=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${x}-${b}`),pa.Glyphs);Z(M,(P,F)=>{if(P)f(P);else if(F){const N={},V=new uA(F).readFields(Yw,{});for(const j of V.glyphs)N[j.id]=j;f(null,{glyphs:N,ascender:V.ascender,descender:V.descender})}})},Wu.TinySDF=class{constructor({fontSize:a=24,buffer:i=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:x="normal",fontStyle:b="normal"}){this.buffer=i,this.cutoff=u,this.radius=l;const M=this.size=a+4*i,P=this._createCanvas(M),F=this.ctx=P.getContext("2d",{willReadFrequently:!0});F.font=`${b} ${x} ${a}px ${f}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(a){const i=document.createElement("canvas");return i.width=i.height=a,i}draw(a){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:x}=this.ctx.measureText(a),b=Math.floor(l),M=Math.min(this.size-this.buffer,Math.ceil(x-f)),P=Math.min(this.size-this.buffer,Math.ceil(l)+Math.ceil(u)),F=M+2*this.buffer,N=P+2*this.buffer,V=F*N,j=new Uint8ClampedArray(V),q={data:j,width:F,height:N,glyphWidth:M,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:i};if(0===M||0===P)return q;const{ctx:re,buffer:oe,gridInner:Ae,gridOuter:xe}=this;re.clearRect(oe,oe,M,P),re.fillText(a,oe,oe+b+1);const Me=re.getImageData(oe,oe,M,P);xe.fill(Nc,0,V),Ae.fill(0,0,V);for(let Le=0;Le<P;Le++)for(let Be=0;Be<M;Be++){const Ne=Me.data[4*(Le*M+Be)+3]/255;if(0===Ne)continue;const Ue=(Le+oe)*F+Be+oe;if(1===Ne)xe[Ue]=0,Ae[Ue]=Nc;else{const Ze=.5-Ne;xe[Ue]=Ze>0?Ze*Ze:0,Ae[Ue]=Ze<0?Ze*Ze:0}}pA(xe,0,0,F,N,F,this.f,this.v,this.z),pA(Ae,oe,oe,M,P,F,this.f,this.v,this.z);for(let Le=0;Le<V;Le++){const Be=Math.sqrt(xe[Le])-Math.sqrt(Ae[Le]);j[Le]=Math.round(255-255*(Be/this.radius+this.cutoff))}return q}};class i_{constructor(i=[],l=qm){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:u}=this,f=l[i];for(;i>0;){const x=i-1>>1,b=l[x];if(u(f,b)>=0)break;l[i]=b,i=x}l[i]=f}_down(i){const{data:l,compare:u}=this,f=this.length>>1,x=l[i];for(;i<f;){let b=1+(i<<1),M=l[b];const P=b+1;if(P<this.length&&u(l[P],M)<0&&(b=P,M=l[P]),u(M,x)>=0)break;l[i]=M,i=b}l[i]=x}}function qm(a,i){return a<i?-1:a>i?1:0}function o_(a,i=1,l=!1){let u=1/0,f=1/0,x=-1/0,b=-1/0;const M=a[0];for(let q=0;q<M.length;q++){const re=M[q];(!q||re.x<u)&&(u=re.x),(!q||re.y<f)&&(f=re.y),(!q||re.x>x)&&(x=re.x),(!q||re.y>b)&&(b=re.y)}const P=Math.min(x-u,b-f);let F=P/2;const N=new i_([],Kw);if(0===P)return new ct(u,f);for(let q=u;q<x;q+=P)for(let re=f;re<b;re+=P)N.push(new Qu(q+F,re+F,F,a));let V=function(q){let re=0,oe=0,Ae=0;const xe=q[0];for(let Me=0,Le=xe.length,Be=Le-1;Me<Le;Be=Me++){const Ne=xe[Me],Ue=xe[Be],Ze=Ne.x*Ue.y-Ue.x*Ne.y;oe+=(Ne.x+Ue.x)*Ze,Ae+=(Ne.y+Ue.y)*Ze,re+=3*Ze}return new Qu(oe/re,Ae/re,0,q)}(a),j=N.length;for(;N.length;){const q=N.pop();(q.d>V.d||!V.d)&&(V=q,l&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,j)),q.max-V.d<=i||(F=q.h/2,N.push(new Qu(q.p.x-F,q.p.y-F,F,a)),N.push(new Qu(q.p.x+F,q.p.y-F,F,a)),N.push(new Qu(q.p.x-F,q.p.y+F,F,a)),N.push(new Qu(q.p.x+F,q.p.y+F,F,a)),j+=4)}return l&&(console.log(`num probes: ${j}`),console.log(`best distance: ${V.d}`)),V.p}function Kw(a,i){return i.max-a.max}function Qu(a,i,l,u){this.p=new ct(a,i),this.h=l,this.d=function(f,x){let b=!1,M=1/0;for(let P=0;P<x.length;P++){const F=x[P];for(let N=0,V=F.length,j=V-1;N<V;j=N++){const q=F[N],re=F[j];q.y>f.y!=re.y>f.y&&f.x<(re.x-q.x)*(f.y-q.y)/(re.y-q.y)+q.x&&(b=!b),M=Math.min(M,hm(f,q,re))}}return(b?1:-1)*Math.sqrt(M)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Zm=Number.POSITIVE_INFINITY,s_=Math.sqrt(2);function a_(a,i){return i[1]!==Zm?function(l,u,f){let x=0,b=0;switch(u=Math.abs(u),f=Math.abs(f),l){case"top-right":case"top-left":case"top":b=f-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-f}switch(l){case"top-right":case"bottom-right":case"right":x=-u;break;case"top-left":case"bottom-left":case"left":x=u}return[x,b]}(a,i[0],i[1]):function(l,u){let f=0,x=0;u<0&&(u=0);const b=u/s_;switch(l){case"top-right":case"top-left":x=b-7;break;case"bottom-right":case"bottom-left":x=7-b;break;case"bottom":x=7-u;break;case"top":x=u-7}switch(l){case"top-right":case"bottom-right":f=-b;break;case"top-left":case"bottom-left":f=b;break;case"left":f=u;break;case"right":f=-u}return[f,x]}(a,i[0])}function a1(a,i,l,u,f,x,b,M){a.createArrays(),a.tilePixelRatio=ar/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const P=a.layers[0].layout,F=a.layers[0]._unevaluatedLayout._values,N={};if("composite"===a.textSizeData.kind){const{minZoom:q,maxZoom:re}=a.textSizeData;N.compositeTextSizes=[F["text-size"].possiblyEvaluate(new te(q),b),F["text-size"].possiblyEvaluate(new te(re),b)]}if("composite"===a.iconSizeData.kind){const{minZoom:q,maxZoom:re}=a.iconSizeData;N.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new te(q),b),F["icon-size"].possiblyEvaluate(new te(re),b)]}N.layoutTextSize=F["text-size"].possiblyEvaluate(new te(M+1),b),N.layoutIconSize=F["icon-size"].possiblyEvaluate(new te(M+1),b),N.textMaxSize=F["text-size"].possiblyEvaluate(new te(18),b);const V="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),j=P.get("text-size");for(const q of a.features){const re=P.get("text-font").evaluate(q,{},b).join(","),oe=j.evaluate(q,{},b),Ae=N.layoutTextSize.evaluate(q,{},b),xe=(N.layoutIconSize.evaluate(q,{},b),{horizontal:{},vertical:void 0}),Me=q.text;let Le,Be=[0,0];if(Me){const Ze=Me.toString(),it=24*P.get("text-letter-spacing").evaluate(q,{},b),dt=24*P.get("text-line-height").evaluate(q,{},b),pt=sm(Ze)?it:0,et=P.get("text-anchor").evaluate(q,{},b),rt=P.get("text-variable-anchor");if(!rt){const Xt=P.get("text-radial-offset").evaluate(q,{},b);Be=Xt?a_(et,[24*Xt,Zm]):P.get("text-offset").evaluate(q,{},b).map(En=>24*En)}let _t=V?"center":P.get("text-justify").evaluate(q,{},b);const nt=P.get("symbol-placement"),Qt="point"===nt,St="point"===nt?24*P.get("text-max-width").evaluate(q,{},b):0,Jn=Xt=>{a.allowVerticalPlacement&&Pl(Ze)&&(xe.vertical=Nm(Me,i,l,f,re,St,dt,et,Xt,pt,Be,Ds.vertical,!0,nt,Ae,oe))};if(!V&&rt){const Xt="auto"===_t?rt.map(Ut=>Ss(Ut)):[_t];let En=!1;for(let Ut=0;Ut<Xt.length;Ut++){const Kt=Xt[Ut];if(!xe.horizontal[Kt])if(En)xe.horizontal[Kt]=xe.horizontal[0];else{const Fn=Nm(Me,i,l,f,re,St,dt,"center",Kt,pt,Be,Ds.horizontal,!1,nt,Ae,oe);Fn&&(xe.horizontal[Kt]=Fn,En=1===Fn.positionedLines.length)}}Jn("left")}else{if("auto"===_t&&(_t=Ss(et)),Qt||P.get("text-writing-mode").indexOf("horizontal")>=0||!Pl(Ze)){const Xt=Nm(Me,i,l,f,re,St,dt,et,_t,pt,Be,Ds.horizontal,!1,nt,Ae,oe);Xt&&(xe.horizontal[_t]=Xt)}Jn("point"===nt?"left":_t)}}let Ne=!1;if(q.icon&&q.icon.name){const Ze=u[q.icon.name];Ze&&(Le=Zu(f[q.icon.name],P.get("icon-offset").evaluate(q,{},b),P.get("icon-anchor").evaluate(q,{},b)),Ne=Ze.sdf,void 0===a.sdfIcons?a.sdfIcons=Ze.sdf:a.sdfIcons!==Ze.sdf&&Lr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==a.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Ue=c_(xe.horizontal)||xe.vertical;a.iconsInText||(a.iconsInText=!!Ue&&Ue.iconsInText),(Ue||Le)&&l1(a,q,xe,Le,u,N,Ae,0,Be,Ne,b)}x&&a.generateCollisionDebugBuffers(M,a.collisionBoxArray)}function Ss(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function l1(a,i,l,u,f,x,b,M,P,F,N){let V=x.textMaxSize.evaluate(i,{},N);void 0===V&&(V=b);const j=a.layers[0].layout,q=j.get("icon-offset").evaluate(i,{},N),re=c_(l.horizontal)||l.vertical,oe=b/24,Ae=a.tilePixelRatio*V/24,xe=a.tilePixelRatio*j.get("symbol-spacing"),Me=j.get("text-padding")*a.tilePixelRatio,Le=j.get("icon-padding")*a.tilePixelRatio,Be=Wn(j.get("text-max-angle")),Ne="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ue="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ze=j.get("symbol-placement"),it=xe/2,dt=j.get("icon-text-fit");let pt;u&&"none"!==dt&&(a.allowVerticalPlacement&&l.vertical&&(pt=jm(u,l.vertical,dt,j.get("icon-text-fit-padding"),q,oe)),re&&(u=jm(u,re,dt,j.get("icon-text-fit-padding"),q,oe)));const et=(rt,_t)=>{_t.x<0||_t.x>=ar||_t.y<0||_t.y>=ar||function(nt,Qt,St,Jn,Xt,En,Ut,Kt,Fn,bi,zr,ki,Pi,Vr,lr,cr,Ri,Gr,Fi,wi,ur,Xr,Er,Dr){const Yr=nt.addToLineVertexArray(Qt,Jn);let Bo,Kr,Jr,zn,Oi,es,Ms,Ts=0,Ia=0,ka=0,po=0,ra=-1,Yu=-1;const Is={};let Zh=mf(""),Gc=0,sp=0;if(void 0===Fn._unevaluatedLayout.getValue("text-radial-offset")?[Gc,sp]=Fn.layout.get("text-offset").evaluate(ur,{},Dr).map(ts=>24*ts):(Gc=24*Fn.layout.get("text-radial-offset").evaluate(ur,{},Dr),sp=Zm),nt.allowVerticalPlacement&&Xt.vertical){const ts=Xt.vertical;if(lr)es=Wm(ts),Kt&&(Ms=Wm(Kt));else{const ns=Fn.layout.get("text-rotate").evaluate(ur,{},Dr)+90;Jr=Wf(bi,St,Qt,zr,ki,Pi,ts,Vr,ns,cr),Kt&&(zn=Wf(bi,St,Qt,zr,ki,Pi,Kt,Gr,ns))}}if(En){const ts=Fn.layout.get("icon-rotate").evaluate(ur,{},Dr),ns="none"!==Fn.layout.get("icon-text-fit"),DA=qf(En,ts,Er,ns),ug=Kt?qf(Kt,ts,Er,ns):void 0;Kr=Wf(bi,St,Qt,zr,ki,Pi,En,Gr,ts),Ts=4*DA.length;const _1=nt.iconSizeData;let Ku=null;"source"===_1.kind?(Ku=[el*Fn.layout.get("icon-size").evaluate(ur,{},Dr)],Ku[0]>Ll&&Lr(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===_1.kind&&(Ku=[el*Xr.compositeIconSizes[0].evaluate(ur,{},Dr),el*Xr.compositeIconSizes[1].evaluate(ur,{},Dr)],(Ku[0]>Ll||Ku[1]>Ll)&&Lr(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,DA,Ku,wi,Fi,ur,!1,St,Qt,Yr.lineStartIndex,Yr.lineLength,-1,Dr),ra=nt.icon.placedSymbolArray.length-1,ug&&(Ia=4*ug.length,nt.addSymbols(nt.icon,ug,Ku,wi,Fi,ur,Ds.vertical,St,Qt,Yr.lineStartIndex,Yr.lineLength,-1,Dr),Yu=nt.icon.placedSymbolArray.length-1)}for(const ts in Xt.horizontal){const ns=Xt.horizontal[ts];Bo||(Zh=mf(ns.text),lr?Oi=Wm(ns):Bo=Wf(bi,St,Qt,zr,ki,Pi,ns,Vr,Fn.layout.get("text-rotate").evaluate(ur,{},Dr),cr));const DA=1===ns.positionedLines.length;if(ka+=l_(nt,St,Qt,ns,Ut,Fn,lr,ur,cr,Yr,Xt.vertical?Ds.horizontal:Ds.horizontalOnly,DA?Object.keys(Xt.horizontal):[ts],Is,ra,Xr,Dr),DA)break}Xt.vertical&&(po+=l_(nt,St,Qt,Xt.vertical,Ut,Fn,lr,ur,cr,Yr,Ds.vertical,["vertical"],Is,Yu,Xr,Dr));let Hc=-1;const cg=(ts,ns)=>ts?Math.max(ts,ns):ns;Hc=cg(Oi,Hc),Hc=cg(es,Hc),Hc=cg(Ms,Hc);const Wh=Hc>-1?1:0;nt.glyphOffsetArray.length>=to.MAX_GLYPHS&&Lr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ur.sortKey&&nt.addToSortKeyRanges(nt.symbolInstances.length,ur.sortKey),nt.symbolInstances.emplaceBack(St.x,St.y,St.z,Qt.x,Qt.y,Is.right>=0?Is.right:-1,Is.center>=0?Is.center:-1,Is.left>=0?Is.left:-1,Is.vertical>=0?Is.vertical:-1,ra,Yu,Zh,void 0!==Bo?Bo:nt.collisionBoxArray.length,void 0!==Bo?Bo+1:nt.collisionBoxArray.length,void 0!==Jr?Jr:nt.collisionBoxArray.length,void 0!==Jr?Jr+1:nt.collisionBoxArray.length,void 0!==Kr?Kr:nt.collisionBoxArray.length,void 0!==Kr?Kr+1:nt.collisionBoxArray.length,zn||nt.collisionBoxArray.length,zn?zn+1:nt.collisionBoxArray.length,zr,ka,po,Ts,Ia,Wh,0,Gc,sp,Hc)}(a,_t,_t,rt,l,u,f,pt,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,Me,Ne,P,0,Le,Ue,q,i,x,F,N)};if("line"===Ze)for(const rt of Gm(i.geometry,0,0,ar,ar)){const _t=n_(rt,xe,Be,l.vertical||re,u,24,Ae,a.overscaling,ar);for(const nt of _t){const Qt=re;Qt&&u_(a,Qt.text,it,nt)||et(rt,nt)}}else if("line-center"===Ze){for(const rt of i.geometry)if(rt.length>1){const _t=t_(rt,Be,l.vertical||re,u,24,Ae);_t&&et(rt,_t)}}else if("Polygon"===i.type)for(const rt of vm(i.geometry,0)){const _t=o_(rt,16);et(rt[0],new Ol(_t.x,_t.y,0,0,void 0))}else if("LineString"===i.type)for(const rt of i.geometry)et(rt,new Ol(rt[0].x,rt[0].y,0,0,void 0));else if("Point"===i.type)for(const rt of i.geometry)for(const _t of rt)et([_t],new Ol(_t.x,_t.y,0,0,void 0))}const Ll=32640;function l_(a,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe){const Ae=function(Le,Be,Ne,Ue,Ze,it,dt,pt){const et=[];if(0===Be.positionedLines.length)return et;const rt=Ue.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,_t=function(Xt){const En=Xt[0],Ut=Xt[1],Kt=En*Ut;return Kt>0?[En,-Ut]:Kt<0?[-En,Ut]:0===En?[Ut,En]:[Ut,-En]}(Ne);let nt=Math.abs(Be.top-Be.bottom);for(const Xt of Be.positionedLines)nt-=Xt.lineOffset;const Qt=Be.positionedLines.length,St=nt/Qt;let Jn=Be.top-Ne[1];for(let Xt=0;Xt<Qt;++Xt){const En=Be.positionedLines[Xt];Jn=s1(Be,St,Jn,Xt);for(const Ut of En.positionedGlyphs){if(!Ut.rect)continue;const Kt=Ut.rect||{};let Fn=4,bi=!0,zr=1,ki=0;if(Ut.imageName){const zn=dt[Ut.imageName];if(!zn)continue;if(zn.sdf){Lr("SDF images are not supported in formatted text and will be ignored.");continue}bi=!1,zr=zn.pixelRatio,Fn=1/zr}const Pi=(Ze||pt)&&Ut.vertical,Vr=Ut.metrics.advance*Ut.scale/2,lr=Ut.metrics,cr=Ut.rect;if(null===cr)continue;pt&&Be.verticalizable&&(ki=Ut.imageName?Vr-Ut.metrics.width*Ut.scale/2:0);const Ri=Ze?[Ut.x+Vr,Ut.y]:[0,0];let Gr=[0,0],Fi=[0,0],wi=!1;Ze||(Pi?(Fi=[Ut.x+Vr+_t[0],Ut.y+_t[1]-ki],wi=!0):Gr=[Ut.x+Vr+Ne[0],Ut.y+Ne[1]-ki]);const ur=cr.w*Ut.scale/(zr*(Ut.localGlyph?2:1)),Xr=cr.h*Ut.scale/(zr*(Ut.localGlyph?2:1));let Er,Dr,Yr,Bo;if(Pi){const zn=Ut.y-Jn,Oi=new ct(-Vr,Vr-zn),es=-Math.PI/2,Ms=new ct(...Fi);Er=new ct(-Vr+Gr[0],Gr[1]),Er._rotateAround(es,Oi)._add(Ms),Er.x+=-zn+Vr,Er.y-=(lr.left-Fn)*Ut.scale;const Ts=Ut.imageName?lr.advance*Ut.scale:24*Ut.scale,Ia=String.fromCharCode(Ut.glyph);n1(Ia)?Er.x+=(1-Fn)*Ut.scale:Z0(Ia)?Er.x+=Ts-lr.height*Ut.scale+(-Fn-1)*Ut.scale:Er.x+=Ut.imageName||lr.width+2*Fn===cr.w&&lr.height+2*Fn===cr.h?(Ts-Xr)/2:(Ts-(lr.height+2*Fn)*Ut.scale)/2,Dr=new ct(Er.x,Er.y-ur),Yr=new ct(Er.x+Xr,Er.y),Bo=new ct(Er.x+Xr,Er.y-ur)}else{const zn=(lr.left-Fn)*Ut.scale-Vr+Gr[0],Oi=(-lr.top-Fn)*Ut.scale+Gr[1],es=zn+ur,Ms=Oi+Xr;Er=new ct(zn,Oi),Dr=new ct(es,Oi),Yr=new ct(zn,Ms),Bo=new ct(es,Ms)}if(rt){let zn;zn=Ze?new ct(0,0):wi?new ct(_t[0],_t[1]):new ct(Ne[0],Ne[1]),Er._rotateAround(rt,zn),Dr._rotateAround(rt,zn),Yr._rotateAround(rt,zn),Bo._rotateAround(rt,zn)}const Kr=new ct(0,0),Jr=new ct(0,0);et.push({tl:Er,tr:Dr,bl:Yr,br:Bo,tex:Kt,writingMode:Be.writingMode,glyphOffset:Ri,sectionIndex:Ut.sectionIndex,isSDF:bi,pixelOffsetTL:Kr,pixelOffsetBR:Jr,minFontScaleX:0,minFontScaleY:0})}}return et}(0,u,P,x,b,M,f,a.allowVerticalPlacement),xe=a.textSizeData;let Me=null;"source"===xe.kind?(Me=[el*x.layout.get("text-size").evaluate(M,{},oe)],Me[0]>Ll&&Lr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===xe.kind&&(Me=[el*re.compositeTextSizes[0].evaluate(M,{},oe),el*re.compositeTextSizes[1].evaluate(M,{},oe)],(Me[0]>Ll||Me[1]>Ll)&&Lr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,Ae,Me,P,b,M,N,i,l,F.lineStartIndex,F.lineLength,q,oe);for(const Le of V)j[Le]=a.text.placedSymbolArray.length-1;return 4*Ae.length}function c_(a){for(const i in a)return a[i];return null}function Wf(a,i,l,u,f,x,b,M,P,F){let N=b.top,V=b.bottom,j=b.left,q=b.right;const re=b.collisionPadding;if(re&&(j-=re[0],N-=re[1],q+=re[2],V+=re[3]),P){const oe=new ct(j,N),Ae=new ct(q,N),xe=new ct(j,V),Me=new ct(q,V),Le=Wn(P);let Be=new ct(0,0);F&&(Be=new ct(F[0],F[1])),oe._rotateAround(Le,Be),Ae._rotateAround(Le,Be),xe._rotateAround(Le,Be),Me._rotateAround(Le,Be),j=Math.min(oe.x,Ae.x,xe.x,Me.x),q=Math.max(oe.x,Ae.x,xe.x,Me.x),N=Math.min(oe.y,Ae.y,xe.y,Me.y),V=Math.max(oe.y,Ae.y,xe.y,Me.y)}return a.emplaceBack(i.x,i.y,i.z,l.x,l.y,j,N,q,V,M,u,f,x),a.length-1}function Wm(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const i=a.bottom-a.top;return i>0?Math.max(10,i):null}function u_(a,i,l,u){const f=a.compareText;if(i in f){const x=f[i];for(let b=x.length-1;b>=0;b--)if(u.dist(x[b])<l)return!0}else f[i]=[];return f[i].push(u),!1}const c1=Sa.VectorTileFeature.types,u1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qf(a,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe){const Ae=N?Math.min(Ll,Math.round(N[0])):0,xe=N?Math.min(Ll,Math.round(N[1])):0;a.emplaceBack(i,l,Math.round(32*b),Math.round(32*M),P,F,(Ae<<1)+(V?1:0),xe,16*j,16*q,256*re,256*oe,u,f,x,0)}function cn(a,i,l){a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l)}function Or(a){for(const i of a.sections)if(_(i.text))return!0;return!1}class Xf{constructor(i){this.layoutVertexArray=new Ao,this.indexArray=new Tn,this.programConfigurations=i,this.segments=new Ii,this.dynamicLayoutVertexArray=new an,this.opacityVertexArray=new Eo,this.placedSymbolArray=new rn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,H0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Bf.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,u1,!0),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pt("SymbolBuffers",Xf);class qh{constructor(i,l,u){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new u,this.segments=new Ii,this.collisionVertexArray=new Do,this.collisionVertexArrayExt=new an}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Jv.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,e1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pt("CollisionBuffers",qh);class to{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(b=>b.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Cf([]),this.placementViewportMatrix=Cf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tm(this.zoom,l["text-size"]),this.iconSizeData=Tm(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),x=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==x&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===x||"auto"===x&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(b=>Ds[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=i.sourceID}createArrays(){this.text=new Xf(new Ys(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Xf(new Ys(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new pv,this.lineVertexArray=new mv,this.symbolInstances=new am}calculateGlyphDependencies(i,l,u,f,x){for(let b=0;b<i.length;b++)if(l[i.charCodeAt(b)]=!0,f&&x){const M=cA[i.charAt(b)];M&&(l[M.charCodeAt(0)]=!0)}}populate(i,l,u){const f=this.layers[0],x=f.layout,b=x.get("text-font"),M=x.get("text-field"),P=x.get("icon-image"),F=("constant"!==M.value.kind||M.value.value instanceof ui&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),N="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,V=x.get("symbol-sort-key");if(this.features=[],!F&&!N)return;const j=l.iconDependencies,q=l.glyphDependencies,re=l.availableImages,oe=new te(this.zoom);for(const{feature:Ae,id:xe,index:Me,sourceLayerIndex:Le}of i){const Be=f._featureFilter.needGeometry,Ne=zu(Ae,Be);if(!f._featureFilter.filter(oe,Ne,u))continue;let Ue,Ze;if(Be||(Ne.geometry=Ks(Ae)),F){const dt=f.getValueAndResolveTokens("text-field",Ne,u,re),pt=ui.factory(dt);Or(pt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===H()||this.hasRTLText&&J.isParsed())&&(Ue=q0(pt,f,Ne))}if(N){const dt=f.getValueAndResolveTokens("icon-image",Ne,u,re);Ze=dt instanceof Po?dt:Po.fromString(dt)}if(!Ue&&!Ze)continue;const it=this.sortFeaturesByKey?V.evaluate(Ne,{},u):void 0;if(this.features.push({id:xe,text:Ue,icon:Ze,index:Me,sourceLayerIndex:Le,geometry:Ne.geometry,properties:Ae.properties,type:c1[Ae.type],sortKey:it}),Ze&&(j[Ze.name]=!0),Ue){const dt=b.evaluate(Ne,{},u).join(","),pt="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ds.vertical)>=0;for(const et of Ue.sections)if(et.image)j[et.image.name]=!0;else{const rt=Pl(Ue.toString()),_t=et.fontStack||dt,nt=q[_t]=q[_t]||{};this.calculateGlyphDependencies(et.text,nt,pt,this.allowVerticalPlacement,rt)}}}"line"===x.get("symbol-placement")&&(this.features=function(Ae){const xe={},Me={},Le=[];let Be=0;function Ne(dt){Le.push(Ae[dt]),Be++}function Ue(dt,pt,et){const rt=Me[dt];return delete Me[dt],Me[pt]=rt,Le[rt].geometry[0].pop(),Le[rt].geometry[0]=Le[rt].geometry[0].concat(et[0]),rt}function Ze(dt,pt,et){const rt=xe[pt];return delete xe[pt],xe[dt]=rt,Le[rt].geometry[0].shift(),Le[rt].geometry[0]=et[0].concat(Le[rt].geometry[0]),rt}function it(dt,pt,et){const rt=et?pt[0][pt[0].length-1]:pt[0][0];return`${dt}:${rt.x}:${rt.y}`}for(let dt=0;dt<Ae.length;dt++){const pt=Ae[dt],et=pt.geometry,rt=pt.text?pt.text.toString():null;if(!rt){Ne(dt);continue}const _t=it(rt,et),nt=it(rt,et,!0);if(_t in Me&&nt in xe&&Me[_t]!==xe[nt]){const Qt=Ze(_t,nt,et),St=Ue(_t,nt,Le[Qt].geometry);delete xe[_t],delete Me[nt],Me[it(rt,Le[St].geometry,!0)]=St,Le[Qt].geometry=null}else _t in Me?Ue(_t,nt,et):nt in xe?Ze(_t,nt,et):(Ne(dt),xe[_t]=Be-1,Me[nt]=Be-1)}return Le.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ae,xe)=>Ae.sortKey-xe.sortKey)}update(i,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,u),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const u=this.lineVertexArray.length;if(void 0!==i.segment){let f=i.dist(l[i.segment+1]),x=i.dist(l[i.segment]);const b={};for(let M=i.segment+1;M<l.length;M++)b[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:f},M<l.length-1&&(f+=l[M+1].dist(l[M]));for(let M=i.segment||0;M>=0;M--)b[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=l[M-1].dist(l[M]));for(let M=0;M<l.length;M++){const P=b[M];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,l,u,f,x,b,M,P,F,N,V,j,q){const re=i.indexArray,oe=i.layoutVertexArray,Ae=i.segments.prepareSegment(4*l.length,oe,re,this.canOverlap?b.sortKey:void 0),xe=this.glyphOffsetArray.length,Me=Ae.vertexLength,Le=this.allowVerticalPlacement&&M===Ds.vertical?Math.PI/2:0,Be=b.text&&b.text.sections;for(let Ne=0;Ne<l.length;Ne++){const{tl:Ue,tr:Ze,bl:it,br:dt,tex:pt,pixelOffsetTL:et,pixelOffsetBR:rt,minFontScaleX:_t,minFontScaleY:nt,glyphOffset:Qt,isSDF:St,sectionIndex:Jn}=l[Ne],Xt=Ae.vertexLength,En=Qt[1];Qf(oe,P.x,P.y,P.z,F.x,F.y,Ue.x,En+Ue.y,pt.x,pt.y,u,St,et.x,et.y,_t,nt),Qf(oe,P.x,P.y,P.z,F.x,F.y,Ze.x,En+Ze.y,pt.x+pt.w,pt.y,u,St,rt.x,et.y,_t,nt),Qf(oe,P.x,P.y,P.z,F.x,F.y,it.x,En+it.y,pt.x,pt.y+pt.h,u,St,et.x,rt.y,_t,nt),Qf(oe,P.x,P.y,P.z,F.x,F.y,dt.x,En+dt.y,pt.x+pt.w,pt.y+pt.h,u,St,rt.x,rt.y,_t,nt),cn(i.dynamicLayoutVertexArray,P,Le),re.emplaceBack(Xt,Xt+1,Xt+2),re.emplaceBack(Xt+1,Xt+2,Xt+3),Ae.vertexLength+=4,Ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qt[0]),Ne!==l.length-1&&Jn===l[Ne+1].sectionIndex||i.programConfigurations.populatePaintArrays(oe.length,b,b.index,{},q,Be&&Be[Jn])}i.placedSymbolArray.emplaceBack(P.x,P.y,P.z,F.x,F.y,xe,this.glyphOffsetArray.length-xe,Me,N,V,F.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],M,0,!1,0,j,0)}_commitLayoutVertex(i,l,u,f,x,b,M){i.emplaceBack(l,u,f,x,b,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(i,l,u,f,x,b,M){const P=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),F=P.vertexLength,N=M.tileAnchorX,V=M.tileAnchorY;for(let q=0;q<4;q++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-i.padding,-i.padding),u.collisionVertexArrayExt.emplaceBack(l,i.padding,-i.padding),u.collisionVertexArrayExt.emplaceBack(l,i.padding,i.padding),u.collisionVertexArrayExt.emplaceBack(l,-i.padding,i.padding),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ct(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ct(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ct(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ct(i.x1,i.y2)),P.vertexLength+=4;const j=u.indexArray;j.emplaceBack(F,F+1),j.emplaceBack(F+1,F+2),j.emplaceBack(F+2,F+3),j.emplaceBack(F+3,F),P.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,u,f,x,b){for(let M=f;M<x;M++){const P=u.get(M),F=this.getSymbolInstanceTextSize(i,b,l,M);this._addCollisionDebugVertices(P,F,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(i,l,u,f,x,b){for(let M=f;M<x;M++){const P=u.get(M),F=this.getSymbolInstanceIconSize(i,l,M);this._addCollisionDebugVertices(P,F,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qh(fo,Oc.members,oi),this.iconCollisionBox=new qh(fo,Oc.members,oi);const u=Fl(this.iconSizeData,i),f=Fl(this.textSizeData,i);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(f,i,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(f,i,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(u,i,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(u,i,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,l,u,f){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),b=Nf(this.textSizeData,i,x)/24;return this.tilePixelRatio*b}getSymbolInstanceIconSize(i,l,u){const f=this.icon.placedSymbolArray.get(u),x=Nf(this.iconSizeData,i,f);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(i,l,u){i.emplaceBack(l,-u,-u),i.emplaceBack(l,u,-u),i.emplaceBack(l,u,u),i.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(i,l,u,f,x,b){for(let M=f;M<x;M++){const P=u.get(M),F=this.getSymbolInstanceTextSize(i,b,l,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,P.padding)}}_updateIconDebugCollisionBoxes(i,l,u,f,x){for(let b=f;b<x;b++){const M=u.get(b),P=this.getSymbolInstanceIconSize(i,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,M.padding)}}updateCollisionDebugBuffers(i,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Fl(this.iconSizeData,i),f=Fl(this.textSizeData,i);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(f,i,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(f,i,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(u,i,l,b.iconBoxStartIndex,b.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,i,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,u,f,x,b,M,P,F){const N={};for(let V=l;V<u;V++){const j=i.get(V);N.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.textFeatureIndex=j.featureIndex;break}for(let V=f;V<x;V++){const j=i.get(V);N.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.verticalTextFeatureIndex=j.featureIndex;break}for(let V=b;V<M;V++){const j=i.get(V);N.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.iconFeatureIndex=j.featureIndex;break}for(let V=P;V<F;V++){const j=i.get(V);N.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.verticalIconFeatureIndex=j.featureIndex;break}return N}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const u=i.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let x=u.vertexStartIndex;x<f;x+=4)i.indexArray.emplaceBack(x,x+1,x+2),i.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),u=Math.cos(i),f=[],x=[],b=[];for(let M=0;M<this.symbolInstances.length;++M){b.push(M);const P=this.symbolInstances.get(M);f.push(0|Math.round(l*P.tileAnchorX+u*P.tileAnchorY)),x.push(P.featureIndex)}return b.sort((M,P)=>f[M]-f[P]||x[P]-x[M]),b}addToSortKeyRanges(i,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((f,x,b)=>{f>=0&&b.indexOf(f)===x&&this.addIndicesForPlacedSymbol(this.text,f)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pt("SymbolBucket",to,{omit:["layers","collisionBoxArray","features","compareText"]}),to.MAX_GLYPHS=65535,to.addDynamicAttributes=cn;const h_=new $e({"symbol-placement":new de(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new de(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new de(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fe(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new de(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new de(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new de(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new de(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new de(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fe(Ce.layout_symbol["icon-size"]),"icon-text-fit":new de(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new de(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fe(Ce.layout_symbol["icon-image"]),"icon-rotate":new Fe(Ce.layout_symbol["icon-rotate"]),"icon-padding":new de(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new de(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Fe(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Fe(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new de(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new de(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new de(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Fe(Ce.layout_symbol["text-field"]),"text-font":new Fe(Ce.layout_symbol["text-font"]),"text-size":new Fe(Ce.layout_symbol["text-size"]),"text-max-width":new Fe(Ce.layout_symbol["text-max-width"]),"text-line-height":new Fe(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Fe(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Fe(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Fe(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new de(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Fe(Ce.layout_symbol["text-anchor"]),"text-max-angle":new de(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new de(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Fe(Ce.layout_symbol["text-rotate"]),"text-padding":new de(Ce.layout_symbol["text-padding"]),"text-keep-upright":new de(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Fe(Ce.layout_symbol["text-transform"]),"text-offset":new Fe(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new de(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new de(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new de(Ce.layout_symbol["text-optional"])});var Qm={paint:new $e({"icon-opacity":new Fe(Ce.paint_symbol["icon-opacity"]),"icon-color":new Fe(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Fe(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fe(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fe(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new de(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new de(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fe(Ce.paint_symbol["text-opacity"]),"text-color":new Fe(Ce.paint_symbol["text-color"],{runtimeType:Gn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Fe(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Fe(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Fe(Ce.paint_symbol["text-halo-blur"]),"text-translate":new de(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new de(Ce.paint_symbol["text-translate-anchor"])}),layout:h_};class Yf{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Ga,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt("FormatSectionOverride",Yf,{omit:["defaultValue"]});class ta extends Da{constructor(i){super(i,Qm)}recalculate(i,l){super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const x of u)f.indexOf(x)<0&&f.push(x);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,l,u,f){const x=this.layout.get(i).evaluate(l,{},u,f),b=this._unevaluatedLayout._values[i];return b.isDataDriven()||Zr(b.value)||!x?x:(M=l.properties,x.replace(/{([^{}]+)}/g,(F,N)=>N in M?String(M[N]):""));var M}createBucket(i){return new to(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Qm.paint.overridableProperties){if(!ta.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),u=new Yf(l),f=new Ch(u,l.property.specification);let x=null;x="constant"===l.value.kind||"source"===l.value.kind?new Eh("source",f):new Wa("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new ve(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&ta.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const u=i.get("text-field"),f=Qm.paint.properties[l];let x=!1;const b=M=>{for(const P of M)if(f.overrides&&f.overrides.hasOverride(P))return void(x=!0)};if("constant"===u.value.kind&&u.value.value instanceof ui)b(u.value.value.sections);else if("source"===u.value.kind){const M=F=>{x||(F instanceof hi&&pi(F.value)===qt?b(F.value.sections):F instanceof _u?b(F.sections):F.eachChild(M))},P=u.value;P._styleExpression&&M(P._styleExpression.expression)}return x}getProgramConfiguration(i){return new Ea(this,i)}}var Xm={paint:new $e({"background-color":new de(Ce.paint_background["background-color"]),"background-pattern":new tt(Ce.paint_background["background-pattern"]),"background-opacity":new de(Ce.paint_background["background-opacity"])})},d_={paint:new $e({"raster-opacity":new de(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new de(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new de(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new de(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new de(Ce.paint_raster["raster-saturation"]),"raster-contrast":new de(Ce.paint_raster["raster-contrast"]),"raster-resampling":new de(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new de(Ce.paint_raster["raster-fade-duration"])})};class Ym extends Da{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var Jw={paint:new $e({"sky-type":new de(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new de(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new de(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new de(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new de(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Pe(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new de(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new de(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new de(Ce.paint_sky["sky-opacity"])})};function Kf(a,i,l){const u=Bh(0,0,1),f=Sf(zh());return function(x,b,M){M*=.5;var P=b[0],F=b[1],N=b[2],V=b[3],j=Math.sin(M),q=Math.cos(M);x[0]=P*q-N*j,x[1]=F*q+V*j,x[2]=N*q+P*j,x[3]=V*q-F*j}(f,f,l?-Wn(a)+Math.PI:Wn(a)),$u(f,f,-Wn(i)),dm(u,u,f),Mv(u,u)}const e2={circle:class extends Da{constructor(a){super(a,wf)}createBucket(a){return new um(a)}queryRadius(a){const i=a;return Vu("circle-radius",this,i)+Vu("circle-stroke-width",this,i)+Kd(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,l,u,f,x,b,M){const P=Uu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),F=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return I0(a,u,x,b,M,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),P,F)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Ea(this,a)}},heatmap:class extends Da{createBucket(a){return new fm(a)}constructor(a){super(a,Rv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Vu("heatmap-radius",this,a)}queryIntersectsFeature(a,i,l,u,f,x,b,M){const P=this.paint.get("heatmap-radius").evaluate(i,l);return I0(a,u,x,b,M,!0,!0,new ct(0,0),P)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Ea(this,a)}},hillshade:class extends Da{constructor(a){super(a,Fv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(a){return new Ea(this,a)}},fill:class extends Da{constructor(a){super(a,Fr)}getProgramIds(){const a=this.paint.get("fill-pattern"),i=a&&a.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Ea(this,a)}recalculate(a,i){super.recalculate(a,i);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new sA(a)}queryRadius(){return Kd(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,l,u,f,x){return!a.queryGeometry.isAboveHorizon&&bf(Sv(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Da{constructor(a){super(a,Em)}createBucket(a){return new Ji(a)}queryRadius(){return Kd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Ea(this,a)}queryIntersectsFeature(a,i,l,u,f,x,b,M,P){const F=Uu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(i,l),V=this.paint.get("fill-extrusion-base").evaluate(i,l),j=[0,0],q=M&&x.elevation,re=x.elevation?x.elevation.exaggeration():1;if(q){const xe=a.tile.getBucket(this).centroidVertexArray,Me=P+1;if(Me<xe.length){const Le=xe.get(Me);j[0]=Le.a_centroid_pos0,j[1]=Le.a_centroid_pos1}}if(0===j[0]&&1===j[1])return!1;const oe=(xe=u,Me=V,Le=N,Be=F,Ne=b,(Ue=q?M:null)?function(pt,et,rt,_t,nt,Qt,St,Jn,Xt){const En=[],Ut=[],Kt=[0,0,0,1];for(const Fn of pt){const bi=[],zr=[];for(const ki of Fn){const Pi=ki.x+_t.x,Vr=ki.y+_t.y,lr=Zv(Pi,Vr,et,rt,Qt,St,Jn,Xt);Kt[0]=Pi,Kt[1]=Vr,Kt[2]=lr.base,Kt[3]=1,tA(Kt,Kt,nt),Kt[3]=Math.max(Kt[3],1e-5);const cr=Dm([Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]]);Kt[0]=Pi,Kt[1]=Vr,Kt[2]=lr.top,Kt[3]=1,tA(Kt,Kt,nt),Kt[3]=Math.max(Kt[3],1e-5);const Ri=Dm([Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]]);bi.push(cr),zr.push(Ri)}En.push(bi),Ut.push(zr)}return[En,Ut]}(xe,Me,Le,Be,Ne,Ue,j,re,x.center.lat):function(pt,et,rt,_t,nt){const Qt=[],St=[],Jn=nt[8]*et,Xt=nt[9]*et,En=nt[10]*et,Ut=nt[11]*et,Kt=nt[8]*rt,Fn=nt[9]*rt,bi=nt[10]*rt,zr=nt[11]*rt;for(const ki of pt){const Pi=[],Vr=[];for(const lr of ki){const cr=lr.x+_t.x,Ri=lr.y+_t.y,Gr=nt[0]*cr+nt[4]*Ri+nt[12],Fi=nt[1]*cr+nt[5]*Ri+nt[13],wi=nt[2]*cr+nt[6]*Ri+nt[14],ur=nt[3]*cr+nt[7]*Ri+nt[15],Xr=Gr+Jn,Er=Fi+Xt,Dr=wi+En,Yr=Math.max(ur+Ut,1e-5),Bo=Gr+Kt,Kr=Fi+Fn,Jr=wi+bi,zn=Math.max(ur+zr,1e-5),Oi=new ct(Xr/Yr,Er/Yr);Oi.z=Dr/Yr,Pi.push(Oi);const es=new ct(Bo/zn,Kr/zn);es.z=Jr/zn,Vr.push(es)}Qt.push(Pi),St.push(Vr)}return[Qt,St]}(xe,Me,Le,Be,Ne)),Ae=a.queryGeometry;var xe,Me,Le,Be,Ne,Ue;return function(xe,Me,Le){let Be=1/0;bf(Le,Me)&&(Be=U0(Le,Me[0]));for(let Ne=0;Ne<Me.length;Ne++){const Ue=Me[Ne],Ze=xe[Ne];for(let it=0;it<Ue.length-1;it++){const dt=Ue[it],pt=[dt,Ue[it+1],Ze[it+1],Ze[it],dt];xf(Le,pt)&&(Be=Math.min(Be,U0(Le,pt)))}}return Be!==1/0&&Be}(oe[0],oe[1],Ae.isPointQuery()?Ae.screenBounds:Ae.screenGeometry)}},line:class extends Da{constructor(a){super(a,Mm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Bi,this.gradientVersion=(this.gradientVersion+1)%hs}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=G0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Lf(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Ea(this,a)}queryRadius(a){const i=a,l=Kv(Vu("line-width",this,i),Vu("line-gap-width",this,i)),u=Vu("line-offset",this,i);return l/2+Math.abs(u)+Kd(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,l,u,f,x){if(a.queryGeometry.isAboveHorizon)return!1;const b=Sv(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),M=a.pixelToTileUnitsFactor/2*Kv(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),P=this.paint.get("line-offset").evaluate(i,l);return P&&(u=function(F,N){const V=[],j=new ct(0,0);for(let q=0;q<F.length;q++){const re=F[q],oe=[];for(let Ae=0;Ae<re.length;Ae++){const xe=re[Ae-1],Me=re[Ae],Le=re[Ae+1],Be=0===Ae?j:Me.sub(xe)._unit()._perp(),Ne=Ae===re.length-1?j:Le.sub(Me)._unit()._perp(),Ue=Be._add(Ne)._unit();Ue._mult(1/(Ue.x*Ne.x+Ue.y*Ne.y)),oe.push(Ue._mult(N)._add(Me))}V.push(oe)}return V}(u,P*a.pixelToTileUnitsFactor)),function(F,N,V){for(let j=0;j<N.length;j++){const q=N[j];if(F.length>=3)for(let re=0;re<q.length;re++)if(Js(F,q[re]))return!0;if(Yd(F,q,V))return!0}return!1}(b,u,M)}isTileClipped(){return!0}},symbol:ta,background:class extends Da{constructor(a){super(a,Xm)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Da{constructor(a){super(a,d_)}getProgramIds(){return["raster"]}},sky:class extends Da{constructor(a){super(a,Jw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=mm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}}getCenter(a,i){const l=this.paint.get("sky-type");if("atmosphere"===l){const u=this.paint.get("sky-atmosphere-sun"),f=!u,x=a.style.light,b=x.properties.get("position");return f&&"viewport"===x.properties.get("anchor")&&Lr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Kf(b.azimuthal,90-b.polar,i):Kf(u[0],90-u[1],i)}if("gradient"===l){const u=this.paint.get("sky-gradient-center");return Kf(u[0],90-u[1],i)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}},{HTMLImageElement:tl,HTMLCanvasElement:_A,HTMLVideoElement:yA,ImageData:Jf,ImageBitmap:Km}=Ct;class ep{constructor(i,l,u,f){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(l,f)}update(i,l,u){const{width:f,height:x}=i,b=!(this.size&&this.size[0]===f&&this.size[1]===x||u),{context:M}=this,{gl:P}=M;if(this.useMipmap=Boolean(l&&l.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!l||!1!==l.premultiply)),b)this.size=[f,x],i instanceof tl||i instanceof _A||i instanceof yA||i instanceof Jf||Km&&i instanceof Km?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,i):P.texImage2D(P.TEXTURE_2D,0,this.format,f,x,0,this.format,P.UNSIGNED_BYTE,i.data);else{const{x:F,y:N}=u||{x:0,y:0};i instanceof tl||i instanceof _A||i instanceof yA||i instanceof Jf||Km&&i instanceof Km?P.texSubImage2D(P.TEXTURE_2D,0,F,N,P.RGBA,P.UNSIGNED_BYTE,i):P.texSubImage2D(P.TEXTURE_2D,0,F,N,f,x,P.RGBA,P.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(i,l,u){const{context:f}=this,{gl:x}=f;x.bindTexture(x.TEXTURE_2D,this.texture),u!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=x.LINEAR),i!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,u||i),this.filter=i),l!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Vc{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Qr?new Qr(i.lng,i.lat):Qr.convert(i),this}setSouthWest(i){return this._sw=i instanceof Qr?new Qr(i.lng,i.lat):Qr.convert(i),this}extend(i){const l=this._sw,u=this._ne;let f,x;if(i instanceof Qr)f=i,x=i;else{if(!(i instanceof Vc))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Vc.convert(i)):this.extend(Qr.convert(i)):this;if(f=i._sw,x=i._ne,!f||!x)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(x.lng,u.lng),u.lat=Math.max(x.lat,u.lat)):(this._sw=new Qr(f.lng,f.lat),this._ne=new Qr(x.lng,x.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:u}=Qr.convert(i);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(i){return!i||i instanceof Vc?i:new Vc(i)}}const h1=6371008.8;class Qr{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qr(La(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,u=this.lat*l,f=i.lat*l,x=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((i.lng-this.lng)*l);return h1*Math.acos(Math.min(x,1))}toBounds(i=0){const l=360*i/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Vc(new Qr(this.lng-u,this.lat-l),new Qr(this.lng+u,this.lat+l))}static convert(i){if(i instanceof Qr)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Qr(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Qr(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const d1=2*Math.PI*h1;function Jm(a){return d1*Math.cos(a*Math.PI/180)}function eg(a){return(180+a)/360}function A_(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function vA(a,i){return a/Jm(i)}function tg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function f_(a,i){return a*Jm(tg(i))}class xA{constructor(i,l,u=0){this.x=+i,this.y=+l,this.z=+u}static fromLngLat(i,l=0){const u=Qr.convert(i);return new xA(eg(u.lng),A_(u.lat),vA(l,u.lat))}toLngLat(){return new Qr(360*this.x-180,tg(this.y))}toAltitude(){return f_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/d1*(i=tg(this.y),1/Math.cos(i*Math.PI/180));var i}}class p_{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new Rc({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const u=this.getKey(i,l);return this.positions[u]}trim(){const i=this.width,l=this.height=Al(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,u){const f=[];let x=i.length%2==1?-i[i.length-1]*u:0,b=i[0]*u,M=!0;f.push({left:x,right:b,isDash:M,zeroLength:0===i[0]});let P=i[0];for(let F=1;F<i.length;F++){M=!M;const N=i[F];x=P*u,P+=N,b=P*u,f.push({left:x,right:b,isDash:M,zeroLength:0===N})}return f}addRoundDash(i,l,u){const f=l/2;for(let x=-u;x<=u;x++){const b=this.width*(this.nextRow+u+x);let M=0,P=i[M];for(let F=0;F<this.width;F++){F/P.right>1&&(P=i[++M]);const N=Math.abs(F-P.left),V=Math.abs(F-P.right),j=Math.min(N,V);let q;const re=x/u*(f+1);if(P.isDash){const oe=f-Math.abs(re);q=Math.sqrt(j*j+oe*oe)}else q=f-Math.sqrt(j*j+re*re);this.image.data[b+F]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(i,l){for(let P=i.length-1;P>=0;--P){const F=i[P],N=i[P+1];F.zeroLength?i.splice(P,1):N&&N.isDash===F.isDash&&(N.left=F.left,i.splice(P,1))}const u=i[0],f=i[i.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const x=this.width*this.nextRow;let b=0,M=i[b];for(let P=0;P<this.width;P++){P/M.right>1&&(M=i[++b]);const F=Math.abs(P-M.left),N=Math.abs(P-M.right),V=Math.min(F,N);this.image.data[x+P]=Math.max(0,Math.min(255,(M.isDash?V:-V)+l+128))}}addDash(i,l){const u=this.getKey(i,l);if(this.positions[u])return this.positions[u];const f="round"===l,x=f?7:0,b=2*x+1;if(this.nextRow+b>this.height)return Lr("LineAtlas out of space"),null;0===i.length&&i.push(1);let M=0;for(let N=0;N<i.length;N++)i[N]<0&&(Lr("Negative value is found in line dasharray, replacing values with 0"),i[N]=0),M+=i[N];if(0!==M){const N=this.width/M,V=this.getDashRanges(i,this.width,N);f?this.addRoundDash(V,N,x):this.addRegularDash(V,"square"===l?.5*N:0)}const P=this.nextRow+x;this.nextRow+=b;const F={tl:[P,x],br:[M,0]};return this.positions[u]=F,F}}Pt("LineAtlas",p_);class t2{constructor(i){this._callback=i,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const n2=Ct.performance;function A1(a){const i=a?a.url.toString():void 0;return n2.getEntriesByName(i)}class r2{constructor(){this.tasks={},this.taskQueue=[],rc(["process"],this),this.invoker=new t2(this.process),this.nextId=0}add(i,l){const u=this.nextId++,f=function({type:x,isSymbolTile:b,zoom:M}){return M=M||0,"message"===x?0:"maybePrepare"!==x||b?"parseTile"!==x||b?"parseTile"===x&&b?300-M:"maybePrepare"===x&&b?400-M:500:200-M:100-M}(l);if(0===f){fl();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:i,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){fl();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const x=this.tasks[this.taskQueue[f]];x.priority<l&&(l=x.priority,i=f)}if(null===i)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}function f1(a,i,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,i*u-2*Math.PI*6378137/2]}class m_{constructor(i,l,u){this.z=i,this.x=l,this.y=u,this.key=Xu(0,i,i,l,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l){const u=(x=this.y,b=this.z,M=f1(256*(f=this.x),256*(x=Math.pow(2,b)-x-1),b),P=f1(256*(f+1),256*(x+1),b),M[0]+","+M[1]+","+P[0]+","+P[1]);var f,x,b,M,P;const F=function(N,V,j){let q,re="";for(let oe=N;oe>0;oe--)q=1<<oe-1,re+=(V&q?1:0)+(j&q?2:0);return re}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",u)}getTilePoint(i){const l=Math.pow(2,this.z);return new ct((i.x*l-this.x)*ar,(i.y*l-this.y)*ar)}getTileVec3(i){const l=Math.pow(2,this.z);return Bh((i.x*l-this.x)*ar,(i.y*l-this.y)*ar,f_(i.z,i.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class p1{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Xu(i,l.z,l.z,l.x,l.y)}}class Ai{constructor(i,l,u,f,x){this.overscaledZ=i,this.wrap=l,this.canonical=new m_(u,+f,+x),this.key=0===l&&i===u?this.canonical.key:Xu(l,i,u,f,x)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new Ai(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ai(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return Xu(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return Xu(this.wrap*+l,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Ai(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new Ai(l,this.wrap,l,u,f),new Ai(l,this.wrap,l,u+1,f),new Ai(l,this.wrap,l,u,f+1),new Ai(l,this.wrap,l,u+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Ai(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Ai(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new xA(i.x-this.wrap,i.y))}getTileVec3(i){return this.canonical.getTileVec3(new xA(i.x-this.wrap,i.y,i.z))}}function Xu(a,i,l,u,f){const x=1<<Math.min(l,22);let b=x*(f%x)+u%x;return a&&l<22&&(b+=x*x*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*b+l)+(i-l)}Pt("CanonicalTileID",m_),Pt("OverscaledTileID",Ai,{omit:["projMatrix"]});class g_{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const u=i[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class ng{constructor(i,l,u,f,x){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=u,i._y=f,this.properties=i.properties,this.id=x}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(i[l]=this[l]);return i}}var rg=Mt([{name:"a_pos",type:"Int16",components:2}]);class ig{constructor(i,l,u){this.tileID=i,this.uid=zs(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const l=i+this.timeAdded;l<uo.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(i,l,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,x){const b={};if(!x)return b;for(const M of f){const P=M.layerIds.map(F=>x.getLayer(F)).filter(Boolean);if(0!==P.length){M.layers=P,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(F=>P.filter(N=>N.id===F)[0]));for(const F of P)b[F.id]=M}}return b}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const x=this.buckets[f];if(x instanceof to){if(this.hasSymbolBuckets=!0,!u)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const x=this.buckets[f];if(x instanceof to&&x.hasRTLText){this.hasRTLText=!0,J.isLoading()||J.isLoaded()||"deferred"!==H()||Q();break}}this.queryPadding=0;for(const f in this.buckets){const x=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(x))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Mc}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(i)}const l=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ep(i,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ep(i,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ep(i,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,l,u,f,x,b,M,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:M,transform:b,params:x},i,l,u):{}}querySourceFeatures(i,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),x=l?l.sourceLayer:"",b=f._geojsonTileLayer||f[x];if(!b)return;const M=Su(l&&l.filter),{z:P,x:F,y:N}=this.tileID.canonical,V={z:P,x:F,y:N};for(let j=0;j<b.length;j++){const q=b.feature(j);if(M.needGeometry){const Ae=zu(q,!0);if(!M.filter(new te(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!M.filter(new te(this.tileID.overscaledZ),q))continue;const re=u.getId(q,x),oe=new ng(q,P,F,N,re);oe.tile=V,i.push(oe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const u=za(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const x=this.expirationTime-l;x?this.expirationTime=u+Math.max(x,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length)return;const u=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!l.style.hasLayer(f))continue;const x=this.buckets[f],b=x.layers[0].sourceLayer||"_geojsonTileLayer",M=u[b],P=i[b];if(!M||!P||0===Object.keys(P).length)continue;x.update(P,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=l&&l.style&&l.style.getLayer(f);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<uo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=uo.now()+i}setDependencies(i,l){const u={};for(const f of l)u[f]=!0;this.dependencies[i]=u}hasDependency(i,l){for(const u of i){const f=this.dependencies[u];if(f)for(const x of l)if(f[x])return!0}return!1}clearQueryDebugViz(){}}class og{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,u){const f=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},ci(this.stateChanges[i][f],u),null===this.deletedStates[i]){this.deletedStates[i]={};for(const x in this.state[i])x!==f&&(this.deletedStates[i][x]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][f]){this.deletedStates[i][f]={};for(const x in this.state[i][f])u[x]||(this.deletedStates[i][f][x]=null)}else for(const x in u)this.deletedStates[i]&&this.deletedStates[i][f]&&null===this.deletedStates[i][f][x]&&delete this.deletedStates[i][f][x]}removeFeatureState(i,l,u){if(null===this.deletedStates[i])return;const f=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&void 0!==l)null!==this.deletedStates[i][f]&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][u]=null);else if(void 0!==l)if(this.stateChanges[i]&&this.stateChanges[i][f])for(u in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][u]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,l){const u=String(l),f=ci({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const x=this.deletedStates[i][l];if(null===x)return{};for(const b in x)delete f[b]}return f}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const x={};for(const b in this.stateChanges[f])this.state[f][b]||(this.state[f][b]={}),ci(this.state[f][b],this.stateChanges[f][b]),x[b]=this.state[f][b];u[f]=x}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const x={};if(null===this.deletedStates[f])for(const b in this.state[f])x[b]={},this.state[f][b]={};else for(const b in this.deletedStates[f]){if(null===this.deletedStates[f][b])this.state[f][b]={};else for(const M of Object.keys(this.deletedStates[f][b]))delete this.state[f][b][M];x[b]=this.state[f][b]}u[f]=u[f]||{},ci(u[f],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in i)i[f].setFeatureState(u,l)}}class __{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const u=this.toIdx(i,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function Bl(a,i,l,u){let f=0,x=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(u[b])<1e-15){if(l[b]<a[b]||l[b]>i[b])return null}else{const M=1/u[b];let P=(a[b]-l[b])*M,F=(i[b]-l[b])*M;if(P>F){const N=P;P=F,F=N}if(P>f&&(f=P),F<x&&(x=F),f>x)return null}return f}function sg(a,i,l,u,f,x,b,M,P,F,N){const V=u-a,j=f-i,q=x-l,re=b-a,oe=M-i,Ae=P-l,xe=N[1]*Ae-N[2]*oe,Me=N[2]*re-N[0]*Ae,Le=N[0]*oe-N[1]*re,Be=V*xe+j*Me+q*Le;if(Math.abs(Be)<1e-15)return null;const Ne=1/Be,Ue=F[0]-a,Ze=F[1]-i,it=F[2]-l,dt=(Ue*xe+Ze*Me+it*Le)*Ne;if(dt<0||dt>1)return null;const pt=Ze*q-it*j,et=it*V-Ue*q,rt=Ue*j-Ze*V,_t=(N[0]*pt+N[1]*et+N[2]*rt)*Ne;return _t<0||dt+_t>1?null:(re*pt+oe*et+Ae*rt)*Ne}function y_(a,i,l){return(a-i)/(l-i)}function m1(a,i,l,u,f,x,b,M,P){const F=1<<l,N=x-u,V=b-f,j=(a+1)/F*N+u,q=(i+0)/F*V+f,re=(i+1)/F*V+f;M[0]=(a+0)/F*N+u,M[1]=q,P[0]=j,P[1]=re}class tp{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(x){const b=Math.ceil(Math.log2(x.dim/8)),M=[];let P=Math.ceil(Math.pow(2,b));const F=1/P,N=(q,re,oe,Ae,xe)=>{const Me=Ae?1:0,Le=(q+1)*oe-Me,Be=re*oe,Ne=(re+1)*oe-Me;xe[0]=q*oe,xe[1]=Be,xe[2]=Le,xe[3]=Ne};let V=new __(P);const j=[];for(let q=0;q<P*P;q++){N(q%P,Math.floor(q/P),F,!1,j);const re=Nl(j[0],j[1],x),oe=Nl(j[2],j[1],x),Ae=Nl(j[2],j[3],x),xe=Nl(j[0],j[3],x);V.minimums.push(Math.min(re,oe,Ae,xe)),V.maximums.push(Math.max(re,oe,Ae,xe)),V.leaves.push(1)}for(M.push(V),P/=2;P>=1;P/=2){const q=M[M.length-1];V=new __(P);for(let re=0;re<P*P;re++){N(re%P,Math.floor(re/P),2,!0,j);const oe=q.getElevation(j[0],j[1]),Ae=q.getElevation(j[2],j[1]),xe=q.getElevation(j[2],j[3]),Me=q.getElevation(j[0],j[3]),Le=q.isLeaf(j[0],j[1]),Be=q.isLeaf(j[2],j[1]),Ne=q.isLeaf(j[2],j[3]),Ue=q.isLeaf(j[0],j[3]),Ze=Math.min(oe.min,Ae.min,xe.min,Me.min),it=Math.max(oe.max,Ae.max,xe.max,Me.max),dt=Le&&Be&&Ne&&Ue;V.maximums.push(it),V.minimums.push(Ze),V.leaves.push(it-Ze<=5&&dt?1:0)}M.push(V)}return M}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(i,l,u,f,x,b,M=1){return Bl([i,l,-100],[u,f,this.maximums[0]*M],x,b)}raycast(i,l,u,f,x,b,M=1){if(!this.nodeCount)return null;const P=this.raycastRoot(i,l,u,f,x,b,M);if(null==P)return null;const F=[],N=[],V=[],j=[],q=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;q.length>0;){const{idx:re,t:oe,nodex:Ae,nodey:xe,depth:Me}=q.pop();if(this.leaves[re]){m1(Ae,xe,Me,i,l,u,f,V,j);const Be=1<<Me,Ne=(Ae+0)/Be,Ue=(Ae+1)/Be,Ze=(xe+0)/Be,it=(xe+1)/Be,dt=Nl(Ne,Ze,this.dem)*M,pt=Nl(Ue,Ze,this.dem)*M,et=Nl(Ue,it,this.dem)*M,rt=Nl(Ne,it,this.dem)*M,_t=sg(V[0],V[1],dt,j[0],V[1],pt,j[0],j[1],et,x,b),nt=sg(j[0],j[1],et,V[0],j[1],rt,V[0],V[1],dt,x,b),Qt=Math.min(null!==_t?_t:Number.MAX_VALUE,null!==nt?nt:Number.MAX_VALUE);if(Qt!==Number.MAX_VALUE)return Qt;{const St=T0([],x,b,oe);if(v_(dt,pt,rt,et,y_(St[0],V[0],j[0]),y_(St[1],V[1],j[1]))>=St[2])return oe}continue}let Le=0;for(let Be=0;Be<this._siblingOffset.length;Be++){m1((Ae<<1)+this._siblingOffset[Be][0],(xe<<1)+this._siblingOffset[Be][1],Me+1,i,l,u,f,V,j),V[2]=-100,j[2]=this.maximums[this.childOffsets[re]+Be]*M;const Ne=Bl(V,j,x,b);if(null!=Ne){const Ue=Ne;F[Be]=Ue;let Ze=!1;for(let it=0;it<Le&&!Ze;it++)Ue>=F[N[it]]&&(N.splice(it,0,Be),Ze=!0);Ze||(N[Le]=Be),Le++}}for(let Be=0;Be<Le;Be++){const Ne=N[Be];q.push({idx:this.childOffsets[re]+Ne,t:F[Ne],nodex:(Ae<<1)+this._siblingOffset[Ne][0],nodey:(xe<<1)+this._siblingOffset[Ne][1],depth:Me+1})}}return null}_addNode(i,l,u){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,u,f,x){if(1===i[f].isLeaf(l,u))return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const b=f-1,M=i[b];let P,F=0;for(let N=0;N<this._siblingOffset.length;N++){const V=2*l+this._siblingOffset[N][0],j=2*u+this._siblingOffset[N][1],q=M.getElevation(V,j),re=M.isLeaf(V,j),oe=this._addNode(q.min,q.max,re);re&&(F|=1<<N),P||(P=oe)}for(let N=0;N<this._siblingOffset.length;N++)F&1<<N||this._construct(i,2*l+this._siblingOffset[N][0],2*u+this._siblingOffset[N][1],b,P+N)}}function v_(a,i,l,u,f,x){return ut(ut(a,l,x),ut(i,u,x),f)}function Nl(a,i,l){const u=l.dim,f=li(a*u-.5,0,u-1),x=li(i*u-.5,0,u-1),b=Math.floor(f),M=Math.floor(x),P=Math.min(b+1,u-1),F=Math.min(M+1,u-1);return v_(l.get(b,M),l.get(P,M),l.get(b,F),l.get(P,F),f-b,x-M)}const x_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class np{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,u,f=!1,x=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Lr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2;if(this.data=new Uint32Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let M=0;M<b;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(b,M)]=this.data[this._idx(b-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,b)]=this.data[this._idx(M,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new tp(this)}get(i,l,u=!1){const f=new Uint8Array(this.data.buffer);u&&(i=li(i,-1,this.dim),l=li(l,-1,this.dim));const x=4*this._idx(i,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(f[x],f[x+1],f[x+2])}static getUnpackVector(i){return x_[i]}get unpackVector(){return x_[this.encoding]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,u){return(256*i*256+256*l+u)/10-1e4}_unpackTerrarium(i,l,u){return 256*i+l+u/256-32768}static pack(i,l){const u=[0,0,0,0],f=np.getUnpackVector(l);let x=Math.floor((i+f[3])/f[2]);return u[2]=x%256,x=Math.floor(x/256),u[1]=x%256,x=Math.floor(x/256),u[0]=x,u}getPixels(){return new ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,x=l*this.dim+this.dim,b=u*this.dim,M=u*this.dim+this.dim;switch(l){case-1:f=x-1;break;case 1:x=f+1}switch(u){case-1:b=M-1;break;case 1:M=b+1}const P=-l*this.dim,F=-u*this.dim;for(let N=b;N<M;N++)for(let V=f;V<x;V++)this.data[this._idx(V,N)]=i.data[this._idx(V+P,N+F)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Pt("DEMData",np),Pt("DemMinMaxQuadTree",tp,{omit:["dem"]});class bA{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,u){const f=i.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const x={value:l,timeout:void 0};if(void 0!==u&&(x.timeout=setTimeout(()=>{this.remove(i,x)},u)),this.data[f].push(x),this.order.push(f),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const u=i.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),x=this.data[u][f];return this.data[u].splice(f,1),x.timeout&&clearTimeout(x.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(x.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const u in this.data)for(const f of this.data[u])i(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class Ta{constructor(i,l,u){this.func=i,this.mask=l,this.range=u}}Ta.ReadOnly=!1,Ta.ReadWrite=!0,Ta.disabled=new Ta(519,Ta.ReadOnly,[0,1]);class Uc{constructor(i,l,u,f,x,b){this.test=i,this.ref=l,this.mask=u,this.fail=f,this.depthFail=x,this.pass=b}}Uc.disabled=new Uc({func:519,mask:0},0,0,7680,7680,7680);class Jo{constructor(i,l,u){this.blendFunction=i,this.blendColor=l,this.mask=u}}Jo.Replace=[1,0],Jo.disabled=new Jo(Jo.Replace,ln.transparent,[!1,!1,!1,!1]),Jo.unblended=new Jo(Jo.Replace,ln.transparent,[!0,!0,!0,!0]),Jo.alphaBlended=new Jo([1,771],ln.transparent,[!0,!0,!0,!0]);class na{constructor(i,l,u){this.enable=i,this.mode=l,this.frontFace=u}}na.disabled=new na(!1,1029,2305),na.backCCW=new na(!0,1029,2305),na.backCW=new na(!0,1029,2304),na.frontCW=new na(!0,1028,2304),na.frontCCW=new na(!0,1028,2305);class $c extends jt{constructor(i,l,u){super(),this.id=i,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new bA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new og}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(i),u.prepare(this.map.style.imageManager)}}getIds(){return jn(this._tiles).map(i=>i.tileID).sort(rp).map(i=>i.key)}getRenderableIds(i){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,i)&&l.push(this._tiles[u]);return i?l.sort((u,f)=>{const x=u.tileID,b=f.tileID,M=new ct(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new ct(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-b.overscaledZ||P.y-M.y||P.x-M.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(rp).map(u=>u.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const u=this._tiles[i];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,i,l)))}_tileLoaded(i,l,u,f){if(f)return i.state="errored",void(404!==f.status?this._source.fire(new Xe(f,{tile:i})):this.update(this.transform));i.timeAdded=uo.now(),"expired"===u&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),"raster-dem"===this.getSource().type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new ft("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const x=l[f];if(i.neighboringTiles&&i.neighboringTiles[x]){const b=this.getTileByID(x);u(i,b),u(b,i)}}function u(f,x){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let b=x.tileID.canonical.x-f.tileID.canonical.x;const M=x.tileID.canonical.y-f.tileID.canonical.y,P=Math.pow(2,f.tileID.canonical.z),F=x.tileID.key;0===b&&0===M||Math.abs(M)>1||(Math.abs(b)>1&&(1===Math.abs(b+P)?b+=P:1===Math.abs(b-P)&&(b-=P)),x.dem&&f.dem&&(f.dem.backfillBorder(x.dem,b,M),f.neighboringTiles&&f.neighboringTiles[F]&&(f.neighboringTiles[F].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,u,f){for(const x in this._tiles){let b=this._tiles[x];if(f[x]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>u)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const F=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[F.key],b&&b.hasData()&&(M=F)}let P=M;for(;P.overscaledZ>l;)if(P=P.scaledTo(P.overscaledZ-1),i[P.key]){f[M.key]=M;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=i.overscaledZ-1;u>=l;u--){const f=i.scaledTo(u),x=this._getLoadedTile(f);if(x)return x}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const u=Math.ceil(i.width/l)+1,f=Math.ceil(i.height/l)+1,x=Math.floor(u*f*5),b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(b)}handleWrapJump(i){const l=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,l){const u={};for(const f in this._tiles){const x=this._tiles[f];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),u[x.tileID.key]=x}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(i,l,u){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(i,l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new Ai(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(f=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(M=>this._source.hasTile(M)))):f=[];const x=this._updateRetainedTiles(f);if(ip(this._source.type)&&0!==f.length){const M={},P={},F=Object.keys(x);for(const V of F){const j=x[V],q=this._tiles[V];if(!q||q.fadeEndTime&&q.fadeEndTime<=uo.now())continue;const re=this.findLoadedParent(j,Math.max(j.overscaledZ-$c.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),M[re.tileID.key]=re.tileID),P[V]=j}const N=f[f.length-1].overscaledZ;for(const V in this._tiles){const j=this._tiles[V];if(x[V]||!j.hasData())continue;let q=j.tileID;for(;q.overscaledZ>N;){q=q.scaledTo(q.overscaledZ-1);const re=this._tiles[q.key];if(re&&re.hasData()&&P[q.key]){x[V]=j.tileID;break}}}for(const V in M)x[V]||(this._coveredTiles[V]=!0,x[V]=M[V])}for(const M in x)this._tiles[M].clearFadeHold();const b=function(M,P){const F=[];for(const N in M)N in P||F.push(N);return F}(this._tiles,x);for(const M of b){const P=this._tiles[M];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(0===i.length)return l;const u={},f=i[i.length-1].overscaledZ,x=i[0].overscaledZ,b=Math.max(x-$c.maxOverzooming,this._source.minzoom),M=Math.max(x+$c.maxUnderzooming,this._source.minzoom),P={};for(const F of i){const N=this._addTile(F);l[F.key]=F,N.hasData()||f<this._source.maxzoom&&(P[F.key]=F)}this._retainLoadedChildren(P,f,M,l);for(const F of i){let N=this._tiles[F.key];if(N.hasData())continue;if(F.canonical.z>=this._source.maxzoom){const j=F.children(this._source.maxzoom)[0],q=this.getTile(j);if(q&&q.hasData()){l[j.key]=j;continue}}else{const j=F.children(this._source.maxzoom);if(l[j[0].key]&&l[j[1].key]&&l[j[2].key]&&l[j[3].key])continue}let V=N.wasRequested();for(let j=F.overscaledZ-1;j>=b;--j){const q=F.scaledTo(j);if(u[q.key]||(u[q.key]=!0,N=this.getTile(q),!N&&V&&(N=this._addTile(q)),N&&(l[q.key]=q,V=N.wasRequested(),N.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let u,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const x=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(x),u)break;f=x}for(const x of l)this._loadedParentTiles[x]=u}}_addTile(i){let l=this._tiles[i.key];if(l)return l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const u=Boolean(l);return u||(l=new ig(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))),l?(l.uses++,this._tiles[i.key]=l,u||this._source.fire(new ft("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=l.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._cache.reset()}tilesIn(i,l,u){const f=[],x=this.transform;if(!x)return f;for(const b in this._tiles){const M=this._tiles[b];if(u&&M.clearQueryDebugViz(),M.holdingForFade())continue;const P=i.containsTile(M,x,l);P&&f.push(P)}return f}getVisibleCoordinates(i){const l=this.getRenderableIds(i).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ip(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=uo.now())return!0}return!1}setFeatureState(i,l,u){this._state.updateState(i=i||"_geojsonTileLayer",l,u)}removeFeatureState(i,l,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,u)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,u){const f=this._tiles[i];f&&f.setDependencies(l,u)}reloadTilesForDependencies(i,l){for(const u in this._tiles)this._tiles[u].hasDependency(i,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(i,l))}}function rp(a,i){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return a.overscaledZ-i.overscaledZ||u-l||i.canonical.y-a.canonical.y||i.canonical.x-a.canonical.x}function ip(a){return"raster"===a||"image"===a||"video"===a}$c.maxOverzooming=10,$c.maxUnderzooming=3;class CA{constructor(i,l,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(i,l,u){const f=u||i.findDEMTileFor(l);if(!f||!f.dem)return;const x=f.dem,b=f.tileID,M=1<<l.canonical.z-b.canonical.z;return new CA(f,f.tileSize/ar/M,[(l.canonical.x/M-b.canonical.x)*x.dim,(l.canonical.y/M-b.canonical.y)*x.dim])}tileCoordToPixel(i,l){const u=l*this._scale+this._offset[1],f=Math.floor(i*this._scale+this._offset[0]),x=Math.floor(u);return new ct(f,x)}getElevationAt(i,l,u,f){const x=i*this._scale+this._offset[0],b=l*this._scale+this._offset[1],M=Math.floor(x),P=Math.floor(b),F=this._dem;return f=!!f,u?ut(ut(F.get(M,P,f),F.get(M,P+1,f),b-P),ut(F.get(M+1,P,f),F.get(M+1,P+1,f),b-P),x-M):F.get(M,P,f)}getElevationAtPixel(i,l,u){return this._dem.get(i,l,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*vA(1,i)*this._dem.stride}}class EA{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new wc(ar,16,0),this.featureIndexArray=new _v,this.promoteId=l}insert(i,l,u,f,x,b=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,x,b);const P=this.grid;for(let F=0;F<l.length;F++){const N=l[F],V=[1/0,1/0,-1/0,-1/0];for(let j=0;j<N.length;j++){const q=N[j];V[0]=Math.min(V[0],q.x),V[1]=Math.min(V[1],q.y),V[2]=Math.max(V[2],q.x),V[3]=Math.max(V[3],q.y)}V[0]<ar&&V[1]<ar&&V[2]>=0&&V[3]>=0&&P.insert(M,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Sa.VectorTile(new uA(this.rawTileData)).layers,this.sourceLayerCoder=new g_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,u,f){this.loadVTLayers();const x=i.params||{},b=Su(x.filter),M=i.tileResult,P=i.transform,F=M.bufferedTilespaceBounds,N=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,(re,oe,Ae,xe)=>Lh(M.bufferedTilespaceGeometry,re,oe,Ae,xe));N.sort(w_);let V=null;P.elevation&&N.length>0&&(V=CA.create(P.elevation,this.tileID));const j={};let q;for(let re=0;re<N.length;re++){const oe=N[re];if(oe===q)continue;q=oe;const Ae=this.featureIndexArray.get(oe);let xe=null;this.loadMatchingFeature(j,Ae,b,x.layers,x.availableImages,l,u,f,(Me,Le,Be,Ne=0)=>(xe||(xe=Ks(Me)),Le.queryIntersectsFeature(M,Me,Be,xe,this.z,i.transform,i.pixelPosMatrix,V,Ne)))}return j}loadMatchingFeature(i,l,u,f,x,b,M,P,F){const{featureIndex:N,bucketIndex:V,sourceLayerIndex:j,layoutVertexArrayOffset:q}=l,re=this.bucketLayerIDs[V];if(f&&!function(Me,Le){for(let Be=0;Be<Me.length;Be++)if(Le.indexOf(Me[Be])>=0)return!0;return!1}(f,re))return;const oe=this.sourceLayerCoder.decode(j),Ae=this.vtLayers[oe].feature(N);if(u.needGeometry){const Me=zu(Ae,!0);if(!u.filter(new te(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!u.filter(new te(this.tileID.overscaledZ),Ae))return;const xe=this.getId(Ae,oe);for(let Me=0;Me<re.length;Me++){const Le=re[Me];if(f&&f.indexOf(Le)<0)continue;const Be=b[Le];if(!Be)continue;let Ne={};void 0!==xe&&P&&(Ne=P.getState(Be.sourceLayer||"_geojsonTileLayer",xe));const Ue=ci({},M[Le]);Ue.paint=b_(Ue.paint,Be.paint,Ae,Ne,x),Ue.layout=b_(Ue.layout,Be.layout,Ae,Ne,x);const Ze=!F||F(Ae,Be,Ne,q);if(!Ze)continue;const it=new ng(Ae,this.z,this.x,this.y,xe);it.layer=Ue;let dt=i[Le];void 0===dt&&(dt=i[Le]=[]),dt.push({featureIndex:N,feature:it,intersectionZ:Ze})}}lookupSymbolFeatures(i,l,u,f,x,b,M,P){const F={};this.loadVTLayers();const N=Su(x);for(const V of i)this.loadMatchingFeature(F,{bucketIndex:u,sourceLayerIndex:f,featureIndex:V,layoutVertexArrayOffset:0},N,b,M,P,l);return F}hasLayer(i){for(const l of this.bucketLayerIDs)for(const u of l)if(i===u)return!0;return!1}getId(i,l){let u=i.id;return this.promoteId&&(u=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof u&&(u=Number(u))),u}}function b_(a,i,l,u,f){return fn(a,(x,b)=>{const M=i instanceof Se?i.get(b):null;return M&&M.evaluate?M.evaluate(l,u,f):M})}function w_(a,i){return i-a}Pt("FeatureIndex",EA,{omit:["rawTileData","sourceLayerCoder"]});class g1{constructor(i){const l={},u=[];for(const M in i){const P=i[M],F=l[M]={};for(const N in P.glyphs){const V=P.glyphs[+N];if(!V||0===V.bitmap.width||0===V.bitmap.height)continue;const j=V.metrics.localGlyph?2:1,q={x:0,y:0,w:V.bitmap.width+2*j,h:V.bitmap.height+2*j};u.push(q),F[N]=q}}const{w:f,h:x}=zf(u),b=new Rc({width:f||1,height:x||1});for(const M in i){const P=i[M];for(const F in P.glyphs){const N=P.glyphs[+F];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const V=l[M][F],j=N.metrics.localGlyph?2:1;Rc.copy(N.bitmap,b,{x:0,y:0},{x:V.x+j,y:V.y+j},N.bitmap)}}this.image=b,this.positions=l}}Pt("GlyphAtlas",g1);class C_{constructor(i){this.tileID=new Ai(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile}parse(i,l,u,f,x){this.status="parsing",this.data=i,this.collisionBoxArray=new Mc;const b=new g_(Object.keys(i.layers).sort()),M=new EA(this.tileID,this.promoteId);M.bucketLayerIDs=[];const P={},F=new p_(256,256),N={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:F,availableImages:u},V=l.familiesBySource[this.source];for(const Ne in V){const Ue=i.layers[Ne];if(!Ue)continue;let Ze=!1,it=!1;for(const et of V[Ne])"symbol"===et[0].type?Ze=!0:it=!0;if(!0===this.isSymbolTile&&!Ze||!1===this.isSymbolTile&&!it)continue;1===Ue.version&&Lr(`Vector tile source "${this.source}" layer "${Ne}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const dt=b.encode(Ne),pt=[];for(let et=0;et<Ue.length;et++){const rt=Ue.feature(et),_t=M.getId(rt,Ne);pt.push({feature:rt,id:_t,index:et,sourceLayerIndex:dt})}for(const et of V[Ne]){const rt=et[0];void 0!==this.isSymbolTile&&"symbol"===rt.type!==this.isSymbolTile||rt.minzoom&&this.zoom<Math.floor(rt.minzoom)||rt.maxzoom&&this.zoom>=rt.maxzoom||"none"!==rt.visibility&&(op(et,this.zoom,u),(P[rt.id]=rt.createBucket({index:M.bucketLayerIDs.length,layers:et,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:dt,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(pt,N,this.tileID.canonical),M.bucketLayerIDs.push(et.map(_t=>_t.id)))}}let j,q,re,oe;F.trim();const Ae={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xe=fn(N.glyphDependencies,Ne=>Object.keys(Ne).map(Number));Object.keys(xe).length?f.send("getGlyphs",{uid:this.uid,stacks:xe},(Ne,Ue)=>{j||(j=Ne,q=Ue,Be.call(this))},void 0,!1,Ae):q={};const Me=Object.keys(N.iconDependencies);Me.length?f.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"icons"},(Ne,Ue)=>{j||(j=Ne,re=Ue,Be.call(this))},void 0,!1,Ae):re={};const Le=Object.keys(N.patternDependencies);function Be(){if(j)return x(j);if(q&&re&&oe){const Ne=new g1(q),Ue=new Vf(re,oe);for(const Ze in P){const it=P[Ze];it instanceof to?(op(it.layers,this.zoom,u),a1(it,q,Ne.positions,re,Ue.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):it.hasPattern&&(it instanceof Lf||it instanceof sA||it instanceof Ji)&&(op(it.layers,this.zoom,u),it.addFeatures(N,this.tileID.canonical,Ue.patternPositions))}this.status="done",x(null,{buckets:jn(P).filter(Ze=>!Ze.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ne.image,lineAtlas:F,imageAtlas:Ue,glyphMap:this.returnDependencies?q:null,iconMap:this.returnDependencies?re:null,glyphPositions:this.returnDependencies?Ne.positions:null})}}Le.length?f.send("getImages",{icons:Le,source:this.source,tileID:this.tileID,type:"patterns"},(Ne,Ue)=>{j||(j=Ne,oe=Ue,Be.call(this))},void 0,!1,Ae):oe={},Be.call(this)}}function op(a,i,l){const u=new te(i);for(const f of a)f.recalculate(u,l)}class E_{constructor(i){this.entries={},this.scheduler=i}request(i,l,u,f){const x=this.entries[i]=this.entries[i]||{callbacks:[]};if(x.result){const[b,M]=x.result;return this.scheduler?this.scheduler.add(()=>{f(b,M)},l):f(b,M),()=>{}}return x.callbacks.push(f),x.cancel||(x.cancel=u((b,M)=>{x.result=[b,M];for(const P of x.callbacks)this.scheduler?this.scheduler.add(()=>{P(b,M)},l):P(b,M);setTimeout(()=>delete this.entries[i],3e3)})),()=>{x.result||(x.callbacks=x.callbacks.filter(b=>b!==f),x.callbacks.length||(x.cancel(),delete this.entries[i]))}}}function lg(a,i,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const x=Z(a.request,(b,M,P,F)=>{b?f(b):M&&f(null,{vectorTile:l?void 0:new Sa.VectorTile(new uA(M)),rawData:M,cacheControl:P,expires:F})});return()=>{x.cancel(),f()}},i)}g.ARRAY_TYPE=xi,g.AUTH_ERR_MSG=Aa,g.Actor=class{constructor(a,i,l){this.target=a,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},rc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=fl()?a:Ct,this.scheduler=new r2}send(a,i,l,u,f=!1,x){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[b]=l);const M=lu(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Ya(i,M)},M),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const i=a.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(i.mustQueue||fl()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,i),u&&u.metadata||{type:"message"})}else this.processTask(l,i)}processTask(a,i){if("<response>"===i.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(i.error?l(_i(i.error)):l(null,_i(i.data)))}else{const l=lu(this.globalScope)?void 0:[],u=i.hasCallback?(x,b)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:x?Ya(x):null,data:Ya(b,l)},l)}:x=>{},f=_i(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,u);else if(this.parent.getWorkerSource){const x=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,x[0],f.source)[x[1]](f,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},g.CanonicalTileID=m_,g.Color=ln,g.ColorMode=Jo,g.CullFaceMode=na,g.DEMData=np,g.DataConstantProperty=de,g.DedupedRequest=E_,g.DepthMode=Ta,g.EXTENT=ar,g.Elevation=class{getAtPointOrZero(a,i=0){return this.getAtPoint(a,i)||0}getAtPoint(a,i,l=!0){null==i&&(i=null);const u=this._source();if(!u||a.y<0||a.y>1)return i;const f=u.getSource().maxzoom,x=1<<f,b=Math.floor(a.x),M=a.x-b,P=new Ai(f,b,f,Math.floor(M*x),Math.floor(a.y*x)),F=this.findDEMTileFor(P);if(!F||!F.dem)return i;const N=F.dem,V=1<<F.tileID.canonical.z,j=(M*V-F.tileID.canonical.x)*N.dim,q=(a.y*V-F.tileID.canonical.y)*N.dim,re=Math.floor(j),oe=Math.floor(q);return(l?this.exaggeration():1)*ut(ut(N.get(re,oe),N.get(re,oe+1),q-oe),ut(N.get(re+1,oe),N.get(re+1,oe+1),q-oe),j-re)}getAtTileOffset(a,i,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new xA(a.wrap+(a.canonical.x+i/ar)/u,(a.canonical.y+l/ar)/u))}getForTilePoints(a,i,l,u){const f=CA.create(this,a,u);return!!f&&(i.forEach(x=>{x[2]=this.exaggeration()*f.getElevationAt(x[0],x[1],l)}),!0)}getMinMaxForTile(a){const i=this.findDEMTileFor(a);if(!i||!i.dem)return null;const l=i.dem.tree,u=i.tileID,f=1<<a.canonical.z-u.canonical.z;let x=a.canonical.x/f-u.canonical.x,b=a.canonical.y/f-u.canonical.y,M=0;for(let P=0;P<a.canonical.z-u.canonical.z&&!l.leaves[M];P++){x*=2,b*=2;const F=2*Math.floor(b)+Math.floor(x);M=l.childOffsets[M]+F,x%=1,b%=1}return{min:this.exaggeration()*l.minimums[M],max:this.exaggeration()*l.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},g.ErrorEvent=Xe,g.EvaluationParameters=te,g.Event=ft,g.Evented=jt,g.GlyphManager=Wu,g.ImagePosition=Bm,g.LineAtlas=p_,g.LngLat=Qr,g.LngLatBounds=Vc,g.LocalGlyphMode=mA,g.MAX_SAFE_INTEGER=hs,g.MercatorCoordinate=xA,g.ONE_EM=24,g.OverscaledTileID=Ai,g.Properties=$e,g.RGBAImage=ws,g.RequestManager=class{constructor(a,i,l){this._transformRequestFn=a,this._customAccessToken=i,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let i="";for(let l=0;l<10;l++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",uu,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,i){return this._transformRequestFn&&this._transformRequestFn(a,i)||{url:a}}normalizeStyleURL(a,i){if(!mr(a))return a;const l=ps(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeGlyphsURL(a,i){if(!mr(a))return a;const l=ps(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeSourceURL(a,i){if(!mr(a))return a;const l=ps(a);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||i)}normalizeSpriteURL(a,i,l,u){const f=ps(a);return mr(a)?(f.path=`/styles/v1${f.path}/sprite${i}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${i}${l}`,jo(f))}normalizeTileURL(a,i,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!mr(a))return a;const u=ps(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||l&&"raster"!==u.authority&&512===l?"@2x":""}${Vs.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Qn.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Qn.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(x){for(const b of x){const M=b.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||Qn.ACCESS_TOKEN;return Qn.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,i){const l=ps(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${Qn.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${Qn.TILE_URL_VERSION}/`,"")}`;let f=l.params;return i&&(f=f.filter(x=>!x.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,i){const l=!!i&&mr(i),u=[];for(const f of a.tiles||[])ja(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,i){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=ps(Qn.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!Qn.REQUIRE_ACCESS_TOKEN)return jo(a);if(i=i||Qn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${i||""}`),jo(a)}},g.ResourceType=pa,g.SegmentVector=Ii,g.SourceCache=$c,g.StencilMode=Uc,g.StructArrayLayout1ui2=So,g.StructArrayLayout2f1f2i16=xs,g.StructArrayLayout2i4=Yt,g.StructArrayLayout2ui4=oi,g.StructArrayLayout3f12=an,g.StructArrayLayout3ui6=Tn,g.StructArrayLayout4i8=Nr,g.Texture=ep,g.Tile=ig,g.Transitionable=_e,g.Uniform1f=bs,g.Uniform1i=class extends Vi{constructor(a,i){super(a,i),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},g.Uniform2f=class extends Vi{constructor(a,i){super(a,i),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},g.Uniform3f=class extends Vi{constructor(a,i){super(a,i),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},g.Uniform4f=Zd,g.UniformColor=Tc,g.UniformMatrix3f=class extends Vi{constructor(a,i){super(a,i),this.current=C0}set(a){for(let i=0;i<9;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},g.UniformMatrix4f=class extends Vi{constructor(a,i){super(a,i),this.current=Ic}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let i=1;i<16;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},g.UnwrappedTileID=p1,g.ValidationError=Ge,g.VectorTileWorkerSource=class extends jt{constructor(a,i,l,u,f){super(),this.actor=a,this.layerIndex=i,this.availableImages=l,this.loadVectorData=f||lg,this.loading={},this.loaded={},this.deduped=new E_(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,i){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,x=this.loading[l]=new C_(a);x.abort=this.loadVectorData(a,(b,M)=>{const P=!this.loading[l];if(delete this.loading[l],P||b||!M)return x.status="done",P||(this.loaded[l]=x),i(b);const F=M.rawData,N={};M.expires&&(N.expires=M.expires),M.cacheControl&&(N.cacheControl=M.cacheControl),x.vectorTile=M.vectorTile||new Sa.VectorTile(new uA(F));const V=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,(j,q)=>{if(j||!q)return i(j);const re={};if(f){const oe=A1(u);oe.length>0&&(re.resourceTiming=JSON.parse(JSON.stringify(oe)))}i(null,ci({rawTileData:F.slice(0)},q,N,re))})};this.isSpriteLoaded?V():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):V()}),this.loaded=this.loaded||{},this.loaded[l]=x})}reloadTile(a,i){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const x=l[u];x.showCollisionBoxes=a.showCollisionBoxes,x.enableTerrain=!!a.enableTerrain;const b=(M,P)=>{const F=x.reloadCallback;F&&(delete x.reloadCallback,x.parse(x.vectorTile,f.layerIndex,this.availableImages,f.actor,F)),i(M,P)};"parsing"===x.status?x.reloadCallback=b:"done"===x.status&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(a,i){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),i()}removeTile(a,i){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],i()}},g.WritingMode=Ds,g.ZoomHistory=vs,g.add=function(a,i,l){return a[0]=i[0]+l[0],a[1]=i[1]+l[1],a[2]=i[2]+l[2],a},g.addDynamicAttributes=cn,g.altitudeFromMercatorZ=f_,g.asyncAll=au,g.bezier=Oa,g.bindAll=rc,g.bufferConvexPolygon=function(a,i){const l=[];for(let u=0;u<a.length;u++){const f=La(u-1,-1,a.length-1),x=La(u+1,-1,a.length-1),b=a[u],M=a[x],P=a[f].sub(b).unit(),F=M.sub(b).unit(),N=F.angleWithSep(P.x,P.y),V=P.add(F).unit().mult(-1*i/Math.sin(N/2));l.push(b.add(V))}return l},g.cacheEntryPossiblyAdded=function(a){sn++,sn>Au&&(a.getActor().send("enforceCacheSizeLimit",mh),sn=0)},g.clamp=li,g.clearTileCache=function(a){const i=Ct.caches.delete(ac);a&&i.catch(a).then(()=>a())},g.clipLine=Gm,g.clone=function(a){var i=new xi(3);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i},g.clone$1=function(a){var i=new xi(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},g.clone$2=kr,g.collisionCircleLayout=t1,g.config=Qn,g.conjugate=function(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[3]=i[3],a},g.copy=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a},g.create=Jd,g.create$1=function(){var a=new xi(16);return xi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},g.create$2=S0,g.createExpression=Yo,g.createFilter=Su,g.createLayout=Mt,g.createStyleLayer=function(a){return"custom"===a.type?new Ym(a):new e2[a.type](a)},g.cross=function(a,i,l){var u=i[0],f=i[1],x=i[2],b=l[0],M=l[1],P=l[2];return a[0]=f*P-x*M,a[1]=x*b-u*P,a[2]=u*M-f*b,a},g.degToRad=Wn,g.div=function(a,i,l){return a[0]=i[0]/l[0],a[1]=i[1]/l[1],a[2]=i[2]/l[2],a},g.dot=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]},g.dot$1=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]+a[3]*i[3]},g.ease=ds,g.easeCubicInOut=su,g.emitValidationErrors=ii,g.endsWith=As,g.enforceCacheSizeLimit=function(a){Pn(),$o&&$o.then(i=>{i.keys().then(l=>{for(let u=0;u<l.length-a;u++)i.delete(l[u])})})},g.evaluateSizeForFeature=Nf,g.evaluateSizeForZoom=Fl,g.evaluateVariableOffset=a_,g.evented=G,g.exactEquals=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]&&a[3]===i[3]},g.exactEquals$1=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]},g.exported=uo,g.exported$1=Vs,g.extend=ci,g.filterObject=Uo,g.fromMat4=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10],a},g.fromQuat=function(a,i){var l=i[0],u=i[1],f=i[2],x=i[3],b=l+l,M=u+u,P=f+f,F=l*b,N=u*b,V=u*M,j=f*b,q=f*M,re=f*P,oe=x*b,Ae=x*M,xe=x*P;return a[0]=1-V-re,a[1]=N+xe,a[2]=j-Ae,a[3]=0,a[4]=N-xe,a[5]=1-F-re,a[6]=q+oe,a[7]=0,a[8]=j+Ae,a[9]=q-oe,a[10]=1-F-V,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.fromRotation=function(a,i){var l=Math.sin(i),u=Math.cos(i);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},g.fromScaling=function(a,i){return a[0]=i[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=i[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.furthestTileCorner=function(a){const i=Math.round((a+45+360)%360/90)%4;return ou[i]},g.getAABBPointSquareDist=function(a,i,l){let u=0;for(let f=0;f<2;++f){const x=l?l[f]:0;a[f]>x&&(u+=(a[f]-x)*(a[f]-x)),i[f]<x&&(u+=(x-i[f])*(x-i[f]))}return u},g.getAnchorAlignment=Gf,g.getAnchorJustification=Ss,g.getBounds=function(a){let i=1/0,l=1/0,u=-1/0,f=-1/0;for(const x of a)i=Math.min(i,x.x),l=Math.min(l,x.y),u=Math.max(u,x.x),f=Math.max(f,x.y);return{min:new ct(i,l),max:new ct(u,f)}},g.getImage=Ee,g.getJSON=function(a,i){return ne(ci(a,{type:"json"}),i)},g.getMapSessionAPI=xd,g.getPerformanceMeasurement=A1,g.getRTLTextPluginStatus=H,g.getReferrer=$n,g.getVideo=function(a,i){const l=Ct.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let u=0;u<a.length;u++){const f=Ct.document.createElement("source");he(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},g.identity=Cf,g.identity$1=Sf,g.invert=function(a,i){var l=i[0],u=i[1],f=i[2],x=i[3],b=i[4],M=i[5],P=i[6],F=i[7],N=i[8],V=i[9],j=i[10],q=i[11],re=i[12],oe=i[13],Ae=i[14],xe=i[15],Me=l*M-u*b,Le=l*P-f*b,Be=l*F-x*b,Ne=u*P-f*M,Ue=u*F-x*M,Ze=f*F-x*P,it=N*oe-V*re,dt=N*Ae-j*re,pt=N*xe-q*re,et=V*Ae-j*oe,rt=V*xe-q*oe,_t=j*xe-q*Ae,nt=Me*_t-Le*rt+Be*et+Ne*pt-Ue*dt+Ze*it;return nt?(a[0]=(M*_t-P*rt+F*et)*(nt=1/nt),a[1]=(f*rt-u*_t-x*et)*nt,a[2]=(oe*Ze-Ae*Ue+xe*Ne)*nt,a[3]=(j*Ue-V*Ze-q*Ne)*nt,a[4]=(P*pt-b*_t-F*dt)*nt,a[5]=(l*_t-f*pt+x*dt)*nt,a[6]=(Ae*Be-re*Ze-xe*Le)*nt,a[7]=(N*Ze-j*Be+q*Le)*nt,a[8]=(b*rt-M*pt+F*it)*nt,a[9]=(u*pt-l*rt-x*it)*nt,a[10]=(re*Ue-oe*Be+xe*Me)*nt,a[11]=(V*Be-N*Ue-q*Me)*nt,a[12]=(M*dt-b*et-P*it)*nt,a[13]=(l*et-u*dt+f*it)*nt,a[14]=(oe*Le-re*Ne-Ae*Me)*nt,a[15]=(N*Ne-V*Le+j*Me)*nt,a):null},g.isMapAuthenticated=function(a){return sc.has(a)},g.isMapboxURL=mr,g.latFromMercatorY=tg,g.len=Iv,g.length=M0,g.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},g.loadVectorTile=lg,g.makeRequest=ne,g.mercatorXfromLng=eg,g.mercatorYfromLat=A_,g.mercatorZfromAltitude=vA,g.mul=function(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a[3]=i[3]*l[3],a},g.mul$1=Df,g.mul$2=Tv,g.multiply=Ef,g.multiply$1=Nh,g.nextPowerOfTwo=Al,g.normalize=Mv,g.normalize$1=function(a,i){var l=i[0],u=i[1],f=i[2],x=i[3],b=l*l+u*u+f*f+x*x;return b>0&&(b=1/Math.sqrt(b)),a[0]=l*b,a[1]=u*b,a[2]=f*b,a[3]=x*b,a},g.number=ut,g.ortho=function(a,i,l,u,f,x,b){var M=1/(i-l),P=1/(u-f),F=1/(x-b);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*F,a[11]=0,a[12]=(i+l)*M,a[13]=(f+u)*P,a[14]=(b+x)*F,a[15]=1,a},g.pbf=uA,g.perspective=function(a,i,l,u,f){var x,b=1/Math.tan(i/2);return a[0]=b/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(x=1/(u-f)),a[14]=2*f*u*x):(a[10]=-1,a[14]=-2*u),a},g.pick=function(a,i){const l={};for(let u=0;u<i.length;u++){const f=i[u];f in a&&(l[f]=a[f])}return l},g.plugin=J,g.pointGeometry=ct,g.polygonIntersectsBox=Lh,g.polygonIntersectsPolygon=xf,g.polygonizeBounds=function(a,i,l=0,u=!0){const f=new ct(l,l),x=a.sub(f),b=i.add(f),M=[x,new ct(b.x,x.y),b,new ct(x.x,b.y)];return u&&M.push(x),M},g.posAttributes=rg,g.postMapLoadEvent=oc,g.postTurnstileEvent=fh,g.potpack=zf,g.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},g.radToDeg=function(a){return a*iu},g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.registerForPluginStateChange=function(a){return a({pluginStatus:D,pluginURL:R}),G.on("pluginStateChange",a),a},g.removeAuthState=function(a){sc.delete(a)},g.renderColorRamp=mm,g.rotateX=function(a,i,l){var u=Math.sin(l),f=Math.cos(l),x=i[4],b=i[5],M=i[6],P=i[7],F=i[8],N=i[9],V=i[10],j=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=x*f+F*u,a[5]=b*f+N*u,a[6]=M*f+V*u,a[7]=P*f+j*u,a[8]=F*f-x*u,a[9]=N*f-b*u,a[10]=V*f-M*u,a[11]=j*f-P*u,a},g.rotateX$1=$u,g.rotateY=function(a,i,l){var u=Math.sin(l),f=Math.cos(l),x=i[0],b=i[1],M=i[2],P=i[3],F=i[8],N=i[9],V=i[10],j=i[11];return i!==a&&(a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=x*f-F*u,a[1]=b*f-N*u,a[2]=M*f-V*u,a[3]=P*f-j*u,a[8]=x*u+F*f,a[9]=b*u+N*f,a[10]=M*u+V*f,a[11]=P*u+j*f,a},g.rotateZ=function(a,i,l){var u=Math.sin(l),f=Math.cos(l),x=i[0],b=i[1],M=i[2],P=i[3],F=i[4],N=i[5],V=i[6],j=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=x*f+F*u,a[1]=b*f+N*u,a[2]=M*f+V*u,a[3]=P*f+j*u,a[4]=F*f-x*u,a[5]=N*f-b*u,a[6]=V*f-M*u,a[7]=j*f-P*u,a},g.rotateZ$1=function(a,i,l){l*=.5;var u=i[0],f=i[1],x=i[2],b=i[3],M=Math.sin(l),P=Math.cos(l);return a[0]=u*P+f*M,a[1]=f*P-u*M,a[2]=x*P+b*M,a[3]=b*P-x*M,a},g.scale=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a},g.scale$1=function(a,i,l){var u=l[0],f=l[1],x=l[2];return a[0]=i[0]*u,a[1]=i[1]*u,a[2]=i[2]*u,a[3]=i[3]*u,a[4]=i[4]*f,a[5]=i[5]*f,a[6]=i[6]*f,a[7]=i[7]*f,a[8]=i[8]*x,a[9]=i[9]*x,a[10]=i[10]*x,a[11]=i[11]*x,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a},g.scale$2=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a[3]=i[3]*l,a},g.scaleAndAdd=T0,g.setCacheLimits=function(a,i){mh=a,Au=i},g.setRTLTextPlugin=function(a,i,l=!1){if(D===o||D===h||D===v)throw new Error("setRTLTextPlugin cannot be called multiple times.");R=uo.resolveURL(a),D=o,E=i,z(),l||Q()},g.smoothstep=function(a,i,l){return(l=li((l-a)/(i-a),0,1))*l*(3-2*l)},g.spec=Ce,g.storeAuthState=function(a,i){i?sc.add(a):sc.delete(a)},g.sub=qw,g.subtract=ju,g.symbolSize=ea,g.transformMat3=function(a,i,l){var u=i[0],f=i[1],x=i[2];return a[0]=u*l[0]+f*l[3]+x*l[6],a[1]=u*l[1]+f*l[4]+x*l[7],a[2]=u*l[2]+f*l[5]+x*l[8],a},g.transformMat4=tA,g.transformMat4$1=function(a,i,l){var u=i[0],f=i[1],x=i[2],b=l[3]*u+l[7]*f+l[11]*x+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*x+l[12])/(b=b||1),a[1]=(l[1]*u+l[5]*f+l[9]*x+l[13])/b,a[2]=(l[2]*u+l[6]*f+l[10]*x+l[14])/b,a},g.transformQuat=dm,g.translate=function(a,i,l){var u,f,x,b,M,P,F,N,V,j,q,re,oe=l[0],Ae=l[1],xe=l[2];return i===a?(a[12]=i[0]*oe+i[4]*Ae+i[8]*xe+i[12],a[13]=i[1]*oe+i[5]*Ae+i[9]*xe+i[13],a[14]=i[2]*oe+i[6]*Ae+i[10]*xe+i[14],a[15]=i[3]*oe+i[7]*Ae+i[11]*xe+i[15]):(f=i[1],x=i[2],b=i[3],M=i[4],P=i[5],F=i[6],N=i[7],V=i[8],j=i[9],q=i[10],re=i[11],a[0]=u=i[0],a[1]=f,a[2]=x,a[3]=b,a[4]=M,a[5]=P,a[6]=F,a[7]=N,a[8]=V,a[9]=j,a[10]=q,a[11]=re,a[12]=u*oe+M*Ae+V*xe+i[12],a[13]=f*oe+P*Ae+j*xe+i[13],a[14]=x*oe+F*Ae+q*xe+i[14],a[15]=b*oe+N*Ae+re*xe+i[15]),a},g.triggerPluginCompletionEvent=B,g.uniqueId=zs,g.validateCustomStyleLayer=function(a){const i=[],l=a.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&i.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},g.validateFog=at,g.validateLight=Nd,g.validateStyle=bc,g.values=jn,g.vectorTile=Sa,g.version="2.5.1",g.warnOnce=Lr,g.window=Ct,g.wrap=La}),yd(0,function(g){function yo(ne){const Z=typeof ne;if("number"===Z||"boolean"===Z||"string"===Z||null==ne)return JSON.stringify(ne);if(Array.isArray(ne)){let he="[";for(const be of ne)he+=`${yo(be)},`;return`${he}]`}const Y=Object.keys(ne).sort();let ae="{";for(let he=0;he<Y.length;he++)ae+=`${JSON.stringify(Y[he])}:${yo(ne[Y[he]])},`;return`${ae}}`}function Vo(ne){let Z="";for(const Y of g.refProperties)Z+=`/${yo(ne[Y])}`;return Z}class lo{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Y){for(const he of Z){this._layerConfigs[he.id]=he;const be=this._layers[he.id]=g.createStyleLayer(he);be._featureFilter=g.createFilter(be.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Y)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ae=function(he,be){const we={};for(let Ee=0;Ee<he.length;Ee++){const Oe=be&&be[he[Ee].id]||Vo(he[Ee]);be&&(be[he[Ee].id]=Oe);let Ye=we[Oe];Ye||(Ye=we[Oe]=[]),Ye.push(he[Ee])}const ke=[];for(const Ee in we)ke.push(we[Ee]);return ke}(g.values(this._layerConfigs),this.keyCache);for(const he of ae){const be=he.map(ft=>this._layers[ft.id]),we=be[0];if("none"===we.visibility)continue;const ke=we.source||"";let Ee=this.familiesBySource[ke];Ee||(Ee=this.familiesBySource[ke]={});const Oe=we.sourceLayer||"_geojsonTileLayer";let Ye=Ee[Oe];Ye||(Ye=Ee[Oe]=[]),Ye.push(be)}}}const{ImageBitmap:ct}=g.window;class ot{loadTile(Z,Y){const{uid:ae,encoding:he,rawImageData:be,padding:we,buildQuadTree:ke}=Z,Ee=ct&&be instanceof ct?this.getImageData(be,we):be;Y(null,new g.DEMData(ae,Ee,he,we<1,ke))}getImageData(Z,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ae=this.offscreenCanvasContext.getImageData(-Y,-Y,Z.width+2*Y,Z.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:ae.width,height:ae.height},ae.data)}}var Ct=function ne(Z,Y){var ae,he=Z&&Z.type;if("FeatureCollection"===he)for(ae=0;ae<Z.features.length;ae++)ne(Z.features[ae],Y);else if("GeometryCollection"===he)for(ae=0;ae<Z.geometries.length;ae++)ne(Z.geometries[ae],Y);else if("Feature"===he)ne(Z.geometry,Y);else if("Polygon"===he)hs(Z.coordinates,Y);else if("MultiPolygon"===he)for(ae=0;ae<Z.coordinates.length;ae++)hs(Z.coordinates[ae],Y);return Z};function hs(ne,Z){if(0!==ne.length){Fa(ne[0],Z);for(var Y=1;Y<ne.length;Y++)Fa(ne[Y],!Z)}}function Fa(ne,Z){for(var Y=0,ae=0,he=ne.length,be=he-1;ae<he;be=ae++)Y+=(ne[ae][0]-ne[be][0])*(ne[be][1]+ne[ae][1]);Y>=0!=!!Z&&ne.reverse()}const iu=g.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Wn{constructor(Z){this._feature=Z,this.extent=g.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(1===this._feature.type){const Z=[];for(const Y of this._feature.geometry)Z.push([new g.pointGeometry(Y[0],Y[1])]);return Z}{const Z=[];for(const Y of this._feature.geometry){const ae=[];for(const he of Y)ae.push(new g.pointGeometry(he[0],he[1]));Z.push(ae)}return Z}}toGeoJSON(Z,Y,ae){return iu.call(this,Z,Y,ae)}}class ou{constructor(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=Z.length,this._features=Z}feature(Z){return new Wn(this._features[Z])}}var su=g.vectorTile.VectorTileFeature,Oa=ds;function ds(ne,Z){this.options=Z||{},this.features=ne,this.length=ne.length}function li(ne,Z){this.id="number"==typeof ne.id?ne.id:void 0,this.type=ne.type,this.rawGeometry=1===ne.type?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=Z||4096}ds.prototype.feature=function(ne){return new li(this.features[ne],this.options.extent)},li.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var Z=0;Z<ne.length;Z++){for(var Y=ne[Z],ae=[],he=0;he<Y.length;he++)ae.push(new g.pointGeometry(Y[he][0],Y[he][1]));this.geometry.push(ae)}return this.geometry},li.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,Z=1/0,Y=-1/0,ae=1/0,he=-1/0,be=0;be<ne.length;be++)for(var we=ne[be],ke=0;ke<we.length;ke++){var Ee=we[ke];Z=Math.min(Z,Ee.x),Y=Math.max(Y,Ee.x),ae=Math.min(ae,Ee.y),he=Math.max(he,Ee.y)}return[Z,ae,Y,he]},li.prototype.toGeoJSON=su.prototype.toGeoJSON;var La=jn,au=Oa;function jn(ne){var Z=new g.pbf;return function(Y,ae){for(var he in Y.layers)ae.writeMessage(3,ci,Y.layers[he])}(ne,Z),Z.finish()}function ci(ne,Z){var Y;Z.writeVarintField(15,ne.version||1),Z.writeStringField(1,ne.name||""),Z.writeVarintField(5,ne.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<ne.length;Y++)ae.feature=ne.feature(Y),Z.writeMessage(2,tf,ae);var he=ae.keys;for(Y=0;Y<he.length;Y++)Z.writeStringField(3,he[Y]);var be=ae.values;for(Y=0;Y<be.length;Y++)Z.writeMessage(4,rc,be[Y])}function tf(ne,Z){var Y=ne.feature;void 0!==Y.id&&Z.writeVarintField(1,Y.id),Z.writeMessage(2,zs,ne),Z.writeVarintField(3,Y.type),Z.writeMessage(4,co,Y)}function zs(ne,Z){var Y=ne.feature,ae=ne.keys,he=ne.values,be=ne.keycache,we=ne.valuecache;for(var ke in Y.properties){var Ee=be[ke];void 0===Ee&&(ae.push(ke),be[ke]=Ee=ae.length-1),Z.writeVarint(Ee);var Oe=Y.properties[ke],Ye=typeof Oe;"string"!==Ye&&"boolean"!==Ye&&"number"!==Ye&&(Oe=JSON.stringify(Oe));var ft=Ye+":"+Oe,Xe=we[ft];void 0===Xe&&(he.push(Oe),we[ft]=Xe=he.length-1),Z.writeVarint(Xe)}}function nc(ne,Z){return(Z<<3)+(7&ne)}function Al(ne){return ne<<1^ne>>31}function co(ne,Z){for(var Y=ne.loadGeometry(),ae=ne.type,he=0,be=0,we=Y.length,ke=0;ke<we;ke++){var Ee=Y[ke],Oe=1;1===ae&&(Oe=Ee.length),Z.writeVarint(nc(1,Oe));for(var Ye=3===ae?Ee.length-1:Ee.length,ft=0;ft<Ye;ft++){1===ft&&1!==ae&&Z.writeVarint(nc(2,Ye-1));var Xe=Ee[ft].x-he,jt=Ee[ft].y-be;Z.writeVarint(Al(Xe)),Z.writeVarint(Al(jt)),he+=Xe,be+=jt}3===ae&&Z.writeVarint(nc(7,1))}}function rc(ne,Z){var Y=typeof ne;"string"===Y?Z.writeStringField(1,ne):"boolean"===Y?Z.writeBooleanField(7,ne):"number"===Y&&(ne%1!=0?Z.writeDoubleField(3,ne):ne<0?Z.writeSVarintField(6,ne):Z.writeVarintField(5,ne))}function As(ne,Z,Y,ae,he,be){if(he-ae<=Y)return;const we=ae+he>>1;fn(ne,Z,we,ae,he,be%2),As(ne,Z,Y,ae,we-1,be+1),As(ne,Z,Y,we+1,he,be+1)}function fn(ne,Z,Y,ae,he,be){for(;he>ae;){if(he-ae>600){const Oe=he-ae+1,Ye=Y-ae+1,ft=Math.log(Oe),Xe=.5*Math.exp(2*ft/3),jt=.5*Math.sqrt(ft*Xe*(Oe-Xe)/Oe)*(Ye-Oe/2<0?-1:1);fn(ne,Z,Y,Math.max(ae,Math.floor(Y-Ye*Xe/Oe+jt)),Math.min(he,Math.floor(Y+(Oe-Ye)*Xe/Oe+jt)),be)}const we=Z[2*Y+be];let ke=ae,Ee=he;for(Uo(ne,Z,ae,Y),Z[2*he+be]>we&&Uo(ne,Z,ae,he);ke<Ee;){for(Uo(ne,Z,ke,Ee),ke++,Ee--;Z[2*ke+be]<we;)ke++;for(;Z[2*Ee+be]>we;)Ee--}Z[2*ae+be]===we?Uo(ne,Z,ae,Ee):(Ee++,Uo(ne,Z,Ee,he)),Ee<=Y&&(ae=Ee+1),Y<=Ee&&(he=Ee-1)}}function Uo(ne,Z,Y,ae){kr(ne,Y,ae),kr(Z,2*Y,2*ae),kr(Z,2*Y+1,2*ae+1)}function kr(ne,Z,Y){const ae=ne[Z];ne[Z]=ne[Y],ne[Y]=ae}function Ba(ne,Z,Y,ae){const he=ne-Y,be=Z-ae;return he*he+be*be}La.fromVectorTileJs=jn,La.fromGeojsonVt=function(ne,Z){Z=Z||{};var Y={};for(var ae in ne)Y[ae]=new Oa(ne[ae].features,Z),Y[ae].name=ae,Y[ae].version=Z.version,Y[ae].extent=Z.extent;return jn({layers:Y})},La.GeoJSONWrapper=au;const Lr=ne=>ne[0],fs=ne=>ne[1];class Na{constructor(Z,Y=Lr,ae=fs,he=64,be=Float64Array){this.nodeSize=he,this.points=Z;const we=Z.length<65536?Uint16Array:Uint32Array,ke=this.ids=new we(Z.length),Ee=this.coords=new be(2*Z.length);for(let Oe=0;Oe<Z.length;Oe++)ke[Oe]=Oe,Ee[2*Oe]=Y(Z[Oe]),Ee[2*Oe+1]=ae(Z[Oe]);As(ke,Ee,he,0,ke.length-1,0)}range(Z,Y,ae,he){return function(be,we,ke,Ee,Oe,Ye,ft){const Xe=[0,be.length-1,0],jt=[];let Ce,Ge;for(;Xe.length;){const $t=Xe.pop(),pn=Xe.pop(),tn=Xe.pop();if(pn-tn<=ft){for(let gr=tn;gr<=pn;gr++)Ce=we[2*gr],Ge=we[2*gr+1],Ce>=ke&&Ce<=Oe&&Ge>=Ee&&Ge<=Ye&&jt.push(be[gr]);continue}const Yn=Math.floor((tn+pn)/2);Ce=we[2*Yn],Ge=we[2*Yn+1],Ce>=ke&&Ce<=Oe&&Ge>=Ee&&Ge<=Ye&&jt.push(be[Yn]);const Bn=($t+1)%2;(0===$t?ke<=Ce:Ee<=Ge)&&(Xe.push(tn),Xe.push(Yn-1),Xe.push(Bn)),(0===$t?Oe>=Ce:Ye>=Ge)&&(Xe.push(Yn+1),Xe.push(pn),Xe.push(Bn))}return jt}(this.ids,this.coords,Z,Y,ae,he,this.nodeSize)}within(Z,Y,ae){return function(he,be,we,ke,Ee,Oe){const Ye=[0,he.length-1,0],ft=[],Xe=Ee*Ee;for(;Ye.length;){const jt=Ye.pop(),Ce=Ye.pop(),Ge=Ye.pop();if(Ce-Ge<=Oe){for(let Bn=Ge;Bn<=Ce;Bn++)Ba(be[2*Bn],be[2*Bn+1],we,ke)<=Xe&&ft.push(he[Bn]);continue}const $t=Math.floor((Ge+Ce)/2),pn=be[2*$t],tn=be[2*$t+1];Ba(pn,tn,we,ke)<=Xe&&ft.push(he[$t]);const Yn=(jt+1)%2;(0===jt?we-Ee<=pn:ke-Ee<=tn)&&(Ye.push(Ge),Ye.push($t-1),Ye.push(Yn)),(0===jt?we+Ee>=pn:ke+Ee>=tn)&&(Ye.push($t+1),Ye.push(Ce),Ye.push(Yn))}return ft}(this.ids,this.coords,Z,Y,ae,this.nodeSize)}}const fl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},za=Math.fround||(Va=new Float32Array(1),ne=>(Va[0]=+ne,Va[0]));var Va;class Ln{constructor(Z){this.options=Vs(Object.create(fl),Z),this.trees=new Array(this.options.maxZoom+1)}load(Z){const{log:Y,minZoom:ae,maxZoom:he,nodeSize:be}=this.options;Y&&console.time("total time");const we=`prepare ${Z.length} points`;Y&&console.time(we),this.points=Z;let ke=[];for(let Ee=0;Ee<Z.length;Ee++)Z[Ee].geometry&&ke.push(ml(Z[Ee],Ee));this.trees[he+1]=new Na(ke,Ua,Pr,be,Float32Array),Y&&console.timeEnd(we);for(let Ee=he;Ee>=ae;Ee--){const Oe=+Date.now();ke=this._cluster(ke,Ee),this.trees[Ee]=new Na(ke,Ua,Pr,be,Float32Array),Y&&console.log("z%d: %d clusters in %dms",Ee,ke.length,+Date.now()-Oe)}return Y&&console.timeEnd("total time"),this}getClusters(Z,Y){let ae=((Z[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,Z[1]));let be=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ae=-180,be=180;else if(ae>be){const Ye=this.getClusters([ae,he,180,we],Y),ft=this.getClusters([-180,he,be,we],Y);return Ye.concat(ft)}const ke=this.trees[this._limitZoom(Y)],Ee=ke.range(uo(ae),ha(we),uo(be),ha(he)),Oe=[];for(const Ye of Ee){const ft=ke.points[Ye];Oe.push(ft.numPoints?lu(ft):this.points[ft.index])}return Oe}getChildren(Z){const Y=this._getOriginId(Z),ae=this._getOriginZoom(Z),he="No cluster with the specified id.",be=this.trees[ae];if(!be)throw new Error(he);const we=be.points[Y];if(!we)throw new Error(he);const ke=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Ee=be.within(we.x,we.y,ke),Oe=[];for(const Ye of Ee){const ft=be.points[Ye];ft.parentId===Z&&Oe.push(ft.numPoints?lu(ft):this.points[ft.index])}if(0===Oe.length)throw new Error(he);return Oe}getLeaves(Z,Y,ae){const he=[];return this._appendLeaves(he,Z,Y=Y||10,ae=ae||0,0),he}getTile(Z,Y,ae){const he=this.trees[this._limitZoom(Z)],be=Math.pow(2,Z),{extent:we,radius:ke}=this.options,Ee=ke/we,Oe=(ae-Ee)/be,Ye=(ae+1+Ee)/be,ft={features:[]};return this._addTileFeatures(he.range((Y-Ee)/be,Oe,(Y+1+Ee)/be,Ye),he.points,Y,ae,be,ft),0===Y&&this._addTileFeatures(he.range(1-Ee/be,Oe,1,Ye),he.points,be,ae,be,ft),Y===be-1&&this._addTileFeatures(he.range(0,Oe,Ee/be,Ye),he.points,-1,ae,be,ft),ft.features.length?ft:null}getClusterExpansionZoom(Z){let Y=this._getOriginZoom(Z)-1;for(;Y<=this.options.maxZoom;){const ae=this.getChildren(Z);if(Y++,1!==ae.length)break;Z=ae[0].properties.cluster_id}return Y}_appendLeaves(Z,Y,ae,he,be){const we=this.getChildren(Y);for(const ke of we){const Ee=ke.properties;if(Ee&&Ee.cluster?be+Ee.point_count<=he?be+=Ee.point_count:be=this._appendLeaves(Z,Ee.cluster_id,ae,he,be):be<he?be++:Z.push(ke),Z.length===ae)break}return be}_addTileFeatures(Z,Y,ae,he,be,we){for(const ke of Z){const Ee=Y[ke],Oe=Ee.numPoints;let Ye,ft,Xe;if(Oe)Ye=cu(Ee),ft=Ee.x,Xe=Ee.y;else{const Ge=this.points[Ee.index];Ye=Ge.properties,ft=uo(Ge.geometry.coordinates[0]),Xe=ha(Ge.geometry.coordinates[1])}const jt={type:1,geometry:[[Math.round(this.options.extent*(ft*be-ae)),Math.round(this.options.extent*(Xe*be-he))]],tags:Ye};let Ce;Oe?Ce=Ee.id:this.options.generateId?Ce=Ee.index:this.points[Ee.index].id&&(Ce=this.points[Ee.index].id),void 0!==Ce&&(jt.id=Ce),we.features.push(jt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))}_cluster(Z,Y){const ae=[],{radius:he,extent:be,reduce:we,minPoints:ke}=this.options,Ee=he/(be*Math.pow(2,Y));for(let Oe=0;Oe<Z.length;Oe++){const Ye=Z[Oe];if(Ye.zoom<=Y)continue;Ye.zoom=Y;const ft=this.trees[Y+1],Xe=ft.within(Ye.x,Ye.y,Ee),jt=Ye.numPoints||1;let Ce=jt;for(const Ge of Xe){const $t=ft.points[Ge];$t.zoom>Y&&(Ce+=$t.numPoints||1)}if(Ce>=ke){let Ge=Ye.x*jt,$t=Ye.y*jt,pn=we&&jt>1?this._map(Ye,!0):null;const tn=(Oe<<5)+(Y+1)+this.points.length;for(const Yn of Xe){const Bn=ft.points[Yn];if(Bn.zoom<=Y)continue;Bn.zoom=Y;const gr=Bn.numPoints||1;Ge+=Bn.x*gr,$t+=Bn.y*gr,Bn.parentId=tn,we&&(pn||(pn=this._map(Ye,!0)),we(pn,this._map(Bn)))}Ye.parentId=tn,ae.push(pl(Ge/Ce,$t/Ce,tn,Ce,pn))}else if(ae.push(Ye),Ce>1)for(const Ge of Xe){const $t=ft.points[Ge];$t.zoom<=Y||($t.zoom=Y,ae.push($t))}}return ae}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Y){if(Z.numPoints)return Y?Vs({},Z.properties):Z.properties;const ae=this.points[Z.index].properties,he=this.options.map(ae);return Y&&he===ae?Vs({},he):he}}function pl(ne,Z,Y,ae,he){return{x:za(ne),y:za(Z),zoom:1/0,id:Y,parentId:-1,numPoints:ae,properties:he}}function ml(ne,Z){const[Y,ae]=ne.geometry.coordinates;return{x:za(uo(Y)),y:za(ha(ae)),zoom:1/0,index:Z,parentId:-1}}function lu(ne){return{type:"Feature",id:ne.id,properties:cu(ne),geometry:{type:"Point",coordinates:[(Z=ne.x,360*(Z-.5)),Qn(ne.y)]}};var Z}function cu(ne){const Z=ne.numPoints,Y=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z;return Vs(Vs({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:Z,point_count_abbreviated:Y})}function uo(ne){return ne/360+.5}function ha(ne){const Z=Math.sin(ne*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function Qn(ne){const Z=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Vs(ne,Z){for(const Y in Z)ne[Y]=Z[Y];return ne}function Ua(ne){return ne.x}function Pr(ne){return ne.y}function da(ne,Z,Y,ae){for(var he,be=ae,we=Y-Z>>1,ke=Y-Z,Ee=ne[Z],Oe=ne[Z+1],Ye=ne[Y],ft=ne[Y+1],Xe=Z+3;Xe<Y;Xe+=3){var jt=vd(ne[Xe],ne[Xe+1],Ee,Oe,Ye,ft);if(jt>be)he=Xe,be=jt;else if(jt===be){var Ce=Math.abs(Xe-we);Ce<ke&&(he=Xe,ke=Ce)}}be>ae&&(he-Z>3&&da(ne,Z,he,ae),ne[he+2]=be,Y-he>3&&da(ne,he,Y,ae))}function vd(ne,Z,Y,ae,he,be){var we=he-Y,ke=be-ae;if(0!==we||0!==ke){var Ee=((ne-Y)*we+(Z-ae)*ke)/(we*we+ke*ke);Ee>1?(Y=he,ae=be):Ee>0&&(Y+=we*Ee,ae+=ke*Ee)}return(we=ne-Y)*we+(ke=Z-ae)*ke}function Us(ne,Z,Y,ae){var he={id:void 0===ne?null:ne,type:Z,geometry:Y,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(be){var we=be.geometry,ke=be.type;if("Point"===ke||"MultiPoint"===ke||"LineString"===ke)uu(be,we);else if("Polygon"===ke||"MultiLineString"===ke)for(var Ee=0;Ee<we.length;Ee++)uu(be,we[Ee]);else if("MultiPolygon"===ke)for(Ee=0;Ee<we.length;Ee++)for(var Oe=0;Oe<we[Ee].length;Oe++)uu(be,we[Ee][Oe])}(he),he}function uu(ne,Z){for(var Y=0;Y<Z.length;Y+=3)ne.minX=Math.min(ne.minX,Z[Y]),ne.minY=Math.min(ne.minY,Z[Y+1]),ne.maxX=Math.max(ne.maxX,Z[Y]),ne.maxY=Math.max(ne.maxY,Z[Y+1])}function Aa(ne,Z,Y,ae){if(Z.geometry){var he=Z.geometry.coordinates,be=Z.geometry.type,we=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),ke=[],Ee=Z.id;if(Y.promoteId?Ee=Z.properties[Y.promoteId]:Y.generateId&&(Ee=ae||0),"Point"===be)mr(he,ke);else if("MultiPoint"===be)for(var Oe=0;Oe<he.length;Oe++)mr(he[Oe],ke);else if("LineString"===be)ja(he,ke,we,!1);else if("MultiLineString"===be){if(Y.lineMetrics){for(Oe=0;Oe<he.length;Oe++)ja(he[Oe],ke=[],we,!1),ne.push(Us(Ee,"LineString",ke,Z.properties));return}hu(he,ke,we,!1)}else if("Polygon"===be)hu(he,ke,we,!0);else{if("MultiPolygon"!==be){if("GeometryCollection"===be){for(Oe=0;Oe<Z.geometry.geometries.length;Oe++)Aa(ne,{id:Ee,geometry:Z.geometry.geometries[Oe],properties:Z.properties},Y,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Oe=0;Oe<he.length;Oe++){var Ye=[];hu(he[Oe],Ye,we,!0),ke.push(Ye)}}ne.push(Us(Ee,be,ke,Z.properties))}}function mr(ne,Z){Z.push(ps(ne[0])),Z.push(jo(ne[1])),Z.push(0)}function ja(ne,Z,Y,ae){for(var he,be,we=0,ke=0;ke<ne.length;ke++){var Ee=ps(ne[ke][0]),Oe=jo(ne[ke][1]);Z.push(Ee),Z.push(Oe),Z.push(0),ke>0&&(we+=ae?(he*Oe-Ee*be)/2:Math.sqrt(Math.pow(Ee-he,2)+Math.pow(Oe-be,2))),he=Ee,be=Oe}var Ye=Z.length-3;Z[2]=1,da(Z,0,Ye,Y),Z[Ye+2]=1,Z.size=Math.abs(we),Z.start=0,Z.end=Z.size}function hu(ne,Z,Y,ae){for(var he=0;he<ne.length;he++){var be=[];ja(ne[he],be,Y,ae),Z.push(be)}}function ps(ne){return ne/360+.5}function jo(ne){var Z=Math.sin(ne*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function vo(ne,Z,Y,ae,he,be,we,ke){if(ae/=Z,be>=(Y/=Z)&&we<ae)return ne;if(we<Y||be>=ae)return null;for(var Ee=[],Oe=0;Oe<ne.length;Oe++){var Ye=ne[Oe],ft=Ye.geometry,Xe=Ye.type,jt=0===he?Ye.minX:Ye.minY,Ce=0===he?Ye.maxX:Ye.maxY;if(jt>=Y&&Ce<ae)Ee.push(Ye);else if(!(Ce<Y||jt>=ae)){var Ge=[];if("Point"===Xe||"MultiPoint"===Xe)du(ft,Ge,Y,ae,he);else if("LineString"===Xe)gl(ft,Ge,Y,ae,he,!1,ke.lineMetrics);else if("MultiLineString"===Xe)ic(ft,Ge,Y,ae,he,!1);else if("Polygon"===Xe)ic(ft,Ge,Y,ae,he,!0);else if("MultiPolygon"===Xe)for(var $t=0;$t<ft.length;$t++){var pn=[];ic(ft[$t],pn,Y,ae,he,!0),pn.length&&Ge.push(pn)}if(Ge.length){if(ke.lineMetrics&&"LineString"===Xe){for($t=0;$t<Ge.length;$t++)Ee.push(Us(Ye.id,Xe,Ge[$t],Ye.tags));continue}"LineString"!==Xe&&"MultiLineString"!==Xe||(1===Ge.length?(Xe="LineString",Ge=Ge[0]):Xe="MultiLineString"),"Point"!==Xe&&"MultiPoint"!==Xe||(Xe=3===Ge.length?"Point":"MultiPoint"),Ee.push(Us(Ye.id,Xe,Ge,Ye.tags))}}}return Ee.length?Ee:null}function du(ne,Z,Y,ae,he){for(var be=0;be<ne.length;be+=3){var we=ne[be+he];we>=Y&&we<=ae&&(Z.push(ne[be]),Z.push(ne[be+1]),Z.push(ne[be+2]))}}function gl(ne,Z,Y,ae,he,be,we){for(var ke,Ee,Oe=fh(ne),Ye=0===he?ph:xd,ft=ne.start,Xe=0;Xe<ne.length-3;Xe+=3){var jt=ne[Xe],Ce=ne[Xe+1],Ge=ne[Xe+2],$t=ne[Xe+3],pn=ne[Xe+4],tn=0===he?jt:Ce,Yn=0===he?$t:pn,Bn=!1;we&&(ke=Math.sqrt(Math.pow(jt-$t,2)+Math.pow(Ce-pn,2))),tn<Y?Yn>Y&&(Ee=Ye(Oe,jt,Ce,$t,pn,Y),we&&(Oe.start=ft+ke*Ee)):tn>ae?Yn<ae&&(Ee=Ye(Oe,jt,Ce,$t,pn,ae),we&&(Oe.start=ft+ke*Ee)):oc(Oe,jt,Ce,Ge),Yn<Y&&tn>=Y&&(Ee=Ye(Oe,jt,Ce,$t,pn,Y),Bn=!0),Yn>ae&&tn<=ae&&(Ee=Ye(Oe,jt,Ce,$t,pn,ae),Bn=!0),!be&&Bn&&(we&&(Oe.end=ft+ke*Ee),Z.push(Oe),Oe=fh(ne)),we&&(ft+=ke)}var gr=ne.length-3;jt=ne[gr],Ce=ne[gr+1],Ge=ne[gr+2],(tn=0===he?jt:Ce)>=Y&&tn<=ae&&oc(Oe,jt,Ce,Ge),gr=Oe.length-3,be&&gr>=3&&(Oe[gr]!==Oe[0]||Oe[gr+1]!==Oe[1])&&oc(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&Z.push(Oe)}function fh(ne){var Z=[];return Z.size=ne.size,Z.start=ne.start,Z.end=ne.end,Z}function ic(ne,Z,Y,ae,he,be){for(var we=0;we<ne.length;we++)gl(ne[we],Z,Y,ae,he,be,!1)}function oc(ne,Z,Y,ae){ne.push(Z),ne.push(Y),ne.push(ae)}function ph(ne,Z,Y,ae,he,be){var we=(be-Z)/(ae-Z);return ne.push(be),ne.push(Y+(he-Y)*we),ne.push(1),we}function xd(ne,Z,Y,ae,he,be){var we=(be-Y)/(he-Y);return ne.push(Z+(ae-Z)*we),ne.push(be),ne.push(1),we}function sc(ne,Z){for(var Y=[],ae=0;ae<ne.length;ae++){var he,be=ne[ae],we=be.type;if("Point"===we||"MultiPoint"===we||"LineString"===we)he=ac(be.geometry,Z);else if("MultiLineString"===we||"Polygon"===we){he=[];for(var ke=0;ke<be.geometry.length;ke++)he.push(ac(be.geometry[ke],Z))}else if("MultiPolygon"===we)for(he=[],ke=0;ke<be.geometry.length;ke++){for(var Ee=[],Oe=0;Oe<be.geometry[ke].length;Oe++)Ee.push(ac(be.geometry[ke][Oe],Z));he.push(Ee)}Y.push(Us(be.id,we,he,be.tags))}return Y}function ac(ne,Z){var Y=[];Y.size=ne.size,void 0!==ne.start&&(Y.start=ne.start,Y.end=ne.end);for(var ae=0;ae<ne.length;ae+=3)Y.push(ne[ae]+Z,ne[ae+1],ne[ae+2]);return Y}function $o(ne,Z){if(ne.transformed)return ne;var Y,ae,he,be=1<<ne.z,we=ne.x,ke=ne.y;for(Y=0;Y<ne.features.length;Y++){var Ee=ne.features[Y],Oe=Ee.geometry,Ye=Ee.type;if(Ee.geometry=[],1===Ye)for(ae=0;ae<Oe.length;ae+=2)Ee.geometry.push($a(Oe[ae],Oe[ae+1],Z,be,we,ke));else for(ae=0;ae<Oe.length;ae++){var ft=[];for(he=0;he<Oe[ae].length;he+=2)ft.push($a(Oe[ae][he],Oe[ae][he+1],Z,be,we,ke));Ee.geometry.push(ft)}}return ne.transformed=!0,ne}function $a(ne,Z,Y,ae,he,be){return[Math.round(Y*(ne*ae-he)),Math.round(Y*(Z*ae-be))]}function mh(ne,Z,Y,ae,he){for(var be=Z===he.maxZoom?0:he.tolerance/((1<<Z)*he.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ae,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<ne.length;ke++){we.numFeatures++,Au(we,ne[ke],be,he);var Ee=ne[ke].minX,Oe=ne[ke].minY,Ye=ne[ke].maxX,ft=ne[ke].maxY;Ee<we.minX&&(we.minX=Ee),Oe<we.minY&&(we.minY=Oe),Ye>we.maxX&&(we.maxX=Ye),ft>we.maxY&&(we.maxY=ft)}return we}function Au(ne,Z,Y,ae){var he=Z.geometry,be=Z.type,we=[];if("Point"===be||"MultiPoint"===be)for(var ke=0;ke<he.length;ke+=3)we.push(he[ke]),we.push(he[ke+1]),ne.numPoints++,ne.numSimplified++;else if("LineString"===be)Pn(we,he,ne,Y,!1,!1);else if("MultiLineString"===be||"Polygon"===be)for(ke=0;ke<he.length;ke++)Pn(we,he[ke],ne,Y,"Polygon"===be,0===ke);else if("MultiPolygon"===be)for(var Ee=0;Ee<he.length;Ee++){var Oe=he[Ee];for(ke=0;ke<Oe.length;ke++)Pn(we,Oe[ke],ne,Y,!0,0===ke)}if(we.length){var Ye=Z.tags||null;if("LineString"===be&&ae.lineMetrics){for(var ft in Ye={},Z.tags)Ye[ft]=Z.tags[ft];Ye.mapbox_clip_start=he.start/he.size,Ye.mapbox_clip_end=he.end/he.size}var Xe={geometry:we,type:"Polygon"===be||"MultiPolygon"===be?3:"LineString"===be||"MultiLineString"===be?2:1,tags:Ye};null!==Z.id&&(Xe.id=Z.id),ne.features.push(Xe)}}function Pn(ne,Z,Y,ae,he,be){var we=ae*ae;if(ae>0&&Z.size<(he?we:ae))Y.numPoints+=Z.length/3;else{for(var ke=[],Ee=0;Ee<Z.length;Ee+=3)(0===ae||Z[Ee+2]>we)&&(Y.numSimplified++,ke.push(Z[Ee]),ke.push(Z[Ee+1])),Y.numPoints++;he&&function(Oe,Ye){for(var ft=0,Xe=0,jt=Oe.length,Ce=jt-2;Xe<jt;Ce=Xe,Xe+=2)ft+=(Oe[Xe]-Oe[Ce])*(Oe[Xe+1]+Oe[Ce+1]);if(ft>0===Ye)for(Xe=0,jt=Oe.length;Xe<jt/2;Xe+=2){var Ge=Oe[Xe],$t=Oe[Xe+1];Oe[Xe]=Oe[jt-2-Xe],Oe[Xe+1]=Oe[jt-1-Xe],Oe[jt-2-Xe]=Ge,Oe[jt-1-Xe]=$t}}(ke,be),ne.push(ke)}}function fa(ne,Z){var Y=(Z=this.options=function(he,be){for(var we in be)he[we]=be[we];return he}(Object.create(this.options),Z)).debug;if(Y&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,be,we,ke,Ee,Oe,ae=function(he,be){var we=[];if("FeatureCollection"===he.type)for(var ke=0;ke<he.features.length;ke++)Aa(we,he.features[ke],be,ke);else Aa(we,"Feature"===he.type?he:{geometry:he},be);return we}(ne,Z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=ae,be=Z,we=be.buffer/be.extent,ke=he,Ee=vo(he,1,-1-we,we,0,-1,2,be),Oe=vo(he,1,1-we,2+we,0,-1,2,be),(Ee||Oe)&&(ke=vo(he,1,-we,1+we,0,-1,2,be)||[],Ee&&(ke=sc(Ee,1).concat(ke)),Oe&&(ke=ke.concat(sc(Oe,-1)))),ae=ke).length&&this.splitTile(ae,0,0,0),Y&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function sn(ne,Z,Y){return 32*((1<<ne)*Y+Z)+ne}function pa(ne,Z){const Y=ne.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ae=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ae)return Z(null,null);const he=new ou(ae.features);let be=La(he);0===be.byteOffset&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),Z(null,{vectorTile:he,rawData:be.buffer})}fa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fa.prototype.splitTile=function(ne,Z,Y,ae,he,be,we){for(var ke=[ne,Z,Y,ae],Ee=this.options,Oe=Ee.debug;ke.length;){ae=ke.pop(),Y=ke.pop(),Z=ke.pop(),ne=ke.pop();var Ye=1<<Z,ft=sn(Z,Y,ae),Xe=this.tiles[ft];if(!Xe&&(Oe>1&&console.time("creation"),Xe=this.tiles[ft]=mh(ne,Z,Y,ae,Ee),this.tileCoords.push({z:Z,x:Y,y:ae}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Y,ae,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var jt="z"+Z;this.stats[jt]=(this.stats[jt]||0)+1,this.total++}if(Xe.source=ne,he){if(Z===Ee.maxZoom||Z===he)continue;var Ce=1<<he-Z;if(Y!==Math.floor(be/Ce)||ae!==Math.floor(we/Ce))continue}else if(Z===Ee.indexMaxZoom||Xe.numPoints<=Ee.indexMaxPoints)continue;if(Xe.source=null,0!==ne.length){Oe>1&&console.time("clipping");var Ge,$t,pn,tn,Yn,Bn,gr=.5*Ee.buffer/Ee.extent,Ga=.5-gr,vt=.5+gr,yn=1+gr;Ge=$t=pn=tn=null,Yn=vo(ne,Ye,Y-gr,Y+vt,0,Xe.minX,Xe.maxX,Ee),Bn=vo(ne,Ye,Y+Ga,Y+yn,0,Xe.minX,Xe.maxX,Ee),ne=null,Yn&&(Ge=vo(Yn,Ye,ae-gr,ae+vt,1,Xe.minY,Xe.maxY,Ee),$t=vo(Yn,Ye,ae+Ga,ae+yn,1,Xe.minY,Xe.maxY,Ee),Yn=null),Bn&&(pn=vo(Bn,Ye,ae-gr,ae+vt,1,Xe.minY,Xe.maxY,Ee),tn=vo(Bn,Ye,ae+Ga,ae+yn,1,Xe.minY,Xe.maxY,Ee),Bn=null),Oe>1&&console.timeEnd("clipping"),ke.push(Ge||[],Z+1,2*Y,2*ae),ke.push($t||[],Z+1,2*Y,2*ae+1),ke.push(pn||[],Z+1,2*Y+1,2*ae),ke.push(tn||[],Z+1,2*Y+1,2*ae+1)}}},fa.prototype.getTile=function(ne,Z,Y){var ae=this.options,he=ae.extent,be=ae.debug;if(ne<0||ne>24)return null;var we=1<<ne,ke=sn(ne,Z=(Z%we+we)%we,Y);if(this.tiles[ke])return $o(this.tiles[ke],he);be>1&&console.log("drilling down to z%d-%d-%d",ne,Z,Y);for(var Ee,Oe=ne,Ye=Z,ft=Y;!Ee&&Oe>0;)Oe--,Ye=Math.floor(Ye/2),ft=Math.floor(ft/2),Ee=this.tiles[sn(Oe,Ye,ft)];return Ee&&Ee.source?(be>1&&console.log("found parent tile z%d-%d-%d",Oe,Ye,ft),be>1&&console.time("drilling down"),this.splitTile(Ee.source,Oe,Ye,ft,ne,Z,Y),be>1&&console.timeEnd("drilling down"),this.tiles[ke]?$o(this.tiles[ke],he):null):null};class lc extends g.VectorTileWorkerSource{constructor(Z,Y,ae,he,be){super(Z,Y,ae,he,pa),be&&(this.loadGeoJSON=be)}loadData(Z,Y){const ae=Z&&Z.request,he=ae&&ae.collectResourceTiming;this.loadGeoJSON(Z,(be,we)=>{if(be||!we)return Y(be);if("object"!=typeof we)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Ct(we,!0);try{if(Z.filter){const Ee=g.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ee.result)throw new Error(Ee.value.map(Ye=>`${Ye.key}: ${Ye.message}`).join(", "));const Oe=we.features.filter(Ye=>Ee.value.evaluate({zoom:0},Ye));we={type:"FeatureCollection",features:Oe}}this._geoJSONIndex=Z.cluster?new Ln(function({superclusterOptions:Ee,clusterProperties:Oe}){if(!Oe||!Ee)return Ee;const Ye={},ft={},Xe={accumulated:null,zoom:0},jt={properties:null},Ce=Object.keys(Oe);for(const Ge of Ce){const[$t,pn]=Oe[Ge],tn=g.createExpression(pn),Yn=g.createExpression("string"==typeof $t?[$t,["accumulated"],["get",Ge]]:$t);Ye[Ge]=tn.value,ft[Ge]=Yn.value}return Ee.map=Ge=>{jt.properties=Ge;const $t={};for(const pn of Ce)$t[pn]=Ye[pn].evaluate(Xe,jt);return $t},Ee.reduce=(Ge,$t)=>{jt.properties=$t;for(const pn of Ce)Xe.accumulated=Ge[pn],Ge[pn]=ft[pn].evaluate(Xe,jt)},Ee}(Z)).load(we.features):new fa(Ee=we,Z.geojsonVtOptions)}catch(Ee){return Y(Ee)}this.loaded={};const ke={};if(he){const Ee=g.getPerformanceMeasurement(ae);Ee&&(ke.resourceTiming={},ke.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ee)))}Y(null,ke)}var Ee})}reloadTile(Z,Y){const ae=this.loaded;return ae&&ae[Z.uid]?super.reloadTile(Z,Y):this.loadTile(Z,Y)}loadGeoJSON(Z,Y){if(Z.request)g.getJSON(Z.request,Y);else{if("string"!=typeof Z.data)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(Z.data))}catch(ae){return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ae){Y(ae)}}getClusterChildren(Z,Y){try{Y(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ae){Y(ae)}}getClusterLeaves(Z,Y){try{Y(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ae){Y(ae)}}}class $n{constructor(Z){this.self=Z,this.actor=new g.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:g.VectorTileWorkerSource,geojson:lc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,ae)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ae},this.self.registerRTLTextPlugin=Y=>{if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=Y.applyArabicShaping,g.plugin.processBidirectionalText=Y.processBidirectionalText,g.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}checkIfReady(Z,Y,ae){ae()}setReferrer(Z,Y){this.referrer=Y}spriteLoaded(Z,Y){this.isSpriteLoaded=Y;for(const ae in this.workerSources[Z]){const he=this.workerSources[Z][ae];for(const be in he)he[be]instanceof g.VectorTileWorkerSource&&(he[be].isSpriteLoaded=Y,he[be].fire(new g.Event("isSpriteLoaded")))}}setImages(Z,Y,ae){this.availableImages[Z]=Y;for(const he in this.workerSources[Z]){const be=this.workerSources[Z][he];for(const we in be)be[we].availableImages=Y}ae()}enableTerrain(Z,Y,ae){this.terrain=Y,ae()}setLayers(Z,Y,ae){this.getLayerIndex(Z).replace(Y),ae()}updateLayers(Z,Y,ae){this.getLayerIndex(Z).update(Y.layers,Y.removedIds),ae()}loadTile(Z,Y,ae){const he=this.enableTerrain?g.extend({enableTerrain:this.terrain},Y):Y;this.getWorkerSource(Z,Y.type,Y.source).loadTile(he,ae)}loadDEMTile(Z,Y,ae){const he=this.enableTerrain?g.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(Z,Y.source).loadTile(he,ae)}reloadTile(Z,Y,ae){const he=this.enableTerrain?g.extend({enableTerrain:this.terrain},Y):Y;this.getWorkerSource(Z,Y.type,Y.source).reloadTile(he,ae)}abortTile(Z,Y,ae){this.getWorkerSource(Z,Y.type,Y.source).abortTile(Y,ae)}removeTile(Z,Y,ae){this.getWorkerSource(Z,Y.type,Y.source).removeTile(Y,ae)}removeSource(Z,Y,ae){if(!this.workerSources[Z]||!this.workerSources[Z][Y.type]||!this.workerSources[Z][Y.type][Y.source])return;const he=this.workerSources[Z][Y.type][Y.source];delete this.workerSources[Z][Y.type][Y.source],void 0!==he.removeSource?he.removeSource(Y,ae):ae()}loadWorkerSource(Z,Y,ae){try{this.self.importScripts(Y.url),ae()}catch(he){ae(he.toString())}}syncRTLPluginState(Z,Y,ae){try{g.plugin.setState(Y);const he=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&null!=he){this.self.importScripts(he);const be=g.plugin.isParsed();ae(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),be)}}catch(he){ae(he.toString())}}getAvailableImages(Z){let Y=this.availableImages[Z];return Y||(Y=[]),Y}getLayerIndex(Z){let Y=this.layerIndexes[Z];return Y||(Y=this.layerIndexes[Z]=new lo),Y}getWorkerSource(Z,Y,ae){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Y]||(this.workerSources[Z][Y]={}),this.workerSources[Z][Y][ae]||(this.workerSources[Z][Y][ae]=new this.workerSourceTypes[Y]({send:(he,be,we,ke,Ee,Oe)=>{this.actor.send(he,be,we,Z,Ee,Oe)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded)),this.workerSources[Z][Y][ae]}getDEMWorkerSource(Z,Y){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Y]||(this.demWorkerSources[Z][Y]=new ot),this.demWorkerSources[Z][Y]}enforceCacheSizeLimit(Z,Y){g.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(Z,Y,ae){ae(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new $n(self)),$n}),yd(0,function(g){var yo=Vo;function Vo(_){return o=_,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,E,D=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(D);try{E=new Worker(R),v=!0}catch(B){v=!1}return E&&E.terminate(),URL.revokeObjectURL(R),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var E=v.getContext("2d");if(!E)return!1;var D=E.getImageData(0,0,1,1);return D&&D.width===v.width}()||(void 0===lo[h=o&&o.failIfMajorPerformanceCaveat]&&(lo[h]=function(v){var E,R,B,z,D=(R=v,B=document.createElement("canvas"),(z=Object.create(Vo.webGLContextAttributes)).failIfMajorPerformanceCaveat=R,B.getContext("webgl",z)||B.getContext("experimental-webgl",z));if(!D)return!1;try{E=D.createShader(D.VERTEX_SHADER)}catch(R){return!1}return!(!E||D.isContextLost())&&(D.shaderSource(E,"void main() {}"),D.compileShader(E),!0===D.getShaderParameter(E,D.COMPILE_STATUS))}(h)),!lo[h]||document.documentMode));var o,h}var lo={};function ct(_,o){if(Array.isArray(_)){if(!Array.isArray(o)||_.length!==o.length)return!1;for(let h=0;h<_.length;h++)if(!ct(_[h],o[h]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==o){if("object"!=typeof o||Object.keys(_).length!==Object.keys(o).length)return!1;for(const h in _)if(!ct(_[h],o[h]))return!1;return!0}return _===o}Vo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ot={create:function(_,o,h){const v=g.window.document.createElement(_);return void 0!==o&&(v.className=o),h&&h.appendChild(v),v},createNS:function(_,o){return g.window.document.createElementNS(_,o)}},Ct=g.window.document&&g.window.document.documentElement.style,hs=Ct&&void 0!==Ct.userSelect?"userSelect":"WebkitUserSelect";let Fa;ot.disableDrag=function(){Ct&&hs&&(Fa=Ct[hs],Ct[hs]="none")},ot.enableDrag=function(){Ct&&hs&&(Ct[hs]=Fa)},ot.setTransform=function(_,o){_.style.transform=o};let iu=!1;try{const _=Object.defineProperty({},"passive",{get(){iu=!0}});g.window.addEventListener("test",_,_),g.window.removeEventListener("test",_,_)}catch(_){iu=!1}ot.addEventListener=function(_,o,h,v={}){_.addEventListener(o,h,"passive"in v&&iu?v:v.capture)},ot.removeEventListener=function(_,o,h,v={}){_.removeEventListener(o,h,"passive"in v&&iu?v:v.capture)};const Wn=function(_){_.preventDefault(),_.stopPropagation(),g.window.removeEventListener("click",Wn,!0)};function ou(_,o,h){const v=_.offsetWidth===o.width?1:_.offsetWidth/o.width;return new g.pointGeometry((h.clientX-o.left)*v,(h.clientY-o.top)*v)}ot.suppressClick=function(){g.window.addEventListener("click",Wn,!0),g.window.setTimeout(()=>{g.window.removeEventListener("click",Wn,!0)},0)},ot.mousePos=function(_,o){const h=_.getBoundingClientRect();return ou(_,h,o)},ot.touchPos=function(_,o){const h=_.getBoundingClientRect(),v=[];for(let E=0;E<o.length;E++)v.push(ou(_,h,o[E]));return v},ot.mouseButton=function(_){return void 0!==g.window.InstallTrigger&&2===_.button&&_.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button},ot.remove=function(_){_.parentNode&&_.parentNode.removeChild(_)};class su{constructor(o,h){this.pos=o,this.dir=h}intersectsPlane(o,h,v){const E=g.dot(h,this.dir);if(Math.abs(E)<1e-6)return!1;const D=g.dot(g.sub(g.create(),o,this.pos),h)/E,R=g.scaleAndAdd(g.create(),this.pos,this.dir,D);return g.copy(v,R),!0}}class Oa{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,v){const E=Math.pow(2,v),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const z=g.transformMat4([],B,o),G=1/z[3]/h*E;return g.mul(z,z,[G,G,1/z[3],G])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const z=g.sub([],D[B[0]],D[B[1]]),G=g.sub([],D[B[2]],D[B[1]]),H=g.normalize([],g.cross([],z,G)),Q=-g.dot(H,D[B[1]]);return H.concat(Q)});return new Oa(D,R)}}class ds{constructor(o,h){this.min=o,this.max=h,this.center=g.scale([],g.add([],this.min,this.max),.5)}quadrant(o){const h=[o%2==0,o<2],v=g.clone(this.min),E=g.clone(this.max);for(let D=0;D<h.length;D++)v[D]=h[D]?this.min[D]:this.center[D],E[D]=h[D]?this.center[D]:this.max[D];return E[2]=this.max[2],new ds(v,E)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let v=!0;for(let E=0;E<o.planes.length;E++){const D=o.planes[E];let R=0;for(let B=0;B<h.length;B++)R+=g.dot$1(D,h[B])>=0;if(0===R)return 0;R!==h.length&&(v=!1)}if(v)return 2;for(let E=0;E<3;E++){let D=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let B=0;B<o.points.length;B++){const z=o.points[B][E]-this.min[E];D=Math.min(D,z),R=Math.max(R,z)}if(R<0||D>this.max[E]-this.min[E])return 0}return 1}}function li(_){const{userImage:o}=_;return!!(o&&o.render&&o.render())&&(_.data.replace(new Uint8Array(o.data.buffer)),!0)}class La extends g.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:v}of this.requestors)this._notify(h,v);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,h){this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let v=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new g.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),v=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new g.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),v=!1),this._validateContent(h.content,h)||(this.fire(new g.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),v=!1),v}_validateStretch(o,h){if(!o)return!0;let v=0;for(const E of o){if(E[0]<v||E[1]<E[0]||h<E[1])return!1;v=E[1]}return!0}_validateContent(o,h){return!(o&&(4!==o.length||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let v=!0;if(!this.isLoaded())for(const E of o)this.images[E]||(v=!1);this.isLoaded()||v?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const v={};for(const E of o){this.images[E]||this.fire(new g.Event("styleimagemissing",{id:E}));const D=this.images[E];D?v[E]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:Boolean(D.userImage&&D.userImage.render)}:g.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,v)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],v=this.getImage(o);if(!v)return null;if(h&&h.position.version===v.version)return h.position;if(h)h.position.version=v.version;else{const E={w:v.data.width+2,h:v.data.height+2,x:0,y:0},D=new g.ImagePosition(E,v);this.patterns[o]={bin:E,position:D}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const D in this.patterns)o.push(this.patterns[D].bin);const{w:h,h:v}=g.potpack(o),E=this.atlasImage;E.resize({width:h||1,height:v||1});for(const D in this.patterns){const{bin:R}=this.patterns[D],B=R.x+1,z=R.y+1,G=this.images[D].data,H=G.width,Q=G.height;g.RGBAImage.copy(G,E,{x:0,y:0},{x:B,y:z},{width:H,height:Q}),g.RGBAImage.copy(G,E,{x:0,y:Q-1},{x:B,y:z-1},{width:H,height:1}),g.RGBAImage.copy(G,E,{x:0,y:0},{x:B,y:z+Q},{width:H,height:1}),g.RGBAImage.copy(G,E,{x:H-1,y:0},{x:B-1,y:z},{width:1,height:Q}),g.RGBAImage.copy(G,E,{x:0,y:0},{x:B+H,y:z},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const v=this.images[h];li(v)&&this.updateImage(h,v)}}}const au=new g.Properties({anchor:new g.DataConstantProperty(g.spec.light.anchor),position:new class{constructor(){this.specification=g.spec.light.position}possiblyEvaluate(_,o){return function([h,v,E]){const D=g.degToRad(v+90),R=g.degToRad(E);return{x:h*Math.cos(D)*Math.sin(R),y:h*Math.sin(D)*Math.sin(R),z:h*Math.cos(R),azimuthal:v,polar:E}}(_.expression.evaluate(o))}interpolate(_,o,h){return{x:g.number(_.x,o.x,h),y:g.number(_.y,o.y,h),z:g.number(_.z,o.z,h),azimuthal:g.number(_.azimuthal,o.azimuthal,h),polar:g.number(_.polar,o.polar,h)}}},color:new g.DataConstantProperty(g.spec.light.color),intensity:new g.DataConstantProperty(g.spec.light.intensity)}),jn="-transition";class ci extends g.Evented{constructor(o){super(),this._transitionable=new g.Transitionable(au),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(g.validateLight,o,h))for(const v in o){const E=o[v];g.endsWith(v,jn)?this._transitionable.setTransition(v.slice(0,-jn.length),E):this._transitionable.setValue(v,E)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,v){return(!v||!1!==v.validate)&&g.emitValidationErrors(this,o.call(g.validateStyle,g.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}const tf=new g.Properties({source:new g.DataConstantProperty(g.spec.terrain.source),exaggeration:new g.DataConstantProperty(g.spec.terrain.exaggeration)}),zs="-transition";class nc extends g.Evented{constructor(o){super(),this._transitionable=new g.Transitionable(tf),this.set(o),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(o){for(const h in o){const v=o[h];g.endsWith(h,zs)?this._transitionable.setTransition(h.slice(0,-zs.length),v):this._transitionable.setValue(h,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function Al(_,o,h,v){const E=g.smoothstep(45,65,h),[D,R]=co(_,v),B=g.length(o);let z=1-Math.min(1,Math.exp((B-D)/(R-D)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*E*_.alpha}function co(_,o){const h=.5/Math.tan(.5*o);return[_.range[0]+h,_.range[1]+h]}const rc=new g.Properties({range:new g.DataConstantProperty(g.spec.fog.range),color:new g.DataConstantProperty(g.spec.fog.color),"horizon-blend":new g.DataConstantProperty(g.spec.fog["horizon-blend"])}),As="-transition";class fn extends g.Evented{constructor(o){super(),this._transitionable=new g.Transitionable(rc),this.set(o),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h={}){if(!this._validate(g.validateFog,o,h))for(const v in o){const E=o[v];g.endsWith(v,As)?this._transitionable.setTransition(v.slice(0,-As.length),E):this._transitionable.setValue(v,E)}}getOpacity(o){const h=this.properties&&this.properties.get("color")||1;return g.smoothstep(45,65,o)*h.a}getOpacityAtLatLng(o,h){return function(v,E,D){const R=g.MercatorCoordinate.fromLngLat(E),B=D.elevation?D.elevation.getAtPointOrZero(R):0,z=[R.x,R.y,B];return g.transformMat4$1(z,z,D.mercatorFogMatrix),Al(v,z,D.pitch,D._fov)}(this.state,o,h)}getFovAdjustedRange(o){return co(this.state,o)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,v){return(!v||!1!==v.validate)&&g.emitValidationErrors(this,o.call(g.validateStyle,g.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}class Uo{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=g.uniqueId();const v=this.workerPool.acquire(this.id);for(let E=0;E<v.length;E++){const D=new Uo.Actor(v[E],h,this.id);D.name=`Worker ${E}`,this.actors.push(D)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,h,v){g.asyncAll(this.actors,(E,D)=>{E.send(o,h,D)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function kr(_,o,h){return o*(g.EXTENT/(_.tileSize*Math.pow(2,h-_.tileID.overscaledZ)))}Uo.Actor=g.Actor;class Ba{constructor(o,h,v,E){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(D=>E.pointCoordinate3D(D)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,h){let v,E;if(o instanceof g.pointGeometry||"number"==typeof o[0]){const D=g.pointGeometry.convert(o);v=[g.pointGeometry.convert(o)],E=h.isPointAboveHorizon(D)}else{const D=g.pointGeometry.convert(o[0]),R=g.pointGeometry.convert(o[1]);v=[D,R],E=g.polygonizeBounds(D,R).every(B=>h.isPointAboveHorizon(B))}return new Ba(v,h.getCameraPoint(),E,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return g.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new g.pointGeometry(1,1)):this.screenBounds[1],E=g.polygonizeBounds(h,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<v.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?E[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(E[3]=this.cameraPoint)),g.bufferConvexPolygon(E,o)}containsTile(o,h,v){const E=o.queryPadding+1,D=v?this._bufferedCameraMercator(E,h).map(te=>o.tileID.getTilePoint(te)):this._bufferedScreenMercator(E,h).map(te=>o.tileID.getTilePoint(te)),R=this.screenGeometryMercator.map(te=>o.tileID.getTileVec3(te)),B=R.map(te=>new g.pointGeometry(te[0],te[1])),z=h.getFreeCameraOptions().position||new g.MercatorCoordinate(0,0,0),G=o.tileID.getTileVec3(z),H=R.map(te=>{const le=g.sub(te,te,G);return g.normalize(le,le),new su(G,le)}),Q=kr(o,1,h.zoom);if(g.polygonIntersectsBox(D,0,0,g.EXTENT,g.EXTENT))return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:H,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(J=g.getBounds(D),J.min.x=g.clamp(J.min.x,0,g.EXTENT),J.min.y=g.clamp(J.min.y,0,g.EXTENT),J.max.x=g.clamp(J.max.x,0,g.EXTENT),J.max.y=g.clamp(J.max.y,0,g.EXTENT),J),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Q};var J}_bufferedScreenMercator(o,h){const v=Lr(o);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{const E=this.bufferedScreenGeometry(o).map(D=>h.pointCoordinate3D(D));return this._screenRaycastCache[v]=E,E}}_bufferedCameraMercator(o,h){const v=Lr(o);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{const E=this.bufferedCameraGeometry(o).map(D=>h.pointCoordinate3D(D));return this._cameraRaycastCache[v]=E,E}}}function Lr(_){return 100*_|0}function fs(_,o,h){const v=function(E,D){if(E)return h(E);if(D){const R=g.pick(g.extend(D,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(R.vectorLayers=D.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=o.canonicalizeTileset(R,_.url),h(null,R)}};return _.url?g.getJSON(o.transformRequest(o.normalizeSourceURL(_.url),g.ResourceType.Source),v):g.exported.frame(()=>v(null,_))}class Na{constructor(o,h,v){this.bounds=g.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=v||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),v=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),E=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),D=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),R=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=v&&o.x<D&&o.y>=E&&o.y<R}}class fl{constructor(o,h,v){this.context=o;const E=o.gl;this.buffer=E.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const za={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Va{constructor(o,h,v,E){this.length=h.length,this.attributes=v,this.itemSize=h.bytesPerElement,this.dynamicDraw=E,this.context=o;const D=o.gl;this.buffer=D.createBuffer(),o.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let v=0;v<this.attributes.length;v++){const E=h.attributes[this.attributes[v].name];void 0!==E&&o.enableVertexAttribArray(E)}}setVertexAttribPointers(o,h,v){for(let E=0;E<this.attributes.length;E++){const D=this.attributes[E],R=h.attributes[D.name];void 0!==R&&o.vertexAttribPointer(R,D.components,o[za[D.type]],!1,this.itemSize,D.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ln{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pl extends Ln{getDefault(){return g.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ml extends Ln{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class lu extends Ln{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class cu extends Ln{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class uo extends Ln{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ha extends Ln{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Qn extends Ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Vs extends Ln{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ua extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Pr extends Ln{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class da extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class vd extends Ln{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Us extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class uu extends Ln{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Aa extends Ln{getDefault(){return g.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class mr extends Ln{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class ja extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class hu extends Ln{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ps extends Ln{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class jo extends Ln{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class vo extends Ln{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class du extends Ln{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class gl extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class fh extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class ic extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class oc extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ph extends Ln{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class xd extends Ln{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class sc extends Ln{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ac extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class $o extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class $a extends Ln{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class mh extends $a{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Au extends $a{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Pn extends Au{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class fa{constructor(o,h,v,E){this.context=o,this.width=h,this.height=v;const D=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new mh(o,D),E&&(this.depthAttachment=new Au(o,D))}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const v=this.depthAttachment.get();v&&o.deleteRenderbuffer(v)}o.deleteFramebuffer(this.framebuffer)}}class sn{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new pl(this),this.clearDepth=new ml(this),this.clearStencil=new lu(this),this.colorMask=new cu(this),this.depthMask=new uo(this),this.stencilMask=new ha(this),this.stencilFunc=new Qn(this),this.stencilOp=new Vs(this),this.stencilTest=new Ua(this),this.depthRange=new Pr(this),this.depthTest=new da(this),this.depthFunc=new vd(this),this.blend=new Us(this),this.blendFunc=new uu(this),this.blendColor=new Aa(this),this.blendEquation=new mr(this),this.cullFace=new ja(this),this.cullFaceSide=new hu(this),this.frontFace=new ps(this),this.program=new jo(this),this.activeTexture=new vo(this),this.viewport=new du(this),this.bindFramebuffer=new gl(this),this.bindRenderbuffer=new fh(this),this.bindTexture=new ic(this),this.bindVertexBuffer=new oc(this),this.bindElementBuffer=new ph(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new xd(this),this.pixelStoreUnpack=new sc(this),this.pixelStoreUnpackPremultiplyAlpha=new ac(this),this.pixelStoreUnpackFlipY=new $o(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new fl(this,o,h)}createVertexBuffer(o,h,v){return new Va(this,o,h,v)}createRenderbuffer(o,h,v){const E=this.gl,D=E.createRenderbuffer();return this.bindRenderbuffer.set(D),E.renderbufferStorage(E.RENDERBUFFER,o,h,v),this.bindRenderbuffer.set(null),D}createFramebuffer(o,h,v){return new fa(this,o,h,v)}clear({color:o,depth:h,stencil:v}){const E=this.gl;let D=0;o&&(D|=E.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(D|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==v&&(D|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),E.clear(D)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){ct(o.blendFunction,g.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class pa extends g.Evented{constructor(o,h,v,E){super(),this.id=o,this.dispatcher=v,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},h),g.extend(this,g.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fs(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new g.ErrorEvent(o)):h&&(g.extend(this,h),h.bounds&&(this.tileBounds=new Na(h.bounds,this.minzoom,this.maxzoom)),g.postTurnstileEvent(h.tiles),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const v=g.exported.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);o.request=g.getImage(this.map._requestManager.transformRequest(E,g.ResourceType.Tile),(D,R,B,z)=>{if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(D)o.state="errored",h(D);else if(R){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:B,expires:z});const G=this.map.painter.context,H=G.gl;o.texture=this.map.painter.getTileTexture(R.width),o.texture?o.texture.update(R,{useMipmap:!0}):(o.texture=new g.Texture(G,R,H.RGBA,{useMipmap:!0}),o.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),o.state="loaded",g.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let lc;var $n=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ne extends g.Evented{constructor(o,h,v,E){super(),this.id=o,this.dispatcher=v,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h}load(o,h){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),(v,E)=>{this._loaded=!0,v?this.fire(new g.ErrorEvent(v)):E&&(this.image=g.exported.getImageData(E),o&&(this.coordinates=o),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const h=o.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(E){let D=1/0,R=1/0,B=-1/0,z=-1/0;for(const J of E)D=Math.min(D,J.x),R=Math.min(R,J.y),B=Math.max(B,J.x),z=Math.max(z,J.y);const G=Math.max(B-D,z-R),H=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),Q=Math.pow(2,H);return new g.CanonicalTileID(H,Math.floor((D+B)/2*Q),Math.floor((R+z)/2*Q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const v=h.map(E=>this.tileID.getTilePoint(E)._round());return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(v[0].x,v[0].y,0,0),this._boundsArray.emplaceBack(v[1].x,v[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(v[3].x,v[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(v[2].x,v[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const v in this.tiles){const E=this.tiles[v];"loaded"!==E.state&&(E.state="loaded",E.texture=this.texture)}}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Z={vector:class extends g.Evented{constructor(_,o,h,v){if(super(),this.id=_,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(o,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new g.DedupedRequest}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=fs(this._options,this.map._requestManager,(_,o)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new g.ErrorEvent(_)):o&&(g.extend(this,o),o.bounds&&(this.tileBounds=new Na(o.bounds,this.minzoom,this.maxzoom)),g.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}onAdd(_){this.map=_,this.load()}setSourceProperty(_){this._tileJSONRequest&&this._tileJSONRequest.cancel(),_();const o=this.map.style._getSourceCaches(this.id);for(const h of o)h.clearTiles();this.load()}setTiles(_){return this.setSourceProperty(()=>{this._options.tiles=_}),this}setUrl(_){return this.setSourceProperty(()=>{this.url=_,this._options.url=_}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}loadTile(_,o){const h=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(h,g.ResourceType.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:_.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,_.actor&&"expired"!==_.state)"loading"===_.state?_.reloadCallback=o:_.request=_.actor.send("reloadTile",v,E.bind(this));else if(_.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)_.request=_.actor.send("loadTile",v,E.bind(this),void 0,!0);else{const D=g.loadVectorTile.call({deduped:this._deduped},v,(R,B)=>{R||!B?E.call(this,R):(v.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},_.actor&&_.actor.send("loadTile",v,E.bind(this),void 0,!0))},!0);_.request={cancel:D}}function E(D,R){return delete _.request,_.aborted?o(null):D&&404!==D.status?o(D):(R&&R.resourceTiming&&(_.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&_.setExpiryData(R),_.loadVectorData(R,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id})}unloadTile(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:pa,"raster-dem":class extends pa{constructor(_,o,h,v){super(_,o,h,v),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(_,o){const h=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(E,D){E&&(_.state="errored",o(E)),D&&(_.dem=D,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",o(null))}_.request=g.getImage(this.map._requestManager.transformRequest(h,g.ResourceType.Tile),function(E,D,R,B){if(delete _.request,_.aborted)_.state="unloaded",o(null);else if(E)_.state="errored",o(E);else if(D){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:R,expires:B});const z=g.window.ImageBitmap&&D instanceof g.window.ImageBitmap&&(null==lc&&(lc=g.window.OffscreenCanvas&&new g.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof g.window.createImageBitmap),lc),G=1-(D.width-g.prevPowerOfTwo(D.width))/2;G<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const H=z?D:g.exported.getImageData(D,G),Q={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:H,encoding:this.encoding,padding:G};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",Q,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const o=_.canonical,h=Math.pow(2,o.z),v=(o.x-1+h)%h,E=0===o.x?_.wrap-1:_.wrap,D=(o.x+1+h)%h,R=o.x+1===h?_.wrap+1:_.wrap,B={};return B[new g.OverscaledTileID(_.overscaledZ,E,o.z,v,o.y).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,R,o.z,D,o.y).key]={backfilled:!1},o.y>0&&(B[new g.OverscaledTileID(_.overscaledZ,E,o.z,v,o.y-1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,_.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,R,o.z,D,o.y-1).key]={backfilled:!1}),o.y+1<h&&(B[new g.OverscaledTileID(_.overscaledZ,E,o.z,v,o.y+1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,_.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,R,o.z,D,o.y+1).key]={backfilled:!1}),B}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends g.Evented{constructor(_,o,h,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(v),this._data=o.data,this._options=g.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const E=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*E,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*E,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:g.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*E,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},o),this}getClusterChildren(_,o){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},o),this}getClusterLeaves(_,o,h,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:o,offset:h},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new g.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=g.extend({},this.workerOptions),o=this._data;"string"==typeof o?(_.request=this.map._requestManager.transformRequest(g.exported.resolveURL(o),g.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(h,v)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new g.ErrorEvent(h));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(E.resourceTiming=v.resourceTiming[this.id]),this.fire(new g.Event("data",E)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,o){const h=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(h,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,E)=>(delete _.request,_.unloadVectorData(),_.aborted?o(null):v?o(v):(_.loadVectorData(E,this.map.painter,"reloadTile"===h),o(null))),void 0,"loadTile"===h)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return g.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ne{constructor(_,o,h,v){super(_,o,h,v),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const o of _.urls)this.urls.push(this.map._requestManager.transformRequest(o,g.ResourceType.Source).url);g.getVideo(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new g.ErrorEvent(o)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const o=this.video.seekable;_<o.start(0)||_>o.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,o=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(_,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));for(const h in this.tiles){const v=this.tiles[h];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ne,canvas:class extends ne{constructor(_,o,h,v){super(_,o,h,v),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(E=>!Array.isArray(E)||2!==E.length||E.some(D=>"number"!=typeof D))||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(o,this.canvas,h.RGBA,{premultiply:!0});for(const v in this.tiles){const E=this.tiles[v];"loaded"!==E.state&&(E.state="loaded",E.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}}},Y=function(_,o,h,v){const E=new Z[o.type](_,o,h,v);if(E.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${E.id}`);return g.bindAll(["load","abort","unload","serialize","prepare"],E),E};function ae(_,o){const h=g.identity([]);return g.scale$1(h,h,[.5*_.width,.5*-_.height,1]),g.translate(h,h,[1,-1,0]),g.multiply(h,h,_.calculateProjMatrix(o.toUnwrapped()))}function he(_,o,h,v,E,D,R,B=!1){const z=_.tilesIn(v,R,B);z.sort(we);const G=[];for(const Q of z)G.push({wrappedTileID:Q.tile.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(o,h,_._state,Q,E,D,ae(_.transform,Q.tile.tileID),B)});const H=function(Q){const J={},te={};for(const le of Q){const ce=le.queryResults,_e=le.wrappedTileID,se=te[_e]=te[_e]||{};for(const ue in ce){const ge=ce[ue],ve=se[ue]=se[ue]||{},Se=J[ue]=J[ue]||[];for(const de of ge)ve[de.featureIndex]||(ve[de.featureIndex]=!0,Se.push(de))}}return J}(G);for(const Q in H)H[Q].forEach(J=>{const te=J.feature,le=_.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=le});return H}function be(_,o){const h=_.getRenderableIds().map(D=>_.getTileByID(D)),v=[],E={};for(let D=0;D<h.length;D++){const R=h[D],B=R.tileID.canonical.key;E[B]||(E[B]=!0,R.querySourceFeatures(v,o))}return v}function we(_,o){const h=_.tileID,v=o.tileID;return h.overscaledZ-v.overscaledZ||h.canonical.y-v.canonical.y||h.wrap-v.wrap||h.canonical.x-v.canonical.x}function ke(){return null!=Sc.workerClass?new Sc.workerClass:new g.window.Worker(Sc.workerUrl)}const Ee="mapboxgl_preloaded_worker_pool";class Oe{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Oe.workerCount;)this.workers.push(new ke);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ee]}numActive(){return Object.keys(this.active).length}}let Ye;function ft(){return Ye||(Ye=new Oe),Ye}function Xe(_,o){const h={};for(const v in _)"ref"!==v&&(h[v]=_[v]);return g.refProperties.forEach(v=>{v in o&&(h[v]=o[v])}),h}function jt(_){_=_.slice();const o=Object.create(null);for(let h=0;h<_.length;h++)o[_[h].id]=_[h];for(let h=0;h<_.length;h++)"ref"in _[h]&&(_[h]=Xe(_[h],o[_[h].ref]));return _}Oe.workerCount=2;const Ce={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ge(_,o,h){h.push({command:Ce.addSource,args:[_,o[_]]})}function $t(_,o,h){o.push({command:Ce.removeSource,args:[_]}),h[_]=!0}function pn(_,o,h,v){$t(_,h,v),Ge(_,o,h)}function tn(_,o,h){let v;for(v in _[h])if(_[h].hasOwnProperty(v)&&"data"!==v&&!ct(_[h][v],o[h][v]))return!1;for(v in o[h])if(o[h].hasOwnProperty(v)&&"data"!==v&&!ct(_[h][v],o[h][v]))return!1;return!0}function Yn(_,o,h,v,E,D){let R;for(R in o=o||{},_=_||{})_.hasOwnProperty(R)&&(ct(_[R],o[R])||h.push({command:D,args:[v,R,o[R],E]}));for(R in o)o.hasOwnProperty(R)&&!_.hasOwnProperty(R)&&(ct(_[R],o[R])||h.push({command:D,args:[v,R,o[R],E]}))}function Bn(_){return _.id}function gr(_,o){return _[o.id]=o,_}class Ga{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=g.clamp(o,0,1);let h=1,v=this._distances[h];const E=o*this.paddedLength+this.padding;for(;v<E&&h<this._distances.length;)v=this._distances[++h];const D=h-1,R=this._distances[D],B=v-R,z=B>0?(E-R)/B:0;return this.points[D].mult(1-z).add(this.points[h].mult(z))}}class vt{constructor(o,h,v){const E=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(o/v),this.yCellCount=Math.ceil(h/v);for(let R=0;R<this.xCellCount*this.yCellCount;R++)E.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,v,E,D){this._forEachCell(h,v,E,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(E),this.bboxes.push(D)}insertCircle(o,h,v,E){this._forEachCell(h-E,v-E,h+E,v+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(v),this.circles.push(E)}_insertBoxCell(o,h,v,E,D,R){this.boxCells[D].push(R)}_insertCircleCell(o,h,v,E,D,R){this.circleCells[D].push(R)}_query(o,h,v,E,D,R){if(v<0||o>this.width||E<0||h>this.height)return!D&&[];const B=[];if(o<=0&&h<=0&&this.width<=v&&this.height<=E){if(D)return!0;for(let z=0;z<this.boxKeys.length;z++)B.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const G=this.circles[3*z],H=this.circles[3*z+1],Q=this.circles[3*z+2];B.push({key:this.circleKeys[z],x1:G-Q,y1:H-Q,x2:G+Q,y2:H+Q})}return R?B.filter(R):B}return this._forEachCell(o,h,v,E,this._queryCell,B,{hitTest:D,seenUids:{box:{},circle:{}}},R),D?B.length>0:B}_queryCircle(o,h,v,E,D){const R=o-v,B=o+v,z=h-v,G=h+v;if(B<0||R>this.width||G<0||z>this.height)return!E&&[];const H=[];return this._forEachCell(R,z,B,G,this._queryCellCircle,H,{hitTest:E,circle:{x:o,y:h,radius:v},seenUids:{box:{},circle:{}}},D),E?H.length>0:H}query(o,h,v,E,D){return this._query(o,h,v,E,!1,D)}hitTest(o,h,v,E,D){return this._query(o,h,v,E,!0,D)}hitTestCircle(o,h,v,E){return this._queryCircle(o,h,v,!0,E)}_queryCell(o,h,v,E,D,R,B,z){const G=B.seenUids,H=this.boxCells[D];if(null!==H){const J=this.bboxes;for(const te of H)if(!G.box[te]){G.box[te]=!0;const le=4*te;if(o<=J[le+2]&&h<=J[le+3]&&v>=J[le+0]&&E>=J[le+1]&&(!z||z(this.boxKeys[te]))){if(B.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[te],x1:J[le],y1:J[le+1],x2:J[le+2],y2:J[le+3]})}}}const Q=this.circleCells[D];if(null!==Q){const J=this.circles;for(const te of Q)if(!G.circle[te]){G.circle[te]=!0;const le=3*te;if(this._circleAndRectCollide(J[le],J[le+1],J[le+2],o,h,v,E)&&(!z||z(this.circleKeys[te]))){if(B.hitTest)return R.push(!0),!0;{const ce=J[le],_e=J[le+1],se=J[le+2];R.push({key:this.circleKeys[te],x1:ce-se,y1:_e-se,x2:ce+se,y2:_e+se})}}}}}_queryCellCircle(o,h,v,E,D,R,B,z){const G=B.circle,H=B.seenUids,Q=this.boxCells[D];if(null!==Q){const te=this.bboxes;for(const le of Q)if(!H.box[le]){H.box[le]=!0;const ce=4*le;if(this._circleAndRectCollide(G.x,G.y,G.radius,te[ce+0],te[ce+1],te[ce+2],te[ce+3])&&(!z||z(this.boxKeys[le])))return R.push(!0),!0}}const J=this.circleCells[D];if(null!==J){const te=this.circles;for(const le of J)if(!H.circle[le]){H.circle[le]=!0;const ce=3*le;if(this._circlesCollide(te[ce],te[ce+1],te[ce+2],G.x,G.y,G.radius)&&(!z||z(this.circleKeys[le])))return R.push(!0),!0}}}_forEachCell(o,h,v,E,D,R,B,z){const G=this._convertToXCellCoord(o),H=this._convertToYCellCoord(h),Q=this._convertToXCellCoord(v),J=this._convertToYCellCoord(E);for(let te=G;te<=Q;te++)for(let le=H;le<=J;le++)if(D.call(this,o,h,v,E,this.xCellCount*le+te,R,B,z))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,v,E,D,R){const B=E-o,z=D-h,G=v+R;return G*G>B*B+z*z}_circleAndRectCollide(o,h,v,E,D,R,B){const z=(R-E)/2,G=Math.abs(o-(E+z));if(G>z+v)return!1;const H=(B-D)/2,Q=Math.abs(h-(D+H));if(Q>H+v)return!1;if(G<=z||Q<=H)return!0;const J=G-z,te=Q-H;return J*J+te*te<=v*v}}const yn=Math.tan(85*Math.PI/180);function Ht(_,o,h,v,E){const D=g.create$1();return o?(g.scale$1(D,D,[1/E,1/E,1]),h||g.rotateZ(D,D,v.angle)):g.multiply(D,v.labelPlaneMatrix,_),D}function Gn(_,o,h,v,E){if(o){const D=g.clone$1(_);return g.scale$1(D,D,[E,E,1]),h||g.rotateZ(D,D,-v.angle),D}return v.glCoordMatrix}function Gi(_,o,h=0){const v=[_.x,_.y,h,1];h?g.transformMat4(v,v,o):pu(v,v,o);const E=v[3];return{point:new g.pointGeometry(v[0]/E,v[1]/E),signedDistanceFromCamera:E}}function vn(_,o){return Math.min(.5+_/o*.5,1.5)}function bd(_,o){const h=_[0]/_[3],v=_[1]/_[3];return h>=-o[0]&&h<=o[0]&&v>=-o[1]&&v<=o[1]}function qt(_,o,h,v,E,D,R,B,z){const G=v?_.textSizeData:_.iconSizeData,H=g.evaluateSizeForZoom(G,h.transform.zoom),Q=[256/h.width*2+1,256/h.height*2+1],J=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;J.clear();const te=_.lineVertexArray,le=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,ce=h.transform.width/h.transform.height;let _e=!1;for(let se=0;se<le.length;se++){const ue=le.get(se);if(ue.writingMode!==g.WritingMode.vertical||_e||0!==se&&le.get(se-1).writingMode===g.WritingMode.horizontal||(_e=!0),ue.hidden||ue.writingMode===g.WritingMode.vertical&&!_e){Go(ue.numGlyphs,J);continue}_e=!1;const ge=new g.pointGeometry(ue.tileAnchorX,ue.tileAnchorY),ve=z?z(ge):0,Se=[ge.x,ge.y,ve],de=[...Se,1];if(g.transformMat4(de,de,o),!bd(de,Q)){Go(ue.numGlyphs,J);continue}const Fe=vn(h.transform.cameraToCenterDistance,de[3]),We=g.evaluateSizeForFeature(G,H,ue),tt=R?We/Fe:We*Fe,Pe=Gi(new g.pointGeometry(Se[0],Se[1]),E,Se[2]);if(Pe.signedDistanceFromCamera<=0){Go(ue.numGlyphs,J);continue}let $e={};const xt=R?null:z,Dt=Kn(ue,tt,!1,B,o,E,D,_.glyphOffsetArray,te,J,Pe.point,ge,$e,ce,xt);_e=Dt.useVertical,xt&&Dt.needsFlipping&&($e={}),(Dt.notEnoughRoom||_e||Dt.needsFlipping&&Kn(ue,tt,!0,B,o,E,D,_.glyphOffsetArray,te,J,Pe.point,ge,$e,ce,xt).notEnoughRoom)&&Go(ue.numGlyphs,J)}v?_.text.dynamicLayoutVertexBuffer.updateData(J):_.icon.dynamicLayoutVertexBuffer.updateData(J)}function fu(_,o,h,v,E,D,R,B,z,G,H,Q,J){const te=B.glyphStartIndex+B.numGlyphs,le=B.lineStartIndex,ce=B.lineStartIndex+B.lineLength,_e=o.getoffsetX(B.glyphStartIndex),se=o.getoffsetX(te-1),ue=uc(_*_e,h,v,E,D,R,B.segment,le,ce,z,G,H,Q,J,!0);if(!ue)return null;const ge=uc(_*se,h,v,E,D,R,B.segment,le,ce,z,G,H,Q,J,!0);return ge?{first:ue,last:ge}:null}function _r(_,o,h,v){return _.writingMode===g.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*v?{useVertical:!0}:_.writingMode===g.WritingMode.vertical?o.y<h.y?{needsFlipping:!0}:null:0!==_.flipState&&function(E,D,R){const B=(D.x-E.x)*R;return 0===B||Math.abs((D.y-E.y)/B)>yn}(o,h,v)?1===_.flipState?{needsFlipping:!0}:null:o.x>h.x?{needsFlipping:!0}:null}function Kn(_,o,h,v,E,D,R,B,z,G,H,Q,J,te,le){const ce=o/24,_e=_.lineOffsetX*ce,se=_.lineOffsetY*ce;let ue;if(_.numGlyphs>1){const ge=_.glyphStartIndex+_.numGlyphs,ve=_.lineStartIndex,Se=_.lineStartIndex+_.lineLength,de=fu(ce,B,_e,se,h,H,Q,_,z,D,J,le,!1);if(!de)return{notEnoughRoom:!0};const Fe=Gi(de.first.point,R).point,We=Gi(de.last.point,R).point;if(v&&!h){const tt=_r(_,Fe,We,te);if(_.flipState=tt&&tt.needsFlipping?1:2,tt)return tt}ue=[de.first];for(let tt=_.glyphStartIndex+1;tt<ge-1;tt++)ue.push(uc(ce*B.getoffsetX(tt),_e,se,h,H,Q,_.segment,ve,Se,z,D,J,le,!1,!1));ue.push(de.last)}else{if(v&&!h){const ve=Gi(Q,E).point,Se=_.lineStartIndex+_.segment+1,de=new g.pointGeometry(z.getx(Se),z.gety(Se)),Fe=Gi(de,E),We=_r(_,ve,Fe.signedDistanceFromCamera>0?Fe.point:cc(Q,de,ve,1,E,void 0),te);if(_.flipState=We&&We.needsFlipping?1:2,We)return We}const ge=uc(ce*B.getoffsetX(_.glyphStartIndex),_e,se,h,H,Q,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,z,D,J,le,!1,!1);if(!ge)return{notEnoughRoom:!0};ue=[ge]}for(const ge of ue)g.addDynamicAttributes(G,ge.point,ge.angle);return{}}function wd(_,o,h){const v={x:_.x,y:_.y,z:0};if(!h)return Gi(v,o,v.z);const E=h(_);return Gi(new g.pointGeometry(v.x,v.y),o,v.z+E)}function cc(_,o,h,v,E,D){const R=wd(_.add(_.sub(o)._unit()),E,D).point,B=h.sub(R);return h.add(B._mult(v/B.mag()))}function uc(_,o,h,v,E,D,R,B,z,G,H,Q,J,te,le){const ce=v?_-o:_+o;let _e=ce>0?1:-1,se=0;v&&(_e*=-1,se=Math.PI),_e<0&&(se+=Math.PI);let ue=_e>0?B+R:B+R+1,ge=E,ve=E,Se=0,de=0;const Fe=Math.abs(ce),We=[],tt=[];let Pe=D;const $e=()=>{const bn=ue-_e;return 0===Se?D:new g.pointGeometry(G.getx(bn),G.gety(bn))},xt=()=>cc($e(),Pe,ve,Fe-Se+1,H,J);for(;Se+de<=Fe;){if(ue+=_e,ue<B||ue>=z)return null;if(ve=ge,We.push(ge),te&&tt.push(Pe||$e()),ge=Q[ue],void 0===ge){Pe=new g.pointGeometry(G.getx(ue),G.gety(ue));const bn=wd(Pe,H,J);ge=bn.signedDistanceFromCamera>0?Q[ue]=bn.point:xt()}else Pe=null;Se+=de,de=ve.dist(ge)}le&&J&&(Pe=Pe||new g.pointGeometry(G.getx(ue),G.gety(ue)),Q[ue]=ge=void 0===Q[ue]?ge:xt(),de=ve.dist(ge));const Dt=(Fe-Se)/de,Et=ge.sub(ve),ht=Et.mult(Dt)._add(ve);h&&ht._add(Et._unit()._perp()._mult(h*_e));const Mt=se+Math.atan2(ge.y-ve.y,ge.x-ve.x);return We.push(ht),te&&(Pe=Pe||new g.pointGeometry(G.getx(ue),G.gety(ue)),tt.push(function(bn,Yt,Nr){const xr=1-Nr;return new g.pointGeometry(bn.x*xr+Yt.x*Nr,bn.y*xr+Yt.y*Nr)}(tt.length>0?tt[tt.length-1]:Pe,Pe,Dt))),{point:ht,angle:Mt,path:We,tilePath:tt}}const hc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Go(_,o){for(let h=0;h<_;h++){const v=o.length;o.resize(v+4),o.float32.set(hc,3*v)}}function pu(_,o,h){const v=o[0],E=o[1];return _[0]=h[0]*v+h[4]*E+h[12],_[1]=h[1]*v+h[5]*E+h[13],_[3]=h[3]*v+h[7]*E+h[15],_}const ln=100;class Cd{constructor(o,h,v=new vt(o.width+200,o.height+200,25),E=new vt(o.width+200,o.height+200,25)){this.transform=o,this.grid=v,this.ignoredGrid=E,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ln,this.screenBottomBoundary=o.height+ln,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,v,E,D,R,B){let z=h.projectedAnchorZ;h.elevation&&(z+=h.elevation);const G=this.projectAndGetPerspectiveRatio(R,h.projectedAnchorX,h.projectedAnchorY,z,h.tileID),H=D*G.perspectiveRatio,Q=(h.x1*o+v.x-h.padding)*H+G.point.x,J=(h.y1*o+v.y-h.padding)*H+G.point.y,te=(h.x2*o+v.x+h.padding)*H+G.point.x,le=(h.y2*o+v.y+h.padding)*H+G.point.y,ce=G.perspectiveRatio<=.55||G.aboveHorizon;return!this.isInsideGrid(Q,J,te,le)||!E&&this.grid.hitTest(Q,J,te,le,B)||ce?{box:[],offscreen:!1}:{box:[Q,J,te,le],offscreen:this.isOffscreen(Q,J,te,le)}}placeCollisionCircles(o,h,v,E,D,R,B,z,G,H,Q,J,te,le){const ce=[],_e=this.transform.elevation,se=_e?xt=>_e.getAtTileOffset(le,xt.x,xt.y):xt=>0,ue=new g.pointGeometry(h.tileAnchorX,h.tileAnchorY),ge=se(ue),ve=this.projectAndGetPerspectiveRatio(R,ue.x,ue.y,ge,le),{perspectiveRatio:Se}=ve,de=(H?D/Se:D*Se)/g.ONE_EM,Fe=Gi(ue,B,ge).point,We=ve.signedDistanceFromCamera>0?fu(de,E,h.lineOffsetX*de,h.lineOffsetY*de,!1,Fe,ue,h,v,B,{},_e&&!H?se:null,H&&!!_e):null;let tt=!1,Pe=!1,$e=!0;if(We&&!ve.aboveHorizon){const xt=.5*J*Se+te,Dt=new g.pointGeometry(-100,-100),Et=new g.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ht=new Ga,Mt=We.first,bn=We.last;let Yt=[];for(let an=Mt.path.length-1;an>=1;an--)Yt.push(Mt.path[an]);for(let an=1;an<bn.path.length;an++)Yt.push(bn.path[an]);const Nr=2.5*xt;if(z){const an=Yt.map(_e?(wn,Rr)=>{const Ao=se(Rr<Mt.path.length-1?Mt.tilePath[Mt.path.length-1-Rr]:bn.tilePath[Rr-Mt.path.length+2]);return Gi(wn,z,Ao)}:wn=>Gi(wn,z));Yt=an.some(wn=>wn.signedDistanceFromCamera<=0)?[]:an.map(wn=>wn.point)}let xr=[];if(Yt.length>0){const an=Yt[0].clone(),wn=Yt[0].clone();for(let Rr=1;Rr<Yt.length;Rr++)an.x=Math.min(an.x,Yt[Rr].x),an.y=Math.min(an.y,Yt[Rr].y),wn.x=Math.max(wn.x,Yt[Rr].x),wn.y=Math.max(wn.y,Yt[Rr].y);xr=an.x>=Dt.x&&wn.x<=Et.x&&an.y>=Dt.y&&wn.y<=Et.y?[Yt]:wn.x<Dt.x||an.x>Et.x||wn.y<Dt.y||an.y>Et.y?[]:g.clipLine([Yt],Dt.x,Dt.y,Et.x,Et.y)}for(const an of xr){ht.reset(an,.25*xt);let wn=0;wn=ht.length<=.5*xt?1:Math.ceil(ht.paddedLength/Nr)+1;for(let Rr=0;Rr<wn;Rr++){const Ao=Rr/Math.max(wn-1,1),Eo=ht.lerp(Ao),Yi=Eo.x+ln,fo=Eo.y+ln;ce.push(Yi,fo,xt,0);const xs=Yi-xt,Do=fo-xt,Tn=Yi+xt,Cr=fo+xt;if($e=$e&&this.isOffscreen(xs,Do,Tn,Cr),Pe=Pe||this.isInsideGrid(xs,Do,Tn,Cr),!o&&this.grid.hitTestCircle(Yi,fo,xt,Q)&&(tt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:tt}}}}return{circles:!G&&tt||!Pe?[]:ce,offscreen:$e,collisionDetected:tt}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let v=1/0,E=1/0,D=-1/0,R=-1/0;for(const H of o){const Q=new g.pointGeometry(H.x+ln,H.y+ln);v=Math.min(v,Q.x),E=Math.min(E,Q.y),D=Math.max(D,Q.x),R=Math.max(R,Q.y),h.push(Q)}const B=this.grid.query(v,E,D,R).concat(this.ignoredGrid.query(v,E,D,R)),z={},G={};for(const H of B){const Q=H.key;if(void 0===z[Q.bucketInstanceId]&&(z[Q.bucketInstanceId]={}),z[Q.bucketInstanceId][Q.featureIndex])continue;const J=[new g.pointGeometry(H.x1,H.y1),new g.pointGeometry(H.x2,H.y1),new g.pointGeometry(H.x2,H.y2),new g.pointGeometry(H.x1,H.y2)];g.polygonIntersectsPolygon(h,J)&&(z[Q.bucketInstanceId][Q.featureIndex]=!0,void 0===G[Q.bucketInstanceId]&&(G[Q.bucketInstanceId]=[]),G[Q.bucketInstanceId].push(Q.featureIndex))}return G}insertCollisionBox(o,h,v,E,D){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:E,collisionGroupID:D},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,v,E,D){const R=h?this.ignoredGrid:this.grid,B={bucketInstanceId:v,featureIndex:E,collisionGroupID:D};for(let z=0;z<o.length;z+=4)R.insertCircle(B,o[z],o[z+1],o[z+2])}projectAndGetPerspectiveRatio(o,h,v,E,D){const R=[h,v,E||0,1];let B=!1;if(E||this.transform.pitch>0){g.transformMat4(R,R,o);let z=!1;this.fogState&&D&&(z=function(G,H,Q,J,te,le){const ce=le.calculateFogTileMatrix(te),_e=[H,Q,J];return g.transformMat4$1(_e,_e,ce),Al(G,_e,le.pitch,le._fov)}(this.fogState,h,v,E||0,D.toUnwrapped(),this.transform)>.9),B=R[2]>R[3]||z}else pu(R,R,o);return{point:new g.pointGeometry((R[0]/R[3]+1)/2*this.transform.width+ln,(-R[1]/R[3]+1)/2*this.transform.height+ln),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/R[3]*.5,1.5),signedDistanceFromCamera:R[3],aboveHorizon:B}}isOffscreen(o,h,v,E){return v<ln||o>=this.screenRightBoundary||E<ln||h>this.screenBottomBoundary}isInsideGrid(o,h,v,E){return v>=0&&o<this.gridRightBoundary&&E>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=g.identity([]);return g.translate(o,o,[-100,-100,0]),o}}class Zt{constructor(o,h,v,E){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):E&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class ui{constructor(o,h,v,E,D){this.text=new Zt(o?o.text:null,h,v,D),this.icon=new Zt(o?o.icon:null,h,E,D)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Po{constructor(o,h,v){this.text=o,this.icon=h,this.skipFade=v}}class ma{constructor(){this.invProjMatrix=g.create$1(),this.viewportMatrix=g.create$1(),this.circles=[]}}class mu{constructor(o,h,v,E,D){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=v,this.bucketIndex=E,this.tileID=D}}class pi{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:v=>v.collisionGroupID===h}}return this.collisionGroups[o]}}function Ro(_,o,h,v,E){const{horizontalAlign:D,verticalAlign:R}=g.getAnchorAlignment(_),B=-(D-.5)*o,z=-(R-.5)*h,G=g.evaluateVariableOffset(_,v);return new g.pointGeometry(B+G[0]*E,z+G[1]*E)}function hi(_,o,h,v,E){const D=new g.pointGeometry(_,o);return h&&D._rotate(v?E:-E),D}class Hi{constructor(o,h,v,E,D){this.transform=o.clone(),this.collisionIndex=new Cd(this.transform,D),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new pi(v),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,v,E){const D=v.getBucket(h),R=v.latestFeatureIndex;if(!D||!R||h.id!==D.layerIds[0])return;const B=v.collisionBoxArray,z=D.layers[0].layout,G=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),H=v.tileSize/g.EXTENT,Q=this.transform.calculateProjMatrix(v.tileID.toUnwrapped()),J="map"===z.get("text-pitch-alignment"),te="map"===z.get("text-rotation-alignment"),le=kr(v,1,this.transform.zoom),ce=Ht(Q,J,te,this.transform,le);let _e=null;if(J){const ue=Gn(Q,J,te,this.transform,le);_e=g.multiply([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[D.bucketInstanceId]=new mu(D.bucketInstanceId,R,D.sourceLayerIndex,D.index,v.tileID);const se={bucket:D,layout:z,posMatrix:Q,textLabelPlaneMatrix:ce,labelToScreenMatrix:_e,scale:G,textPixelRatio:H,holdingForFade:v.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:g.evaluateSizeForZoom(D.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(E)for(const ue of D.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:ve,symbolInstanceEnd:Se}=ue;o.push({sortKey:ge,symbolInstanceStart:ve,symbolInstanceEnd:Se,parameters:se})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:se})}attemptAnchorPlacement(o,h,v,E,D,R,B,z,G,H,Q,J,te,le,ce,_e,se,ue){const ge=[J.textOffset0,J.textOffset1],ve=Ro(o,v,E,ge,D),Se=this.collisionIndex.placeCollisionBox(D,h,hi(ve.x,ve.y,R,B,this.transform.angle),Q,z,G,H.predicate);if((!_e||0!==this.collisionIndex.placeCollisionBox(le.getSymbolInstanceIconSize(ue,this.transform.zoom,te),_e,hi(ve.x,ve.y,R,B,this.transform.angle),Q,z,G,H.predicate).box.length)&&Se.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(de=this.prevPlacement.variableOffsets[J.crossTileID].anchor),this.variableOffsets[J.crossTileID]={textOffset:ge,width:v,height:E,anchor:o,textScale:D,prevAnchor:de},this.markUsedJustification(le,o,J,ce),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ce,J),this.placedOrientations[J.crossTileID]=ce),{shift:ve,placedGlyphBoxes:Se}}}placeLayerBucketPart(o,h,v,E){const{bucket:D,layout:R,posMatrix:B,textLabelPlaneMatrix:z,labelToScreenMatrix:G,textPixelRatio:H,holdingForFade:Q,collisionBoxArray:J,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:le,collisionGroup:ce}=o.parameters,_e=R.get("text-optional"),se=R.get("icon-optional"),ue=R.get("text-allow-overlap"),ge=R.get("icon-allow-overlap"),ve="map"===R.get("text-rotation-alignment"),Se="map"===R.get("text-pitch-alignment"),de="none"!==R.get("icon-text-fit"),Fe="viewport-y"===R.get("symbol-z-order"),We=ue&&(ge||!D.hasIconData()||se),tt=ge&&(ue||!D.hasTextData()||_e);!D.collisionArrays&&J&&D.deserializeCollisionBoxes(J),v&&E&&D.updateCollisionDebugBuffers(this.transform.zoom,J);const Pe=($e,xt,Dt)=>{if(h[$e.crossTileID])return;if(Q)return void(this.placements[$e.crossTileID]=new Po(!1,!1,!1));let Et=!1,ht=!1,Mt=!0,bn=null,Yt={box:null,offscreen:null},Nr={box:null,offscreen:null},xr=null,an=null,wn=null,Rr=0,Ao=0,Eo=0;Dt.textFeatureIndex?Rr=Dt.textFeatureIndex:$e.useRuntimeCollisionCircles&&(Rr=$e.featureIndex),Dt.verticalTextFeatureIndex&&(Ao=Dt.verticalTextFeatureIndex);const Yi=Tn=>{Tn.tileID=this.retainedQueryData[D.bucketInstanceId].tileID,(this.transform.elevation||Tn.elevation)&&(Tn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[D.bucketInstanceId].tileID,Tn.tileAnchorX,Tn.tileAnchorY):0)},fo=Dt.textBox;if(fo){Yi(fo);const Tn=Nn=>{let yr=g.WritingMode.horizontal;if(D.allowVerticalPlacement&&!Nn&&this.prevPlacement){const vi=this.prevPlacement.placedOrientations[$e.crossTileID];vi&&(this.placedOrientations[$e.crossTileID]=vi,yr=vi,this.markUsedOrientation(D,yr,$e))}return yr},Cr=(Nn,yr)=>{if(D.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&Dt.verticalTextBox){for(const vi of D.writingModes)if(vi===g.WritingMode.vertical?(Yt=yr(),Nr=Yt):Yt=Nn(),Yt&&Yt.box&&Yt.box.length)break}else Yt=Nn()};if(R.get("text-variable-anchor")){let Nn=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e.crossTileID]){const rr=this.prevPlacement.variableOffsets[$e.crossTileID];Nn.indexOf(rr.anchor)>0&&(Nn=Nn.filter(oi=>oi!==rr.anchor),Nn.unshift(rr.anchor))}const yr=(rr,oi,So)=>{const Ki=D.getSymbolInstanceTextSize(te,$e,this.transform.zoom,xt),Gd=(rr.x2-rr.x1)*Ki+2*rr.padding,ff=(rr.y2-rr.y1)*Ki+2*rr.padding,Fh=de&&!ge?oi:null;Fh&&Yi(Fh);let Mc={box:[],offscreen:!1};const pf=ue?2*Nn.length:Nn.length;for(let rn=0;rn<pf;++rn){const Oh=this.attemptAnchorPlacement(Nn[rn%Nn.length],rr,Gd,ff,Ki,ve,Se,H,B,ce,rn>=Nn.length,$e,xt,D,So,Fh,te,le);if(Oh&&(Mc=Oh.placedGlyphBoxes,Mc&&Mc.box&&Mc.box.length)){Et=!0,bn=Oh.shift;break}}return Mc};Cr(()=>yr(fo,Dt.iconBox,g.WritingMode.horizontal),()=>{const rr=Dt.verticalTextBox;return rr&&Yi(rr),D.allowVerticalPlacement&&!(Yt&&Yt.box&&Yt.box.length)&&$e.numVerticalGlyphVertices>0&&rr?yr(rr,Dt.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),Yt&&(Et=Yt.box,Mt=Yt.offscreen);const vi=Tn(Yt&&Yt.box);if(!Et&&this.prevPlacement){const rr=this.prevPlacement.variableOffsets[$e.crossTileID];rr&&(this.variableOffsets[$e.crossTileID]=rr,this.markUsedJustification(D,rr.anchor,$e,vi))}}else{const Nn=(yr,vi)=>{const rr=D.getSymbolInstanceTextSize(te,$e,this.transform.zoom,xt),oi=this.collisionIndex.placeCollisionBox(rr,yr,new g.pointGeometry(0,0),ue,H,B,ce.predicate);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(D,vi,$e),this.placedOrientations[$e.crossTileID]=vi),oi};Cr(()=>Nn(fo,g.WritingMode.horizontal),()=>{const yr=Dt.verticalTextBox;return D.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&yr?(Yi(yr),Nn(yr,g.WritingMode.vertical)):{box:null,offscreen:null}}),Tn(Yt&&Yt.box&&Yt.box.length)}}if(xr=Yt,Et=xr&&xr.box&&xr.box.length>0,Mt=xr&&xr.offscreen,$e.useRuntimeCollisionCircles){const Tn=D.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex>=0?$e.centerJustifiedTextSymbolIndex:$e.verticalPlacedTextSymbolIndex),Cr=g.evaluateSizeForFeature(D.textSizeData,te,Tn),Nn=R.get("text-padding");an=this.collisionIndex.placeCollisionCircles(ue,Tn,D.lineVertexArray,D.glyphOffsetArray,Cr,B,z,G,v,Se,ce.predicate,$e.collisionCircleDiameter*Cr/g.ONE_EM,Nn,this.retainedQueryData[D.bucketInstanceId].tileID),Et=ue||an.circles.length>0&&!an.collisionDetected,Mt=Mt&&an.offscreen}if(Dt.iconFeatureIndex&&(Eo=Dt.iconFeatureIndex),Dt.iconBox){const Tn=Cr=>{Yi(Cr);const Nn=de&&bn?hi(bn.x,bn.y,ve,Se,this.transform.angle):new g.pointGeometry(0,0),yr=D.getSymbolInstanceIconSize(le,this.transform.zoom,xt);return this.collisionIndex.placeCollisionBox(yr,Cr,Nn,ge,H,B,ce.predicate)};Nr&&Nr.box&&Nr.box.length&&Dt.verticalIconBox?(wn=Tn(Dt.verticalIconBox),ht=wn.box.length>0):(wn=Tn(Dt.iconBox),ht=wn.box.length>0),Mt=Mt&&wn.offscreen}const xs=_e||0===$e.numHorizontalGlyphVertices&&0===$e.numVerticalGlyphVertices,Do=se||0===$e.numIconVertices;if(xs||Do?Do?xs||(ht=ht&&Et):Et=ht&&Et:ht=Et=ht&&Et,Et&&xr&&xr.box&&this.collisionIndex.insertCollisionBox(xr.box,R.get("text-ignore-placement"),D.bucketInstanceId,Nr&&Nr.box&&Ao?Ao:Rr,ce.ID),ht&&wn&&this.collisionIndex.insertCollisionBox(wn.box,R.get("icon-ignore-placement"),D.bucketInstanceId,Eo,ce.ID),an&&(Et&&this.collisionIndex.insertCollisionCircles(an.circles,R.get("text-ignore-placement"),D.bucketInstanceId,Rr,ce.ID),v)){const Tn=D.bucketInstanceId;let Cr=this.collisionCircleArrays[Tn];void 0===Cr&&(Cr=this.collisionCircleArrays[Tn]=new ma);for(let Nn=0;Nn<an.circles.length;Nn+=4)Cr.circles.push(an.circles[Nn+0]),Cr.circles.push(an.circles[Nn+1]),Cr.circles.push(an.circles[Nn+2]),Cr.circles.push(an.collisionDetected?1:0)}this.placements[$e.crossTileID]=new Po(Et||We,ht||tt,Mt||D.justReloaded),h[$e.crossTileID]=!0};if(Fe){const $e=D.getSortedSymbolIndexes(this.transform.angle);for(let xt=$e.length-1;xt>=0;--xt){const Dt=$e[xt];Pe(D.symbolInstances.get(Dt),Dt,D.collisionArrays[Dt])}}else for(let $e=o.symbolInstanceStart;$e<o.symbolInstanceEnd;$e++)Pe(D.symbolInstances.get($e),$e,D.collisionArrays[$e]);if(v&&D.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[D.bucketInstanceId];g.invert($e.invProjMatrix,B),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}D.justReloaded=!1}markUsedJustification(o,h,v,E){let D;D=E===g.WritingMode.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];const R=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const B of R)B>=0&&(o.text.placedSymbolArray.get(B).crossTileID=D>=0&&B!==D?0:v.crossTileID)}markUsedOrientation(o,h,v){const E=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,D=h===g.WritingMode.vertical?h:0,R=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const B of R)o.text.placedSymbolArray.get(B).placedOrientation=E;v.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=D)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let v=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const E=h?h.symbolFadeChange(o):1,D=h?h.opacities:{},R=h?h.variableOffsets:{},B=h?h.placedOrientations:{};for(const z in this.placements){const G=this.placements[z],H=D[z];H?(this.opacities[z]=new ui(H,E,G.text,G.icon),v=v||G.text!==H.text.placed||G.icon!==H.icon.placed):(this.opacities[z]=new ui(null,E,G.text,G.icon,G.skipFade),v=v||G.text||G.icon)}for(const z in D){const G=D[z];if(!this.opacities[z]){const H=new ui(G,E,!1,!1);H.isHidden()||(this.opacities[z]=H,v=v||G.text.placed||G.icon.placed)}}for(const z in R)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=R[z]);for(const z in B)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=B[z]);v?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const v={};for(const E of h){const D=E.getBucket(o);D&&E.latestFeatureIndex&&o.id===D.layerIds[0]&&this.updateBucketOpacities(D,v,E.collisionBoxArray)}}updateBucketOpacities(o,h,v){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const E=o.layers[0].layout,D=new ui(null,0,!1,!1,!0),R=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),z=E.get("text-variable-anchor"),G="map"===E.get("text-rotation-alignment"),H="map"===E.get("text-pitch-alignment"),Q="none"!==E.get("icon-text-fit"),J=new ui(null,0,R&&(B||!o.hasIconData()||E.get("icon-optional")),B&&(R||!o.hasTextData()||E.get("text-optional")),!0);!o.collisionArrays&&v&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(v);const te=(le,ce,_e)=>{for(let se=0;se<ce/4;se++)le.opacityVertexArray.emplaceBack(_e)};for(let le=0;le<o.symbolInstances.length;le++){const ce=o.symbolInstances.get(le),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:se,crossTileID:ue}=ce;let ge=this.opacities[ue];h[ue]?ge=D:ge||(ge=J,this.opacities[ue]=ge),h[ue]=!0;const ve=ce.numIconVertices>0,Se=this.placedOrientations[ce.crossTileID],de=Se===g.WritingMode.vertical,Fe=Se===g.WritingMode.horizontal||Se===g.WritingMode.horizontalOnly;if(_e>0||se>0){const We=Ho(ge.text);te(o.text,_e,de?qo:We),te(o.text,se,Fe?qo:We);const tt=ge.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(xt=>{xt>=0&&(o.text.placedSymbolArray.get(xt).hidden=tt||de?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=tt||Fe?1:0);const Pe=this.variableOffsets[ce.crossTileID];Pe&&this.markUsedJustification(o,Pe.anchor,ce,Se);const $e=this.placedOrientations[ce.crossTileID];$e&&(this.markUsedJustification(o,"left",ce,$e),this.markUsedOrientation(o,$e,ce))}if(ve){const We=Ho(ge.icon);ce.placedIconSymbolIndex>=0&&(te(o.icon,ce.numIconVertices,de?qo:We),o.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=ge.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(te(o.icon,ce.numVerticalIconVertices,Fe?qo:We),o.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const We=o.collisionArrays[le];if(We){let tt=new g.pointGeometry(0,0);if(We.textBox||We.verticalTextBox){let $e=!0;if(z){const xt=this.variableOffsets[ue];xt?(tt=Ro(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textScale),G&&tt._rotate(H?this.transform.angle:-this.transform.angle)):$e=!1}We.textBox&&gu(o.textCollisionBox.collisionVertexArray,ge.text.placed,!$e||de,tt.x,tt.y),We.verticalTextBox&&gu(o.textCollisionBox.collisionVertexArray,ge.text.placed,!$e||Fe,tt.x,tt.y)}const Pe=Boolean(!Fe&&We.verticalIconBox);We.iconBox&&gu(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,Pe,Q?tt.x:0,Q?tt.y:0),We.verticalIconBox&&gu(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,!Pe,Q?tt.x:0,Q?tt.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=le.invProjMatrix,o.placementViewportMatrix=le.viewportMatrix,o.collisionCircleArray=le.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const v=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*v>o}setStale(){this.stale=!0}}function gu(_,o,h,v,E){_.emplaceBack(o?1:0,h?1:0,v||0,E||0),_.emplaceBack(o?1:0,h?1:0,v||0,E||0),_.emplaceBack(o?1:0,h?1:0,v||0,E||0),_.emplaceBack(o?1:0,h?1:0,v||0,E||0)}const Ar=Math.pow(2,25),_u=Math.pow(2,24),gh=Math.pow(2,17),Xp=Math.pow(2,16),_l=Math.pow(2,9),sr=Math.pow(2,8),Yp=Math.pow(2,1);function Ho(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const o=_.placed?1:0,h=Math.floor(127*_.opacity);return h*Ar+o*_u+h*gh+o*Xp+h*_l+o*sr+h*Yp+o}const qo=0;class Hn{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,v,E,D){const R=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(R,E,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((B,z)=>B.sortKey-z.sortKey));this._currentPartIndex<R.length;){const B=R[this._currentPartIndex];if(h.placeLayerBucketPart(B,this._seenCrossTileIDs,v,0===B.symbolInstanceStart),this._currentPartIndex++,D())return!0}return!1}}class dc{constructor(o,h,v,E,D,R,B,z){this.placement=new Hi(o,D,R,B,z),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(o,h,v){const E=g.exported.now(),D=()=>{const R=g.exported.now()-E;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=h[o[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if("symbol"===R.type&&(!R.minzoom||R.minzoom<=B)&&(!R.maxzoom||R.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Hn(R)),this._inProgressLayer.continuePlacement(v[R.source],this.placement,this._showCollisionBoxes,R,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Ac=512/g.EXTENT/2;class Ed{constructor(o,h,v){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=v;for(let E=0;E<h.length;E++){const D=h.get(E),R=D.key;this.indexedSymbolInstances[R]||(this.indexedSymbolInstances[R]=[]),this.indexedSymbolInstances[R].push({crossTileID:D.crossTileID,coord:this.getScaledCoordinates(D,o)})}}getScaledCoordinates(o,h){const v=Ac/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+o.tileAnchorX)*v),y:Math.floor((h.canonical.y*g.EXTENT+o.tileAnchorY)*v)}}findMatches(o,h,v){const E=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let D=0;D<o.length;D++){const R=o.get(D);if(R.crossTileID)continue;const B=this.indexedSymbolInstances[R.key];if(!B)continue;const z=this.getScaledCoordinates(R,h);for(const G of B)if(Math.abs(G.coord.x-z.x)<=E&&Math.abs(G.coord.y-z.y)<=E&&!v[G.crossTileID]){v[G.crossTileID]=!0,R.crossTileID=G.crossTileID;break}}}}class nf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Dd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(0!==h)for(const v in this.indexes){const E=this.indexes[v],D={};for(const R in E){const B=E[R];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+h),D[B.tileID.key]=B}this.indexes[v]=D}this.lng=o}addBucket(o,h,v){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let D=0;D<h.symbolInstances.length;D++)h.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const E=this.usedCrossTileIDs[o.overscaledZ];for(const D in this.indexes){const R=this.indexes[D];if(Number(D)>o.overscaledZ)for(const B in R){const z=R[B];z.tileID.isChildOf(o)&&z.findMatches(h.symbolInstances,o,E)}else{const B=R[o.scaledTo(Number(D)).key];B&&B.findMatches(h.symbolInstances,o,E)}}for(let D=0;D<h.symbolInstances.length;D++){const R=h.symbolInstances.get(D);R.crossTileID||(R.crossTileID=v.generate(),E[R.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ed(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const v in h.indexedSymbolInstances)for(const E of h.indexedSymbolInstances[v])delete this.usedCrossTileIDs[o][E.crossTileID]}removeStaleBuckets(o){let h=!1;for(const v in this.indexes){const E=this.indexes[v];for(const D in E)o[E[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,E[D]),delete E[D],h=!0)}return h}}class js{constructor(){this.layerIndexes={},this.crossTileIDs=new nf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,v){let E=this.layerIndexes[o.id];void 0===E&&(E=this.layerIndexes[o.id]=new Dd);let D=!1;const R={};E.handleWrapJump(v);for(const B of h){const z=B.getBucket(o);z&&o.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(B.tileID,z,this.crossTileIDs)&&(D=!0),R[z.bucketInstanceId]=!0)}return E.removeStaleBuckets(R)&&(D=!0),D}pruneUnusedLayers(o){const h={};o.forEach(v=>{h[v]=!0});for(const v in this.layerIndexes)h[v]||delete this.layerIndexes[v]}}const ga=(_,o)=>g.emitValidationErrors(_,o&&o.filter(h=>"source.canvas"!==h.identifier)),Kp=g.pick(Ce,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Ha=g.pick(Ce,["setCenter","setZoom","setBearing","setPitch"]),Jp=function(){const _={},o=g.spec.$version;for(const h in g.spec.$root){const v=g.spec.$root[h];if(v.required){let E=null;E="version"===h?o:"array"===v.type?[]:{},null!=E&&(_[h]=E)}}return _}(),_h={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Zo extends g.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new Uo(ft(),this),this.imageManager=new La,this.imageManager.setEventedParent(this),this.glyphManager=new g.GlyphManager(o._requestManager,h.localFontFamily?g.LocalGlyphMode.all:h.localIdeographFontFamily?g.LocalGlyphMode.ideographs:g.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new g.LineAtlas(256,512),this.crossTileSymbolIndex=new js,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());const v=this;this._rtlTextPluginCallback=Zo.registerForPluginStateChange(E=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(D,R)=>{if(g.triggerPluginCompletionEvent(D),R&&R.every(B=>B))for(const B in v._sourceCaches){const z=v._sourceCaches[B],G=z.getSource().type;"vector"!==G&&"geojson"!==G||z.reload()}})}),this.on("data",E=>{if("source"!==E.dataType||"metadata"!==E.sourceDataType)return;const D=this.getSource(E.sourceId);if(D&&D.vectorLayerIds)for(const R in this._layers){const B=this._layers[R];B.source===D.id&&this._validateLayer(B)}})}loadURL(o,h={}){this.fire(new g.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof h.validate?h.validate:!g.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);const E=this.map._requestManager.transformRequest(o,g.ResourceType.Style);this._request=g.getJSON(E,(D,R)=>{this._request=null,D?this.fire(new g.ErrorEvent(D)):R&&this._load(R,v)})}loadJSON(o,h={}){this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.exported.frame(()=>{this._request=null,this._load(o,!1!==h.validate)})}loadEmpty(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(Jp,!1)}_updateLayerCount(o,h){const v=h?1:-1;o.is3D()&&(this._num3DLayers+=v),"circle"===o.type&&(this._numCircleLayers+=v),"symbol"===o.type&&(this._numSymbolLayers+=v)}_load(o,h){if(h&&ga(this,g.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const E in o.sources)this.addSource(E,o.sources[E],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const v=jt(this.stylesheet.layers);this._order=v.map(E=>E.id),this._layers={},this._serializedLayers={};for(let E of v)E=g.createStyleLayer(E),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ci(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(h,v,E){let D,R,B;const z=g.exported.devicePixelRatio>1?"@2x":"";let G=g.getJSON(v.transformRequest(v.normalizeSpriteURL(h,z,".json"),g.ResourceType.SpriteJSON),(J,te)=>{G=null,B||(B=J,D=te,Q())}),H=g.getImage(v.transformRequest(v.normalizeSpriteURL(h,z,".png"),g.ResourceType.SpriteImage),(J,te)=>{H=null,B||(B=J,R=te,Q())});function Q(){if(B)E(B);else if(D&&R){const J=g.exported.getImageData(R),te={};for(const le in D){const{width:ce,height:_e,x:se,y:ue,sdf:ge,pixelRatio:ve,stretchX:Se,stretchY:de,content:Fe}=D[le],We=new g.RGBAImage({width:ce,height:_e});g.RGBAImage.copy(J,We,{x:se,y:ue},{x:0,y:0},{width:ce,height:_e}),te[le]={data:We,pixelRatio:ve,sdf:ge,stretchX:Se,stretchY:de,content:Fe}}E(null,te)}}return{cancel(){G&&(G.cancel(),G=null),H&&(H.cancel(),H=null)}}}(o,this.map._requestManager,(h,v)=>{if(this._spriteRequest=null,h)this.fire(new g.ErrorEvent(h));else if(v)for(const E in v)this.imageManager.addImage(E,v[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new g.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.getSource(o.source);if(!h)return;const v=o.sourceLayer;v&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(v))&&this.fire(new g.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const v of o){const E=this._layers[v];"custom"!==E.type&&h.push(E.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&_h[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(E.length||D.length)&&this._updateWorkerLayers(E,D);for(const R in this._updatedSources){const B=this._updatedSources[R];"reload"===B?this._reloadSource(R):"clear"===B&&this._clearSource(R)}this._updateTilesForChangedImages();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const v={};for(const E in this._sourceCaches){const D=this._sourceCaches[E];v[E]=D.used,D.used=!1}for(const E of this._order){const D=this._layers[E];if(D.recalculate(o,this._availableImages),!D.isHidden(o.zoom)){const B=this._getLayerSourceCache(D);B&&(B.used=!0)}const R=this.map.painter;if(R){const B=D.getProgramIds();if(!B)continue;const z=D.getProgramConfiguration(o.zoom);for(const G of B)R.useProgram(G,z)}}for(const E in v){const D=this._sourceCaches[E];v[E]!==D.used&&D.getSource().fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new g.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),ga(this,g.validateStyle(o)))return!1;(o=g.clone$2(o)).layers=jt(o.layers);const h=function(E,D){if(!E)return[{command:Ce.setStyle,args:[D]}];let R=[];try{if(!ct(E.version,D.version))return[{command:Ce.setStyle,args:[D]}];ct(E.center,D.center)||R.push({command:Ce.setCenter,args:[D.center]}),ct(E.zoom,D.zoom)||R.push({command:Ce.setZoom,args:[D.zoom]}),ct(E.bearing,D.bearing)||R.push({command:Ce.setBearing,args:[D.bearing]}),ct(E.pitch,D.pitch)||R.push({command:Ce.setPitch,args:[D.pitch]}),ct(E.sprite,D.sprite)||R.push({command:Ce.setSprite,args:[D.sprite]}),ct(E.glyphs,D.glyphs)||R.push({command:Ce.setGlyphs,args:[D.glyphs]}),ct(E.transition,D.transition)||R.push({command:Ce.setTransition,args:[D.transition]}),ct(E.light,D.light)||R.push({command:Ce.setLight,args:[D.light]}),ct(E.fog,D.fog)||R.push({command:Ce.setFog,args:[D.fog]});const B={},z=[];!function(Q,J,te,le){let ce;for(ce in J=J||{},Q=Q||{})Q.hasOwnProperty(ce)&&(J.hasOwnProperty(ce)||$t(ce,te,le));for(ce in J)J.hasOwnProperty(ce)&&(Q.hasOwnProperty(ce)?ct(Q[ce],J[ce])||("geojson"===Q[ce].type&&"geojson"===J[ce].type&&tn(Q,J,ce)?te.push({command:Ce.setGeoJSONSourceData,args:[ce,J[ce].data]}):pn(ce,J,te,le)):Ge(ce,J,te))}(E.sources,D.sources,z,B);const G=[];E.layers&&E.layers.forEach(Q=>{B[Q.source]?R.push({command:Ce.removeLayer,args:[Q.id]}):G.push(Q)});let H=E.terrain;H&&B[H.source]&&(R.push({command:Ce.setTerrain,args:[void 0]}),H=void 0),R=R.concat(z),ct(H,D.terrain)||R.push({command:Ce.setTerrain,args:[D.terrain]}),function(Q,J,te){J=J||[];const le=(Q=Q||[]).map(Bn),ce=J.map(Bn),_e=Q.reduce(gr,{}),se=J.reduce(gr,{}),ue=le.slice(),ge=Object.create(null);let ve,Se,de,Fe,We,tt,Pe;for(ve=0,Se=0;ve<le.length;ve++)de=le[ve],se.hasOwnProperty(de)?Se++:(te.push({command:Ce.removeLayer,args:[de]}),ue.splice(ue.indexOf(de,Se),1));for(ve=0,Se=0;ve<ce.length;ve++)de=ce[ce.length-1-ve],ue[ue.length-1-ve]!==de&&(_e.hasOwnProperty(de)?(te.push({command:Ce.removeLayer,args:[de]}),ue.splice(ue.lastIndexOf(de,ue.length-Se),1)):Se++,tt=ue[ue.length-ve],te.push({command:Ce.addLayer,args:[se[de],tt]}),ue.splice(ue.length-ve,0,de),ge[de]=!0);for(ve=0;ve<ce.length;ve++)if(de=ce[ve],Fe=_e[de],We=se[de],!ge[de]&&!ct(Fe,We))if(ct(Fe.source,We.source)&&ct(Fe["source-layer"],We["source-layer"])&&ct(Fe.type,We.type)){for(Pe in Yn(Fe.layout,We.layout,te,de,null,Ce.setLayoutProperty),Yn(Fe.paint,We.paint,te,de,null,Ce.setPaintProperty),ct(Fe.filter,We.filter)||te.push({command:Ce.setFilter,args:[de,We.filter]}),ct(Fe.minzoom,We.minzoom)&&ct(Fe.maxzoom,We.maxzoom)||te.push({command:Ce.setLayerZoomRange,args:[de,We.minzoom,We.maxzoom]}),Fe)Fe.hasOwnProperty(Pe)&&"layout"!==Pe&&"paint"!==Pe&&"filter"!==Pe&&"metadata"!==Pe&&"minzoom"!==Pe&&"maxzoom"!==Pe&&(0===Pe.indexOf("paint.")?Yn(Fe[Pe],We[Pe],te,de,Pe.slice(6),Ce.setPaintProperty):ct(Fe[Pe],We[Pe])||te.push({command:Ce.setLayerProperty,args:[de,Pe,We[Pe]]}));for(Pe in We)We.hasOwnProperty(Pe)&&!Fe.hasOwnProperty(Pe)&&"layout"!==Pe&&"paint"!==Pe&&"filter"!==Pe&&"metadata"!==Pe&&"minzoom"!==Pe&&"maxzoom"!==Pe&&(0===Pe.indexOf("paint.")?Yn(Fe[Pe],We[Pe],te,de,Pe.slice(6),Ce.setPaintProperty):ct(Fe[Pe],We[Pe])||te.push({command:Ce.setLayerProperty,args:[de,Pe,We[Pe]]}))}else te.push({command:Ce.removeLayer,args:[de]}),tt=ue[ue.lastIndexOf(de)+1],te.push({command:Ce.addLayer,args:[We,tt]})}(G,D.layers,R)}catch(B){console.warn("Unable to compute style diff:",B),R=[{command:Ce.setStyle,args:[D]}]}return R}(this.serialize(),o).filter(E=>!(E.command in Ha));if(0===h.length)return!1;const v=h.filter(E=>!(E.command in Kp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);return h.forEach(E=>{"setTransition"!==E.command&&this[E.command].apply(this,E.args)}),this.stylesheet=o,!0}addImage(o,h){if(this.getImage(o))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,v={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(g.validateStyle.source,`sources.${o}`,h,null,v))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const E=Y(o,h,this.dispatcher,this);E.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:E.serialize(),sourceId:o}));const D=R=>{const B=(R?"symbol:":"other:")+o,z=this._sourceCaches[B]=new g.SourceCache(B,E,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[o]=z,z.style=this,z.onAdd(this.map)};D(!1),"vector"!==h.type&&"geojson"!==h.type||D(!0),E.onAdd&&E.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const h=this.getSource(o);if(void 0===h)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===o)return this.fire(new g.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new g.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(o);for(const E of v)delete this._sourceCaches[E.id],delete this._updatedSources[E.id],E.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getSource(o).setData(h),this._changed=!0}getSource(o){const h=this._getSourceCache(o);return h&&h.getSource()}addLayer(o,h,v={}){this._checkLoaded();const E=o.id;if(this.getLayer(E))return void this.fire(new g.ErrorEvent(new Error(`Layer with id "${E}" already exists on this map`)));let D;if("custom"===o.type){if(ga(this,g.validateCustomStyleLayer(o)))return;D=g.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(E,o.source),o=g.clone$2(o),o=g.extend(o,{source:E})),this._validate(g.validateStyle.layer,`layers.${E}`,o,{arrayIndex:-1},v))return;D=g.createStyleLayer(o),this._validateLayer(D),D.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[D.id]=D.serialize(),this._updateLayerCount(D,!0)}const R=h?this._order.indexOf(h):this._order.length;if(h&&-1===R)return void this.fire(new g.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(R,0,E),this._layerOrderChanged=!0,this._layers[E]=D;const B=this._getLayerSourceCache(D);if(this._removedLayers[E]&&D.source&&B&&"custom"!==D.type){const z=this._removedLayers[E];delete this._removedLayers[E],z.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",B.pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const v=this._order.indexOf(o);this._order.splice(v,1);const E=h?this._order.indexOf(h):this._order.length;h&&-1===E?this.fire(new g.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(E,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const v=this._order.indexOf(o);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,v){this._checkLoaded();const E=this.getLayer(o);E?E.minzoom===h&&E.maxzoom===v||(null!=h&&(E.minzoom=h),null!=v&&(E.maxzoom=v),this._updateLayer(E)):this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,h,v={}){this._checkLoaded();const E=this.getLayer(o);if(E){if(!ct(E.filter,h))return null==h?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(g.validateStyle.filter,`layers.${E.id}.filter`,h,null,v)||(E.filter=g.clone$2(h),this._updateLayer(E)))}else this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return g.clone$2(this.getLayer(o).filter)}setLayoutProperty(o,h,v,E={}){this._checkLoaded();const D=this.getLayer(o);D?ct(D.getLayoutProperty(h),v)||(D.setLayoutProperty(h,v,E),this._updateLayer(D)):this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,h){const v=this.getLayer(o);if(v)return v.getLayoutProperty(h);this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,h,v,E={}){this._checkLoaded();const D=this.getLayer(o);D?ct(D.getPaintProperty(h),v)||(D.setPaintProperty(h,v,E)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new g.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const v=o.source,E=o.sourceLayer,D=this.getSource(v);if(void 0===D)return void this.fire(new g.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const R=D.type;if("geojson"===R&&E)return void this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===R&&!E)return void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided.")));const B=this._getSourceCaches(v);for(const z of B)z.setFeatureState(E,o.id,h)}removeFeatureState(o,h){this._checkLoaded();const v=o.source,E=this.getSource(v);if(void 0===E)return void this.fire(new g.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const D=E.type,R="vector"===D?o.sourceLayer:void 0;if("vector"===D&&!R)return void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const B=this._getSourceCaches(v);for(const z of B)z.removeFeatureState(R,o.id,h)}getFeatureState(o){this._checkLoaded();const h=o.source,v=o.sourceLayer,E=this.getSource(h);if(void 0!==E){if("vector"!==E.type||v)return void 0===o.id&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(v,o.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const h in this._sourceCaches){const v=this._sourceCaches[h].getSource();o[v.id]||(o[v.id]=v.serialize())}return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(o){this._updatedLayers[o.id]=!0;const h=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[o.source]="reload",h.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=R=>"fill-extrusion"===this._layers[R].type,v={},E=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(h(B)){v[B]=R;for(const z of o){const G=z[B];if(G)for(const H of G)E.push(H)}}}E.sort((R,B)=>B.intersectionZ-R.intersectionZ);const D=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(h(B))for(let z=E.length-1;z>=0;z--){const G=E[z].feature;if(v[G.layer.id]<R)break;D.push(G),E.pop()}else for(const z of o){const G=z[B];if(G)for(const H of G)D.push(H.feature)}}return D}queryRenderedFeatures(o,h,v){h&&h.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const z of h.layers){const G=this._layers[z];if(!G)return this.fire(new g.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];E[G.source]=!0}}const D=[];h.availableImages=this._availableImages;const R=h&&h.layers?h.layers.some(z=>{const G=this.getLayer(z);return G&&G.is3D()}):this.has3DLayers(),B=Ba.createFromScreenPoints(o,v);for(const z in this._sourceCaches){const G=this._sourceCaches[z].getSource().id;h.layers&&!E[G]||D.push(he(this._sourceCaches[z],this._layers,this._serializedLayers,B,h,v,R,!!this.map._showQueryGeometry))}return this.placement&&D.push(function(z,G,H,Q,J,te,le){const ce={},_e=te.queryRenderedSymbols(Q),se=[];for(const ue of Object.keys(_e).map(Number))se.push(le[ue]);se.sort(we);for(const ue of se){const ge=ue.featureIndex.lookupSymbolFeatures(_e[ue.bucketInstanceId],G,ue.bucketIndex,ue.sourceLayerIndex,J.filter,J.layers,J.availableImages,z);for(const ve in ge){const Se=ce[ve]=ce[ve]||[],de=ge[ve];de.sort((Fe,We)=>{const tt=ue.featureSortOrder;if(tt){const Pe=tt.indexOf(Fe.featureIndex);return tt.indexOf(We.featureIndex)-Pe}return We.featureIndex-Fe.featureIndex});for(const Fe of de)Se.push(Fe)}}for(const ue in ce)ce[ue].forEach(ge=>{const ve=ge.feature,Se=H(z[ue]).getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Se});return ce}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),B.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(o,h){h&&h.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const v=this._getSourceCaches(o);let E=[];for(const D of v)E=E.concat(be(D,h));return E}addSourceType(o,h,v){return Zo.getSourceType(o)?v(new Error(`A source type called "${o}" already exists.`)):(Zo.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const v=this.light.getLight();let E=!1;for(const R in o)if(!ct(o[R],v[R])){E=!0;break}if(!E)return;const D={now:g.exported.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(D)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(o){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof o.source){const h="terrain-dem-src";this.addSource(h,o.source),o=g.clone$2(o),o=g.extend(o,{source:h})}if(!this._validate(g.validateStyle.terrain,"terrain",o)){if(this.terrain){const h=this.terrain,v=h.get();for(const E in o)if(!ct(o[E],v[E])){h.set(o),this.stylesheet.terrain=o;const D={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(D);break}}else this._createTerrain(o);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(o){const h=this.fog=new fn(o);this.stylesheet.fog=o;const v={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,v=h.get();for(const E in o)if(!ct(o[E],v[E])){h.set(o),this.stylesheet.fog=o;const D={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(D);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(v=>this.isLayerDraped(this._layers[v])),h=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o){const h=this.terrain=new nc(o);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];"fill-extrusion"===h.type&&this._updateLayer(h)}}_validate(o,h,v,E,D={}){return(!D||!1!==D.validate)&&ga(this,o.call(g.validateStyle,g.extend({key:h,style:this.serialize(),value:v,styleSpec:g.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const h=this._getSourceCaches(o);for(const v of h)v.clearTiles()}_reloadSource(o){const h=this._getSourceCaches(o);for(const v of h)v.resume(),v.reload()}_updateSources(o){for(const h in this._sourceCaches)this._sourceCaches[h].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,v,E,D=!1){let R=!1,B=!1;const z={};for(const G of this._order){const H=this._layers[G];if("symbol"!==H.type)continue;if(!z[H.source]){const J=this._getLayerSourceCache(H);if(!J)continue;z[H.source]=J.getRenderableIds(!0).map(te=>J.getTileByID(te)).sort((te,le)=>le.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(le.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(H,z[H.source],o.center.lng);R=R||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),D=D||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new g.Event("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.exported.now(),o.zoom))&&(this.pauseablePlacement=new dc(o,this._order,D,h,v,E,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.exported.now()),B=!0),R&&this.pauseablePlacement.placement.setStale()),B||R)for(const G of this._order){const H=this._layers[G];"symbol"===H.type&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,v){this.imageManager.getImages(h.icons,v),this._updateTilesForChangedImages();const E=D=>{D&&D.setDependencies(h.tileID.key,h.type,h.icons)};E(this._otherSourceCaches[h.source]),E(this._symbolSourceCaches[h.source])}getGlyphs(o,h,v){this.glyphManager.getGlyphs(h.stacks,v)}getResource(o,h,v){return g.makeRequest(h,v)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Zo.getSourceType=function(_){return Z[_]},Zo.setSourceType=function(_,o){Z[_]=o},Zo.registerForPluginStateChange=g.registerForPluginStateChange;var yh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",qi="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let yu={},Wo={};yu=hn("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),Wo=hn("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Wt=hn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),mi=yh;var Mi={background:hn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:hn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:hn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:hn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:hn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:hn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:hn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:hn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:hn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:hn("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:hn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:hn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:hn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:hn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:hn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:hn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:hn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:hn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:hn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",qi),skyboxGradient:hn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",qi),skyboxCapture:hn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hn("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:hn("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function hn(_,o,h){const v=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,E=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,D=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),R=_.match(E),B=o.match(E),z=yh.match(E);let G=B?B.concat(R):R;h||(yu.staticUniforms&&(G=yu.staticUniforms.concat(G)),Wo.staticUniforms&&(G=Wo.staticUniforms.concat(G))),G&&(G=G.concat(z));const H={};return{fragmentSource:_=_.replace(v,(Q,J,te,le,ce)=>(H[ce]=!0,"define"===J?`\n#ifndef HAS_UNIFORM_u_${ce}\nvarying ${te} ${le} ${ce};\n#else\nuniform ${te} ${le} u_${ce};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${ce}\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`)),vertexSource:o=o.replace(v,(Q,J,te,le,ce)=>{const _e="float"===le?"vec2":"vec4",se=ce.match(/color/)?"color":_e;return H[ce]?"define"===J?`\n#ifndef HAS_UNIFORM_u_${ce}\nuniform lowp float u_${ce}_t;\nattribute ${te} ${_e} a_${ce};\nvarying ${te} ${le} ${ce};\n#else\nuniform ${te} ${le} u_${ce};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${ce} = a_${ce};\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${ce} = unpack_mix_${se}(a_${ce}, u_${ce}_t);\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`:"define"===J?`\n#ifndef HAS_UNIFORM_u_${ce}\nuniform lowp float u_${ce}_t;\nattribute ${te} ${_e} a_${ce};\n#else\nuniform ${te} ${le} u_${ce};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${te} ${le} ${ce} = a_${ce};\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${te} ${le} ${ce} = unpack_mix_${se}(a_${ce}, u_${ce}_t);\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`}),staticAttributes:D,staticUniforms:G}}class $s{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,v,E,D,R,B,z){this.context=o;let G=this.boundPaintVertexBuffers.length!==E.length;for(let H=0;!G&&H<E.length;H++)this.boundPaintVertexBuffers[H]!==E[H]&&(G=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===v&&!G&&this.boundIndexBuffer===D&&this.boundVertexOffset===R&&this.boundDynamicVertexBuffer===B&&this.boundDynamicVertexBuffer2===z?(o.bindVertexArrayOES.set(this.vao),B&&B.bind(),D&&D.dynamicDraw&&D.bind(),z&&z.bind()):this.freshBind(h,v,E,D,R,B,z)}freshBind(o,h,v,E,D,R,B){let z;const G=o.numAttributes,H=this.context,Q=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=E,this.boundVertexOffset=D,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=B;else{z=H.currentNumAttributes||0;for(let J=G;J<z;J++)Q.disableVertexAttribArray(J)}h.enableAttributes(Q,o);for(const J of v)J.enableAttributes(Q,o);R&&R.enableAttributes(Q,o),B&&B.enableAttributes(Q,o),h.bind(),h.setVertexAttribPointers(Q,o,D);for(const J of v)J.bind(),J.setVertexAttribPointers(Q,o,D);R&&(R.bind(),R.setVertexAttribPointers(Q,o,D)),E&&E.bind(),B&&(B.bind(),B.setVertexAttribPointers(Q,o,D)),H.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function xo(_,o){const h=Math.pow(2,o.canonical.z),v=o.canonical.y;return[new g.MercatorCoordinate(0,v/h).toLngLat().lat,new g.MercatorCoordinate(0,(v+1)/h).toLngLat().lat]}function vh(_,o,h,v,E,D,R){const B=_.context,z=B.gl,G=h.fbo;if(!G)return;_.prepareDrawTile(o);const H=_.useProgram("hillshade");B.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get());const Q=((J,te,le,ce)=>{const _e=le.paint.get("hillshade-shadow-color"),se=le.paint.get("hillshade-highlight-color"),ue=le.paint.get("hillshade-accent-color");let ge=le.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===le.paint.get("hillshade-illumination-anchor")&&(ge-=J.transform.angle);const ve=!J.options.moving;return{u_matrix:ce||J.transform.calculateProjMatrix(te.tileID.toUnwrapped(),ve),u_image:0,u_latrange:xo(0,te.tileID),u_light:[le.paint.get("hillshade-exaggeration"),ge],u_shadow:_e,u_highlight:se,u_accent:ue}})(_,h,v,_.terrain?o.projMatrix:null);_.prepareDrawProgram(B,H,o.toUnwrapped()),H.draw(B,z.TRIANGLES,E,D,R,g.CullFaceMode.disabled,Q,v.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function Bi(_,o,h){if(!o.needsDEMTextureUpload)return;const v=_.context,E=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||_.getTileTexture(h.stride);const D=h.getPixels();o.demTexture?o.demTexture.update(D,{premultiply:!1}):o.demTexture=new g.Texture(v,D,E.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function ut(_,o,h,v,E,D){const R=_.context,B=R.gl;if(!o.dem)return;const z=o.dem;if(R.activeTexture.set(B.TEXTURE1),Bi(_,o,z),!o.demTexture)return;o.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);const G=z.dim;R.activeTexture.set(B.TEXTURE0);let H=o.fbo;if(!H){const Q=new g.Texture(R,{width:G,height:G,data:null},B.RGBA);Q.bind(B.LINEAR,B.CLAMP_TO_EDGE),H=o.fbo=R.createFramebuffer(G,G,!0),H.colorAttachment.set(Q.texture)}R.bindFramebuffer.set(H.framebuffer),R.viewport.set([0,0,G,G]),_.useProgram("hillshadePrepare").draw(R,B.TRIANGLES,v,E,D,g.CullFaceMode.disabled,((Q,J)=>{const te=J.stride,le=g.create$1();return g.ortho(le,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(le,le,[0,-g.EXTENT,0]),{u_matrix:le,u_image:1,u_dimension:[te,te],u_zoom:Q.overscaledZ,u_unpack:J.unpackVector}})(o.tileID,z),h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),o.needsHillshadePrepare=!1}const xn=(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_image0:new g.Uniform1i(_,o.u_image0),u_skirt_height:new g.Uniform1f(_,o.u_skirt_height)}),wr=(_,o)=>({u_matrix:_,u_image0:0,u_skirt_height:o}),Zi=new class{constructor(){this.operations={}}newMorphing(_,o,h,v,E){if(_ in this.operations){const D=this.operations[_];D.to.tileID.key!==h.tileID.key&&(D.queued=h)}else this.operations[_]={startTime:v,phase:0,duration:E,from:o,to:h,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const o=this.operations[_];return{from:o.from,to:o.to,phase:o.phase}}update(_){for(const o in this.operations){const h=this.operations[o];for(h.phase=(_-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,_)){delete this.operations[o];break}}}_nextOp(_,o){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=o,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},_a={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function di(_,o){const h=1<<_.z;return!o&&(0===_.x||_.x===h-1)||0===_.y||_.y===h-1}const Gs=_=>({u_matrix:_});function qr(_,o,h,v,E){if(E>0){const D=g.exported.now(),R=(D-_.timeAdded)/E,B=o?(D-o.timeAdded)/E:-1,z=h.getSource(),G=v.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),H=!o||Math.abs(o.tileID.overscaledZ-G)>Math.abs(_.tileID.overscaledZ-G),Q=H&&_.refreshedUponExpiration?1:g.clamp(H?R:1-B,0,1);return _.refreshedUponExpiration&&R>=1&&(_.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}class vu extends g.SourceCache{constructor(o){const h=Y("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Uo(ft(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,v){if(o.freezeTileCoverage)return;this.transform=o;const E=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((D,R)=>{if(D[R.key]="",!this._tiles[R.key]){const B=new g.Tile(R,this._source.tileSize*R.overscaleFactor(),o.tileZoom);B.state="loaded",this._tiles[R.key]=B}return D},{});for(const D in this._tiles)D in E||(this.freeFBO(D),this._tiles[D].unloadVectorData(),delete this._tiles[D])}freeFBO(o){const h=this.proxyCachedFBO[o];if(void 0!==h){const v=Object.values(h);this.renderCachePool.push(...v),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ya extends g.OverscaledTileID{constructor(o,h,v){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=v}}class mn extends g.Elevation{constructor(o,h){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,E,D]=function(z){const G=new g.StructArrayLayout4i8,H=new g.StructArrayLayout3ui6,Q=131;G.reserve(17161),H.reserve(33800);const J=g.EXTENT/128,te=g.EXTENT+J/2,le=te+J;for(let _e=-J;_e<le;_e+=J)for(let se=-J;se<le;se+=J){const ue=se<0||se>te||_e<0||_e>te?24575:0,ge=g.clamp(Math.round(se),0,g.EXTENT),ve=g.clamp(Math.round(_e),0,g.EXTENT);G.emplaceBack(ge+ue,ve,ge,ve)}const ce=(_e,se)=>{const ue=se*Q+_e;H.emplaceBack(ue+1,ue,ue+Q),H.emplaceBack(ue+Q,ue+Q+1,ue+1)};for(let _e=1;_e<129;_e++)for(let se=1;se<129;se++)ce(se,_e);return[0,129].forEach(_e=>{for(let se=0;se<130;se++)ce(se,_e),ce(_e,se)}),[G,H,32768]}(),R=o.context;this.gridBuffer=R.createVertexBuffer(v,$n.members),this.gridIndexBuffer=R.createIndexBuffer(E),this.gridSegments=g.SegmentVector.simpleSegment(0,0,v.length,E.length),this.gridNoSkirtSegments=g.SegmentVector.simpleSegment(0,0,v.length,D),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vu(h.map),this.orthoMatrix=g.create$1(),g.ortho(this.orthoMatrix,0,g.EXTENT,0,g.EXTENT,0,1);const B=R.gl;this._overlapStencilMode=new g.StencilMode({func:B.GEQUAL,mask:255},0,255,B.KEEP,B.KEEP,B.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,h,v){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const E=o.terrain.properties;this.sourceCache=o._getSourceCache(E.get("source")),this._exaggeration=E.get("exaggeration");const D=()=>{this.sourceCache.used&&g.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.sourceCache.getSource().tileSize/128,B=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(h,R*B,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),h.updateElevation(!v),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&g.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=h.getIds().map(z=>{const G=h.getTileByID(z).tileID;return G.projMatrix=v.calculateProjMatrix(G.toUnwrapped()),G});(function(z,G){const H=G.transform.pointCoordinate(G.transform.getCameraPoint()),Q=new g.pointGeometry(H.x,H.y);z.sort((J,te)=>{if(te.overscaledZ-J.overscaledZ)return te.overscaledZ-J.overscaledZ;const le=new g.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ce=new g.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),_e=Q.mult(1<<J.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(le)-_e.distSqr(ce)})})(E,this.painter),this._previousZoom=v.zoom;const D=this.proxyToSource||{};this.proxyToSource={},E.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const R=this._style._sourceCaches;for(const z in R){const G=R[z];if(!G.used||(G!==this.sourceCache&&(this._findCoveringTileCache[G.id]={}),this._setupProxiedCoordsForOrtho(G,o[z],D),G.usedForTerrain))continue;const H=o[z];G.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[h.id]=E.map(z=>new ya(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(D),this.renderingToTexture=!1,this._updateTimestamp=g.exported.now();const B={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const G=this.terrainTileForTile[z.key];if(!G)continue;const H=G.tileID.key;H in B||(this._visibleDemTiles.push(G),B[H]=H)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const v=this._findTileCoveringTileID(h,this.sourceCache);v&&(this.terrainTileForTile[h.key]=v)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const v in this.terrainTileForTile){const E=this.terrainTileForTile[v],D=E.dem;!D||E.demTexture&&!E.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),Bi(this.painter,E,D))}}_prepareDemTileUniforms(o,h,v,E){if(!h||null==h.demTexture)return!1;const D=o.tileID.canonical,R=Math.pow(2,h.tileID.canonical.z-D.z),B=E||"";return v[`u_dem_tl${B}`]=[D.x*R%1,D.y*R%1],v[`u_dem_scale${B}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let o=0;const h=this._visibleDemTiles.reduce((v,E)=>{if(!E.dem)return v;const D=E.dem.tree.minimums[0];return D>0&&o++,v+D},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const v=this._getLoadedAreaMinimum(),E={width:1,height:1,data:new Uint8Array(g.DEMData.pack(v,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let D=this._emptyDEMTexture;return D?D.update(E,{premultiply:!1}):D=this._emptyDEMTexture=new g.Texture(o,E,h.RGBA,{premultiply:!1}),D}setupElevationDraw(o,h,v){const E=this.painter.context,D=E.gl,R=(B=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:g.DEMData.getUnpackVector(B),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var B;R.u_dem_size=this.sourceCache.getSource().tileSize,R.u_exaggeration=this.exaggeration();let z=null,G=null,H=1;if(v&&v.morphing&&this._useVertexMorphing){const Q=v.morphing.srcDemTile,J=v.morphing.dstDemTile;H=v.morphing.phase,Q&&J&&(this._prepareDemTileUniforms(o,Q,R,"_prev")&&(G=Q),this._prepareDemTileUniforms(o,J,R)&&(z=J))}if(G&&z?(E.activeTexture.set(D.TEXTURE2),z.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),E.activeTexture.set(D.TEXTURE4),G.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),R.u_dem_lerp=H):(z=this.terrainTileForTile[o.tileID.key],E.activeTexture.set(D.TEXTURE2),(this._prepareDemTileUniforms(o,z,R)?z.demTexture:this.emptyDEMTexture).bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST)),v&&v.useDepthForOcclusion&&(E.activeTexture.set(D.TEXTURE3),this._depthTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),R.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),v&&v.useMeterToDem&&z){const Q=(1<<z.tileID.canonical.z)*g.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=Q}v&&v.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),h.setTerrainUniformValues(E,R)}renderToBackBuffer(o){const h=this.painter,v=this.painter.context;0!==o.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(E,D,R,B,z){const G=E.context,H=G.gl;let Q,J;const te=E.options.showTerrainWireframe?2:0,le=(ge,ve)=>{if(J===ge)return;const Se=[_a[ge]];ve&&Se.push(_a[te]),Q=E.useProgram("terrainRaster",null,Se),J=ge},ce=E.colorModeForRenderPass(),_e=new g.DepthMode(H.LEQUAL,g.DepthMode.ReadWrite,E.depthRangeFor3D);Zi.update(z);const se=E.transform,ue=6*Math.pow(1.5,22-se.zoom)*D.exaggeration();(te?[!1,!0]:[!1]).forEach(ge=>{J=-1;const ve=ge?H.LINES:H.TRIANGLES,[Se,de]=ge?D.getWirefameBuffer():[D.gridIndexBuffer,D.gridSegments];for(const tt of B){const Pe=R.getTile(tt),$e=g.StencilMode.disabled,xt=D.prevTerrainTileForTile[tt.key],Dt=D.terrainTileForTile[tt.key];We=Dt,null!=(Fe=xt)&&null!=We&&Fe.hasData()&&We.hasData()&&null!=Fe.demTexture&&null!=We.demTexture&&Fe.tileID.key!==We.tileID.key&&Zi.newMorphing(tt.key,xt,Dt,z,250),G.activeTexture.set(H.TEXTURE0),Pe.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST);const Et=Zi.getMorphValuesForProxy(tt.key),ht=Et?1:0;let Mt;Et&&(Mt={morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:g.easeCubicInOut(Et.phase)}});const bn=wr(tt.projMatrix,di(tt.canonical,se.renderWorldCopies)?ue/10:ue);le(ht,ge),D.setupElevationDraw(Pe,Q,Mt),E.prepareDrawProgram(G,Q,tt.toUnwrapped()),Q.draw(G,ve,_e,$e,ce,g.CullFaceMode.backCCW,bn,"terrain_raster",D.gridBuffer,Se,de)}var Fe,We})}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const h=this.painter,v=this.painter.context,E=this.proxySourceCache,D=this.proxiedCoords[E.id],R=this._drapedRenderBatches.shift(),B=[],z=h.style.order;let G=0;for(const H of D){const Q=E.getTileByID(H.proxyTileKey),J=E.proxyCachedFBO[H.key]?E.proxyCachedFBO[H.key][o]:void 0,te=void 0!==J?E.renderCache[J]:this.pool[G++],le=void 0!==J;if(Q.texture=te.tex,le&&!te.dirty){B.push(Q.tileID);continue}let ce;v.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(v.clear({color:g.Color.transparent}),te.dirty=!1);for(let _e=R.start;_e<=R.end;++_e){const se=h.style._layers[z[_e]];if(se.isHidden(h.transform.zoom))continue;const ue=h.style._getLayerSourceCache(se),ge=ue?this.proxyToSource[H.key][ue.id]:[H];if(!ge)continue;const ve=ge;v.viewport.set([0,0,te.fb.width,te.fb.height]),ce!==(ue?ue.id:null)&&(this._setupStencil(te,ge,se,ue),ce=ue?ue.id:null),h.renderLayer(h,ue,se,ve)}this.renderedToTile?(te.dirty=!0,B.push(Q.tileID)):le||--G,5===G&&(G=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),R.end+1}postRender(){}renderCacheEfficiency(o){const h=o.order.length;if(0===h)return{efficiency:100};let v,E=0,D=0,R=!1;for(let B=0;B<h;++B){const z=o._layers[o.order[B]];this._style.isLayerDraped(z)?(R&&++E,++D):R||(R=!0,v=z.id)}return 0===D?{efficiency:100}:{efficiency:100*(1-E/D),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,h,v){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(D=>D.dem).map(D=>{const R=D.tileID,B=Math.pow(2,R.overscaledZ),{x:z,y:G}=R.canonical,H=z/B,Q=(z+1)/B,J=G/B,te=(G+1)/B;return{minx:H,miny:J,maxx:Q,maxy:te,t:D.dem.tree.raycastRoot(H,J,Q,te,o,h,v),tile:D}});E.sort((D,R)=>(null!==D.t?D.t:Number.MAX_VALUE)-(null!==R.t?R.t:Number.MAX_VALUE));for(const D of E){if(null==D.t)return null;const R=D.tile.dem.tree.raycast(D.minx,D.miny,D.maxx,D.maxy,o,h,v);if(null!=R)return R}return null}_createFBO(){const o=this.painter.context,h=o.gl,v=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const E=new g.Texture(o,{width:v[0],height:v[1],data:null},h.RGBA);E.bind(h.LINEAR,h.CLAMP_TO_EDGE);const D=o.createFramebuffer(v[0],v[1],!1);return D.colorAttachment.set(E.texture),D.depthAttachment=new Pn(o,D.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,D.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):D.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:D,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._layers[o],v=h.isHidden(this.painter.transform.zoom),E=h.getCrossfadeParameters(),D=!!E&&1!==E.t,R=h.hasTransition();return"custom"!==h.type&&!v&&(D||R)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof pa){o=!0;break}if(o)for(let h=0;h<this._style.order.length;++h){const v=this._style._layers[this._style.order[h]],E=v.isHidden(this.painter.transform.zoom),D=this._style._getLayerSourceCache(v);if("raster"!==v.type||E||!D)continue;const R=v.paint.get("raster-fade-duration");for(const B of this.proxyCoords){const z=this.proxyToSource[B.key][D.id];if(z)for(const G of z){const H=qr(D.getTile(G),D.findLoadedParent(G,0),D,this.painter.transform,R);(1!==H.opacity||0!==H.mix)&&this._clearRenderCacheForTile(D.id,G)}}}}_setupDrapedRenderBatches(){const o=this._style.order,h=o.length;if(0===h)return;const v=[];let E,D=0,R=this._style._layers[o[D]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++D<h;)R=this._style._layers[o[D]];for(;D<h;++D){const B=this._style._layers[o[D]];B.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(B)?void 0===E&&(E=D):void 0!==E&&(v.push({start:E,end:D-1}),E=void 0))}void 0!==E&&v.push({start:E,end:D-1}),this._drapedRenderBatches=v}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const R=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let B=0;B<R.length;++B){const z=Object.values(R[B]);h.renderCachePool.push(...z)}}return}this._clearRasterFadeFromRenderCache();const v=this.proxyCoords,E=this._tilesDirty;for(let R=v.length-1;R>=0;R--){const B=v[R];if(h.getTileByID(B.key),void 0!==h.proxyCachedFBO[B.key]){const z=o[B.key],G=this.proxyToSource[B.key];let H=0;for(const Q in G){const J=G[Q],te=z[Q];if(!te||te.length!==J.length||J.some((le,ce)=>le!==te[ce]||E[Q]&&E[Q].hasOwnProperty(le.key))){H=-1;break}++H}for(const Q in h.proxyCachedFBO[B.key])h.renderCache[h.proxyCachedFBO[B.key][Q]].dirty=H<0||H!==Object.values(z).length}}const D=[...this._drapedRenderBatches];D.sort((R,B)=>B.end-B.start-(R.end-R.start));for(const R of D)for(const B of v){if(h.proxyCachedFBO[B.key])continue;let z=h.renderCachePool.pop();void 0===z&&h.renderCache.length<50&&(z=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==z&&(h.proxyCachedFBO[B.key]={},h.proxyCachedFBO[B.key][R.start]=z,h.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,v,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const D=this.painter.context,R=D.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let B;if(v.isTileClipped())B=h.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);B=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+B>255&&(D.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=B,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):g.StencilMode.disabled}_renderTileClippingMasks(o,h){const v=this.painter,E=this.painter.context,D=E.gl;v._tileClippingMaskIDs={},E.setColorMode(g.ColorMode.disabled),E.setDepthMode(g.DepthMode.disabled);const R=v.useProgram("clippingMask");for(const B of o){const z=v._tileClippingMaskIDs[B.key]=--h;R.draw(E,D.TRIANGLES,g.DepthMode.disabled,new g.StencilMode({func:D.ALWAYS,mask:0},z,255,D.KEEP,D.KEEP,D.REPLACE),g.ColorMode.disabled,g.CullFaceMode.disabled,Gs(B.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const v=[o.x,o.y,1,1];g.transformMat4(v,v,h.pixelMatrixInverse),g.scale$2(v,v,1/v[3]),v[0]/=h.worldSize,v[1]/=h.worldSize;const E=h._camera.position,D=g.mercatorZfromAltitude(1,h.center.lat),R=[E[0],E[1],E[2]/D,0],B=g.subtract([],v.slice(0,3),R);g.normalize(B,B);const z=this.raycast(R,B,this._exaggeration);return null!==z&&z?(g.scaleAndAdd(R,R,B,z),R[3]=R[2],R[2]*=D,R):null}drawDepth(){const o=this.painter,h=o.context,v=this.proxySourceCache,E=Math.ceil(o.width),D=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===E&&this._depthFBO.height===D||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const R=h.gl,B=h.createFramebuffer(E,D,!0);h.activeTexture.set(R.TEXTURE0);const z=new g.Texture(h,{width:E,height:D,data:null},R.RGBA);z.bind(R.NEAREST,R.CLAMP_TO_EDGE),B.colorAttachment.set(z.texture);const G=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,E,D);B.depthAttachment.set(G),this._depthFBO=B,this._depthTexture=z}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,E,D]),function(R,B,z,G){const H=R.context,Q=H.gl;H.clear({depth:1});const J=R.useProgram("terrainDepth"),te=new g.DepthMode(Q.LESS,g.DepthMode.ReadWrite,R.depthRangeFor3D);for(const le of G){const ce=z.getTile(le),_e=wr(le.projMatrix,0);B.setupElevationDraw(ce,J),J.draw(H,Q.TRIANGLES,te,g.StencilMode.disabled,g.ColorMode.unblended,g.CullFaceMode.backCCW,_e,"terrain_depth",B.gridBuffer,B.gridIndexBuffer,B.gridNoSkirtSegments)}}(o,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,h,v){if(o.getSource()instanceof ne)return this._setupProxiedCoordsForImageSource(o,h,v);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const E=this.proxiedCoords[o.id]=[],D=this.proxyCoords;for(let B=0;B<D.length;B++){const z=D[B],G=this._findTileCoveringTileID(z,o);if(G){const H=this._createProxiedId(z,G,v[z.key]&&v[z.key][o.id]);E.push(H),this.proxyToSource[z.key][o.id]=[H]}}let R=!1;for(let B=0;B<h.length;B++){const z=o.getTile(h[B]);if(!z||!z.hasData())continue;const G=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(G&&G.tileID.canonical.z!==z.tileID.canonical.z){const H=this.proxyToSource[G.tileID.key][o.id],Q=this._createProxiedId(G.tileID,z,v[G.tileID.key]&&v[G.tileID.key][o.id]);H?H.splice(H.length-1,0,Q):this.proxyToSource[G.tileID.key][o.id]=[Q],E.push(Q),R=!0}}this._sourceTilesOverlap[o.id]=R}_setupProxiedCoordsForImageSource(o,h,v){if(!o.getSource().loaded())return;const E=this.proxiedCoords[o.id]=[],D=this.proxyCoords,R=o.getSource(),B=new g.pointGeometry(R.tileID.x,R.tileID.y)._div(1<<R.tileID.z),z=R.coordinates.map(g.MercatorCoordinate.fromLngLat).reduce((H,Q)=>(H.min.x=Math.min(H.min.x,Q.x-B.x),H.min.y=Math.min(H.min.y,Q.y-B.y),H.max.x=Math.max(H.max.x,Q.x-B.x),H.max.y=Math.max(H.max.y,Q.y-B.y),H),{min:new g.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new g.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),G=(H,Q)=>{const J=H.wrap+H.canonical.x/(1<<H.canonical.z),te=H.canonical.y/(1<<H.canonical.z),le=g.EXTENT/(1<<H.canonical.z),ce=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),_e=Q.canonical.y/(1<<Q.canonical.z);return J+le<ce+z.min.x||J>ce+z.max.x||te+le<_e+z.min.y||te>_e+z.max.y};for(let H=0;H<D.length;H++){const Q=D[H];for(let J=0;J<h.length;J++){const te=o.getTile(h[J]);if(!te||!te.hasData()||G(Q,te.tileID))continue;const le=this._createProxiedId(Q,te,v[Q.key]&&v[Q.key][o.id]),ce=this.proxyToSource[Q.key][o.id];ce?ce.push(le):this.proxyToSource[Q.key][o.id]=[le],E.push(le)}}}_createProxiedId(o,h,v){let E=this.orthoMatrix;if(v){const D=v.find(R=>R.key===h.tileID.key);if(D)return D}if(h.tileID.key!==o.key){const D=o.canonical.z-h.tileID.canonical.z;let R,B,z;E=g.create$1();const G=h.tileID.wrap-o.wrap<<o.overscaledZ;D>0?(R=g.EXTENT>>D,B=R*((h.tileID.canonical.x<<D)-o.canonical.x+G),z=R*((h.tileID.canonical.y<<D)-o.canonical.y)):(R=g.EXTENT<<-D,B=g.EXTENT*(h.tileID.canonical.x-(o.canonical.x+G<<-D)),z=g.EXTENT*(h.tileID.canonical.y-(o.canonical.y<<-D))),g.ortho(E,0,R,0,R,0,1),g.translate(E,E,[B,z,0])}return new ya(h.tileID,o.key,E)}_findTileCoveringTileID(o,h){let v=h.getTile(o);if(v&&v.hasData())return v;const E=this._findCoveringTileCache[h.id],D=E[o.key];if(v=D?h.getTileByID(D):null,v&&v.hasData()||null===D)return v;let R=v?v.tileID:o,B=R.overscaledZ;const z=h.getSource().minzoom,G=[];if(!D){const Q=h.getSource().maxzoom;if(o.canonical.z>=Q){const J=o.canonical.z-Q;h.getSource().reparseOverscaled?(B=Math.max(o.canonical.z+2,h.transform.tileZoom),R=new g.OverscaledTileID(B,o.wrap,Q,o.canonical.x>>J,o.canonical.y>>J)):0!==J&&(B=Q,R=new g.OverscaledTileID(B,o.wrap,Q,o.canonical.x>>J,o.canonical.y>>J))}R.key!==o.key&&(G.push(R.key),v=h.getTile(R))}const H=Q=>{G.forEach(J=>{E[J]=Q}),G.length=0};for(B-=1;B>=z&&(!v||!v.hasData());B--){v&&H(v.tileID.key);const Q=R.calculateScaledKey(B);if(v=h.getTileByID(Q),v&&v.hasData())break;const J=E[Q];if(null===J)break;void 0===J?G.push(Q):v=h.getTileByID(J)}return H(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let v=this._tilesDirty[o];v||(v=this._tilesDirty[o]={}),v[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(h){let v,E,D;const R=new g.StructArrayLayout2ui4,B=131;for(E=1;E<129;E++){for(v=1;v<129;v++)D=E*B+v,R.emplaceBack(D,D+1),R.emplaceBack(D,D+B),R.emplaceBack(D+1,D+B),128===E&&R.emplaceBack(D+B,D+B+1);R.emplaceBack(D+1,D+1+B)}return R}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=g.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function yl(_){const o=[];for(let h=0;h<_.length;h++){if(null===_[h])continue;const v=_[h].split(" ");o.push(v.pop())}return o}class va{static cacheKey(o,h,v){let E=`${o}${v?v.cacheKey:""}`;for(const D of h)E+=`/${D}`;return E}constructor(o,h,v,E,D,R){const B=o.gl;this.program=B.createProgram();const z=yl(v.staticAttributes),G=E?E.getBinderAttributes():[],H=z.concat(G),Q=v.staticUniforms?yl(v.staticUniforms):[],J=E?E.getBinderUniforms():[],te=Q.concat(J),le=[];for(const Se of te)le.indexOf(Se)<0&&le.push(Se);let ce=E?E.defines():[];ce=ce.concat(R.map(Se=>`#define ${Se}`));const _e=ce.concat(Wt.fragmentSource,mi,Wo.fragmentSource,v.fragmentSource).join("\n"),se=ce.concat(Wt.vertexSource,mi,Wo.vertexSource,yu.vertexSource,v.vertexSource).join("\n"),ue=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(ue,_e),B.compileShader(ue),B.attachShader(this.program,ue);const ge=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(ge,se),B.compileShader(ge),B.attachShader(this.program,ge),this.attributes={};const ve={};this.numAttributes=H.length;for(let Se=0;Se<this.numAttributes;Se++)H[Se]&&(B.bindAttribLocation(this.program,Se,H[Se]),this.attributes[H[Se]]=Se);B.linkProgram(this.program),B.deleteShader(ge),B.deleteShader(ue);for(let Se=0;Se<le.length;Se++){const de=le[Se];if(de&&!ve[de]){const Fe=B.getUniformLocation(this.program,de);Fe&&(ve[de]=Fe)}}var Se,de;this.fixedUniforms=D(o,ve),this.binderUniforms=E?E.getUniforms(o,ve):[],-1!==R.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new g.Uniform1i(Se=o,(de=ve).u_dem),u_dem_prev:new g.Uniform1i(Se,de.u_dem_prev),u_dem_unpack:new g.Uniform4f(Se,de.u_dem_unpack),u_dem_tl:new g.Uniform2f(Se,de.u_dem_tl),u_dem_scale:new g.Uniform1f(Se,de.u_dem_scale),u_dem_tl_prev:new g.Uniform2f(Se,de.u_dem_tl_prev),u_dem_scale_prev:new g.Uniform1f(Se,de.u_dem_scale_prev),u_dem_size:new g.Uniform1f(Se,de.u_dem_size),u_dem_lerp:new g.Uniform1f(Se,de.u_dem_lerp),u_exaggeration:new g.Uniform1f(Se,de.u_exaggeration),u_depth:new g.Uniform1i(Se,de.u_depth),u_depth_size_inv:new g.Uniform2f(Se,de.u_depth_size_inv),u_meter_to_dem:new g.Uniform1f(Se,de.u_meter_to_dem),u_label_plane_matrix_inv:new g.UniformMatrix4f(Se,de.u_label_plane_matrix_inv),u_tile_tl_up:new g.Uniform3f(Se,de.u_tile_tl_up),u_tile_tr_up:new g.Uniform3f(Se,de.u_tile_tr_up),u_tile_br_up:new g.Uniform3f(Se,de.u_tile_br_up),u_tile_bl_up:new g.Uniform3f(Se,de.u_tile_bl_up),u_tile_up_scale:new g.Uniform1f(Se,de.u_tile_up_scale)}),-1!==R.indexOf("FOG")&&(this.fogUniforms=((Se,de)=>({u_fog_matrix:new g.UniformMatrix4f(Se,de.u_fog_matrix),u_fog_range:new g.Uniform2f(Se,de.u_fog_range),u_fog_color:new g.Uniform4f(Se,de.u_fog_color),u_fog_horizon_blend:new g.Uniform1f(Se,de.u_fog_horizon_blend),u_fog_temporal_offset:new g.Uniform1f(Se,de.u_fog_temporal_offset)}))(o,ve))}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const E in h)v[E].set(h[E])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const E in h)v[E].location&&v[E].set(h[E])}}draw(o,h,v,E,D,R,B,z,G,H,Q,J,te,le,ce,_e){const se=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(v),o.setStencilMode(E),o.setColorMode(D),o.setCullFace(R);for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(B[ge]);le&&le.setUniforms(o,this.binderUniforms,J,{zoom:te});const ue={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[h];for(const ge of Q.get()){const ve=ge.vaos||(ge.vaos={});(ve[z]||(ve[z]=new $s)).bind(o,this,G,le?le.getPaintVertexBuffers():[],H,ge.vertexOffset,ce,_e),se.drawElements(h,ge.primitiveLength*ue,se.UNSIGNED_SHORT,ge.primitiveOffset*ue*2)}}}function xu(_,o,h){const v=1/kr(h,1,o.transform.tileZoom),E=Math.pow(2,h.tileID.overscaledZ),D=h.tileSize*Math.pow(2,o.transform.tileZoom)/E,R=D*(h.tileID.canonical.x+h.tileID.wrap*E),B=D*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[v,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[R>>16,B>>16],u_pixel_coord_lower:[65535&R,65535&B]}}const qa=(_,o,h,v)=>{const E=o.style.light,D=E.properties.get("position"),R=[D.x,D.y,D.z],B=g.create$2();"viewport"===E.properties.get("anchor")&&(g.fromRotation(B,-o.transform.angle),g.transformMat3(R,R,B));const z=E.properties.get("color");return{u_matrix:_,u_lightpos:R,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+h,u_opacity:v}},bo=(_,o,h,v,E,D,R)=>g.extend(qa(_,o,h,v),xu(D,o,R),{u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8}),Hs=_=>({u_matrix:_}),ms=(_,o,h,v)=>g.extend(Hs(_),xu(h,o,v)),Qo=(_,o)=>({u_matrix:_,u_world:o}),Rn=(_,o,h,v,E)=>g.extend(ms(_,o,h,v),{u_world:E}),Sd=(_,o,h,v)=>{const E=_.transform;let D;if("map"===v.paint.get("circle-pitch-alignment")){const R=kr(h,1,E.zoom);D=[R,R]}else D=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:_.translatePosMatrix(o.projMatrix,h,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:g.exported.devicePixelRatio,u_extrude_scale:D}},xh=_=>{const o=[];return"map"===_.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},vl=(_,o,h)=>{const v=g.EXTENT/h.tileSize;return{u_matrix:_,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/v,o.pixelsToGLUnits[1]/v]}},fc=(_,o,h=1)=>({u_matrix:_,u_color:o,u_overlay:0,u_overlay_scale:h}),xl=(_,o,h,v)=>({u_matrix:_,u_extrude_scale:kr(o,1,h),u_intensity:v}),bl=(_,o,h,v,E,D)=>{const R=_.transform,B={u_matrix:bu(_,o,h,E),u_ratio:1/kr(o,1,R.zoom),u_device_pixel_ratio:g.exported.devicePixelRatio,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:D,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Fo(h)){const z=gi(o,_.transform);B.u_texsize=o.lineAtlasTexture.size,B.u_scale=[z,v.fromScale,v.toScale],B.u_mix=v.t}return B},xa=(_,o,h,v,E)=>{const D=_.transform,R=gi(o,D);return{u_matrix:bu(_,o,h,E),u_texsize:o.imageAtlasTexture.size,u_ratio:1/kr(o,1,D.zoom),u_device_pixel_ratio:g.exported.devicePixelRatio,u_image:0,u_scale:[R,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]]}};function gi(_,o){return 1/kr(_,1,o.tileZoom)}function bu(_,o,h,v){return _.translatePosMatrix(v||o.tileID.projMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const gs=_=>{const o=[];return Fo(_)&&o.push("RENDER_LINE_DASH"),_.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT"),o};function Fo(_){const o=_.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Za=(_,o,h,v,E)=>{return{u_matrix:_,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:v.mix,u_opacity:v.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(R=E.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(D=E.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:bh(E.paint.get("raster-hue-rotate"))};var D,R};function bh(_){_*=Math.PI/180;const o=Math.sin(_),h=Math.cos(_);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const wu=(_,o,h,v,E,D,R,B,z,G)=>{const H=E.transform;return{u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:H.width/H.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:R,u_coord_matrix:B,u_is_text:+z,u_pitch_with_map:+v,u_texsize:G,u_texture:0}},Xo=(_,o,h,v,E,D,R,B,z,G,H)=>{const{cameraToCenterDistance:Q,_pitch:J}=E.transform;return g.extend(wu(_,o,h,v,E,D,R,B,z,G),{u_gamma_scale:v?Q*Math.cos(E.terrain?0:J):1,u_device_pixel_ratio:g.exported.devicePixelRatio,u_is_halo:+H})},em=(_,o,h,v,E,D,R,B,z,G)=>g.extend(Xo(_,o,h,v,E,D,R,B,!0,z,!0),{u_texsize_icon:G,u_texture_icon:1}),x0=(_,o,h)=>({u_matrix:_,u_opacity:o,u_color:h}),tm=(_,o,h,v,E,D)=>g.extend(function(R,B,z,G){const H=z.imageManager.getPattern(R.from.toString()),Q=z.imageManager.getPattern(R.to.toString()),{width:J,height:te}=z.imageManager.getPixelSize(),le=Math.pow(2,G.tileID.overscaledZ),ce=G.tileSize*Math.pow(2,z.transform.tileZoom)/le,_e=ce*(G.tileID.canonical.x+G.tileID.wrap*le),se=ce*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[J,te],u_mix:B.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/kr(G,1,z.transform.tileZoom),u_pixel_coord_upper:[_e>>16,se>>16],u_pixel_coord_lower:[65535&_e,65535&se]}}(v,D,h,E),{u_matrix:_,u_opacity:o}),Md={fillExtrusion:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_lightpos:new g.Uniform3f(_,o.u_lightpos),u_lightintensity:new g.Uniform1f(_,o.u_lightintensity),u_lightcolor:new g.Uniform3f(_,o.u_lightcolor),u_vertical_gradient:new g.Uniform1f(_,o.u_vertical_gradient),u_opacity:new g.Uniform1f(_,o.u_opacity)}),fillExtrusionPattern:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_lightpos:new g.Uniform3f(_,o.u_lightpos),u_lightintensity:new g.Uniform1f(_,o.u_lightintensity),u_lightcolor:new g.Uniform3f(_,o.u_lightcolor),u_vertical_gradient:new g.Uniform1f(_,o.u_vertical_gradient),u_height_factor:new g.Uniform1f(_,o.u_height_factor),u_image:new g.Uniform1i(_,o.u_image),u_texsize:new g.Uniform2f(_,o.u_texsize),u_pixel_coord_upper:new g.Uniform2f(_,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,o.u_pixel_coord_lower),u_scale:new g.Uniform3f(_,o.u_scale),u_fade:new g.Uniform1f(_,o.u_fade),u_opacity:new g.Uniform1f(_,o.u_opacity)}),fill:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix)}),fillPattern:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_image:new g.Uniform1i(_,o.u_image),u_texsize:new g.Uniform2f(_,o.u_texsize),u_pixel_coord_upper:new g.Uniform2f(_,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,o.u_pixel_coord_lower),u_scale:new g.Uniform3f(_,o.u_scale),u_fade:new g.Uniform1f(_,o.u_fade)}),fillOutline:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_world:new g.Uniform2f(_,o.u_world)}),fillOutlinePattern:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_world:new g.Uniform2f(_,o.u_world),u_image:new g.Uniform1i(_,o.u_image),u_texsize:new g.Uniform2f(_,o.u_texsize),u_pixel_coord_upper:new g.Uniform2f(_,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,o.u_pixel_coord_lower),u_scale:new g.Uniform3f(_,o.u_scale),u_fade:new g.Uniform1f(_,o.u_fade)}),circle:(_,o)=>({u_camera_to_center_distance:new g.Uniform1f(_,o.u_camera_to_center_distance),u_extrude_scale:new g.Uniform2f(_,o.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(_,o.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(_,o.u_matrix)}),collisionBox:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_camera_to_center_distance:new g.Uniform1f(_,o.u_camera_to_center_distance),u_extrude_scale:new g.Uniform2f(_,o.u_extrude_scale)}),collisionCircle:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_inv_matrix:new g.UniformMatrix4f(_,o.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(_,o.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(_,o.u_viewport_size)}),debug:(_,o)=>({u_color:new g.UniformColor(_,o.u_color),u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_overlay:new g.Uniform1i(_,o.u_overlay),u_overlay_scale:new g.Uniform1f(_,o.u_overlay_scale)}),clippingMask:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix)}),heatmap:(_,o)=>({u_extrude_scale:new g.Uniform1f(_,o.u_extrude_scale),u_intensity:new g.Uniform1f(_,o.u_intensity),u_matrix:new g.UniformMatrix4f(_,o.u_matrix)}),heatmapTexture:(_,o)=>({u_image:new g.Uniform1i(_,o.u_image),u_color_ramp:new g.Uniform1i(_,o.u_color_ramp),u_opacity:new g.Uniform1f(_,o.u_opacity)}),hillshade:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_image:new g.Uniform1i(_,o.u_image),u_latrange:new g.Uniform2f(_,o.u_latrange),u_light:new g.Uniform2f(_,o.u_light),u_shadow:new g.UniformColor(_,o.u_shadow),u_highlight:new g.UniformColor(_,o.u_highlight),u_accent:new g.UniformColor(_,o.u_accent)}),hillshadePrepare:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_image:new g.Uniform1i(_,o.u_image),u_dimension:new g.Uniform2f(_,o.u_dimension),u_zoom:new g.Uniform1f(_,o.u_zoom),u_unpack:new g.Uniform4f(_,o.u_unpack)}),line:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_ratio:new g.Uniform1f(_,o.u_ratio),u_device_pixel_ratio:new g.Uniform1f(_,o.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(_,o.u_units_to_pixels),u_dash_image:new g.Uniform1i(_,o.u_dash_image),u_gradient_image:new g.Uniform1i(_,o.u_gradient_image),u_image_height:new g.Uniform1f(_,o.u_image_height),u_texsize:new g.Uniform2f(_,o.u_texsize),u_scale:new g.Uniform3f(_,o.u_scale),u_mix:new g.Uniform1f(_,o.u_mix)}),linePattern:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_texsize:new g.Uniform2f(_,o.u_texsize),u_ratio:new g.Uniform1f(_,o.u_ratio),u_device_pixel_ratio:new g.Uniform1f(_,o.u_device_pixel_ratio),u_image:new g.Uniform1i(_,o.u_image),u_units_to_pixels:new g.Uniform2f(_,o.u_units_to_pixels),u_scale:new g.Uniform3f(_,o.u_scale),u_fade:new g.Uniform1f(_,o.u_fade)}),raster:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_tl_parent:new g.Uniform2f(_,o.u_tl_parent),u_scale_parent:new g.Uniform1f(_,o.u_scale_parent),u_buffer_scale:new g.Uniform1f(_,o.u_buffer_scale),u_fade_t:new g.Uniform1f(_,o.u_fade_t),u_opacity:new g.Uniform1f(_,o.u_opacity),u_image0:new g.Uniform1i(_,o.u_image0),u_image1:new g.Uniform1i(_,o.u_image1),u_brightness_low:new g.Uniform1f(_,o.u_brightness_low),u_brightness_high:new g.Uniform1f(_,o.u_brightness_high),u_saturation_factor:new g.Uniform1f(_,o.u_saturation_factor),u_contrast_factor:new g.Uniform1f(_,o.u_contrast_factor),u_spin_weights:new g.Uniform3f(_,o.u_spin_weights)}),symbolIcon:(_,o)=>({u_is_size_zoom_constant:new g.Uniform1i(_,o.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(_,o.u_is_size_feature_constant),u_size_t:new g.Uniform1f(_,o.u_size_t),u_size:new g.Uniform1f(_,o.u_size),u_camera_to_center_distance:new g.Uniform1f(_,o.u_camera_to_center_distance),u_pitch:new g.Uniform1f(_,o.u_pitch),u_rotate_symbol:new g.Uniform1i(_,o.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(_,o.u_aspect_ratio),u_fade_change:new g.Uniform1f(_,o.u_fade_change),u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(_,o.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(_,o.u_coord_matrix),u_is_text:new g.Uniform1i(_,o.u_is_text),u_pitch_with_map:new g.Uniform1i(_,o.u_pitch_with_map),u_texsize:new g.Uniform2f(_,o.u_texsize),u_texture:new g.Uniform1i(_,o.u_texture)}),symbolSDF:(_,o)=>({u_is_size_zoom_constant:new g.Uniform1i(_,o.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(_,o.u_is_size_feature_constant),u_size_t:new g.Uniform1f(_,o.u_size_t),u_size:new g.Uniform1f(_,o.u_size),u_camera_to_center_distance:new g.Uniform1f(_,o.u_camera_to_center_distance),u_pitch:new g.Uniform1f(_,o.u_pitch),u_rotate_symbol:new g.Uniform1i(_,o.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(_,o.u_aspect_ratio),u_fade_change:new g.Uniform1f(_,o.u_fade_change),u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(_,o.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(_,o.u_coord_matrix),u_is_text:new g.Uniform1i(_,o.u_is_text),u_pitch_with_map:new g.Uniform1i(_,o.u_pitch_with_map),u_texsize:new g.Uniform2f(_,o.u_texsize),u_texture:new g.Uniform1i(_,o.u_texture),u_gamma_scale:new g.Uniform1f(_,o.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(_,o.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(_,o.u_is_halo)}),symbolTextAndIcon:(_,o)=>({u_is_size_zoom_constant:new g.Uniform1i(_,o.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(_,o.u_is_size_feature_constant),u_size_t:new g.Uniform1f(_,o.u_size_t),u_size:new g.Uniform1f(_,o.u_size),u_camera_to_center_distance:new g.Uniform1f(_,o.u_camera_to_center_distance),u_pitch:new g.Uniform1f(_,o.u_pitch),u_rotate_symbol:new g.Uniform1i(_,o.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(_,o.u_aspect_ratio),u_fade_change:new g.Uniform1f(_,o.u_fade_change),u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(_,o.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(_,o.u_coord_matrix),u_is_text:new g.Uniform1i(_,o.u_is_text),u_pitch_with_map:new g.Uniform1i(_,o.u_pitch_with_map),u_texsize:new g.Uniform2f(_,o.u_texsize),u_texsize_icon:new g.Uniform2f(_,o.u_texsize_icon),u_texture:new g.Uniform1i(_,o.u_texture),u_texture_icon:new g.Uniform1i(_,o.u_texture_icon),u_gamma_scale:new g.Uniform1f(_,o.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(_,o.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(_,o.u_is_halo)}),background:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_opacity:new g.Uniform1f(_,o.u_opacity),u_color:new g.UniformColor(_,o.u_color)}),backgroundPattern:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_opacity:new g.Uniform1f(_,o.u_opacity),u_image:new g.Uniform1i(_,o.u_image),u_pattern_tl_a:new g.Uniform2f(_,o.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(_,o.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(_,o.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(_,o.u_pattern_br_b),u_texsize:new g.Uniform2f(_,o.u_texsize),u_mix:new g.Uniform1f(_,o.u_mix),u_pattern_size_a:new g.Uniform2f(_,o.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(_,o.u_pattern_size_b),u_scale_a:new g.Uniform1f(_,o.u_scale_a),u_scale_b:new g.Uniform1f(_,o.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(_,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,o.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(_,o.u_tile_units_to_pixels)}),terrainRaster:xn,terrainDepth:xn,skybox:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_sun_direction:new g.Uniform3f(_,o.u_sun_direction),u_cubemap:new g.Uniform1i(_,o.u_cubemap),u_opacity:new g.Uniform1f(_,o.u_opacity),u_temporal_offset:new g.Uniform1f(_,o.u_temporal_offset)}),skyboxGradient:(_,o)=>({u_matrix:new g.UniformMatrix4f(_,o.u_matrix),u_color_ramp:new g.Uniform1i(_,o.u_color_ramp),u_center_direction:new g.Uniform3f(_,o.u_center_direction),u_radius:new g.Uniform1f(_,o.u_radius),u_opacity:new g.Uniform1f(_,o.u_opacity),u_temporal_offset:new g.Uniform1f(_,o.u_temporal_offset)}),skyboxCapture:(_,o)=>({u_matrix_3f:new g.UniformMatrix3f(_,o.u_matrix_3f),u_sun_direction:new g.Uniform3f(_,o.u_sun_direction),u_sun_intensity:new g.Uniform1f(_,o.u_sun_intensity),u_color_tint_r:new g.Uniform4f(_,o.u_color_tint_r),u_color_tint_m:new g.Uniform4f(_,o.u_color_tint_m),u_luminance:new g.Uniform1f(_,o.u_luminance)})};let Cu;function pc(_,o,h,v,E,D,R){const B=_.context,z=B.gl,G=_.useProgram("collisionBox"),H=[];let Q=0,J=0;for(let ge=0;ge<v.length;ge++){const ve=v[ge],Se=o.getTile(ve),de=Se.getBucket(h);if(!de)continue;let Fe=ve.projMatrix;0===E[0]&&0===E[1]||(Fe=_.translatePosMatrix(ve.projMatrix,Se,E,D));const We=R?de.textCollisionBox:de.iconCollisionBox,tt=de.collisionCircleArray;if(tt.length>0){const Pe=g.create$1(),$e=Fe;g.mul$1(Pe,de.placementInvProjMatrix,_.transform.glCoordMatrix),g.mul$1(Pe,Pe,de.placementViewportMatrix),H.push({circleArray:tt,circleOffset:J,transform:$e,invTransform:Pe}),Q+=tt.length/4,J=Q}We&&(_.terrain&&_.terrain.setupElevationDraw(Se,G),G.draw(B,z.LINES,g.DepthMode.disabled,g.StencilMode.disabled,_.colorModeForRenderPass(),g.CullFaceMode.disabled,vl(Fe,_.transform,Se),h.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,_.transform.zoom,null,We.collisionVertexBuffer,We.collisionVertexBufferExt))}if(!R||!H.length)return;const te=_.useProgram("collisionCircle"),le=new g.StructArrayLayout2f1f2i16;le.resize(4*Q),le._trim();let ce=0;for(const ge of H)for(let ve=0;ve<ge.circleArray.length/4;ve++){const Se=4*ve,de=ge.circleArray[Se+0],Fe=ge.circleArray[Se+1],We=ge.circleArray[Se+2],tt=ge.circleArray[Se+3];le.emplace(ce++,de,Fe,We,tt,0),le.emplace(ce++,de,Fe,We,tt,1),le.emplace(ce++,de,Fe,We,tt,2),le.emplace(ce++,de,Fe,We,tt,3)}(!Cu||Cu.length<2*Q)&&(Cu=function(ge){const ve=2*ge,Se=new g.StructArrayLayout3ui6;Se.resize(ve),Se._trim();for(let de=0;de<ve;de++){const Fe=6*de;Se.uint16[Fe+0]=4*de+0,Se.uint16[Fe+1]=4*de+1,Se.uint16[Fe+2]=4*de+2,Se.uint16[Fe+3]=4*de+2,Se.uint16[Fe+4]=4*de+3,Se.uint16[Fe+5]=4*de+0}return Se}(Q));const _e=B.createIndexBuffer(Cu,!0),se=B.createVertexBuffer(le,g.collisionCircleLayout.members,!0);for(const ge of H){const ve={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(ue=_.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};te.draw(B,z.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,_.colorModeForRenderPass(),g.CullFaceMode.disabled,ve,h.id,se,_e,g.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,_.transform.zoom,null,null,null)}var ue;se.destroy(),_e.destroy()}const rf=g.identity(new Float32Array(16));function nm(_,o,h,v,E,D){const{horizontalAlign:R,verticalAlign:B}=g.getAnchorAlignment(_),z=-(R-.5)*o,G=-(B-.5)*h,H=g.evaluateVariableOffset(_,v);return new g.pointGeometry((z/E+H[0])*D,(G/E+H[1])*D)}function of(_,o,h,v,E,D,R,B,z,G,H,Q){const J=_.text.placedSymbolArray,te=_.text.dynamicLayoutVertexArray,le=_.icon.dynamicLayoutVertexArray,ce={};te.clear();for(let _e=0;_e<J.length;_e++){const se=J.get(_e),ue=_.allowVerticalPlacement&&!se.placedOrientation,ge=se.hidden||!se.crossTileID||ue?null:v[se.crossTileID];if(ge){const ve=new g.pointGeometry(se.tileAnchorX,se.tileAnchorY),Se=Q(ve),de=Gi(ve,h?B:R,Se),Fe=vn(D.cameraToCenterDistance,de.signedDistanceFromCamera);let We=E.evaluateSizeForFeature(_.textSizeData,G,se)*Fe/g.ONE_EM;h&&(We*=_.tilePixelRatio/z);const{width:tt,height:Pe,anchor:$e,textOffset:xt,textScale:Dt}=ge,Et=nm($e,tt,Pe,xt,Dt,We),ht=h?Gi(ve.add(Et),R,Se).point:de.point.add(o?Et.rotate(-D.angle):Et),Mt=_.allowVerticalPlacement&&se.placedOrientation===g.WritingMode.vertical?Math.PI/2:0;for(let bn=0;bn<se.numGlyphs;bn++)g.addDynamicAttributes(te,ht,Mt);H&&se.associatedIconIndex>=0&&(ce[se.associatedIconIndex]={shiftedAnchor:ht,angle:Mt})}else Go(se.numGlyphs,te)}if(H){le.clear();const _e=_.icon.placedSymbolArray;for(let se=0;se<_e.length;se++){const ue=_e.get(se);if(ue.hidden)Go(ue.numGlyphs,le);else{const ge=ce[se];if(ge)for(let ve=0;ve<ue.numGlyphs;ve++)g.addDynamicAttributes(le,ge.shiftedAnchor,ge.angle);else Go(ue.numGlyphs,le)}}_.icon.dynamicLayoutVertexBuffer.updateData(le)}_.text.dynamicLayoutVertexBuffer.updateData(te)}function mc(_,o,h){return h.iconsInText&&o?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function sf(_,o,h,v,E,D,R,B,z,G,H,Q){const J=_.context,te=J.gl,le=_.transform,ce="map"===B,_e="map"===z,se=ce&&"point"!==h.layout.get("symbol-placement"),ue=ce&&!_e&&!se,ge=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ve=!1;const Se=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),de=h.layout.get("text-variable-anchor"),Fe=[],We=_.terrain&&_e?["PITCH_WITH_MAP_TERRAIN"]:null;for(const tt of v){const Pe=o.getTile(tt),$e=Pe.getBucket(h);if(!$e)continue;const xt=E?$e.text:$e.icon;if(!xt||!xt.segments.get().length)continue;const Dt=xt.programConfigurations.get(h.id),Et=E||$e.sdfIcons,ht=E?$e.textSizeData:$e.iconSizeData,Mt=_e||0!==le.pitch,bn=_.useProgram(mc(Et,E,$e),Dt,We),Yt=g.evaluateSizeForZoom(ht,le.zoom);let Nr,xr,an,wn,Rr=[0,0],Ao=null;if(E){if(xr=Pe.glyphAtlasTexture,an=te.LINEAR,Nr=Pe.glyphAtlasTexture.size,$e.iconsInText){Rr=Pe.imageAtlasTexture.size,Ao=Pe.imageAtlasTexture;const So="composite"===ht.kind||"camera"===ht.kind;wn=Mt||_.options.rotating||_.options.zooming||So?te.LINEAR:te.NEAREST}}else{const So=1!==h.layout.get("icon-size").constantOr(0)||$e.iconsNeedLinear;xr=Pe.imageAtlasTexture,an=Et||_.options.rotating||_.options.zooming||So||Mt?te.LINEAR:te.NEAREST,Nr=Pe.imageAtlasTexture.size}const Eo=kr(Pe,1,_.transform.zoom),Yi=Ht(tt.projMatrix,_e,ce,_.transform,Eo),fo=_.terrain&&_e&&se?g.invert(new Float32Array(16),Yi):rf,xs=Gn(tt.projMatrix,_e,ce,_.transform,Eo),Do=de&&$e.hasTextData(),Tn="none"!==h.layout.get("icon-text-fit")&&Do&&$e.hasIconData();if(se){const So=le.elevation;qt($e,tt.projMatrix,_,E,Yi,xs,_e,G,So?Ki=>So.getAtTileOffset(tt,Ki.x,Ki.y):null)}const Cr=_.translatePosMatrix(tt.projMatrix,Pe,D,R),Nn=se||E&&de||Tn?rf:Yi,yr=_.translatePosMatrix(xs,Pe,D,R,!0),vi=Et&&0!==h.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1);let rr;rr=Et?$e.iconsInText?em(ht.kind,Yt,ue,_e,_,Cr,Nn,yr,Nr,Rr):Xo(ht.kind,Yt,ue,_e,_,Cr,Nn,yr,E,Nr,!0):wu(ht.kind,Yt,ue,_e,_,Cr,Nn,yr,E,Nr);const oi={program:bn,buffers:xt,uniformValues:rr,atlasTexture:xr,atlasTextureIcon:Ao,atlasInterpolation:an,atlasInterpolationIcon:wn,isSDF:Et,hasHalo:vi,tile:Pe,labelPlaneMatrixInv:fo};if(ge&&$e.canOverlap){ve=!0;const So=xt.segments.get();for(const Ki of So)Fe.push({segments:new g.SegmentVector([Ki]),sortKey:Ki.sortKey,state:oi})}else Fe.push({segments:xt.segments,sortKey:0,state:oi})}ve&&Fe.sort((tt,Pe)=>tt.sortKey-Pe.sortKey);for(const tt of Fe){const Pe=tt.state;if(_.terrain&&_.terrain.setupElevationDraw(Pe.tile,Pe.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Pe.labelPlaneMatrixInv}),J.activeTexture.set(te.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,te.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(J.activeTexture.set(te.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Pe.isSDF){const $e=Pe.uniformValues;Pe.hasHalo&&($e.u_is_halo=1,gc(Pe.buffers,tt.segments,h,_,Pe.program,Se,H,Q,$e)),$e.u_is_halo=0}gc(Pe.buffers,tt.segments,h,_,Pe.program,Se,H,Q,Pe.uniformValues)}}function gc(_,o,h,v,E,D,R,B,z){const G=v.context;E.draw(G,G.gl.TRIANGLES,D,R,B,g.CullFaceMode.disabled,z,h.id,_.layoutVertexBuffer,_.indexBuffer,o,h.paint,v.transform.zoom,_.programConfigurations.get(h.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function _c(_,o,h,v,E,D,R){const B=_.context.gl,z=h.paint.get("fill-pattern"),G=z&&z.constantOr(1),H=h.getCrossfadeParameters();let Q,J,te,le,ce;R?(J=G&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=B.LINES):(J=G?"fillPattern":"fill",Q=B.TRIANGLES);for(const _e of v){const se=o.getTile(_e);if(G&&!se.patternsLoaded())continue;const ue=se.getBucket(h);if(!ue)continue;_.prepareDrawTile(_e);const ge=ue.programConfigurations.get(h.id),ve=_.useProgram(J,ge);G&&(_.context.activeTexture.set(B.TEXTURE0),se.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ge.updatePaintBuffers(H));const Se=z.constantOr(null);if(Se&&se.imageAtlas){const Fe=se.imageAtlas,We=Fe.patternPositions[Se.to.toString()],tt=Fe.patternPositions[Se.from.toString()];We&&tt&&ge.setConstantPatternPositions(We,tt)}const de=_.translatePosMatrix(_e.projMatrix,se,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(R){le=ue.indexBuffer2,ce=ue.segments2;const Fe=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];te="fillOutlinePattern"===J&&G?Rn(de,_,H,se,Fe):Qo(de,Fe)}else le=ue.indexBuffer,ce=ue.segments,te=G?ms(de,_,H,se):Hs(de);_.prepareDrawProgram(_.context,ve,_e.toUnwrapped()),ve.draw(_.context,Q,E,_.stencilModeForClipping(_e),D,g.CullFaceMode.disabled,te,h.id,ue.layoutVertexBuffer,le,ce,h.paint,_.transform.zoom,ge)}}function Td(_,o,h,v,E,D,R){const B=_.context,z=B.gl,G=h.paint.get("fill-extrusion-pattern"),H=G.constantOr(1),Q=h.getCrossfadeParameters(),J=h.paint.get("fill-extrusion-opacity");for(const te of v){const le=o.getTile(te),ce=le.getBucket(h);if(!ce)continue;const _e=ce.programConfigurations.get(h.id),se=_.useProgram(H?"fillExtrusionPattern":"fillExtrusion",_e);if(_.terrain){const de=_.terrain;if(!ce.enableTerrain)continue;if(de.setupElevationDraw(le,se,{useMeterToDem:!0}),af(B,o,te,ce,h,de),!ce.centroidVertexBuffer){const Fe=se.attributes.a_centroid_pos;void 0!==Fe&&z.vertexAttrib2f(Fe,0,0)}}H&&(_.context.activeTexture.set(z.TEXTURE0),le.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),_e.updatePaintBuffers(Q));const ue=G.constantOr(null);if(ue&&le.imageAtlas){const de=le.imageAtlas,Fe=de.patternPositions[ue.to.toString()],We=de.patternPositions[ue.from.toString()];Fe&&We&&_e.setConstantPatternPositions(Fe,We)}const ge=_.translatePosMatrix(te.projMatrix,le,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ve=h.paint.get("fill-extrusion-vertical-gradient"),Se=H?bo(ge,_,ve,J,te,Q,le):qa(ge,_,ve,J);_.prepareDrawProgram(B,se,te.toUnwrapped()),se.draw(B,B.gl.TRIANGLES,E,D,R,g.CullFaceMode.backCCW,Se,h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,_.transform.zoom,_e,_.terrain?ce.centroidVertexBuffer:null)}}function af(_,o,h,v,E,D){const R=[se=>{let ue=se.canonical.x-1,ge=se.wrap;return ue<0&&(ue=(1<<se.canonical.z)-1,ge--),new g.OverscaledTileID(se.overscaledZ,ge,se.canonical.z,ue,se.canonical.y)},se=>{let ue=se.canonical.x+1,ge=se.wrap;return ue===1<<se.canonical.z&&(ue=0,ge++),new g.OverscaledTileID(se.overscaledZ,ge,se.canonical.z,ue,se.canonical.y)},se=>new g.OverscaledTileID(se.overscaledZ,se.wrap,se.canonical.z,se.canonical.x,(0===se.canonical.y?1<<se.canonical.z:se.canonical.y)-1),se=>new g.OverscaledTileID(se.overscaledZ,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y===(1<<se.canonical.z)-1?0:se.canonical.y+1)],B=se=>{const ue=o.getSource().maxzoom,ge=Fe=>{const We=o.getTileByID(Fe);if(We&&We.hasData())return We.getBucket(E)};let ve,Se,de;return(se.overscaledZ===se.canonical.z||se.overscaledZ>=ue)&&(ve=ge(se.key)),se.overscaledZ>=ue&&(Se=ge(se.calculateScaledKey(se.overscaledZ+1))),se.overscaledZ>ue&&(de=ge(se.calculateScaledKey(se.overscaledZ-1))),ve||Se||de},z=[0,0,0],G=(se,ue)=>(z[0]=Math.min(se.min.y,ue.min.y),z[1]=Math.max(se.max.y,ue.max.y),z[2]=g.EXTENT-ue.min.x>se.max.x?ue.min.x-g.EXTENT:se.max.x,z),H=(se,ue)=>(z[0]=Math.min(se.min.x,ue.min.x),z[1]=Math.max(se.max.x,ue.max.x),z[2]=g.EXTENT-ue.min.y>se.max.y?ue.min.y-g.EXTENT:se.max.y,z),Q=[(se,ue)=>G(se,ue),(se,ue)=>G(ue,se),(se,ue)=>H(se,ue),(se,ue)=>H(ue,se)],J=new g.pointGeometry(0,0);let te,le,ce;const _e=(se,ue,ge,ve,Se)=>{const de=[[ve?ge:se,ve?se:ge,0],[ve?ge:ue,ve?ue:ge,0]],Fe=Se<0?g.EXTENT+Se:Se,We=[ve?Fe:(se+ue)/2,ve?(se+ue)/2:Fe,0];return 0===ge&&Se<0||0!==ge&&Se>0?D.getForTilePoints(ce,[We],!0,le):de.push(We),D.getForTilePoints(h,de,!0,te),Math.max(de[0][2],de[1][2],We[2])/D.exaggeration()};for(let se=0;se<4;se++){const ue=v.borders[se];if(0===ue.length&&(v.borderDone[se]=!0),v.borderDone[se])continue;const ge=ce=R[se](h),ve=B(ge);if(!(ve&&ve.enableTerrain&&(le=D.findDEMTileFor(ge),le&&le.dem)))continue;if(!te){const We=D.findDEMTileFor(h);if(!We||!We.dem)return;te=We}const Se=(se<2?1:5)-se,de=ve.borders[Se];let Fe=0;for(let We=0;We<ue.length;We++){const tt=v.featuresOnBorder[ue[We]],Pe=tt.borders[se];let $e;for(;Fe<de.length&&($e=ve.featuresOnBorder[de[Fe]],!($e.borders[Se][1]>Pe[0]+3));)ve.borderDone[Se]||ve.encodeCentroid(void 0,$e,!1),Fe++;if($e&&Fe<de.length){const xt=Fe;let Dt=0;for(;!($e.borders[Se][0]>Pe[1]-3)&&(Dt++,++Fe!==de.length);)$e=ve.featuresOnBorder[de[Fe]];if($e=ve.featuresOnBorder[de[xt]],tt.intersectsCount()>1||$e.intersectsCount()>1||1!==Dt){1!==Dt&&(Fe=xt),v.encodeCentroid(void 0,tt,!1),ve.borderDone[Se]||ve.encodeCentroid(void 0,$e,!1);continue}const Et=Q[se](tt,$e),ht=se%2?g.EXTENT-1:0;J.x=_e(Et[0],Math.min(g.EXTENT-1,Et[1]),ht,se<2,Et[2]),J.y=0,v.encodeCentroid(J,tt,!1),ve.borderDone[Se]||ve.encodeCentroid(J,$e,!1)}else v.encodeCentroid(void 0,tt,!1)}v.borderDone[se]=v.needsCentroidUpdate=!0,ve.borderDone[Se]||(ve.borderDone[Se]=ve.needsCentroidUpdate=!0)}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(_)}const nr=new g.Color(1,0,0,1),Id=new g.Color(0,1,0,1),b0=new g.Color(0,0,1,1),kd=new g.Color(1,0,1,1),wl=new g.Color(0,1,1,1);function rm(_,o,h,v){wh(_,0,o+h/2,_.transform.width,h,v)}function im(_,o,h,v){wh(_,o-h/2,0,h,_.transform.height,v)}function wh(_,o,h,v,E,D){const R=_.context,B=R.gl;B.enable(B.SCISSOR_TEST),B.scissor(o*g.exported.devicePixelRatio,h*g.exported.devicePixelRatio,v*g.exported.devicePixelRatio,E*g.exported.devicePixelRatio),R.clear({color:D}),B.disable(B.SCISSOR_TEST)}function Cl(_,o,h){const v=_.context,E=v.gl,D=h.projMatrix,R=_.useProgram("debug"),B=o.getTileByID(h.key);_.terrain&&_.terrain.setupElevationDraw(B,R);const z=g.DepthMode.disabled,G=g.StencilMode.disabled,H=_.colorModeForRenderPass(),Q="$debug";v.activeTexture.set(E.TEXTURE0),_.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),R.draw(v,E.LINE_STRIP,z,G,H,g.CullFaceMode.disabled,fc(D,g.Color.red),Q,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments);const J=B.latestRawTileData,te=Math.floor((J&&J.byteLength||0)/1024),le=o.getTile(h).tileSize,ce=512/Math.min(le,512)*(h.overscaledZ/_.transform.zoom)*.5;let _e=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(_e+=` => ${h.overscaledZ}`),function(se,ue){se.initDebugOverlayCanvas();const ge=se.debugOverlayCanvas,ve=se.context.gl,Se=se.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,ge.width,ge.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(ue,5,5),Se.strokeText(ue,5,5),se.debugOverlayTexture.update(ge),se.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(_,`${_e} ${te}kb`),R.draw(v,E.TRIANGLES,z,G,g.ColorMode.alphaBlended,g.CullFaceMode.disabled,fc(D,g.Color.transparent,ce),Q,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments)}const Ch=g.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zr}=Ch;function Yo(_,o,h,v){_.emplaceBack(o,h,v)}class Eh{constructor(o){this.vertexArray=new g.StructArrayLayout3f12,this.indices=new g.StructArrayLayout3ui6,Yo(this.vertexArray,-1,-1,1),Yo(this.vertexArray,1,-1,1),Yo(this.vertexArray,-1,1,1),Yo(this.vertexArray,1,1,1),Yo(this.vertexArray,-1,-1,-1),Yo(this.vertexArray,1,-1,-1),Yo(this.vertexArray,-1,1,-1),Yo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Zr),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=g.SegmentVector.simpleSegment(0,0,36,12)}}function Wa(_,o,h,v,E,D){const R=_.gl,B=o.paint.get("sky-atmosphere-color"),z=o.paint.get("sky-atmosphere-halo-color"),G=o.paint.get("sky-atmosphere-sun-intensity"),H={u_matrix_3f:g.fromMat4([],v),u_sun_direction:E,u_sun_intensity:G,u_color_tint_r:[(le=B).r,le.g,le.b,le.a],u_color_tint_m:[(ce=z).r,ce.g,ce.b,ce.a],u_luminance:5e-5};var le,ce;R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+D,o.skyboxTexture,0),h.draw(_,R.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,g.ColorMode.unblended,g.CullFaceMode.frontCW,H,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Dh={symbol:function(_,o,h,v,E){if("translucent"!==_.renderPass)return;const D=g.StencilMode.disabled,R=_.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(B,z,G,H,Q,J,te){const le=z.transform,ce="map"===Q,_e="map"===J;for(const se of B){const ue=H.getTile(se),ge=ue.getBucket(G);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const ve=g.evaluateSizeForZoom(ge.textSizeData,le.zoom),Se=kr(ue,1,z.transform.zoom),de=Ht(se.projMatrix,_e,ce,z.transform,Se),Fe="none"!==G.layout.get("icon-text-fit")&&ge.hasIconData();if(ve){const We=Math.pow(2,le.zoom-ue.tileID.overscaledZ),tt=le.elevation;of(ge,ce,_e,te,g.symbolSize,le,de,se.projMatrix,We,ve,Fe,tt?Pe=>tt.getAtTileOffset(se,Pe.x,Pe.y):Pe=>0)}}}(v,_,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E),0!==h.paint.get("icon-opacity").constantOr(1)&&sf(_,o,h,v,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),D,R),0!==h.paint.get("text-opacity").constantOr(1)&&sf(_,o,h,v,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),D,R),o.map.showCollisionBoxes&&(pc(_,o,h,v,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),pc(_,o,h,v,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(_,o,h,v){if("translucent"!==_.renderPass)return;const E=h.paint.get("circle-opacity"),D=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),B=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===E.constantOr(1)&&(0===D.constantOr(1)||0===R.constantOr(1)))return;const z=_.context,G=z.gl,H=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),Q=g.StencilMode.disabled,J=_.colorModeForRenderPass(),te=[];for(let le=0;le<v.length;le++){const ce=v[le],_e=o.getTile(ce),se=_e.getBucket(h);if(!se)continue;const ue=se.programConfigurations.get(h.id),ge=xh(h),ve={programConfiguration:ue,program:_.useProgram("circle",ue,ge),layoutVertexBuffer:se.layoutVertexBuffer,indexBuffer:se.indexBuffer,uniformValues:Sd(_,ce,_e,h),tile:_e};if(B){const Se=se.segments.get();for(const de of Se)te.push({segments:new g.SegmentVector([de]),sortKey:de.sortKey,state:ve})}else te.push({segments:se.segments,sortKey:0,state:ve})}B&&te.sort((le,ce)=>le.sortKey-ce.sortKey);for(const le of te){const{programConfiguration:ce,program:_e,layoutVertexBuffer:se,indexBuffer:ue,uniformValues:ge,tile:ve}=le.state,Se=le.segments;_.terrain&&_.terrain.setupElevationDraw(ve,_e,{useDepthForOcclusion:!0}),_.prepareDrawProgram(z,_e,ve.tileID.toUnwrapped()),_e.draw(z,G.TRIANGLES,H,Q,J,g.CullFaceMode.disabled,ge,h.id,se,ue,Se,h.paint,_.transform.zoom,ce)}},heatmap:function(_,o,h,v){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const E=_.context,D=E.gl,R=g.StencilMode.disabled,B=new g.ColorMode([D.ONE,D.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(z,G,H){const Q=z.gl;z.activeTexture.set(Q.TEXTURE1),z.viewport.set([0,0,G.width/4,G.height/4]);let J=H.heatmapFbo;if(J)Q.bindTexture(Q.TEXTURE_2D,J.colorAttachment.get()),z.bindFramebuffer.set(J.framebuffer);else{const te=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,te),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),J=H.heatmapFbo=z.createFramebuffer(G.width/4,G.height/4,!1),function(le,ce,_e,se){const ue=le.gl;ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,ce.width/4,ce.height/4,0,ue.RGBA,le.extRenderToTextureHalfFloat?le.extTextureHalfFloat.HALF_FLOAT_OES:ue.UNSIGNED_BYTE,null),se.colorAttachment.set(_e)}(z,G,te,J)}})(E,_,h),E.clear({color:g.Color.transparent});for(let z=0;z<v.length;z++){const G=v[z];if(o.hasRenderableParent(G))continue;const H=o.getTile(G),Q=H.getBucket(h);if(!Q)continue;const J=Q.programConfigurations.get(h.id),te=_.useProgram("heatmap",J),{zoom:le}=_.transform;_.terrain&&_.terrain.setupElevationDraw(H,te),_.prepareDrawProgram(E,te,G.toUnwrapped()),te.draw(E,D.TRIANGLES,g.DepthMode.disabled,R,B,g.CullFaceMode.disabled,xl(G.projMatrix,H,le,h.paint.get("heatmap-intensity")),h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,_.transform.zoom,J)}E.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(E,D){const R=E.context,B=R.gl,z=D.heatmapFbo;if(!z)return;R.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,z.colorAttachment.get()),R.activeTexture.set(B.TEXTURE1);let G=D.colorRampTexture;G||(G=D.colorRampTexture=new g.Texture(R,D.colorRamp,B.RGBA)),G.bind(B.LINEAR,B.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(R,B.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,E.colorModeForRenderPass(),g.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")},D.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,D.paint,E.transform.zoom)}(_,h))},line:function(_,o,h,v){if("translucent"!==_.renderPass)return;const E=h.paint.get("line-opacity"),D=h.paint.get("line-width");if(0===E.constantOr(1)||0===D.constantOr(1))return;const R=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),B=_.colorModeForRenderPass(),z=h.paint.get("line-dasharray"),G=z.constantOr(1),H=h.layout.get("line-cap"),Q=h.paint.get("line-pattern"),J=Q.constantOr(1),te=h.paint.get("line-gradient"),le=h.getCrossfadeParameters(),ce=J?"linePattern":"line",_e=_.context,se=_e.gl;for(const ue of v){const ge=o.getTile(ue);if(J&&!ge.patternsLoaded())continue;const ve=ge.getBucket(h);if(!ve)continue;_.prepareDrawTile(ue);const Se=ve.programConfigurations.get(h.id),de=gs(h),Fe=_.useProgram(ce,Se,de),We=Q.constantOr(null);if(We&&ge.imageAtlas){const Dt=ge.imageAtlas,Et=Dt.patternPositions[We.to.toString()],ht=Dt.patternPositions[We.from.toString()];Et&&ht&&Se.setConstantPatternPositions(Et,ht)}const tt=z.constantOr(null),Pe=H.constantOr(null);if(!J&&tt&&Pe&&ge.lineAtlas){const Dt=ge.lineAtlas,Et=Dt.getDash(tt.to,Pe),ht=Dt.getDash(tt.from,Pe);Et&&ht&&Se.setConstantPatternPositions(Et,ht)}const $e=_.terrain?ue.projMatrix:null,xt=J?xa(_,ge,h,le,$e):bl(_,ge,h,le,$e,ve.lineClipsArray.length);if(te){const Dt=ve.gradients[h.id];let Et=Dt.texture;if(h.gradientVersion!==Dt.version){let ht=256;if(h.stepInterpolant){const Mt=o.getSource().maxzoom,bn=ue.canonical.z===Mt?Math.ceil(1<<_.transform.maxZoom-ue.canonical.z):1;ht=g.clamp(g.nextPowerOfTwo(ve.maxLineLength/g.EXTENT*1024*bn),256,_e.maxTextureSize)}Dt.gradient=g.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:ht,image:Dt.gradient||void 0,clips:ve.lineClipsArray}),Dt.texture?Dt.texture.update(Dt.gradient):Dt.texture=new g.Texture(_e,Dt.gradient,se.RGBA),Dt.version=h.gradientVersion,Et=Dt.texture}_e.activeTexture.set(se.TEXTURE1),Et.bind(h.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}G&&(_e.activeTexture.set(se.TEXTURE0),ge.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Se.updatePaintBuffers(le)),J&&(_e.activeTexture.set(se.TEXTURE0),ge.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Se.updatePaintBuffers(le)),_.prepareDrawProgram(_e,Fe,ue.toUnwrapped()),Fe.draw(_e,se.TRIANGLES,R,_.stencilModeForClipping(ue),B,g.CullFaceMode.disabled,xt,h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,h.paint,_.transform.zoom,Se,ve.layoutVertexBuffer2)}},fill:function(_,o,h,v){const E=h.paint.get("fill-color"),D=h.paint.get("fill-opacity");if(0===D.constantOr(1))return;const R=_.colorModeForRenderPass(),B=h.paint.get("fill-pattern"),z=_.opaquePassEnabledForLayer()&&!B.constantOr(1)&&1===E.constantOr(g.Color.transparent).a&&1===D.constantOr(0)?"opaque":"translucent";if(_.renderPass===z){const G=_.depthModeForSublayer(1,"opaque"===_.renderPass?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly);_c(_,o,h,v,G,R,!1)}if("translucent"===_.renderPass&&h.paint.get("fill-antialias")){const G=_.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,g.DepthMode.ReadOnly);_c(_,o,h,v,G,R,!0)}},"fill-extrusion":function(_,o,h,v){const E=h.paint.get("fill-extrusion-opacity");if(0!==E&&"translucent"===_.renderPass){const D=new g.DepthMode(_.context.gl.LEQUAL,g.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==E||h.paint.get("fill-extrusion-pattern").constantOr(1))Td(_,o,h,v,D,g.StencilMode.disabled,g.ColorMode.disabled),Td(_,o,h,v,D,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const R=_.colorModeForRenderPass();Td(_,o,h,v,D,g.StencilMode.disabled,R)}}},hillshade:function(_,o,h,v){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const E=_.context,D=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),R=_.colorModeForRenderPass(),B=_.terrain&&_.terrain.renderingToTexture,[z,G]="translucent"!==_.renderPass||B?[{},v]:_.stencilConfigForOverlap(v);for(const H of G){const Q=o.getTile(H);if(Q.needsHillshadePrepare&&"offscreen"===_.renderPass)ut(_,Q,h,D,g.StencilMode.disabled,R);else if("translucent"===_.renderPass){const J=B&&_.terrain?_.terrain.stencilModeForRTTOverlap(H):z[H.overscaledZ];vh(_,H,Q,h,D,J,R)}}E.viewport.set([0,0,_.width,_.height])},raster:function(_,o,h,v,E,D){if("translucent"!==_.renderPass||0===h.paint.get("raster-opacity")||!v.length)return;const R=_.context,B=R.gl,z=o.getSource(),G=_.useProgram("raster"),H=_.colorModeForRenderPass(),Q=_.terrain&&_.terrain.renderingToTexture,[J,te]=z instanceof ne||Q?[{},v]:_.stencilConfigForOverlap(v),le=te[te.length-1].overscaledZ,ce=!_.options.moving;for(const _e of te){const se=Q?g.DepthMode.disabled:_.depthModeForSublayer(_e.overscaledZ-le,1===h.paint.get("raster-opacity")?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly,B.LESS),ue=_e.toUnwrapped(),ge=o.getTile(_e);if(Q&&(!ge||!ge.hasData()))continue;const ve=Q?_e.projMatrix:_.transform.calculateProjMatrix(ue,ce),Se=_.terrain&&Q?_.terrain.stencilModeForRTTOverlap(_e):J[_e.overscaledZ],de=D?0:h.paint.get("raster-fade-duration");ge.registerFadeDuration(de);const Fe=o.findLoadedParent(_e,0),We=qr(ge,Fe,o,_.transform,de);let tt,Pe;_.terrain&&_.terrain.prepareDrawTile(_e);const $e="nearest"===h.paint.get("raster-resampling")?B.NEAREST:B.LINEAR;R.activeTexture.set(B.TEXTURE0),ge.texture.bind($e,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(B.TEXTURE1),Fe?(Fe.texture.bind($e,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),tt=Math.pow(2,Fe.tileID.overscaledZ-ge.tileID.overscaledZ),Pe=[ge.tileID.canonical.x*tt%1,ge.tileID.canonical.y*tt%1]):ge.texture.bind($e,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const xt=Za(ve,Pe||[0,0],tt||1,We,h);_.prepareDrawProgram(R,G,ue),z instanceof ne?G.draw(R,B.TRIANGLES,se,g.StencilMode.disabled,H,g.CullFaceMode.disabled,xt,h.id,z.boundsBuffer,_.quadTriangleIndexBuffer,z.boundsSegments):G.draw(R,B.TRIANGLES,se,Se,H,g.CullFaceMode.disabled,xt,h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}},background:function(_,o,h,v){const E=h.paint.get("background-color"),D=h.paint.get("background-opacity");if(0===D)return;const R=_.context,B=R.gl,z=_.transform,G=z.tileSize,H=h.paint.get("background-pattern");if(_.isPatternMissing(H))return;const Q=!H&&1===E.a&&1===D&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Q)return;const J=g.StencilMode.disabled,te=_.depthModeForSublayer(0,"opaque"===Q?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly),le=_.colorModeForRenderPass(),ce=_.useProgram(H?"backgroundPattern":"background"),_e=v||z.coveringTiles({tileSize:G});H&&(R.activeTexture.set(B.TEXTURE0),_.imageManager.bind(_.context));const se=h.getCrossfadeParameters();for(const ue of _e){const ge=ue.toUnwrapped(),ve=v?ue.projMatrix:_.transform.calculateProjMatrix(ge);_.prepareDrawTile(ue);const Se=H?tm(ve,D,_,H,{tileID:ue,tileSize:G},se):x0(ve,D,E);_.prepareDrawProgram(R,ce,ge),ce.draw(R,B.TRIANGLES,te,J,le,g.CullFaceMode.disabled,Se,h.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}},sky:function(_,o,h){const v=h.paint.get("sky-opacity");if(0===v)return;const E=_.context,D=h.paint.get("sky-type"),R=new g.DepthMode(E.gl.LEQUAL,g.DepthMode.ReadOnly,[0,1]),B=_.frameCounter/1e3%1;"atmosphere"===D?"offscreen"===_.renderPass?h.needsSkyboxCapture(_)&&(function(z,G,H,Q){const J=z.context,te=J.gl;let le=G.skyboxFbo;if(!le){le=G.skyboxFbo=J.createFramebuffer(32,32,!1),G.skyboxGeometry=new Eh(J),G.skyboxTexture=J.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,G.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let ue=0;ue<6;++ue)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(le.framebuffer),J.viewport.set([0,0,32,32]);const ce=G.getCenter(z,!0),_e=z.useProgram("skyboxCapture"),se=new Float64Array(16);g.identity(se),g.rotateY(se,se,.5*-Math.PI),Wa(J,G,_e,se,ce,0),g.identity(se),g.rotateY(se,se,.5*Math.PI),Wa(J,G,_e,se,ce,1),g.identity(se),g.rotateX(se,se,.5*-Math.PI),Wa(J,G,_e,se,ce,2),g.identity(se),g.rotateX(se,se,.5*Math.PI),Wa(J,G,_e,se,ce,3),g.identity(se),Wa(J,G,_e,se,ce,4),g.identity(se),g.rotateY(se,se,Math.PI),Wa(J,G,_e,se,ce,5),J.viewport.set([0,0,z.width,z.height])}(_,h),h.markSkyboxValid(_)):"sky"===_.renderPass&&function(z,G,H,Q,J){const te=z.context,le=te.gl,ce=z.transform,_e=z.useProgram("skybox");te.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,G.skyboxTexture);const se={u_matrix:ce.skyboxMatrix,u_sun_direction:G.getCenter(z,!1),u_cubemap:0,u_opacity:Q,u_temporal_offset:J};z.prepareDrawProgram(te,_e),_e.draw(te,le.TRIANGLES,H,g.StencilMode.disabled,z.colorModeForRenderPass(),g.CullFaceMode.backCW,se,"skybox",G.skyboxGeometry.vertexBuffer,G.skyboxGeometry.indexBuffer,G.skyboxGeometry.segment)}(_,h,R,v,B):"gradient"===D&&"sky"===_.renderPass&&function(z,G,H,Q,J){const te=z.context,le=te.gl,ce=z.transform,_e=z.useProgram("skyboxGradient");G.skyboxGeometry||(G.skyboxGeometry=new Eh(te)),te.activeTexture.set(le.TEXTURE0);let se=G.colorRampTexture;se||(se=G.colorRampTexture=new g.Texture(te,G.colorRamp,le.RGBA)),se.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ue=(ge=ce.skyboxMatrix,ve=G.getCenter(z,!1),Se=G.paint.get("sky-gradient-radius"),de=Q,Fe=J,{u_matrix:ge,u_color_ramp:0,u_center_direction:ve,u_radius:g.degToRad(Se),u_opacity:de,u_temporal_offset:Fe});var ge,ve,Se,de,Fe;z.prepareDrawProgram(te,_e),_e.draw(te,le.TRIANGLES,H,g.StencilMode.disabled,z.colorModeForRenderPass(),g.CullFaceMode.backCW,ue,"skyboxGradient",G.skyboxGeometry.vertexBuffer,G.skyboxGeometry.indexBuffer,G.skyboxGeometry.segment)}(_,h,R,v,B)},debug:function(_,o,h){for(let v=0;v<h.length;v++)Cl(_,o,h[v])},custom:function(_,o,h){const v=_.context,E=h.implementation;if("offscreen"===_.renderPass){const D=E.prerender;D&&(_.setCustomLayerDefaults(),v.setColorMode(_.colorModeForRenderPass()),D.call(E,v.gl,_.transform.customLayerMatrix()),v.setDirty(),_.setBaseState())}else if("translucent"===_.renderPass){_.setCustomLayerDefaults(),v.setColorMode(_.colorModeForRenderPass()),v.setStencilMode(g.StencilMode.disabled);const D="3d"===E.renderingMode?new g.DepthMode(_.context.gl.LEQUAL,g.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,g.DepthMode.ReadOnly);v.setDepthMode(D),E.render(v.gl,_.transform.customLayerMatrix()),v.setDirty(),_.setBaseState(),v.bindFramebuffer.set(null)}}};class Eu{constructor(o,h){this.context=new sn(o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=g.SourceCache.maxUnderzooming+g.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new js,this.gpuTimers={},this.frameCounter=0}updateTerrain(o,h){const v=!!o&&!!o.terrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new mn(this,o));const E=this._terrain;this.transform.elevation=v?E:null,E.update(o,this.transform,h)}_updateFog(o){const h=o.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,E]=h.getFovAdjustedRange(this.transform._fov);if(v>E)return void(this.transform.fogCullDistSq=null);const D=v+.78*(E-v);this.transform.fogCullDistSq=D*D}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,h){if(this.width=o*g.exported.devicePixelRatio,this.height=h*g.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const o=this.context,h=new g.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,g.posAttributes.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);const v=new g.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(g.EXTENT,0),v.emplaceBack(0,g.EXTENT),v.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=o.createVertexBuffer(v,g.posAttributes.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);const E=new g.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(g.EXTENT,0,g.EXTENT,0),E.emplaceBack(0,g.EXTENT,0,g.EXTENT),E.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(E,$n.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);const D=new g.StructArrayLayout2i4;D.emplaceBack(-1,-1),D.emplaceBack(1,-1),D.emplaceBack(-1,1),D.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(D,g.posAttributes.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);const R=new g.StructArrayLayout1ui2;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(R);const B=new g.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(B),this.emptyTexture=new g.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=g.create$1();const z=this.context.gl;this.stencilClearMode=new g.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(g.window.performance.now())}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(o,h.TRIANGLES,g.DepthMode.disabled,this.stencilClearMode,g.ColorMode.disabled,g.CullFaceMode.disabled,Gs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h,v){if(!(h&&this.currentStencilSource!==h.id&&o.isTileClipped()&&v&&v.length))return;this.currentStencilSource=h.id;const E=this.context,D=E.gl;this.nextStencilID+v.length>256&&this.clearStencil(),E.setColorMode(g.ColorMode.disabled),E.setDepthMode(g.DepthMode.disabled);const R=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of v){const z=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;R.draw(E,D.TRIANGLES,g.DepthMode.disabled,new g.StencilMode({func:D.ALWAYS,mask:0},z,255,D.KEEP,D.KEEP,D.REPLACE),g.ColorMode.disabled,g.CullFaceMode.disabled,Gs(B.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new g.StencilMode({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new g.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,v=o.sort((R,B)=>B.overscaledZ-R.overscaledZ),E=v[v.length-1].overscaledZ,D=v[0].overscaledZ-E+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();const R={};for(let B=0;B<D;B++)R[B+E]=new g.StencilMode({func:h.GEQUAL,mask:255},B+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=D,[R,v]}return[{[E]:g.StencilMode.disabled},v]}colorModeForRenderPass(){const o=this.context.gl;if(this._showOverdrawInspector){const h=1/8;return new g.ColorMode([o.CONSTANT_COLOR,o.ONE],new g.Color(h,h,h,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?g.ColorMode.unblended:g.ColorMode.alphaBlended}depthModeForSublayer(o,h,v){if(!this.opaquePassEnabledForLayer())return g.DepthMode.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new g.DepthMode(v||this.context.gl.LEQUAL,h,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(g.exported.now()),this.imageManager.beginFrame();const v=this.style.order,E=this.style._sourceCaches;for(const G in E){const H=E[G];H.used&&H.prepare(this.context)}const D={},R={},B={};for(const G in E){const H=E[G];D[G]=H.getVisibleCoordinates(),R[G]=D[G].slice().reverse(),B[G]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<v.length;G++)if(this.style._layers[v[G]].is3D()){this.opaquePassCutoff=G;break}if(this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0),!g.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const G of v){const H=this.style._layers[G],Q=o._getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const J=Q?R[Q.id]:void 0;("custom"===H.type||H.isSky()||J&&J.length)&&this.renderLayer(this,Q,H,J)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let z=g.Color.transparent;if(this.style.fog&&(z=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?g.Color.black:z,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[v[this.currentLayer]],H=o._getLayerSourceCache(G);if(G.isSky())continue;const Q=H?R[H.id]:void 0;this._renderTileClippingMasks(G,H,Q),this.renderLayer(this,H,G,Q)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const G=this.style._layers[v[this.currentLayer]],H=o._getLayerSourceCache(G);G.isSky()&&this.renderLayer(this,H,G,H?R[H.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const G=this.style._layers[v[this.currentLayer]],H=o._getLayerSourceCache(G);if(G.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(G)){if(G.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Q=H?("symbol"===G.type?B:R)[H.id]:void 0;this._renderTileClippingMasks(G,H,H?D[H.id]:void 0),this.renderLayer(this,H,G,Q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let G=null;g.values(this.style._layers).forEach(H=>{const Q=o._getLayerSourceCache(H);Q&&!H.isHidden(this.transform.zoom)&&(!G||G.getSource().maxzoom<Q.getSource().maxzoom)&&(G=Q)}),G&&this.options.showTileBoundaries&&Dh.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const H=G.transform.padding;rm(G,G.transform.height-(H.top||0),3,nr),rm(G,H.bottom||0,3,Id),im(G,H.left||0,3,b0),im(G,G.transform.width-(H.right||0),3,kd);const Q=G.transform.centerPoint;var J,te,le,ce;wh(J=G,(te=Q.x)-1,(le=G.transform.height-Q.y)-10,2,20,ce=wl),wh(J,te-10,le-1,20,2,ce)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%g.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(g.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,h,v,E){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||E&&E.length)&&(this.id=v.id,this.gpuTimingStart(v),Dh[v.type](o,h,v,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),v.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,v.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const h={};for(const v in o){const E=o[v],D=this.context.extTimerQuery,R=D.getQueryObjectEXT(E.query,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(E.query),h[v]=R}return h}translatePosMatrix(o,h,v,E,D){if(!v[0]&&!v[1])return o;const R=D?"map"===E?this.transform.angle:0:"viewport"===E?-this.transform.angle:0;if(R){const G=Math.sin(R),H=Math.cos(R);v=[v[0]*H-v[1]*G,v[0]*G+v[1]*H]}const B=[D?v[0]:kr(h,v[0],this.transform.zoom),D?v[1]:kr(h,v[1],this.transform.zoom),0],z=new Float32Array(16);return g.translate(z,o,B),z}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),v=this.imageManager.getPattern(o.to.toString());return!h||!v}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,v=[];return this.terrain&&!this.terrain.renderingToTexture&&v.push("TERRAIN"),h&&!o&&0!==h.getOpacity(this.transform.pitch)&&v.push("FOG"),o&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(o,h,v){this.cache=this.cache||{};const E=v||[],D=this.currentGlobalDefines().concat(E),R=va.cacheKey(o,D,h);return this.cache[R]||(this.cache[R]=new va(this.context,o,Mi[o],h,Md[o],D)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,h,v){if(this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const D=E.getOpacity(this.transform.pitch);0!==D&&h.setFogUniformValues(o,((R,B,z,G)=>{const H=B.properties.get("color"),Q=R.frameCounter/1e3%1,J=[H.r/H.a,H.g/H.a,H.b/H.a,G];return{u_fog_matrix:z?R.transform.calculateFogTileMatrix(z):R.identityMat,u_fog_range:B.getFovAdjustedRange(R.transform._fov),u_fog_color:J,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:Q}})(this,E,v,D))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}}class yc{constructor(o=0,h=0,v=0,E=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(v)||v<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=v,this.right=E}interpolate(o,h,v){return null!=h.top&&null!=o.top&&(this.top=g.number(o.top,h.top,v)),null!=h.bottom&&null!=o.bottom&&(this.bottom=g.number(o.bottom,h.bottom,v)),null!=h.left&&null!=o.left&&(this.left=g.number(o.left,h.left,v)),null!=h.right&&null!=o.right&&(this.right=g.number(o.right,h.right,v)),this}getCenter(o,h){const v=g.clamp((this.left+o-this.right)/2,0,o),E=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.pointGeometry(v,E)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new yc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ni(_,o){return[_[4*o],_[4*o+1],_[4*o+2],_[4*o+3]]}function Pd(_,o,h){_[4*o+0]=h[0],_[4*o+1]=h[1],_[4*o+2]=h[2],_[4*o+3]=h[3]}function ho(_,o){const h=Ni(_,3);g.fromQuat(_,o),Pd(_,3,h)}function Sh(_,o){Pd(_,3,[o[0],o[1],o[2],1])}function ba(_,o){const h=g.identity$1([]);return g.rotateZ$1(h,h,-o),g.rotateX$1(h,h,-_),h}function Qa(_,o){const h=[_[0],_[1],0],v=[o[0],o[1],0];if(g.length(h)>=1e-15){const R=g.normalize([],h);g.scale(v,R,g.dot(v,R)),o[0]=v[0],o[1]=v[1]}const E=g.cross([],o,_);if(g.len(E)<1e-15)return null;const D=Math.atan2(-E[1],E[0]);return ba(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),D)}class Mh{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(h){if(!h)return;const v=Array.isArray(h)?new g.MercatorCoordinate(h[0],h[1],h[2]):h;return v.x=g.wrap(v.x,0,1),v}(o):o}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;const v=this._elevation?this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(o)):0,E=this.position,D=g.MercatorCoordinate.fromLngLat(o,v),R=[D.x-E.x,D.y-E.y,D.z-E.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Qa(R,h)}setPitchBearing(o,h){this.orientation=ba(g.degToRad(o),g.degToRad(-h))}}class Du{constructor(o,h){this._transform=g.identity([]),this._orientation=g.identity$1([]),h&&(this._orientation=h,ho(this._transform,this._orientation)),o&&Sh(this._transform,o)}get mercatorPosition(){const o=this.position;return new g.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=Ni(this._transform,3);return[o[0],o[1],o[2]]}set position(o){Sh(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,ho(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=ba(o,h),ho(this._transform,this._orientation)}forward(){const o=Ni(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=Ni(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=Ni(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const v=new Float64Array(16);return g.invert(v,this.getWorldToCamera(o,h)),v}getWorldToCameraPosition(o,h,v){const E=this.position;g.scale(E,E,-o);const D=new Float64Array(16);return g.fromScaling(D,[v,v,v]),g.translate(D,D,E),D[10]*=h,D}getWorldToCamera(o,h){const v=new Float64Array(16),E=new Float64Array(4),D=this.position;return g.conjugate(E,this._orientation),g.scale(D,D,-o),g.fromQuat(v,E),g.translate(v,v,D),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=h,v[9]*=h,v[10]*=h,v[11]*=h,v}getCameraToClipPerspective(o,h,v,E){const D=new Float64Array(16);return g.perspective(D,o,h,v,E),D}getDistanceToElevation(o){const h=0===o?0:g.mercatorZfromAltitude(o,this.position[1]),v=this.forward();return(h-this.position[2])/v[2]}clone(){return new Du([...this.position],[...this.orientation])}}class Su{constructor(o,h,v,E,D){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===D||D,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=null==v?0:v,this._maxPitch=null==E?60:E,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new yc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new Du,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const o=new Su(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return g.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-g.wrap(o,-180,180)*Math.PI/180;var v,E,D,R,B,z,G,H,Q,J;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(v=new g.ARRAY_TYPE(4),g.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),E=this.rotationMatrix,R=this.angle,B=(D=this.rotationMatrix)[0],z=D[1],G=D[2],H=D[3],Q=Math.sin(R),J=Math.cos(R),E[0]=B*J+G*Q,E[1]=z*J+H*Q,E[2]=B*-Q+G*J,E[3]=z*-Q+H*J)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=g.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){const o=this.cameraToCenterDistance/this.worldSize,h=g.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(h+o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let E=0,D=0;for(let R=0;R<h.length;R++){const B=new g.pointGeometry(h[R][0]*this.width,v+h[R][1]*(this.height-v)),z=o.pointCoordinate(B);if(!z)continue;const G=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);E+=z[3]*G,D+=G}return 0===D?NaN:E/D}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,h=this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(this.center)),v=g.mercatorZfromAltitude(h,this.center.lat),E=this._mercatorZfromZoom(o),D=this._mercatorZfromZoom(this._maxZoom),R=Math.max(E-v,D);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let v;v=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const E=g.length(g.sub([],this._camera.position,v));return g.clamp(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!g.exactEquals(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const v=[o.position.x,o.position.y,o.position.z];g.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new Mh;return h.position=new g.MercatorCoordinate(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this._renderWorldCopies,h}_setCameraOrientation(o){if(!g.length$1(o))return!1;g.normalize$1(o,o);const h=g.transformQuat([],[0,0,-1],o),v=g.transformQuat([],[0,-1,0],o);if(v[2]<0)return!1;const E=Qa(h,v);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;o[2]=g.clamp(o[2],E/v,E/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,v){this._unmodified=!1,this._edgeInsets.interpolate(o,h,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new g.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const v=this.pointCoordinate(new g.pointGeometry(0,0)),E=this.pointCoordinate(new g.pointGeometry(this.width,0)),D=this.pointCoordinate(new g.pointGeometry(this.width,this.height)),R=this.pointCoordinate(new g.pointGeometry(0,this.height)),B=Math.floor(Math.min(v.x,E.x,D.x,R.x)),z=Math.floor(Math.max(v.x,E.x,D.x,R.x)),G=1;for(let H=B-G;H<=z+G;H++)0!==H&&h.push(new g.UnwrappedTileID(H,o))}return h}coveringTiles(o){let h=this.coveringZoomLevel(o);const v=h,E=this.elevation&&!o.isTerrainDEM;if(void 0!==o.minzoom&&h<o.minzoom)return[];void 0!==o.maxzoom&&h>o.maxzoom&&(h=o.maxzoom);const D=g.MercatorCoordinate.fromLngLat(this.center),R=1<<h,B=[R*D.x,R*D.y,0],z=Oa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),G=this.pointCoordinate(this.getCameraPoint()),H=R*g.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/g.mercatorZfromAltitude(1,this.center.lat),J=[R*G.x,R*G.y,Q],te=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),le=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?h:0,ce=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=o.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=Pe=>({aabb:new ds([Pe*R,0,_e],[(Pe+1)*R,R,ce]),zoom:0,x:0,y:0,wrap:Pe,fullyVisible:!1}),ue=[];let ge=[];const ve=h,Se=o.reparseOverscaled?v:h,de=Pe=>{if(!this._elevation||!Pe.tileID)return;const $e=this._elevation.getMinMaxForTile(Pe.tileID),xt=Pe.aabb;$e?(xt.min[2]=$e.min,xt.max[2]=$e.max,xt.center[2]=(xt.min[2]+xt.max[2])/2):(Pe.shouldSplit=tt(Pe),Pe.shouldSplit||(xt.min[2]=xt.max[2]=xt.center[2]=this._centerAltitude))},Fe=Pe=>Pe*Pe,We=Fe((Q-this._centerAltitude)*H),tt=Pe=>{if(Pe.zoom<le)return!0;if(Pe.zoom===ve)return!1;if(null!=Pe.shouldSplit)return Pe.shouldSplit;const $e=Pe.aabb.distanceX(J),xt=Pe.aabb.distanceY(J);let Dt=We;E&&(Dt=Fe(Pe.aabb.distanceZ(J)*H));const Et=$e*$e+xt*xt+Dt;return Et<Fe((1<<ve-Pe.zoom)*te*((ht,Mt)=>{if(Mt*Fe(.707)<ht)return 1;const bn=Math.sqrt(Mt/ht);return bn/(1.4144271570014144+(Math.pow(1.1,bn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Dt,We),Et))};if(this._renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)ue.push(se(-Pe)),ue.push(se(Pe));for(ue.push(se(0));ue.length>0;){const Pe=ue.pop(),$e=Pe.x,xt=Pe.y;let Dt=Pe.fullyVisible;if(!Dt){const Et=Pe.aabb.intersects(z);if(0===Et)continue;Dt=2===Et}if(Pe.zoom!==ve&&tt(Pe))for(let Et=0;Et<4;Et++){const ht=($e<<1)+Et%2,Mt=(xt<<1)+(Et>>1),bn={aabb:Pe.aabb.quadrant(Et),zoom:Pe.zoom+1,x:ht,y:Mt,wrap:Pe.wrap,fullyVisible:Dt,tileID:void 0,shouldSplit:void 0};E&&(bn.tileID=new g.OverscaledTileID(Pe.zoom+1===ve?Se:Pe.zoom+1,Pe.wrap,Pe.zoom+1,ht,Mt),de(bn)),ue.push(bn)}else{const Et=Pe.zoom===ve?Se:Pe.zoom;if(o.minzoom&&o.minzoom>Et)continue;const ht=B[0]-(.5+$e+(Pe.wrap<<Pe.zoom))*(1<<h-Pe.zoom),Mt=B[1]-.5-xt,bn=Pe.tileID?Pe.tileID:new g.OverscaledTileID(Et,Pe.wrap,Pe.zoom,$e,xt);ge.push({tileID:bn,distanceSq:ht*ht+Mt*Mt})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,$e=this.horizonLineFromTop();ge=ge.filter(xt=>{const Dt=[0,0,0,1],Et=[g.EXTENT,g.EXTENT,0,1],ht=this.calculateFogTileMatrix(xt.tileID.toUnwrapped());g.transformMat4(Dt,Dt,ht),g.transformMat4(Et,Et,ht);const Mt=g.getAABBPointSquareDist(Dt,Et);if(0===Mt)return!0;let bn=!1;const Yt=this._elevation;if(Yt&&Mt>Pe&&0!==$e){const Nr=this.calculateProjMatrix(xt.tileID.toUnwrapped());let xr;o.isTerrainDEM||(xr=Yt.getMinMaxForTile(xt.tileID)),xr||(xr={min:_e,max:ce});const an=g.furthestTileCorner(this.bearing),wn=[an[0]*g.EXTENT,an[1]*g.EXTENT,xr.max];g.transformMat4$1(wn,wn,Nr),bn=(1-wn[1])*this.height*.5<$e}return Mt<Pe||bn})}return ge.sort((Pe,$e)=>Pe.distanceSq-$e.distanceSq).map(Pe=>Pe.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=g.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.pointGeometry(g.mercatorXfromLng(o.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)}unproject(o){return new g.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(o,h){const v=this.pointCoordinate(h),E=this.pointCoordinate(this.centerPoint),D=this.locationCoordinate(o),R=new g.MercatorCoordinate(D.x-(v.x-E.x),D.y-(v.y-E.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(o){this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o){return this._coordinatePoint(this.locationCoordinate(o),!1)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o){return g.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o.toLngLat()}pointRayIntersection(o,h){const v=null!=h?h:this._centerAltitude,E=[o.x,o.y,0,1],D=[o.x,o.y,1,1];g.transformMat4(E,E,this.pixelMatrixInverse),g.transformMat4(D,D,this.pixelMatrixInverse);const R=D[3];g.scale$2(E,E,1/E[3]),g.scale$2(D,D,1/R);const B=E[2],z=D[2];return{p0:E,p1:D,t:B===z?0:(v-B)/(z-B)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],v=[o.x,o.y,1,1];return g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(v,v,this.pixelMatrixInverse),g.scale$2(h,h,1/h[3]),g.scale$2(v,v,1/v[3]),h[2]=g.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,v[2]=g.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,g.scale$2(h,h,1/this.worldSize),g.scale$2(v,v,1/this.worldSize),new su([h[0],h[1],h[2]],g.normalize([],g.sub([],v,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:v,t:E}=o,D=g.mercatorZfromAltitude(h[2],this._center.lat),R=g.mercatorZfromAltitude(v[2],this._center.lat);return new g.MercatorCoordinate(g.number(h[0],v[0],E)/this.worldSize,g.number(h[1],v[1],E)/this.worldSize,g.number(D,R,E))}pointCoordinate(o,h=this._centerAltitude){const v=this.horizonLineFromTop(!1),E=new g.pointGeometry(o.x,Math.max(v,o.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(E,h))}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const h=this.elevation;let v=this.elevation.pointCoordinate(o);if(v)return new g.MercatorCoordinate(v[0],v[1],v[2]);let E=0,D=this.horizonLineFromTop();if(o.y>D)return this.pointCoordinate(o);const R=.02*D,B=o.clone();for(let z=0;z<10&&D-E>R;z++){B.y=g.number(E,D,.66);const G=h.pointCoordinate(B);G?(D=B.y,v=G):E=B.y}return v?new g.MercatorCoordinate(v[0],v[1],v[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const h=this.horizonLineFromTop();return o.y<h}}_coordinatePoint(o,h){const v=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,E=[o.x*this.worldSize,o.y*this.worldSize,v+o.toAltitude(),1];return g.transformMat4(E,E,this.pixelMatrix),E[3]>0?new g.pointGeometry(E[0]/E[3],E[1]/E[3]):new g.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,h){const v=new g.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),E=new g.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),D=new g.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),R=new g.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let B=this.pointCoordinate(v,o),z=this.pointCoordinate(E,o);const G=this.pointCoordinate(D,h),H=this.pointCoordinate(R,h),Q=(J,te)=>(te.y-J.y)/(te.x-J.x);return B.y>1&&z.y>=0?B=new g.MercatorCoordinate((1-H.y)/Q(H,B)+H.x,1):B.y<0&&z.y<=1&&(B=new g.MercatorCoordinate(-H.y/Q(H,B)+H.x,0)),z.y>1&&B.y>=0?z=new g.MercatorCoordinate((1-G.y)/Q(G,z)+G.x,1):z.y<0&&B.y<=1&&(z=new g.MercatorCoordinate(-G.y/Q(G,z)+G.x,0)),(new g.LngLatBounds).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(G))}_getBounds3D(){const o=this.elevation,h=o.visibleDemTiles.reduce((v,E)=>{if(E.dem){const D=E.dem.tree;v.min=Math.min(v.min,D.minimums[0]),v.max=Math.max(v.max,D.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,v):v}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(o){if(o){const h=o.getEast(),v=o.getWest();this.lngRange=[v,h>v?h:h+360],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(o,h){const v=o.canonical,E=h/this.zoomScale(v.z),D=v.x+Math.pow(2,v.z)*o.wrap,R=g.identity(new Float64Array(16));return g.translate(R,R,[D*E,v.y*E,0]),g.scale$1(R,R,[E/g.EXTENT,E/g.EXTENT,1]),R}calculateFogTileMatrix(o){const h=o.key,v=this._fogTileMatrixCache;if(v[h])return v[h];const E=this.calculatePosMatrix(o,this.cameraWorldSize);return g.multiply(E,this.worldToFogMatrix,E),v[h]=new Float32Array(E),v[h]}calculateProjMatrix(o,h=!1){const v=o.key,E=h?this._alignedProjMatrixCache:this._projMatrixCache;if(E[v])return E[v];const D=this.calculatePosMatrix(o,this.worldSize);return g.multiply(D,h?this.alignedProjMatrix:this.projMatrix,D),E[v]=new Float32Array(D),E[v]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const h=this._camera.position,v=this._camera.forward();if(h[2]<=0||v[2]>=0)return;const E=g.mercatorZfromAltitude(1,this._center.lat);h[2]/=E,v[2]/=E,g.normalize(v,v);const D=o.raycast(h,v,o.exaggeration());if(D){const R=g.scaleAndAdd([],h,v,D),B=new g.MercatorCoordinate(R[0],R[1],g.mercatorZfromAltitude(R[2],g.latFromMercatorY(R[1]))),z=this._camera.position,G=B.z+g.length([B.x-z[0],B.y-z[1],B.z-z[2]]);this._cameraZoom=this._zoomFromMercatorZ(G),this._centerAltitude=B.toAltitude(),this._center=B.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const h=o.getAtPointOrZero(this._camera.mercatorPosition),v=this._minimumHeightOverTerrain()*Math.cos(g.degToRad(this._maxPitch)),E=g.mercatorZfromAltitude(h,this._center.lat),D=this._camera.position[2]-E;if(D<v){const R=g.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),B=this._camera.mercatorPosition,z=[R.x-B.x,R.y-B.y,R.z-B.z],G=g.length(z);z[2]-=v-D;const H=g.length(z);if(0===H)return;g.scale(z,z,G/H),this._camera.position=[R.x-z[0],R.y-z[1],R.z-z[2]],this._camera.orientation=Qa(z,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,h,v,E,D,R=1/0,B=-1/0;const z=this.size,G=this._unmodified;if(this.latRange){const te=this.latRange;R=g.mercatorYfromLat(te[1])*this.worldSize,B=g.mercatorYfromLat(te[0])*this.worldSize,v=B-R<z.y?z.y/(B-R):0}if(this.lngRange){const te=this.lngRange;o=g.mercatorXfromLng(te[0])*this.worldSize,h=g.mercatorXfromLng(te[1])*this.worldSize,E=h-o<z.x?z.x/(h-o):0}const H=this.point,Q=Math.max(E||0,v||0);if(Q)return this.center=this.unproject(new g.pointGeometry(E?(h+o)/2:H.x,v?(B+R)/2:H.y)),this.zoom+=this.scaleZoom(Q),this._unmodified=G,void(this._constraining=!1);if(this.latRange){const te=H.y,le=z.y/2;te-le<R&&(D=R+le),te+le>B&&(D=B-le)}let J=H.x;if(this.lngRange){const te=this.worldSize/2-(o+h)/2;J=(J+te+this.worldSize)%this.worldSize,o+=te,h+=te;const le=z.x/2;J-le<o&&(J=o+le),J+le>h&&(J=h-le),J-=te}J===H.x&&void 0===D||(this.center=this.unproject(new g.pointGeometry(J,void 0!==D?D:H.y))),this._constrainCameraAltitude(),this._unmodified=G,this._constraining=!1}_minZoomForBounds(){const o=(E,D)=>Math.log2(E/(this.tileSize*Math.abs(D[1]-D[0])));let h=0;if(this.latRange){const E=this.latRange;h=o(this.height,[g.mercatorYfromLat(E[0]),g.mercatorYfromLat(E[1])])}let v=0;if(this.lngRange){const E=this.lngRange;v=o(this.width,[g.mercatorXfromLng(E[0]),g.mercatorXfromLng(E[1])])}return Math.max(h,v)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=this.pixelsPerMeter;this._updateCameraState();const v=Math.PI/2+this._pitch,E=this.fovAboveCenter,D=this.elevation?this.elevation.getMinElevationBelowMSL()*h:0,R=(this._camera.position[2]*this.worldSize-D)/Math.cos(this._pitch),B=Math.sin(E)*R/Math.sin(g.clamp(Math.PI-v-E,.01,Math.PI-.01)),z=this.point,G=z.x,H=z.y,Q=Math.cos(Math.PI/2-this._pitch)*B+R,J=Math.min(1.01*Q,R*(1/this._horizonShift)),te=this.height/50,le=this._camera.getWorldToCamera(this.worldSize,h),ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,te,J);ce[8]=2*-o.x/this.width,ce[9]=2*o.y/this.height;let _e=g.mul$1([],ce,le);this.mercatorMatrix=g.scale$1([],_e,[this.worldSize,this.worldSize,this.worldSize/h]),this.projMatrix=_e,this.invProjMatrix=g.invert(new Float64Array(16),this.projMatrix);const se=new Float32Array(16);g.identity(se),g.scale$1(se,se,[1,-1,1]),g.rotateX(se,se,this._pitch),g.rotateZ(se,se,this.angle);const ue=g.perspective(new Float32Array(16),this._fov,this.width/this.height,te,J),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ue[8]=2*-o.x/this.width,ue[9]=2*(o.y+ge)/this.height,this.skyboxMatrix=g.multiply(se,ue,se);const ve=this.width%2/2,Se=this.height%2/2,de=Math.cos(this.angle),Fe=Math.sin(this.angle),We=G-Math.round(G)+de*ve+Fe*Se,tt=H-Math.round(H)+de*Se+Fe*ve,Pe=new Float64Array(_e);if(g.translate(Pe,Pe,[We>.5?We-1:We,tt>.5?tt-1:tt,0]),this.alignedProjMatrix=Pe,_e=g.create$1(),g.scale$1(_e,_e,[this.width/2,-this.height/2,1]),g.translate(_e,_e,[1,-1,0]),this.labelPlaneMatrix=_e,_e=g.create$1(),g.scale$1(_e,_e,[1,-1,1]),g.translate(_e,_e,[-1,-1,0]),g.scale$1(_e,_e,[2/this.width,2/this.height,1]),this.glCoordMatrix=_e,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),_e=g.invert(new Float64Array(16),this.pixelMatrix),!_e)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_e,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,h=this.cameraPixelsPerMeter,v=this._camera.position,E=1/this.height,D=[o,o,h];g.scale(D,D,E),g.scale(v,v,-1),g.multiply$1(v,v,D);const R=g.create$1();g.translate(R,R,v),g.scale$1(R,R,D),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,E)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const o=this._camera.forward(),h=this.cameraToCenterDistance,v=this.point,E=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-g.mercatorZfromAltitude(this._centerAltitude,this.center.lat),D=this.cameraToCenterDistance/E;this._camera.position=[v.x/this.worldSize-o[0]*h/D,v.y/this.worldSize-o[1]*h/D,g.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-o[2]*h/D]}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=o[2];let E=1;v>0&&(E=Math.min((h-this._camera.position[2])/v,1)),this._camera.position=g.scaleAndAdd([],this._camera.position,o,E),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:v,bearing:E}=this._camera.getPitchBearing(),D=g.mercatorZfromAltitude(this._centerAltitude,this.center.lat),R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(g.degToRad(this._maxPitch)),B=Math.max((o[2]-D)/Math.cos(v),R),z=this._zoomFromMercatorZ(B);g.scaleAndAdd(o,o,h,B),this._pitch=g.clamp(v,g.degToRad(this.minPitch),g.degToRad(this.maxPitch)),this.angle=g.wrap(E,-Math.PI,Math.PI),this._setZoom(g.clamp(z,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new g.MercatorCoordinate(o[0],o[1],o[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(o,h){const v=Math.min(o.x,h.x),E=Math.max(o.x,h.x),D=Math.min(o.y,h.y),R=Math.max(o.y,h.y);if(D<this.horizonLineFromTop(!1))return!0;const B=[new g.pointGeometry(v,D),new g.pointGeometry(E,R),new g.pointGeometry(v,R),new g.pointGeometry(E,D)],z=this._renderWorldCopies?-3:0,G=this._renderWorldCopies?4:1;for(const H of B){const Q=this.pointRayIntersection(H);if(Q.t<0)return!0;const J=this.rayIntersectionCoordinate(Q);if(J.x<z||J.y<0||J.x>G||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+g.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new g.pointGeometry(0,0),new g.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,h){const v=g.length(g.sub([],this._camera.position,o)),E=this._zoomFromMercatorZ(v)+h;return v-this._mercatorZfromZoom(E)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.pointGeometry(0,o))}}function $r(_,o){let h=!1,v=null;const E=()=>{v=null,h&&(_(),v=setTimeout(E,o),h=!1)};return()=>(h=!0,v||E(),v)}class om{constructor(o){this._hashName=o&&encodeURIComponent(o),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$r(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,E=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,E),R=Math.round(h.lng*D)/D,B=Math.round(h.lat*D)/D,z=this._map.getBearing(),G=this._map.getPitch();let H="";if(H+=o?`/${R}/${B}/${v}`:`${v}/${B}/${R}`,(z||G)&&(H+="/"+Math.round(10*z)/10),G&&(H+=`/${Math.round(G)}`),this._hashName){const Q=this._hashName;let J=!1;const te=g.window.location.hash.slice(1).split("&").map(le=>{const ce=le.split("=")[0];return ce===Q?(J=!0,`${ce}=${H}`):le}).filter(le=>le);return J||te.push(`${Q}=${H}`),`#${te.join("&")}`}return`#${H}`}_getCurrentHash(){const o=g.window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(h=v)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=g.window.location.href.replace(/(#.+)?$/,this.getHashString());g.window.history.replaceState(g.window.history.state,null,o)}}const Xa={linearity:.3,easing:g.bezier(0,0,.3,1)},Rd=g.extend({deceleration:2500,maxSpeed:1400},Xa),ri=g.extend({deceleration:20,maxSpeed:1400},Xa),lf=g.extend({deceleration:1e3,maxSpeed:360},Xa),Fd=g.extend({deceleration:1e3,maxSpeed:90},Xa);class vc{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=g.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new g.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:D}of this._inertiaBuffer)h.zoom+=D.zoomDelta||0,h.bearing+=D.bearingDelta||0,h.pitch+=D.pitchDelta||0,D.panDelta&&h.pan._add(D.panDelta),D.around&&(h.around=D.around),D.pinchAround&&(h.pinchAround=D.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(h.pan.mag()){const D=Mu(h.pan.mag(),v,g.extend({},Rd,o||{}));E.offset=h.pan.mult(D.amount/h.pan.mag()),E.center=this._map.transform.center,Wi(E,D)}if(h.zoom){const D=Mu(h.zoom,v,ri);E.zoom=this._map.transform.zoom+D.amount,Wi(E,D)}if(h.bearing){const D=Mu(h.bearing,v,lf);E.bearing=this._map.transform.bearing+g.clamp(D.amount,-179,179),Wi(E,D)}if(h.pitch){const D=Mu(h.pitch,v,Fd);E.pitch=this._map.transform.pitch+D.amount,Wi(E,D)}if(E.zoom||E.bearing){const D=void 0===h.pinchAround?h.around:h.pinchAround;E.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),g.extend(E,{noMoveStart:!0})}}function Wi(_,o){(!_.duration||_.duration<o.duration)&&(_.duration=o.duration,_.easing=o.easing)}function Mu(_,o,h){const{maxSpeed:v,linearity:E,deceleration:D}=h,R=g.clamp(_*E/(o/1e3),-v,v),B=Math.abs(R)/(D*E);return{easing:h.easing,duration:1e3*B,amount:R*(B/2)}}class Qi extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,v,E={}){const D=ot.mousePos(h.getCanvasContainer(),v),R=h.unproject(D);super(o,g.extend({point:D,lngLat:R,originalEvent:v},E)),this._defaultPrevented=!1,this.target=h}}class qs extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,v){const E="touchend"===o?v.changedTouches:v.touches,D=ot.touchPos(h.getCanvasContainer(),E),R=D.map(z=>h.unproject(z)),B=D.reduce((z,G,H,Q)=>z.add(G.div(Q.length)),new g.pointGeometry(0,0));super(o,{points:D,point:B,lngLats:R,lngLat:h.unproject(B),originalEvent:v}),this._defaultPrevented=!1}}class wo extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,v){super(o,{originalEvent:v}),this._defaultPrevented=!1}}class El{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new wo(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Qi(o.type,this._map,o))}mouseup(o){this._map.fire(new Qi(o.type,this._map,o))}preclick(o){const h=g.extend({},o);h.type="preclick",this._map.fire(new Qi(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Qi(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Qi(o.type,this._map,o))}mouseover(o){this._map.fire(new Qi(o.type,this._map,o))}mouseout(o){this._map.fire(new Qi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new qs(o.type,this._map,o))}touchmove(o){this._map.fire(new qs(o.type,this._map,o))}touchend(o){this._map.fire(new qs(o.type,this._map,o))}touchcancel(o){this._map.fire(new qs(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Th{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Qi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Qi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cf{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&0===o.button&&(ot.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const v=h;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const E=this._startPos;this._lastPos=v,this._box||(this._box=ot.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const D=Math.min(E.x,v.x),R=Math.max(E.x,v.x),B=Math.min(E.y,v.y),z=Math.max(E.y,v.y);this._map._requestDomTask(()=>{this._box&&(ot.setTransform(this._box,`translate(${D}px,${B}px)`),this._box.style.width=R-D+"px",this._box.style.height=z-B+"px")})}mouseupWindow(o,h){if(!this._active||0!==o.button)return;const v=this._startPos,E=h;if(this.reset(),ot.suppressClick(),v.x!==E.x||v.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:D=>D.fitScreenCoordinates(v,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ot.remove(this._box),this._box=null),ot.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new g.Event(o,{originalEvent:h}))}}function _s(_,o){const h={};for(let v=0;v<_.length;v++)h[_[v].identifier]=o[v];return h}class Od{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),v.length===this.numTouches&&(this.centroid=function(E){const D=new g.pointGeometry(0,0);for(const R of E)D._add(R);return D.div(E.length)}(h),this.touches=_s(v,h)))}touchmove(o,h,v){if(this.aborted||!this.centroid)return;const E=_s(v,h);for(const D in this.touches){const R=this.touches[D],B=E[D];(!B||B.dist(R)>30)&&(this.aborted=!0)}}touchend(o,h,v){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class xc{constructor(o){this.singleTap=new Od(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,v){this.singleTap.touchstart(o,h,v)}touchmove(o,h,v){this.singleTap.touchmove(o,h,v)}touchend(o,h,v){const E=this.singleTap.touchend(o,h,v);if(E){const D=o.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(E)<30;if(D&&R||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class nn{constructor(){this._zoomIn=new xc({numTouches:1,numTaps:2}),this._zoomOut=new xc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,v){this._zoomIn.touchstart(o,h,v),this._zoomOut.touchstart(o,h,v)}touchmove(o,h,v){this._zoomIn.touchmove(o,h,v),this._zoomOut.touchmove(o,h,v)}touchend(o,h,v){const E=this._zoomIn.touchend(o,h,v),D=this._zoomOut.touchend(o,h,v);return E?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(E)},{originalEvent:o})}):D?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(D)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Co={0:1,2:2};class Ld{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const v=ot.mouseButton(o);this._correctButton(o,v)&&(this._lastPoint=h,this._eventButton=v)}mousemoveWindow(o,h){const v=this._lastPoint;if(v)if(o.preventDefault(),function(E,D){const R=Co[D];return void 0===E.buttons||(E.buttons&R)!==R}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(v,h)}mouseupWindow(o){this._lastPoint&&ot.mouseButton(o)===this._eventButton&&(this._moved&&ot.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa extends Ld{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return 0===h&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class Bd extends Ld{_correctButton(o,h){return 0===h&&o.ctrlKey||2===h}_move(o,h){const v=.8*(h.x-o.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(o){o.preventDefault()}}class Zs extends Ld{_correctButton(o,h){return 0===h&&o.ctrlKey||2===h}_move(o,h){const v=-.5*(h.y-o.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(o){o.preventDefault()}}class bc{constructor(o){this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new g.pointGeometry(0,0)}touchstart(o,h,v){return this._calculateTransform(o,h,v)}touchmove(o,h,v){if(this._active&&!(v.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,h,v)}touchend(o,h,v){this._calculateTransform(o,h,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,v){v.length>0&&(this._active=!0);const E=_s(v,h),D=new g.pointGeometry(0,0),R=new g.pointGeometry(0,0);let B=0;for(const G in E){const H=E[G],Q=this._touches[G];Q&&(D._add(H),R._add(H.sub(Q)),B++,E[G]=H)}if(this._touches=E,B<this._minTouches||!R.mag())return;const z=R.div(B);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(B),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nd{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,h,v){return{}}touchstart(o,h,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,v){if(!this._firstTwoTouches)return;o.preventDefault();const[E,D]=this._firstTwoTouches,R=at(v,h,E),B=at(v,h,D);if(!R||!B)return;const z=this._aroundCenter?null:R.add(B).div(2);return this._move([R,B],z,o)}touchend(o,h,v){if(!this._firstTwoTouches)return;const[E,D]=this._firstTwoTouches,R=at(v,h,E),B=at(v,h,D);R&&B||(this._active&&ot.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function at(_,o,h){for(let v=0;v<_.length;v++)if(_[v].identifier===h)return o[v]}function qn(_,o){return Math.log(_/o)/Math.LN2}class Dl extends Nd{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const v=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(qn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qn(this._distance,v),pinchAround:h}}}function ii(_,o){return 180*_.angleWith(o)/Math.PI}class wc extends Nd{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const v=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ii(this._vector,v),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,v=ii(o,this._startVector);return Math.abs(v)<h}}function Xi(_){return Math.abs(_.y)>Math.abs(_.x)}class ys extends Nd{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,Xi(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,v){const E=o[0].sub(this._lastPoints[0]),D=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(E,D,v.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(E.y+D.y)/2*-.5}}gestureBeginsVertically(o,h,v){if(void 0!==this._valid)return this._valid;const E=o.mag()>=2,D=h.mag()>=2;if(!E&&!D)return;if(!E||!D)return void 0===this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const R=o.y>0==h.y>0;return Xi(o)&&Xi(h)&&R}}const Ih={panStep:100,bearingStep:15,pitchStep:10};class Sl{constructor(){const o=Ih;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,v=0,E=0,D=0,R=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?v=-1:(o.preventDefault(),D=-1);break;case 39:o.shiftKey?v=1:(o.preventDefault(),D=1);break;case 38:o.shiftKey?E=1:(o.preventDefault(),R=-1);break;case 40:o.shiftKey?E=-1:(o.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(v=0,E=0),{cameraAnimation:B=>{const z=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:Pt,zoom:h?Math.round(z)+h*(o.shiftKey?2:1):z,bearing:B.getBearing()+v*this._bearingStep,pitch:B.getPitch()+E*this._pitchStep,offset:[-D*this._panStep,-R*this._panStep],center:B.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pt(_){return _*(2-_)}const zd=4.000244140625;class Tu{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,g.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;let h=o.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const v=g.exported.now(),E=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==h&&h%zd==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(E*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ot.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,h=()=>o._terrainEnabled()?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const z="wheel"===this._type&&Math.abs(this._delta)>zd?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&0!==G&&(G=1/G);const H=h(),Q=Math.pow(2,H),J="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):Q;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(J*G))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:h(),E=this._startZoom,D=this._easing;let R,B=!1;if("wheel"===this._type&&E&&D){const z=Math.min((g.exported.now()-this._lastWheelEventTime)/200,1),G=D(z);R=g.number(E,v,G),z<1?this._frameId||(this._frameId=!0):B=!0}else R=v,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:R-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=g.ease;if(this._prevEase){const v=this._prevEase,E=(g.exported.now()-v.start)/v.duration,D=v.easing(E+.01)-v.easing(E),R=.27/Math.sqrt(D*D+1e-4)*.01,B=Math.sqrt(.0729-R*R);h=g.bezier(R,B,.25,1)}return this._prevEase={start:g.exported.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}}class Ya{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _i{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(o.shiftKey?-1:1),around:v.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vs{constructor(){this._tap=new xc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,h,v){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=h[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(o,h,v))}touchmove(o,h,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const E=h[0],D=E.y-this._swipePoint.y;return this._swipePoint=E,o.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(o,h,v)}touchend(o,h,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(o,h,v)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vd{constructor(o,h,v){this._el=o,this._mousePan=h,this._touchPan=v}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ml{constructor(o,h,v){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ws{constructor(o,h,v,E){this._el=o,this._touchZoom=h,this._touchRotate=v,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Iu=_=>_.zoom||_.drag||_.pitch||_.rotate;class Ud extends g.Event{}class uf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const v=g.sub([],h,o);this.radius=g.length(v[2]<0?g.div([],v,this.constants):[v[0],v[1],0])}projectRay(o){g.div(o,o,this.constants),g.normalize(o,o),g.mul$2(o,o,this.constants);const h=g.scale([],o,this.radius);if(h[2]>0){const v=g.scale([],[0,0,1],g.dot(h,[0,0,1])),E=g.scale([],g.normalize([],[h[0],h[1],0]),this.radius),D=g.add([],h,g.scale([],g.sub([],g.add([],E,v),h),2));h[0]=D[0],h[1]=D[1]}return h}}function Tl(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class ku{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vc(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new uf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[g.window,"blur",void 0]];for(const[E,D,R]of this._listeners)ot.addEventListener(E,D,E===g.window.document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[o,h,v]of this._listeners)ot.removeEventListener(o,h,o===g.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(o){const h=this._map,v=h.getCanvasContainer();this._add("mapEvent",new El(h,o));const E=h.boxZoom=new cf(h,o);this._add("boxZoom",E);const D=new nn,R=new _i;h.doubleClickZoom=new Ya(R,D),this._add("tapZoom",D),this._add("clickZoom",R);const B=new vs;this._add("tapDragZoom",B);const z=h.touchPitch=new ys;this._add("touchPitch",z);const G=new Bd(o),H=new Zs(o);h.dragRotate=new Ml(o,G,H),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Q=new wa(o),J=new bc(o);h.dragPan=new Vd(v,Q,J),this._add("mousePan",Q),this._add("touchPan",J,["touchZoom","touchRotate"]);const te=new wc,le=new Dl;h.touchZoomRotate=new Ws(v,le,te,B),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Th(h));const ce=h.scrollZoom=new Tu(h,this);this._add("scrollZoom",ce,["mousePan"]);const _e=h.keyboard=new Sl;this._add("keyboard",_e);for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[se]&&h[se].enable(o[se])}_add(o,h,v){this._handlers.push({handlerName:o,handler:h,allowed:v}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Iu(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,h,v){for(const E in o)if(E!==v&&(!h||h.indexOf(E)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const v of o)this._el.contains(v.target)&&h.push(v);return h}handleEvent(o,h){this._updatingCamera=!0;const v="renderFrame"===o.type,E=v?void 0:o,D={needsRenderFrame:!1},R={},B={},z=o.touches?this._getMapTouches(o.touches):void 0,G=z?ot.touchPos(this._el,z):v?void 0:ot.mousePos(this._el,o);for(const{handlerName:J,handler:te,allowed:le}of this._handlers){if(!te.isEnabled())continue;let ce;this._blockedByActive(B,le,J)?te.reset():te[h||o.type]&&(ce=te[h||o.type](o,G,z),this.mergeHandlerResult(D,R,ce,J,E),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||te.isActive())&&(B[J]=te)}const H={};for(const J in this._previousActiveHandlers)B[J]||(H[J]=E);this._previousActiveHandlers=B,(Object.keys(H).length||Tl(D))&&(this._changes.push([D,R,H]),this._triggerRenderFrame()),(Object.keys(B).length||Tl(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=D;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(o,h,v,E,D){if(!v)return;g.extend(o,v);const R={handlerName:E,originalEvent:v.originalEvent||D};void 0!==v.zoomDelta&&(h.zoom=R),void 0!==v.panDelta&&(h.drag=R),void 0!==v.pitchDelta&&(h.pitch=R),void 0!==v.bearingDelta&&(h.rotate=R)}_applyChanges(){const o={},h={},v={};for(const[E,D,R]of this._changes)E.panDelta&&(o.panDelta=(o.panDelta||new g.pointGeometry(0,0))._add(E.panDelta)),E.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+E.pitchDelta),void 0!==E.around&&(o.around=E.around),void 0!==E.aroundCoord&&(o.aroundCoord=E.aroundCoord),void 0!==E.pinchAround&&(o.pinchAround=E.pinchAround),E.noInertia&&(o.noInertia=E.noInertia),g.extend(h,D),g.extend(v,R);this._updateMapTransform(o,h,v),this._changes=[]}_updateMapTransform(o,h,v){const E=this._map,D=E.transform,R=ue=>[ue.x,ue.y,ue.z];if((ue=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Tl(o)){const ue=D.zoom;D.cameraElevationReference="sea",D.recenterOnTerrain(),D.cameraElevationReference="ground",ue!==D.zoom&&this._map._update(!0)}if(!Tl(o))return this._fireEvents(h,v,!0);let{panDelta:B,zoomDelta:z,bearingDelta:G,pitchDelta:H,around:Q,aroundCoord:J,pinchAround:te}=o;void 0!==te&&(Q=te),(ue=>h.drag&&!this._eventsInProgress.drag)()&&Q&&(this._dragOrigin=R(D.pointCoordinate3D(Q)),this._trackingEllipsoid.setup(D._camera.position,this._dragOrigin)),D.cameraElevationReference="sea",E._stop(!0),Q=Q||E.transform.centerPoint,G&&(D.bearing+=G),H&&(D.pitch+=H),D._updateCameraState();const le=[0,0,0];if(B){const ue=D.screenPointToMercatorRay(Q),ge=D.screenPointToMercatorRay(Q.sub(B)),ve=this._trackingEllipsoid.projectRay(ue.dir),Se=this._trackingEllipsoid.projectRay(ge.dir);le[0]=Se[0]-ve[0],le[1]=Se[1]-ve[1]}const ce=D.zoom,_e=[0,0,0];if(z){const ue=R(J||D.pointCoordinate3D(Q)),ge={dir:g.normalize([],g.sub([],ue,D._camera.position))},ve=D.screenPointToMercatorRay(D.centerPoint);if(ge.dir[2]<0){const Se=g.altitudeFromMercatorZ(ue[2],ue[1]),de=D.rayIntersectionCoordinate(D.pointRayIntersection(D.centerPoint,Se)),Fe=D.zoomDeltaToMovement(R(de),z)*(ve.dir[2]/ge.dir[2]);g.scale(_e,ge.dir,Fe)}else if(D._terrainEnabled()){const Se=D.zoomDeltaToMovement(ue,z);g.scale(_e,ge.dir,Se)}}const se=g.add(le,le,_e);D._translateCameraConstrained(se),z&&Math.abs(D.zoom-ce)>1e-4&&D.recenterOnTerrain(),D.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,v,!0)}_fireEvents(o,h,v){const E=Iu(this._eventsInProgress),D=Iu(o),R={};for(const H in o){const{originalEvent:Q}=o[H];this._eventsInProgress[H]||(R[`${H}start`]=Q),this._eventsInProgress[H]=o[H]}!E&&D&&this._fireEvent("movestart",D.originalEvent);for(const H in R)this._fireEvent(H,R[H]);D&&this._fireEvent("move",D.originalEvent);for(const H in o){const{originalEvent:Q}=o[H];this._fireEvent(H,Q)}const B={};let z;for(const H in this._eventsInProgress){const{handlerName:Q,originalEvent:J}=this._eventsInProgress[H];this._handlersById[Q].isActive()||(delete this._eventsInProgress[H],z=h[Q]||J,B[`${H}end`]=z)}for(const H in B)this._fireEvent(H,B[H]);const G=Iu(this._eventsInProgress);if(v&&(E||D)&&!G){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=J=>0!==J&&-this._bearingSnap<J&&J<this._bearingSnap;H?(Q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:z})):(this._map.fire(new g.Event("moveend",{originalEvent:z})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new g.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Ud("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Cc extends g.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}getCenter(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,v){return o=g.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,g.extend({offset:o},h),v)}panTo(o,h,v){return this.easeTo(g.extend({center:o},h),v)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,v){return this.easeTo(g.extend({zoom:o},h),v)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,v){return this.easeTo(g.extend({bearing:o},h),v)}resetNorth(o,h){return this.rotateTo(0,g.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=g.LngLatBounds.convert(o);const v=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),v,h)}_extendCameraOptions(o){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=g.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const v=o.padding;o.padding={top:v,bottom:v,right:v,left:v}}return o.padding=g.extend(h,o.padding),o}_cameraForBoxAndBearing(o,h,v,E){const D=this._extendCameraOptions(E),R=this.transform,B=R.padding,z=R.project(g.LngLat.convert(o)),G=R.project(g.LngLat.convert(h)),H=z.rotate(-g.degToRad(v)),Q=G.rotate(-g.degToRad(v)),J=new g.pointGeometry(Math.max(H.x,Q.x),Math.max(H.y,Q.y)),te=new g.pointGeometry(Math.min(H.x,Q.x),Math.min(H.y,Q.y)),le=J.sub(te),ce=(R.width-(B.left+B.right+D.padding.left+D.padding.right))/le.x,_e=(R.height-(B.top+B.bottom+D.padding.top+D.padding.bottom))/le.y;if(_e<0||ce<0)return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(R.scaleZoom(R.scale*Math.min(ce,_e)),D.maxZoom),ue="number"==typeof D.offset.x?new g.pointGeometry(D.offset.x,D.offset.y):g.pointGeometry.convert(D.offset),ge=new g.pointGeometry((D.padding.left-D.padding.right)/2,(D.padding.top-D.padding.bottom)/2).rotate(v*Math.PI/180),ve=ue.add(ge).mult(R.scale/R.zoomScale(se));return{center:R.unproject(z.add(G).div(2).sub(ve)),zoom:se,bearing:v}}_cameraForBox(o,h,v,E,D){const R=this._extendCameraOptions(D);v=v||0,E=E||0,o=g.LngLat.convert(o),h=g.LngLat.convert(h);const B=this.transform.clone();B.padding=R.padding;const z=this.getFreeCameraOptions(),G=new g.LngLat(.5*(o.lng+h.lng),.5*(o.lat+h.lat)),H=.5*(v+E);if(B._camera.position[2]<g.mercatorZfromAltitude(H,G.lat))return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");z.lookAtPoint(G),B.setFreeCameraOptions(z);const Q=g.MercatorCoordinate.fromLngLat(o),J=g.MercatorCoordinate.fromLngLat(h),te=B.pointRayIntersection(B.centerPoint,H),le=[(ce=B.rayIntersectionCoordinate(te)).x,ce.y,ce.z];var ce;const _e=B.screenPointToMercatorRay(B.centerPoint);let se,ue=0;do{const ge=Math.floor(B.zoom),ve=1<<ge,Se=Math.min(ve*Q.x,ve*J.x),de=Math.min(ve*Q.y,ve*J.y),Fe=Math.max(ve*Q.x,ve*J.x),We=Math.max(ve*Q.y,ve*J.y),tt=new ds([Se,de,v],[Fe,We,E]),Pe=Oa.fromInvProjectionMatrix(B.invProjMatrix,B.worldSize,ge);if(2!==tt.intersects(Pe)){se&&(B._camera.position=g.scaleAndAdd([],B._camera.position,_e.dir,-se),B._updateStateFromCamera());break}const $e=g.sub([],B._camera.position,le);se=.5*g.length($e),B._camera.position=g.scaleAndAdd([],B._camera.position,_e.dir,se);try{B._updateStateFromCamera()}catch(xt){return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ue<10);return{center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch}}fitBounds(o,h,v){return this._fitInternal(this.cameraForBounds(o,h),h,v)}_raycastElevationBox(o,h){const v=this.transform.elevation;if(!v)return;const E=new g.pointGeometry(o.x,h.y),D=new g.pointGeometry(h.x,o.y),R=v.pointCoordinate(o);if(!R)return;const B=v.pointCoordinate(h);if(!B)return;const z=v.pointCoordinate(E);if(!z)return;const G=v.pointCoordinate(D);if(!G)return;const H=new g.MercatorCoordinate(R[0],R[1]).toLngLat(),Q=new g.MercatorCoordinate(B[0],B[1]).toLngLat(),J=new g.MercatorCoordinate(z[0],z[1]).toLngLat(),te=new g.MercatorCoordinate(G[0],G[1]).toLngLat(),le=Math.min(H.lng,Math.min(Q.lng,Math.min(J.lng,te.lng))),ce=Math.min(H.lat,Math.min(Q.lat,Math.min(J.lat,te.lat))),_e=Math.max(H.lng,Math.max(Q.lng,Math.max(J.lng,te.lng))),se=Math.max(H.lat,Math.max(Q.lat,Math.max(J.lat,te.lat))),ue=Math.min(R[3],Math.min(B[3],Math.min(z[3],G[3]))),ge=Math.max(R[3],Math.max(B[3],Math.max(z[3],G[3])));return{minLngLat:new g.LngLat(le,ce),maxLngLat:new g.LngLat(_e,se),minAltitude:ue,maxAltitude:ge}}fitScreenCoordinates(o,h,v,E,D){let R,B,z,G;const H=g.pointGeometry.convert(o),Q=g.pointGeometry.convert(h),J=this._raycastElevationBox(H,Q);if(J)R=J.minLngLat,B=J.maxLngLat,z=J.minAltitude,G=J.maxAltitude;else{if(this.transform.isCornerOffEdge(H,Q))return this;R=this.transform.pointLocation(H),B=this.transform.pointLocation(Q)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(g.pointGeometry.convert(o)),this.transform.pointLocation(g.pointGeometry.convert(h)),v,E):this._cameraForBox(R,B,z,G,E),E,D)}_fitInternal(o,h,v){return o?(delete(h=g.extend(o,h)).padding,h.linear?this.easeTo(h,v):this.flyTo(h,v)):this}jumpTo(o,h){this.stop();const v=this.transform;let E=!1,D=!1,R=!1;return"zoom"in o&&v.zoom!==+o.zoom&&(E=!0,v.zoom=+o.zoom),void 0!==o.center&&(v.center=g.LngLat.convert(o.center)),"bearing"in o&&v.bearing!==+o.bearing&&(D=!0,v.bearing=+o.bearing),"pitch"in o&&v.pitch!==+o.pitch&&(R=!0,v.pitch=+o.pitch),null==o.padding||v.isPaddingEqual(o.padding)||(v.padding=o.padding),this.fire(new g.Event("movestart",h)).fire(new g.Event("move",h)),E&&this.fire(new g.Event("zoomstart",h)).fire(new g.Event("zoom",h)).fire(new g.Event("zoomend",h)),D&&this.fire(new g.Event("rotatestart",h)).fire(new g.Event("rotate",h)).fire(new g.Event("rotateend",h)),R&&this.fire(new g.Event("pitchstart",h)).fire(new g.Event("pitch",h)).fire(new g.Event("pitchend",h)),this.fire(new g.Event("moveend",h))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){this.stop();const v=this.transform,E=v.zoom,D=v.pitch,R=v.bearing;v.setFreeCameraOptions(o);const B=E!==v.zoom,z=D!==v.pitch,G=R!==v.bearing;return this.fire(new g.Event("movestart",h)).fire(new g.Event("move",h)),B&&this.fire(new g.Event("zoomstart",h)).fire(new g.Event("zoom",h)).fire(new g.Event("zoomend",h)),G&&this.fire(new g.Event("rotatestart",h)).fire(new g.Event("rotate",h)).fire(new g.Event("rotateend",h)),z&&this.fire(new g.Event("pitchstart",h)).fire(new g.Event("pitch",h)).fire(new g.Event("pitchend",h)),this.fire(new g.Event("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),(!1===(o=g.extend({offset:[0,0],duration:500,easing:g.ease},o)).animate||!o.essential&&g.exported.prefersReducedMotion)&&(o.duration=0);const v=this.transform,E=this.getZoom(),D=this.getBearing(),R=this.getPitch(),B=this.getPadding(),z="zoom"in o?+o.zoom:E,G="bearing"in o?this._normalizeBearing(o.bearing,D):D,H="pitch"in o?+o.pitch:R,Q="padding"in o?o.padding:v.padding,J=g.pointGeometry.convert(o.offset);let te=v.centerPoint.add(J);const le=v.pointLocation(te),ce=g.LngLat.convert(o.center||le);this._normalizeCenter(ce);const _e=v.project(le),se=v.project(ce).sub(_e),ue=v.zoomScale(z-E);let ge,ve;o.around&&(ge=g.LngLat.convert(o.around),ve=v.locationPoint(ge));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||z!==E,this._rotating=this._rotating||D!==G,this._pitching=this._pitching||H!==R,this._padding=!v.isPaddingEqual(Q),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Se),this._ease(de=>{if(this._zooming&&(v.zoom=g.number(E,z,de)),this._rotating&&(v.bearing=g.number(D,G,de)),this._pitching&&(v.pitch=g.number(R,H,de)),this._padding&&(v.interpolatePadding(B,Q,de),te=v.centerPoint.add(J)),ge)v.setLocationAtPoint(ge,ve);else{const Fe=v.zoomScale(v.zoom-E),We=z>E?Math.min(2,ue):Math.max(.5,ue),tt=Math.pow(We,1-de),Pe=v.unproject(_e.add(se.mult(de*tt)).mult(Fe));v.setLocationAtPoint(v.renderWorldCopies?Pe.wrap():Pe,te)}this._fireMoveEvents(h)},de=>{v.recenterOnTerrain(),this._afterEase(h,de)},o),this}_prepareEase(o,h,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||v.moving||this.fire(new g.Event("movestart",o)),this._zooming&&!v.zooming&&this.fire(new g.Event("zoomstart",o)),this._rotating&&!v.rotating&&this.fire(new g.Event("rotatestart",o)),this._pitching&&!v.pitching&&this.fire(new g.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new g.Event("move",o)),this._zooming&&this.fire(new g.Event("zoom",o)),this._rotating&&this.fire(new g.Event("rotate",o)),this._pitching&&this.fire(new g.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.transform.cameraElevationReference="ground";const v=this._zooming,E=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new g.Event("zoomend",o)),E&&this.fire(new g.Event("rotateend",o)),D&&this.fire(new g.Event("pitchend",o)),this.fire(new g.Event("moveend",o))}flyTo(o,h){if(!o.essential&&g.exported.prefersReducedMotion){const ht=g.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ht,h)}this.stop(),o=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},o);const v=this.transform,E=this.getZoom(),D=this.getBearing(),R=this.getPitch(),B=this.getPadding(),z="zoom"in o?g.clamp(+o.zoom,v.minZoom,v.maxZoom):E,G="bearing"in o?this._normalizeBearing(o.bearing,D):D,H="pitch"in o?+o.pitch:R,Q="padding"in o?o.padding:v.padding,J=v.zoomScale(z-E),te=g.pointGeometry.convert(o.offset);let le=v.centerPoint.add(te);const ce=v.pointLocation(le),_e=g.LngLat.convert(o.center||ce);this._normalizeCenter(_e);const se=v.project(ce),ue=v.project(_e).sub(se);let ge=o.curve;const ve=Math.max(v.width,v.height),Se=ve/J,de=ue.mag();if("minZoom"in o){const ht=g.clamp(Math.min(o.minZoom,E,z),v.minZoom,v.maxZoom),Mt=ve/v.zoomScale(ht-E);ge=Math.sqrt(Mt/de*2)}const Fe=ge*ge;function We(ht){const Mt=(Se*Se-ve*ve+(ht?-1:1)*Fe*Fe*de*de)/(2*(ht?Se:ve)*Fe*de);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function tt(ht){return(Math.exp(ht)-Math.exp(-ht))/2}function Pe(ht){return(Math.exp(ht)+Math.exp(-ht))/2}const $e=We(0);let xt=function(ht){return Pe($e)/Pe($e+ge*ht)},Dt=function(ht){return ve*((Pe($e)*(tt(Mt=$e+ge*ht)/Pe(Mt))-tt($e))/Fe)/de;var Mt},Et=(We(1)-$e)/ge;if(Math.abs(de)<1e-6||!isFinite(Et)){if(Math.abs(ve-Se)<1e-6)return this.easeTo(o,h);const ht=Se<ve?-1:1;Et=Math.abs(Math.log(Se/ve))/ge,Dt=function(){return 0},xt=function(Mt){return Math.exp(ht*ge*Mt)}}return o.duration="duration"in o?+o.duration:1e3*Et/("screenSpeed"in o?+o.screenSpeed/ge:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=D!==G,this._pitching=H!==R,this._padding=!v.isPaddingEqual(Q),this._prepareEase(h,!1),this._ease(ht=>{const Mt=ht*Et,bn=1/xt(Mt);v.zoom=1===ht?z:E+v.scaleZoom(bn),this._rotating&&(v.bearing=g.number(D,G,ht)),this._pitching&&(v.pitch=g.number(R,H,ht)),this._padding&&(v.interpolatePadding(B,Q,ht),le=v.centerPoint.add(te));const Yt=1===ht?_e:v.unproject(se.add(ue.mult(Dt(Mt))).mult(bn));v.setLocationAtPoint(v.renderWorldCopies?Yt.wrap():Yt,le),v._updateCenterElevation(),this._fireMoveEvents(h)},()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,h)}if(!o){const v=this.handlers;v&&v.stop(!1)}return this}_ease(o,h,v){!1===v.animate||0===v.duration?(o(1),h()):(this._easeStart=g.exported.now(),this._easeOptions=v,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((g.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=g.wrap(o,-180,180);const v=Math.abs(o-h);return Math.abs(o-360-h)<v&&(o-=360),Math.abs(o+360-h)<v&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const v=o.lng-h.center.lng;o.lng+=v>180?-360:v<-180?360:0}}class kh{constructor(o={}){this.options=o,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact;return this._map=o,this._container=ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ot.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ot.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ot.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const v=this._map._getUIString(`AttributionControl.${h}`);o.title=v,o.setAttribute("aria-label",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(o){const v=h.reduce((E,D,R)=>(D.value&&(E+=`${D.key}=${D.value}${R<h.length-1?"&":""}`),E),"?");o.href=`${g.config.FEEDBACK_URL}/${v}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(E=>"string"!=typeof E?"":E)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const h=this._map.style._sourceCaches;for(const E in h){const D=h[E];if(D.used){const R=D.getSource();R.attribution&&o.indexOf(R.attribution)<0&&o.push(R.attribution)}}o.sort((E,D)=>E.length-D.length),o=o.filter((E,D)=>{for(let R=D+1;R<o.length;R++)if(o[R].indexOf(E)>=0)return!1;return!0});const v=o.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,o.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Pu{constructor(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=ot.create("div","mapboxgl-ctrl");const h=ot.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ot.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const h in o){const v=o[h].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class jd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,v=h?this._queue.concat(h):this._queue;for(const E of v)if(E.id===o)return void(E.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const v of h)if(!v.cancelled&&(v.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ph(_,o,h){if(_=new g.LngLat(_.lng,_.lat),o){const v=new g.LngLat(_.lng-360,_.lat),E=new g.LngLat(_.lng+360,_.lat),D=360*Math.ceil(Math.abs(_.lng-h.center.lng)/360),R=h.locationPoint(_).distSqr(o),B=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint(v).distSqr(o)<R&&(B||Math.abs(v.lng-h.center.lng)<D)?_=v:h.locationPoint(E).distSqr(o)<R&&(B||Math.abs(E.lng-h.center.lng)<D)&&(_=E)}for(;Math.abs(_.lng-h.center.lng)>180;){const v=h.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;_.lng>h.center.lng?_.lng-=360:_.lng+=360}return _}const Il={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ru extends g.Evented{constructor(o,h){if(super(),(o instanceof g.window.HTMLElement||h)&&(o=g.extend({element:o},h)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=g.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ot.create("div"),this._element.setAttribute("aria-label","Map marker");const E=ot.createNS("http://www.w3.org/2000/svg","svg"),D=41,R=27;E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height",`${D}px`),E.setAttributeNS(null,"width",`${R}px`),E.setAttributeNS(null,"viewBox",`0 0 ${R} ${D}`);const B=ot.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"stroke","none"),B.setAttributeNS(null,"stroke-width","1"),B.setAttributeNS(null,"fill","none"),B.setAttributeNS(null,"fill-rule","evenodd");const z=ot.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill-rule","nonzero");const G=ot.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(3.0, 29.0)"),G.setAttributeNS(null,"fill","#000000");const H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of H){const ve=ot.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",ge.rx),ve.setAttributeNS(null,"ry",ge.ry),G.appendChild(ve)}const Q=ot.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const J=ot.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(J);const te=ot.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const le=ot.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(le);const ce=ot.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ce.setAttributeNS(null,"fill","#FFFFFF");const _e=ot.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=ot.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const ue=ot.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#FFFFFF"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962"),_e.appendChild(se),_e.appendChild(ue),z.appendChild(G),z.appendChild(Q),z.appendChild(te),z.appendChild(ce),z.appendChild(_e),E.appendChild(z),E.setAttributeNS(null,"height",D*this._scale+"px"),E.setAttributeNS(null,"width",R*this._scale+"px"),this._element.appendChild(E),this._offset=g.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const v=this._element.classList;for(const E in Il)v.remove(`mapboxgl-marker-anchor-${E}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ot.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=g.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const h=38.1,v=13.5,E=Math.sqrt(Math.pow(v,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-h],"bottom-left":[E,-1*(h-v+E)],"bottom-right":[-E,-1*(h-v+E)],left:[v,-1*(h-v)],right:[-v,-1*(h-v)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const h=o.code,v=o.charCode||o.keyCode;"Space"!==h&&"Enter"!==h&&32!==v&&13!==v||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,v=this._element;this._popup&&(h===v||v.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const h=this._map.unproject(o);let v=!1;if(this._map.getTerrain()){const D=this._map.getFreeCameraOptions();if(D.position){const R=D.position.toLngLat();v=R.distanceTo(h)<.9*R.distanceTo(this._lngLat)}}const E=(1-this._map._queryFogOpacity(h))*(v?.2:1);this._element.style.opacity=`${E}`,this._popup&&this._popup._setOpacity(`${E}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const h=this._map.transform;return!!o&&o.x>=0&&o.x<h.width&&o.y>=0&&o.y<h.height}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ph(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let h="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?h=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?v="rotateX(0deg)":"map"===this._pitchAlignment&&(v=`rotateX(${this._map.getPitch()}deg)`),o&&"moveend"!==o.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ot.setTransform(this._element,`${Il[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${h}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,h=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&h._rotate(o.angle),"map"===this._pitchAlignment&&(h.y*=Math.cos(o._pitch)),h}getOffset(){return this._offset}setOffset(o){return this._offset=g.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new g.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class $d{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=g.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,v){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+v}}const Rh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Ec,HTMLElement:Fu,ImageBitmap:kl}=g.window,hf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function yi(_){_.parentNode&&_.parentNode.removeChild(_)}const Ca={showCompass:!0,showZoom:!0,visualizePitch:!1};class Br{constructor(o,h,v=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Bd({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,v&&(this.mousePitch=new Zs({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ot.addEventListener(h,"mousedown",this.mousedown),ot.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),ot.addEventListener(h,"touchmove",this.touchmove),ot.addEventListener(h,"touchend",this.touchend),ot.addEventListener(h,"touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),ot.disableDrag()}move(o,h){const v=this.map,E=this.mouseRotate.mousemoveWindow(o,h);if(E&&E.bearingDelta&&v.setBearing(v.getBearing()+E.bearingDelta),this.mousePitch){const D=this.mousePitch.mousemoveWindow(o,h);D&&D.pitchDelta&&v.setPitch(v.getPitch()+D.pitchDelta)}}off(){const o=this.element;ot.removeEventListener(o,"mousedown",this.mousedown),ot.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),ot.removeEventListener(o,"touchmove",this.touchmove),ot.removeEventListener(o,"touchend",this.touchend),ot.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){ot.enableDrag(),ot.removeEventListener(g.window,"mousemove",this.mousemove),ot.removeEventListener(g.window,"mouseup",this.mouseup)}mousedown(o){this.down(g.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ot.mousePos(this.element,o)),ot.addEventListener(g.window,"mousemove",this.mousemove),ot.addEventListener(g.window,"mouseup",this.mouseup)}mousemove(o){this.move(o,ot.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=ot.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=ot.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const df={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Ka,Dc=0,Pl=!1;const sm={maxWidth:100,unit:"metric"};function Af(_,o,h){const v=h&&h.maxWidth||100,E=_._container.getBoundingClientRect().height/2,D=_.unproject([0,E]),R=_.unproject([v,E]),B=D.distanceTo(R);if(h&&"imperial"===h.unit){const z=3.2808*B;z>5280?Qs(o,v,z/5280,_._getUIString("ScaleControl.Miles"),_):Qs(o,v,z,_._getUIString("ScaleControl.Feet"),_)}else h&&"nautical"===h.unit?Qs(o,v,B/1852,_._getUIString("ScaleControl.NauticalMiles"),_):B>=1e3?Qs(o,v,B/1e3,_._getUIString("ScaleControl.Kilometers"),_):Qs(o,v,B,_._getUIString("ScaleControl.Meters"),_)}function Qs(_,o,h,v,E){const D=function(B){const z=Math.pow(10,`${Math.floor(B)}`.length-1);let G=B/z;return G=G>=10?10:G>=5?5:G>=3?3:G>=2?2:G>=1?1:function(H){const Q=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*Q)/Q}(G),z*G}(h),R=D/h;E._requestDomTask(()=>{_.style.width=o*R+"px",_.innerHTML=`${D}&nbsp;${v}`})}const Ou={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Sc={version:g.version,supported:yo,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:class extends Cc{constructor(_){if(null!=(_=g.extend({},hf,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Su(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._renderTaskQueue=new jd,this._domRenderTaskQueue=new jd,this._controls=[],this._markers=[],this._mapId=g.uniqueId(),this._locale=g.extend({},Rh,_.locale),this._clickTolerance=_.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new $d(0),this._requestManager=new g.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=g.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof Fu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==g.window&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1),g.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ku(this,_),this._hash=_.hash&&new om("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,g.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.attributionControl&&this.addControl(new kh({customAttribution:_.customAttribution})),this._logoControl=new Pu,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new g.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new g.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(_,o){if(void 0===o&&(o=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[o];return-1!==o.indexOf("bottom")?v.insertBefore(h,v.firstChild):v.appendChild(h),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(_);return o>-1&&this._controls.splice(o,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){const[o,h]=this._containerDimensions();if(o===this.transform.width&&h===this.transform.height)return this;this._resizeCanvas(o,h),this.transform.resize(o,h),this.painter.resize(Math.ceil(o),Math.ceil(h));const v=!this._moving;return v&&this.fire(new g.Event("movestart",_)).fire(new g.Event("move",_)),this.fire(new g.Event("resize",_)),v&&this.fire(new g.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(g.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=null==_?-2:_)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=null==_?22:_)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=null==_?0:_)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=null==_?85:_)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint3D(g.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(g.pointGeometry.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(_,o,h){if("mouseenter"===_||"mouseover"===_){let v=!1;return{layer:o,listener:h,delegates:{mousemove:D=>{const R=this.getLayer(o)?this.queryRenderedFeatures(D.point,{layers:[o]}):[];R.length?v||(v=!0,h.call(this,new Qi(_,this,D.originalEvent,{features:R}))):v=!1},mouseout:()=>{v=!1}}}}if("mouseleave"===_||"mouseout"===_){let v=!1;return{layer:o,listener:h,delegates:{mousemove:R=>{(this.getLayer(o)?this.queryRenderedFeatures(R.point,{layers:[o]}):[]).length?v=!0:v&&(v=!1,h.call(this,new Qi(_,this,R.originalEvent)))},mouseout:R=>{v&&(v=!1,h.call(this,new Qi(_,this,R.originalEvent)))}}}}{const v=E=>{const D=this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[];D.length&&(E.features=D,h.call(this,E),delete E.features)};return{layer:o,listener:h,delegates:{[_]:v}}}}on(_,o,h){if(void 0===h)return super.on(_,o);const v=this._createDelegatedListener(_,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const E in v.delegates)this.on(E,v.delegates[E]);return this}once(_,o,h){if(void 0===h)return super.once(_,o);const v=this._createDelegatedListener(_,o,h);for(const E in v.delegates)this.once(E,v.delegates[E]);return this}off(_,o,h){return void 0===h?super.off(_,o):(this._delegatedListeners&&this._delegatedListeners[_]&&(v=>{const E=this._delegatedListeners[_];for(let D=0;D<E.length;D++){const R=E[D];if(R.layer===o&&R.listener===h){for(const B in R.delegates)this.off(B,R.delegates[B]);return E.splice(D,1),this}}})(),this)}queryRenderedFeatures(_,o){return this.style?(void 0!==o||void 0===_||_ instanceof g.pointGeometry||Array.isArray(_)||(o=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(_,o){return this.style.querySourceFeatures(_,o)}queryTerrainElevation(_,o){const h=this.transform.elevation;return h?(o=g.extend({},{exaggerated:!0},o),h.getAtPoint(g.MercatorCoordinate.fromLngLat(_),null,o.exaggerated)):null}setStyle(_,o){return!1!==(o=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(_,o))}_getUIString(_){const o=this._locale[_];if(null==o)throw new Error(`Missing UI string '${_}'`);return o}_updateStyle(_,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),_&&(this.style=new Zo(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,o){if("string"==typeof _){const h=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(h,g.ResourceType.Style);g.getJSON(v,(E,D)=>{E?this.fire(new g.ErrorEvent(E)):D&&this._updateDiff(D,o)})}else"object"==typeof _&&this._updateDiff(_,o)}_updateDiff(_,o){try{this.style.setState(_)&&this._update(!0)}catch(h){g.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(_,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")}addSource(_,o){return this._lazyInitEmptyStyle(),this.style.addSource(_,o),this._update(!0)}isSourceLoaded(_){const o=this.style&&this.style._getSourceCaches(_);if(0!==o.length)return o.every(h=>h.loaded());this.fire(new g.ErrorEvent(new Error(`There is no source with ID '${_}'`)))}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const o in _){const h=_[o]._tiles;for(const v in h){const E=h[v];if("loaded"!==E.state&&"errored"!==E.state)return!1}}return!0}addSourceType(_,o,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,o,h)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,o,{pixelRatio:h=1,sdf:v=!1,stretchX:E,stretchY:D,content:R}={}){if(this._lazyInitEmptyStyle(),o instanceof Ec||kl&&o instanceof kl){const{width:B,height:z,data:G}=g.exported.getImageData(o);this.style.addImage(_,{data:new g.RGBAImage({width:B,height:z},G),pixelRatio:h,stretchX:E,stretchY:D,content:R,sdf:v,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:z,data:G}=o,H=o;this.style.addImage(_,{data:new g.RGBAImage({width:B,height:z},new Uint8Array(G)),pixelRatio:h,stretchX:E,stretchY:D,content:R,sdf:v,version:0,userImage:H}),H.onAdd&&H.onAdd(this,_)}}}updateImage(_,o){const h=this.style.getImage(_);if(!h)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=o instanceof Ec||kl&&o instanceof kl?g.exported.getImageData(o):o,{width:E,height:D,data:R}=v;return void 0===E||void 0===D?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):E!==h.data.width||D!==h.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(h.data.replace(R,!(o instanceof Ec||kl&&o instanceof kl)),void this.style.updateImage(_,h))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,o){g.getImage(this._requestManager.transformRequest(_,g.ResourceType.Image),(h,v)=>{o(h,v instanceof Ec?g.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(_,o){return this._lazyInitEmptyStyle(),this.style.addLayer(_,o),this._update(!0)}moveLayer(_,o){return this.style.moveLayer(_,o),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,o,h){return this.style.setLayerZoomRange(_,o,h),this._update(!0)}setFilter(_,o,h={}){return this.style.setFilter(_,o,h),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,o,h,v={}){return this.style.setPaintProperty(_,o,h,v),this._update(!0)}getPaintProperty(_,o){return this.style.getPaintProperty(_,o)}setLayoutProperty(_,o,h,v={}){return this.style.setLayoutProperty(_,o,h,v),this._update(!0)}getLayoutProperty(_,o){return this.style.getLayoutProperty(_,o)}setLight(_,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(g.LngLat.convert(_),this.transform):0}setFeatureState(_,o){return this.style.setFeatureState(_,o),this._update()}removeFeatureState(_,o){return this.style.removeFeatureState(_,o),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_containerDimensions(){let _=0,o=0;return this._container&&(_=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300),[_,o]}_detectMissingCSS(){"rgb(250, 128, 114)"!==g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=ot.create("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=ot.create("div","mapboxgl-canvas-container",_);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=ot.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1]);const v=this._controlContainer=ot.create("div","mapboxgl-control-container",_),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(D=>{E[D]=ot.create("div",`mapboxgl-ctrl-${D}`,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,o){const h=g.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(_),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${o}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const o=this._markers.indexOf(_);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const _=g.extend({},yo.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);o?(g.storeAuthState(o,!0),this.painter=new Eu(o,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),g.exported$1.testSupport(o)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.isMoving()&&this.loaded()?_():this._domRenderTaskQueue.add(_)}_render(_){let o;const h=this.painter.context.extTimerQuery,v=g.exported.now();this.listens("gpu-timing-frame")&&(o=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,o));let E=this._updateAverageElevation(v);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;let D=!1;const R=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,G=g.exported.now();this.style.zoomHistory.update(z,G);const H=new g.EvaluationParameters(z,{now:G,fadeDuration:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=H.crossFadingFactor();1===Q&&Q===this._crossFadingFactor||(D=!0,this._crossFadingFactor=Q),this.style.update(H)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,R,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:R,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const z=g.exported.now()-v;h.endQueryEXT(h.TIME_ELAPSED_EXT,o),setTimeout(()=>{const G=h.getQueryObjectEXT(o,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(o),this.fire(new g.Event("gpu-timing-frame",{cpuTime:z,gpuTime:G}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const G=this.painter.queryGpuTimers(z);this.fire(new g.Event("gpu-timing-layer",{layerTimes:G}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(B||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(E=this._updateAverageElevation(v,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new g.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new g.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const _ of this._markers)_._update()}_updateAverageElevation(_,o=!1){const h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((o||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const v=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();isNaN(E)?E=0:this._averageElevationLastSampledAt=_;const D=Math.abs(v-E);if(D>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(E),h(E);this._averageElevation.easeTo(E,_,300)}else if(D>1e-4)return this._averageElevation.jumpTo(E),h(E)}return!!this._averageElevation.isEasing(_)&&h(this._averageElevation.getValue(_))}_authenticate(){g.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===g.AUTH_ERR_MSG||401===_.status)){const o=this.painter.context.gl;g.storeAuthState(o,!1),this._logoControl instanceof Pu&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new g.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),g.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,v=h.createFramebuffer();function E(D){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,D,0);const R=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,R),R}return h.bindFramebuffer(h.FRAMEBUFFER,v),this._canvasPixelComparison(E(_),o.canvasCopies.map(E),o.timeStamps)}_canvasPixelComparison(_,o,h){let v=h[1]-h[0];const E=_.length/4;for(let D=0;D<o.length;D++){const R=o[D];let B=0;for(let z=0;z<R.length;z+=4)R[z]===_[z]&&R[z+1]===_[z+1]&&R[z+2]===_[z+2]&&R[z+3]===_[z+3]&&(B+=1);v+=(h[D+2]-h[D+1])*(1-B/E)}return v}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==g.window&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),yi(this._canvasContainer),yi(this._controlContainer),yi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),g.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new g.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=g.exported.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}_setCacheLimits(_,o){g.setCacheLimits(_,o)}get version(){return g.version}},NavigationControl:class{constructor(_){this.options=g.extend({},Ca,_),this._container=ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),ot.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),ot.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=ot.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const _=this._map.getZoom(),o=_===this._map.getMaxZoom(),h=_===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const _=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=_)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Br(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ot.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,o){const h=ot.create("button",_,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(_,o){const h=this._map._getUIString(`NavigationControl.${o}`);_.title=h,_.setAttribute("aria-label",h)}},GeolocateControl:class extends g.Evented{constructor(_){super(),this.options=g.extend({},df,_),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=$r(this._updateMarkerRotation,20)}onAdd(_){var o;return this._map=_,this._container=ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==Ka?o(Ka):void 0!==g.window.navigator.permissions?g.window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ka="denied"!==h.state,o(Ka)}):(Ka=!!g.window.navigator.geolocation,o(Ka)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ot.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Dc=0,Pl=!1}_isOutOfMapMaxBounds(_){const o=this._map.getMaxBounds(),h=_.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",_)),this._finish()}}_updateCamera(_){const o=new g.LngLat(_.coords.longitude,_.coords.latitude),h=_.coords.accuracy,v=this._map.getBearing(),E=g.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),E,{geolocateSource:!0})}_updateMarker(_){if(_){const o=new g.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map._container.getBoundingClientRect().height/2,o=this._map.unproject([0,_]),h=this._map.unproject([100,_]),v=o.distanceTo(h)/100,E=Math.ceil(2*this._accuracy/v);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&Pl)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ot.create("button","mapboxgl-ctrl-geolocate",this._container),ot.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===_){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ot.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ot.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ot.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ru({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ot.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ru({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new g.Event("trackuserlocationend")))})}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Dc--,Pl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Dc++,Dc>1?(_={maximumAge:6e5,timeout:0},Pl=!0):(_=this.options.positionOptions,Pl=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{g.window.addEventListener("ondeviceorientationabsolute"in g.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==g.window.DeviceMotionEvent&&"function"==typeof g.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&_()}).catch(console.error):_()}_clearWatch(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),g.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),g.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kh,ScaleControl:class{constructor(_){this.options=g.extend({},sm,_),g.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Af(this._map,this._container,this.options)}onAdd(_){return this._map=_,this._container=ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ot.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(_){this.options.unit=_,Af(this._map,this._container,this.options)}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof g.window.HTMLElement?this._container=_.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in g.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=ot.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ot.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!g.window.document.fullscreenEnabled&&!g.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=ot.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ot.create("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden",!0),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(g.window.document.fullscreenElement||g.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends g.Evented{constructor(_){super(),this.options=g.extend(Object.create(Ou),_),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ot.remove(this._content),this._container&&(ot.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=g.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(g.window.document.createTextNode(_))}setHTML(_){const o=g.window.document.createDocumentFragment(),h=g.window.document.createElement("body");let v;for(h.innerHTML=_;v=h.firstChild,v;)o.appendChild(v);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ot.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._container&&this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._container&&this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let o;return this._classList.delete(_)?o=!1:(this._classList.add(_),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=ot.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(_){this._update(_.point)}_onMouseMove(_){this._update(_.point)}_onDrag(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const o=this._pos,h=this._container.offsetWidth,v=this._container.offsetHeight;let E;return E=o.y+_.bottom.y<v?["top"]:o.y>this._map.transform.height-v?["bottom"]:[],o.x<h/2?E.push("left"):o.x>this._map.transform.width-h/2&&E.push("right"),0===E.length?"bottom":E.join("-")}_updateClassList(){const _=[...this._classList];_.push("mapboxgl-popup"),this._anchor&&_.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&_.push("mapboxgl-popup-track-pointer"),this._container.className=_.join(" ")}_update(_){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ot.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ot.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ph(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||_){const o=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat),h=function(D){if(D||(D=new g.pointGeometry(0,0)),"number"==typeof D){const R=Math.round(Math.sqrt(.5*Math.pow(D,2)));return{center:new g.pointGeometry(0,0),top:new g.pointGeometry(0,D),"top-left":new g.pointGeometry(R,R),"top-right":new g.pointGeometry(-R,R),bottom:new g.pointGeometry(0,-D),"bottom-left":new g.pointGeometry(R,-R),"bottom-right":new g.pointGeometry(-R,-R),left:new g.pointGeometry(D,0),right:new g.pointGeometry(-D,0)}}if(D instanceof g.pointGeometry||Array.isArray(D)){const R=g.pointGeometry.convert(D);return{center:R,top:R,"top-left":R,"top-right":R,bottom:R,"bottom-left":R,"bottom-right":R,left:R,right:R}}return{center:g.pointGeometry.convert(D.center||[0,0]),top:g.pointGeometry.convert(D.top||[0,0]),"top-left":g.pointGeometry.convert(D["top-left"]||[0,0]),"top-right":g.pointGeometry.convert(D["top-right"]||[0,0]),bottom:g.pointGeometry.convert(D.bottom||[0,0]),"bottom-left":g.pointGeometry.convert(D["bottom-left"]||[0,0]),"bottom-right":g.pointGeometry.convert(D["bottom-right"]||[0,0]),left:g.pointGeometry.convert(D.left||[0,0]),right:g.pointGeometry.convert(D.right||[0,0])}}(this.options.offset),v=this._anchor=this._getAnchor(h),E=o.add(h[v]).round();this._map._requestDomTask(()=>{this._container&&v&&ot.setTransform(this._container,`${Il[v]} translate(${E.x}px,${E.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Lu);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._content&&(this._content.style.opacity=_),this._tip&&(this._tip.style.opacity=_)}},Marker:Ru,Style:Zo,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.pointGeometry,MercatorCoordinate:g.MercatorCoordinate,FreeCameraOptions:Mh,Evented:g.Evented,config:g.config,prewarm:function(){ft().acquire(Ee)},clearPrewarmedResources:function(){const _=Ye;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(Ee),Ye=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(_){g.config.ACCESS_TOKEN=_},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(_){g.config.API_URL=_},get workerCount(){return Oe.workerCount},set workerCount(_){Oe.workerCount=_},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){g.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){g.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:g.exported.setNow,restoreNow:g.exported.restoreNow};return Sc}),Ns}()},610:(_d,Bs,Ra)=>{"use strict";function Ns(n){return"function"==typeof n}let yd=!1;const ua={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else yd&&console.log("RxJS: Back to a better error behavior. Thank you. <3");yd=n},get useDeprecatedSynchronousErrorHandling(){return yd}};function g(n){setTimeout(()=>{throw n},0)}const yo={closed:!0,next(n){},error(n){if(ua.useDeprecatedSynchronousErrorHandling)throw n;g(n)},complete(){}},Vo=Array.isArray||(n=>n&&"number"==typeof n.length);function lo(n){return null!==n&&"object"==typeof n}const ot=(()=>{function n(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,r)=>`${r+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return n.prototype=Object.create(Error.prototype),n})();class Ct{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:r,_unsubscribe:s,_subscriptions:c}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof Ct)t.remove(this);else if(null!==t)for(let m=0;m<t.length;++m)t[m].remove(this);if(Ns(s)){r&&(this._unsubscribe=void 0);try{s.call(this)}catch(m){e=m instanceof ot?hs(m.errors):[m]}}if(Vo(c)){let m=-1,w=c.length;for(;++m<w;){const I=c[m];if(lo(I))try{I.unsubscribe()}catch(L){e=e||[],L instanceof ot?e=e.concat(hs(L.errors)):e.push(L)}}}if(e)throw new ot(e)}add(e){let t=e;if(!e)return Ct.EMPTY;switch(typeof e){case"function":t=new Ct(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof Ct)){const c=t;t=new Ct,t._subscriptions=[c]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=t;if(null===r)t._parentOrParents=this;else if(r instanceof Ct){if(r===this)return t;t._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return t;r.push(this)}const s=this._subscriptions;return null===s?this._subscriptions=[t]:s.push(t),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}var n;function hs(n){return n.reduce((e,t)=>e.concat(t instanceof ot?t.errors:t),[])}Ct.EMPTY=((n=new Ct).closed=!0,n);const Fa="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Wn extends Ct{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=yo;break;case 1:if(!e){this.destination=yo;break}if("object"==typeof e){e instanceof Wn?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new ou(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new ou(this,e,t,r)}}[Fa](){return this}static create(e,t,r){const s=new Wn(e,t,r);return s.syncErrorThrowable=!1,s}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class ou extends Wn{constructor(e,t,r,s){super(),this._parentSubscriber=e;let c,m=this;Ns(t)?c=t:t&&(c=t.next,r=t.error,s=t.complete,t!==yo&&(m=Object.create(t),Ns(m.unsubscribe)&&this.add(m.unsubscribe.bind(m)),m.unsubscribe=this.unsubscribe.bind(this))),this._context=m,this._next=c,this._error=r,this._complete=s}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;ua.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=ua;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):g(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;g(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);ua.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),ua.useDeprecatedSynchronousErrorHandling)throw r;g(r)}}__tryOrSetError(e,t,r){if(!ua.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(s){return ua.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(g(s),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const ds="function"==typeof Symbol&&Symbol.observable||"@@observable";function li(n){return n}let jn=(()=>{class n{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,s){const{operator:c}=this,m=function(n,e,t){if(n){if(n instanceof Wn)return n;if(n[Fa])return n[Fa]()}return n||e||t?new Wn(n,e,t):new Wn(yo)}(t,r,s);if(m.add(c?c.call(m,this.source):this.source||ua.useDeprecatedSynchronousErrorHandling&&!m.syncErrorThrowable?this._subscribe(m):this._trySubscribe(m)),ua.useDeprecatedSynchronousErrorHandling&&m.syncErrorThrowable&&(m.syncErrorThrowable=!1,m.syncErrorThrown))throw m.syncErrorValue;return m}_trySubscribe(t){try{return this._subscribe(t)}catch(r){ua.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),function(n){for(;n;){const{closed:e,destination:t,isStopped:r}=n;if(e||r)return!1;n=t&&t instanceof Wn?t:null}return!0}(t)?t.error(r):console.warn(r)}}forEach(t,r){return new(r=ci(r))((s,c)=>{let m;m=this.subscribe(w=>{try{t(w)}catch(I){c(I),m&&m.unsubscribe()}},c,s)})}_subscribe(t){const{source:r}=this;return r&&r.subscribe(t)}[ds](){return this}pipe(...t){return 0===t.length?this:function(n){return 0===n.length?li:1===n.length?n[0]:function(t){return n.reduce((r,s)=>s(r),t)}}(t)(this)}toPromise(t){return new(t=ci(t))((r,s)=>{let c;this.subscribe(m=>c=m,m=>s(m),()=>r(c))})}}return n.create=e=>new n(e),n})();function ci(n){if(n||(n=ua.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const zs=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class nc extends Ct{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class Al extends Wn{constructor(e){super(e),this.destination=e}}let co=(()=>{class n extends jn{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Fa](){return new Al(this)}lift(t){const r=new rc(this,this);return r.operator=t,r}next(t){if(this.closed)throw new zs;if(!this.isStopped){const{observers:r}=this,s=r.length,c=r.slice();for(let m=0;m<s;m++)c[m].next(t)}}error(t){if(this.closed)throw new zs;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:r}=this,s=r.length,c=r.slice();for(let m=0;m<s;m++)c[m].error(t);this.observers.length=0}complete(){if(this.closed)throw new zs;this.isStopped=!0;const{observers:t}=this,r=t.length,s=t.slice();for(let c=0;c<r;c++)s[c].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new zs;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new zs;return this.hasError?(t.error(this.thrownError),Ct.EMPTY):this.isStopped?(t.complete(),Ct.EMPTY):(this.observers.push(t),new nc(this,t))}asObservable(){const t=new jn;return t.source=this,t}}return n.create=(e,t)=>new rc(e,t),n})();class rc extends co{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):Ct.EMPTY}}function As(n){return n&&"function"==typeof n.schedule}function fn(n,e){return function(r){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new Uo(n,e))}}class Uo{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new kr(e,this.project,this.thisArg))}}class kr extends Wn{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const Ba=n=>e=>{for(let t=0,r=n.length;t<r&&!e.closed;t++)e.next(n[t]);e.complete()},Na="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Ln=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function pl(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const ml=n=>{if(n&&"function"==typeof n[ds])return(n=>e=>{const t=n[ds]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(n);if(Ln(n))return Ba(n);if(pl(n))return(n=>e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,g),e))(n);if(n&&"function"==typeof n[Na])return(n=>e=>{const t=n[Na]();for(;;){let r;try{r=t.next()}catch(s){return e.error(s),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(n);{const t=`You provided ${lo(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function uo(n,e){return new jn(t=>{const r=new Ct;let s=0;return r.add(e.schedule(function(){s!==n.length?(t.next(n[s++]),t.closed||r.add(this.schedule())):t.complete()})),r})}function Pr(n,e){return e?function(n,e){if(null!=n){if(function(n){return n&&"function"==typeof n[ds]}(n))return function(n,e){return new jn(t=>{const r=new Ct;return r.add(e.schedule(()=>{const s=n[ds]();r.add(s.subscribe({next(c){r.add(e.schedule(()=>t.next(c)))},error(c){r.add(e.schedule(()=>t.error(c)))},complete(){r.add(e.schedule(()=>t.complete()))}}))})),r})}(n,e);if(pl(n))return function(n,e){return new jn(t=>{const r=new Ct;return r.add(e.schedule(()=>n.then(s=>{r.add(e.schedule(()=>{t.next(s),r.add(e.schedule(()=>t.complete()))}))},s=>{r.add(e.schedule(()=>t.error(s)))}))),r})}(n,e);if(Ln(n))return uo(n,e);if(function(n){return n&&"function"==typeof n[Na]}(n)||"string"==typeof n)return function(n,e){if(!n)throw new Error("Iterable cannot be null");return new jn(t=>{const r=new Ct;let s;return r.add(()=>{s&&"function"==typeof s.return&&s.return()}),r.add(e.schedule(()=>{s=n[Na](),r.add(e.schedule(function(){if(t.closed)return;let c,m;try{const w=s.next();c=w.value,m=w.done}catch(w){return void t.error(w)}m?t.complete():(t.next(c),this.schedule())}))})),r})}(n,e)}throw new TypeError((null!==n&&typeof n||n)+" is not observable")}(n,e):n instanceof jn?n:new jn(ml(n))}class da extends Wn{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Us extends Wn{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Aa(n,e){if(e.closed)return;if(n instanceof jn)return n.subscribe(e);let t;try{t=ml(n)(e)}catch(r){e.error(r)}return t}function mr(n,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(mr((s,c)=>Pr(n(s,c)).pipe(fn((m,w)=>e(s,m,c,w))),t)):("number"==typeof e&&(t=e),r=>r.lift(new ja(n,t)))}class ja{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new hu(e,this.project,this.concurrent))}}class hu extends Us{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(s){return void this.destination.error(s)}this.active++,this._innerSub(t)}_innerSub(e){const t=new da(this),r=this.destination;r.add(t);const s=Aa(e,t);s!==t&&r.add(s)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function jo(n=Number.POSITIVE_INFINITY){return mr(li,n)}function vo(n,e){return e?uo(n,e):new jn(Ba(n))}function gl(){return function(e){return e.lift(new fh(e))}}class fh{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const s=new ic(e,r),c=t.subscribe(s);return s.closed||(s.connection=r.connect()),c}}class ic extends Wn{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,s=e._connection;this.connection=null,s&&(!r||s===r)&&s.unsubscribe()}}class oc extends jn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new Ct,e.add(this.source.subscribe(new xd(this.getSubject(),this))),e.closed&&(this._connection=null,e=Ct.EMPTY)),e}refCount(){return gl()(this)}}const ph=(()=>{const n=oc.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class xd extends Al{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function mh(){return new co}function Pn(n){for(let e in n)if(n[e]===Pn)return e;throw Error("Could not find renamed property on target object.")}function fa(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function sn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(sn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function pa(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const lc=Pn({__forward_ref__:Pn});function $n(n){return n.__forward_ref__=$n,n.toString=function(){return sn(this())},n}function ne(n){return Z(n)?n():n}function Z(n){return"function"==typeof n&&n.hasOwnProperty(lc)&&n.__forward_ref__===$n}class ae extends Error{constructor(e,t){super(function(n,e){return`${n?`NG0${n}: `:""}${e}`}(e,t)),this.code=e}}function we(n){return"string"==typeof n?n:null==n?"":String(n)}function ke(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():we(n)}function ft(n,e){const t=e?` in ${e}`:"";throw new ae("201",`No provider for ${ke(n)} found${t}`)}function Ht(n,e){null==n&&function(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function qt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function _r(n){return{providers:n.providers||[],imports:n.imports||[]}}function Kn(n){return wd(n,Go)||wd(n,ln)}function wd(n,e){return n.hasOwnProperty(e)?n[e]:null}function hc(n){return n&&(n.hasOwnProperty(pu)||n.hasOwnProperty(Cd))?n[pu]:null}const Go=Pn({\u0275prov:Pn}),pu=Pn({\u0275inj:Pn}),ln=Pn({ngInjectableDef:Pn}),Cd=Pn({ngInjectorDef:Pn});var Zt=(()=>((Zt=Zt||{})[Zt.Default=0]="Default",Zt[Zt.Host=1]="Host",Zt[Zt.Self=2]="Self",Zt[Zt.SkipSelf=4]="SkipSelf",Zt[Zt.Optional=8]="Optional",Zt))();let ui;function ma(n){const e=ui;return ui=n,e}function mu(n,e,t){const r=Kn(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Zt.Optional?null:void 0!==e?e:void ft(sn(n),"Injector")}function Ro(n){return{toString:n}.toString()}var hi=(()=>((hi=hi||{})[hi.OnPush=0]="OnPush",hi[hi.Default=1]="Default",hi))(),Ar=(()=>((Ar=Ar||{})[Ar.Emulated=0]="Emulated",Ar[Ar.None=2]="None",Ar[Ar.ShadowDom=3]="ShadowDom",Ar))();const _u="undefined"!=typeof globalThis&&globalThis,gh="undefined"!=typeof window&&window,Xp="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,sr=_u||"undefined"!=typeof global&&global||gh||Xp,qo={},Hn=[],dc=Pn({\u0275cmp:Pn}),Ac=Pn({\u0275dir:Pn}),Ed=Pn({\u0275pipe:Pn}),nf=Pn({\u0275mod:Pn}),Dd=Pn({\u0275loc:Pn}),js=Pn({\u0275fac:Pn}),ga=Pn({__NG_ELEMENT_ID__:Pn});let Kp=0;function Ha(n){return Ro(()=>{const t={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===hi.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||Hn,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Ar.Emulated,id:"c",styles:n.styles||Hn,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.directives,c=n.features,m=n.pipes;return r.id+=Kp++,r.inputs=Wo(n.inputs,t),r.outputs=Wo(n.outputs),c&&c.forEach(w=>w(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(_h):null,r.pipeDefs=m?()=>("function"==typeof m?m():m).map(Zo):null,r})}function _h(n){return Mi(n)||function(n){return n[Ac]||null}(n)}function Zo(n){return function(n){return n[Ed]||null}(n)}const yh={};function qi(n){return Ro(()=>{const e={type:n.type,bootstrap:n.bootstrap||Hn,declarations:n.declarations||Hn,imports:n.imports||Hn,exports:n.exports||Hn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(yh[n.id]=n.type),e})}function Wo(n,e){if(null==n)return qo;const t={};for(const r in n)if(n.hasOwnProperty(r)){let s=n[r],c=s;Array.isArray(s)&&(c=s[1],s=s[0]),t[s]=r,e&&(e[s]=c)}return t}const Wt=Ha;function Mi(n){return n[dc]||null}function xo(n,e){const t=n[nf]||null;if(!t&&!0===e)throw new Error(`Type ${sn(n)} does not have '\u0275mod' property.`);return t}function gs(n){return Array.isArray(n)&&"object"==typeof n[1]}function Fo(n){return Array.isArray(n)&&!0===n[1]}function Za(n){return 0!=(8&n.flags)}function bh(n){return 2==(2&n.flags)}function wu(n){return 1==(1&n.flags)}function Xo(n){return null!==n.template}function em(n){return 0!=(512&n[2])}function Cl(n,e){return n.hasOwnProperty(js)?n[js]:null}class Ch{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Zr(){return Yo}function Yo(n){return n.type.prototype.ngOnChanges&&(n.setInput=Wa),Eh}function Eh(){const n=Eu(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===qo)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function Wa(n,e,t,r){const s=Eu(n)||function(n,e){return n[Dh]=e}(n,{previous:qo,current:null}),c=s.current||(s.current={}),m=s.previous,w=this.declaredInputs[t],I=m[w];c[w]=new Ch(I&&I.currentValue,e,m===qo),n[r]=e}Zr.ngInherit=!0;const Dh="__ngSimpleChanges__";function Eu(n){return n[Dh]||null}let Qa;function $r(n){return!!n.listen}const Xa={createRenderer:(n,e)=>void 0!==Qa?Qa:"undefined"!=typeof document?document:void 0};function ri(n){for(;Array.isArray(n);)n=n[0];return n}function vc(n,e){return ri(e[n])}function Wi(n,e){return ri(e[n.index])}function Qi(n,e){return n.data[e]}function wo(n,e){const t=e[n];return gs(t)?t:t[0]}function El(n){return 4==(4&n[2])}function Th(n){return 128==(128&n[2])}function _s(n,e){return null==e?null:n[e]}function Od(n){n[18]=0}function xc(n,e){n[5]+=e;let t=n,r=n[3];for(;null!==r&&(1===e&&1===t[5]||-1===e&&0===t[5]);)r[5]+=e,t=r,r=r[3]}const nn={lFrame:$d(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Zs(){return nn.bindingsEnabled}function at(){return nn.lFrame.lView}function qn(){return nn.lFrame.tView}function Dl(n){return nn.lFrame.contextLView=n,n[8]}function ii(){let n=wc();for(;null!==n&&64===n.type;)n=n.parent;return n}function wc(){return nn.lFrame.currentTNode}function ys(n,e){const t=nn.lFrame;t.currentTNode=n,t.isParent=e}function Ih(){return nn.lFrame.isParent}function Tu(){return nn.isInCheckNoChangesMode}function Ya(n){nn.isInCheckNoChangesMode=n}function Ml(){return nn.lFrame.bindingIndex++}function Ws(n){const e=nn.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function uf(n,e){const t=nn.lFrame;t.bindingIndex=t.bindingRootIndex=n,ku(e)}function ku(n){nn.lFrame.currentDirectiveIndex=n}function kh(){return nn.lFrame.currentQueryIndex}function Pu(n){nn.lFrame.currentQueryIndex=n}function jd(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Ph(n,e,t){if(t&Zt.SkipSelf){let s=e,c=n;for(;!(s=s.parent,null!==s||t&Zt.Host||(s=jd(c),null===s||(c=c[15],10&s.type))););if(null===s)return!1;e=s,n=c}const r=nn.lFrame=Ru();return r.currentTNode=e,r.lView=n,!0}function Il(n){const e=Ru(),t=n[1];nn.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function Ru(){const n=nn.lFrame,e=null===n?null:n.child;return null===e?$d(n):e}function $d(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Rh(){const n=nn.lFrame;return nn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Ec=Rh;function Fu(){const n=Rh();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function yi(){return nn.lFrame.selectedIndex}function Ca(n){nn.lFrame.selectedIndex=n}function Qs(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const c=n.data[t].type.prototype,{ngAfterContentInit:m,ngAfterContentChecked:w,ngAfterViewInit:I,ngAfterViewChecked:L,ngOnDestroy:U}=c;m&&(n.contentHooks||(n.contentHooks=[])).push(-t,m),w&&((n.contentHooks||(n.contentHooks=[])).push(t,w),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,w)),I&&(n.viewHooks||(n.viewHooks=[])).push(-t,I),L&&((n.viewHooks||(n.viewHooks=[])).push(t,L),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,L)),null!=U&&(n.destroyHooks||(n.destroyHooks=[])).push(t,U)}}function Ou(n,e,t){_(n,e,3,t)}function Lu(n,e,t,r){(3&n[2])===t&&_(n,e,t,r)}function Sc(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function _(n,e,t,r){const c=null!=r?r:-1,m=e.length-1;let w=0;for(let I=void 0!==r?65535&n[18]:0;I<m;I++)if("number"==typeof e[I+1]){if(w=e[I],null!=r&&w>=r)break}else e[I]<0&&(n[18]+=65536),(w<c||-1==c)&&(o(n,t,e,I),n[18]=(4294901760&n[18])+I+2),I++}function o(n,e,t,r){const s=t[r]<0,c=t[r+1],w=n[s?-t[r]:t[r]];if(s){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{c.call(w)}finally{}}}else try{c.call(w)}finally{}}const h=-1;class v{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function J(n,e,t){const r=$r(n);let s=0;for(;s<t.length;){const c=t[s];if("number"==typeof c){if(0!==c)break;s++;const m=t[s++],w=t[s++],I=t[s++];r?n.setAttribute(e,w,I,m):e.setAttributeNS(m,w,I)}else{const m=c,w=t[++s];le(m)?r&&n.setProperty(e,m,w):r?n.setAttribute(e,m,w):e.setAttribute(m,w),s++}}return s}function te(n){return 3===n||4===n||6===n}function le(n){return 64===n.charCodeAt(0)}function ce(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const s=e[r];"number"==typeof s?t=s:0===t||_e(n,t,s,null,-1===t||2===t?e[++r]:null)}}return n}function _e(n,e,t,r,s){let c=0,m=n.length;if(-1===e)m=-1;else for(;c<n.length;){const w=n[c++];if("number"==typeof w){if(w===e){m=-1;break}if(w>e){m=c-1;break}}}for(;c<n.length;){const w=n[c];if("number"==typeof w)break;if(w===t){if(null===r)return void(null!==s&&(n[c+1]=s));if(r===n[c+1])return void(n[c+2]=s)}c++,null!==r&&c++,null!==s&&c++}-1!==m&&(n.splice(m,0,e),c=m+1),n.splice(c++,0,t),null!==r&&n.splice(c++,0,r),null!==s&&n.splice(c++,0,s)}function se(n){return n!==h}function ue(n){return 32767&n}function ve(n,e){let t=function(n){return n>>16}(n),r=e;for(;t>0;)r=r[15],t--;return r}let Se=!0;function de(n){const e=Se;return Se=n,e}let Pe=0;function xt(n,e){const t=Et(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,Dt(r.data,n),Dt(e,null),Dt(r.blueprint,null));const s=ht(n,e),c=n.injectorIndex;if(se(s)){const m=ue(s),w=ve(s,e),I=w[1].data;for(let L=0;L<8;L++)e[c+L]=w[m+L]|I[m+L]}return e[c+8]=s,c}function Dt(n,e){n.push(0,0,0,0,0,0,0,0,e)}function Et(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function ht(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,s=e;for(;null!==s;){const c=s[1],m=c.type;if(r=2===m?c.declTNode:1===m?s[6]:null,null===r)return h;if(t++,s=s[15],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return h}function Mt(n,e,t){!function(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(ga)&&(r=t[ga]),null==r&&(r=t[ga]=Pe++);const s=255&r;e.data[n+(s>>5)]|=1<<s}(n,e,t)}function Yt(n,e,t){if(t&Zt.Optional)return n;ft(e,"NodeInjector")}function Nr(n,e,t,r){if(t&Zt.Optional&&void 0===r&&(r=null),0==(t&(Zt.Self|Zt.Host))){const s=n[9],c=ma(void 0);try{return s?s.get(e,r,t&Zt.Optional):mu(e,r,t&Zt.Optional)}finally{ma(c)}}return Yt(r,e,t)}function xr(n,e,t,r=Zt.Default,s){if(null!==n){const c=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(ga)?n[ga]:void 0;return"number"==typeof e?e>=0?255&e:wn:e}(t);if("function"==typeof c){if(!Ph(e,n,r))return r&Zt.Host?Yt(s,t,r):Nr(e,t,r,s);try{const m=c(r);if(null!=m||r&Zt.Optional)return m;ft(t)}finally{Ec()}}else if("number"==typeof c){let m=null,w=Et(n,e),I=h,L=r&Zt.Host?e[16][6]:null;for((-1===w||r&Zt.SkipSelf)&&(I=-1===w?ht(n,e):e[w+8],I!==h&&xs(r,!1)?(m=e[1],w=ue(I),e=ve(I,e)):w=-1);-1!==w;){const U=e[1];if(fo(c,w,U.data)){const W=Rr(w,e,t,m,r,L);if(W!==an)return W}I=e[w+8],I!==h&&xs(r,e[1].data[w+8]===L)&&fo(c,w,e)?(m=U,w=ue(I),e=ve(I,e)):w=-1}}}return Nr(e,t,r,s)}const an={};function wn(){return new Do(ii(),at())}function Rr(n,e,t,r,s,c){const m=e[1],w=m.data[n+8],U=Ao(w,m,t,null==r?bh(w)&&Se:r!=m&&0!=(3&w.type),s&Zt.Host&&c===w);return null!==U?Eo(e,m,U,w):an}function Ao(n,e,t,r,s){const c=n.providerIndexes,m=e.data,w=1048575&c,I=n.directiveStart,U=c>>20,K=s?w+U:n.directiveEnd;for(let ie=r?w:w+U;ie<K;ie++){const fe=m[ie];if(ie<I&&t===fe||ie>=I&&fe.type===t)return ie}if(s){const ie=m[I];if(ie&&Xo(ie)&&ie.type===t)return I}return null}function Eo(n,e,t,r){let s=n[t];const c=e.data;if(function(n){return n instanceof v}(s)){const m=s;m.resolving&&function(n,e){throw new ae("200",`Circular dependency in DI detected for ${n}`)}(ke(c[t]));const w=de(m.canSeeViewProviders);m.resolving=!0;const I=m.injectImpl?ma(m.injectImpl):null;Ph(n,r,Zt.Default);try{s=n[t]=m.factory(void 0,c,n,r),e.firstCreatePass&&t>=r.directiveStart&&function(n,e,t){const{ngOnChanges:r,ngOnInit:s,ngDoCheck:c}=e.type.prototype;if(r){const m=Yo(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,m),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,m)}s&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,s),c&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,c),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,c))}(t,c[t],e)}finally{null!==I&&ma(I),de(w),m.resolving=!1,Ec()}}return s}function fo(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function xs(n,e){return!(n&Zt.Self||n&Zt.Host&&e)}class Do{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return xr(this._tNode,this._lView,e,void 0,t)}}function Tn(n){return Ro(()=>{const e=n.prototype.constructor,t=e[js]||Cr(e),r=Object.prototype;let s=Object.getPrototypeOf(n.prototype).constructor;for(;s&&s!==r;){const c=s[js]||Cr(s);if(c&&c!==t)return c;s=Object.getPrototypeOf(s)}return c=>new c})}function Cr(n){return Z(n)?()=>{const e=Cr(ne(n));return e&&e()}:Cl(n)}const vi="__parameters__";function Ki(n,e,t){return Ro(()=>{const r=function(n){return function(...t){if(n){const r=n(...t);for(const s in r)this[s]=r[s]}}}(e);function s(...c){if(this instanceof s)return r.apply(this,c),this;const m=new s(...c);return w.annotation=m,w;function w(I,L,U){const W=I.hasOwnProperty(vi)?I[vi]:Object.defineProperty(I,vi,{value:[]})[vi];for(;W.length<=U;)W.push(null);return(W[U]=W[U]||[]).push(m),I}}return t&&(s.prototype=Object.create(t.prototype)),s.prototype.ngMetadataName=n,s.annotationCls=s,s})}class rn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=qt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Oh=new rn("AnalyzeForEntryComponents"),Bu=Function;function Vi(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)?(e===n&&(e=n.slice(0,t)),Vi(r,e)):e!==n&&e.push(r)}return e}function bs(n,e){n.forEach(t=>Array.isArray(t)?bs(t,e):e(t))}function Zd(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Tc(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Ti(n,e,t){let r=Ys(n,e);return r>=0?n[1|r]=t:(r=~r,function(n,e,t,r){let s=n.length;if(s==e)n.push(t,r);else if(1===s)n.push(r,n[0]),n[0]=t;else{for(s--,n.push(n[s-1],n[s]);s>e;)n[s]=n[s-2],s--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function Ea(n,e){const t=Ys(n,e);if(t>=0)return n[1|t]}function Ys(n,e){return function(n,e,t){let r=0,s=n.length>>t;for(;s!==r;){const c=r+(s-r>>1),m=n[c<<t];if(e===m)return c<<t;m>e?s=c:r=c+1}return~(s<<t)}(n,e,1)}const Nu={},yf="__NG_DI_FLAG__",Ks="ngTempTokenPath",vf=/\n/gm,xf="__source",bf=Pn({provide:String,useValue:Pn});let Yd;function Pc(n){const e=Yd;return Yd=n,e}function Cv(n,e=Zt.Default){if(void 0===Yd)throw new Error("inject() must be called from an injection context");return null===Yd?mu(n,void 0,e):Yd.get(n,e&Zt.Optional?null:void 0,e)}function yt(n,e=Zt.Default){return(ui||Cv)(ne(n),e)}function Js(n){const e=[];for(let t=0;t<n.length;t++){const r=ne(n[t]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let s,c=Zt.Default;for(let m=0;m<r.length;m++){const w=r[m],I=Dv(w);"number"==typeof I?-1===I?s=w.token:c|=I:s=w}e.push(yt(s,c))}else e.push(yt(r))}return e}function Lh(n,e){return n[yf]=e,n.prototype[yf]=e,n}function Dv(n){return n[yf]}function Vu(n,e,t,r){const s=n[Ks];throw e[xf]&&s.unshift(e[xf]),n.message=function(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let s=sn(e);if(Array.isArray(e))s=e.map(sn).join(" -> ");else if("object"==typeof e){let c=[];for(let m in e)if(e.hasOwnProperty(m)){let w=e[m];c.push(m+":"+("string"==typeof w?JSON.stringify(w):sn(w)))}s=`{${c.join(", ")}}`}return`${t}${r?"("+r+")":""}[${s}]: ${n.replace(vf,"\n  ")}`}("\n"+n.message,s,t,r),n.ngTokenPath=s,n[Ks]=null,n}const Uu=Lh(Ki("Inject",n=>({token:n})),-1),Ko=Lh(Ki("Optional"),8),xi=Lh(Ki("SkipSelf"),4);let zh;function $u(n){var e;return(null===(e=function(){if(void 0===zh&&(zh=null,sr.trustedTypes))try{zh=sr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return zh}())||void 0===e?void 0:e.createHTML(n))||n}class Rl{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Rc extends Rl{getTypeName(){return"HTML"}}class ws extends Rl{getTypeName(){return"Style"}}class Rv extends Rl{getTypeName(){return"Script"}}class mm extends Rl{getTypeName(){return"URL"}}class Fv extends Rl{getTypeName(){return"ResourceURL"}}function Cs(n){return n instanceof Rl?n.changingThisBreaksApplicationSecurity:n}function Ja(n,e){const t=If(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}function If(n){return n instanceof Rl&&n.getTypeName()||null}class Lv{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString($u(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch(t){return null}}}class Bv{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const r=this.inertDocument.createElement("body");t.appendChild(r)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=$u(e),t;const r=this.inertDocument.createElement("body");return r.innerHTML=$u(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(r),r}stripCustomNsAttrs(e){const t=e.attributes;for(let s=t.length-1;0<s;s--){const m=t.item(s).name;("xmlns:ns1"===m||0===m.indexOf("ns1:"))&&e.removeAttribute(m)}let r=e.firstChild;for(;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling}}const zv=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Vv=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Gu(n){return(n=String(n)).match(zv)||n.match(Vv)?n:"unsafe:"+n}function R0(n){return(n=String(n)).split(",").map(e=>Gu(e.trim())).join(", ")}function Oo(n){const e={};for(const t of n.split(","))e[t]=!0;return e}function rA(...n){const e={};for(const t of n)for(const r in t)t.hasOwnProperty(r)&&(e[r]=!0);return e}const Wr=Oo("area,br,col,hr,img,wbr"),iA=Oo("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),gm=Oo("rp,rt"),Rf=rA(Wr,rA(iA,Oo("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),rA(gm,Oo("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),rA(gm,iA)),Ff=Oo("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Hu=Oo("srcset"),L0=rA(Ff,Hu,Oo("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Oo("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),B0=Oo("script,style,template");class oA{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,r=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?r=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,r&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let s=this.checkClobberedElement(t,t.nextSibling);if(s){t=s;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!Rf.hasOwnProperty(t))return this.sanitizedSomething=!0,!B0.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const r=e.attributes;for(let s=0;s<r.length;s++){const c=r.item(s),m=c.name,w=m.toLowerCase();if(!L0.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let I=c.value;Ff[w]&&(I=Gu(I)),Hu[w]&&(I=R0(I)),this.buf.push(" ",m,'="',N0(I),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();Rf.hasOwnProperty(t)&&!Wr.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(N0(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const Uv=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,vm=/([^\#-~ |!])/g;function N0(n){return n.replace(/&/g,"&amp;").replace(Uv,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(vm,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Vh;function Of(n,e){let t=null;try{Vh=Vh||function(n){const e=new Bv(n);return function(){try{return!!(new window.DOMParser).parseFromString($u(""),"text/html")}catch(n){return!1}}()?new Lv(e):e}(n);let r=e?String(e):"";t=Vh.getInertBodyElement(r);let s=5,c=r;do{if(0===s)throw new Error("Failed to sanitize html because the input is unstable");s--,r=c,c=t.innerHTML,t=Vh.getInertBodyElement(r)}while(r!==c);return $u((new oA).sanitizeChildren(sA(t)||t))}finally{if(t){const r=sA(t)||t;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function sA(n){return"content"in n&&function(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Fr=(()=>((Fr=Fr||{})[Fr.NONE=0]="NONE",Fr[Fr.HTML=1]="HTML",Fr[Fr.STYLE=2]="STYLE",Fr[Fr.SCRIPT=3]="SCRIPT",Fr[Fr.URL=4]="URL",Fr[Fr.RESOURCE_URL=5]="RESOURCE_URL",Fr))();const Cm="__ngContext__";function Ji(n,e){n[Cm]=e}function Em(n){const e=function(n){return n[Cm]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function Bf(n){return n.ngOriginalError}function e1(n,...e){n.error(...e)}class Oc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),s=function(n){return n&&n.ngErrorLogger||e1}(e);s(this._console,"ERROR",e),t&&s(this._console,"ORIGINAL ERROR",t),r&&s(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(n){return n.ngDebugContext}(e)||this._findContext(Bf(e)):null}_findOriginalError(e){let t=e&&Bf(e);for(;t&&Bf(t);)t=Bf(t);return t||null}}const Im=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(sr))();function Ma(n){return n instanceof Function?n():n}var Es=(()=>((Es=Es||{})[Es.Important=1]="Important",Es[Es.DashCase=2]="DashCase",Es))();function Fm(n,e){return undefined(n,e)}function dA(n){const e=n[3];return Fo(e)?e[3]:e}function $h(n){return Om(n[13])}function Bc(n){return Om(n[4])}function Om(n){for(;null!==n&&!Fo(n);)n=n[4];return n}function Gh(n,e,t,r,s){if(null!=r){let c,m=!1;Fo(r)?c=r:gs(r)&&(m=!0,r=r[0]);const w=ri(r);0===n&&null!==t?null==s?jm(e,t,w):Zu(e,t,w,s||null,!0):1===n&&null!==t?Zu(e,t,w,s||null,!0):2===n?function(n,e,t){const r=fA(n,e);r&&function(n,e,t,r){$r(n)?n.removeChild(e,t,r):e.removeChild(t)}(n,r,e,t)}(e,w,m):3===n&&e.destroyNode(w),null!=c&&function(n,e,t,r,s){const c=t[7];c!==ri(t)&&Gh(e,n,r,c,s);for(let w=10;w<t.length;w++){const I=t[w];zc(I[1],I,n,e,r,c)}}(e,n,c,t,s)}}function Vf(n,e,t){return $r(n)?n.createElement(e,t):null===t?n.createElement(e):n.createElementNS(t,e)}function zm(n,e){const t=n[9],r=t.indexOf(e),s=e[3];1024&e[2]&&(e[2]&=-1025,xc(s,-1)),t.splice(r,1)}function jf(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const s=r[17];null!==s&&s!==n&&zm(s,r),e>0&&(n[t-1][4]=r[4]);const c=Tc(n,10+e);!function(n,e){zc(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const m=c[19];null!==m&&m.detachView(c[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function Y0(n,e){if(!(256&e[2])){const t=e[11];$r(t)&&t.destroyNode&&zc(n,e,t,3,null,null),function(n){let e=n[13];if(!e)return $f(n[1],n);for(;e;){let t=null;if(gs(e))t=e[13];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)gs(e)&&$f(e[1],e),e=e[3];null===e&&(e=n),gs(e)&&$f(e[1],e),t=e&&e[4]}e=t}}(e)}}function $f(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const s=e[t[r]];if(!(s instanceof v)){const c=t[r+1];if(Array.isArray(c))for(let m=0;m<c.length;m+=2){const w=s[c[m]],I=c[m+1];try{I.call(w)}finally{}}else try{c.call(s)}finally{}}}}(n,e),function(n,e){const t=n.cleanup,r=e[7];let s=-1;if(null!==t)for(let c=0;c<t.length-1;c+=2)if("string"==typeof t[c]){const m=t[c+1],w="function"==typeof m?m(e):ri(e[m]),I=r[s=t[c+2]],L=t[c+3];"boolean"==typeof L?w.removeEventListener(t[c],I,L):L>=0?r[s=L]():r[s=-L].unsubscribe(),c+=2}else{const m=r[s=t[c+1]];t[c].call(m)}if(null!==r){for(let c=s+1;c<r.length;c++)r[c]();e[7]=null}}(n,e),1===e[1].type&&$r(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&Fo(e[3])){t!==e[3]&&zm(t,e);const r=e[19];null!==r&&r.detachView(n)}}}function Gf(n,e,t){return function(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[0];if(2&r.flags){const s=n.data[r.directiveStart].encapsulation;if(s===Ar.None||s===Ar.Emulated)return null}return Wi(r,t)}(n,e.parent,t)}function Zu(n,e,t,r,s){$r(n)?n.insertBefore(e,t,r,s):e.insertBefore(t,r,s)}function jm(n,e,t){$r(n)?n.appendChild(e,t):e.appendChild(t)}function Ol(n,e,t,r,s){null!==r?Zu(n,e,t,r,s):jm(n,e,t)}function fA(n,e){return $r(n)?n.parentNode(e):e.parentNode}let n_=function(n,e,t){return 40&n.type?Wi(n,t):null};function Nc(n,e,t,r){const s=Gf(n,r,e),c=e[11],w=function(n,e,t){return n_(n,e,t)}(r.parent||e[6],r,e);if(null!=s)if(Array.isArray(t))for(let I=0;I<t.length;I++)Ol(c,s,t[I],w,!1);else Ol(c,s,t,w,!1)}function pA(n,e){if(null!==e){const t=e.type;if(3&t)return Wi(e,n);if(4&t)return mA(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return pA(n,r);{const s=n[e.index];return Fo(s)?mA(-1,s):ri(s)}}if(32&t)return Fm(e,n)()||ri(n[e.index]);{const r=Hm(n,e);return null!==r?Array.isArray(r)?r[0]:pA(dA(n[16]),r):pA(n,e.next)}}return null}function Hm(n,e){return null!==e?n[16][6].projection[e.projection]:null}function mA(n,e){const t=10+n+1;if(t<e.length){const r=e[t],s=r[1].firstChild;if(null!==s)return pA(r,s)}return e[7]}function qf(n,e,t,r,s,c,m){for(;null!=t;){const w=r[t.index],I=t.type;if(m&&0===e&&(w&&Ji(ri(w),r),t.flags|=4),64!=(64&t.flags))if(8&I)qf(n,e,t.child,r,s,c,!1),Gh(e,n,s,w,c);else if(32&I){const L=Fm(t,r);let U;for(;U=L();)Gh(e,n,s,U,c);Gh(e,n,s,w,c)}else 16&I?gA(n,e,r,t,s,c):Gh(e,n,s,w,c);t=m?t.projectionNext:t.next}}function zc(n,e,t,r,s,c){qf(t,r,n.firstChild,e,s,c,!1)}function gA(n,e,t,r,s,c){const m=t[16],I=m[6].projection[r.projection];if(Array.isArray(I))for(let L=0;L<I.length;L++)Gh(e,n,s,I[L],c);else qf(n,e,I,m[3],s,c,!0)}function i_(n,e,t){$r(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function qm(n,e,t){$r(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function o_(n,e,t){let r=n.length;for(;;){const s=n.indexOf(e,t);if(-1===s)return s;if(0===s||n.charCodeAt(s-1)<=32){const c=e.length;if(s+c===r||n.charCodeAt(s+c)<=32)return s}t=s+1}}const Qu="ng-template";function Zm(n,e,t){let r=0;for(;r<n.length;){let s=n[r++];if(t&&"class"===s){if(s=n[r],-1!==o_(s.toLowerCase(),e,0))return!0}else if(1===s){for(;r<n.length&&"string"==typeof(s=n[r++]);)if(s.toLowerCase()===e)return!0;return!1}}return!1}function s_(n){return 4===n.type&&n.value!==Qu}function a_(n,e,t){return e===(4!==n.type||t?n.value:Qu)}function a1(n,e,t){let r=4;const s=n.attrs||[],c=function(n){for(let e=0;e<n.length;e++)if(te(n[e]))return e;return n.length}(s);let m=!1;for(let w=0;w<e.length;w++){const I=e[w];if("number"!=typeof I){if(!m)if(4&r){if(r=2|1&r,""!==I&&!a_(n,I,t)||""===I&&1===e.length){if(Ss(r))return!1;m=!0}}else{const L=8&r?I:e[++w];if(8&r&&null!==n.attrs){if(!Zm(n.attrs,L,t)){if(Ss(r))return!1;m=!0}continue}const W=l1(8&r?"class":I,s,s_(n),t);if(-1===W){if(Ss(r))return!1;m=!0;continue}if(""!==L){let K;K=W>c?"":s[W+1].toLowerCase();const ie=8&r?K:null;if(ie&&-1!==o_(ie,L,0)||2&r&&L!==K){if(Ss(r))return!1;m=!0}}}}else{if(!m&&!Ss(r)&&!Ss(I))return!1;if(m&&Ss(I))continue;m=!1,r=I|1&r}}return Ss(r)||m}function Ss(n){return 0==(1&n)}function l1(n,e,t,r){if(null===e)return-1;let s=0;if(r||!t){let c=!1;for(;s<e.length;){const m=e[s];if(m===n)return s;if(3===m||6===m)c=!0;else{if(1===m||2===m){let w=e[++s];for(;"string"==typeof w;)w=e[++s];continue}if(4===m)break;if(0===m){s+=4;continue}}s+=c?1:2}return-1}return function(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function Ll(n,e,t=!1){for(let r=0;r<e.length;r++)if(a1(n,e[r],t))return!0;return!1}function u_(n,e){return n?":not("+e.trim()+")":e}function c1(n){let e=n[0],t=1,r=2,s="",c=!1;for(;t<n.length;){let m=n[t];if("string"==typeof m)if(2&r){const w=n[++t];s+="["+m+(w.length>0?'="'+w+'"':"")+"]"}else 8&r?s+="."+m:4&r&&(s+=" "+m);else""!==s&&!Ss(m)&&(e+=u_(c,s),s=""),r=m,c=c||!Ss(r);t++}return""!==s&&(e+=u_(c,s)),e}const cn={};function Or(n){Xf(qn(),at(),yi()+n,Tu())}function Xf(n,e,t,r){if(!r)if(3==(3&e[2])){const c=n.preOrderCheckHooks;null!==c&&Ou(e,c,t)}else{const c=n.preOrderHooks;null!==c&&Lu(e,c,0,t)}Ca(t)}function qh(n,e){return n<<17|e<<2}function to(n){return n>>17&32767}function Yf(n){return 2|n}function ta(n){return(131068&n)>>2}function Xm(n,e){return-131069&n|e<<2}function Ym(n){return 1|n}function Nl(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const s=t[r],c=t[r+1];if(-1!==c){const m=n.data[c];Pu(s),m.contentQueries(2,e[c],c)}}}function bA(n,e,t,r,s,c,m,w,I,L){const U=e.blueprint.slice();return U[0]=s,U[2]=140|r,Od(U),U[3]=U[15]=n,U[8]=t,U[10]=m||n&&n[10],U[11]=w||n&&n[11],U[12]=I||n&&n[12]||null,U[9]=L||n&&n[9]||null,U[6]=c,U[16]=2==e.type?n[16]:U,U}function Ta(n,e,t,r,s){let c=n.data[e];if(null===c)c=function(n,e,t,r,s){const c=wc(),m=Ih(),I=n.data[e]=function(n,e,t,r,s,c){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,m?c:c&&c.parent,t,e,r,s);return null===n.firstChild&&(n.firstChild=I),null!==c&&(m?null==c.child&&null!==I.parent&&(c.child=I):null===c.next&&(c.next=I)),I}(n,e,t,r,s),nn.lFrame.inI18n&&(c.flags|=64);else if(64&c.type){c.type=t,c.value=r,c.attrs=s;const m=function(){const n=nn.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();c.injectorIndex=null===m?-1:m.injectorIndex}return ys(c,!0),c}function Uc(n,e,t,r){if(0===t)return-1;const s=e.length;for(let c=0;c<t;c++)e.push(r),n.blueprint.push(r),n.data.push(null);return s}function Jo(n,e,t){Il(e);try{const r=n.viewQuery;null!==r&&Vr(1,r,t);const s=n.template;null!==s&&na(n,e,s,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Nl(n,e),n.staticViewQueries&&Vr(2,n.viewQuery,t);const c=n.components;null!==c&&function(n,e){for(let t=0;t<e.length;t++)Jn(n,e[t])}(e,c)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,Fu()}}function jc(n,e,t,r){const s=e[2];if(256==(256&s))return;Il(e);const c=Tu();try{Od(e),function(n){nn.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&na(n,e,t,2,r);const m=3==(3&s);if(!c)if(m){const L=n.preOrderCheckHooks;null!==L&&Ou(e,L,null)}else{const L=n.preOrderHooks;null!==L&&Lu(e,L,0,null),Sc(e,0)}if(function(n){for(let e=$h(n);null!==e;e=Bc(e)){if(!e[2])continue;const t=e[9];for(let r=0;r<t.length;r++){const s=t[r],c=s[3];0==(1024&s[2])&&xc(c,1),s[2]|=1024}}}(e),function(n){for(let e=$h(n);null!==e;e=Bc(e))for(let t=10;t<e.length;t++){const r=e[t],s=r[1];Th(r)&&jc(s,r,s.template,r[8])}}(e),null!==n.contentQueries&&Nl(n,e),!c)if(m){const L=n.contentCheckHooks;null!==L&&Ou(e,L)}else{const L=n.contentHooks;null!==L&&Lu(e,L,1),Sc(e,1)}!function(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const s=t[r];if(s<0)Ca(~s);else{const c=s,m=t[++r],w=t[++r];uf(m,c),w(2,e[c])}}}finally{Ca(-1)}}(n,e);const w=n.components;null!==w&&function(n,e){for(let t=0;t<e.length;t++)Qt(n,e[t])}(e,w);const I=n.viewQuery;if(null!==I&&Vr(2,I,r),!c)if(m){const L=n.viewCheckHooks;null!==L&&Ou(e,L)}else{const L=n.viewHooks;null!==L&&Lu(e,L,2),Sc(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),c||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,xc(e[3],-1))}finally{Fu()}}function ag(n,e,t,r){const s=e[10],c=!Tu(),m=El(e);try{c&&!m&&s.begin&&s.begin(),m&&Jo(n,e,r),jc(n,e,t,r)}finally{c&&!m&&s.end&&s.end()}}function na(n,e,t,r,s){const c=yi(),m=2&r;try{Ca(-1),m&&e.length>20&&Xf(n,e,20,Tu()),t(r,s)}finally{Ca(c)}}function rp(n,e,t){!Zs()||(function(n,e,t,r){const s=t.directiveStart,c=t.directiveEnd;n.firstCreatePass||xt(t,e),Ji(r,e);const m=t.initialInputs;for(let w=s;w<c;w++){const I=n.data[w],L=Xo(I);L&&Ue(e,t,I);const U=Eo(e,n,w,t);Ji(U,e),null!==m&&dt(0,w-s,U,I,0,m),L&&(wo(t.index,e)[8]=U)}}(n,e,t,Wi(t,e)),128==(128&t.flags)&&function(n,e,t){const r=t.directiveStart,s=t.directiveEnd,m=t.index,w=nn.lFrame.currentDirectiveIndex;try{Ca(m);for(let I=r;I<s;I++){const L=n.data[I],U=e[I];ku(I),(null!==L.hostBindings||0!==L.hostVars||null!==L.hostAttrs)&&oe(L,U)}}finally{Ca(-1),ku(w)}}(n,e,t))}function ip(n,e,t=Wi){const r=e.localNames;if(null!==r){let s=e.index+1;for(let c=0;c<r.length;c+=2){const m=r[c+1],w=-1===m?t(e,n):n[m];n[s++]=w}}}function CA(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=EA(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function EA(n,e,t,r,s,c,m,w,I,L){const U=20+r,W=U+s,K=function(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:cn);return t}(U,W),ie="function"==typeof L?L():L;return K[1]={type:n,blueprint:K,template:t,queries:null,viewQuery:w,declTNode:e,data:K.slice().fill(null,U),bindingStartIndex:U,expandoStartIndex:W,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof m?m():m,firstChild:null,schemas:I,consts:ie,incompleteFirstPass:!1}}function op(n,e,t,r){const s=Ri(e);null===t?s.push(r):(s.push(t),n.firstCreatePass&&Gr(n).push(r,s.length-1))}function lg(n,e,t){for(let r in n)if(n.hasOwnProperty(r)){const s=n[r];(t=null===t?{}:t).hasOwnProperty(r)?t[r].push(e,s):t[r]=[e,s]}return t}function N(n,e,t,r){let s=!1;if(Zs()){const c=function(n,e,t){const r=n.directiveRegistry;let s=null;if(r)for(let c=0;c<r.length;c++){const m=r[c];Ll(t,m.selectors,!1)&&(s||(s=[]),Mt(xt(t,e),n,m.type),Xo(m)?(xe(n,t),s.unshift(m)):s.push(m))}return s}(n,e,t),m=null===r?null:{"":-1};if(null!==c){s=!0,Be(t,n.data.length,c.length);for(let U=0;U<c.length;U++){const W=c[U];W.providersResolver&&W.providersResolver(W)}let w=!1,I=!1,L=Uc(n,e,c.length,null);for(let U=0;U<c.length;U++){const W=c[U];t.mergedAttrs=ce(t.mergedAttrs,W.hostAttrs),Ne(n,t,e,L,W),Le(L,W,m),null!==W.contentQueries&&(t.flags|=8),(null!==W.hostBindings||null!==W.hostAttrs||0!==W.hostVars)&&(t.flags|=128);const K=W.type.prototype;!w&&(K.ngOnChanges||K.ngOnInit||K.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),w=!0),!I&&(K.ngOnChanges||K.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),I=!0),L++}!function(n,e){const r=e.directiveEnd,s=n.data,c=e.attrs,m=[];let w=null,I=null;for(let L=e.directiveStart;L<r;L++){const U=s[L],W=U.inputs,K=null===c||s_(e)?null:pt(W,c);m.push(K),w=lg(W,L,w),I=lg(U.outputs,L,I)}null!==w&&(w.hasOwnProperty("class")&&(e.flags|=16),w.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=m,e.inputs=w,e.outputs=I}(n,t)}m&&function(n,e,t){if(e){const r=n.localNames=[];for(let s=0;s<e.length;s+=2){const c=t[e[s+1]];if(null==c)throw new ae("301",`Export of name '${e[s+1]}' not found!`);r.push(e[s],c)}}}(t,r,m)}return t.mergedAttrs=ce(t.mergedAttrs,t.attrs),s}function V(n,e,t,r,s,c){const m=c.hostBindings;if(m){let w=n.hostBindingOpCodes;null===w&&(w=n.hostBindingOpCodes=[]);const I=~e.index;(function(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(w)!=I&&w.push(I),w.push(r,s,m)}}function oe(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function xe(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function Le(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Xo(e)&&(t[""]=n)}}function Be(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Ne(n,e,t,r,s){n.data[r]=s;const c=s.factory||(s.factory=Cl(s.type)),m=new v(c,Xo(s),null);n.blueprint[r]=m,t[r]=m,V(n,e,0,r,Uc(n,t,s.hostVars,cn),s)}function Ue(n,e,t){const r=Wi(e,n),s=CA(t),c=n[10],m=En(n,bA(n,s,null,t.onPush?64:16,r,e,c,c.createRenderer(r,t),null,null));n[e.index]=m}function dt(n,e,t,r,s,c){const m=c[e];if(null!==m){const w=r.setInput;for(let I=0;I<m.length;){const L=m[I++],U=m[I++],W=m[I++];null!==w?r.setInput(t,W,L,U):t[U]=W}}}function pt(n,e){let t=null,r=0;for(;r<e.length;){const s=e[r];if(0!==s)if(5!==s){if("number"==typeof s)break;n.hasOwnProperty(s)&&(null===t&&(t=[]),t.push(s,n[s],e[r+1])),r+=2}else r+=2;else r+=4}return t}function rt(n,e,t,r){return new Array(n,!0,!1,e,null,0,r,t,null,null)}function Qt(n,e){const t=wo(e,n);if(Th(t)){const r=t[1];80&t[2]?jc(r,t,r.template,t[8]):t[5]>0&&St(t)}}function St(n){for(let r=$h(n);null!==r;r=Bc(r))for(let s=10;s<r.length;s++){const c=r[s];if(1024&c[2]){const m=c[1];jc(m,c,m.template,c[8])}else c[5]>0&&St(c)}const t=n[1].components;if(null!==t)for(let r=0;r<t.length;r++){const s=wo(t[r],n);Th(s)&&s[5]>0&&St(s)}}function Jn(n,e){const t=wo(e,n),r=t[1];(function(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),Jo(r,t,t[8])}function En(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function Ut(n){for(;n;){n[2]|=64;const e=dA(n);if(em(n)&&!e)return n;n=e}return null}function bi(n,e,t){const r=e[10];r.begin&&r.begin();try{jc(n,e,n.template,t)}catch(s){throw wi(e,s),s}finally{r.end&&r.end()}}function zr(n){!function(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],r=Em(t),s=r[1];ag(s,r,s.template,t)}}(n[8])}function Vr(n,e,t){Pu(0),e(n,t)}const cr=(()=>Promise.resolve(null))();function Ri(n){return n[7]||(n[7]=[])}function Gr(n){return n.cleanup||(n.cleanup=[])}function wi(n,e){const t=n[9],r=t?t.get(Oc,null):null;r&&r.handleError(e)}function ur(n,e,t,r,s){for(let c=0;c<t.length;){const m=t[c++],w=t[c++],I=e[m],L=n.data[m];null!==L.setInput?L.setInput(I,s,r,w):I[w]=s}}function Xr(n,e,t){const r=vc(e,n);!function(n,e,t){$r(n)?n.setValue(e,t):e.textContent=t}(n[11],r,t)}function Er(n,e,t){let r=t?n.styles:null,s=t?n.classes:null,c=0;if(null!==e)for(let m=0;m<e.length;m++){const w=e[m];"number"==typeof w?c=w:1==c?s=pa(s,w):2==c&&(r=pa(r,w+": "+e[++m]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=s:n.classesWithoutHost=s}const Kr=new rn("INJECTOR",-1);class Jr{get(e,t=Nu){if(t===Nu){const r=new Error(`NullInjectorError: No provider for ${sn(e)}!`);throw r.name="NullInjectorError",r}return t}}const zn=new rn("Set Injector scope."),Oi={},es={};let Ms;function Ts(){return void 0===Ms&&(Ms=new Jr),Ms}function ka(n,e=null,t=null,r){return new po(n,t,e||Ts(),r)}class po{constructor(e,t,r,s=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const c=[];t&&bs(t,w=>this.processProvider(w,e,t)),bs([e],w=>this.processInjectorType(w,[],c)),this.records.set(Kr,Gc(void 0,this));const m=this.records.get(zn);this.scope=null!=m?m.value:null,this.source=s||("object"==typeof e?null:sn(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=Nu,r=Zt.Default){this.assertNotDestroyed();const s=Pc(this),c=ma(void 0);try{if(!(r&Zt.SkipSelf)){let w=this.records.get(e);if(void 0===w){const I=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof rn}(e)&&Kn(e);w=I&&this.injectableDefInScope(I)?Gc(ra(e),Oi):null,this.records.set(e,w)}if(null!=w)return this.hydrate(e,w)}return(r&Zt.Self?Ts():this.parent).get(e,t=r&Zt.Optional&&t===Nu?null:t)}catch(m){if("NullInjectorError"===m.name){if((m[Ks]=m[Ks]||[]).unshift(sn(e)),s)throw m;return Vu(m,e,"R3InjectorError",this.source)}throw m}finally{ma(c),Pc(s)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,s)=>e.push(sn(s))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,r){if(!(e=ne(e)))return!1;let s=hc(e);const c=null==s&&e.ngModule||void 0,m=void 0===c?e:c,w=-1!==r.indexOf(m);if(void 0!==c&&(s=hc(c)),null==s)return!1;if(null!=s.imports&&!w){let U;r.push(m);try{bs(s.imports,W=>{this.processInjectorType(W,t,r)&&(void 0===U&&(U=[]),U.push(W))})}finally{}if(void 0!==U)for(let W=0;W<U.length;W++){const{ngModule:K,providers:ie}=U[W];bs(ie,fe=>this.processProvider(fe,K,ie||Hn))}}this.injectorDefTypes.add(m);const I=Cl(m)||(()=>new m);this.records.set(m,Gc(I,Oi));const L=s.providers;if(null!=L&&!w){const U=e;bs(L,W=>this.processProvider(W,U,L))}return void 0!==c&&void 0!==e.providers}processProvider(e,t,r){let s=Wh(e=ne(e))?e:ne(e&&e.provide);const c=function(n,e,t){return sp(n)?Gc(void 0,n.useValue):Gc(Zh(n),Oi)}(e);if(Wh(e)||!0!==e.multi)this.records.get(s);else{let m=this.records.get(s);m||(m=Gc(void 0,Oi,!0),m.factory=()=>Js(m.multi),this.records.set(s,m)),s=e,m.multi.push(e)}this.records.set(s,c)}hydrate(e,t){return t.value===Oi&&(t.value=es,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=ne(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function ra(n){const e=Kn(n),t=null!==e?e.factory:Cl(n);if(null!==t)return t;if(n instanceof rn)throw new Error(`Token ${sn(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const e=n.length;if(e>0){const r=function(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}(e,"?");throw new Error(`Can't resolve all parameters for ${sn(n)}: (${r.join(", ")}).`)}const t=function(n){const e=n&&(n[Go]||n[ln]);if(e){const t=function(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Error("unreachable")}function Zh(n,e,t){let r;if(Wh(n)){const s=ne(n);return Cl(s)||ra(s)}if(sp(n))r=()=>ne(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...Js(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))r=()=>yt(ne(n.useExisting));else{const s=ne(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return Cl(s)||ra(s);r=()=>new s(...Js(n.deps))}return r}function Gc(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function sp(n){return null!==n&&"object"==typeof n&&bf in n}function Wh(n){return"function"==typeof n}const i2=function(n,e,t){return function(n,e=null,t=null,r){const s=ka(n,e,t,r);return s._resolveInjectorDefTypes(),s}({name:t},e,n,t)};let Sr=(()=>{class n{static create(t,r){return Array.isArray(t)?i2(t,r,""):i2(t.providers,t.parent,t.name||"")}}return n.THROW_IF_NOT_FOUND=Nu,n.NULL=new Jr,n.\u0275prov=qt({token:n,providedIn:"any",factory:()=>yt(Kr)}),n.__NG_ELEMENT_ID__=-1,n})();function Zk(n,e){Qs(Em(n)[1],ii())}function si(n){let e=function(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let s;if(Xo(n))s=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");s=e.\u0275dir}if(s){if(t){r.push(s);const m=n;m.inputs=C1(n.inputs),m.declaredInputs=C1(n.declaredInputs),m.outputs=C1(n.outputs);const w=s.hostBindings;w&&Yk(n,w);const I=s.viewQuery,L=s.contentQueries;if(I&&Qk(n,I),L&&Xk(n,L),fa(n.inputs,s.inputs),fa(n.declaredInputs,s.declaredInputs),fa(n.outputs,s.outputs),Xo(s)&&s.data.animation){const U=n.data;U.animation=(U.animation||[]).concat(s.data.animation)}}const c=s.features;if(c)for(let m=0;m<c.length;m++){const w=c[m];w&&w.ngInherit&&w(n),w===si&&(t=!1)}}e=Object.getPrototypeOf(e)}!function(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const s=n[r];s.hostVars=e+=s.hostVars,s.hostAttrs=ce(s.hostAttrs,t=ce(t,s.hostAttrs))}}(r)}function C1(n){return n===qo?{}:n===Hn?[]:n}function Qk(n,e){const t=n.viewQuery;n.viewQuery=t?(r,s)=>{e(r,s),t(r,s)}:e}function Xk(n,e){const t=n.contentQueries;n.contentQueries=t?(r,s,c)=>{e(r,s,c),t(r,s,c)}:e}function Yk(n,e){const t=n.hostBindings;n.hostBindings=t?(r,s)=>{e(r,s),t(r,s)}:e}let D_=null;function ap(){if(!D_){const n=sr.Symbol;if(n&&n.iterator)D_=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(D_=r)}}}return D_}function dg(n){return!!E1(n)&&(Array.isArray(n)||!(n instanceof Map)&&ap()in n)}function E1(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function rs(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Ul(n,e,t,r,s,c,m,w){const I=at(),L=qn(),U=n+20,W=L.firstCreatePass?function(n,e,t,r,s,c,m,w,I){const L=e.consts,U=Ta(e,n,4,m||null,_s(L,w));N(e,t,U,_s(L,I)),Qs(e,U);const W=U.tViews=EA(2,U,r,s,c,e.directiveRegistry,e.pipeRegistry,null,e.schemas,L);return null!==e.queries&&(e.queries.template(e,U),W.queries=e.queries.embeddedTView(U)),U}(U,L,I,e,t,r,s,c,m):L.data[U];ys(W,!1);const K=I[11].createComment("");Nc(L,I,K,W),Ji(K,I),En(I,I[U]=rt(K,I,K,W)),wu(W)&&rp(L,I,W),null!=m&&ip(I,W,w)}function At(n,e=Zt.Default){const t=at();return null===t?yt(n,e):xr(ii(),t,ne(n),e)}function Hr(n,e,t){const r=at();return rs(r,Ml(),e)&&function(n,e,t,r,s,c,m,w){const I=Wi(e,t);let U,L=e.inputs;!w&&null!=L&&(U=L[r])?(ur(n,t,U,r,s),bh(e)&&function(n,e){const t=wo(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(r=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),s=null!=m?m(s,e.value||"",r):s,$r(c)?c.setProperty(I,r,s):le(r)||(I.setProperty?I.setProperty(r,s):I[r]=s))}(qn(),function(){const n=nn.lFrame;return Qi(n.tView,n.selectedIndex)}(),r,n,e,r[11],t,!1),Hr}function I1(n,e,t,r,s){const m=s?"class":"style";ur(n,t,e.inputs[m],m,r)}function dn(n,e,t,r){const s=at(),c=qn(),m=20+n,w=s[11],I=s[m]=Vf(w,e,nn.lFrame.currentNamespace),L=c.firstCreatePass?function(n,e,t,r,s,c,m){const w=e.consts,L=Ta(e,n,2,s,_s(w,c));return N(e,t,L,_s(w,m)),null!==L.attrs&&Er(L,L.attrs,!1),null!==L.mergedAttrs&&Er(L,L.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,L),L}(m,c,s,0,e,t,r):c.data[m];ys(L,!0);const U=L.mergedAttrs;null!==U&&J(w,I,U);const W=L.classes;null!==W&&qm(w,I,W);const K=L.styles;null!==K&&i_(w,I,K),64!=(64&L.flags)&&Nc(c,s,I,L),0===nn.lFrame.elementDepthCount&&Ji(I,s),nn.lFrame.elementDepthCount++,wu(L)&&(rp(c,s,L),function(n,e,t){if(Za(e)){const s=e.directiveEnd;for(let c=e.directiveStart;c<s;c++){const m=n.data[c];m.contentQueries&&m.contentQueries(1,t[c],c)}}}(c,L,s)),null!==r&&ip(s,L)}function An(){let n=ii();Ih()?nn.lFrame.isParent=!1:(n=n.parent,ys(n,!1));const e=n;nn.lFrame.elementDepthCount--;const t=qn();t.firstCreatePass&&(Qs(t,n),Za(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(e)&&I1(t,e,at(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(e)&&I1(t,e,at(),e.stylesWithoutHost,!1)}function fg(n,e,t,r){dn(n,e,t,r),An()}function pg(){return at()}function mg(n){return!!n&&"function"==typeof n.then}const T_=function(n){return!!n&&"function"==typeof n.subscribe};function Ui(n,e,t,r){const s=at(),c=qn(),m=ii();return function(n,e,t,r,s,c,m,w){const I=wu(r),U=n.firstCreatePass&&Gr(n),W=e[8],K=Ri(e);let ie=!0;if(3&r.type||w){const Re=Wi(r,e),Je=w?w(Re):Re,He=K.length,Rt=w?Gt=>w(ri(Gt[r.index])):r.index;if($r(t)){let Gt=null;if(!w&&I&&(Gt=function(n,e,t,r){const s=n.cleanup;if(null!=s)for(let c=0;c<s.length-1;c+=2){const m=s[c];if(m===t&&s[c+1]===r){const w=e[7],I=s[c+2];return w.length>I?w[I]:null}"string"==typeof m&&(c+=2)}return null}(n,e,s,r.index)),null!==Gt)(Gt.__ngLastListenerFn__||Gt).__ngNextListenerFn__=c,Gt.__ngLastListenerFn__=c,ie=!1;else{c=k1(r,e,W,c,!1);const kn=t.listen(Je,s,c);K.push(c,kn),U&&U.push(s,Rt,He,He+1)}}else c=k1(r,e,W,c,!0),Je.addEventListener(s,c,m),K.push(c),U&&U.push(s,Rt,He,m)}else c=k1(r,e,W,c,!1);const fe=r.outputs;let Ve;if(ie&&null!==fe&&(Ve=fe[s])){const Re=Ve.length;if(Re)for(let Je=0;Je<Re;Je+=2){const $i=e[Ve[Je]][Ve[Je+1]].subscribe(c),zo=K.length;K.push(c,$i),U&&U.push(s,r.index,zo,-(zo+1))}}}(c,s,s[11],m,n,e,!!t,r),Ui}function Z2(n,e,t,r){try{return!1!==t(r)}catch(s){return wi(n,s),!1}}function k1(n,e,t,r,s){return function c(m){if(m===Function)return r;const w=2&n.flags?wo(n.index,e):e;0==(32&e[2])&&Ut(w);let I=Z2(e,0,r,m),L=c.__ngNextListenerFn__;for(;L;)I=Z2(e,0,L,m)&&I,L=L.__ngNextListenerFn__;return s&&!1===I&&(m.preventDefault(),m.returnValue=!1),I}}function rl(n=1){return function(n){return(nn.lFrame.contextLView=function(n,e){for(;n>0;)e=e[15],n--;return e}(n,nn.lFrame.contextLView))[8]}(n)}function rC(n,e,t,r,s){const c=n[t+1],m=null===e;let w=r?to(c):ta(c),I=!1;for(;0!==w&&(!1===I||m);){const U=n[w+1];NP(n[w],e)&&(I=!0,n[w+1]=r?Ym(U):Yf(U)),w=r?to(U):ta(U)}I&&(n[t+1]=r?Yf(c):Ym(c))}function NP(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Ys(n,e)>=0}const mo={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function iC(n){return n.substring(mo.key,mo.keyEnd)}function zP(n){return n.substring(mo.value,mo.valueEnd)}function sC(n,e){const t=mo.textEnd;let r=mo.key=_p(n,e,t);return t===r?-1:(r=mo.keyEnd=function(n,e,t){let r;for(;e<t&&(45===(r=n.charCodeAt(e))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)e++;return e}(n,r,t),r=lC(n,r,t),r=mo.value=_p(n,r,t),r=mo.valueEnd=function(n,e,t){let r=-1,s=-1,c=-1,m=e,w=m;for(;m<t;){const I=n.charCodeAt(m++);if(59===I)return w;34===I||39===I?w=m=cC(n,I,m,t):e===m-4&&85===c&&82===s&&76===r&&40===I?w=m=cC(n,41,m,t):I>32&&(w=m),c=s,s=r,r=-33&I}return w}(n,r,t),lC(n,r,t))}function _p(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function lC(n,e,t,r){return(e=_p(n,e,t))<t&&e++,e}function cC(n,e,t,r){let s=-1,c=t;for(;c<r;){const m=n.charCodeAt(c++);if(m==e&&92!==s)return c;s=92==m&&92===s?0:m}throw new Error}function gg(n,e){return function(n,e,t,r){const s=at(),c=qn(),m=Ws(2);c.firstUpdatePass&&dC(c,n,m,r),e!==cn&&rs(s,m,e)&&fC(c,c.data[yi()],s,s[11],n,s[m+1]=function(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=sn(Cs(n)))),n}(e,t),r,m)}(n,e,null,!0),gg}function il(n){!function(n,e,t,r){const s=qn(),c=Ws(2);s.firstUpdatePass&&dC(s,null,c,r);const m=at();if(t!==cn&&rs(m,c,t)){const w=s.data[yi()];if(mC(w,r)&&!hC(s,c)){let I=r?w.classesWithoutHost:w.stylesWithoutHost;null!==I&&(t=pa(I,t||"")),I1(s,w,m,t,r)}else!function(n,e,t,r,s,c,m,w){s===cn&&(s=Hn);let I=0,L=0,U=0<s.length?s[0]:null,W=0<c.length?c[0]:null;for(;null!==U||null!==W;){const K=I<s.length?s[I+1]:void 0,ie=L<c.length?c[L+1]:void 0;let Ve,fe=null;U===W?(I+=2,L+=2,K!==ie&&(fe=W,Ve=ie)):null===W||null!==U&&U<W?(I+=2,fe=U):(L+=2,fe=W,Ve=ie),null!==fe&&fC(n,e,t,r,fe,Ve,m,w),U=I<s.length?s[I]:null,W=L<c.length?c[L]:null}}(s,w,m,m[11],m[c+1],m[c+1]=function(n,e,t){if(null==t||""===t)return Hn;const r=[],s=Cs(t);if(Array.isArray(s))for(let c=0;c<s.length;c++)n(r,s[c],!0);else if("object"==typeof s)for(const c in s)s.hasOwnProperty(c)&&n(r,c,s[c]);else"string"==typeof s&&e(r,s);return r}(n,e,t),r,c)}}(AC,HP,n,!1)}function HP(n,e){for(let t=function(n){return function(n){mo.key=0,mo.keyEnd=0,mo.value=0,mo.valueEnd=0,mo.textEnd=n.length}(n),sC(n,_p(n,0,mo.textEnd))}(e);t>=0;t=sC(e,t))AC(n,iC(e),zP(e))}function hC(n,e){return e>=n.expandoStartIndex}function dC(n,e,t,r){const s=n.data;if(null===s[t+1]){const c=s[yi()],m=hC(n,t);mC(c,r)&&null===e&&!m&&(e=!1),e=function(n,e,t,r){const s=function(n){const e=nn.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let c=r?e.residualClasses:e.residualStyles;if(null===s)0===(r?e.classBindings:e.styleBindings)&&(t=_g(t=R1(null,n,e,t,r),e.attrs,r),c=null);else{const m=e.directiveStylingLast;if(-1===m||n[m]!==s)if(t=R1(s,n,e,t,r),null===c){let I=function(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==ta(r))return n[to(r)]}(n,e,r);void 0!==I&&Array.isArray(I)&&(I=R1(null,n,e,I[1],r),I=_g(I,e.attrs,r),function(n,e,t,r){n[to(t?e.classBindings:e.styleBindings)]=r}(n,e,r,I))}else c=function(n,e,t){let r;const s=e.directiveEnd;for(let c=1+e.directiveStylingLast;c<s;c++)r=_g(r,n[c].hostAttrs,t);return _g(r,e.attrs,t)}(n,e,r)}return void 0!==c&&(r?e.residualClasses=c:e.residualStyles=c),t}(s,c,e,r),function(n,e,t,r,s,c){let m=c?e.classBindings:e.styleBindings,w=to(m),I=ta(m);n[r]=t;let U,L=!1;if(Array.isArray(t)){const W=t;U=W[1],(null===U||Ys(W,U)>0)&&(L=!0)}else U=t;if(s)if(0!==I){const K=to(n[w+1]);n[r+1]=qh(K,w),0!==K&&(n[K+1]=Xm(n[K+1],r)),n[w+1]=function(n,e){return 131071&n|e<<17}(n[w+1],r)}else n[r+1]=qh(w,0),0!==w&&(n[w+1]=Xm(n[w+1],r)),w=r;else n[r+1]=qh(I,0),0===w?w=r:n[I+1]=Xm(n[I+1],r),I=r;L&&(n[r+1]=Yf(n[r+1])),rC(n,U,r,!0),rC(n,U,r,!1),function(n,e,t,r,s){const c=s?n.residualClasses:n.residualStyles;null!=c&&"string"==typeof e&&Ys(c,e)>=0&&(t[r+1]=Ym(t[r+1]))}(e,U,n,r,c),m=qh(w,I),c?e.classBindings=m:e.styleBindings=m}(s,c,e,t,m,r)}}function R1(n,e,t,r,s){let c=null;const m=t.directiveEnd;let w=t.directiveStylingLast;for(-1===w?w=t.directiveStart:w++;w<m&&(c=e[w],r=_g(r,c.hostAttrs,s),c!==n);)w++;return null!==n&&(t.directiveStylingLast=w),r}function _g(n,e,t){const r=t?1:2;let s=-1;if(null!==e)for(let c=0;c<e.length;c++){const m=e[c];"number"==typeof m?s=m:s===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Ti(n,m,!!t||e[++c]))}return void 0===n?null:n}function AC(n,e,t){Ti(n,e,Cs(t))}function fC(n,e,t,r,s,c,m,w){if(!(3&e.type))return;const I=n.data,L=I[w+1];I_(function(n){return 1==(1&n)}(L)?pC(I,e,t,s,ta(L),m):void 0)||(I_(c)||function(n){return 2==(2&n)}(L)&&(c=pC(I,null,t,s,w,m)),function(n,e,t,r,s){const c=$r(n);if(e)s?c?n.addClass(t,r):t.classList.add(r):c?n.removeClass(t,r):t.classList.remove(r);else{let m=-1===r.indexOf("-")?void 0:Es.DashCase;if(null==s)c?n.removeStyle(t,r,m):t.style.removeProperty(r);else{const w="string"==typeof s&&s.endsWith("!important");w&&(s=s.slice(0,-10),m|=Es.Important),c?n.setStyle(t,r,s,m):t.style.setProperty(r,s,w?"important":"")}}}(r,m,vc(yi(),t),s,c))}function pC(n,e,t,r,s,c){const m=null===e;let w;for(;s>0;){const I=n[s],L=Array.isArray(I),U=L?I[1]:I,W=null===U;let K=t[s+1];K===cn&&(K=W?Hn:void 0);let ie=W?Ea(K,r):U===r?K:void 0;if(L&&!I_(ie)&&(ie=Ea(I,r)),I_(ie)&&(w=ie,m))return w;const fe=n[s+1];s=m?to(fe):ta(fe)}if(null!==e){let I=c?e.residualClasses:e.residualStyles;null!=I&&(w=Ea(I,r))}return w}function I_(n){return void 0!==n}function mC(n,e){return 0!=(n.flags&(e?16:32))}function Mo(n,e=""){const t=at(),r=qn(),s=n+20,c=r.firstCreatePass?Ta(r,s,1,e,null):r.data[s],m=t[s]=function(n,e){return $r(n)?n.createText(e):n.createTextNode(e)}(t[11],e);Nc(r,t,m,c),ys(c,!1)}function MA(n){return k_("",n,""),MA}function k_(n,e,t){const r=at(),s=function(n,e,t,r){return rs(n,Ml(),t)?e+we(t)+r:cn}(r,n,e,t);return s!==cn&&Xr(r,yi(),s),k_}const TA=void 0;var yR=["en",[["a","p"],["AM","PM"],TA],[["AM","PM"],TA,TA],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],TA,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],TA,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",TA,"{1} 'at' {0}",TA],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let yp={};function LC(n){return n in yp||(yp[n]=sr.ng&&sr.ng.common&&sr.ng.common.locales&&sr.ng.common.locales[n]),yp[n]}var Bt=(()=>((Bt=Bt||{})[Bt.LocaleId=0]="LocaleId",Bt[Bt.DayPeriodsFormat=1]="DayPeriodsFormat",Bt[Bt.DayPeriodsStandalone=2]="DayPeriodsStandalone",Bt[Bt.DaysFormat=3]="DaysFormat",Bt[Bt.DaysStandalone=4]="DaysStandalone",Bt[Bt.MonthsFormat=5]="MonthsFormat",Bt[Bt.MonthsStandalone=6]="MonthsStandalone",Bt[Bt.Eras=7]="Eras",Bt[Bt.FirstDayOfWeek=8]="FirstDayOfWeek",Bt[Bt.WeekendRange=9]="WeekendRange",Bt[Bt.DateFormat=10]="DateFormat",Bt[Bt.TimeFormat=11]="TimeFormat",Bt[Bt.DateTimeFormat=12]="DateTimeFormat",Bt[Bt.NumberSymbols=13]="NumberSymbols",Bt[Bt.NumberFormats=14]="NumberFormats",Bt[Bt.CurrencyCode=15]="CurrencyCode",Bt[Bt.CurrencySymbol=16]="CurrencySymbol",Bt[Bt.CurrencyName=17]="CurrencyName",Bt[Bt.Currencies=18]="Currencies",Bt[Bt.Directionality=19]="Directionality",Bt[Bt.PluralCase=20]="PluralCase",Bt[Bt.ExtraData=21]="ExtraData",Bt))();const P_="en-US";let BC=P_;function O1(n){Ht(n,"Expected localeId to be defined"),"string"==typeof n&&(BC=n.toLowerCase().replace(/_/g,"-"))}function N1(n,e,t,r,s){if(n=ne(n),Array.isArray(n))for(let c=0;c<n.length;c++)N1(n[c],e,t,r,s);else{const c=qn(),m=at();let w=Wh(n)?n:ne(n.provide),I=Zh(n);const L=ii(),U=1048575&L.providerIndexes,W=L.directiveStart,K=L.providerIndexes>>20;if(Wh(n)||!n.multi){const ie=new v(I,s,At),fe=V1(w,e,s?U:U+K,W);-1===fe?(Mt(xt(L,m),c,w),z1(c,n,e.length),e.push(w),L.directiveStart++,L.directiveEnd++,s&&(L.providerIndexes+=1048576),t.push(ie),m.push(ie)):(t[fe]=ie,m[fe]=ie)}else{const ie=V1(w,e,U+K,W),fe=V1(w,e,U,U+K),Ve=ie>=0&&t[ie],Re=fe>=0&&t[fe];if(s&&!Re||!s&&!Ve){Mt(xt(L,m),c,w);const Je=function(n,e,t,r,s){const c=new v(n,t,At);return c.multi=[],c.index=e,c.componentProviders=0,aE(c,s,r&&!t),c}(s?m3:p3,t.length,s,r,I);!s&&Re&&(t[fe].providerFactory=Je),z1(c,n,e.length,0),e.push(w),L.directiveStart++,L.directiveEnd++,s&&(L.providerIndexes+=1048576),t.push(Je),m.push(Je)}else z1(c,n,ie>-1?ie:fe,aE(t[s?fe:ie],I,!s&&r));!s&&r&&Re&&t[fe].componentProviders++}}}function z1(n,e,t,r){const s=Wh(e);if(s||function(n){return!!n.useClass}(e)){const m=(e.useClass||e).prototype.ngOnDestroy;if(m){const w=n.destroyHooks||(n.destroyHooks=[]);if(!s&&e.multi){const I=w.indexOf(t);-1===I?w.push(t,[r,m]):w[I+1].push(r,m)}else w.push(t,m)}}}function aE(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function V1(n,e,t,r){for(let s=t;s<r;s++)if(e[s]===n)return s;return-1}function p3(n,e,t,r){return U1(this.multi,[])}function m3(n,e,t,r){const s=this.multi;let c;if(this.providerFactory){const m=this.providerFactory.componentProviders,w=Eo(t,t[1],this.providerFactory.index,r);c=w.slice(0,m),U1(s,c);for(let I=m;I<w.length;I++)c.push(w[I])}else c=[],U1(s,c);return c}function U1(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function ai(n,e=[]){return t=>{t.providersResolver=(r,s)=>function(n,e,t){const r=qn();if(r.firstCreatePass){const s=Xo(n);N1(t,r.data,r.blueprint,s,!0),N1(e,r.data,r.blueprint,s,!1)}}(r,s?s(n):n,e)}}class lE{}const uE="ngComponent";class y3{resolveComponentFactory(e){throw function(n){const e=Error(`No component factory found for ${sn(n)}. Did you add it to @NgModule.entryComponents?`);return e[uE]=n,e}(e)}}let IA=(()=>{class n{}return n.NULL=new y3,n})();function B_(...n){}function xp(n,e){return new To(Wi(n,e))}const b3=function(){return xp(ii(),at())};let To=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=b3,n})();function hE(n){return n instanceof To?n.nativeElement:n}class N_{}let eh=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>C3(),n})();const C3=function(){const n=at(),t=wo(ii().index,n);return function(n){return n[11]}(gs(t)?t:n)};let $1=(()=>{class n{}return n.\u0275prov=qt({token:n,providedIn:"root",factory:()=>null}),n})();class wg{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const dE=new wg("12.2.12");class AE{constructor(){}supports(e){return dg(e)}create(e){return new M3(e)}}const S3=(n,e)=>e;class M3{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||S3}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,s=0,c=null;for(;t||r;){const m=!r||t&&t.currentIndex<pE(r,s,c)?t:r,w=pE(m,s,c),I=m.currentIndex;if(m===r)s--,r=r._nextRemoved;else if(t=t._next,null==m.previousIndex)s++;else{c||(c=[]);const L=w-s,U=I-s;if(L!=U){for(let K=0;K<L;K++){const ie=K<c.length?c[K]:c[K]=0,fe=ie+K;U<=fe&&fe<L&&(c[K]=ie+1)}c[m.previousIndex]=U-L}}w!==I&&e(m,w,I)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!dg(e))throw new Error(`Error trying to diff '${sn(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let s,c,m,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let w=0;w<this.length;w++)c=e[w],m=this._trackByFn(w,c),null!==t&&Object.is(t.trackById,m)?(r&&(t=this._verifyReinsertion(t,c,m,w)),Object.is(t.item,c)||this._addIdentityChange(t,c)):(t=this._mismatch(t,c,m,w),r=!0),t=t._next}else s=0,function(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[ap()]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,w=>{m=this._trackByFn(s,w),null!==t&&Object.is(t.trackById,m)?(r&&(t=this._verifyReinsertion(t,w,m,s)),Object.is(t.item,w)||this._addIdentityChange(t,w)):(t=this._mismatch(t,w,m,s),r=!0),t=t._next,s++}),this.length=s;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,s){let c;return null===e?c=this._itTail:(c=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,c,s)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,s))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,c,s)):e=this._addAfter(new T3(t,r),c,s),e}_verifyReinsertion(e,t,r,s){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==c?e=this._reinsertAfter(c,e._prev,s):e.currentIndex!=s&&(e.currentIndex=s,this._addToMoves(e,s)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const s=e._prevRemoved,c=e._nextRemoved;return null===s?this._removalsHead=c:s._nextRemoved=c,null===c?this._removalsTail=s:c._prevRemoved=s,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const s=null===t?this._itHead:t._next;return e._next=s,e._prev=t,null===s?this._itTail=e:s._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new fE),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new fE),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class T3{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class I3{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class fE{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new I3,this.map.set(t,r)),r.add(e)}get(e,t){const s=this.map.get(e);return s?s.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function pE(n,e,t){const r=n.previousIndex;if(null===r)return r;let s=0;return t&&r<t.length&&(s=t[r]),r+e+s}class mE{constructor(){}supports(e){return e instanceof Map||E1(e)}create(){return new k3}}class k3{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||E1(e)))throw new Error(`Error trying to diff '${sn(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,s)=>{if(t&&t.key===s)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const c=this._getOrCreateRecordForKey(s,r);t=this._insertBeforeOrAppend(t,c)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const s=this._records.get(e);this._maybeAddToChanges(s,t);const c=s._prev,m=s._next;return c&&(c._next=m),m&&(m._prev=c),s._next=null,s._prev=null,s}const r=new P3(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class P3{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function gE(){return new Cg([new AE])}let Cg=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const s=r.factories.slice();t=t.concat(s)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||gE()),deps:[[n,new xi,new Ko]]}}find(t){const r=this.factories.find(s=>s.supports(t));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'`)}}return n.\u0275prov=qt({token:n,providedIn:"root",factory:gE}),n})();function _E(){return new bp([new mE])}let bp=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(r){const s=r.factories.slice();t=t.concat(s)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||_E()),deps:[[n,new xi,new Ko]]}}find(t){const r=this.factories.find(s=>s.supports(t));if(r)return r;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return n.\u0275prov=qt({token:n,providedIn:"root",factory:_E}),n})();function z_(n,e,t,r,s=!1){for(;null!==t;){const c=e[t.index];if(null!==c&&r.push(ri(c)),Fo(c))for(let w=10;w<c.length;w++){const I=c[w],L=I[1].firstChild;null!==L&&z_(I[1],I,L,r)}const m=t.type;if(8&m)z_(n,e,t.child,r);else if(32&m){const w=Fm(t,e);let I;for(;I=w();)r.push(I)}else if(16&m){const w=Hm(e,t);if(Array.isArray(w))r.push(...w);else{const I=dA(e[16]);z_(I[1],I,w,r,!0)}}t=s?t.projectionNext:t.next}return r}class Eg{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return z_(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Fo(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(jf(e,r),Tc(t,r))}this._attachedToViewContainer=!1}Y0(this._lView[1],this._lView)}onDestroy(e){op(this._lView[1],this._lView,null,e)}markForCheck(){Ut(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){bi(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,e,t){Ya(!0);try{bi(n,e,t)}finally{Ya(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,e){zc(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class F3 extends Eg{constructor(e){super(e),this._view=e}detectChanges(){zr(this._view)}checkNoChanges(){!function(n){Ya(!0);try{zr(n)}finally{Ya(!1)}}(this._view)}get context(){return null}}const L3=function(n){return function(n,e,t){if(bh(n)&&!t){const r=wo(n.index,e);return new Eg(r,r)}return 47&n.type?new Eg(e[16],e):null}(ii(),at(),16==(16&n))};let G1=(()=>{class n{}return n.__NG_ELEMENT_ID__=L3,n})();const z3=[new mE],U3=new Cg([new AE]),j3=new bp(z3),G3=function(){return V_(ii(),at())};let th=(()=>{class n{}return n.__NG_ELEMENT_ID__=G3,n})();const H3=th,q3=class extends H3{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=bA(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(r[19]=c.createEmbeddedView(t)),Jo(t,r,e),new Eg(r)}};function V_(n,e){return 4&n.type?new q3(e,n,xp(n,e)):null}class Qc{}class yE{}const Q3=function(){return bE(ii(),at())};let Gl=(()=>{class n{}return n.__NG_ELEMENT_ID__=Q3,n})();const Y3=Gl,vE=class extends Y3{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return xp(this._hostTNode,this._hostLView)}get injector(){return new Do(this._hostTNode,this._hostLView)}get parentInjector(){const e=ht(this._hostTNode,this._hostLView);if(se(e)){const t=ve(e,this._hostLView),r=ue(e);return new Do(t[1].data[r+8],t)}return new Do(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=xE(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){const s=e.createEmbeddedView(t||{});return this.insert(s,r),s}createComponent(e,t,r,s,c){const m=r||this.parentInjector;if(!c&&null==e.ngModule&&m){const I=m.get(Qc,null);I&&(c=I)}const w=e.create(m,s,void 0,c);return this.insert(w.hostView,t),w}insert(e,t){const r=e._lView,s=r[1];if(function(n){return Fo(n[3])}(r)){const U=this.indexOf(e);if(-1!==U)this.detach(U);else{const W=r[3],K=new vE(W,W[6],W[3]);K.detach(K.indexOf(e))}}const c=this._adjustIndex(t),m=this._lContainer;!function(n,e,t,r){const s=10+r,c=t.length;r>0&&(t[s-1][4]=e),r<c-10?(e[4]=t[s],Zd(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const m=e[17];null!==m&&t!==m&&function(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(m,e);const w=e[19];null!==w&&w.insertView(n),e[2]|=128}(s,r,m,c);const w=mA(c,m),I=r[11],L=fA(I,m[7]);return null!==L&&function(n,e,t,r,s,c){r[0]=s,r[6]=e,zc(n,r,t,1,s,c)}(s,m[6],I,r,L,w),e.attachToViewContainerRef(),Zd(H1(m),c,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=xE(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=jf(this._lContainer,t);r&&(Tc(H1(this._lContainer),t),Y0(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=jf(this._lContainer,t);return r&&null!=Tc(H1(this._lContainer),t)?new Eg(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function xE(n){return n[8]}function H1(n){return n[8]||(n[8]=[])}function bE(n,e){let t;const r=e[n.index];if(Fo(r))t=r;else{let s;if(8&n.type)s=ri(r);else{const c=e[11];s=c.createComment("");const m=Wi(n,e);Zu(c,fA(c,m),s,function(n,e){return $r(n)?n.nextSibling(e):e.nextSibling}(c,m),!1)}e[n.index]=t=rt(r,e,s,n),En(e,t)}return new vE(t,n,e)}const Dp={};class jE extends IA{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Mi(e);return new GE(t,this.ngModule)}}function $E(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}const ZF=new rn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Im});class GE extends lE{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function(n){return n.map(c1).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return $E(this.componentDef.inputs)}get outputs(){return $E(this.componentDef.outputs)}create(e,t,r,s){const c=(s=s||this.ngModule)?function(n,e){return{get:(t,r,s)=>{const c=n.get(t,Dp,s);return c!==Dp||r===Dp?c:e.get(t,r,s)}}}(e,s.injector):e,m=c.get(N_,Xa),w=c.get($1,null),I=m.createRenderer(null,this.componentDef),L=this.componentDef.selectors[0][0]||"div",U=r?function(n,e,t){if($r(n))return n.selectRootElement(e,t===Ar.ShadowDom);let r="string"==typeof e?n.querySelector(e):e;return r.textContent="",r}(I,r,this.componentDef.encapsulation):Vf(m.createRenderer(null,this.componentDef),L,function(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(L)),W=this.componentDef.onPush?576:528,K=function(n,e){return{components:[],scheduler:n||Im,clean:cr,playerHandler:e||null,flags:0}}(),ie=EA(0,null,null,1,0,null,null,null,null,null),fe=bA(null,ie,K,W,null,null,m,I,w,c);let Ve,Re;Il(fe);try{const Je=function(n,e,t,r,s,c){const m=t[1];t[20]=n;const I=Ta(m,20,2,"#host",null),L=I.mergedAttrs=e.hostAttrs;null!==L&&(Er(I,L,!0),null!==n&&(J(s,n,L),null!==I.classes&&qm(s,n,I.classes),null!==I.styles&&i_(s,n,I.styles)));const U=r.createRenderer(n,e),W=bA(t,CA(e),null,e.onPush?64:16,t[20],I,r,U,c||null,null);return m.firstCreatePass&&(Mt(xt(I,t),m,e.type),xe(m,I),Be(I,t.length,1)),En(t,W),t[20]=W}(U,this.componentDef,fe,m,I);if(U)if(r)J(I,U,["ng-version",dE.full]);else{const{attrs:He,classes:Rt}=function(n){const e=[],t=[];let r=1,s=2;for(;r<n.length;){let c=n[r];if("string"==typeof c)2===s?""!==c&&e.push(c,n[++r]):8===s&&t.push(c);else{if(!Ss(s))break;s=c}r++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);He&&J(I,U,He),Rt&&Rt.length>0&&qm(I,U,Rt.join(" "))}if(Re=Qi(ie,20),void 0!==t){const He=Re.projection=[];for(let Rt=0;Rt<this.ngContentSelectors.length;Rt++){const Gt=t[Rt];He.push(null!=Gt?Array.from(Gt):null)}}Ve=function(n,e,t,r,s){const c=t[1],m=function(n,e,t){const r=ii();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),Ne(n,r,e,Uc(n,e,1,null),t));const s=Eo(e,n,r.directiveStart,r);Ji(s,e);const c=Wi(r,e);return c&&Ji(c,e),s}(c,t,e);if(r.components.push(m),n[8]=m,s&&s.forEach(I=>I(m,e)),e.contentQueries){const I=ii();e.contentQueries(1,m,I.directiveStart)}const w=ii();return!c.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Ca(w.index),V(t[1],w,0,w.directiveStart,w.directiveEnd,e),oe(e,m)),m}(Je,this.componentDef,fe,K,[Zk]),Jo(ie,fe,null)}finally{Fu()}return new XF(this.componentType,Ve,xp(Re,fe),fe,Re)}}class XF extends class{}{constructor(e,t,r,s,c){super(),this.location=r,this._rootLView=s,this._tNode=c,this.instance=t,this.hostView=this.changeDetectorRef=new F3(s),this.componentType=e}get injector(){return new Do(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const Sp=new Map;class JF extends Qc{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new jE(this);const r=xo(e),s=function(n){return n[Dd]||null}(e);s&&O1(s),this._bootstrapComponents=Ma(r.bootstrap),this._r3Injector=ka(e,t,[{provide:Qc,useValue:this},{provide:IA,useValue:this.componentFactoryResolver}],sn(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=Sr.THROW_IF_NOT_FOUND,r=Zt.Default){return e===Sr||e===Qc||e===Kr?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class ix extends yE{constructor(e){super(),this.moduleType=e,null!==xo(e)&&function(n){const e=new Set;!function t(r){const s=xo(r,!0),c=s.id;null!==c&&(function(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${sn(e)} vs ${sn(e.name)}`)}(c,Sp.get(c),r),Sp.set(c,r));const m=Ma(s.imports);for(const w of m)e.has(w)||(e.add(w),t(w))}(n)}(e)}create(e){return new JF(this.moduleType,e)}}function Rg(n,e,t,r){return function(n,e,t,r,s,c){const m=e+t;return rs(n,m,s)?function(n,e,t){return n[e]=t}(n,m+1,c?r.call(c,s):r(s)):function(n,e){const t=n[e];return t===cn?void 0:t}(n,m+1)}(at(),function(){const n=nn.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}(),n,e,t,r)}function ox(n){return e=>{setTimeout(n,void 0,e)}}const lt=class extends co{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var s,c,m;let w=e,I=t||(()=>null),L=r;if(e&&"object"==typeof e){const W=e;w=null===(s=W.next)||void 0===s?void 0:s.bind(W),I=null===(c=W.error)||void 0===c?void 0:c.bind(W),L=null===(m=W.complete)||void 0===m?void 0:m.bind(W)}this.__isAsync&&(I=ox(I),w&&(w=ox(w)),L&&(L=ox(L)));const U=super.subscribe({next:w,error:I,complete:L});return e instanceof Ct&&e.add(U),U}};function gO(){return this._results[ap()]()}class H_{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=ap(),r=H_.prototype;r[t]||(r[t]=gO)}get changes(){return this._changes||(this._changes=new lt)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const s=Vi(e);(this._changesDetected=!function(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let s=n[r],c=e[r];if(t&&(s=t(s),c=t(c)),c!==s)return!1}return!0}(r._results,s,t))&&(r._results=s,r.length=s.length,r.last=s[this.length-1],r.first=s[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class sx{constructor(e){this.queryList=e,this.matches=null}clone(){return new sx(this.queryList)}setDirty(){this.queryList.setDirty()}}class ax{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,s=[];for(let c=0;c<r;c++){const m=t.getByIndex(c);s.push(this.queries[m.indexInDeclarationView].clone())}return new ax(s)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==nD(e,t).matches&&this.queries[t].setDirty()}}class KE{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class lx{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const s=null!==t?t.length:0,c=this.getByIndex(r).embeddedTView(e,s);c&&(c.indexInDeclarationView=r,null!==t?t.push(c):t=[c])}return null!==t?new lx(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class cx{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new cx(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let s=0;s<r.length;s++){const c=r[s];this.matchTNodeWithReadOption(e,t,vO(t,c)),this.matchTNodeWithReadOption(e,t,Ao(t,e,c,!1,!1))}else r===th?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Ao(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const s=this.metadata.read;if(null!==s)if(s===To||s===Gl||s===th&&4&t.type)this.addMatch(t.index,-2);else{const c=Ao(t,e,s,!1,!1);null!==c&&this.addMatch(t.index,c)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function vO(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function bO(n,e,t,r){return-1===t?function(n,e){return 11&n.type?xp(n,e):4&n.type?V_(n,e):null}(e,n):-2===t?function(n,e,t){return t===To?xp(e,n):t===th?V_(e,n):t===Gl?bE(e,n):void 0}(n,e,r):Eo(n,n[1],t,e)}function JE(n,e,t,r){const s=e[19].queries[r];if(null===s.matches){const c=n.data,m=t.matches,w=[];for(let I=0;I<m.length;I+=2){const L=m[I];w.push(L<0?null:bO(e,c[L],m[I+1],t.metadata.read))}s.matches=w}return s.matches}function ux(n,e,t,r){const s=n.queries.getByIndex(t),c=s.matches;if(null!==c){const m=JE(n,e,s,t);for(let w=0;w<c.length;w+=2){const I=c[w];if(I>0)r.push(m[w/2]);else{const L=c[w+1],U=e[-I];for(let W=10;W<U.length;W++){const K=U[W];K[17]===K[3]&&ux(K[1],K,L,r)}if(null!==U[9]){const W=U[9];for(let K=0;K<W.length;K++){const ie=W[K];ux(ie[1],ie,L,r)}}}}}return r}function Bg(n){const e=at(),t=qn(),r=kh();Pu(r+1);const s=nD(t,r);if(n.dirty&&El(e)===(2==(2&s.metadata.flags))){if(null===s.matches)n.reset([]);else{const c=s.crossesNgTemplate?ux(t,e,r,[]):JE(t,e,s,r);n.reset(c,hE),n.notifyOnChanges()}return!0}return!1}function hx(n,e,t){const r=qn();r.firstCreatePass&&(function(n,e,t){null===n.queries&&(n.queries=new lx),n.queries.track(new cx(e,t))}(r,new KE(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function(n,e,t){const r=new H_(4==(4&t));op(n,e,r,r.destroy),null===e[19]&&(e[19]=new ax),e[19].queries.push(new sx(r))}(r,at(),e)}function Ng(){return function(n,e){return n[19].queries[e].queryList}(at(),kh())}function nD(n,e){return n.queries.getByIndex(e)}const Vg=new rn("Application Initializer");let Tp=(()=>{class n{constructor(t){this.appInits=t,this.resolve=B_,this.reject=B_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,s)=>{this.resolve=r,this.reject=s})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let s=0;s<this.appInits.length;s++){const c=this.appInits[s]();if(mg(c))t.push(c);else if(T_(c)){const m=new Promise((w,I)=>{c.subscribe({complete:w,error:I})});t.push(m)}}Promise.all(t).then(()=>{r()}).catch(s=>{this.reject(s)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(yt(Vg,8))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const Ug=new rn("AppId"),JO={provide:Ug,useFactory:function(){return`${_x()}${_x()}${_x()}`},deps:[]};function _x(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const vD=new rn("Platform Initializer"),W_=new rn("Platform ID"),xD=new rn("appBootstrapListener");let Q_=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const Xh=new rn("LocaleId"),bD=new rn("DefaultCurrencyCode");class tL{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const yx=function(n){return new ix(n)},nL=yx,rL=function(n){return Promise.resolve(yx(n))},wD=function(n){const e=yx(n),r=Ma(xo(n).declarations).reduce((s,c)=>{const m=Mi(c);return m&&s.push(new GE(m)),s},[]);return new tL(e,r)},iL=wD,oL=function(n){return Promise.resolve(wD(n))};let RA=(()=>{class n{constructor(){this.compileModuleSync=nL,this.compileModuleAsync=rL,this.compileModuleAndAllComponentsSync=iL,this.compileModuleAndAllComponentsAsync=oL}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const lL=(()=>Promise.resolve(0))();function vx(n){"undefined"==typeof Zone?lL.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Ei{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new lt(!1),this.onMicrotaskEmpty=new lt(!1),this.onStable=new lt(!1),this.onError=new lt(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&t,s.shouldCoalesceRunChangeDetection=r,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function(){let n=sr.requestAnimationFrame,e=sr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(n){const e=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(sr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,bx(n),n.isCheckStableRunning=!0,xx(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),bx(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,s,c,m,w)=>{try{return CD(n),t.invokeTask(s,c,m,w)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||n.shouldCoalesceRunChangeDetection)&&e(),ED(n)}},onInvoke:(t,r,s,c,m,w,I)=>{try{return CD(n),t.invoke(s,c,m,w,I)}finally{n.shouldCoalesceRunChangeDetection&&e(),ED(n)}},onHasTask:(t,r,s,c)=>{t.hasTask(s,c),r===s&&("microTask"==c.change?(n._hasPendingMicrotasks=c.microTask,bx(n),xx(n)):"macroTask"==c.change&&(n.hasPendingMacrotasks=c.macroTask))},onHandleError:(t,r,s,c)=>(t.handleError(s,c),n.runOutsideAngular(()=>n.onError.emit(c)),!1)})}(s)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ei.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ei.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,s){const c=this._inner,m=c.scheduleEventTask("NgZoneEvent: "+s,e,uL,B_,B_);try{return c.runTask(m,t,r)}finally{c.cancelTask(m)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const uL={};function xx(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function bx(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function CD(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function ED(n){n._nesting--,xx(n)}class AL{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new lt,this.onMicrotaskEmpty=new lt,this.onStable=new lt,this.onError=new lt}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,s){return e.apply(t,r)}}let wx=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ei.assertNotInAngularZone(),vx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())vx(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,s){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(m=>m.timeoutId!==c),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:c,updateCb:s})}whenStable(t,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,r,s){return[]}}return n.\u0275fac=function(t){return new(t||n)(yt(Ei))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),DD=(()=>{class n{constructor(){this._applications=new Map,Cx.addToWindow(this)}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return Cx.findTestabilityInTree(this,t,r)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();class fL{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let Cx=new fL,SD=!0,MD=!1;let Zl;const ID=new rn("AllowMultipleToken");class Ex{constructor(e,t){this.name=e,this.token=t}}function kD(n,e,t=[]){const r=`Platform: ${e}`,s=new rn(r);return(c=[])=>{let m=PD();if(!m||m.injector.get(ID,!1))if(n)n(t.concat(c).concat({provide:s,useValue:!0}));else{const w=t.concat(c).concat({provide:s,useValue:!0},{provide:zn,useValue:"platform"});!function(n){if(Zl&&!Zl.destroyed&&!Zl.injector.get(ID,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Zl=n.get(RD);const e=n.get(vD,null);e&&e.forEach(t=>t())}(Sr.create({providers:w,name:r}))}return function(n){const e=PD();if(!e)throw new Error("No platform exists!");if(!e.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(s)}}function PD(){return Zl&&!Zl.destroyed?Zl:null}let RD=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const w=function(n,e){let t;return t="noop"===n?new AL:("zone.js"===n?void 0:n)||new Ei({enableLongStackTrace:(MD=!0,SD),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),I=[{provide:Ei,useValue:w}];return w.run(()=>{const L=Sr.create({providers:I,parent:this.injector,name:t.moduleType.name}),U=t.create(L),W=U.injector.get(Oc,null);if(!W)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return w.runOutsideAngular(()=>{const K=w.onError.subscribe({next:ie=>{W.handleError(ie)}});U.onDestroy(()=>{Dx(this._modules,U),K.unsubscribe()})}),function(n,e,t){try{const r=t();return mg(r)?r.catch(s=>{throw e.runOutsideAngular(()=>n.handleError(s)),s}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(W,w,()=>{const K=U.injector.get(Tp);return K.runInitializers(),K.donePromise.then(()=>(O1(U.injector.get(Xh,P_)||P_),this._moduleDoBootstrap(U),U))})})}bootstrapModule(t,r=[]){const s=FD({},r);return function(n,e,t){const r=new ix(t);return Promise.resolve(r)}(0,0,t).then(c=>this.bootstrapModuleFactory(c,s))}_moduleDoBootstrap(t){const r=t.injector.get(Ip);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${sn(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(yt(Sr))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function FD(n,e){return Array.isArray(e)?e.reduce(FD,n):Object.assign(Object.assign({},n),e)}let Ip=(()=>{class n{constructor(t,r,s,c,m){this._zone=t,this._injector=r,this._exceptionHandler=s,this._componentFactoryResolver=c,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new jn(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),I=new jn(L=>{let U;this._zone.runOutsideAngular(()=>{U=this._zone.onStable.subscribe(()=>{Ei.assertNotInAngularZone(),vx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const W=this._zone.onUnstable.subscribe(()=>{Ei.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{U.unsubscribe(),W.unsubscribe()}});this.isStable=function(...n){let e=Number.POSITIVE_INFINITY,t=null,r=n[n.length-1];return As(r)?(t=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(e=n.pop())):"number"==typeof r&&(e=n.pop()),null===t&&1===n.length&&n[0]instanceof jn?n[0]:jo(e)(vo(n,t))}(w,I.pipe(n=>gl()(function(n,e){return function(r){let s;s="function"==typeof n?n:function(){return n};const c=Object.create(r,ph);return c.source=r,c.subjectFactory=s,c}}(mh)(n))))}bootstrap(t,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let s;s=t instanceof lE?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(s.componentType);const c=function(n){return n.isBoundToModule}(s)?void 0:this._injector.get(Qc),w=s.create(Sr.NULL,[],r||s.selector,c),I=w.location.nativeElement,L=w.injector.get(wx,null),U=L&&w.injector.get(DD);return L&&U&&U.registerApplication(I,L),w.onDestroy(()=>{this.detachView(w.hostView),Dx(this.components,w),U&&U.unregisterApplication(I)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;Dx(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(xD,[]).concat(this._bootstrapListeners).forEach(s=>s(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(yt(Ei),yt(Sr),yt(Oc),yt(IA),yt(Tp))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function Dx(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class Y_{}class TL{}const IL={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let kL=(()=>{class n{constructor(t,r){this._compiler=t,this._config=r||IL}load(t){return this.loadAndCompile(t)}loadAndCompile(t){let[r,s]=t.split("#");return void 0===s&&(s="default"),Ra(255)(r).then(c=>c[s]).then(c=>ND(c,r,s)).then(c=>this._compiler.compileModuleAsync(c))}loadFactory(t){let[r,s]=t.split("#"),c="NgFactory";return void 0===s&&(s="default",c=""),Ra(255)(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(m=>m[s+c]).then(m=>ND(m,r,s))}}return n.\u0275fac=function(t){return new(t||n)(yt(RA),yt(TL,8))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function ND(n,e,t){if(!n)throw new Error(`Cannot find '${t}' in '${e}'`);return n}const UL=kD(null,"core",[{provide:W_,useValue:"unknown"},{provide:RD,deps:[Sr]},{provide:DD,deps:[]},{provide:Q_,deps:[]}]),qL=[{provide:Ip,useClass:Ip,deps:[Ei,Sr,Oc,IA,Tp]},{provide:ZF,deps:[Ei],useFactory:function(n){let e=[];return n.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:Tp,useClass:Tp,deps:[[new Ko,Vg]]},{provide:RA,useClass:RA,deps:[]},JO,{provide:Cg,useFactory:function(){return U3},deps:[]},{provide:bp,useFactory:function(){return j3},deps:[]},{provide:Xh,useFactory:function(n){return O1(n=n||"undefined"!=typeof $localize&&$localize.locale||P_),n},deps:[[new Uu(Xh),new Ko,new xi]]},{provide:bD,useValue:"USD"}];let WL=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(yt(Ip))},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({providers:qL}),n})(),ay=null;function Xc(){return ay}const no=new rn("DocumentToken");let LA=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({factory:W4,token:n,providedIn:"platform"}),n})();function W4(){return yt(lS)}const Q4=new rn("Location Initialized");let lS=(()=>{class n extends LA{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Xc().getBaseHref(this._doc)}onPopState(t){const r=Xc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=Xc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,r,s){cS()?this._history.pushState(t,r,s):this.location.hash=s}replaceState(t,r,s){cS()?this._history.replaceState(t,r,s):this.location.hash=s}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(yt(no))},n.\u0275prov=qt({factory:X4,token:n,providedIn:"platform"}),n})();function cS(){return!!window.history.pushState}function X4(){return new lS(yt(no))}function Ux(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function uS(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function rh(n){return n&&"?"!==n[0]?"?"+n:n}let Rp=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({factory:Y4,token:n,providedIn:"root"}),n})();function Y4(n){const e=yt(no).location;return new hS(yt(LA),e&&e.origin||"")}const jx=new rn("appBaseHref");let hS=(()=>{class n extends Rp{constructor(t,r){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Ux(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+rh(this._platformLocation.search),s=this._platformLocation.hash;return s&&t?`${r}${s}`:r}pushState(t,r,s,c){const m=this.prepareExternalUrl(s+rh(c));this._platformLocation.pushState(t,r,m)}replaceState(t,r,s,c){const m=this.prepareExternalUrl(s+rh(c));this._platformLocation.replaceState(t,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,s;null===(s=(r=this._platformLocation).historyGo)||void 0===s||s.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(yt(LA),yt(jx,8))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),K4=(()=>{class n extends Rp{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Ux(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,s,c){let m=this.prepareExternalUrl(s+rh(c));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.pushState(t,r,m)}replaceState(t,r,s,c){let m=this.prepareExternalUrl(s+rh(c));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,s;null===(s=(r=this._platformLocation).historyGo)||void 0===s||s.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(yt(LA),yt(jx,8))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),ly=(()=>{class n{constructor(t,r){this._subject=new lt,this._urlChangeListeners=[],this._platformStrategy=t;const s=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=uS(dS(s)),this._platformStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+rh(r))}normalize(t){return n.stripTrailingSlash(function(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,dS(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,r="",s=null){this._platformStrategy.pushState(s,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+rh(r)),s)}replaceState(t,r="",s=null){this._platformStrategy.replaceState(s,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+rh(r)),s)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var r,s;null===(s=(r=this._platformStrategy).historyGo)||void 0===s||s.call(r,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}))}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(s=>s(t,r))}subscribe(t,r,s){return this._subject.subscribe({next:t,error:r,complete:s})}}return n.\u0275fac=function(t){return new(t||n)(yt(Rp),yt(LA))},n.normalizeQueryParams=rh,n.joinWithSlash=Ux,n.stripTrailingSlash=uS,n.\u0275prov=qt({factory:J4,token:n,providedIn:"root"}),n})();function J4(){return new ly(yt(Rp),yt(LA))}function dS(n){return n.replace(/\/index.html$/,"")}var ro=(()=>((ro=ro||{})[ro.Zero=0]="Zero",ro[ro.One=1]="One",ro[ro.Two=2]="Two",ro[ro.Few=3]="Few",ro[ro.Many=4]="Many",ro[ro.Other=5]="Other",ro))();const aB=function(n){return function(n){const e=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=LC(e);if(t)return t;const r=e.split("-")[0];if(t=LC(r),t)return t;if("en"===r)return yR;throw new Error(`Missing locale data for the locale "${n}".`)}(n)[Bt.PluralCase]};class _y{}let LB=(()=>{class n extends _y{constructor(t){super(),this.locale=t}getPluralCategory(t,r){switch(aB(r||this.locale)(t)){case ro.Zero:return"zero";case ro.One:return"one";case ro.Two:return"two";case ro.Few:return"few";case ro.Many:return"many";default:return"other"}}}return n.\u0275fac=function(t){return new(t||n)(yt(Xh))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function xS(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[s,c]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(s.trim()===e)return decodeURIComponent(c)}return null}let bS=(()=>{class n{constructor(t,r,s,c){this._iterableDiffers=t,this._keyValueDiffers=r,this._ngEl=s,this._renderer=c,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(dg(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(r=>this._toggleClass(r.key,r.currentValue)),t.forEachChangedItem(r=>this._toggleClass(r.key,r.currentValue)),t.forEachRemovedItem(r=>{r.previousValue&&this._toggleClass(r.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(r=>{if("string"!=typeof r.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${sn(r.item)}`);this._toggleClass(r.item,!0)}),t.forEachRemovedItem(r=>this._toggleClass(r.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(r=>this._toggleClass(r,!0)):Object.keys(t).forEach(r=>this._toggleClass(r,!!t[r])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(r=>this._toggleClass(r,!1)):Object.keys(t).forEach(r=>this._toggleClass(r,!1)))}_toggleClass(t,r){(t=t.trim())&&t.split(/\s+/g).forEach(s=>{r?this._renderer.addClass(this._ngEl.nativeElement,s):this._renderer.removeClass(this._ngEl.nativeElement,s)})}}return n.\u0275fac=function(t){return new(t||n)(At(Cg),At(bp),At(To),At(eh))},n.\u0275dir=Wt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),n})();class NB{constructor(e,t,r,s){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let wS=(()=>{class n{constructor(t,r,s){this._viewContainer=t,this._template=r,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=[];t.forEachOperation((s,c,m)=>{if(null==s.previousIndex){const w=this._viewContainer.createEmbeddedView(this._template,new NB(null,this._ngForOf,-1,-1),null===m?void 0:m),I=new CS(s,w);r.push(I)}else if(null==m)this._viewContainer.remove(null===c?void 0:c);else if(null!==c){const w=this._viewContainer.get(c);this._viewContainer.move(w,m);const I=new CS(s,w);r.push(I)}});for(let s=0;s<r.length;s++)this._perViewChange(r[s].view,r[s].record);for(let s=0,c=this._viewContainer.length;s<c;s++){const m=this._viewContainer.get(s);m.context.index=s,m.context.count=c,m.context.ngForOf=this._ngForOf}t.forEachIdentityChange(s=>{this._viewContainer.get(s.currentIndex).context.$implicit=s.item})}_perViewChange(t,r){t.context.$implicit=r.item}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(At(Gl),At(th),At(Cg))},n.\u0275dir=Wt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();class CS{constructor(e,t){this.record=e,this.view=t}}let ES=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new VB,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){DS("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){DS("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(At(Gl),At(th))},n.\u0275dir=Wt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class VB{constructor(){this.$implicit=null,this.ngIf=null}}function DS(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${sn(e)}'.`)}let TS=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({providers:[{provide:_y,useClass:LB}]}),n})();let kS=(()=>{class n{}return n.\u0275prov=qt({token:n,providedIn:"root",factory:()=>new pN(yt(no),window)}),n})();class pN{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let s=r.currentNode;for(;s;){const c=s.shadowRoot;if(c){const m=c.getElementById(e)||c.querySelector(`[name="${e}"]`);if(m)return m}s=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,s=t.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],s-c[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=PS(this.window.history)||PS(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function PS(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class RS{}class tb extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){ay||(ay=n)}(new tb)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(Wg=Wg||document.querySelector("base"),Wg?Wg.getAttribute("href"):null);return null==t?null:function(n){yy=yy||document.createElement("a"),yy.setAttribute("href",n);const e=yy.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Wg=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return xS(document.cookie,e)}}let yy,Wg=null;const FS=new rn("TRANSITION_ID"),xN=[{provide:Vg,useFactory:function(n,e,t){return()=>{t.get(Tp).donePromise.then(()=>{const r=Xc(),s=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let c=0;c<s.length;c++)r.remove(s[c])})}},deps:[FS,no,Sr],multi:!0}];class nb{static init(){!function(n){Cx=n}(new nb)}addToWindow(e){sr.getAngularTestability=(r,s=!0)=>{const c=e.findTestabilityInTree(r,s);if(null==c)throw new Error("Could not find testability for element.");return c},sr.getAllAngularTestabilities=()=>e.getAllTestabilities(),sr.getAllAngularRootElements=()=>e.getAllRootElements(),sr.frameworkStabilizers||(sr.frameworkStabilizers=[]),sr.frameworkStabilizers.push(r=>{const s=sr.getAllAngularTestabilities();let c=s.length,m=!1;const w=function(I){m=m||I,c--,0==c&&r(m)};s.forEach(function(I){I.whenStable(w)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const s=e.getTestability(t);return null!=s?s:r?Xc().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let bN=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const Qg=new rn("EventManagerPlugins");let xy=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(s=>s.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,r,s){return this._findPluginFor(r).addEventListener(t,r,s)}addGlobalEventListener(t,r,s){return this._findPluginFor(r).addGlobalEventListener(t,r,s)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const s=this._plugins;for(let c=0;c<s.length;c++){const m=s[c];if(m.supports(t))return this._eventNameToPlugin.set(t,m),m}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(yt(Qg),yt(Ei))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();class rb{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const s=Xc().getGlobalEventTarget(this._doc,e);if(!s)throw new Error(`Unsupported event target ${s} for event ${t}`);return this.addEventListener(s,t,r)}}let LS=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const r=new Set;t.forEach(s=>{this._stylesSet.has(s)||(this._stylesSet.add(s),r.add(s))}),this.onStylesAdded(r)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),Xg=(()=>{class n extends LS{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,r,s){t.forEach(c=>{const m=this._doc.createElement("style");m.textContent=c,s.push(r.appendChild(m))})}addHost(t){const r=[];this._addStylesToHost(this._stylesSet,t,r),this._hostNodes.set(t,r)}removeHost(t){const r=this._hostNodes.get(t);r&&r.forEach(BS),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((r,s)=>{this._addStylesToHost(t,s,r)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(BS))}}return n.\u0275fac=function(t){return new(t||n)(yt(no))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function BS(n){Xc().remove(n)}const ib={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ob=/%COMP%/g;function by(n,e,t){for(let r=0;r<e.length;r++){let s=e[r];Array.isArray(s)?by(n,s,t):(s=s.replace(ob,n),t.push(s))}return t}function VS(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let sb=(()=>{class n{constructor(t,r,s){this.eventManager=t,this.sharedStylesHost=r,this.appId=s,this.rendererByCompId=new Map,this.defaultRenderer=new ab(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;switch(r.encapsulation){case Ar.Emulated:{let s=this.rendererByCompId.get(r.id);return s||(s=new BN(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,s)),s.applyToHost(t),s}case 1:case Ar.ShadowDom:return new NN(this.eventManager,this.sharedStylesHost,t,r);default:if(!this.rendererByCompId.has(r.id)){const s=by(r.id,r.styles,[]);this.sharedStylesHost.addStyles(s),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(yt(xy),yt(Xg),yt(Ug))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();class ab{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(ib[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,s){if(s){t=s+":"+t;const c=ib[s];c?e.setAttributeNS(c,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const s=ib[r];s?e.removeAttributeNS(s,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,s){s&(Es.DashCase|Es.Important)?e.style.setProperty(t,r,s&Es.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Es.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,VS(r)):this.eventManager.addEventListener(e,t,VS(r))}}class BN extends ab{constructor(e,t,r,s){super(e),this.component=r;const c=by(s+"-"+r.id,r.styles,[]);t.addStyles(c),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(ob,n)}(s+"-"+r.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(ob,n)}(s+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class NN extends ab{constructor(e,t,r,s){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=by(s.id,s.styles,[]);for(let m=0;m<c.length;m++){const w=document.createElement("style");w.textContent=c[m],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let zN=(()=>{class n extends rb{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,s){return t.addEventListener(r,s,!1),()=>this.removeEventListener(t,r,s)}removeEventListener(t,r,s){return t.removeEventListener(r,s)}}return n.\u0275fac=function(t){return new(t||n)(yt(no))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const $S=["alt","control","meta","shift"],qN={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},GS={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},ZN={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let WN=(()=>{class n extends rb{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,s){const c=n.parseEventName(r),m=n.eventCallback(c.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Xc().onAndCancel(t,c.domEventName,m))}static parseEventName(t){const r=t.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const c=n._normalizeKey(r.pop());let m="";if($S.forEach(I=>{const L=r.indexOf(I);L>-1&&(r.splice(L,1),m+=I+".")}),m+=c,0!=r.length||0===c.length)return null;const w={};return w.domEventName=s,w.fullKey=m,w}static getEventFullKey(t){let r="",s=function(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&GS.hasOwnProperty(e)&&(e=GS[e]))}return qN[e]||e}(t);return s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),$S.forEach(c=>{c!=s&&ZN[c](t)&&(r+=c+".")}),r+=s,r}static eventCallback(t,r,s){return c=>{n.getEventFullKey(c)===t&&s.runGuarded(()=>r(c))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return n.\u0275fac=function(t){return new(t||n)(yt(no))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),wy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({factory:function(){return yt(cb)},token:n,providedIn:"root"}),n})(),cb=(()=>{class n extends wy{constructor(t){super(),this._doc=t}sanitize(t,r){if(null==r)return null;switch(t){case Fr.NONE:return r;case Fr.HTML:return Ja(r,"HTML")?Cs(r):Of(this._doc,String(r)).toString();case Fr.STYLE:return Ja(r,"Style")?Cs(r):r;case Fr.SCRIPT:if(Ja(r,"Script"))return Cs(r);throw new Error("unsafe value used in a script context");case Fr.URL:return If(r),Ja(r,"URL")?Cs(r):Gu(String(r));case Fr.RESOURCE_URL:if(Ja(r,"ResourceURL"))return Cs(r);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(t){return function(n){return new Rc(n)}(t)}bypassSecurityTrustStyle(t){return function(n){return new ws(n)}(t)}bypassSecurityTrustScript(t){return function(n){return new Rv(n)}(t)}bypassSecurityTrustUrl(t){return function(n){return new mm(n)}(t)}bypassSecurityTrustResourceUrl(t){return function(n){return new Fv(n)}(t)}}return n.\u0275fac=function(t){return new(t||n)(yt(no))},n.\u0275prov=qt({factory:function(){return function(n){return new cb(n.get(no))}(yt(Kr))},token:n,providedIn:"root"}),n})();const n5=kD(UL,"browser",[{provide:W_,useValue:"browser"},{provide:vD,useValue:function(){tb.makeCurrent(),nb.init()},multi:!0},{provide:no,useFactory:function(){return function(n){Qa=n}(document),document},deps:[]}]),r5=[[],{provide:zn,useValue:"root"},{provide:Oc,useFactory:function(){return new Oc},deps:[]},{provide:Qg,useClass:zN,multi:!0,deps:[no,Ei,W_]},{provide:Qg,useClass:WN,multi:!0,deps:[no]},[],{provide:sb,useClass:sb,deps:[xy,Xg,Ug]},{provide:N_,useExisting:sb},{provide:LS,useExisting:Xg},{provide:Xg,useClass:Xg,deps:[no]},{provide:wx,useClass:wx,deps:[Ei]},{provide:xy,useClass:xy,deps:[Qg,Ei]},{provide:RS,useClass:bN,deps:[]},[]];let i5=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:Ug,useValue:t.appId},{provide:FS,useExisting:Ug},xN]}}}return n.\u0275fac=function(t){return new(t||n)(yt(n,12))},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({providers:r5,imports:[TS,WL]}),n})();function s5(){return new HS(yt(no))}let HS=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(yt(no))},n.\u0275prov=qt({factory:s5,token:n,providedIn:"root"}),n})();function Sn(...n){let e=n[n.length-1];return As(e)?(n.pop(),uo(n,e)):vo(n)}"undefined"!=typeof window&&window;class Kl extends co{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new zs;return this._value}next(e){super.next(this._value=e)}}class d5 extends Wn{notifyNext(e,t,r,s,c){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class A5 extends Wn{constructor(e,t,r){super(),this.parent=e,this.outerValue=t,this.outerIndex=r,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function f5(n,e,t,r,s=new A5(n,t,r)){if(!s.closed)return e instanceof jn?e.subscribe(s):ml(e)(s)}const ZS={};class m5{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new g5(e,this.resultSelector))}}class g5 extends d5{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(ZS),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let r=0;r<t;r++)this.add(f5(this,e[r],void 0,r))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,r){const s=this.values,m=this.toRespond?s[r]===ZS?--this.toRespond:this.toRespond:0;s[r]=t,0===m&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const Cy=(()=>{function n(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return n.prototype=Object.create(Error.prototype),n})();function hb(...n){return jo(1)(Sn(...n))}const Fp=new jn(n=>n.complete());function db(n){return n?function(n){return new jn(e=>n.schedule(()=>e.complete()))}(n):Fp}function WS(n){return new jn(e=>{let t;try{t=n()}catch(s){return void e.error(s)}return(t?Pr(t):db()).subscribe(e)})}function oh(n,e){return"function"==typeof e?t=>t.pipe(oh((r,s)=>Pr(n(r,s)).pipe(fn((c,m)=>e(r,c,s,m))))):t=>t.lift(new v5(n))}class v5{constructor(e){this.project=e}call(e,t){return t.subscribe(new x5(e,this.project))}}class x5 extends Us{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(s){return void this.destination.error(s)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const r=new da(this),s=this.destination;s.add(r),this.innerSubscription=Aa(e,r),this.innerSubscription!==r&&s.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const QS=(()=>{function n(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return n.prototype=Object.create(Error.prototype),n})();function Ab(n){return e=>0===n?db():e.lift(new b5(n))}class b5{constructor(e){if(this.total=e,this.total<0)throw new QS}call(e,t){return t.subscribe(new w5(e,this.total))}}class w5 extends Wn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))}}function XS(...n){const e=n[n.length-1];return As(e)?(n.pop(),t=>hb(n,t,e)):t=>hb(n,t)}function YS(n,e){let t=!1;return arguments.length>=2&&(t=!0),function(s){return s.lift(new C5(n,e,t))}}class C5{constructor(e,t,r=!1){this.accumulator=e,this.seed=t,this.hasSeed=r}call(e,t){return t.subscribe(new E5(e,this.accumulator,this.seed,this.hasSeed))}}class E5 extends Wn{constructor(e,t,r,s){super(e),this.accumulator=t,this._seed=r,this.hasSeed=s,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let r;try{r=this.accumulator(this.seed,e,t)}catch(s){this.destination.error(s)}this.seed=r,this.destination.next(r)}}function sh(n,e){return function(r){return r.lift(new D5(n,e))}}class D5{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new S5(e,this.predicate,this.thisArg))}}class S5 extends Wn{constructor(e,t,r){super(e),this.predicate=t,this.thisArg=r,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)}}function Jh(n){return function(t){const r=new M5(n),s=t.lift(r);return r.caught=s}}class M5{constructor(e){this.selector=e}call(e,t){return t.subscribe(new T5(e,this.selector,this.caught))}}class T5 extends Us{constructor(e,t,r){super(e),this.selector=t,this.caught=r}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(c){return void super.error(c)}this._unsubscribeAndRecycle();const r=new da(this);this.add(r);const s=Aa(t,r);s!==r&&this.add(s)}}}function Op(n,e){return mr(n,e,1)}function fb(n){return function(t){return 0===n?db():t.lift(new I5(n))}}class I5{constructor(e){if(this.total=e,this.total<0)throw new QS}call(e,t){return t.subscribe(new k5(e,this.total))}}class k5 extends Wn{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,r=this.total,s=this.count++;t.length<r?t.push(e):t[s%r]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const r=this.count>=this.total?this.total:this.count,s=this.ring;for(let c=0;c<r;c++){const m=t++%r;e.next(s[m])}}e.complete()}}function KS(n=F5){return e=>e.lift(new P5(n))}class P5{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new R5(e,this.errorFactory))}}class R5 extends Wn{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function F5(){return new Cy}function JS(n=null){return e=>e.lift(new O5(n))}class O5{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new L5(e,this.defaultValue))}}class L5 extends Wn{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function BA(n,e){const t=arguments.length>=2;return r=>r.pipe(n?sh((s,c)=>n(s,c,r)):li,Ab(1),t?JS(e):KS(()=>new Cy))}function ed(){}function ss(n,e,t){return function(s){return s.lift(new N5(n,e,t))}}class N5{constructor(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}call(e,t){return t.subscribe(new z5(e,this.nextOrObserver,this.error,this.complete))}}class z5 extends Wn{constructor(e,t,r,s){super(e),this._tapNext=ed,this._tapError=ed,this._tapComplete=ed,this._tapError=r||ed,this._tapComplete=s||ed,Ns(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||ed,this._tapError=t.error||ed,this._tapComplete=t.complete||ed)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class U5{constructor(e){this.callback=e}call(e,t){return t.subscribe(new j5(e,this.callback))}}class j5 extends Wn{constructor(e,t){super(e),this.add(new Ct(t))}}class ah{constructor(e,t){this.id=e,this.url=t}}class pb extends ah{constructor(e,t,r="imperative",s=null){super(e,t),this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Yg extends ah{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class eM extends ah{constructor(e,t,r){super(e,t),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class $5 extends ah{constructor(e,t,r){super(e,t),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class G5 extends ah{constructor(e,t,r,s){super(e,t),this.urlAfterRedirects=r,this.state=s}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class H5 extends ah{constructor(e,t,r,s){super(e,t),this.urlAfterRedirects=r,this.state=s}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class q5 extends ah{constructor(e,t,r,s,c){super(e,t),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=c}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Z5 extends ah{constructor(e,t,r,s){super(e,t),this.urlAfterRedirects=r,this.state=s}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class W5 extends ah{constructor(e,t,r,s){super(e,t),this.urlAfterRedirects=r,this.state=s}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class tM{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class nM{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Q5{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class X5{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Y5{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class K5{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class rM{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Xn="primary";class J5{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Lp(n){return new J5(n)}const iM="ngNavigationCancelingError";function mb(n){const e=Error("NavigationCancelingError: "+n);return e[iM]=!0,e}function tz(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const s={};for(let c=0;c<r.length;c++){const m=r[c],w=n[c];if(m.startsWith(":"))s[m.substring(1)]=w;else if(m!==w.path)return null}return{consumed:n.slice(0,r.length),posParams:s}}function Yc(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let s;for(let c=0;c<t.length;c++)if(s=t[c],!oM(n[s],e[s]))return!1;return!0}function oM(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((s,c)=>r[c]===s)}return n===e}function sM(n){return Array.prototype.concat.apply([],n)}function aM(n){return n.length>0?n[n.length-1]:null}function No(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function Kc(n){return T_(n)?n:mg(n)?Pr(Promise.resolve(n)):Sn(n)}const iz={exact:function uM(n,e,t){if(!zA(n.segments,e.segments)||!Ey(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!uM(n.children[r],e.children[r],t))return!1;return!0},subset:hM},lM={exact:function(n,e){return Yc(n,e)},subset:function(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>oM(n[t],e[t]))},ignored:()=>!0};function cM(n,e,t){return iz[t.paths](n.root,e.root,t.matrixParams)&&lM[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function hM(n,e,t){return dM(n,e,e.segments,t)}function dM(n,e,t,r){if(n.segments.length>t.length){const s=n.segments.slice(0,t.length);return!(!zA(s,t)||e.hasChildren()||!Ey(s,t,r))}if(n.segments.length===t.length){if(!zA(n.segments,t)||!Ey(n.segments,t,r))return!1;for(const s in e.children)if(!n.children[s]||!hM(n.children[s],e.children[s],r))return!1;return!0}{const s=t.slice(0,n.segments.length),c=t.slice(n.segments.length);return!!(zA(n.segments,s)&&Ey(n.segments,s,r)&&n.children[Xn])&&dM(n.children[Xn],e,c,r)}}function Ey(n,e,t){return e.every((r,s)=>lM[t](n[s].parameters,r.parameters))}class NA{constructor(e,t,r){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Lp(this.queryParams)),this._queryParamMap}toString(){return cz.serialize(this)}}class ir{constructor(e,t){this.segments=e,this.children=t,this.parent=null,No(t,(r,s)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Dy(this)}}class Kg{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Lp(this.parameters)),this._parameterMap}toString(){return mM(this)}}function zA(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}class gb{}class AM{parse(e){const t=new _z(e);return new NA(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${`/${Jg(e.root,!0)}`}${function(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(s=>`${Sy(t)}=${Sy(s)}`).join("&"):`${Sy(t)}=${Sy(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${function(n){return encodeURI(n)}(e.fragment)}`:""}`}}const cz=new AM;function Dy(n){return n.segments.map(e=>mM(e)).join("/")}function Jg(n,e){if(!n.hasChildren())return Dy(n);if(e){const t=n.children[Xn]?Jg(n.children[Xn],!1):"",r=[];return No(n.children,(s,c)=>{c!==Xn&&r.push(`${c}:${Jg(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function(n,e){let t=[];return No(n.children,(r,s)=>{s===Xn&&(t=t.concat(e(r,s)))}),No(n.children,(r,s)=>{s!==Xn&&(t=t.concat(e(r,s)))}),t}(n,(r,s)=>s===Xn?[Jg(n.children[Xn],!1)]:[`${s}:${Jg(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Xn]?`${Dy(n)}/${t[0]}`:`${Dy(n)}/(${t.join("//")})`}}function fM(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Sy(n){return fM(n).replace(/%3B/gi,";")}function _b(n){return fM(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function My(n){return decodeURIComponent(n)}function pM(n){return My(n.replace(/\+/g,"%20"))}function mM(n){return`${_b(n.path)}${function(n){return Object.keys(n).map(e=>`;${_b(e)}=${_b(n[e])}`).join("")}(n.parameters)}`}const Az=/^[^\/()?;=#]+/;function Ty(n){const e=n.match(Az);return e?e[0]:""}const fz=/^[^=?&#]+/,mz=/^[^?&#]+/;class _z{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ir([],{}):new ir([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[Xn]=new ir(e,t)),r}parseSegment(){const e=Ty(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Kg(My(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Ty(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const s=Ty(this.remaining);s&&(r=s,this.capture(r))}e[My(t)]=My(r)}parseQueryParam(e){const t=function(n){const e=n.match(fz);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const m=function(n){const e=n.match(mz);return e?e[0]:""}(this.remaining);m&&(r=m,this.capture(r))}const s=pM(t),c=pM(r);if(e.hasOwnProperty(s)){let m=e[s];Array.isArray(m)||(m=[m],e[s]=m),m.push(c)}else e[s]=c}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Ty(this.remaining),s=this.remaining[r.length];if("/"!==s&&")"!==s&&";"!==s)throw new Error(`Cannot parse url '${this.url}'`);let c;r.indexOf(":")>-1?(c=r.substr(0,r.indexOf(":")),this.capture(c),this.capture(":")):e&&(c=Xn);const m=this.parseChildren();t[c]=1===Object.keys(m).length?m[Xn]:new ir([],m),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class gM{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=yb(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=yb(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=vb(e,this._root);return t.length<2?[]:t[t.length-2].children.map(s=>s.value).filter(s=>s!==e)}pathFromRoot(e){return vb(e,this._root).map(t=>t.value)}}function yb(n,e){if(n===e.value)return e;for(const t of e.children){const r=yb(n,t);if(r)return r}return null}function vb(n,e){if(n===e.value)return[e];for(const t of e.children){const r=vb(n,t);if(r.length)return r.unshift(e),r}return[]}class lh{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function e0(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class _M extends gM{constructor(e,t){super(e),this.snapshot=t,xb(this,e)}toString(){return this.snapshot.toString()}}function yM(n,e){const t=function(n,e){const m=new Iy([],{},{},"",{},Xn,e,null,n.root,-1,{});return new xM("",new lh(m,[]))}(n,e),r=new Kl([new Kg("",{})]),s=new Kl({}),c=new Kl({}),m=new Kl({}),w=new Kl(""),I=new Bp(r,s,m,w,c,Xn,e,t.root);return I.snapshot=t.root,new _M(new lh(I,[]),t)}class Bp{constructor(e,t,r,s,c,m,w,I){this.url=e,this.params=t,this.queryParams=r,this.fragment=s,this.data=c,this.outlet=m,this.component=w,this._futureSnapshot=I}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(fn(e=>Lp(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(fn(e=>Lp(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function vM(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const s=t[r],c=t[r-1];if(s.routeConfig&&""===s.routeConfig.path)r--;else{if(c.component)break;r--}}return function(n){return n.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Iy{constructor(e,t,r,s,c,m,w,I,L,U,W){this.url=e,this.params=t,this.queryParams=r,this.fragment=s,this.data=c,this.outlet=m,this.component=w,this.routeConfig=I,this._urlSegment=L,this._lastPathIndex=U,this._resolve=W}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Lp(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Lp(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class xM extends gM{constructor(e,t){super(t),this.url=e,xb(this,t)}toString(){return bM(this._root)}}function xb(n,e){e.value._routerState=n,e.children.forEach(t=>xb(n,t))}function bM(n){const e=n.children.length>0?` { ${n.children.map(bM).join(", ")} } `:"";return`${n.value}${e}`}function bb(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Yc(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),Yc(e.params,t.params)||n.params.next(t.params),function(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Yc(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),Yc(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function wb(n,e){return Yc(n.params,e.params)&&function(n,e){return zA(n,e)&&n.every((t,r)=>Yc(t.parameters,e[r].parameters))}(n.url,e.url)&&!(!n.parent!=!e.parent)&&(!n.parent||wb(n.parent,e.parent))}function ky(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const s=function(n,e,t){return e.children.map(r=>{for(const s of t.children)if(n.shouldReuseRoute(r.value,s.value.snapshot))return ky(n,r,s);return ky(n,r)})}(n,e,t);return new lh(r,s)}{if(n.shouldAttach(e.value)){const c=n.retrieve(e.value);if(null!==c){const m=c.route;return wM(e,m),m}}const r=function(n){return new Bp(new Kl(n.url),new Kl(n.params),new Kl(n.queryParams),new Kl(n.fragment),new Kl(n.data),n.outlet,n.component,n)}(e.value),s=e.children.map(c=>ky(n,c));return new lh(r,s)}}function wM(n,e){if(n.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(n.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=n.value;for(let t=0;t<n.children.length;++t)wM(n.children[t],e.children[t])}function Py(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function t0(n){return"object"==typeof n&&null!=n&&n.outlets}function Cb(n,e,t,r,s){let c={};return r&&No(r,(m,w)=>{c[w]=Array.isArray(m)?m.map(I=>`${I}`):`${m}`}),new NA(t.root===n?e:CM(t.root,n,e),c,s)}function CM(n,e,t){const r={};return No(n.children,(s,c)=>{r[c]=s===e?t:CM(s,e,t)}),new ir(n.segments,r)}class EM{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Py(r[0]))throw new Error("Root segment cannot have matrix parameters");const s=r.find(t0);if(s&&s!==aM(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Eb{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function DM(n,e,t){if(n||(n=new ir([],{})),0===n.segments.length&&n.hasChildren())return Ry(n,e,t);const r=function(n,e,t){let r=0,s=e;const c={match:!1,pathIndex:0,commandIndex:0};for(;s<n.segments.length;){if(r>=t.length)return c;const m=n.segments[s],w=t[r];if(t0(w))break;const I=`${w}`,L=r<t.length-1?t[r+1]:null;if(s>0&&void 0===I)break;if(I&&L&&"object"==typeof L&&void 0===L.outlets){if(!MM(I,L,m))return c;r+=2}else{if(!MM(I,{},m))return c;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}(n,e,t),s=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const c=new ir(n.segments.slice(0,r.pathIndex),{});return c.children[Xn]=new ir(n.segments.slice(r.pathIndex),n.children),Ry(c,0,s)}return r.match&&0===s.length?new ir(n.segments,{}):r.match&&!n.hasChildren()?Db(n,e,t):r.match?Ry(n,0,s):Db(n,e,t)}function Ry(n,e,t){if(0===t.length)return new ir(n.segments,{});{const r=function(n){return t0(n[0])?n[0].outlets:{[Xn]:n}}(t),s={};return No(r,(c,m)=>{"string"==typeof c&&(c=[c]),null!==c&&(s[m]=DM(n.children[m],e,c))}),No(n.children,(c,m)=>{void 0===r[m]&&(s[m]=c)}),new ir(n.segments,s)}}function Db(n,e,t){const r=n.segments.slice(0,e);let s=0;for(;s<t.length;){const c=t[s];if(t0(c)){const I=Iz(c.outlets);return new ir(r,I)}if(0===s&&Py(t[0])){r.push(new Kg(n.segments[e].path,SM(t[0]))),s++;continue}const m=t0(c)?c.outlets[Xn]:`${c}`,w=s<t.length-1?t[s+1]:null;m&&w&&Py(w)?(r.push(new Kg(m,SM(w))),s+=2):(r.push(new Kg(m,{})),s++)}return new ir(r,{})}function Iz(n){const e={};return No(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=Db(new ir([],{}),0,t))}),e}function SM(n){const e={};return No(n,(t,r)=>e[r]=`${t}`),e}function MM(n,e,t){return n==t.path&&Yc(e,t.parameters)}class Pz{constructor(e,t,r,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=s}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),bb(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const s=e0(t);e.children.forEach(c=>{const m=c.value.outlet;this.deactivateRoutes(c,s[m],r),delete s[m]}),No(s,(c,m)=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(e,t,r){const s=e.value,c=t?t.value:null;if(s===c)if(s.component){const m=r.getContext(s.outlet);m&&this.deactivateChildRoutes(e,t,m.children)}else this.deactivateChildRoutes(e,t,r);else c&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet);if(r&&r.outlet){const s=r.outlet.detach(),c=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:c})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),s=r&&e.value.component?r.children:t,c=e0(e);for(const m of Object.keys(c))this.deactivateRouteAndItsChildren(c[m],s);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const s=e0(t);e.children.forEach(c=>{this.activateRoutes(c,s[c.value.outlet],r),this.forwardEvent(new K5(c.value.snapshot))}),e.children.length&&this.forwardEvent(new X5(e.value.snapshot))}activateRoutes(e,t,r){const s=e.value,c=t?t.value:null;if(bb(s),s===c)if(s.component){const m=r.getOrCreateContext(s.outlet);this.activateChildRoutes(e,t,m.children)}else this.activateChildRoutes(e,t,r);else if(s.component){const m=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const w=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(w.contexts),m.attachRef=w.componentRef,m.route=w.route.value,m.outlet&&m.outlet.attach(w.componentRef,w.route.value),TM(w.route)}else{const w=function(n){for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(s.snapshot),I=w?w.module.componentFactoryResolver:null;m.attachRef=null,m.route=s,m.resolver=I,m.outlet&&m.outlet.activateWith(s,I),this.activateChildRoutes(e,null,m.children)}}else this.activateChildRoutes(e,null,r)}}function TM(n){bb(n.value),n.children.forEach(TM)}class Sb{constructor(e,t){this.routes=e,this.module=t}}function td(n){return"function"==typeof n}function VA(n){return n instanceof NA}const n0=Symbol("INITIAL_VALUE");function r0(){return oh(n=>function(...n){let e,t;return As(n[n.length-1])&&(t=n.pop()),"function"==typeof n[n.length-1]&&(e=n.pop()),1===n.length&&Vo(n[0])&&(n=n[0]),vo(n,t).lift(new m5(e))}(n.map(e=>e.pipe(Ab(1),XS(n0)))).pipe(YS((e,t)=>{let r=!1;return t.reduce((s,c,m)=>s!==n0?s:(c===n0&&(r=!0),r||!1!==c&&m!==t.length-1&&!VA(c)?s:c),e)},n0),sh(e=>e!==n0),fn(e=>VA(e)?e:!0===e),Ab(1)))}let IM=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ha({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,r){1&t&&fg(0,"router-outlet")},directives:function(){return[ZM]},encapsulation:2}),n})();function kM(n,e=""){for(let t=0;t<n.length;t++){const r=n[t];zz(r,Vz(e,r))}}function zz(n,e){n.children&&kM(n.children,e)}function Vz(n,e){return e?n||e.path?n&&!e.path?`${n}/`:!n&&e.path?e.path:`${n}/${e.path}`:"":n}function Mb(n){const e=n.children&&n.children.map(Mb),t=e?Object.assign(Object.assign({},n),{children:e}):Object.assign({},n);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Xn&&(t.component=IM),t}function cl(n){return n.outlet||Xn}function PM(n,e){const t=n.filter(r=>cl(r)===e);return t.push(...n.filter(r=>cl(r)!==e)),t}const RM={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Fy(n,e,t){var r;if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?Object.assign({},RM):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const c=(e.matcher||tz)(t,n,e);if(!c)return Object.assign({},RM);const m={};No(c.posParams,(I,L)=>{m[L]=I.path});const w=c.consumed.length>0?Object.assign(Object.assign({},m),c.consumed[c.consumed.length-1].parameters):m;return{matched:!0,consumedSegments:c.consumed,lastChild:c.consumed.length,parameters:w,positionalParamSegments:null!==(r=c.posParams)&&void 0!==r?r:{}}}function Oy(n,e,t,r,s="corrected"){if(t.length>0&&function(n,e,t){return t.some(r=>Ly(n,e,r)&&cl(r)!==Xn)}(n,t,r)){const m=new ir(e,function(n,e,t,r){const s={};s[Xn]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const c of t)if(""===c.path&&cl(c)!==Xn){const m=new ir([],{});m._sourceSegment=n,m._segmentIndexShift=e.length,s[cl(c)]=m}return s}(n,e,r,new ir(t,n.children)));return m._sourceSegment=n,m._segmentIndexShift=e.length,{segmentGroup:m,slicedSegments:[]}}if(0===t.length&&function(n,e,t){return t.some(r=>Ly(n,e,r))}(n,t,r)){const m=new ir(n.segments,function(n,e,t,r,s,c){const m={};for(const w of r)if(Ly(n,t,w)&&!s[cl(w)]){const I=new ir([],{});I._sourceSegment=n,I._segmentIndexShift="legacy"===c?n.segments.length:e.length,m[cl(w)]=I}return Object.assign(Object.assign({},s),m)}(n,e,t,r,n.children,s));return m._sourceSegment=n,m._segmentIndexShift=e.length,{segmentGroup:m,slicedSegments:t}}const c=new ir(n.segments,n.children);return c._sourceSegment=n,c._segmentIndexShift=e.length,{segmentGroup:c,slicedSegments:t}}function Ly(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function FM(n,e,t,r){return!!(cl(n)===r||r!==Xn&&Ly(e,t,n))&&("**"===n.path||Fy(e,n,t).matched)}function OM(n,e,t){return 0===e.length&&!n.children[t]}class o0{constructor(e){this.segmentGroup=e||null}}class LM{constructor(e){this.urlTree=e}}function By(n){return new jn(e=>e.error(new o0(n)))}function BM(n){return new jn(e=>e.error(new LM(n)))}function Hz(n){return new jn(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n}'`)))}class Wz{constructor(e,t,r,s,c){this.configLoader=t,this.urlSerializer=r,this.urlTree=s,this.config=c,this.allowRedirects=!0,this.ngModule=e.get(Qc)}apply(){const e=Oy(this.urlTree.root,[],[],this.config).segmentGroup,t=new ir(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,Xn).pipe(fn(c=>this.createUrlTree(Tb(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Jh(c=>{if(c instanceof LM)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof o0?this.noMatchError(c):c}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Xn).pipe(fn(s=>this.createUrlTree(Tb(s),e.queryParams,e.fragment))).pipe(Jh(s=>{throw s instanceof o0?this.noMatchError(s):s}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,r){const s=e.segments.length>0?new ir([],{[Xn]:e}):e;return new NA(s,t,r)}expandSegmentGroup(e,t,r,s){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe(fn(c=>new ir([],c))):this.expandSegment(e,r,t,r.segments,s,!0)}expandChildren(e,t,r){const s=[];for(const c of Object.keys(r.children))"primary"===c?s.unshift(c):s.push(c);return Pr(s).pipe(Op(c=>{const m=r.children[c],w=PM(t,c);return this.expandSegmentGroup(e,w,m,c).pipe(fn(I=>({segment:I,outlet:c})))}),YS((c,m)=>(c[m.outlet]=m.segment,c),{}),function(n,e){const t=arguments.length>=2;return r=>r.pipe(n?sh((s,c)=>n(s,c,r)):li,fb(1),t?JS(e):KS(()=>new Cy))}())}expandSegment(e,t,r,s,c,m){return Pr(r).pipe(Op(w=>this.expandSegmentAgainstRoute(e,t,r,w,s,c,m).pipe(Jh(L=>{if(L instanceof o0)return Sn(null);throw L}))),BA(w=>!!w),Jh((w,I)=>{if(w instanceof Cy||"EmptyError"===w.name){if(OM(t,s,c))return Sn(new ir([],{}));throw new o0(t)}throw w}))}expandSegmentAgainstRoute(e,t,r,s,c,m,w){return FM(s,t,c,m)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(e,t,s,c,m):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,s,c,m):By(t):By(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,s,c,m){return"**"===s.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,s,m):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,s,c,m)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,s){const c=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?BM(c):this.lineralizeSegments(r,c).pipe(mr(m=>{const w=new ir(m,{});return this.expandSegment(e,w,t,m,s,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,s,c,m){const{matched:w,consumedSegments:I,lastChild:L,positionalParamSegments:U}=Fy(t,s,c);if(!w)return By(t);const W=this.applyRedirectCommands(I,s.redirectTo,U);return s.redirectTo.startsWith("/")?BM(W):this.lineralizeSegments(s,W).pipe(mr(K=>this.expandSegment(e,t,r,K.concat(c.slice(L)),m,!1)))}matchSegmentAgainstRoute(e,t,r,s,c){if("**"===r.path)return r.loadChildren?(r._loadedConfig?Sn(r._loadedConfig):this.configLoader.load(e.injector,r)).pipe(fn(K=>(r._loadedConfig=K,new ir(s,{})))):Sn(new ir(s,{}));const{matched:m,consumedSegments:w,lastChild:I}=Fy(t,r,s);if(!m)return By(t);const L=s.slice(I);return this.getChildConfig(e,r,s).pipe(mr(W=>{const K=W.module,ie=W.routes,{segmentGroup:fe,slicedSegments:Ve}=Oy(t,w,L,ie),Re=new ir(fe.segments,fe.children);if(0===Ve.length&&Re.hasChildren())return this.expandChildren(K,ie,Re).pipe(fn(Gt=>new ir(w,Gt)));if(0===ie.length&&0===Ve.length)return Sn(new ir(w,{}));const Je=cl(r)===c;return this.expandSegment(K,Re,ie,Ve,Je?Xn:c,!0).pipe(fn(Rt=>new ir(w.concat(Rt.segments),Rt.children)))}))}getChildConfig(e,t,r){return t.children?Sn(new Sb(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Sn(t._loadedConfig):this.runCanLoadGuards(e.injector,t,r).pipe(mr(s=>s?this.configLoader.load(e.injector,t).pipe(fn(c=>(t._loadedConfig=c,c))):function(n){return new jn(e=>e.error(mb(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`)))}(t))):Sn(new Sb([],e))}runCanLoadGuards(e,t,r){const s=t.canLoad;return s&&0!==s.length?Sn(s.map(m=>{const w=e.get(m);let I;if(function(n){return n&&td(n.canLoad)}(w))I=w.canLoad(t,r);else{if(!td(w))throw new Error("Invalid CanLoad guard");I=w(t,r)}return Kc(I)})).pipe(r0(),ss(m=>{if(!VA(m))return;const w=mb(`Redirecting to "${this.urlSerializer.serialize(m)}"`);throw w.url=m,w}),fn(m=>!0===m)):Sn(!0)}lineralizeSegments(e,t){let r=[],s=t.root;for(;;){if(r=r.concat(s.segments),0===s.numberOfChildren)return Sn(r);if(s.numberOfChildren>1||!s.children[Xn])return Hz(e.redirectTo);s=s.children[Xn]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreatreUrlTree(e,t,r,s){const c=this.createSegmentGroup(e,t.root,r,s);return new NA(c,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return No(e,(s,c)=>{if("string"==typeof s&&s.startsWith(":")){const w=s.substring(1);r[c]=t[w]}else r[c]=s}),r}createSegmentGroup(e,t,r,s){const c=this.createSegments(e,t.segments,r,s);let m={};return No(t.children,(w,I)=>{m[I]=this.createSegmentGroup(e,w,r,s)}),new ir(c,m)}createSegments(e,t,r,s){return t.map(c=>c.path.startsWith(":")?this.findPosParam(e,c,s):this.findOrReturn(c,r))}findPosParam(e,t,r){const s=r[t.path.substring(1)];if(!s)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return s}findOrReturn(e,t){let r=0;for(const s of t){if(s.path===e.path)return t.splice(r),s;r++}return e}}function Tb(n){const e={};for(const r of Object.keys(n.children)){const c=Tb(n.children[r]);(c.segments.length>0||c.hasChildren())&&(e[r]=c)}return function(n){if(1===n.numberOfChildren&&n.children[Xn]){const e=n.children[Xn];return new ir(n.segments.concat(e.segments),e.children)}return n}(new ir(n.segments,e))}class NM{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Ny{constructor(e,t){this.component=e,this.route=t}}function Yz(n,e,t){const r=n._root;return s0(r,e?e._root:null,t,[r.value])}function zy(n,e,t){const r=function(n){if(!n)return null;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:t).get(n)}function s0(n,e,t,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=e0(e);return n.children.forEach(m=>{(function(n,e,t,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=n.value,m=e?e.value:null,w=t?t.getContext(n.value.outlet):null;if(m&&c.routeConfig===m.routeConfig){const I=function(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!zA(n.url,e.url);case"pathParamsOrQueryParamsChange":return!zA(n.url,e.url)||!Yc(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!wb(n,e)||!Yc(n.queryParams,e.queryParams);case"paramsChange":default:return!wb(n,e)}}(m,c,c.routeConfig.runGuardsAndResolvers);I?s.canActivateChecks.push(new NM(r)):(c.data=m.data,c._resolvedData=m._resolvedData),s0(n,e,c.component?w?w.children:null:t,r,s),I&&w&&w.outlet&&w.outlet.isActivated&&s.canDeactivateChecks.push(new Ny(w.outlet.component,m))}else m&&a0(e,w,s),s.canActivateChecks.push(new NM(r)),s0(n,null,c.component?w?w.children:null:t,r,s)})(m,c[m.value.outlet],t,r.concat([m.value]),s),delete c[m.value.outlet]}),No(c,(m,w)=>a0(m,t.getContext(w),s)),s}function a0(n,e,t){const r=e0(n),s=n.value;No(r,(c,m)=>{a0(c,s.component?e?e.children.getContext(m):null:e,t)}),t.canDeactivateChecks.push(new Ny(s.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,s))}class uV{}function zM(n){return new jn(e=>e.error(n))}class dV{constructor(e,t,r,s,c,m){this.rootComponentType=e,this.config=t,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=m}recognize(){const e=Oy(this.urlTree.root,[],[],this.config.filter(m=>void 0===m.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Xn);if(null===t)return null;const r=new Iy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Xn,this.rootComponentType,null,this.urlTree.root,-1,{}),s=new lh(r,t),c=new xM(this.url,s);return this.inheritParamsAndData(c._root),c}inheritParamsAndData(e){const t=e.value,r=vM(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(s=>this.inheritParamsAndData(s))}processSegmentGroup(e,t,r){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,r)}processChildren(e,t){const r=[];for(const c of Object.keys(t.children)){const m=t.children[c],w=PM(e,c),I=this.processSegmentGroup(w,m,c);if(null===I)return null;r.push(...I)}const s=VM(r);return function(n){n.sort((e,t)=>e.value.outlet===Xn?-1:t.value.outlet===Xn?1:e.value.outlet.localeCompare(t.value.outlet))}(s),s}processSegment(e,t,r,s){for(const c of e){const m=this.processSegmentAgainstRoute(c,t,r,s);if(null!==m)return m}return OM(t,r,s)?[]:null}processSegmentAgainstRoute(e,t,r,s){if(e.redirectTo||!FM(e,t,r,s))return null;let c,m=[],w=[];if("**"===e.path){const ie=r.length>0?aM(r).parameters:{};c=new Iy(r,ie,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$M(e),cl(e),e.component,e,UM(t),jM(t)+r.length,GM(e))}else{const ie=Fy(t,e,r);if(!ie.matched)return null;m=ie.consumedSegments,w=r.slice(ie.lastChild),c=new Iy(m,ie.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$M(e),cl(e),e.component,e,UM(t),jM(t)+m.length,GM(e))}const I=function(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(e),{segmentGroup:L,slicedSegments:U}=Oy(t,m,w,I.filter(ie=>void 0===ie.redirectTo),this.relativeLinkResolution);if(0===U.length&&L.hasChildren()){const ie=this.processChildren(I,L);return null===ie?null:[new lh(c,ie)]}if(0===I.length&&0===U.length)return[new lh(c,[])];const W=cl(e)===s,K=this.processSegment(I,L,U,W?Xn:s);return null===K?null:[new lh(c,K)]}}function pV(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function VM(n){const e=[],t=new Set;for(const r of n){if(!pV(r)){e.push(r);continue}const s=e.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==s?(s.children.push(...r.children),t.add(s)):e.push(r)}for(const r of t){const s=VM(r.children);e.push(new lh(r.value,s))}return e.filter(r=>!t.has(r))}function UM(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function jM(n){let e=n,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function $M(n){return n.data||{}}function GM(n){return n.resolve||{}}function Ib(n){return oh(e=>{const t=n(e);return t?Pr(t).pipe(fn(()=>e)):Sn(e)})}class wV extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const kb=new rn("ROUTES");class HM{constructor(e,t,r,s){this.loader=e,this.compiler=t,this.onLoadStartListener=r,this.onLoadEndListener=s}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const s=this.loadModuleFactory(t.loadChildren).pipe(fn(c=>{this.onLoadEndListener&&this.onLoadEndListener(t);const m=c.create(e);return new Sb(sM(m.injector.get(kb,void 0,Zt.Self|Zt.Optional)).map(Mb),m)}),Jh(c=>{throw t._loader$=void 0,c}));return t._loader$=new oc(s,()=>new co).pipe(gl()),t._loader$}loadModuleFactory(e){return"string"==typeof e?Pr(this.loader.load(e)):Kc(e()).pipe(mr(t=>t instanceof yE?Sn(t):Pr(this.compiler.compileModuleAsync(t))))}}class CV{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Np,this.attachRef=null}}class Np{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const r=this.getOrCreateContext(e);r.outlet=t,this.contexts.set(e,r)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new CV,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class DV{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function SV(n){throw n}function MV(n,e,t){return e.parse("/")}function qM(n,e){return Sn(null)}const TV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},IV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let oa=(()=>{class n{constructor(t,r,s,c,m,w,I,L){this.rootComponentType=t,this.urlSerializer=r,this.rootContexts=s,this.location=c,this.config=L,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new co,this.errorHandler=SV,this.malformedUriErrorHandler=MV,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:qM,afterPreactivation:qM},this.urlHandlingStrategy=new DV,this.routeReuseStrategy=new wV,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=m.get(Qc),this.console=m.get(Q_);const K=m.get(Ei);this.isNgZoneEnabled=K instanceof Ei&&Ei.isInAngularZone(),this.resetConfig(L),this.currentUrlTree=new NA(new ir([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new HM(w,I,ie=>this.triggerEvent(new tM(ie)),ie=>this.triggerEvent(new nM(ie))),this.routerState=yM(this.currentUrlTree,this.rootComponentType),this.transitions=new Kl({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const r=this.events;return t.pipe(sh(s=>0!==s.id),fn(s=>Object.assign(Object.assign({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),oh(s=>{let c=!1,m=!1;return Sn(s).pipe(ss(w=>{this.currentNavigation={id:w.id,initialUrl:w.currentRawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),oh(w=>{const I=this.browserUrlTree.toString(),L=!this.navigated||w.extractedUrl.toString()!==I||I!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||L)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return Vy(w.source)&&(this.browserUrlTree=w.extractedUrl),Sn(w).pipe(oh(W=>{const K=this.transitions.getValue();return r.next(new pb(W.id,this.serializeUrl(W.extractedUrl),W.source,W.restoredState)),K!==this.transitions.getValue()?Fp:Promise.resolve(W)}),function(n,e,t,r){return oh(s=>function(n,e,t,r,s){return new Wz(n,e,t,r,s).apply()}(n,e,t,s.extractedUrl,r).pipe(fn(c=>Object.assign(Object.assign({},s),{urlAfterRedirects:c}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),ss(W=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:W.urlAfterRedirects})}),function(n,e,t,r,s){return mr(c=>function(n,e,t,r,s="emptyOnly",c="legacy"){try{const m=new dV(n,e,t,r,s,c).recognize();return null===m?zM(new uV):Sn(m)}catch(m){return zM(m)}}(n,e,c.urlAfterRedirects,t(c.urlAfterRedirects),r,s).pipe(fn(m=>Object.assign(Object.assign({},c),{targetSnapshot:m}))))}(this.rootComponentType,this.config,W=>this.serializeUrl(W),this.paramsInheritanceStrategy,this.relativeLinkResolution),ss(W=>{"eager"===this.urlUpdateStrategy&&(W.extras.skipLocationChange||this.setBrowserUrl(W.urlAfterRedirects,W),this.browserUrlTree=W.urlAfterRedirects);const K=new G5(W.id,this.serializeUrl(W.extractedUrl),this.serializeUrl(W.urlAfterRedirects),W.targetSnapshot);r.next(K)}));if(L&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:K,extractedUrl:ie,source:fe,restoredState:Ve,extras:Re}=w,Je=new pb(K,this.serializeUrl(ie),fe,Ve);r.next(Je);const He=yM(ie,this.rootComponentType).snapshot;return Sn(Object.assign(Object.assign({},w),{targetSnapshot:He,urlAfterRedirects:ie,extras:Object.assign(Object.assign({},Re),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=w.rawUrl,this.browserUrlTree=w.urlAfterRedirects,w.resolve(null),Fp}),Ib(w=>{const{targetSnapshot:I,id:L,extractedUrl:U,rawUrl:W,extras:{skipLocationChange:K,replaceUrl:ie}}=w;return this.hooks.beforePreactivation(I,{navigationId:L,appliedUrlTree:U,rawUrlTree:W,skipLocationChange:!!K,replaceUrl:!!ie})}),ss(w=>{const I=new H5(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(I)}),fn(w=>Object.assign(Object.assign({},w),{guards:Yz(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function(n,e){return mr(t=>{const{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:c,canDeactivateChecks:m}}=t;return 0===m.length&&0===c.length?Sn(Object.assign(Object.assign({},t),{guardsResult:!0})):function(n,e,t,r){return Pr(n).pipe(mr(s=>function(n,e,t,r,s){const c=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return c&&0!==c.length?Sn(c.map(w=>{const I=zy(w,e,s);let L;if(function(n){return n&&td(n.canDeactivate)}(I))L=Kc(I.canDeactivate(n,e,t,r));else{if(!td(I))throw new Error("Invalid CanDeactivate guard");L=Kc(I(n,e,t,r))}return L.pipe(BA())})).pipe(r0()):Sn(!0)}(s.component,s.route,t,e,r)),BA(s=>!0!==s,!0))}(m,r,s,n).pipe(mr(w=>w&&function(n){return"boolean"==typeof n}(w)?function(n,e,t,r){return Pr(e).pipe(Op(s=>hb(function(n,e){return null!==n&&e&&e(new Q5(n)),Sn(!0)}(s.route.parent,r),function(n,e){return null!==n&&e&&e(new Y5(n)),Sn(!0)}(s.route,r),function(n,e,t){const r=e[e.length-1],c=e.slice(0,e.length-1).reverse().map(m=>function(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(m)).filter(m=>null!==m).map(m=>WS(()=>Sn(m.guards.map(I=>{const L=zy(I,m.node,t);let U;if(function(n){return n&&td(n.canActivateChild)}(L))U=Kc(L.canActivateChild(r,n));else{if(!td(L))throw new Error("Invalid CanActivateChild guard");U=Kc(L(r,n))}return U.pipe(BA())})).pipe(r0())));return Sn(c).pipe(r0())}(n,s.path,t),function(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?Sn(r.map(c=>WS(()=>{const m=zy(c,e,t);let w;if(function(n){return n&&td(n.canActivate)}(m))w=Kc(m.canActivate(e,n));else{if(!td(m))throw new Error("Invalid CanActivate guard");w=Kc(m(e,n))}return w.pipe(BA())}))).pipe(r0()):Sn(!0)}(n,s.route,t))),BA(s=>!0!==s,!0))}(r,c,n,e):Sn(w)),fn(w=>Object.assign(Object.assign({},t),{guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),ss(w=>{if(VA(w.guardsResult)){const L=mb(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw L.url=w.guardsResult,L}const I=new q5(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(I)}),sh(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),Ib(w=>{if(w.guards.canActivateChecks.length)return Sn(w).pipe(ss(I=>{const L=new Z5(I.id,this.serializeUrl(I.extractedUrl),this.serializeUrl(I.urlAfterRedirects),I.targetSnapshot);this.triggerEvent(L)}),oh(I=>{let L=!1;return Sn(I).pipe(function(n,e){return mr(t=>{const{targetSnapshot:r,guards:{canActivateChecks:s}}=t;if(!s.length)return Sn(t);let c=0;return Pr(s).pipe(Op(m=>function(n,e,t,r){return function(n,e,t,r){const s=Object.keys(n);if(0===s.length)return Sn({});const c={};return Pr(s).pipe(mr(m=>function(n,e,t,r){const s=zy(n,e,r);return Kc(s.resolve?s.resolve(e,t):s(e,t))}(n[m],e,t,r).pipe(ss(w=>{c[m]=w}))),fb(1),mr(()=>Object.keys(c).length===s.length?Sn(c):Fp))}(n._resolve,n,e,r).pipe(fn(c=>(n._resolvedData=c,n.data=Object.assign(Object.assign({},n.data),vM(n,t).resolve),null)))}(m.route,r,n,e)),ss(()=>c++),fb(1),mr(m=>c===s.length?Sn(t):Fp))})}(this.paramsInheritanceStrategy,this.ngModule.injector),ss({next:()=>L=!0,complete:()=>{L||(this.restoreHistory(I),this.cancelNavigationTransition(I,"At least one route resolver didn't emit any value."))}}))}),ss(I=>{const L=new W5(I.id,this.serializeUrl(I.extractedUrl),this.serializeUrl(I.urlAfterRedirects),I.targetSnapshot);this.triggerEvent(L)}))}),Ib(w=>{const{targetSnapshot:I,id:L,extractedUrl:U,rawUrl:W,extras:{skipLocationChange:K,replaceUrl:ie}}=w;return this.hooks.afterPreactivation(I,{navigationId:L,appliedUrlTree:U,rawUrlTree:W,skipLocationChange:!!K,replaceUrl:!!ie})}),fn(w=>{const I=function(n,e,t){const r=ky(n,e._root,t?t._root:void 0);return new _M(r,e)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return Object.assign(Object.assign({},w),{targetRouterState:I})}),ss(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((n,e,t)=>fn(r=>(new Pz(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),ss({next(){c=!0},complete(){c=!0}}),function(n){return e=>e.lift(new U5(n))}(()=>{var w;if(!c&&!m){const I=`Navigation ID ${s.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(s),this.cancelNavigationTransition(s,I)):this.cancelNavigationTransition(s,I)}(null===(w=this.currentNavigation)||void 0===w?void 0:w.id)===s.id&&(this.currentNavigation=null)}),Jh(w=>{if(m=!0,function(n){return n&&n[iM]}(w)){const I=VA(w.url);I||(this.navigated=!0,this.restoreHistory(s,!0));const L=new eM(s.id,this.serializeUrl(s.extractedUrl),w.message);r.next(L),I?setTimeout(()=>{const U=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),W={skipLocationChange:s.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Vy(s.source)};this.scheduleNavigation(U,"imperative",null,W,{resolve:s.resolve,reject:s.reject,promise:s.promise})},0):s.resolve(!1)}else{this.restoreHistory(s,!0);const I=new $5(s.id,this.serializeUrl(s.extractedUrl),w);r.next(I);try{s.resolve(this.errorHandler(w))}catch(L){s.reject(L)}}return Fp}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r=this.extractLocationChangeInfoFromEvent(t);this.shouldScheduleNavigation(this.lastLocationChangeInfo,r)&&setTimeout(()=>{const{source:s,state:c,urlTree:m}=r,w={replaceUrl:!0};if(c){const I=Object.assign({},c);delete I.navigationId,delete I.\u0275routerPageId,0!==Object.keys(I).length&&(w.state=I)}this.scheduleNavigation(m,s,c,w)},0),this.lastLocationChangeInfo=r}))}extractLocationChangeInfoFromEvent(t){var r;return{source:"popstate"===t.type?"popstate":"hashchange",urlTree:this.parseUrl(t.url),state:(null===(r=t.state)||void 0===r?void 0:r.navigationId)?t.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(t,r){if(!t)return!0;const s=r.urlTree.toString()===t.urlTree.toString();return r.transitionId!==t.transitionId||!s||!("hashchange"===r.source&&"popstate"===t.source||"popstate"===r.source&&"hashchange"===t.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){kM(t),this.config=t.map(Mb),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:s,queryParams:c,fragment:m,queryParamsHandling:w,preserveFragment:I}=r,L=s||this.routerState.root,U=I?this.currentUrlTree.fragment:m;let W=null;switch(w){case"merge":W=Object.assign(Object.assign({},this.currentUrlTree.queryParams),c);break;case"preserve":W=this.currentUrlTree.queryParams;break;default:W=c||null}return null!==W&&(W=this.removeEmptyProps(W)),function(n,e,t,r,s){if(0===t.length)return Cb(e.root,e.root,e,r,s);const c=function(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new EM(!0,0,n);let e=0,t=!1;const r=n.reduce((s,c,m)=>{if("object"==typeof c&&null!=c){if(c.outlets){const w={};return No(c.outlets,(I,L)=>{w[L]="string"==typeof I?I.split("/"):I}),[...s,{outlets:w}]}if(c.segmentPath)return[...s,c.segmentPath]}return"string"!=typeof c?[...s,c]:0===m?(c.split("/").forEach((w,I)=>{0==I&&"."===w||(0==I&&""===w?t=!0:".."===w?e++:""!=w&&s.push(w))}),s):[...s,c]},[]);return new EM(t,e,r)}(t);if(c.toRoot())return Cb(e.root,new ir([],{}),e,r,s);const m=function(n,e,t){if(n.isAbsolute)return new Eb(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const c=t.snapshot._urlSegment;return new Eb(c,c===e.root,0)}const r=Py(n.commands[0])?0:1;return function(n,e,t){let r=n,s=e,c=t;for(;c>s;){if(c-=s,r=r.parent,!r)throw new Error("Invalid number of '../'");s=r.segments.length}return new Eb(r,!1,s-c)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+r,n.numberOfDoubleDots)}(c,e,n),w=m.processChildren?Ry(m.segmentGroup,m.index,c.commands):DM(m.segmentGroup,m.index,c.commands);return Cb(m.segmentGroup,w,e,r,s)}(L,this.currentUrlTree,t,W,null!=U?U:null)}navigateByUrl(t,r={skipLocationChange:!1}){const s=VA(t)?t:this.parseUrl(t),c=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,r)}navigate(t,r={skipLocationChange:!1}){return function(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(s){r=this.malformedUriErrorHandler(s,this.urlSerializer,t)}return r}isActive(t,r){let s;if(s=!0===r?Object.assign({},TV):!1===r?Object.assign({},IV):r,VA(t))return cM(this.currentUrlTree,t,s);const c=this.parseUrl(t);return cM(this.currentUrlTree,c,s)}removeEmptyProps(t){return Object.keys(t).reduce((r,s)=>{const c=t[s];return null!=c&&(r[s]=c),r},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new Yg(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,r,s,c,m){var w,I;if(this.disposed)return Promise.resolve(!1);const L=this.getTransition(),U=Vy(r)&&L&&!Vy(L.source),ie=(this.lastSuccessfulId===L.id||this.currentNavigation?L.rawUrl:L.urlAfterRedirects).toString()===t.toString();if(U&&ie)return Promise.resolve(!0);let fe,Ve,Re;m?(fe=m.resolve,Ve=m.reject,Re=m.promise):Re=new Promise((Rt,Gt)=>{fe=Rt,Ve=Gt});const Je=++this.navigationId;let He;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(s=this.location.getState()),He=s&&s.\u0275routerPageId?s.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?null!==(w=this.browserPageId)&&void 0!==w?w:0:(null!==(I=this.browserPageId)&&void 0!==I?I:0)+1):He=0,this.setTransition({id:Je,targetPageId:He,source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:c,resolve:fe,reject:Ve,promise:Re,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Re.catch(Rt=>Promise.reject(Rt))}setBrowserUrl(t,r){const s=this.urlSerializer.serialize(t),c=Object.assign(Object.assign({},r.extras.state),this.generateNgRouterState(r.id,r.targetPageId));this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl?this.location.replaceState(s,"",c):this.location.go(s,"",c)}restoreHistory(t,r=!1){var s,c;if("computed"===this.canceledNavigationResolution){const m=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)||0===m?this.currentUrlTree===(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)&&0===m&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(m)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,r){const s=new eM(t.id,this.serializeUrl(t.extractedUrl),r);this.triggerEvent(s),t.resolve(!1)}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)(yt(Bu),yt(gb),yt(Np),yt(ly),yt(Sr),yt(Y_),yt(RA),yt(void 0))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function Vy(n){return"imperative"!==n}let ZM=(()=>{class n{constructor(t,r,s,c,m){this.parentContexts=t,this.location=r,this.resolver=s,this.changeDetector=m,this.activated=null,this._activatedRoute=null,this.activateEvents=new lt,this.deactivateEvents=new lt,this.name=c||Xn,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const m=(r=r||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),w=this.parentContexts.getOrCreateContext(this.name).children,I=new FV(t,w,this.location.injector);this.activated=this.location.createComponent(m,this.location.length,I),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(At(Np),At(Gl),At(IA),function(n){return function(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const r=t.length;let s=0;for(;s<r;){const c=t[s];if(te(c))break;if(0===c)s+=2;else if("number"==typeof c)for(s++;s<r&&"string"==typeof t[s];)s++;else{if(c===e)return t[s+1];s+=2}}}return null}(ii(),n)}("name"),At(G1))},n.\u0275dir=Wt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),n})();class FV{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Bp?this.route:e===Np?this.childContexts:this.parent.get(e,t)}}class WM{}class QM{preload(e,t){return Sn(null)}}let XM=(()=>{class n{constructor(t,r,s,c,m){this.router=t,this.injector=c,this.preloadingStrategy=m,this.loader=new HM(r,s,L=>t.triggerEvent(new tM(L)),L=>t.triggerEvent(new nM(L)))}setUpPreloading(){this.subscription=this.router.events.pipe(sh(t=>t instanceof Yg),Op(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(Qc);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const s=[];for(const c of r)if(c.loadChildren&&!c.canLoad&&c._loadedConfig){const m=c._loadedConfig;s.push(this.processRoutes(m.module,m.routes))}else c.loadChildren&&!c.canLoad?s.push(this.preloadConfig(t,c)):c.children&&s.push(this.processRoutes(t,c.children));return Pr(s).pipe(jo(),fn(c=>{}))}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>(r._loadedConfig?Sn(r._loadedConfig):this.loader.load(t.injector,r)).pipe(mr(c=>(r._loadedConfig=c,this.processRoutes(c.module,c.routes)))))}}return n.\u0275fac=function(t){return new(t||n)(yt(oa),yt(Y_),yt(RA),yt(Sr),yt(WM))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),Fb=(()=>{class n{constructor(t,r,s={}){this.router=t,this.viewportScroller=r,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration=s.scrollPositionRestoration||"disabled",s.anchorScrolling=s.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof pb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Yg&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof rM&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.router.triggerEvent(new rM(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(yt(oa),yt(kS),yt(void 0))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const UA=new rn("ROUTER_CONFIGURATION"),YM=new rn("ROUTER_FORROOT_GUARD"),LV=[ly,{provide:gb,useClass:AM},{provide:oa,useFactory:function(n,e,t,r,s,c,m,w={},I,L){const U=new oa(null,n,e,t,r,s,c,sM(m));return I&&(U.urlHandlingStrategy=I),L&&(U.routeReuseStrategy=L),function(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy)}(w,U),w.enableTracing&&U.events.subscribe(W=>{var K,ie;null===(K=console.group)||void 0===K||K.call(console,`Router Event: ${W.constructor.name}`),console.log(W.toString()),console.log(W),null===(ie=console.groupEnd)||void 0===ie||ie.call(console)}),U},deps:[gb,Np,ly,Sr,Y_,RA,kb,UA,[class{},new Ko],[class{},new Ko]]},Np,{provide:Bp,useFactory:function(n){return n.routerState.root},deps:[oa]},{provide:Y_,useClass:kL},XM,QM,class{preload(e,t){return t().pipe(Jh(()=>Sn(null)))}},{provide:UA,useValue:{enableTracing:!1}}];function BV(){return new Ex("Router",oa)}let KM=(()=>{class n{constructor(t,r){}static forRoot(t,r){return{ngModule:n,providers:[LV,JM(t),{provide:YM,useFactory:VV,deps:[[oa,new Ko,new xi]]},{provide:UA,useValue:r||{}},{provide:Rp,useFactory:zV,deps:[LA,[new Uu(jx),new Ko],UA]},{provide:Fb,useFactory:NV,deps:[oa,kS,UA]},{provide:WM,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:QM},{provide:Ex,multi:!0,useFactory:BV},[Ob,{provide:Vg,multi:!0,useFactory:GV,deps:[Ob]},{provide:eT,useFactory:HV,deps:[Ob]},{provide:xD,multi:!0,useExisting:eT}]]}}static forChild(t){return{ngModule:n,providers:[JM(t)]}}}return n.\u0275fac=function(t){return new(t||n)(yt(YM,8),yt(oa,8))},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({}),n})();function NV(n,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new Fb(n,e,t)}function zV(n,e,t={}){return t.useHash?new K4(n,e):new hS(n,e)}function VV(n){return"guarded"}function JM(n){return[{provide:Oh,multi:!0,useValue:n},{provide:kb,multi:!0,useValue:n}]}let Ob=(()=>{class n{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new co}appInitializer(){return this.injector.get(Q4,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const s=new Promise(w=>r=w),c=this.injector.get(oa),m=this.injector.get(UA);return"disabled"===m.initialNavigation?(c.setUpLocationChangeListener(),r(!0)):"enabled"===m.initialNavigation||"enabledBlocking"===m.initialNavigation?(c.hooks.afterPreactivation=()=>this.initNavigation?Sn(null):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),c.initialNavigation()):r(!0),s})}bootstrapListener(t){const r=this.injector.get(UA),s=this.injector.get(XM),c=this.injector.get(Fb),m=this.injector.get(oa),w=this.injector.get(Ip);t===w.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&m.initialNavigation(),s.setUpPreloading(),c.init(),m.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(t){return new(t||n)(yt(Sr))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function GV(n){return n.appInitializer.bind(n)}function HV(n){return n.bootstrapListener.bind(n)}const eT=new rn("Router Initializer"),ZV=[];let WV=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({imports:[[KM.forRoot(ZV)],KM]}),n})();var Vp=Ra(958);function nd(n,e,t,r){return new(t||(t=Promise))(function(c,m){function w(U){try{L(r.next(U))}catch(W){m(W)}}function I(U){try{L(r.throw(U))}catch(W){m(W)}}function L(U){U.done?c(U.value):function(c){return c instanceof t?c:new t(function(m){m(c)})}(U.value).then(w,I)}L((r=r.apply(n,e||[])).next())})}class iT extends co{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(e){return this.hasError?(e.error(this.thrownError),Ct.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),Ct.EMPTY):super._subscribe(e)}next(e){this.hasCompleted||(this.value=e,this.hasNext=!0)}error(e){this.hasCompleted||super.error(e)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}function Bb(n,e,t,r){return Ns(t)&&(r=t,t=void 0),r?Bb(n,e,t).pipe(fn(s=>Vo(s)?r(...s):r(s))):new jn(s=>{oT(n,e,function(m){s.next(arguments.length>1?Array.prototype.slice.call(arguments):m)},s,t)})}function oT(n,e,t,r,s){let c;if(function(n){return n&&"function"==typeof n.addEventListener&&"function"==typeof n.removeEventListener}(n)){const m=n;n.addEventListener(e,t,s),c=()=>m.removeEventListener(e,t,s)}else if(function(n){return n&&"function"==typeof n.on&&"function"==typeof n.off}(n)){const m=n;n.on(e,t),c=()=>m.off(e,t)}else if(function(n){return n&&"function"==typeof n.addListener&&"function"==typeof n.removeListener}(n)){const m=n;n.addListener(e,t),c=()=>m.removeListener(e,t)}else{if(!n||!n.length)throw new TypeError("Invalid event target");for(let m=0,w=n.length;m<w;m++)oT(n[m],e,t,r,s)}r.add(c)}class e8 extends Ct{constructor(e,t){super()}schedule(e,t=0){return this}}let sT=(()=>{class n{constructor(t,r=n.now){this.SchedulerAction=t,this.now=r}schedule(t,r=0,s){return new this.SchedulerAction(this,t).schedule(s,r)}}return n.now=()=>Date.now(),n})();class rd extends sT{constructor(e,t=sT.now){super(e,()=>rd.delegate&&rd.delegate!==this?rd.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,r){return rd.delegate&&rd.delegate!==this?rd.delegate.schedule(e,t,r):super.schedule(e,t,r)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const n8=new rd(class extends e8{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,r=0){return setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let s,r=!1;try{this.work(e)}catch(c){r=!0,s=!!c&&c||new Error(c)}if(r)return this.unsubscribe(),s}_unsubscribe(){const e=this.id,t=this.scheduler,r=t.actions,s=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==s&&r.splice(s,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}});class i8{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new o8(e,this.dueTime,this.scheduler))}}class o8 extends Wn{constructor(e,t,r){super(e),this.dueTime=t,this.scheduler=r,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(s8,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function s8(n){n.debouncedNext()}class l8{constructor(e){this.value=e}call(e,t){return t.subscribe(new c8(e,this.value))}}class c8 extends Wn{constructor(e,t){super(e),this.value=t}_next(e){this.destination.next(this.value)}}const u8=["container"],lT=new rn("MapboxApiKey");let jy=(()=>{class n{constructor(t,r){this.zone=t,this.MAPBOX_API_KEY=r,this.mapCreated=new iT,this.mapLoaded=new iT,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new Ct,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(t){this.zone.onStable.pipe(BA()).subscribe(()=>{this.assign(Vp,"accessToken",t.accessToken||this.MAPBOX_API_KEY),t.customMapboxApiUrl&&this.assign(Vp,"config.API_URL",t.customMapboxApiUrl),this.createMap(t.mapOptions),this.hookEvents(t.mapEvents),this.mapEvents=t.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete()})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(t)})}updateMaxZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(t)})}updateMinPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(t)})}updateMaxPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(t)})}updateRenderWorldCopies(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(t)})}updateScrollZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(t)})}updateMaxBounds(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(t)})}changeCanvasCursor(t){this.mapInstance.getCanvasContainer().style.cursor=t}queryRenderedFeatures(t,r){return this.mapInstance.queryRenderedFeatures(t,r)}panTo(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(t,r)})}move(t,r,s,c,m,w){return this.zone.runOutsideAngular(()=>{this.mapInstance[t](Object.assign(Object.assign({},r),{zoom:null!=s?s:this.mapInstance.getZoom(),center:null!=c?c:this.mapInstance.getCenter(),bearing:null!=m?m:this.mapInstance.getBearing(),pitch:null!=w?w:this.mapInstance.getPitch()}))})}addLayer(t,r,s){this.zone.runOutsideAngular(()=>{Object.keys(t.layerOptions).forEach(c=>{void 0===t.layerOptions[c]&&delete t.layerOptions[c]}),this.mapInstance.addLayer(t.layerOptions,s),r&&((t.layerEvents.layerClick.observers.length||t.layerEvents.click.observers.length)&&this.mapInstance.on("click",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerClick.emit(c),t.layerEvents.click.emit(c)})}),(t.layerEvents.layerDblClick.observers.length||t.layerEvents.dblClick.observers.length)&&this.mapInstance.on("dblclick",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerDblClick.emit(c),t.layerEvents.dblClick.emit(c)})}),(t.layerEvents.layerMouseDown.observers.length||t.layerEvents.mouseDown.observers.length)&&this.mapInstance.on("mousedown",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseDown.emit(c),t.layerEvents.mouseDown.emit(c)})}),(t.layerEvents.layerMouseUp.observers.length||t.layerEvents.mouseUp.observers.length)&&this.mapInstance.on("mouseup",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseUp.emit(c),t.layerEvents.mouseUp.emit(c)})}),(t.layerEvents.layerMouseEnter.observers.length||t.layerEvents.mouseEnter.observers.length)&&this.mapInstance.on("mouseenter",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseEnter.emit(c),t.layerEvents.mouseEnter.emit(c)})}),(t.layerEvents.layerMouseLeave.observers.length||t.layerEvents.mouseLeave.observers.length)&&this.mapInstance.on("mouseleave",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseLeave.emit(c),t.layerEvents.mouseLeave.emit(c)})}),(t.layerEvents.layerMouseMove.observers.length||t.layerEvents.mouseMove.observers.length)&&this.mapInstance.on("mousemove",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseMove.emit(c),t.layerEvents.mouseMove.emit(c)})}),(t.layerEvents.layerMouseOver.observers.length||t.layerEvents.mouseOver.observers.length)&&this.mapInstance.on("mouseover",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseOver.emit(c),t.layerEvents.mouseOver.emit(c)})}),(t.layerEvents.layerMouseOut.observers.length||t.layerEvents.mouseOut.observers.length)&&this.mapInstance.on("mouseout",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseOut.emit(c),t.layerEvents.mouseOut.emit(c)})}),(t.layerEvents.layerContextMenu.observers.length||t.layerEvents.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerContextMenu.emit(c),t.layerEvents.contextMenu.emit(c)})}),(t.layerEvents.layerTouchStart.observers.length||t.layerEvents.touchStart.observers.length)&&this.mapInstance.on("touchstart",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerTouchStart.emit(c),t.layerEvents.touchStart.emit(c)})}),(t.layerEvents.layerTouchEnd.observers.length||t.layerEvents.touchEnd.observers.length)&&this.mapInstance.on("touchend",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerTouchEnd.emit(c),t.layerEvents.touchEnd.emit(c)})}),(t.layerEvents.layerTouchCancel.observers.length||t.layerEvents.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerTouchCancel.emit(c),t.layerEvents.touchCancel.emit(c)})}))})}removeLayer(t){this.zone.runOutsideAngular(()=>{null!=this.mapInstance.getLayer(t)&&this.mapInstance.removeLayer(t)})}addMarker(t){const r={offset:t.markersOptions.offset,anchor:t.markersOptions.anchor,draggable:!!t.markersOptions.draggable,rotationAlignment:t.markersOptions.rotationAlignment,pitchAlignment:t.markersOptions.pitchAlignment,clickTolerance:t.markersOptions.clickTolerance};t.markersOptions.element.childNodes.length>0&&(r.element=t.markersOptions.element);const s=new Vp.Marker(r);return(t.markersEvents.markerDragStart.observers.length||t.markersEvents.dragStart.observers.length)&&s.on("dragstart",m=>{if(m){const{target:w}=m;this.zone.run(()=>{t.markersEvents.markerDragStart.emit(w),t.markersEvents.dragStart.emit(w)})}}),(t.markersEvents.markerDrag.observers.length||t.markersEvents.drag.observers.length)&&s.on("drag",m=>{if(m){const{target:w}=m;this.zone.run(()=>{t.markersEvents.markerDrag.emit(w),t.markersEvents.drag.emit(w)})}}),(t.markersEvents.markerDragEnd.observers.length||t.markersEvents.dragEnd.observers.length)&&s.on("dragend",m=>{if(m){const{target:w}=m;this.zone.run(()=>{t.markersEvents.markerDragEnd.emit(w),t.markersEvents.dragEnd.emit(w)})}}),s.setLngLat(t.markersOptions.feature?t.markersOptions.feature.geometry.coordinates:t.markersOptions.lngLat),this.zone.runOutsideAngular(()=>(s.addTo(this.mapInstance),s))}removeMarker(t){this.markersToRemove.push(t)}createPopup(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(t.popupOptions).forEach(c=>void 0===t.popupOptions[c]&&delete t.popupOptions[c]);const s=new Vp.Popup(t.popupOptions);return s.setDOMContent(r),(t.popupEvents.popupClose.observers.length||t.popupEvents.close.observers.length)&&s.on("close",()=>{this.zone.run(()=>{t.popupEvents.popupClose.emit(),t.popupEvents.close.emit()})}),(t.popupEvents.popupOpen.observers.length||t.popupEvents.open.observers.length)&&s.on("open",()=>{this.zone.run(()=>{t.popupEvents.popupOpen.emit(),t.popupEvents.open.emit()})}),s})}addPopupToMap(t,r,s=!1){return this.zone.runOutsideAngular(()=>{s&&t._listeners&&delete t._listeners.open,t.setLngLat(r),t.addTo(this.mapInstance)})}addPopupToMarker(t,r){return this.zone.runOutsideAngular(()=>{t.setPopup(r)})}removePopupFromMap(t,r=!1){r&&t._listeners&&delete t._listeners.close,this.popupsToRemove.push(t)}removePopupFromMarker(t){return this.zone.runOutsideAngular(()=>{t.setPopup(void 0)})}addControl(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(t,r)})}removeControl(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(t)})}loadAndAddImage(t,r,s){return nd(this,void 0,void 0,function*(){return this.zone.runOutsideAngular(()=>new Promise((c,m)=>{this.mapInstance.loadImage(r,(w,I)=>{w?m(w):(this.addImage(t,I,s),c())})}))})}addImage(t,r,s){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(t,r,s)})}removeImage(t){this.imageIdsToRemove.push(t)}addSource(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(s=>void 0===r[s]&&delete r[s]),this.mapInstance.addSource(t,r)})}getSource(t){return this.mapInstance.getSource(t)}removeSource(t){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(t).forEach(r=>this.mapInstance.removeLayer(r.id)),this.mapInstance.removeSource(t)})}setAllLayerPaintProperty(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(s=>{this.mapInstance.setPaintProperty(t,s,r[s])})})}setAllLayerLayoutProperty(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(s=>{this.mapInstance.setLayoutProperty(t,s,r[s])})})}setLayerFilter(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(t,r)})}setLayerBefore(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(t,r)})}setLayerZoomRange(t,r,s){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(t,r||0,s||20)})}fitBounds(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(t,r)})}fitScreenCoordinates(t,r,s){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(t[0],t[1],r,s)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(t){Ei.assertNotInAngularZone(),Object.keys(t).forEach(s=>{void 0===t[s]&&delete t[s]}),this.mapInstance=new Vp.Map(t),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(t.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(const t of this.markersToRemove)t.remove();this.markersToRemove=[]}removePopups(){for(const t of this.popupsToRemove)t.remove();this.popupsToRemove=[]}removeImages(){for(const t of this.imageIdsToRemove)this.mapInstance.removeImage(t);this.imageIdsToRemove=[]}findLayersBySourceId(t){const r=this.mapInstance.getStyle().layers;return null==r?[]:r.filter(s=>"source"in s&&s.source===t)}hookEvents(t){this.mapInstance.on("load",r=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{t.mapLoad.emit(r.target),t.load.emit(r.target)})}),(t.mapResize.observers.length||t.resize.observers.length)&&this.mapInstance.on("resize",r=>this.zone.run(()=>{t.mapResize.emit(r),t.resize.emit(r)})),(t.mapRemove.observers.length||t.remove.observers.length)&&this.mapInstance.on("remove",r=>this.zone.run(()=>{t.mapRemove.emit(r),t.remove.emit(r)})),(t.mapMouseDown.observers.length||t.mouseDown.observers.length)&&this.mapInstance.on("mousedown",r=>this.zone.run(()=>{t.mapMouseDown.emit(r),t.mouseDown.emit(r)})),(t.mapMouseUp.observers.length||t.mouseUp.observers.length)&&this.mapInstance.on("mouseup",r=>this.zone.run(()=>{t.mapMouseUp.emit(r),t.mouseUp.emit(r)})),(t.mapMouseMove.observers.length||t.mouseMove.observers.length)&&this.mapInstance.on("mousemove",r=>this.zone.run(()=>{t.mapMouseMove.emit(r),t.mouseMove.emit(r)})),(t.mapClick.observers.length||t.click.observers.length)&&this.mapInstance.on("click",r=>this.zone.run(()=>{t.mapClick.emit(r),t.click.emit(r)})),(t.mapDblClick.observers.length||t.dblClick.observers.length)&&this.mapInstance.on("dblclick",r=>this.zone.run(()=>{t.mapDblClick.emit(r),t.dblClick.emit(r)})),(t.mapMouseOver.observers.length||t.mouseOver.observers.length)&&this.mapInstance.on("mouseover",r=>this.zone.run(()=>{t.mapMouseOver.emit(r),t.mouseOver.emit(r)})),(t.mapMouseOut.observers.length||t.mouseOut.observers.length)&&this.mapInstance.on("mouseout",r=>this.zone.run(()=>{t.mapMouseOut.emit(r),t.mouseOut.emit(r)})),(t.mapContextMenu.observers.length||t.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",r=>this.zone.run(()=>{t.mapContextMenu.emit(r),t.contextMenu.emit(r)})),(t.mapTouchStart.observers.length||t.touchStart.observers.length)&&this.mapInstance.on("touchstart",r=>this.zone.run(()=>{t.mapTouchStart.emit(r),t.touchStart.emit(r)})),(t.mapTouchEnd.observers.length||t.touchEnd.observers.length)&&this.mapInstance.on("touchend",r=>this.zone.run(()=>{t.mapTouchEnd.emit(r),t.touchEnd.emit(r)})),(t.mapTouchMove.observers.length||t.touchMove.observers.length)&&this.mapInstance.on("touchmove",r=>this.zone.run(()=>{t.mapTouchMove.emit(r),t.touchMove.emit(r)})),(t.mapTouchCancel.observers.length||t.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",r=>this.zone.run(()=>{t.mapTouchCancel.emit(r),t.touchCancel.emit(r)})),(t.mapWheel.observers.length||t.wheel.observers.length)&&this.mapInstance.on("wheel",r=>this.zone.run(()=>{t.mapWheel.emit(r),t.wheel.emit(r)})),t.moveStart.observers.length&&this.mapInstance.on("movestart",r=>this.zone.run(()=>t.moveStart.emit(r))),t.move.observers.length&&this.mapInstance.on("move",r=>this.zone.run(()=>t.move.emit(r))),t.moveEnd.observers.length&&this.mapInstance.on("moveend",r=>this.zone.run(()=>t.moveEnd.emit(r))),(t.mapDragStart.observers.length||t.dragStart.observers.length)&&this.mapInstance.on("dragstart",r=>this.zone.run(()=>{t.mapDragStart.emit(r),t.dragStart.emit(r)})),(t.mapDrag.observers.length||t.drag.observers.length)&&this.mapInstance.on("drag",r=>this.zone.run(()=>{t.mapDrag.emit(r),t.drag.emit(r)})),(t.mapDragEnd.observers.length||t.dragEnd.observers.length)&&this.mapInstance.on("dragend",r=>this.zone.run(()=>{t.mapDragEnd.emit(r),t.dragEnd.emit(r)})),t.zoomStart.observers.length&&this.mapInstance.on("zoomstart",r=>this.zone.run(()=>t.zoomStart.emit(r))),t.zoomEvt.observers.length&&this.mapInstance.on("zoom",r=>this.zone.run(()=>t.zoomEvt.emit(r))),t.zoomEnd.observers.length&&this.mapInstance.on("zoomend",r=>this.zone.run(()=>t.zoomEnd.emit(r))),t.rotateStart.observers.length&&this.mapInstance.on("rotatestart",r=>this.zone.run(()=>t.rotateStart.emit(r))),t.rotate.observers.length&&this.mapInstance.on("rotate",r=>this.zone.run(()=>t.rotate.emit(r))),t.rotateEnd.observers.length&&this.mapInstance.on("rotateend",r=>this.zone.run(()=>t.rotateEnd.emit(r))),t.pitchStart.observers.length&&this.mapInstance.on("pitchstart",r=>this.zone.run(()=>t.pitchStart.emit(r))),t.pitchEvt.observers.length&&this.mapInstance.on("pitch",r=>this.zone.run(()=>t.pitchEvt.emit(r))),t.pitchEnd.observers.length&&this.mapInstance.on("pitchend",r=>this.zone.run(()=>t.pitchEnd.emit(r))),t.boxZoomStart.observers.length&&this.mapInstance.on("boxzoomstart",r=>this.zone.run(()=>t.boxZoomStart.emit(r))),t.boxZoomEnd.observers.length&&this.mapInstance.on("boxzoomend",r=>this.zone.run(()=>t.boxZoomEnd.emit(r))),t.boxZoomCancel.observers.length&&this.mapInstance.on("boxzoomcancel",r=>this.zone.run(()=>t.boxZoomCancel.emit(r))),t.webGlContextLost.observers.length&&this.mapInstance.on("webglcontextlost",r=>this.zone.run(()=>t.webGlContextLost.emit(r))),t.webGlContextRestored.observers.length&&this.mapInstance.on("webglcontextrestored",r=>this.zone.run(()=>t.webGlContextRestored.emit(r))),t.render.observers.length&&this.mapInstance.on("render",r=>this.zone.run(()=>t.render.emit(r))),(t.mapError.observers.length||t.error.observers.length)&&this.mapInstance.on("error",r=>this.zone.run(()=>{t.mapError.emit(r),t.error.emit(r)})),t.data.observers.length&&this.mapInstance.on("data",r=>this.zone.run(()=>t.data.emit(r))),t.styleData.observers.length&&this.mapInstance.on("styledata",r=>this.zone.run(()=>t.styleData.emit(r))),t.sourceData.observers.length&&this.mapInstance.on("sourcedata",r=>this.zone.run(()=>t.sourceData.emit(r))),t.dataLoading.observers.length&&this.mapInstance.on("dataloading",r=>this.zone.run(()=>t.dataLoading.emit(r))),t.styleDataLoading.observers.length&&this.mapInstance.on("styledataloading",r=>this.zone.run(()=>t.styleDataLoading.emit(r))),t.sourceDataLoading.observers.length&&this.mapInstance.on("sourcedataloading",r=>this.zone.run(()=>t.sourceDataLoading.emit(r))),t.styleImageMissing.observers.length&&this.mapInstance.on("styleimagemissing",r=>this.zone.run(()=>t.styleImageMissing.emit(r))),t.idle.observers.length&&this.mapInstance.on("idle",r=>this.zone.run(()=>t.idle.emit(r)))}assign(t,r,s){if("string"==typeof r&&(r=r.split(".")),r.length>1){const c=r.shift();this.assign(t[c]="[object Object]"===Object.prototype.toString.call(t[c])?t[c]:{},r,s)}else t[r[0]]=s}}return n.\u0275fac=function(t){return new(t||n)(yt(Ei),yt(lT,8))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();function cT(n,e,t){console.warn(`[ngx-mapbox-gl]: ${n}: ${e} is deprecated, please use ${t} instead.`)}let p8=(()=>{class n{constructor(t,r){this.MapService=t,this.zone=r,this.updateFeatureData=new co,this.sub=new Ct,this.sourceAdded=!1,this.featureIdCounter=0}ngOnInit(){this.data||(this.data={type:"FeatureCollection",features:[]});const t=this.MapService.mapLoaded$.subscribe(()=>{this.init();const r=Bb(this.MapService.mapInstance,"styledata").pipe(sh(()=>!this.MapService.mapInstance.getSource(this.id))).subscribe(()=>{this.init()});this.sub.add(r)});this.sub.add(t)}ngOnChanges(t){if(this.sourceAdded&&((t.maxzoom&&!t.maxzoom.isFirstChange()||t.attribution&&!t.attribution.isFirstChange()||t.buffer&&!t.buffer.isFirstChange()||t.tolerance&&!t.tolerance.isFirstChange()||t.cluster&&!t.cluster.isFirstChange()||t.clusterRadius&&!t.clusterRadius.isFirstChange()||t.clusterMaxZoom&&!t.clusterMaxZoom.isFirstChange()||t.clusterMinPoints&&!t.clusterMinPoints.isFirstChange()||t.clusterProperties&&!t.clusterProperties.isFirstChange()||t.lineMetrics&&!t.lineMetrics.isFirstChange()||t.generateId&&!t.generateId.isFirstChange()||t.promoteId&&!t.promoteId.isFirstChange()||t.filter&&!t.filter.isFirstChange())&&(this.ngOnDestroy(),this.ngOnInit()),t.data&&!t.data.isFirstChange())){const r=this.MapService.getSource(this.id);if(void 0===r)return;r.setData(this.data)}}ngOnDestroy(){this.sub.unsubscribe(),this.sourceAdded&&(this.MapService.removeSource(this.id),this.sourceAdded=!1)}getClusterExpansionZoom(t){return nd(this,void 0,void 0,function*(){const r=this.MapService.getSource(this.id);return this.zone.run(()=>nd(this,void 0,void 0,function*(){return new Promise((s,c)=>{r.getClusterExpansionZoom(t,(m,w)=>{m?c(m):s(w)})})}))})}getClusterChildren(t){return nd(this,void 0,void 0,function*(){const r=this.MapService.getSource(this.id);return this.zone.run(()=>nd(this,void 0,void 0,function*(){return new Promise((s,c)=>{r.getClusterChildren(t,(m,w)=>{m?c(m):s(w)})})}))})}getClusterLeaves(t,r,s){return nd(this,void 0,void 0,function*(){const c=this.MapService.getSource(this.id);return this.zone.run(()=>nd(this,void 0,void 0,function*(){return new Promise((m,w)=>{c.getClusterLeaves(t,r,s,(I,L)=>{I?w(I):m(L)})})}))})}_addFeature(t){this.data.features.push(t),this.updateFeatureData.next()}_removeFeature(t){const r=this.data,s=r.features.indexOf(t);s>-1&&r.features.splice(s,1),this.updateFeatureData.next()}_getNewFeatureId(){return++this.featureIdCounter}init(){this.MapService.addSource(this.id,{type:"geojson",data:this.data,maxzoom:this.maxzoom,attribution:this.attribution,buffer:this.buffer,tolerance:this.tolerance,cluster:this.cluster,clusterRadius:this.clusterRadius,clusterMaxZoom:this.clusterMaxZoom,clusterMinPoints:this.clusterMinPoints,clusterProperties:this.clusterProperties,lineMetrics:this.lineMetrics,generateId:this.generateId,promoteId:this.promoteId,filter:this.filter});const r=this.updateFeatureData.pipe(function(n,e=n8){return t=>t.lift(new i8(n,e))}(0)).subscribe(()=>{const s=this.MapService.getSource(this.id);void 0!==s&&s.setData(this.data)});this.sub.add(r),this.sourceAdded=!0}}return n.\u0275fac=function(t){return new(t||n)(At(jy),At(Ei))},n.\u0275cmp=Ha({type:n,selectors:[["mgl-geojson-source"]],inputs:{id:"id",data:"data",maxzoom:"maxzoom",attribution:"attribution",buffer:"buffer",tolerance:"tolerance",cluster:"cluster",clusterRadius:"clusterRadius",clusterMaxZoom:"clusterMaxZoom",clusterMinPoints:"clusterMinPoints",clusterProperties:"clusterProperties",lineMetrics:"lineMetrics",generateId:"generateId",promoteId:"promoteId",filter:"filter"},features:[Zr],decls:0,vars:0,template:function(t,r){},encapsulation:2,changeDetection:0}),n})(),m8=(()=>{class n{constructor(t){this.MapService=t,this.layerClick=new lt,this.layerDblClick=new lt,this.layerMouseDown=new lt,this.layerMouseUp=new lt,this.layerMouseEnter=new lt,this.layerMouseLeave=new lt,this.layerMouseMove=new lt,this.layerMouseOver=new lt,this.layerMouseOut=new lt,this.layerContextMenu=new lt,this.layerTouchStart=new lt,this.layerTouchEnd=new lt,this.layerTouchCancel=new lt,this.click=new lt,this.dblClick=new lt,this.mouseDown=new lt,this.mouseUp=new lt,this.mouseEnter=new lt,this.mouseLeave=new lt,this.mouseMove=new lt,this.mouseOver=new lt,this.mouseOut=new lt,this.contextMenu=new lt,this.touchStart=new lt,this.touchEnd=new lt,this.touchCancel=new lt,this.layerAdded=!1}ngOnInit(){this.warnDeprecatedOutputs(),this.sub=this.MapService.mapLoaded$.pipe(oh(()=>Bb(this.MapService.mapInstance,"styledata").pipe(e=>e.lift(new l8(!1)),sh(()=>!this.MapService.mapInstance.getLayer(this.id)),XS(!0)))).subscribe(t=>this.init(t))}ngOnChanges(t){!this.layerAdded||(t.paint&&!t.paint.isFirstChange()&&this.MapService.setAllLayerPaintProperty(this.id,t.paint.currentValue),t.layout&&!t.layout.isFirstChange()&&this.MapService.setAllLayerLayoutProperty(this.id,t.layout.currentValue),t.filter&&!t.filter.isFirstChange()&&this.MapService.setLayerFilter(this.id,t.filter.currentValue),t.before&&!t.before.isFirstChange()&&this.MapService.setLayerBefore(this.id,t.before.currentValue),(t.minzoom&&!t.minzoom.isFirstChange()||t.maxzoom&&!t.maxzoom.isFirstChange())&&this.MapService.setLayerZoomRange(this.id,this.minzoom,this.maxzoom))}ngOnDestroy(){this.layerAdded&&this.MapService.removeLayer(this.id),this.sub&&this.sub.unsubscribe()}init(t){this.MapService.addLayer({layerOptions:{id:this.id,type:this.type,source:this.source,metadata:this.metadata,"source-layer":this.sourceLayer,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this.layout,paint:this.paint},layerEvents:{layerClick:this.layerClick,layerDblClick:this.layerDblClick,layerMouseDown:this.layerMouseDown,layerMouseUp:this.layerMouseUp,layerMouseEnter:this.layerMouseEnter,layerMouseLeave:this.layerMouseLeave,layerMouseMove:this.layerMouseMove,layerMouseOver:this.layerMouseOver,layerMouseOut:this.layerMouseOut,layerContextMenu:this.layerContextMenu,layerTouchStart:this.layerTouchStart,layerTouchEnd:this.layerTouchEnd,layerTouchCancel:this.layerTouchCancel,click:this.click,dblClick:this.dblClick,mouseDown:this.mouseDown,mouseUp:this.mouseUp,mouseEnter:this.mouseEnter,mouseLeave:this.mouseLeave,mouseMove:this.mouseMove,mouseOver:this.mouseOver,mouseOut:this.mouseOut,contextMenu:this.contextMenu,touchStart:this.touchStart,touchEnd:this.touchEnd,touchCancel:this.touchCancel}},t,this.before),this.layerAdded=!0}warnDeprecatedOutputs(){const t=cT.bind(void 0,n.name);this.click.observers.length&&t("click","layerClick"),this.dblClick.observers.length&&t("dblClick","layerDblClick"),this.mouseDown.observers.length&&t("mouseDown","layerMouseDown"),this.mouseUp.observers.length&&t("mouseUp","layerMouseUp"),this.mouseEnter.observers.length&&t("mouseEnter","layerMouseEnter"),this.mouseLeave.observers.length&&t("mouseLeave","layerMouseLeave"),this.mouseMove.observers.length&&t("mouseMove","layerMouseMove"),this.mouseOver.observers.length&&t("mouseOver","layerMouseOver"),this.mouseOut.observers.length&&t("mouseOut","layerMouseOut"),this.contextMenu.observers.length&&t("contextMenu","layerContextMenu"),this.touchStart.observers.length&&t("touchStart","layerTouchStart"),this.touchEnd.observers.length&&t("touchEnd","layerTouchEnd"),this.touchCancel.observers.length&&t("touchCancel","layerTouchCancel")}}return n.\u0275fac=function(t){return new(t||n)(At(jy))},n.\u0275cmp=Ha({type:n,selectors:[["mgl-layer"]],inputs:{id:"id",source:"source",type:"type",metadata:"metadata",sourceLayer:"sourceLayer",filter:"filter",layout:"layout",paint:"paint",before:"before",minzoom:"minzoom",maxzoom:"maxzoom"},outputs:{layerClick:"layerClick",layerDblClick:"layerDblClick",layerMouseDown:"layerMouseDown",layerMouseUp:"layerMouseUp",layerMouseEnter:"layerMouseEnter",layerMouseLeave:"layerMouseLeave",layerMouseMove:"layerMouseMove",layerMouseOver:"layerMouseOver",layerMouseOut:"layerMouseOut",layerContextMenu:"layerContextMenu",layerTouchStart:"layerTouchStart",layerTouchEnd:"layerTouchEnd",layerTouchCancel:"layerTouchCancel",click:"click",dblClick:"dblClick",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseEnter:"mouseEnter",mouseLeave:"mouseLeave",mouseMove:"mouseMove",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchCancel:"touchCancel"},features:[Zr],decls:0,vars:0,template:function(t,r){},encapsulation:2}),n})(),uT=(()=>{class n{constructor(t){this.MapService=t,this.movingMethod="flyTo",this.mapResize=new lt,this.mapRemove=new lt,this.mapMouseDown=new lt,this.mapMouseUp=new lt,this.mapMouseMove=new lt,this.mapClick=new lt,this.mapDblClick=new lt,this.mapMouseOver=new lt,this.mapMouseOut=new lt,this.mapContextMenu=new lt,this.mapTouchStart=new lt,this.mapTouchEnd=new lt,this.mapTouchMove=new lt,this.mapTouchCancel=new lt,this.mapWheel=new lt,this.moveStart=new lt,this.move=new lt,this.moveEnd=new lt,this.mapDragStart=new lt,this.mapDrag=new lt,this.mapDragEnd=new lt,this.zoomStart=new lt,this.zoomEvt=new lt,this.zoomEnd=new lt,this.rotateStart=new lt,this.rotate=new lt,this.rotateEnd=new lt,this.pitchStart=new lt,this.pitchEvt=new lt,this.pitchEnd=new lt,this.boxZoomStart=new lt,this.boxZoomEnd=new lt,this.boxZoomCancel=new lt,this.webGlContextLost=new lt,this.webGlContextRestored=new lt,this.mapLoad=new lt,this.idle=new lt,this.render=new lt,this.mapError=new lt,this.data=new lt,this.styleData=new lt,this.sourceData=new lt,this.dataLoading=new lt,this.styleDataLoading=new lt,this.sourceDataLoading=new lt,this.styleImageMissing=new lt,this.resize=new lt,this.remove=new lt,this.mouseDown=new lt,this.mouseUp=new lt,this.mouseMove=new lt,this.click=new lt,this.dblClick=new lt,this.mouseOver=new lt,this.mouseOut=new lt,this.contextMenu=new lt,this.touchStart=new lt,this.touchEnd=new lt,this.touchMove=new lt,this.touchCancel=new lt,this.wheel=new lt,this.dragStart=new lt,this.drag=new lt,this.dragEnd=new lt,this.load=new lt,this.error=new lt}get mapInstance(){return this.MapService.mapInstance}ngAfterViewInit(){this.warnDeprecatedOutputs(),this.MapService.setup({accessToken:this.accessToken,customMapboxApiUrl:this.customMapboxApiUrl,mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale},mapEvents:this}),this.cursorStyle&&this.MapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.MapService.destroyMap()}ngOnChanges(t){return nd(this,void 0,void 0,function*(){yield this.MapService.mapCreated$.toPromise(),t.cursorStyle&&!t.cursorStyle.isFirstChange()&&this.MapService.changeCanvasCursor(t.cursorStyle.currentValue),t.minZoom&&!t.minZoom.isFirstChange()&&this.MapService.updateMinZoom(t.minZoom.currentValue),t.maxZoom&&!t.maxZoom.isFirstChange()&&this.MapService.updateMaxZoom(t.maxZoom.currentValue),t.minPitch&&!t.minPitch.isFirstChange()&&this.MapService.updateMinPitch(t.minPitch.currentValue),t.maxPitch&&!t.maxPitch.isFirstChange()&&this.MapService.updateMaxPitch(t.maxPitch.currentValue),t.renderWorldCopies&&!t.renderWorldCopies.isFirstChange()&&this.MapService.updateRenderWorldCopies(t.renderWorldCopies.currentValue),t.scrollZoom&&!t.scrollZoom.isFirstChange()&&this.MapService.updateScrollZoom(t.scrollZoom.currentValue),t.dragRotate&&!t.dragRotate.isFirstChange()&&this.MapService.updateDragRotate(t.dragRotate.currentValue),t.touchPitch&&!t.touchPitch.isFirstChange()&&this.MapService.updateTouchPitch(t.touchPitch.currentValue),t.touchZoomRotate&&!t.touchZoomRotate.isFirstChange()&&this.MapService.updateTouchZoomRotate(t.touchZoomRotate.currentValue),t.doubleClickZoom&&!t.doubleClickZoom.isFirstChange()&&this.MapService.updateDoubleClickZoom(t.doubleClickZoom.currentValue),t.keyboard&&!t.keyboard.isFirstChange()&&this.MapService.updateKeyboard(t.keyboard.currentValue),t.dragPan&&!t.dragPan.isFirstChange()&&this.MapService.updateDragPan(t.dragPan.currentValue),t.boxZoom&&!t.boxZoom.isFirstChange()&&this.MapService.updateBoxZoom(t.boxZoom.currentValue),t.style&&!t.style.isFirstChange()&&this.MapService.updateStyle(t.style.currentValue),t.maxBounds&&!t.maxBounds.isFirstChange()&&this.MapService.updateMaxBounds(t.maxBounds.currentValue),t.fitBounds&&t.fitBounds.currentValue&&!t.fitBounds.isFirstChange()&&this.MapService.fitBounds(t.fitBounds.currentValue,this.fitBoundsOptions),t.fitScreenCoordinates&&t.fitScreenCoordinates.currentValue&&((this.center||this.zoom||this.pitch||this.fitBounds)&&t.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),this.MapService.fitScreenCoordinates(t.fitScreenCoordinates.currentValue,this.bearing?this.bearing[0]:0,this.movingOptions)),!this.centerWithPanTo||!t.center||t.center.isFirstChange()||t.zoom||t.bearing||t.pitch?(t.center&&!t.center.isFirstChange()||t.zoom&&!t.zoom.isFirstChange()||t.bearing&&!t.bearing.isFirstChange()&&!t.fitScreenCoordinates||t.pitch&&!t.pitch.isFirstChange())&&this.MapService.move(this.movingMethod,this.movingOptions,t.zoom&&this.zoom?this.zoom[0]:void 0,t.center?this.center:void 0,t.bearing&&this.bearing?this.bearing[0]:void 0,t.pitch&&this.pitch?this.pitch[0]:void 0):this.MapService.panTo(this.center,this.panToOptions)})}warnDeprecatedOutputs(){const t=cT.bind(void 0,n.name);this.resize.observers.length&&t("resize","mapResize"),this.remove.observers.length&&t("remove","mapRemove"),this.mouseDown.observers.length&&t("mouseDown","mapMouseDown"),this.mouseUp.observers.length&&t("mouseUp","mapMouseUp"),this.mouseMove.observers.length&&t("mouseMove","mapMouseMove"),this.click.observers.length&&t("click","mapClick"),this.dblClick.observers.length&&t("dblClick","mapDblClick"),this.mouseOver.observers.length&&t("mouseOver","mapMouseOver"),this.mouseOut.observers.length&&t("mouseOut","mapMouseOut"),this.contextMenu.observers.length&&t("contextMenu","mapContextMenu"),this.touchStart.observers.length&&t("touchStart","mapTouchStart"),this.touchEnd.observers.length&&t("touchEnd","mapTouchEnd"),this.touchMove.observers.length&&t("touchMove","mapTouchMove"),this.touchCancel.observers.length&&t("touchCancel","mapTouchCancel"),this.wheel.observers.length&&t("wheel","mapWheel"),this.dragStart.observers.length&&t("dragStart","mapDragStart"),this.drag.observers.length&&t("drag","mapDrag"),this.dragEnd.observers.length&&t("dragEnd","mapDragEnd"),this.load.observers.length&&t("load","mapLoad"),this.error.observers.length&&t("error","mapError")}}return n.\u0275fac=function(t){return new(t||n)(At(jy))},n.\u0275cmp=Ha({type:n,selectors:[["mgl-map"]],viewQuery:function(t,r){if(1&t&&hx(u8,7),2&t){let s;Bg(s=Ng())&&(r.mapContainer=s.first)}},inputs:{accessToken:"accessToken",collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",movingMethod:"movingMethod",movingOptions:"movingOptions",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing",resize:"resize",remove:"remove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseMove:"mouseMove",click:"click",dblClick:"dblClick",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchMove:"touchMove",touchCancel:"touchCancel",wheel:"wheel",dragStart:"dragStart",drag:"drag",dragEnd:"dragEnd",load:"load",error:"error"},features:[ai([jy]),Zr],decls:2,vars:0,consts:[["container",""]],template:function(t,r){1&t&&fg(0,"div",null,0)},styles:["[_nghost-%COMP%] {\n        display: block;\n      }\n      div[_ngcontent-%COMP%] {\n        height: 100%;\n        width: 100%;\n      }"],changeDetection:0}),n})();const g8=new rn("MapboxApiKey");let _8=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:lT,useValue:t.accessToken},{provide:g8,useValue:t.geocoderAccessToken||t.accessToken}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({imports:[[TS]]}),n})();function hT(...n){if(1===n.length){const e=n[0];if(Vo(e))return $y(e,null);if(lo(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return $y(t.map(r=>e[r]),t)}}if("function"==typeof n[n.length-1]){const e=n.pop();return $y(n=1===n.length&&Vo(n[0])?n[0]:n,null).pipe(fn(t=>e(...t)))}return $y(n,null)}function $y(n,e){return new jn(t=>{const r=n.length;if(0===r)return void t.complete();const s=new Array(r);let c=0,m=0;for(let w=0;w<r;w++){const I=Pr(n[w]);let L=!1;t.add(I.subscribe({next:U=>{L||(L=!0,m++),s[w]=U},error:U=>t.error(U),complete:()=>{c++,(c===r||!L)&&(m===r&&t.next(e?e.reduce((U,W,K)=>(U[W]=s[K],U),{}):s),t.complete())}}))}})}class dT{}class AT{}class ch{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const s=t.slice(0,r),c=s.toLowerCase(),m=t.slice(r+1).trim();this.maybeSetNormalizedName(s,c),this.headers.has(c)?this.headers.get(c).push(m):this.headers.set(c,[m])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let r=e[t];const s=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(s,r),this.maybeSetNormalizedName(t,s))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof ch?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new ch;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof ch?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const s=("a"===e.op?this.headers.get(t):void 0)||[];s.push(...r),this.headers.set(t,s);break;case"d":const c=e.value;if(c){let m=this.headers.get(t);if(!m)return;m=m.filter(w=>-1===c.indexOf(w)),0===m.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,m)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class x8{encodeKey(e){return fT(e)}encodeValue(e){return fT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const w8=/%(\d[a-f0-9])/gi,C8={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function fT(n){return encodeURIComponent(n).replace(w8,(e,t)=>{var r;return null!==(r=C8[t])&&void 0!==r?r:e})}function pT(n){return`${n}`}class id{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new x8,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(s=>{const c=s.indexOf("="),[m,w]=-1==c?[e.decodeKey(s),""]:[e.decodeKey(s.slice(0,c)),e.decodeValue(s.slice(c+1))],I=t.get(m)||[];I.push(w),t.set(m,I)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t];this.map.set(t,Array.isArray(r)?r:[r])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(r=>{const s=e[r];Array.isArray(s)?s.forEach(c=>{t.push({param:r,value:c,op:"a"})}):t.push({param:r,value:s,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new id({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(pT(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const s=r.indexOf(pT(e.value));-1!==s&&r.splice(s,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class E8{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function mT(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function gT(n){return"undefined"!=typeof Blob&&n instanceof Blob}function _T(n){return"undefined"!=typeof FormData&&n instanceof FormData}class l0{constructor(e,t,r,s){let c;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==r?r:null,c=s):c=r,c&&(this.reportProgress=!!c.reportProgress,this.withCredentials=!!c.withCredentials,c.responseType&&(this.responseType=c.responseType),c.headers&&(this.headers=c.headers),c.context&&(this.context=c.context),c.params&&(this.params=c.params)),this.headers||(this.headers=new ch),this.context||(this.context=new E8),this.params){const m=this.params.toString();if(0===m.length)this.urlWithParams=t;else{const w=t.indexOf("?");this.urlWithParams=t+(-1===w?"?":w<t.length-1?"&":"")+m}}else this.params=new id,this.urlWithParams=t}serializeBody(){return null===this.body?null:mT(this.body)||gT(this.body)||_T(this.body)||function(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof id?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||_T(this.body)?null:gT(this.body)?this.body.type||null:mT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof id?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const r=e.method||this.method,s=e.url||this.url,c=e.responseType||this.responseType,m=void 0!==e.body?e.body:this.body,w=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,I=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let L=e.headers||this.headers,U=e.params||this.params;const W=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(L=Object.keys(e.setHeaders).reduce((K,ie)=>K.set(ie,e.setHeaders[ie]),L)),e.setParams&&(U=Object.keys(e.setParams).reduce((K,ie)=>K.set(ie,e.setParams[ie]),U)),new l0(r,s,m,{params:U,headers:L,context:W,reportProgress:I,responseType:c,withCredentials:w})}}var oo=(()=>((oo=oo||{})[oo.Sent=0]="Sent",oo[oo.UploadProgress=1]="UploadProgress",oo[oo.ResponseHeader=2]="ResponseHeader",oo[oo.DownloadProgress=3]="DownloadProgress",oo[oo.Response=4]="Response",oo[oo.User=5]="User",oo))();class Nb{constructor(e,t=200,r="OK"){this.headers=e.headers||new ch,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class zb extends Nb{constructor(e={}){super(e),this.type=oo.ResponseHeader}clone(e={}){return new zb({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Gy extends Nb{constructor(e={}){super(e),this.type=oo.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new Gy({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class yT extends Nb{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Vb(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let Hy=(()=>{class n{constructor(t){this.handler=t}request(t,r,s={}){let c;if(t instanceof l0)c=t;else{let I,L;I=s.headers instanceof ch?s.headers:new ch(s.headers),s.params&&(L=s.params instanceof id?s.params:new id({fromObject:s.params})),c=new l0(t,r,void 0!==s.body?s.body:null,{headers:I,context:s.context,params:L,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const m=Sn(c).pipe(Op(I=>this.handler.handle(I)));if(t instanceof l0||"events"===s.observe)return m;const w=m.pipe(sh(I=>I instanceof Gy));switch(s.observe||"body"){case"body":switch(c.responseType){case"arraybuffer":return w.pipe(fn(I=>{if(null!==I.body&&!(I.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return I.body}));case"blob":return w.pipe(fn(I=>{if(null!==I.body&&!(I.body instanceof Blob))throw new Error("Response is not a Blob.");return I.body}));case"text":return w.pipe(fn(I=>{if(null!==I.body&&"string"!=typeof I.body)throw new Error("Response is not a string.");return I.body}));case"json":default:return w.pipe(fn(I=>I.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new id).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,s={}){return this.request("PATCH",t,Vb(s,r))}post(t,r,s={}){return this.request("POST",t,Vb(s,r))}put(t,r,s={}){return this.request("PUT",t,Vb(s,r))}}return n.\u0275fac=function(t){return new(t||n)(yt(dT))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();class vT{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const xT=new rn("HTTP_INTERCEPTORS");let M8=(()=>{class n{intercept(t,r){return r.handle(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const T8=/^\)\]\}',?\n/;let bT=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new jn(r=>{const s=this.xhrFactory.build();if(s.open(t.method,t.urlWithParams),t.withCredentials&&(s.withCredentials=!0),t.headers.forEach((ie,fe)=>s.setRequestHeader(ie,fe.join(","))),t.headers.has("Accept")||s.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const ie=t.detectContentTypeHeader();null!==ie&&s.setRequestHeader("Content-Type",ie)}if(t.responseType){const ie=t.responseType.toLowerCase();s.responseType="json"!==ie?ie:"text"}const c=t.serializeBody();let m=null;const w=()=>{if(null!==m)return m;const ie=1223===s.status?204:s.status,fe=s.statusText||"OK",Ve=new ch(s.getAllResponseHeaders()),Re=function(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(s)||t.url;return m=new zb({headers:Ve,status:ie,statusText:fe,url:Re}),m},I=()=>{let{headers:ie,status:fe,statusText:Ve,url:Re}=w(),Je=null;204!==fe&&(Je=void 0===s.response?s.responseText:s.response),0===fe&&(fe=Je?200:0);let He=fe>=200&&fe<300;if("json"===t.responseType&&"string"==typeof Je){const Rt=Je;Je=Je.replace(T8,"");try{Je=""!==Je?JSON.parse(Je):null}catch(Gt){Je=Rt,He&&(He=!1,Je={error:Gt,text:Je})}}He?(r.next(new Gy({body:Je,headers:ie,status:fe,statusText:Ve,url:Re||void 0})),r.complete()):r.error(new yT({error:Je,headers:ie,status:fe,statusText:Ve,url:Re||void 0}))},L=ie=>{const{url:fe}=w(),Ve=new yT({error:ie,status:s.status||0,statusText:s.statusText||"Unknown Error",url:fe||void 0});r.error(Ve)};let U=!1;const W=ie=>{U||(r.next(w()),U=!0);let fe={type:oo.DownloadProgress,loaded:ie.loaded};ie.lengthComputable&&(fe.total=ie.total),"text"===t.responseType&&!!s.responseText&&(fe.partialText=s.responseText),r.next(fe)},K=ie=>{let fe={type:oo.UploadProgress,loaded:ie.loaded};ie.lengthComputable&&(fe.total=ie.total),r.next(fe)};return s.addEventListener("load",I),s.addEventListener("error",L),s.addEventListener("timeout",L),s.addEventListener("abort",L),t.reportProgress&&(s.addEventListener("progress",W),null!==c&&s.upload&&s.upload.addEventListener("progress",K)),s.send(c),r.next({type:oo.Sent}),()=>{s.removeEventListener("error",L),s.removeEventListener("abort",L),s.removeEventListener("load",I),s.removeEventListener("timeout",L),t.reportProgress&&(s.removeEventListener("progress",W),null!==c&&s.upload&&s.upload.removeEventListener("progress",K)),s.readyState!==s.DONE&&s.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(yt(RS))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})();const Ub=new rn("XSRF_COOKIE_NAME"),jb=new rn("XSRF_HEADER_NAME");class wT{}let k8=(()=>{class n{constructor(t,r,s){this.doc=t,this.platform=r,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=xS(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(yt(no),yt(W_),yt(Ub))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),$b=(()=>{class n{constructor(t,r){this.tokenService=t,this.headerName=r}intercept(t,r){const s=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||s.startsWith("http://")||s.startsWith("https://"))return r.handle(t);const c=this.tokenService.getToken();return null!==c&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,c)})),r.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(yt(wT),yt(jb))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),P8=(()=>{class n{constructor(t,r){this.backend=t,this.injector=r,this.chain=null}handle(t){if(null===this.chain){const r=this.injector.get(xT,[]);this.chain=r.reduceRight((s,c)=>new vT(s,c),this.backend)}return this.chain.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(yt(AT),yt(Sr))},n.\u0275prov=qt({token:n,factory:n.\u0275fac}),n})(),R8=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:$b,useClass:M8}]}}static withOptions(t={}){return{ngModule:n,providers:[t.cookieName?{provide:Ub,useValue:t.cookieName}:[],t.headerName?{provide:jb,useValue:t.headerName}:[]]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({providers:[$b,{provide:xT,useExisting:$b,multi:!0},{provide:wT,useClass:k8},{provide:Ub,useValue:"XSRF-TOKEN"},{provide:jb,useValue:"X-XSRF-TOKEN"}]}),n})(),F8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({providers:[Hy,{provide:dT,useClass:P8},bT,{provide:AT,useExisting:bT}],imports:[[R8.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})();const Gb=new rn("Google Sheets API key");let O8=(()=>{class n{constructor(t,r){this.http=t,this.apiKey=r,this.defaultActiveValues=["true","1","yes"]}get(t,r,s){return this.getRows(t,r).pipe(fn(c=>this.rowsToEntries(c).map(m=>this.getObjectFromEntry(m,s))))}getActive(t,r,s,c="is_active",m=null){return null===m?m=this.defaultActiveValues:Array.isArray(m)||(m=[m]),this.getRows(t,r).pipe(fn(w=>this.rowsToEntries(w).filter(I=>m.includes(I[c].toLowerCase())).map(I=>this.getObjectFromEntry(I,s))))}getSpreadsheetUrl(t,r){return"https://sheets.googleapis.com/v4/spreadsheets/"+t+"/values/"+encodeURI(r)+"?key="+this.apiKey}getRows(t,r){const s=this.getSpreadsheetUrl(t,r);return this.http.get(s).pipe(fn(c=>c.values),Jh(this.handleError))}rowsToEntries(t){const r=t[0].map(this.cleanColumnName);return t.slice(1).map(s=>r.reduce((c,m,w)=>(c[m]=s.length>w?s[w]:"",c),{}))}cleanColumnName(t){return t.trim()}arrayToObject(t){return t.reduce((r,s)=>(r[s]=s,r),{})}getObjectFromEntry(t,r){return Array.isArray(r)&&(r=this.arrayToObject(r)),this.getObjectFromEntryObject(t,r)}getObjectFromEntryObject(t,r,s=""){const c={};for(const m in Object(r))if(r.hasOwnProperty(m)&&!["_prefix","_listField"].includes(m))if("string"==typeof r[m])c[m]=this.getValueFromEntry(t,s+r[m]);else if("object"==typeof r[m]){let w="";r[m].hasOwnProperty("_prefix")&&(w=r[m]._prefix),c[m]=r[m]._listField?this.getListFromEntry(t,s+w):this.getObjectFromEntryObject(t,r[m],s+w)}else console.log(`Unknown type for ${m}`);return c}getValueFromEntry(t,r){return r=this.cleanColumnName(r),t.hasOwnProperty(r)?t[r]:null}getListFromEntry(t,r){const s=[];let c=1,m=this.getValueFromEntry(t,`${r}${c}`);for(;m;)s.push(m),c++,m=this.getValueFromEntry(t,`${r}${c}`);return s}handleError(t){return t.error instanceof ErrorEvent?console.error("An error occurred:",t.error.message):console.error(`Backend returned code ${t.status}, body was: ${t.error}`),function(n,e){return new jn(t=>t.error(n))}("Something bad happened; please try again later.")}}return n.\u0275fac=function(t){return new(t||n)(yt(Hy),yt(Gb))},n.\u0275prov=qt({factory:function(){return new n(yt(Hy),yt(Gb))},token:n,providedIn:"root"}),n})();const L8={id:"id",name:"name",lon:"lon",lat:"lat"},B8={id:"id",name:"name"},N8={id:"id",name:"name"};let Hb=(()=>{class n{constructor(t){this.googleSheetsDbService=t}getCities(){return this.googleSheetsDbService.get("15HnwixyXuMjkYlryytSMKOqqDjzFwsaN1vuPpMDFc6Y","Cities",L8).pipe(ss(t=>t.forEach(r=>{r.id=Number(r.id),r.lat=Number(r.lat),r.lon=Number(r.lon)})))}getClassifiers(){return this.googleSheetsDbService.get("15HnwixyXuMjkYlryytSMKOqqDjzFwsaN1vuPpMDFc6Y","Classifiers",B8).pipe(ss(t=>t.forEach(r=>{r.id=Number(r.id)})))}getCsvFiles(){return this.googleSheetsDbService.get("10MV6ScSQZe1KbpVYCcSi_ZW79bwmfyS_q1voeoyDNOQ","Files",N8)}}return n.\u0275fac=function(t){return new(t||n)(yt(O8))},n.\u0275prov=qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),CT=(()=>{class n{constructor(t,r){this.googleSheetsDownloaderService=t,this.httpClient=r,this.files=[],this.cache=new Map}_getFileId(t){var r=this.files.find(s=>s.name===t);if(!r)throw Error(`No result ${t}`);return r.id}getFileId(t){return 0==this.files.length?this.googleSheetsDownloaderService.getCsvFiles().pipe(ss(r=>this.files=r),fn(()=>this._getFileId(t))):Sn(1).pipe(fn(()=>this._getFileId(t)))}parseCsv(t){const s=[];return t.split("\n").forEach(m=>{const w=m.split(",");s.push(w)}),s}getHexData(t,r){var s=`${t}_${r}`;return this.cache.has(s)?Sn(this.cache.get(s)):this.getFileId(s).pipe(mr(m=>this.httpClient.get("https://www.googleapis.com/drive/v3/files/"+m+"?alt=media&key=AIzaSyDVc71t2FNSlJ5sko_IZBGZVre45bYA94U",{responseType:"text"})),fn(m=>{var w=this.parseCsv(m);w.shift();var I=w.map(L=>({hex:L[0],value:Number(L[1])}));return this.cache.set(s,I),I}))}}return n.\u0275fac=function(t){return new(t||n)(yt(Hb),yt(Hy))},n.\u0275prov=qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var mt=function(n){var r,e=void 0!==(n=n||{})?n:{},t={};for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);var w,s=[],c="";document.currentScript&&(c=document.currentScript.src),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"",w=function(st,It,en){var p=new XMLHttpRequest;p.open("GET",st,!0),p.responseType="arraybuffer",p.onload=function(){if(200==p.status||0==p.status&&p.response)It(p.response);else{var br=Cw(st);br?It(br.buffer):en()}},p.onerror=en,p.send(null)};var I=e.print||console.log.bind(console),L=e.printErr||console.warn.bind(console);for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);t=null,e.arguments&&(s=e.arguments);var U=0,K=function(){return U},Re=!1;function He(je){var st=e["_"+je];return function(je,st){je||WA("Assertion failed: "+st)}(st,"Cannot call unknown function "+je+", make sure it is exported"),st}function Rt(je,st,It,en,p){var Ur={string:function(Zn){var or=0;if(null!=Zn&&0!==Zn){var Ad=1+(Zn.length<<2);!function(je,st,It){!function(je,st,It,en){if(!(en>0))return 0;for(var Ur=It+en-1,br=0;br<je.length;++br){var pe=je.charCodeAt(br);if(pe>=55296&&pe<=57343&&(pe=65536+((1023&pe)<<10)|1023&je.charCodeAt(++br)),pe<=127){if(It>=Ur)break;st[It++]=pe}else if(pe<=2047){if(It+1>=Ur)break;st[It++]=192|pe>>6,st[It++]=128|63&pe}else if(pe<=65535){if(It+2>=Ur)break;st[It++]=224|pe>>12,st[It++]=128|pe>>6&63,st[It++]=128|63&pe}else{if(It+3>=Ur)break;st[It++]=240|pe>>18,st[It++]=128|pe>>12&63,st[It++]=128|pe>>6&63,st[It++]=128|63&pe}}st[It]=0}(je,tu,st,It)}(Zn,or=QI(Ad),Ad)}return or},array:function(Zn){var or=QI(Zn.length);return function(je,st){ul.set(je,st)}(Zn,or),or}},pe=He(je),cs=[],aa=0;if(en)for(var tr=0;tr<en.length;tr++){var Si=Ur[It[tr]];Si?(0===aa&&(aa=OU()),cs[tr]=Si(en[tr])):cs[tr]=en[tr]}var Zn,hh=pe.apply(null,cs);return Zn=hh,hh="string"===st?zo(Zn):"boolean"===st?Boolean(Zn):Zn,0!==aa&&FU(aa),hh}var eu,ul,tu,qA,dd,yw,vw,kn="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function zo(je,st){return je?function(je,st,It){for(var en=st+It,p=st;je[p]&&!(p>=en);)++p;if(p-st>16&&je.subarray&&kn)return kn.decode(je.subarray(st,p));for(var Ur="";st<p;){var br=je[st++];if(128&br){var pe=63&je[st++];if(192!=(224&br)){var cs=63&je[st++];if((br=224==(240&br)?(15&br)<<12|pe<<6|cs:(7&br)<<18|pe<<12|cs<<6|63&je[st++])<65536)Ur+=String.fromCharCode(br);else{var aa=br-65536;Ur+=String.fromCharCode(55296|aa>>10,56320|1023&aa)}}else Ur+=String.fromCharCode((31&br)<<6|pe)}else Ur+=String.fromCharCode(br)}return Ur}(tu,je,st):""}function Hp(je,st){return je%st>0&&(je+=st-je%st),je}function NI(je){eu=je,e.HEAP8=ul=new Int8Array(je),e.HEAP16=qA=new Int16Array(je),e.HEAP32=dd=new Int32Array(je),e.HEAPU8=tu=new Uint8Array(je),e.HEAPU16=new Uint16Array(je),e.HEAPU32=new Uint32Array(je),e.HEAPF32=yw=new Float32Array(je),e.HEAPF64=vw=new Float64Array(je)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var VI=e.TOTAL_MEMORY||33554432;function iv(je){for(;je.length>0;){var st=je.shift();if("function"!=typeof st){var It=st.func;"number"==typeof It?void 0===st.arg?e.dynCall_v(It):e.dynCall_vi(It,st.arg):It(void 0===st.arg?null:st.arg)}else st()}}VI=(eu=e.buffer?e.buffer:new ArrayBuffer(VI)).byteLength,NI(eu),dd[6004]=5266928;var UI=[],lU=[],cU=[],jI=[],mU=Math.abs,gU=Math.ceil,_U=Math.floor,yU=Math.min,ZA=0,xw=null,p0=null;e.preloadedImages={},e.preloadedAudios={};var qp,ww,uh=null,bw="data:application/octet-stream;base64,";function $I(je){return String.prototype.startsWith?je.startsWith(bw):0===je.indexOf(bw)}function HI(je){return je.replace(/\b__Z[\w\d_]+/g,function(It){return It==It?It:It+" ["+It+"]"})}function qI(){var je=new Error;if(!je.stack){try{throw new Error(0)}catch(st){je=st}if(!je.stack)return"(no stack trace available)"}return je.stack.toString()}function ZI(){return ul.length}function WI(je){try{var st=new ArrayBuffer(je);return st.byteLength!=je?void 0:(new Int8Array(st).set(ul),RU(st),NI(st),1)}catch(It){}}uh="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var TU="function"==typeof atob?atob:function(je){var p,Ur,br,pe,cs,aa,st="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",It="",tr=0;je=je.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{br=st.indexOf(je.charAt(tr++)),p=(15&(pe=st.indexOf(je.charAt(tr++))))<<4|(cs=st.indexOf(je.charAt(tr++)))>>2,Ur=(3&cs)<<6|(aa=st.indexOf(je.charAt(tr++))),It+=String.fromCharCode(br<<2|pe>>4),64!==cs&&(It+=String.fromCharCode(p)),64!==aa&&(It+=String.fromCharCode(Ur))}while(tr<je.length);return It};function Cw(je){if($I(je))return function(je){try{for(var st=TU(je),It=new Uint8Array(st.length),en=0;en<st.length;++en)It[en]=st.charCodeAt(en);return It}catch(p){throw new Error("Converting base64 string to bytes failed.")}}(je.slice(bw.length))}var je,ov,Tt=function(je,st,It){var en=new je.Int8Array(It),p=new je.Int32Array(It),pe=(new je.Uint8Array(It),new je.Float32Array(It),new je.Float64Array(It)),cs=0|st.p,aa=je.Math.floor,tr=je.Math.abs,Si=je.Math.sqrt,hh=je.Math.pow,Zn=je.Math.cos,or=je.Math.sin,Ad=je.Math.tan,LU=je.Math.acos,BU=je.Math.asin,Sw=je.Math.atan,hl=je.Math.atan2,sv=je.Math.ceil,dh=je.Math.imul,NU=je.Math.min,QA=je.Math.clz32,Mn=st.b,De=st.c,Tr=st.d,JI=st.e,zU=st.f,VU=st.g,UU=st.h,jU=st.i,me=24048;function ek(d,A,y,C){var S=0,k=0;!(0|Mw(d|=0,A|=0,y|=0,C|=0,0))||(tc(0|C,0,(k=1+(0|dh(3*y|0,y+1|0))|0)<<3|0),(S=0|ec(k,4))&&(nu(d,A,y,C,S,k,0),On(S)))}function Mw(d,A,y,C,S){A|=0,y|=0,S|=0;var ze,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0;if(ze=me,me=me+16|0,Te=ze,p[(k=C|=0)>>2]=d|=0,p[k+4>>2]=A,(k=0!=(0|S))&&(p[S>>2]=0),0|_o(d,A))return me=ze,1;p[Te>>2]=0;e:do{if((0|y)>=1)if(k)for(X=0,ee=1,ye=1,T=0,k=d;;){if(!(T|X)){if(0==(0|(k=0|so(k,A,4,Te)))&0==(0|(A=0|De()))){k=2;break e}if(0|_o(k,A)){k=1;break e}}if(0==(0|(k=0|so(k,A,0|p[16+(X<<2)>>2],Te)))&0==(0|(A=0|De()))){k=2;break e}if(p[(d=C+(ye<<3)|0)>>2]=k,p[d+4>>2]=A,p[S+(ye<<2)>>2]=ee,d=(0|(T=T+1|0))==(0|ee),$=6==(0|(O=X+1|0)),0|_o(k,A)){k=1;break e}if((0|(ee=ee+($&d&1)|0))>(0|y)){k=0;break}X=d?$?0:O:X,ye=ye+1|0,T=d?0:T}else for(X=0,ee=1,ye=1,T=0,k=d;;){if(!(T|X)){if(0==(0|(k=0|so(k,A,4,Te)))&0==(0|(A=0|De()))){k=2;break e}if(0|_o(k,A)){k=1;break e}}if(0==(0|(k=0|so(k,A,0|p[16+(X<<2)>>2],Te)))&0==(0|(A=0|De()))){k=2;break e}if(p[(d=C+(ye<<3)|0)>>2]=k,p[d+4>>2]=A,d=(0|(T=T+1|0))==(0|ee),$=6==(0|(O=X+1|0)),0|_o(k,A)){k=1;break e}if((0|(ee=ee+($&d&1)|0))>(0|y)){k=0;break}X=d?$?0:O:X,ye=ye+1|0,T=d?0:T}else k=0}while(0);return me=ze,0|k}function nu(d,A,y,C,S,k,T){y|=0,C|=0,S|=0,k|=0,T|=0;var ee,ye,O=0,$=0,X=0,Te=0,ze=0;if(ye=me,me=me+16|0,ee=ye,0==(0|(d|=0))&0==(0|(A|=0)))me=ye;else{if(O=0|md(0|d,0|A,0|k,((0|k)<0)<<31>>31|0),De(),!(0==(0|(ze=0|p[(Te=$=C+(O<<3)|0)>>2]))&0==(0|(Te=0|p[Te+4>>2]))|(X=(0|ze)==(0|d)&(0|Te)==(0|A))))do{X=(0|(Te=0|p[(ze=$=C+((O=(O+1|0)%(0|k)|0)<<3)|0)>>2]))==(0|d)&(0|(ze=0|p[ze+4>>2]))==(0|A)}while(!(0==(0|Te)&0==(0|ze)|X));O=S+(O<<2)|0,X&&(0|p[O>>2])<=(0|T)||(p[(ze=$)>>2]=d,p[ze+4>>2]=A,p[O>>2]=T,(0|T)>=(0|y)||(ze=T+1|0,p[ee>>2]=0,nu(Te=0|so(d,A,2,ee),0|De(),y,C,S,k,ze),p[ee>>2]=0,nu(Te=0|so(d,A,3,ee),0|De(),y,C,S,k,ze),p[ee>>2]=0,nu(Te=0|so(d,A,1,ee),0|De(),y,C,S,k,ze),p[ee>>2]=0,nu(Te=0|so(d,A,5,ee),0|De(),y,C,S,k,ze),p[ee>>2]=0,nu(Te=0|so(d,A,4,ee),0|De(),y,C,S,k,ze),p[ee>>2]=0,nu(Te=0|so(d,A,6,ee),0|De(),y,C,S,k,ze))),me=ye}}function so(d,A,y,C){d|=0,A|=0,y|=0;var O,$,S=0,k=0,T=0,ee=0,ye=0,Te=0,ze=0;if((0|p[(C|=0)>>2])>0){S=0;do{y=0|KA(y),S=S+1|0}while((0|S)<(0|p[C>>2]))}O=0|bt(0|d,0|A,45),De(),$=127&O,k=0|ca(d,A),S=0|bt(0|d,0|A,52),De(),S&=15;e:do{if(S)for(;;){if(Te=0|bt(0|d,0|A,0|(ye=3*(15-S|0)|0)),De(),Te&=7,ze=0==(0|dl(S)),S=S+-1|0,ee=0|Ot(7,0,0|ye),A&=~(0|De()),d=(ye=0|Ot(0|p[(ze?464:48)+(28*Te|0)+(y<<2)>>2],0,0|ye))|d&~ee,A|=0|De(),!(y=0|p[(ze?672:256)+(28*Te|0)+(y<<2)>>2])){y=0;break e}if(!S){T=6;break}}else T=6}while(0);6==(0|T)&&(d|=Te=0|Ot(0|(ze=0|p[880+(28*$|0)+(y<<2)>>2]),0,45),A=0|De()|-1040385&A,y=0|p[4304+(28*$|0)+(y<<2)>>2],127==(127&ze|0)&&(ze=0|Ot(0|p[880+(28*$|0)+20>>2],0,45),A=0|De()|-1040385&A,y=0|p[4304+(28*$|0)+20>>2],d=0|pd(ze|d,A),A=0|De(),p[C>>2]=1+(0|p[C>>2]))),T=0|bt(0|d,0|A,45),De(),T&=127;e:do{if(0|fi(T)){t:do{if(1==(0|ca(d,A))){if((0|$)!=(0|T)){if(0|rk(T,0|p[7728+(28*$|0)>>2])){d=0|Nw(d,A),k=1,A=0|De();break}d=0|pd(d,A),k=1,A=0|De();break}switch(0|k){case 5:d=0|Nw(d,A),A=0|De(),p[C>>2]=5+(0|p[C>>2]),k=0;break t;case 3:d=0|pd(d,A),A=0|De(),p[C>>2]=1+(0|p[C>>2]),k=0;break t;default:return ze=0,Mn(0|(Te=0)),0|ze}}else k=0}while(0);if((0|y)>0){S=0;do{d=0|Bw(d,A),A=0|De(),S=S+1|0}while((0|S)!=(0|y))}if((0|$)!=(0|T)){if(!(0|Tw(T))){if(0!=(0|k)|5!=(0|ca(d,A)))break;p[C>>2]=1+(0|p[C>>2]);break}switch(127&O){case 8:case 118:break e}3!=(0|ca(d,A))&&(p[C>>2]=1+(0|p[C>>2]))}}else if((0|y)>0){S=0;do{d=0|pd(d,A),A=0|De(),S=S+1|0}while((0|S)!=(0|y))}}while(0);return p[C>>2]=((0|p[C>>2])+y|0)%6|0,ze=d,Mn(0|(Te=A)),0|ze}function tk(d,A,y,C,S,k){y|=0,C|=0,S|=0,k|=0;var Lt,qe,gt,Ie,Nt,zt,kt,Ft,Ir,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,In=0,vr=0,jr=0;if(Ir=me,me=me+48|0,(0|(T=0|p[(d|=0)>>2]))<=0)return me=Ir,0;Lt=d+4|0,qe=8+(zt=Ir+32|0)|0,gt=8+(kt=Ir+16|0)|0,Ie=(Ft=Ir)+8|0,Nt=((0|(A|=0))<0)<<31>>31,wt=0;e:for(;;){p[zt>>2]=p[(Qe=(O=0|p[Lt>>2])+(wt<<4)|0)>>2],p[zt+4>>2]=p[Qe+4>>2],p[zt+8>>2]=p[Qe+8>>2],p[zt+12>>2]=p[Qe+12>>2],(0|wt)==(T+-1|0)?(p[kt>>2]=p[O>>2],p[kt+4>>2]=p[O+4>>2],p[kt+8>>2]=p[O+8>>2],p[kt+12>>2]=p[O+12>>2]):(p[kt>>2]=p[(Qe=O+(wt+1<<4)|0)>>2],p[kt+4>>2]=p[Qe+4>>2],p[kt+8>>2]=p[Qe+8>>2],p[kt+12>>2]=p[Qe+12>>2]),Qe=0|aj(zt,kt,y);t:do{if((0|Qe)>0){Ke=+(0|Qe),ze=0;n:for(;;){pe[Ft>>3]=+pe[zt>>3]*(jr=+(Qe-ze|0))/Ke+ +pe[kt>>3]*(vr=+(0|ze))/Ke,pe[Ie>>3]=+pe[qe>>3]*jr/Ke+ +pe[gt>>3]*vr/Ke,O=0|md(0|(ye=0|yk(Ft,y)),0|(Te=0|De()),0|A,0|Nt),De(),X=0|p[($=T=k+(O<<3)|0)>>2],$=0|p[$+4>>2];r:do{if(0==(0|X)&0==(0|$))In=14;else for(ee=0;;){if((0|ee)>(0|A)){T=1;break r}if((0|X)==(0|ye)&(0|$)==(0|Te)){T=7;break r}if(0==(0|(X=0|p[($=T=k+((O=(O+1|0)%(0|A)|0)<<3)|0)>>2]))&0==(0|($=0|p[$+4>>2]))){In=14;break}ee=ee+1|0}}while(0);switch(14==(0|In)&&(In=0,0==(0|ye)&0==(0|Te)?T=7:(p[T>>2]=ye,p[T+4>>2]=Te,p[(ee=S+((T=0|p[C>>2])<<3)|0)>>2]=ye,p[ee+4>>2]=Te,p[C>>2]=T+1,T=0)),7&T){case 7:case 0:break;default:break n}if((0|Qe)<=(0|(ze=ze+1|0))){In=8;break t}}if(0|T){T=-1,In=20;break e}}else In=8}while(0);if(8==(0|In)&&(In=0),(0|(wt=wt+1|0))>=(0|(T=0|p[d>>2]))){T=0,In=20;break}}return 20==(0|In)?(me=Ir,0|T):0}function fi(d){return 0|p[7728+(28*(d|=0)|0)+16>>2]}function Tw(d){return 4==(0|(d|=0))|117==(0|d)|0}function nk(d){return 0|p[11152+(216*(0|p[(d|=0)>>2])|0)+(72*(0|p[d+4>>2])|0)+(24*(0|p[d+8>>2])|0)+(p[d+12>>2]<<3)>>2]}function nj(d){return 0|p[11152+(216*(0|p[(d|=0)>>2])|0)+(72*(0|p[d+4>>2])|0)+(24*(0|p[d+8>>2])|0)+(p[d+12>>2]<<3)+4>>2]}function rk(d,A){return(0|p[7728+(28*(d|=0)|0)+20>>2])==(0|(A|=0))?0|(A=1):0|(A=(0|p[7728+(28*d|0)+24>>2])==(0|A))}function Iw(d,A){return 0|p[880+(28*(d|=0)|0)+((A|=0)<<2)>>2]}function kw(d,A){return(0|p[880+(28*(d|=0)|0)>>2])==(0|(A|=0))?0|(A=0):(0|p[880+(28*d|0)+4>>2])==(0|A)?0|(A=1):(0|p[880+(28*d|0)+8>>2])==(0|A)?0|(A=2):(0|p[880+(28*d|0)+12>>2])==(0|A)?0|(A=3):(0|p[880+(28*d|0)+16>>2])==(0|A)?0|(A=4):(0|p[880+(28*d|0)+20>>2])==(0|A)?0|(A=5):0|((0|p[880+(28*d|0)+24>>2])==(0|A)?6:7)}function ik(d){return+pe[16+(d|=0)>>3]<+pe[d+24>>3]|0}function ok(d,A){var y=0,C=0,S=0;return(y=+pe[(A|=0)>>3])>=+pe[8+(d|=0)>>3]&&y<=+pe[d>>3]?(A=(S=+pe[A+8>>3])>=(y=+pe[d+24>>3]),d=S<=(C=+pe[d+16>>3])&1,C<y?A&&(d=1):A||(d=0),0|(A=0!=(0|d))):0|(A=0)}function Pw(d,A){d|=0,A|=0;var y,C,S,T,$,X,k=0,O=0;T=me,me=me+288|0,y=T+264|0,C=T+96|0,O=(k=S=T)+96|0;do{p[k>>2]=0,k=k+4|0}while((0|k)<(0|O));return Vw(A,S),JA(O=0|p[(k=S)>>2],k=0|p[k+4>>2],y),ef(O,k,C),$=+_0(y,C+8|0),pe[y>>3]=+pe[d>>3],pe[(k=y+8|0)>>3]=+pe[d+16>>3],pe[C>>3]=+pe[d+8>>3],pe[(O=C+8|0)>>3]=+pe[d+24>>3],X=+_0(y,C),O=~~+sv(+X*X/+Rk(+ +tr(+(+pe[k>>3]-+pe[O>>3])/(+pe[y>>3]-+pe[C>>3])),3)/($*(2.59807621135*$)*.8)),me=T,0|(0==(0|O)?1:O)}function aj(d,A,y){d|=0,A|=0,y|=0;var C,S,k,O,X,T=0,$=0;O=me,me=me+288|0,C=O+264|0,S=O+96|0,$=(T=k=O)+96|0;do{p[T>>2]=0,T=T+4|0}while((0|T)<(0|$));return Vw(y,k),JA(T=0|p[($=k)>>2],$=0|p[$+4>>2],C),ef(T,$,S),X=+_0(C,S+8|0),$=~~+sv(+ +_0(d,A)/(2*X)),me=O,0|(0==(0|$)?1:$)}function lj(d,A,y,C){y|=0,C|=0,p[(d|=0)>>2]=A|=0,p[d+4>>2]=y,p[d+8>>2]=C}function us(d){var T,A=0,y=0,C=0,S=0,k=0;y=0|p[(T=4+(d|=0)|0)>>2],(0|(A=0|p[d>>2]))<0&&(p[T>>2]=y=y-A|0,p[(k=d+8|0)>>2]=(0|p[k>>2])-A,p[d>>2]=0,A=0),(0|y)<0?(p[d>>2]=A=A-y|0,p[(k=d+8|0)>>2]=S=(0|p[k>>2])-y|0,p[T>>2]=0,y=0):(k=S=d+8|0,S=0|p[S>>2]),(0|S)<0&&(p[d>>2]=A=A-S|0,p[T>>2]=y=y-S|0,p[k>>2]=0,S=0),!((0|(C=(0|S)<(0|(C=(0|y)<(0|A)?y:A))?S:C))<=0)&&(p[d>>2]=A-C,p[T>>2]=y-C,p[k>>2]=S-C)}function XA(d,A){var y,C;pe[(A|=0)>>3]=+((0|p[(d|=0)>>2])-(C=0|p[d+8>>2])|0)-.5*(y=+((0|p[d+4>>2])-C|0)),pe[A+8>>3]=.8660254037844386*y}function Ls(d,A,y){p[(y|=0)>>2]=(0|p[(A|=0)>>2])+(0|p[(d|=0)>>2]),p[y+4>>2]=(0|p[A+4>>2])+(0|p[d+4>>2]),p[y+8>>2]=(0|p[A+8>>2])+(0|p[d+8>>2])}function Rw(d,A,y){p[(y|=0)>>2]=(0|p[(d|=0)>>2])-(0|p[(A|=0)>>2]),p[y+4>>2]=(0|p[d+4>>2])-(0|p[A+4>>2]),p[y+8>>2]=(0|p[d+8>>2])-(0|p[A+8>>2])}function sk(d,A){var C,y=0;y=0|dh(0|p[(d|=0)>>2],A|=0),p[d>>2]=y,C=0|dh(0|p[(y=d+4|0)>>2],A),p[y>>2]=C,A=0|dh(0|p[(d=d+8|0)>>2],A),p[d>>2]=A}function av(d){var k,T,A=0,y=0,C=0,S=0,O=0;d=(d=(y=(0|(S=(0|p[8+(d|=0)>>2])-((O=(0|(T=0|p[d>>2]))<0)?T:0)+((k=(0|(C=(0|p[d+4>>2])-(O?T:0)|0))<0)?0-C|0:0)|0))<0)?0:S)-((C=(0|(y=(0|d)<(0|(y=(0|(A=(k?0:C)-(y?S:0)|0))<(0|(S=(O?0:T)-(k?C:0)-(y?S:0)|0))?A:S))?d:y))>0)?y:0)|0,A=A-(C?y:0)|0;e:do{switch(S-(C?y:0)|0){case 0:switch(0|A){case 0:return 0|(0==(0|d)?0:1==(0|d)?1:7);case 1:return 0|(0==(0|d)?2:1==(0|d)?3:7);default:break e}case 1:switch(0|A){case 0:return 0|(0==(0|d)?4:1==(0|d)?5:7);case 1:if(d)break e;return 6;default:break e}}}while(0);return 7}function ak(d){var T,O,A=0,y=0,C=0,S=0,k=0;C=0|dv(+((3*(A=(0|p[(d|=0)>>2])-(y=0|p[(T=d+8|0)>>2])|0)|0)-(y=(0|p[(O=d+4|0)>>2])-y|0)|0)/7),p[d>>2]=C,A=0|dv(+((y<<1)+A|0)/7),p[O>>2]=A,p[T>>2]=0,y=A-C|0,(0|C)<0?(k=0-C|0,p[O>>2]=y,p[T>>2]=k,p[d>>2]=0,A=y,C=0,y=k):y=0,(0|A)<0&&(p[d>>2]=C=C-A|0,p[T>>2]=y=y-A|0,p[O>>2]=0,A=0),k=C-y|0,S=A-y|0,(0|y)<0?(p[d>>2]=k,p[O>>2]=S,p[T>>2]=0,A=S,S=k,y=0):S=C,!((0|(C=(0|y)<(0|(C=(0|A)<(0|S)?A:S))?y:C))<=0)&&(p[d>>2]=S-C,p[O>>2]=A-C,p[T>>2]=y-C)}function Fw(d){var T,O,A=0,y=0,C=0,S=0,k=0;C=0|dv(+(((A=(0|p[(d|=0)>>2])-(y=0|p[(T=d+8|0)>>2])|0)<<1)+(y=(0|p[(O=d+4|0)>>2])-y|0)|0)/7),p[d>>2]=C,A=0|dv(+((3*y|0)-A|0)/7),p[O>>2]=A,p[T>>2]=0,y=A-C|0,(0|C)<0?(k=0-C|0,p[O>>2]=y,p[T>>2]=k,p[d>>2]=0,A=y,C=0,y=k):y=0,(0|A)<0&&(p[d>>2]=C=C-A|0,p[T>>2]=y=y-A|0,p[O>>2]=0,A=0),k=C-y|0,S=A-y|0,(0|y)<0?(p[d>>2]=k,p[O>>2]=S,p[T>>2]=0,A=S,S=k,y=0):S=C,!((0|(C=(0|y)<(0|(C=(0|A)<(0|S)?A:S))?y:C))<=0)&&(p[d>>2]=S-C,p[O>>2]=A-C,p[T>>2]=y-C)}function lv(d){var k,T,O,A=0,y=0,C=0,S=0;C=0|p[(O=8+(d|=0)|0)>>2],p[d>>2]=S=(y=0|p[(T=d+4|0)>>2])+(3*(A=0|p[d>>2])|0)|0,p[T>>2]=y=C+(3*y|0)|0,p[O>>2]=A=(3*C|0)+A|0,C=y-S|0,(0|S)<0?(A=A-S|0,p[T>>2]=C,p[O>>2]=A,p[d>>2]=0,y=C,C=0):C=S,(0|y)<0&&(p[d>>2]=C=C-y|0,p[O>>2]=A=A-y|0,p[T>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(p[d>>2]=k,p[T>>2]=S,p[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(p[d>>2]=C-y,p[T>>2]=S-y,p[O>>2]=A-y)}function YA(d){var k,T,O,A=0,y=0,C=0,S=0;C=(3*(A=0|p[(T=4+(d|=0)|0)>>2])|0)+(S=0|p[d>>2])|0,p[d>>2]=S=(y=0|p[(O=d+8|0)>>2])+(3*S|0)|0,p[T>>2]=C,p[O>>2]=A=(3*y|0)+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,p[T>>2]=y,p[O>>2]=A,p[d>>2]=0,S=0):y=C,(0|y)<0&&(p[d>>2]=S=S-y|0,p[O>>2]=A=A-y|0,p[T>>2]=0,y=0),k=S-A|0,C=y-A|0,(0|A)<0?(p[d>>2]=k,p[T>>2]=C,p[O>>2]=0,S=k,A=0):C=y,!((0|(y=(0|A)<(0|(y=(0|C)<(0|S)?C:S))?A:y))<=0)&&(p[d>>2]=S-y,p[T>>2]=C-y,p[O>>2]=A-y)}function lk(d,A){d|=0;var y=0,C=0,S=0,k=0,T=0,O=0;((A|=0)-1|0)>>>0>=6||(p[d>>2]=S=(0|p[15472+(12*A|0)>>2])+(0|p[d>>2])|0,p[(O=d+4|0)>>2]=C=(0|p[15472+(12*A|0)+4>>2])+(0|p[O>>2])|0,p[(T=d+8|0)>>2]=A=(0|p[15472+(12*A|0)+8>>2])+(0|p[T>>2])|0,y=C-S|0,(0|S)<0?(A=A-S|0,p[O>>2]=y,p[T>>2]=A,p[d>>2]=0,C=0):(y=C,C=S),(0|y)<0&&(p[d>>2]=C=C-y|0,p[T>>2]=A=A-y|0,p[O>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(p[d>>2]=k,p[O>>2]=S,p[T>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(p[d>>2]=C-y,p[O>>2]=S-y,p[T>>2]=A-y))}function ck(d){var k,T,O,A=0,y=0,C=0,S=0;C=(A=0|p[(T=4+(d|=0)|0)>>2])+(S=0|p[d>>2])|0,p[d>>2]=S=(y=0|p[(O=d+8|0)>>2])+S|0,p[T>>2]=C,p[O>>2]=A=y+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,p[T>>2]=y,p[O>>2]=A,p[d>>2]=0,C=0):(y=C,C=S),(0|y)<0&&(p[d>>2]=C=C-y|0,p[O>>2]=A=A-y|0,p[T>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(p[d>>2]=k,p[T>>2]=S,p[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(p[d>>2]=C-y,p[T>>2]=S-y,p[O>>2]=A-y)}function cv(d){var k,T,O,A=0,y=0,C=0,S=0;y=0|p[(O=8+(d|=0)|0)>>2],p[d>>2]=S=(C=0|p[(T=d+4|0)>>2])+(A=0|p[d>>2])|0,p[T>>2]=C=y+C|0,p[O>>2]=A=y+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,p[T>>2]=y,p[O>>2]=A,p[d>>2]=0,C=0):(y=C,C=S),(0|y)<0&&(p[d>>2]=C=C-y|0,p[O>>2]=A=A-y|0,p[T>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(p[d>>2]=k,p[T>>2]=S,p[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(p[d>>2]=C-y,p[T>>2]=S-y,p[O>>2]=A-y)}function KA(d){switch(0|(d|=0)){case 1:d=5;break;case 5:d=4;break;case 4:d=6;break;case 6:d=2;break;case 2:d=3;break;case 3:d=1}return 0|d}function fd(d){switch(0|(d|=0)){case 1:d=3;break;case 3:d=2;break;case 2:d=6;break;case 6:d=4;break;case 4:d=5;break;case 5:d=1}return 0|d}function uk(d){var k,T,O,A=0,y=0,C=0,S=0;C=0|p[(O=8+(d|=0)|0)>>2],p[d>>2]=S=(y=0|p[(T=d+4|0)>>2])+((A=0|p[d>>2])<<1)|0,p[T>>2]=y=C+(y<<1)|0,p[O>>2]=A=(C<<1)+A|0,C=y-S|0,(0|S)<0?(A=A-S|0,p[T>>2]=C,p[O>>2]=A,p[d>>2]=0,y=C,C=0):C=S,(0|y)<0&&(p[d>>2]=C=C-y|0,p[O>>2]=A=A-y|0,p[T>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(p[d>>2]=k,p[T>>2]=S,p[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(p[d>>2]=C-y,p[T>>2]=S-y,p[O>>2]=A-y)}function hk(d){var k,T,O,A=0,y=0,C=0,S=0;C=((A=0|p[(T=4+(d|=0)|0)>>2])<<1)+(S=0|p[d>>2])|0,p[d>>2]=S=(y=0|p[(O=d+8|0)>>2])+(S<<1)|0,p[T>>2]=C,p[O>>2]=A=(y<<1)+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,p[T>>2]=y,p[O>>2]=A,p[d>>2]=0,S=0):y=C,(0|y)<0&&(p[d>>2]=S=S-y|0,p[O>>2]=A=A-y|0,p[T>>2]=0,y=0),k=S-A|0,C=y-A|0,(0|A)<0?(p[d>>2]=k,p[T>>2]=C,p[O>>2]=0,S=k,A=0):C=y,!((0|(y=(0|A)<(0|(y=(0|C)<(0|S)?C:S))?A:y))<=0)&&(p[d>>2]=S-y,p[T>>2]=C-y,p[O>>2]=A-y)}function Ow(d,A){var k,T,O,y=0,C=0,S=0;return A=(A=(d=(0|(S=((O=(0|(T=(0|p[(d|=0)>>2])-(0|p[(A|=0)>>2])|0))<0)?0-T|0:0)+(0|p[d+8>>2])-(0|p[A+8>>2])+((k=(0|(C=(0|p[d+4>>2])-(0|p[A+4>>2])-(O?T:0)|0))<0)?0-C|0:0)|0))<0)?0:S)-((C=(0|(d=(0|A)<(0|(d=(0|(y=(k?0:C)-(d?S:0)|0))<(0|(S=(O?0:T)-(k?C:0)-(d?S:0)|0))?y:S))?A:d))>0)?d:0)|0,y=y-(C?d:0)|0,0|((0|(d=(0|(d=S-(C?d:0)|0))>-1?d:0-d|0))>(0|(A=(0|(y=(0|y)>-1?y:0-y|0))>(0|(A=(0|A)>-1?A:0-A|0))?y:A))?d:A)}function dk(d){var A,y,C,S;p[(d|=0)>>2]=y=(S=0|p[(A=d+8|0)>>2])-(0|p[d>>2])|0,p[(C=d+4|0)>>2]=d=(0|p[C>>2])-S|0,p[A>>2]=0-(d+y)}function dj(d){var T,O,A=0,y=0,C=0,S=0,k=0;p[(d|=0)>>2]=A=0-(y=0|p[d>>2])|0,p[(T=d+8|0)>>2]=0,S=(C=0|p[(O=d+4|0)>>2])+y|0,(0|y)>0?(p[O>>2]=S,p[T>>2]=y,p[d>>2]=0,A=0,C=S):y=0,(0|C)<0?(p[d>>2]=k=A-C|0,p[T>>2]=y=y-C|0,p[O>>2]=0,S=k-y|0,A=0-y|0,(0|y)<0?(p[d>>2]=S,p[O>>2]=A,p[T>>2]=0,C=A,y=0):(C=0,S=k)):S=A,!((0|(A=(0|y)<(0|(A=(0|C)<(0|S)?C:S))?y:A))<=0)&&(p[d>>2]=S-A,p[O>>2]=C-A,p[T>>2]=y-A)}function m0(d,A,y,C,S){A|=0,y|=0,C|=0,S|=0;var k=0,T=0;if((k=+function(d){var A,y;return+ +Si(+((y=+pe[(d|=0)>>3])*y+(A=+pe[d+8>>3])*A))}(d|=0))<1e-16)return p[S>>2]=p[(A=15568+(A<<4)|0)>>2],p[S+4>>2]=p[A+4>>2],p[S+8>>2]=p[A+8>>2],void(p[S+12>>2]=p[A+12>>2]);if(T=+hl(+ +pe[d+8>>3],+ +pe[d>>3]),(0|y)>0){d=0;do{k/=2.6457513110645907,d=d+1|0}while((0|d)!=(0|y))}C?(k/=3,y=0==(0|dl(y)),k=+Sw(.381966011250105*(y?k:k/2.6457513110645907))):(k=+Sw(.381966011250105*k),0|dl(y)&&(T=+g0(T+.3334731722518321))),function(d,A,y,C){d|=0,A=+A,C|=0;var S=0,k=0,T=0,O=0;if((y=+y)<1e-16)return p[C>>2]=p[d>>2],p[C+4>>2]=p[d+4>>2],p[C+8>>2]=p[d+8>>2],void(p[C+12>>2]=p[d+12>>2]);k=A<0?A+6.283185307179586:A,k=A>=6.283185307179586?k+-6.283185307179586:k;do{if(!(k<1e-16)){if(S=+tr(+(k+-3.141592653589793))<1e-16,A=+pe[d>>3],S){pe[C>>3]=A-=y,S=C;break}if(T=+Zn(+y),y=+or(+y),A=T*+or(+A)+ +Zn(+k)*(y*+Zn(+A)),A=+BU(+((A=A>1?1:A)<-1?-1:A)),pe[C>>3]=A,+tr(+(A+-1.5707963267948966))<1e-16)return pe[C>>3]=1.5707963267948966,void(pe[C+8>>3]=0);if(+tr(+(A+1.5707963267948966))<1e-16)return pe[C>>3]=-1.5707963267948966,void(pe[C+8>>3]=0);if(O=+Zn(+A),k=y*+or(+k)/O,y=+pe[d>>3],A=(T-+or(+A)*+or(+y))/+Zn(+y)/O,(A=+pe[d+8>>3]+ +hl(+((T=k>1?1:k)<-1?-1:T),+((A=A>1?1:A)<-1?-1:A)))>3.141592653589793)do{A+=-6.283185307179586}while(A>3.141592653589793);if(A<-3.141592653589793)do{A+=6.283185307179586}while(A<-3.141592653589793);return void(pe[C+8>>3]=A)}pe[C>>3]=A=+pe[d>>3]+y,S=C}while(0);if(+tr(+(A+-1.5707963267948966))<1e-16)return pe[S>>3]=1.5707963267948966,void(pe[C+8>>3]=0);if(+tr(+(A+1.5707963267948966))<1e-16)return pe[S>>3]=-1.5707963267948966,void(pe[C+8>>3]=0);if((A=+pe[d+8>>3])>3.141592653589793)do{A+=-6.283185307179586}while(A>3.141592653589793);if(A<-3.141592653589793)do{A+=6.283185307179586}while(A<-3.141592653589793);pe[C+8>>3]=A}(15568+(A<<4)|0,+g0(+pe[16368+(24*A|0)>>3]-T),k,S)}function Ak(d,A,y,C,S){d|=0,y|=0,C|=0,S|=0;var $,X,ee,ye,Te,ze,Qe,Ke,wt,Lt,gt,Ie,Nt,zt,kt,Ft,In,Ir,vr,jr,pr,ti,k=0,T=0,O=0,qe=0,ni=0,_n=0;if(ti=me,me=me+272|0,qe=ti+240|0,vr=ti,jr=ti+224|0,pr=ti+208|0,gt=ti+176|0,Ie=ti+160|0,Nt=ti+192|0,zt=ti+144|0,kt=ti+128|0,Ft=ti+112|0,In=ti+96|0,Ir=ti+80|0,p[(k=ti+256|0)>>2]=A|=0,p[qe>>2]=p[d>>2],p[qe+4>>2]=p[d+4>>2],p[qe+8>>2]=p[d+8>>2],p[qe+12>>2]=p[d+12>>2],fk(qe,k,vr),p[S>>2]=0,(0|(qe=C+y+(5==(0|C)&1)|0))<=(0|y))me=ti;else{X=jr+4|0,ee=gt+4|0,ye=y+5|0,Te=16848+(($=0|p[k>>2])<<2)|0,ze=16928+($<<2)|0,Qe=kt+8|0,Ke=Ft+8|0,wt=In+8|0,Lt=pr+4|0,O=y;e:for(;;){p[pr>>2]=p[(T=vr+(((0|O)%5|0)<<4)|0)>>2],p[pr+4>>2]=p[T+4>>2],p[pr+8>>2]=p[T+8>>2],p[pr+12>>2]=p[T+12>>2];do{}while(2==(0|Zp(pr,$,0,1)));if((0|O)>(0|y)&0!=(0|dl(A))){if(p[gt>>2]=p[pr>>2],p[gt+4>>2]=p[pr+4>>2],p[gt+8>>2]=p[pr+8>>2],p[gt+12>>2]=p[pr+12>>2],XA(X,Ie),p[gt>>2]=p[18608+(80*(C=0|p[gt>>2])|0)+(20*(k=0|p[17008+(80*C|0)+(p[jr>>2]<<2)>>2])|0)>>2],(0|(T=0|p[18608+(80*C|0)+(20*k|0)+16>>2]))>0){d=0;do{ck(ee),d=d+1|0}while((0|d)<(0|T))}switch(p[Nt>>2]=p[(T=18608+(80*C|0)+(20*k|0)+4|0)>>2],p[Nt+4>>2]=p[T+4>>2],p[Nt+8>>2]=p[T+8>>2],sk(Nt,3*(0|p[Te>>2])|0),Ls(ee,Nt,ee),us(ee),XA(ee,zt),pe[kt>>3]=3*(ni=+(0|p[ze>>2])),pe[Qe>>3]=0,pe[Ft>>3]=_n=-1.5*ni,pe[Ke>>3]=2.598076211353316*ni,pe[In>>3]=_n,pe[wt>>3]=-2.598076211353316*ni,0|p[17008+(80*(0|p[gt>>2])|0)+(p[pr>>2]<<2)>>2]){case 1:d=Ft,C=kt;break;case 3:d=In,C=Ft;break;case 2:d=kt,C=In;break;default:d=12;break e}Dk(Ie,zt,C,d,Ir),m0(Ir,0|p[gt>>2],$,1,S+8+(p[S>>2]<<4)|0),p[S>>2]=1+(0|p[S>>2])}if((0|O)<(0|ye)&&(XA(Lt,gt),m0(gt,0|p[pr>>2],$,1,S+8+(p[S>>2]<<4)|0),p[S>>2]=1+(0|p[S>>2])),p[jr>>2]=p[pr>>2],p[jr+4>>2]=p[pr+4>>2],p[jr+8>>2]=p[pr+8>>2],p[jr+12>>2]=p[pr+12>>2],(0|(O=O+1|0))>=(0|qe)){d=3;break}}3!=(0|d)?12==(0|d)&&Tr(22474,22521,581,22531):me=ti}}function fk(d,A,y){d|=0,A|=0,y|=0;var $,C=0,S=0,k=0,T=0,O=0;$=me,me=me+128|0,S=$,T=20208,O=60+(k=C=$+64|0)|0;do{p[k>>2]=p[T>>2],k=k+4|0,T=T+4|0}while((0|k)<(0|O));T=20272,O=(k=S)+60|0;do{p[k>>2]=p[T>>2],k=k+4|0,T=T+4|0}while((0|k)<(0|O));C=(O=0==(0|dl(0|p[A>>2])))?C:S,uk(S=d+4|0),hk(S),0|dl(0|p[A>>2])&&(YA(S),p[A>>2]=1+(0|p[A>>2])),p[y>>2]=p[d>>2],Ls(S,C,A=y+4|0),us(A),p[y+16>>2]=p[d>>2],Ls(S,C+12|0,A=y+20|0),us(A),p[y+32>>2]=p[d>>2],Ls(S,C+24|0,A=y+36|0),us(A),p[y+48>>2]=p[d>>2],Ls(S,C+36|0,A=y+52|0),us(A),p[y+64>>2]=p[d>>2],Ls(S,C+48|0,y=y+68|0),us(y),me=$}function Zp(d,A,y,C){y|=0;var T,O,X,ee,Te,Qe,S=0,k=0,$=0,ye=0,ze=0;if(Qe=me,me=me+32|0,Te=Qe+12|0,O=Qe,ye=0|p[16928+((A|=0)<<2)>>2],ye=(ee=0!=(0|(C|=0)))?3*ye|0:ye,S=0|p[(ze=4+(d|=0)|0)>>2],T=0|p[(X=d+8|0)>>2],ee){if((0|(S=T+S+(C=0|p[(k=d+12|0)>>2])|0))==(0|ye))return me=Qe,1;$=k}else S=T+S+(C=0|p[($=d+12|0)>>2])|0;if((0|S)<=(0|ye))return me=Qe,0;do{if((0|C)>0){if(C=0|p[d>>2],(0|T)>0){k=18608+(80*C|0)+60|0,C=d;break}C=18608+(80*C|0)+40|0,y?(lj(Te,ye,0,0),Rw(ze,Te,O),cv(O),Ls(O,Te,ze),k=C,C=d):(k=C,C=d)}else k=18608+(80*(0|p[d>>2])|0)+20|0,C=d}while(0);if(p[C>>2]=p[k>>2],(0|p[(S=k+16|0)>>2])>0){C=0;do{ck(ze),C=C+1|0}while((0|C)<(0|p[S>>2]))}return p[Te>>2]=p[(d=k+4|0)>>2],p[Te+4>>2]=p[d+4>>2],p[Te+8>>2]=p[d+8>>2],A=0|p[16848+(A<<2)>>2],sk(Te,ee?3*A|0:A),Ls(ze,Te,ze),us(ze),me=Qe,0|(ee&&((0|p[X>>2])+(0|p[ze>>2])+(0|p[$>>2])|0)==(0|ye)?1:2)}function mj(d,A){d|=0,A|=0;var y=0;do{y=0|Zp(d,A,0,1)}while(2==(0|y));return 0|y}function pk(d,A,y,C,S){d|=0,y|=0,C|=0,S|=0;var $,X,ee,ye,Te,ze,Qe,Ke,wt,Lt,qe,gt,Ie,Nt,zt,kt,Ft,In,k=0,T=0,O=0,Ir=0,vr=0;if(In=me,me=me+240|0,Nt=In+208|0,zt=In,kt=In+192|0,Ft=In+176|0,wt=In+160|0,Lt=In+144|0,qe=In+128|0,gt=In+112|0,Ie=In+96|0,p[(k=In+224|0)>>2]=A|=0,p[Nt>>2]=p[d>>2],p[Nt+4>>2]=p[d+4>>2],p[Nt+8>>2]=p[d+8>>2],p[Nt+12>>2]=p[d+12>>2],mk(Nt,k,zt),p[S>>2]=0,(0|(Ke=C+y+(6==(0|C)&1)|0))<=(0|y))me=In;else{X=y+6|0,ee=16928+(($=0|p[k>>2])<<2)|0,ye=Lt+8|0,Te=qe+8|0,ze=gt+8|0,Qe=kt+4|0,T=0,O=y,C=-1;e:for(;;){if(p[kt>>2]=p[(d=zt+((k=(0|O)%6|0)<<4)|0)>>2],p[kt+4>>2]=p[d+4>>2],p[kt+8>>2]=p[d+8>>2],p[kt+12>>2]=p[d+12>>2],d=T,T=0|Zp(kt,$,0,1),(0|O)>(0|y)&0!=(0|dl(A))&&1!=(0|d)&&(0|p[kt>>2])!=(0|C)){switch(XA(zt+(((k+5|0)%6|0)<<4)+4|0,Ft),XA(zt+(k<<4)+4|0,wt),pe[Lt>>3]=3*(Ir=+(0|p[ee>>2])),pe[ye>>3]=0,pe[qe>>3]=vr=-1.5*Ir,pe[Te>>3]=2.598076211353316*Ir,pe[gt>>3]=vr,pe[ze>>3]=-2.598076211353316*Ir,0|p[17008+(80*(k=0|p[Nt>>2])|0)+(((0|C)==(0|k)?0|p[kt>>2]:C)<<2)>>2]){case 1:d=qe,C=Lt;break;case 3:d=gt,C=qe;break;case 2:d=Lt,C=gt;break;default:d=8;break e}Dk(Ft,wt,C,d,Ie),!(0|Sk(Ft,Ie))&&!(0|Sk(wt,Ie))&&(m0(Ie,0|p[Nt>>2],$,1,S+8+(p[S>>2]<<4)|0),p[S>>2]=1+(0|p[S>>2]))}if((0|O)<(0|X)&&(XA(Qe,Ft),m0(Ft,0|p[kt>>2],$,1,S+8+(p[S>>2]<<4)|0),p[S>>2]=1+(0|p[S>>2])),(0|(O=O+1|0))>=(0|Ke)){d=3;break}C=0|p[kt>>2]}3!=(0|d)?8==(0|d)&&Tr(22557,22521,746,22602):me=In}}function mk(d,A,y){d|=0,A|=0,y|=0;var $,C=0,S=0,k=0,T=0,O=0;$=me,me=me+160|0,S=$,T=20336,O=72+(k=C=$+80|0)|0;do{p[k>>2]=p[T>>2],k=k+4|0,T=T+4|0}while((0|k)<(0|O));T=20416,O=(k=S)+72|0;do{p[k>>2]=p[T>>2],k=k+4|0,T=T+4|0}while((0|k)<(0|O));C=(O=0==(0|dl(0|p[A>>2])))?C:S,uk(S=d+4|0),hk(S),0|dl(0|p[A>>2])&&(YA(S),p[A>>2]=1+(0|p[A>>2])),p[y>>2]=p[d>>2],Ls(S,C,A=y+4|0),us(A),p[y+16>>2]=p[d>>2],Ls(S,C+12|0,A=y+20|0),us(A),p[y+32>>2]=p[d>>2],Ls(S,C+24|0,A=y+36|0),us(A),p[y+48>>2]=p[d>>2],Ls(S,C+36|0,A=y+52|0),us(A),p[y+64>>2]=p[d>>2],Ls(S,C+48|0,A=y+68|0),us(A),p[y+80>>2]=p[d>>2],Ls(S,C+60|0,y=y+84|0),us(y),me=$}function g0(d){var A;return A=(d=+d)<0?d+6.283185307179586:d,+(d>=6.283185307179586?A+-6.283185307179586:A)}function Wp(d,A){return+tr(+(+pe[(d|=0)>>3]-+pe[(A|=0)>>3]))<17453292519943298e-27?0|(A=+tr(+(+pe[d+8>>3]-+pe[A+8>>3]))<17453292519943298e-27):0|(A=0)}function _0(d,A){var C,S,k,y=0;return y=(k=+or(.5*((S=+pe[(A|=0)>>3])-(C=+pe[(d|=0)>>3]))))*k+(y=+or(.5*(+pe[A+8>>3]-+pe[d+8>>3])))*(+Zn(+S)*+Zn(+C)*y),2*+hl(+ +Si(+y),+ +Si(+(1-y)))*6371.007180918475}function Qp(d,A,y){y|=0;var O,X,ee,ye,C=0,S=0,k=0,T=0,$=0,Te=0;return $=+or(.5*((Te=+pe[(A|=0)>>3])-(ee=+pe[(d|=0)>>3]))),T=+or(.5*((k=+pe[A+8>>3])-(X=+pe[d+8>>3]))),O=+Zn(+ee),ye=+Zn(+Te),T=2*+hl(+ +Si(+(T=$*$+T*(ye*O*T))),+ +Si(+(1-T))),Te=+or(.5*(($=+pe[y>>3])-Te)),k=+or(.5*((C=+pe[y+8>>3])-k)),S=+Zn(+$),k=2*+hl(+ +Si(+(k=Te*Te+k*(ye*S*k))),+ +Si(+(1-k))),$=+or(.5*(ee-$)),C=+or(.5*(X-C)),C=2*+hl(+ +Si(+(C=$*$+C*(O*S*C))),+ +Si(+(1-C))),4*+Sw(+ +Si(+ +Ad(.5*(S=.5*(T+k+C)))*+Ad(.5*(S-T))*+Ad(.5*(S-k))*+Ad(.5*(S-C))))}function gk(d,A){return A=0|bt(0|(d|=0),0|(A|=0),45),De(),127&A|0}function _k(d,A){d|=0;var y=0,C=0,S=0,k=0,T=0,O=0;if(!(!0&134217728==(-16777216&(A|=0)|0))||(T=0|bt(0|d,0|A,45),De(),(T&=127)>>>0>121))return 0;y=0|bt(0|d,0|A,52),De(),y&=15;do{if(0|y){for(S=1,C=0;;){if(k=0|bt(0|d,0|A,3*(15-S|0)|0),De(),0!=(0|(k&=7))&(1^C)){if(1==(0|k)&0!=(0|fi(T))){O=0,C=13;break}C=1}if(7==(0|k)){O=0,C=13;break}if(!(S>>>0<y>>>0)){C=9;break}S=S+1|0}if(9==(0|C)){if(15!=(0|y))break;return 1}if(13==(0|C))return 0|O}}while(0);for(;;){if(O=0|bt(0|d,0|A,3*(14-y|0)|0),De(),!(7==(7&O|0)&!0)){O=0,C=13;break}if(!(y>>>0<14)){O=1,C=13;break}y=y+1|0}return 13==(0|C)?0|O:0}function Lw(d,A,y){y|=0;var C=0,S=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|(C&=15))>=(0|y)){if((0|C)!=(0|y))if(y>>>0<=15){if(d|=S=0|Ot(0|y,0,52),A=0|De()|-15728641&A,(0|C)>(0|y))do{S=0|Ot(7,0,3*(14-y|0)|0),y=y+1|0,d|=S,A=0|De()|A}while((0|y)<(0|C))}else A=0,d=0}else A=0,d=0;return Mn(0|A),0|d}function la(d,A,y,C){y|=0,C|=0;var S=0,k=0,T=0,O=0,$=0,X=0,ee=0;if(T=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|y)<16&(0|(T&=15))<=(0|y)){if((0|T)==(0|y))return p[(y=C)>>2]=d,void(p[y+4>>2]=A);if(X=(0|($=0|hv(7,y-T|0)))/7|0,O=0|bt(0|d,0|A,45),De(),0|fi(127&O)){e:do{if(T)for(k=1;;){if(S=0|bt(0|d,0|A,3*(15-k|0)|0),De(),0|(S&=7))break e;if(!(k>>>0<T>>>0)){S=0;break}k=k+1|0}else S=0}while(0);k=0==(0|S)}else k=0;if(ee=0|Ot(T+1|0,0,52),S=0|De()|-15728641&A,la(A=(ee|d)&~(A=0|Ot(7,0,0|(O=3*(14-T|0)|0))),T=S&~(0|De()),y,C),S=C+(X<<3)|0,!k)return la((ee=0|Ot(1,0,0|O))|A,0|De()|T,y,S),ee=S+(X<<3)|0,la(($=0|Ot(2,0,0|O))|A,0|De()|T,y,ee),ee=ee+(X<<3)|0,la(($=0|Ot(3,0,0|O))|A,0|De()|T,y,ee),ee=ee+(X<<3)|0,la(($=0|Ot(4,0,0|O))|A,0|De()|T,y,ee),ee=ee+(X<<3)|0,la(($=0|Ot(5,0,0|O))|A,0|De()|T,y,ee),void la(($=0|Ot(6,0,0|O))|A,0|De()|T,y,ee+(X<<3)|0);k=S+(X<<3)|0,(0|$)>6&&(tc(0|S,0,8+(ee=(k>>>0>($=S+8|0)>>>0?k:$)+-1+(0-S)|0)&-8|0),S=$+(ee>>>3<<3)|0),la((ee=0|Ot(2,0,0|O))|A,0|De()|T,y,S),ee=S+(X<<3)|0,la(($=0|Ot(3,0,0|O))|A,0|De()|T,y,ee),ee=ee+(X<<3)|0,la(($=0|Ot(4,0,0|O))|A,0|De()|T,y,ee),ee=ee+(X<<3)|0,la(($=0|Ot(5,0,0|O))|A,0|De()|T,y,ee),la(($=0|Ot(6,0,0|O))|A,0|De()|T,y,ee+(X<<3)|0)}}function _o(d,A){var y=0,C=0,S=0;if(S=0|bt(0|(d|=0),0|(A|=0),45),De(),!(0|fi(127&S)))return 0;S=0|bt(0|d,0|A,52),De(),S&=15;e:do{if(S)for(C=1;;){if(y=0|bt(0|d,0|A,3*(15-C|0)|0),De(),0|(y&=7))break e;if(!(C>>>0<S>>>0)){y=0;break}C=C+1|0}else y=0}while(0);return 0|0==(0|y)&1}function ca(d,A){var y=0,C=0,S=0;if(S=0|bt(0|(d|=0),0|(A|=0),52),De(),!(S&=15))return 0;for(C=1;;){if(y=0|bt(0|d,0|A,3*(15-C|0)|0),De(),0|(y&=7)){C=5;break}if(!(C>>>0<S>>>0)){y=0,C=5;break}C=C+1|0}return 5==(0|C)?0|y:0}function Bw(d,A){var y=0,C=0,S=0,k=0,T=0,O=0,$=0;if($=0|bt(0|(d|=0),0|(A|=0),52),De(),!($&=15))return $=d,Mn(0|(O=A)),0|$;for(O=1,y=0;;){C=0|Ot(7,0,0|(k=3*(15-O|0)|0)),S=0|De(),T=0|bt(0|d,0|A,0|k),De(),d=(k=0|Ot(0|KA(7&T),0,0|k))|d&~C,A=(T=0|De())|A&~S;e:do{if(!y)if(0==(k&C|0)&0==(T&S|0))y=0;else if(C=0|bt(0|d,0|A,52),De(),C&=15,C){y=1;t:for(;;){switch(T=0|bt(0|d,0|A,3*(15-y|0)|0),De(),7&T){case 1:break t;case 0:break;default:y=1;break e}if(!(y>>>0<C>>>0)){y=1;break e}y=y+1|0}for(y=1;;){if(S=0|bt(0|d,0|A,0|(T=3*(15-y|0)|0)),De(),k=0|Ot(7,0,0|T),A&=~(0|De()),d=d&~k|(T=0|Ot(0|KA(7&S),0,0|T)),A=0|A|De(),!(y>>>0<C>>>0)){y=1;break}y=y+1|0}}else y=1}while(0);if(!(O>>>0<$>>>0))break;O=O+1|0}return Mn(0|A),0|d}function pd(d,A){var y=0,C=0,S=0,k=0,T=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),!(C&=15))return C=d,Mn(0|(y=A)),0|C;for(y=1;T=0|bt(0|d,0|A,0|(k=3*(15-y|0)|0)),De(),S=0|Ot(7,0,0|k),A&=~(0|De()),d=(k=0|Ot(0|KA(7&T),0,0|k))|d&~S,A=0|De()|A,y>>>0<C>>>0;)y=y+1|0;return Mn(0|A),0|d}function zj(d,A){var y=0,C=0,S=0,k=0,T=0,O=0,$=0;if($=0|bt(0|(d|=0),0|(A|=0),52),De(),!($&=15))return $=d,Mn(0|(O=A)),0|$;for(O=1,y=0;;){C=0|Ot(7,0,0|(k=3*(15-O|0)|0)),S=0|De(),T=0|bt(0|d,0|A,0|k),De(),d=(k=0|Ot(0|fd(7&T),0,0|k))|d&~C,A=(T=0|De())|A&~S;e:do{if(!y)if(0==(k&C|0)&0==(T&S|0))y=0;else if(C=0|bt(0|d,0|A,52),De(),C&=15,C){y=1;t:for(;;){switch(T=0|bt(0|d,0|A,3*(15-y|0)|0),De(),7&T){case 1:break t;case 0:break;default:y=1;break e}if(!(y>>>0<C>>>0)){y=1;break e}y=y+1|0}for(y=1;;){if(k=0|Ot(7,0,0|(S=3*(15-y|0)|0)),T=A&~(0|De()),A=0|bt(0|d,0|A,0|S),De(),d=d&~k|(A=0|Ot(0|fd(7&A),0,0|S)),A=0|T|De(),!(y>>>0<C>>>0)){y=1;break}y=y+1|0}}else y=1}while(0);if(!(O>>>0<$>>>0))break;O=O+1|0}return Mn(0|A),0|d}function Nw(d,A){var y=0,C=0,S=0,k=0,T=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),!(C&=15))return C=d,Mn(0|(y=A)),0|C;for(y=1;k=0|Ot(7,0,0|(T=3*(15-y|0)|0)),S=A&~(0|De()),A=0|bt(0|d,0|A,0|T),De(),d=(A=0|Ot(0|fd(7&A),0,0|T))|d&~k,A=0|De()|S,y>>>0<C>>>0;)y=y+1|0;return Mn(0|A),0|d}function dl(d){return 0|(0|(d|=0))%2}function yk(d,A){var y,C;return d|=0,C=me,me=me+16|0,y=C,(A|=0)>>>0<=15&&2146435072!=(2146435072&p[d+4>>2]|0)&&2146435072!=(2146435072&p[d+8+4>>2]|0)?(function(d,A,y){var C,S;C=me,me=me+16|0,function(d,A,y,C){A|=0,y|=0,C|=0;var $,S=0,k=0,T=0,O=0;if($=me,me=me+32|0,function(d,A){A|=0;var C,S,y=0;C=+Zn(+(y=+pe[(d|=0)>>3])),y=+or(+y),pe[A+16>>3]=y,S=C*+Zn(+(y=+pe[d+8>>3])),pe[A>>3]=S,y=C*+or(+y),pe[A+8>>3]=y}(d|=0,k=$),p[y>>2]=0,S=+ao(15888,k),(T=+ao(15912,k))<S&&(p[y>>2]=1,S=T),(T=+ao(15936,k))<S&&(p[y>>2]=2,S=T),(T=+ao(15960,k))<S&&(p[y>>2]=3,S=T),(T=+ao(15984,k))<S&&(p[y>>2]=4,S=T),(T=+ao(16008,k))<S&&(p[y>>2]=5,S=T),(T=+ao(16032,k))<S&&(p[y>>2]=6,S=T),(T=+ao(16056,k))<S&&(p[y>>2]=7,S=T),(T=+ao(16080,k))<S&&(p[y>>2]=8,S=T),(T=+ao(16104,k))<S&&(p[y>>2]=9,S=T),(T=+ao(16128,k))<S&&(p[y>>2]=10,S=T),(T=+ao(16152,k))<S&&(p[y>>2]=11,S=T),(T=+ao(16176,k))<S&&(p[y>>2]=12,S=T),(T=+ao(16200,k))<S&&(p[y>>2]=13,S=T),(T=+ao(16224,k))<S&&(p[y>>2]=14,S=T),(T=+ao(16248,k))<S&&(p[y>>2]=15,S=T),(T=+ao(16272,k))<S&&(p[y>>2]=16,S=T),(T=+ao(16296,k))<S&&(p[y>>2]=17,S=T),(T=+ao(16320,k))<S&&(p[y>>2]=18,S=T),(T=+ao(16344,k))<S&&(p[y>>2]=19,S=T),(T=+LU(+(1-.5*S)))<1e-16)return p[C>>2]=0,p[C+4>>2]=0,p[C+8>>2]=0,p[C+12>>2]=0,void(me=$);if(S=+g0((S=+pe[16368+(24*(y=0|p[y>>2])|0)>>3])-+g0(+function(d,A){var y,C,S,k,T;return d|=0,T=(C=+Zn(+(k=+pe[(A|=0)>>3])))*+or(+(S=+pe[A+8>>3]-+pe[d+8>>3])),y=+pe[d>>3],+ +hl(+T,+(+or(+k)*+Zn(+y)-+Zn(+S)*(C*+or(+y))))}(15568+(y<<4)|0,d))),O=0|dl(A)?+g0(S+-.3334731722518321):S,S=+Ad(+T)/.381966011250105,(0|A)>0){k=0;do{S*=2.6457513110645907,k=k+1|0}while((0|k)!=(0|A))}T=+Zn(+O)*S,pe[C>>3]=T,O=+or(+O)*S,pe[C+8>>3]=O,me=$}(d|=0,A|=0,y|=0,S=C),function(d,A){d|=0;var k,$,X,ye,y=0,C=0,S=0,T=0,O=0,ee=0,Te=0;p[(ye=8+(A|=0)|0)>>2]=0,T=+tr(+($=+pe[d>>3])),T+=.5*(O=+tr(+(X=+pe[d+8>>3]))/.8660254037844386),T-=+(0|(y=~~T)),O-=+(0|(d=~~O));do{if(T<.5){if(T<.3333333333333333){if(p[A>>2]=y,O<.5*(T+1)){p[A+4>>2]=d;break}p[A+4>>2]=d=d+1|0;break}if(p[A+4>>2]=d=(1&!(O<(Te=1-T)))+d|0,Te<=O&O<2*T){p[A>>2]=y=y+1|0;break}p[A>>2]=y;break}if(!(T<.6666666666666666)){if(p[A>>2]=y=y+1|0,O<.5*T){p[A+4>>2]=d;break}p[A+4>>2]=d=d+1|0;break}if(O<1-T){if(p[A+4>>2]=d,2*T-1<O){p[A>>2]=y;break}}else p[A+4>>2]=d=d+1|0;p[A>>2]=y=y+1|0}while(0);do{if($<0){if(1&d){y=~~(+(0|y)-(2*(+((ee=0|v0(0|y,((0|y)<0)<<31>>31|0,0|(ee=(d+1|0)/2|0),((0|ee)<0)<<31>>31|0))>>>0)+4294967296*+(0|De()))+1)),p[A>>2]=y;break}y=~~(+(0|y)-2*(+((ee=0|v0(0|y,((0|y)<0)<<31>>31|0,0|(ee=(0|d)/2|0),((0|ee)<0)<<31>>31|0))>>>0)+4294967296*+(0|De()))),p[A>>2]=y;break}}while(0);ee=A+4|0,X<0&&(p[A>>2]=y=y-((1|d<<1)/2|0)|0,p[ee>>2]=d=0-d|0),C=d-y|0,(0|y)<0?(S=0-y|0,p[ee>>2]=C,p[ye>>2]=S,p[A>>2]=0,d=C,y=0):S=0,(0|d)<0&&(p[A>>2]=y=y-d|0,p[ye>>2]=S=S-d|0,p[ee>>2]=0,d=0),k=y-S|0,C=d-S|0,(0|S)<0&&(p[A>>2]=k,p[ee>>2]=C,p[ye>>2]=0,d=C,y=k,S=0),!((0|(C=(0|S)<(0|(C=(0|d)<(0|y)?d:y))?S:C))<=0)&&(p[A>>2]=y-C,p[ee>>2]=d-C,p[ye>>2]=S-C)}(S,y+4|0),me=C}(d,A,y),A=0|function(d,A){d|=0;var $,y=0,C=0,S=0,k=0,T=0,O=0,X=0,ee=0;if($=me,me=me+64|0,O=$+40|0,C=$+24|0,S=$+12|0,k=$,Ot(0|(A|=0),0,52),y=134225919|De(),!A)return(0|p[d+4>>2])>2||(0|p[d+8>>2])>2||(0|p[d+12>>2])>2?(O=0,Mn(0|(T=0)),me=$,0|O):(Ot(0|nk(d),0,45),T=0|De()|y,O=-1,Mn(0|T),me=$,0|O);if(p[O>>2]=p[d>>2],p[O+4>>2]=p[d+4>>2],p[O+8>>2]=p[d+8>>2],p[O+12>>2]=p[d+12>>2],T=O+4|0,(0|A)>0)for(d=-1;p[C>>2]=p[T>>2],p[C+4>>2]=p[T+4>>2],p[C+8>>2]=p[T+8>>2],1&A?(ak(T),p[S>>2]=p[T>>2],p[S+4>>2]=p[T+4>>2],p[S+8>>2]=p[T+8>>2],lv(S)):(Fw(T),p[S>>2]=p[T>>2],p[S+4>>2]=p[T+4>>2],p[S+8>>2]=p[T+8>>2],YA(S)),Rw(C,S,k),us(k),X=0|Ot(7,0,0|(ee=3*(15-A|0)|0)),y&=~(0|De()),d=(ee=0|Ot(0|av(k),0,0|ee))|d&~X,y=0|De()|y,(0|A)>1;)A=A+-1|0;else d=-1;e:do{if((0|p[T>>2])<=2&&(0|p[O+8>>2])<=2&&(0|p[O+12>>2])<=2){if(A=0|Ot(0|(C=0|nk(O)),0,45),A|=d,d=0|De()|-1040385&y,k=0|nj(O),!(0|fi(C))){if((0|k)<=0)break;for(S=0;;){if(C=0|bt(0|A,0|d,52),De(),C&=15)for(y=1;O=0|bt(0|A,0|d,0|(ee=3*(15-y|0)|0)),De(),X=0|Ot(7,0,0|ee),d&=~(0|De()),A=A&~X|(ee=0|Ot(0|KA(7&O),0,0|ee)),d=0|d|De(),y>>>0<C>>>0;)y=y+1|0;if((0|(S=S+1|0))==(0|k))break e}}S=0|bt(0|A,0|d,52),De(),S&=15;t:do{if(S){y=1;n:for(;;){switch(ee=0|bt(0|A,0|d,3*(15-y|0)|0),De(),7&ee){case 1:break n;case 0:break;default:break t}if(!(y>>>0<S>>>0))break t;y=y+1|0}if(0|rk(C,0|p[O>>2]))for(y=1;X=0|Ot(7,0,0|(O=3*(15-y|0)|0)),ee=d&~(0|De()),d=0|bt(0|A,0|d,0|O),De(),A=A&~X|(d=0|Ot(0|fd(7&d),0,0|O)),d=0|ee|De(),y>>>0<S>>>0;)y=y+1|0;else for(y=1;O=0|bt(0|A,0|d,0|(ee=3*(15-y|0)|0)),De(),X=0|Ot(7,0,0|ee),d&=~(0|De()),A=A&~X|(ee=0|Ot(0|KA(7&O),0,0|ee)),d=0|d|De(),y>>>0<S>>>0;)y=y+1|0}}while(0);if((0|k)>0){y=0;do{A=0|Bw(A,d),d=0|De(),y=y+1|0}while((0|y)!=(0|k))}}else A=0,d=0}while(0);return ee=A,Mn(0|(X=d)),me=$,0|ee}(y,A),d=0|De()):(d=0,A=0),Mn(0|d),me=C,0|A}function zw(d,A,y){var S,C=0,k=0,T=0;if(S=4+(y|=0)|0,k=0|bt(0|(d|=0),0|(A|=0),52),De(),k&=15,T=0|bt(0|d,0|A,45),De(),C=0==(0|k),0|fi(127&T)){if(C)return 1;C=1}else{if(C)return 0;C=0==(0|p[S>>2])&&0==(0|p[y+8>>2])?0!=(0|p[y+12>>2])&1:1}for(y=1;1&y?lv(S):YA(S),T=0|bt(0|d,0|A,3*(15-y|0)|0),De(),lk(S,7&T),y>>>0<k>>>0;)y=y+1|0;return 0|C}function y0(d,A,y){y|=0;var $,ee,C=0,S=0,k=0,T=0,O=0,X=0;ee=me,me=me+16|0,$=ee,X=0|bt(0|(d|=0),0|(A|=0),45),De(),X&=127;e:do{if(0!=(0|fi(X))&&(k=0|bt(0|d,0|A,52),De(),k&=15,0!=(0|k))){C=1;t:for(;;){switch(O=0|bt(0|d,0|A,3*(15-C|0)|0),De(),7&O){case 5:break t;case 0:break;default:C=A;break e}if(!(C>>>0<k>>>0)){C=A;break e}C=C+1|0}for(S=1,C=A;T=0|Ot(7,0,0|(A=3*(15-S|0)|0)),O=C&~(0|De()),C=0|bt(0|d,0|C,0|A),De(),d=d&~T|(C=0|Ot(0|fd(7&C),0,0|A)),C=0|O|De(),S>>>0<k>>>0;)S=S+1|0}else C=A}while(0);if(p[y>>2]=p[(O=7728+(28*X|0)|0)>>2],p[y+4>>2]=p[O+4>>2],p[y+8>>2]=p[O+8>>2],p[y+12>>2]=p[O+12>>2],0|zw(d,C,y)){if(p[$>>2]=p[(T=y+4|0)>>2],p[$+4>>2]=p[T+4>>2],p[$+8>>2]=p[T+8>>2],k=0|bt(0|d,0|C,52),De(),O=15&k,1&k?(YA(T),k=O+1|0):k=O,0|fi(X)){e:do{if(O)for(A=1;;){if(S=0|bt(0|d,0|C,3*(15-A|0)|0),De(),0|(S&=7)){C=S;break e}if(!(A>>>0<O>>>0)){C=0;break}A=A+1|0}else C=0}while(0);C=4==(0|C)&1}else C=0;if(0|Zp(y,k,C,0)){if(0|fi(X))do{}while(0!=(0|Zp(y,k,0,0)));(0|k)!=(0|O)&&Fw(T)}else(0|k)!=(0|O)&&(p[T>>2]=p[$>>2],p[T+4>>2]=p[$+4>>2],p[T+8>>2]=p[$+8>>2]);me=ee}else me=ee}function JA(d,A,y){var C,S;y|=0,C=me,me=me+16|0,y0(d|=0,A|=0,S=C),A=0|bt(0|d,0|A,52),De(),function(d,A,y){var C,S;A|=0,y|=0,C=me,me=me+16|0,XA(4+(d|=0)|0,S=C),m0(S,0|p[d>>2],A,0,y),me=C}(S,15&A,y),me=C}function ef(d,A,y){y|=0;var k,T,C=0,S=0;T=me,me=me+16|0,y0(d|=0,A|=0,k=T),C=0|bt(0|d,0|A,45),De(),C=0==(0|fi(127&C)),S=0|bt(0|d,0|A,52),De(),S&=15;e:do{if(!C){if(0|S)for(C=1;;){if(!(0==((0|Ot(7,0,3*(15-C|0)|0))&d|0)&0==((0|De())&A|0)))break e;if(!(C>>>0<S>>>0))break;C=C+1|0}return Ak(k,S,0,5,y),void(me=T)}}while(0);pk(k,S,0,6,y),me=T}function Vw(d,A){A|=0;var O,y=0,C=0,S=0,k=0,T=0,$=0;if(Ot(0|(d|=0),0,52),O=134225919|De(),(0|d)<1){C=0,y=0;do{0|fi(C)&&(Ot(0|C,0,45),T=0|O|De(),p[(d=A+(y<<3)|0)>>2]=-1,p[d+4>>2]=T,y=y+1|0),C=C+1|0}while(122!=(0|C))}else{T=0,y=0;do{if(0|fi(T)){for(Ot(0|T,0,45),C=1,S=-1,k=0|O|De();S&=~($=0|Ot(7,0,3*(15-C|0)|0)),k&=~(0|De()),(0|C)!=(0|d);)C=C+1|0;p[($=A+(y<<3)|0)>>2]=S,p[$+4>>2]=k,y=y+1|0}T=T+1|0}while(122!=(0|T))}}function xk(d,A,y,C){var O,S=0,k=0,T=0,$=0,X=0;if(O=me,me=me+64|0,T=O,(0|(d|=0))==(0|(y|=0))&(0|(A|=0))==(0|(C|=0))|!1|134217728!=(2013265920&A|0)|!1|134217728!=(2013265920&C|0)||(S=0|bt(0|d,0|A,52),De(),S&=15,k=0|bt(0|y,0|C,52),De(),(0|S)!=(15&k|0)))return me=O,0;if(k=S+-1|0,S>>>0>1&&(X=0|Lw(d,A,k),$=0|De(),(0|X)==(0|(k=0|Lw(y,C,k)))&(0|$)==(0|De()))&&(S=0|bt(0|d,0|A,0|(k=3*(15^S)|0)),De(),S&=7,k=0|bt(0|y,0|C,0|k),De(),0==(0|S)|0==(0|(k&=7))||(0|p[21136+(S<<2)>>2])==(0|k)||(0|p[21168+(S<<2)>>2])==(0|k)))return me=O,1;k=(S=T)+56|0;do{p[S>>2]=0,S=S+4|0}while((0|S)<(0|k));return ek(d,A,1,T),S=(0|p[(X=T)>>2])==(0|y)&&(0|p[X+4>>2])==(0|C)||(0|p[(X=T+8|0)>>2])==(0|y)&&(0|p[X+4>>2])==(0|C)||(0|p[(X=T+16|0)>>2])==(0|y)&&(0|p[X+4>>2])==(0|C)||(0|p[(X=T+24|0)>>2])==(0|y)&&(0|p[X+4>>2])==(0|C)||(0|p[(X=T+32|0)>>2])==(0|y)&&(0|p[X+4>>2])==(0|C)||(0|p[(X=T+40|0)>>2])==(0|y)&&(0|p[X+4>>2])==(0|C)?1:1&((0|p[(S=T+48|0)>>2])==(0|y)?(0|p[S+4>>2])==(0|C):0),me=O,0|S}function uv(d,A,y){y|=0;var S,k,T,O,C=0;if(T=me,me=me+16|0,k=T,C=0|bt(0|(d|=0),0|(A|=0),56),De(),-1==(0|(A=0|function(d,A,y){y|=0;var C=0,S=0;return C=0|_o(d|=0,A|=0),(y+-1|0)>>>0>5||1==(0|y)&(S=0!=(0|C))?0|(y=-1):(C=0|function(d,A){var S,k,X,y=0,C=0,T=0,O=0,$=0;if(X=me,me=me+32|0,k=X,y0(d|=0,A|=0,S=X+16|0),T=0|gk(d,A),$=0|ca(d,A),function(d,A){p[(A|=0)>>2]=p[(d=7728+(28*(d|=0)|0)|0)>>2],p[A+4>>2]=p[d+4>>2],p[A+8>>2]=p[d+8>>2],p[A+12>>2]=p[d+12>>2]}(T,k),A=0|function(d,A){d|=0;var y=0,C=0;if((A|=0)>>>0>20)return-1;do{if((0|p[11152+(216*A|0)>>2])!=(0|d))if((0|p[11152+(216*A|0)+8>>2])!=(0|d))if((0|p[11152+(216*A|0)+16>>2])!=(0|d))if((0|p[11152+(216*A|0)+24>>2])!=(0|d))if((0|p[11152+(216*A|0)+32>>2])!=(0|d))if((0|p[11152+(216*A|0)+40>>2])!=(0|d))if((0|p[11152+(216*A|0)+48>>2])!=(0|d))if((0|p[11152+(216*A|0)+56>>2])!=(0|d))if((0|p[11152+(216*A|0)+64>>2])!=(0|d))if((0|p[11152+(216*A|0)+72>>2])!=(0|d))if((0|p[11152+(216*A|0)+80>>2])!=(0|d))if((0|p[11152+(216*A|0)+88>>2])!=(0|d))if((0|p[11152+(216*A|0)+96>>2])!=(0|d))if((0|p[11152+(216*A|0)+104>>2])!=(0|d))if((0|p[11152+(216*A|0)+112>>2])!=(0|d))if((0|p[11152+(216*A|0)+120>>2])!=(0|d))if((0|p[11152+(216*A|0)+128>>2])!=(0|d)){if((0|p[11152+(216*A|0)+136>>2])!=(0|d)){if((0|p[11152+(216*A|0)+144>>2])==(0|d)){d=0,y=2,C=0;break}if((0|p[11152+(216*A|0)+152>>2])==(0|d)){d=0,y=2,C=1;break}if((0|p[11152+(216*A|0)+160>>2])==(0|d)){d=0,y=2,C=2;break}if((0|p[11152+(216*A|0)+168>>2])==(0|d)){d=1,y=2,C=0;break}if((0|p[11152+(216*A|0)+176>>2])==(0|d)){d=1,y=2,C=1;break}if((0|p[11152+(216*A|0)+184>>2])==(0|d)){d=1,y=2,C=2;break}if((0|p[11152+(216*A|0)+192>>2])==(0|d)){d=2,y=2,C=0;break}if((0|p[11152+(216*A|0)+200>>2])==(0|d)){d=2,y=2,C=1;break}if((0|p[11152+(216*A|0)+208>>2])==(0|d)){d=2,y=2,C=2;break}return-1}d=2,y=1,C=2}else d=2,y=1,C=1;else d=2,y=1,C=0;else d=1,y=1,C=2;else d=1,y=1,C=1;else d=1,y=1,C=0;else d=0,y=1,C=2;else d=0,y=1,C=1;else d=0,y=1,C=0;else d=2,y=0,C=2;else d=2,y=0,C=1;else d=2,y=0,C=0;else d=1,y=0,C=2;else d=1,y=0,C=1;else d=1,y=0,C=0;else d=0,y=0,C=2;else d=0,y=0,C=1;else d=0,y=0,C=0}while(0);return 0|p[11152+(216*A|0)+(72*y|0)+(24*d|0)+(C<<3)+4>>2]}(T,0|p[S>>2]),!(0|fi(T)))return me=X,0|A;switch(0|T){case 4:d=0,y=14;break;case 14:d=1,y=14;break;case 24:d=2,y=14;break;case 38:d=3,y=14;break;case 49:d=4,y=14;break;case 58:d=5,y=14;break;case 63:d=6,y=14;break;case 72:d=7,y=14;break;case 83:d=8,y=14;break;case 97:d=9,y=14;break;case 107:d=10,y=14;break;case 117:d=11,y=14;break;default:O=0,C=0}return 14==(0|y)&&(O=0|p[22096+(24*d|0)+8>>2],C=0|p[22096+(24*d|0)+16>>2]),(0|(d=0|p[S>>2]))!=(0|p[k>>2])&&(T=0|Tw(T))|(0|(d=0|p[S>>2]))==(0|C)&&(A=(A+1|0)%6|0),3==(0|$)&(0|d)==(0|C)?(me=X,0|($=(A+5|0)%6|0)):5==(0|$)&(0|d)==(0|O)?(me=X,0|($=(A+1|0)%6|0)):(me=X,0|($=A))}(d,A),S?0|(y=(5-C+(0|p[22384+(y<<2)>>2])|0)%5|0):0|(y=(6-C+(0|p[22416+(y<<2)>>2])|0)%6|0))}(S=(O=!0&268435456==(2013265920&A|0))?d:0,d=O?-2130706433&A|134217728:0,7&C))))return p[y>>2]=0,void(me=T);y0(S,d,k),C=0|bt(0|S,0|d,52),De(),C&=15,0|_o(S,d)?Ak(k,C,A,2,y):pk(k,C,A,2,y),me=T}function Qj(d){d|=0;var A,y,C=0;return(A=0|ec(1,12))||Tr(22691,22646,49,22704),0|(C=0|p[(y=d+4|0)>>2])?(p[(C=C+8|0)>>2]=A,p[y>>2]=A,0|A):(0|p[d>>2]&&Tr(22721,22646,61,22744),p[(C=d)>>2]=A,p[y>>2]=A,0|A)}function Xj(d,A){var y,C;return d|=0,A|=0,(C=0|ru(24))||Tr(22758,22646,78,22772),p[C>>2]=p[A>>2],p[C+4>>2]=p[A+4>>2],p[C+8>>2]=p[A+8>>2],p[C+12>>2]=p[A+12>>2],p[C+16>>2]=0,0|(y=0|p[(A=d+4|0)>>2])?(p[y+16>>2]=C,p[A>>2]=C,0|C):(0|p[d>>2]&&Tr(22787,22646,82,22772),p[d>>2]=C,p[A>>2]=C,0|C)}function bk(d){var pr,ti,A=0,y=0,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,Lt=0,qe=0,gt=0,Ie=0,Nt=0,zt=0,kt=0,Ft=0,In=0,Ir=0,vr=0,jr=0,ni=0,_n=0;if(0|p[(S=8+(d|=0)|0)>>2])return 1;if(!(C=0|p[d>>2]))return 0;A=C,y=0;do{y=y+1|0,A=0|p[A+8>>2]}while(0!=(0|A));if(y>>>0<2)return 0;(ti=0|ru(y<<2))||Tr(22807,22646,317,22826),(pr=0|ru(y<<5))||Tr(22848,22646,321,22826),p[d>>2]=0,p[(zt=d+4|0)>>2]=0,p[S>>2]=0,y=0,jr=0,Nt=0,ye=0;e:for(;;){if(ee=0|p[C>>2]){k=0,T=ee;do{if(A=T,+tr(+(($=+pe[T+8>>3])-(O=+pe[(S=(X=0==(0|(T=0|p[T+16>>2])))?ee:T)+8>>3])))>3.141592653589793){_n=14;break}k+=(O-$)*(+pe[A>>3]+ +pe[S>>3])}while(!X);if(14==(0|_n)){_n=0,k=0,A=ee;do{k+=(+pe[A>>3]+ +pe[(Ir=0==(0|(Ir=0|p[(vr=A+16|0)>>2]))?ee:Ir)>>3])*(((gt=+pe[Ir+8>>3])<0?gt+6.283185307179586:gt)-((Ie=+pe[A+8>>3])<0?Ie+6.283185307179586:Ie)),A=0|p[(0==(0|A)?C:vr)>>2]}while(0!=(0|A))}k>0?(p[ti+(jr<<2)>>2]=C,jr=jr+1|0,S=Nt,A=ye):_n=19}else _n=19;if(19==(0|_n)){_n=0;do{if(!y){if(ye){S=zt,T=ye+8|0,A=C,y=d;break}if(0|p[d>>2]){_n=27;break e}S=zt,T=d,A=C,y=d;break}if(0|p[(A=y+8|0)>>2]){_n=21;break e}if(!(y=0|ec(1,12))){_n=23;break e}p[A>>2]=y,S=y+4|0,T=y,A=ye}while(0);if(p[T>>2]=C,p[S>>2]=C,T=pr+(Nt<<5)|0,X=0|p[C>>2]){for(pe[(ee=pr+(Nt<<5)+8|0)>>3]=17976931348623157e292,pe[(ye=pr+(Nt<<5)+24|0)>>3]=17976931348623157e292,pe[T>>3]=-17976931348623157e292,pe[(Te=pr+(Nt<<5)+16|0)>>3]=-17976931348623157e292,Lt=17976931348623157e292,qe=-17976931348623157e292,S=0,ze=X,$=17976931348623157e292,Ke=17976931348623157e292,wt=-17976931348623157e292,O=-17976931348623157e292;k=+pe[ze>>3],Ie=+pe[ze+8>>3],gt=+pe[((Qe=0==(0|(ze=0|p[ze+16>>2])))?X:ze)+8>>3],k<$&&(pe[ee>>3]=k,$=k),Ie<Ke&&(pe[ye>>3]=Ie,Ke=Ie),k>wt?pe[T>>3]=k:k=wt,Ie>O&&(pe[Te>>3]=Ie,O=Ie),Lt=Ie>0&Ie<Lt?Ie:Lt,qe=Ie<0&Ie>qe?Ie:qe,S|=+tr(+(Ie-gt))>3.141592653589793,!Qe;)wt=k;S&&(pe[Te>>3]=qe,pe[ye>>3]=Lt)}else p[T>>2]=0,p[T+4>>2]=0,p[T+8>>2]=0,p[T+12>>2]=0,p[T+16>>2]=0,p[T+20>>2]=0,p[T+24>>2]=0,p[T+28>>2]=0;S=Nt+1|0}if(C=0|p[(vr=C+8|0)>>2],p[vr>>2]=0,!C){_n=45;break}Nt=S,ye=A}if(21==(0|_n))Tr(22624,22646,35,22658);else if(23==(0|_n))Tr(22678,22646,37,22658);else if(27==(0|_n))Tr(22721,22646,61,22744);else if(45==(0|_n)){e:do{if((0|jr)>0){for(vr=0==(0|S),In=S<<2,Ir=0==(0|d),Ft=0,A=0;;){if(kt=0|p[ti+(Ft<<2)>>2],vr)_n=73;else{if(!(Nt=0|ru(In))){_n=50;break}if(!(zt=0|ru(In))){_n=52;break}t:do{if(Ir)y=0;else{for(S=0,y=0,T=d;0|wk(0|p[T>>2],C=pr+(S<<5)|0,0|p[kt>>2])?(p[Nt+(y<<2)>>2]=T,p[zt+(y<<2)>>2]=C,Qe=y+1|0):Qe=y,T=0|p[T+8>>2];)S=S+1|0,y=Qe;if((0|Qe)>0)if(C=0|p[Nt>>2],1==(0|Qe))y=C;else for(Te=0,ze=-1,y=C,ye=C;;){for(X=0|p[ye>>2],C=0,T=0;ee=(0|(S=0|p[p[Nt+(T<<2)>>2]>>2]))==(0|X)?C:C+(1&(0|wk(S,0|p[zt+(T<<2)>>2],0|p[X>>2])))|0,(0|(T=T+1|0))!=(0|Qe);)C=ee;if(y=(S=(0|ee)>(0|ze))?ye:y,(0|(C=Te+1|0))==(0|Qe))break t;Te=C,ze=S?ee:ze,ye=0|p[Nt+(C<<2)>>2]}else y=0}}while(0);if(On(Nt),On(zt),y){if(C=0|p[(S=y+4|0)>>2])y=C+8|0;else if(0|p[y>>2]){_n=70;break}p[y>>2]=kt,p[S>>2]=kt}else _n=73}if(73==(0|_n)){if(_n=0,0|(A=0|p[kt>>2]))do{zt=A,A=0|p[A+16>>2],On(zt)}while(0!=(0|A));On(kt),A=2}if((0|(Ft=Ft+1|0))>=(0|jr)){ni=A;break e}}50==(0|_n)?Tr(22863,22646,249,22882):52==(0|_n)?Tr(22901,22646,252,22882):70==(0|_n)&&Tr(22721,22646,61,22744)}else ni=0}while(0);return On(ti),On(pr),0|ni}return 0}function wk(d,A,y){d|=0;var C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0;if(!(0|ok(A|=0,y|=0)&&(A=0|ik(A),X=+pe[y>>3],C=+pe[y+8>>3],C=A&C<0?C+6.283185307179586:C,d=0|p[d>>2],d)))return 0;if(A){A=0,y=d;e:for(;;){for(;T=+pe[y>>3],$=+pe[y+8>>3],S=+pe[(ee=0==(0|(ee=0|p[(y=y+16|0)>>2]))?d:ee)+8>>3],T>(k=+pe[ee>>3])?(O=T,T=$):(O=k,k=T,T=S,S=$),X<k|X>O;)if(!(y=0|p[y>>2])){y=22;break e}if(C=(T=T<0?T+6.283185307179586:T)==C|($=S<0?S+6.283185307179586:S)==C?C+-2220446049250313e-31:C,(($+=(X-k)/(O-k)*(T-$))<0?$+6.283185307179586:$)>C&&(A^=1),!(y=0|p[y>>2])){y=22;break}}if(22==(0|y))return 0|A}else{A=0,y=d;e:for(;;){for(;T=+pe[y>>3],$=+pe[y+8>>3],S=+pe[(ee=0==(0|(ee=0|p[(y=y+16|0)>>2]))?d:ee)+8>>3],T>(k=+pe[ee>>3])?(O=T,T=$):(O=k,k=T,T=S,S=$),X<k|X>O;)if(!(y=0|p[y>>2])){y=22;break e}if(S+(X-k)/(O-k)*(T-S)>(C=T==C|S==C?C+-2220446049250313e-31:C)&&(A^=1),!(y=0|p[y>>2])){y=22;break}}if(22==(0|y))return 0|A}return 0}function Ah(d,A,y,C,S){y|=0,C|=0,S|=0;var ye,Te,wt,qe,k=0,T=0,O=0,$=0,X=0,ee=0,ze=0,Qe=0,Ke=0,Lt=0;if(qe=me,me=me+32|0,Lt=qe+16|0,wt=qe,k=0|bt(0|(d|=0),0|(A|=0),52),De(),k&=15,ze=0|bt(0|y,0|C,52),De(),(0|k)!=(15&ze|0))return me=qe,1;if(X=0|bt(0|d,0|A,45),De(),X&=127,ee=0|bt(0|y,0|C,45),De(),ze=(0|X)!=(0|(ee&=127))){if(7==(0|(O=0|kw(X,ee))))return me=qe,2;7==(0|($=0|kw(ee,X)))?Tr(22925,22949,151,22959):(Qe=O,T=$)}else Qe=0,T=0;ye=0|fi(X),Te=0|fi(ee),p[Lt>>2]=0,p[Lt+4>>2]=0,p[Lt+8>>2]=0,p[Lt+12>>2]=0;do{if(Qe){if(O=(0|(ee=0|p[4304+(28*X|0)+(Qe<<2)>>2]))>0,Te)if(O){X=0,$=y,O=C;do{$=0|zj($,O),O=0|De(),1==(0|(T=0|fd(T)))&&(T=0|fd(1)),X=X+1|0}while((0|X)!=(0|ee));ee=T,X=$,$=O}else ee=T,X=y,$=C;else if(O){X=0,$=y,O=C;do{$=0|Nw($,O),O=0|De(),T=0|fd(T),X=X+1|0}while((0|X)!=(0|ee));ee=T,X=$,$=O}else ee=T,X=y,$=C;if(zw(X,$,Lt),ze||Tr(22972,22949,181,22959),(O=0!=(0|ye))&(T=0!=(0|Te))&&Tr(22999,22949,182,22959),O){if(T=0|ca(d,A),0|en[22032+(7*T|0)+Qe>>0]){k=3;break}X=$=0|p[21200+(28*T|0)+(Qe<<2)>>2],Ke=26}else if(T){if(T=0|ca(X,$),0|en[22032+(7*T|0)+ee>>0]){k=4;break}X=0,$=0|p[21200+(28*ee|0)+(T<<2)>>2],Ke=26}else T=0;if(26==(0|Ke))if((0|$)<=-1&&Tr(23030,22949,212,22959),(0|X)<=-1&&Tr(23053,22949,213,22959),(0|$)>0){O=Lt+4|0,T=0;do{cv(O),T=T+1|0}while((0|T)!=(0|$));T=X}else T=X;if(p[wt>>2]=0,p[wt+4>>2]=0,p[wt+8>>2]=0,lk(wt,Qe),0|k)for(;0|dl(k)?lv(wt):YA(wt),(0|k)>1;)k=k+-1|0;if((0|T)>0){k=0;do{cv(wt),k=k+1|0}while((0|k)!=(0|T))}Ls(Ke=Lt+4|0,wt,Ke),us(Ke),Ke=50}else if(zw(y,C,Lt),0!=(0|ye)&0!=(0|Te))if((0|ee)!=(0|X)&&Tr(23077,22949,243,22959),T=0|ca(d,A),k=0|ca(y,C),0|en[22032+(7*T|0)+k>>0])k=5;else if((0|(T=0|p[21200+(28*T|0)+(k<<2)>>2]))>0){O=Lt+4|0,k=0;do{cv(O),k=k+1|0}while((0|k)!=(0|T));Ke=50}else Ke=50;else Ke=50}while(0);return 50==(0|Ke)&&(p[S>>2]=p[(k=Lt+4|0)>>2],p[S+4>>2]=p[k+4>>2],p[S+8>>2]=p[k+8>>2],k=0),me=qe,0|k}function Ck(d,A,y,C){y|=0,C|=0;var ee,Qe,S=0,k=0,T=0,O=0,$=0,X=0,ye=0,Te=0,ze=0,Ke=0,wt=0,Lt=0,qe=0;if(Qe=me,me=me+48|0,T=Qe+36|0,O=Qe+24|0,$=Qe+12|0,X=Qe,k=0|bt(0|(d|=0),0|(A|=0),52),De(),k&=15,Te=0|bt(0|d,0|A,45),De(),ee=0|fi(Te&=127),Ot(0|k,0,52),wt=134225919|De(),p[(Ke=C)>>2]=-1,p[Ke+4>>2]=wt,!k)return(0|p[y>>2])>1||(0|p[y+4>>2])>1||(0|p[y+8>>2])>1||127==(0|(S=0|Iw(Te,0|av(y))))?(me=Qe,0|(wt=1)):(ze=0|Ot(0|S,0,45),Ke=0|De(),Ke|=-1040385&p[(Te=C)+4>>2],p[(wt=C)>>2]=p[Te>>2]|ze,p[wt+4>>2]=Ke,me=Qe,0|(wt=0));for(p[T>>2]=p[y>>2],p[T+4>>2]=p[y+4>>2],p[T+8>>2]=p[y+8>>2];p[O>>2]=p[T>>2],p[O+4>>2]=p[T+4>>2],p[O+8>>2]=p[T+8>>2],0|dl(k)?(ak(T),p[$>>2]=p[T>>2],p[$+4>>2]=p[T+4>>2],p[$+8>>2]=p[T+8>>2],lv($)):(Fw(T),p[$>>2]=p[T>>2],p[$+4>>2]=p[T+4>>2],p[$+8>>2]=p[T+8>>2],YA($)),Rw(O,$,X),us(X),Lt=0|p[(Ke=C)>>2],Ke=0|p[Ke+4>>2],y=0|Ot(7,0,0|(qe=3*(15-k|0)|0)),Ke&=~(0|De()),qe=0|Ot(0|av(X),0,0|qe),Ke=0|De()|Ke,p[(wt=C)>>2]=qe|Lt&~y,p[wt+4>>2]=Ke,(0|k)>1;)k=k+-1|0;e:do{if((0|p[T>>2])<=1&&(0|p[T+4>>2])<=1&&(0|p[T+8>>2])<=1){X=127==(0|(O=0|Iw(Te,k=0|av(T))))?0:0|fi(O);t:do{if(k){if(ee){if(T=21408+(28*(0|ca(d,A))|0)+(k<<2)|0,(0|(T=0|p[T>>2]))>0){y=0;do{k=0|KA(k),y=y+1|0}while((0|y)!=(0|T))}if(1==(0|k)){S=3;break e}127==(0|(y=0|Iw(Te,k)))&&Tr(23104,22949,376,23134),0|fi(y)?Tr(23147,22949,377,23134):(ze=T,ye=k,S=y)}else ze=0,ye=k,S=O;if((0|($=0|p[4304+(28*Te|0)+(ye<<2)>>2]))<=-1&&Tr(23178,22949,384,23134),!X){if((0|ze)<=-1&&Tr(23030,22949,417,23134),0|ze){k=0,y=0|p[(T=C)>>2],T=0|p[T+4>>2];do{y=0|pd(y,T),T=0|De(),p[(qe=C)>>2]=y,p[qe+4>>2]=T,k=k+1|0}while((0|k)<(0|ze))}if((0|$)<=0){k=54;break}for(k=0,y=0|p[(T=C)>>2],T=0|p[T+4>>2];;)if(y=0|pd(y,T),T=0|De(),p[(qe=C)>>2]=y,p[qe+4>>2]=T,(0|(k=k+1|0))==(0|$)){k=54;break t}}if(7==(0|(O=0|kw(S,Te)))&&Tr(22925,22949,393,23134),y=0|p[(k=C)>>2],k=0|p[k+4>>2],(0|$)>0){T=0;do{y=0|pd(y,k),k=0|De(),p[(qe=C)>>2]=y,p[qe+4>>2]=k,T=T+1|0}while((0|T)!=(0|$))}if(y=0|ca(y,k),qe=0|Tw(S),(0|(y=0|p[(qe?21824:21616)+(28*O|0)+(y<<2)>>2]))<=-1&&Tr(23030,22949,412,23134),y){k=0,T=0|p[(O=C)>>2],O=0|p[O+4>>2];do{T=0|Bw(T,O),O=0|De(),p[(qe=C)>>2]=T,p[qe+4>>2]=O,k=k+1|0}while((0|k)<(0|y));k=54}else k=54}else if(0!=(0|ee)&0!=(0|X))if(qe=0|ca(d,A),k=C,k=21408+(28*qe|0)+((0|ca(0|p[k>>2],0|p[k+4>>2]))<<2)|0,k=0|p[k>>2],(0|k)<=-1&&Tr(23201,22949,433,23134),k){S=0,y=0|p[(T=C)>>2],T=0|p[T+4>>2];do{y=0|pd(y,T),T=0|De(),p[(qe=C)>>2]=y,p[qe+4>>2]=T,S=S+1|0}while((0|S)<(0|k));S=O,k=54}else S=O,k=55;else S=O,k=54}while(0);if(54==(0|k)&&X&&(k=55),55==(0|k)&&1==(0|ca(0|p[(qe=C)>>2],0|p[qe+4>>2]))){S=4;break}wt=0|p[(qe=C)>>2],qe=-1040385&p[qe+4>>2],Lt=0|Ot(0|S,0,45),qe=0|qe|De(),p[(S=C)>>2]=wt|Lt,p[S+4>>2]=qe,S=0}else S=2}while(0);return me=Qe,0|S}function hv(d,A){var y=0;if(!(A|=0))return 1;y=d|=0,d=1;do{d=0|dh(0==(1&A|0)?1:y,d),A>>=1,y=0|dh(y,y)}while(0!=(0|A));return 0|d}function Ek(d,A,y){d|=0;var ee,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ye=0,Te=0;if(!(0|ok(A|=0,y|=0))||(A=0|ik(A),Te=+pe[y>>3],C=A&(C=+pe[y+8>>3])<0?C+6.283185307179586:C,(0|(ye=0|p[d>>2]))<=0))return 0;if(ee=0|p[d+4>>2],A){A=0,y=-1,d=0;e:for(;;){for(X=d;$=+pe[ee+(X<<4)+8>>3],S=+pe[ee+((d=(y+2|0)%(0|ye)|0)<<4)+8>>3],(T=+pe[ee+(X<<4)>>3])>(k=+pe[ee+(d<<4)>>3])?(O=T,T=$):(O=k,k=T,T=S,S=$),Te<k|Te>O;){if(!((0|(y=X+1|0))<(0|ye))){y=22;break e}d=X,X=y,y=d}if(C=(T=T<0?T+6.283185307179586:T)==C|($=S<0?S+6.283185307179586:S)==C?C+-2220446049250313e-31:C,(($+=(Te-k)/(O-k)*(T-$))<0?$+6.283185307179586:$)>C&&(A^=1),(0|(d=X+1|0))>=(0|ye)){y=22;break}y=X}if(22==(0|y))return 0|A}else{A=0,y=-1,d=0;e:for(;;){for(X=d;$=+pe[ee+(X<<4)+8>>3],S=+pe[ee+((d=(y+2|0)%(0|ye)|0)<<4)+8>>3],(T=+pe[ee+(X<<4)>>3])>(k=+pe[ee+(d<<4)>>3])?(O=T,T=$):(O=k,k=T,T=S,S=$),Te<k|Te>O;){if(!((0|(y=X+1|0))<(0|ye))){y=22;break e}d=X,X=y,y=d}if(S+(Te-k)/(O-k)*(T-S)>(C=T==C|S==C?C+-2220446049250313e-31:C)&&(A^=1),(0|(d=X+1|0))>=(0|ye)){y=22;break}y=X}if(22==(0|y))return 0|A}return 0}function Uw(d,A){A|=0;var Qe,Ke,wt,Lt,y=0,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,qe=0;if(!(Qe=0|p[(d|=0)>>2]))return p[A>>2]=0,p[A+4>>2]=0,p[A+8>>2]=0,p[A+12>>2]=0,p[A+16>>2]=0,p[A+20>>2]=0,p[A+24>>2]=0,void(p[A+28>>2]=0);if(pe[(Ke=A+8|0)>>3]=17976931348623157e292,pe[(wt=A+24|0)>>3]=17976931348623157e292,pe[A>>3]=-17976931348623157e292,pe[(Lt=A+16|0)>>3]=-17976931348623157e292,!((0|Qe)<=0)){for(Te=0|p[d+4>>2],X=17976931348623157e292,ee=-17976931348623157e292,ye=0,d=-1,k=17976931348623157e292,T=17976931348623157e292,$=-17976931348623157e292,C=-17976931348623157e292,ze=0;O=+pe[Te+(ze<<4)+8>>3],S=+pe[Te+(((0|(d=d+2|0))==(0|Qe)?0:d)<<4)+8>>3],(y=+pe[Te+(ze<<4)>>3])<k&&(pe[Ke>>3]=y,k=y),O<T&&(pe[wt>>3]=O,T=O),y>$?pe[A>>3]=y:y=$,O>C&&(pe[Lt>>3]=O,C=O),X=O>0&O<X?O:X,ee=O<0&O>ee?O:ee,ye|=+tr(+(O-S))>3.141592653589793,(0|(d=ze+1|0))!=(0|Qe);)qe=ze,$=y,ze=d,d=qe;!ye||(pe[Lt>>3]=ee,pe[wt>>3]=X)}}function i7(d,A,y){var C=0,S=0;if(!(0|Ek(d|=0,A|=0,y|=0)))return 0;if((0|p[(S=d+8|0)>>2])<=0)return 1;for(C=d+12|0,d=0;;){if(0|Ek((0|p[C>>2])+(d<<3)|0,A+((d=d+1|0)<<5)|0,y)){d=0,C=6;break}if((0|d)>=(0|p[S>>2])){d=1,C=6;break}}return 6==(0|C)?0|d:0}function Dk(d,A,y,C,S){var T,O,$,X,ee,ye,Te,k=0;pe[(S|=0)>>3]=(X=+pe[(d|=0)>>3])+($=+pe[(A|=0)>>3]-X)*(k=((k=+pe[(C|=0)>>3]-(ye=+pe[(y|=0)>>3]))*((O=+pe[d+8>>3])-(Te=+pe[y+8>>3]))-(X-ye)*(ee=+pe[C+8>>3]-Te))/($*ee-(T=+pe[A+8>>3]-O)*k)),pe[S+8>>3]=O+T*k}function Sk(d,A){return+pe[(d|=0)>>3]!=+pe[(A|=0)>>3]?0|(A=0):0|(A=+pe[d+8>>3]==+pe[A+8>>3])}function ao(d,A){var y,C,S;return+((S=+pe[(d|=0)>>3]-+pe[(A|=0)>>3])*S+(C=+pe[d+8>>3]-+pe[A+8>>3])*C+(y=+pe[d+16>>3]-+pe[A+16>>3])*y)}function Mk(d,A,y){d|=0,y|=0;var C=0;(0|(A|=0))>0?(C=0|ec(A,4),p[d>>2]=C,C||Tr(23230,23253,40,23267)):p[d>>2]=0,p[d+4>>2]=A,p[d+8>>2]=0,p[d+12>>2]=y}function Tk(d){var S,k,T,A=0,y=0,C=0,O=0;S=4+(d|=0)|0,k=d+12|0,T=d+8|0;e:for(;;){for(y=0|p[S>>2],A=0;;){if((0|A)>=(0|y))break e;if(O=0|p[(C=0|p[d>>2])+(A<<2)>>2])break;A=A+1|0}A=C+(~~(+tr(+ +hh(10,+ +(15-(0|p[k>>2])|0))*(+pe[O>>3]+ +pe[O+8>>3]))%+(0|y))>>>0<<2)|0,y=0|p[A>>2];t:do{if(0|y){if(C=O+32|0,(0|y)==(0|O))p[A>>2]=p[C>>2];else{if(!(A=0|p[(y=y+32|0)>>2]))break;for(;(0|A)!=(0|O);)if(!(A=0|p[(y=A+32|0)>>2]))break t;p[y>>2]=p[C>>2]}On(O),p[T>>2]=(0|p[T>>2])-1}}while(0)}On(0|p[d>>2])}function Ik(d){var C,A=0,y=0;for(C=0|p[4+(d|=0)>>2],y=0;;){if((0|y)>=(0|C)){A=0,y=4;break}if(A=0|p[(0|p[d>>2])+(y<<2)>>2]){y=4;break}y=y+1|0}return 4==(0|y)?0|A:0}function kk(d,A){A|=0;var y=0,C=0,S=0,k=0;if(y=~~(+tr(+ +hh(10,+ +(15-(0|p[12+(d|=0)>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|p[d+4>>2]))>>>0,!(C=0|p[(y=(0|p[d>>2])+(y<<2)|0)>>2]))return 1;k=A+32|0;do{if((0|C)!=(0|A)){if(!(y=0|p[C+32>>2]))return 1;for(S=y;;){if((0|S)==(0|A)){S=8;break}if(!(y=0|p[S+32>>2])){y=1,S=10;break}C=S,S=y}if(8==(0|S)){p[C+32>>2]=p[k>>2];break}if(10==(0|S))return 0|y}else p[y>>2]=p[k>>2]}while(0);return On(A),p[(k=d+8|0)>>2]=(0|p[k>>2])-1,0}function m7(d,A,y){d|=0,A|=0,y|=0;var k,C=0,S=0,T=0;(k=0|ru(40))||Tr(23283,23253,98,23296),p[k>>2]=p[A>>2],p[k+4>>2]=p[A+4>>2],p[k+8>>2]=p[A+8>>2],p[k+12>>2]=p[A+12>>2],p[(S=k+16|0)>>2]=p[y>>2],p[S+4>>2]=p[y+4>>2],p[S+8>>2]=p[y+8>>2],p[S+12>>2]=p[y+12>>2],p[k+32>>2]=0,S=~~(+tr(+ +hh(10,+ +(15-(0|p[d+12>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|p[d+4>>2]))>>>0,C=0|p[(S=(0|p[d>>2])+(S<<2)|0)>>2];do{if(C){for(;!(0|Wp(C,A)&&0|Wp(C+16|0,y));)if(!(0|p[(C=0==(0|(S=0|p[C+32>>2]))?C:S)+32>>2])){T=10;break}if(10==(0|T)){p[C+32>>2]=k;break}return On(k),0|C}p[S>>2]=k}while(0);return p[(T=d+8|0)>>2]=1+(0|p[T>>2]),0|k}function g7(d,A,y){A|=0,y|=0;var C=0,S=0;if(S=~~(+tr(+ +hh(10,+ +(15-(0|p[12+(d|=0)>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|p[d+4>>2]))>>>0,!(S=0|p[(0|p[d>>2])+(S<<2)>>2]))return 0;if(!y){for(d=S;;){if(0|Wp(d,A)){C=10;break}if(!(d=0|p[d+32>>2])){d=0,C=10;break}}if(10==(0|C))return 0|d}for(d=S;;){if(0|Wp(d,A)&&0|Wp(d+16|0,y)){C=10;break}if(!(d=0|p[d+32>>2])){d=0,C=10;break}}return 10==(0|C)?0|d:0}function _7(d,A){A|=0;var y=0;if(y=~~(+tr(+ +hh(10,+ +(15-(0|p[12+(d|=0)>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|p[d+4>>2]))>>>0,!(d=0|p[(0|p[d>>2])+(y<<2)>>2]))return 0;for(;;){if(0|Wp(d,A)){A=5;break}if(!(d=0|p[d+32>>2])){d=0,A=5;break}}return 5==(0|A)?0|d:0}function dv(d){return 0|~~+function(d){return+ +Fk(+(d=+d))}(d=+d)}function ru(d){d|=0;var Nt,A=0,y=0,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,Lt=0,qe=0,gt=0,Ie=0;Nt=me,me=me+16|0,Te=Nt;do{if(d>>>0<245){if(3&(y=(ye=0|p[5829])>>>(d=(X=d>>>0<11?16:d+11&-8)>>>3))|0)return(0|(k=0|p[(S=8+(C=0|p[(y=8+(d=23356+((A=(1&y^1)+d|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|d)?p[5829]=ye&~(1<<A):(p[k+12>>2]=d,p[y>>2]=k),p[C+4>>2]=3|(Ie=A<<3),p[(Ie=C+Ie+4|0)>>2]=1|p[Ie>>2],me=Nt,0|S;if(X>>>0>(ee=0|p[5831])>>>0){if(0|y)return A=((A=y<<d&((A=2<<d)|0-A))&0-A)-1|0,(0|(y=0|p[(O=8+(k=0|p[(d=8+(A=23356+((C=((y=(A>>>=O=A>>>12&16)>>>5&8)|O|(k=(A>>>=y)>>>2&4)|(d=(A>>>=k)>>>1&2)|(C=(A>>>=d)>>>1&1))+(A>>>C)|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|A)?p[5829]=d=ye&~(1<<C):(p[y+12>>2]=A,p[d>>2]=y,d=ye),T=(Ie=C<<3)-X|0,p[k+4>>2]=3|X,p[4+(S=k+X|0)>>2]=1|T,p[k+Ie>>2]=T,0|ee&&(C=0|p[5834],y=23356+((A=ee>>>3)<<1<<2)|0,d&(A=1<<A)?A=0|p[(d=y+8|0)>>2]:(p[5829]=d|A,A=y,d=y+8|0),p[d>>2]=C,p[A+12>>2]=C,p[C+8>>2]=A,p[C+12>>2]=y),p[5831]=T,p[5834]=S,me=Nt,0|O;if(k=0|p[5830]){for(y=(k&0-k)-1|0,y=$=0|p[23620+(((C=(y>>>=S=y>>>12&16)>>>5&8)|S|(T=(y>>>=C)>>>2&4)|(O=(y>>>=T)>>>1&2)|($=(y>>>=O)>>>1&1))+(y>>>$)<<2)>>2],O=$,$=(-8&p[$+4>>2])-X|0;(d=0|p[y+16>>2])||(d=0|p[y+20>>2]);)y=d,O=(S=(T=(-8&p[d+4>>2])-X|0)>>>0<$>>>0)?d:O,$=S?T:$;if((T=O+X|0)>>>0>O>>>0){S=0|p[O+24>>2],A=0|p[O+12>>2];do{if((0|A)==(0|O)){if(!(A=0|p[(d=O+20|0)>>2])&&!(A=0|p[(d=O+16|0)>>2])){y=0;break}for(;;)if(y=0|p[(C=A+20|0)>>2])A=y,d=C;else{if(!(y=0|p[(C=A+16|0)>>2]))break;A=y,d=C}p[d>>2]=0,y=A}else p[12+(y=0|p[O+8>>2])>>2]=A,p[A+8>>2]=y,y=A}while(0);do{if(0|S){if((0|O)==(0|p[(d=23620+((A=0|p[O+28>>2])<<2)|0)>>2])){if(p[d>>2]=y,!y){p[5830]=k&~(1<<A);break}}else if(p[((0|p[(Ie=S+16|0)>>2])==(0|O)?Ie:S+20|0)>>2]=y,!y)break;p[y+24>>2]=S,0|(A=0|p[O+16>>2])&&(p[y+16>>2]=A,p[A+24>>2]=y),0|(A=0|p[O+20>>2])&&(p[y+20>>2]=A,p[A+24>>2]=y)}}while(0);return $>>>0<16?(p[O+4>>2]=3|(Ie=$+X|0),p[(Ie=O+Ie+4|0)>>2]=1|p[Ie>>2]):(p[O+4>>2]=3|X,p[T+4>>2]=1|$,p[T+$>>2]=$,0|ee&&(C=0|p[5834],y=23356+((A=ee>>>3)<<1<<2)|0,(A=1<<A)&ye?A=0|p[(d=y+8|0)>>2]:(p[5829]=A|ye,A=y,d=y+8|0),p[d>>2]=C,p[A+12>>2]=C,p[C+8>>2]=A,p[C+12>>2]=y),p[5831]=$,p[5834]=T),me=Nt,0|O+8}ye=X}else ye=X}else ye=X}else if(d>>>0<=4294967231)if(X=-8&(d=d+11|0),C=0|p[5830]){S=0-X|0,$=(d>>>=8)?X>>>0>16777215?31:X>>>(7+($=14-((O=(520192+(Ke=d<<(ye=(d+1048320|0)>>>16&8))|0)>>>16&4)|ye|($=(245760+(Ke<<=O)|0)>>>16&2))+(Ke<<$>>>15)|0)|0)&1|$<<1:0,y=0|p[23620+($<<2)>>2];e:do{if(y)for(d=0,O=X<<(31==(0|$)?0:25-($>>>1)|0),k=0;;){if((T=(-8&p[y+4>>2])-X|0)>>>0<S>>>0){if(!T){d=y,S=0,Ke=65;break e}d=y,S=T}if(k=0==(0|(Ke=0|p[y+20>>2]))|(0|Ke)==(0|(y=0|p[y+16+(O>>>31<<2)>>2]))?k:Ke,!y){y=k,Ke=61;break}O<<=1}else y=0,d=0,Ke=61}while(0);if(61==(0|Ke)){if(0==(0|y)&0==(0|d)){if(!(d=((d=2<<$)|0-d)&C)){ye=X;break}ye=(d&0-d)-1|0,d=0,y=0|p[23620+(((k=(ye>>>=T=ye>>>12&16)>>>5&8)|T|(O=(ye>>>=k)>>>2&4)|($=(ye>>>=O)>>>1&2)|(y=(ye>>>=$)>>>1&1))+(ye>>>y)<<2)>>2]}y?Ke=65:(O=d,T=S)}if(65==(0|Ke))for(k=y;;){if(S=(y=(ye=(-8&p[k+4>>2])-X|0)>>>0<S>>>0)?ye:S,d=y?k:d,(y=0|p[k+16>>2])||(y=0|p[k+20>>2]),!y){O=d,T=S;break}k=y}if(0!=(0|O)&&T>>>0<((0|p[5831])-X|0)>>>0&&(ee=O+X|0)>>>0>O>>>0){k=0|p[O+24>>2],A=0|p[O+12>>2];do{if((0|A)==(0|O)){if(!(A=0|p[(d=O+20|0)>>2])&&!(A=0|p[(d=O+16|0)>>2])){A=0;break}for(;;)if(y=0|p[(S=A+20|0)>>2])A=y,d=S;else{if(!(y=0|p[(S=A+16|0)>>2]))break;A=y,d=S}p[d>>2]=0}else p[12+(Ie=0|p[O+8>>2])>>2]=A,p[A+8>>2]=Ie}while(0);do{if(k){if((0|O)==(0|p[(y=23620+((d=0|p[O+28>>2])<<2)|0)>>2])){if(p[y>>2]=A,!A){p[5830]=C&=~(1<<d);break}}else if(p[((0|p[(Ie=k+16|0)>>2])==(0|O)?Ie:k+20|0)>>2]=A,!A)break;p[A+24>>2]=k,0|(d=0|p[O+16>>2])&&(p[A+16>>2]=d,p[d+24>>2]=A),(d=0|p[O+20>>2])&&(p[A+20>>2]=d,p[d+24>>2]=A)}}while(0);e:do{if(T>>>0<16)Ie=T+X|0,p[O+4>>2]=3|Ie,Ie=O+Ie+4|0,p[Ie>>2]=1|p[Ie>>2];else{if(p[O+4>>2]=3|X,p[ee+4>>2]=1|T,p[ee+T>>2]=T,A=T>>>3,T>>>0<256){y=23356+(A<<1<<2)|0,(d=0|p[5829])&(A=1<<A)?A=0|p[(d=y+8|0)>>2]:(p[5829]=d|A,A=y,d=y+8|0),p[d>>2]=ee,p[A+12>>2]=ee,p[ee+8>>2]=A,p[ee+12>>2]=y;break}if(y=(A=T>>>8)?T>>>0>16777215?31:T>>>(7+(y=14-((qe=(520192+(Ie=A<<(gt=(A+1048320|0)>>>16&8))|0)>>>16&4)|gt|(y=(245760+(Ie<<=qe)|0)>>>16&2))+(Ie<<y>>>15)|0)|0)&1|y<<1:0,A=23620+(y<<2)|0,p[ee+28>>2]=y,p[4+(d=ee+16|0)>>2]=0,p[d>>2]=0,!(C&(d=1<<y))){p[5830]=C|d,p[A>>2]=ee,p[ee+24>>2]=A,p[ee+12>>2]=ee,p[ee+8>>2]=ee;break}A=0|p[A>>2];t:do{if((-8&p[A+4>>2]|0)!=(0|T)){for(C=T<<(31==(0|y)?0:25-(y>>>1)|0);d=0|p[(y=A+16+(C>>>31<<2)|0)>>2];){if((-8&p[d+4>>2]|0)==(0|T)){A=d;break t}C<<=1,A=d}p[y>>2]=ee,p[ee+24>>2]=A,p[ee+12>>2]=ee,p[ee+8>>2]=ee;break e}}while(0);p[12+(Ie=0|p[(gt=A+8|0)>>2])>>2]=ee,p[gt>>2]=ee,p[ee+8>>2]=Ie,p[ee+12>>2]=A,p[ee+24>>2]=0}}while(0);return me=Nt,0|O+8}ye=X}else ye=X;else ye=-1}while(0);if((y=0|p[5831])>>>0>=ye>>>0)return d=0|p[5834],(A=y-ye|0)>>>0>15?(p[5834]=Ie=d+ye|0,p[5831]=A,p[Ie+4>>2]=1|A,p[d+y>>2]=A,p[d+4>>2]=3|ye):(p[5831]=0,p[5834]=0,p[d+4>>2]=3|y,p[(Ie=d+y+4|0)>>2]=1|p[Ie>>2]),me=Nt,0|d+8;if((T=0|p[5832])>>>0>ye>>>0)return p[5832]=qe=T-ye|0,p[5835]=gt=(Ie=0|p[5835])+ye|0,p[gt+4>>2]=1|qe,p[Ie+4>>2]=3|ye,me=Nt,0|Ie+8;if(0|p[5947]?d=0|p[5949]:(p[5949]=4096,p[5948]=4096,p[5950]=-1,p[5951]=-1,p[5952]=0,p[5940]=0,p[5947]=-16&Te^1431655768,d=4096),O=ye+48|0,(X=(k=d+($=ye+47|0)|0)&(S=0-d|0))>>>0<=ye>>>0||0|(d=0|p[5939])&&(Te=(ee=0|p[5937])+X|0)>>>0<=ee>>>0|Te>>>0>d>>>0)return me=Nt,0;e:do{if(4&p[5940])A=0,Ke=143;else{y=0|p[5835];t:do{if(y){for(C=23764;!((Te=0|p[C>>2])>>>0<=y>>>0&&(Te+(0|p[C+4>>2])|0)>>>0>y>>>0);){if(!(d=0|p[C+8>>2])){Ke=128;break t}C=d}if((A=k-T&S)>>>0<2147483647)if((0|(d=0|gd(0|A)))==((0|p[C>>2])+(0|p[C+4>>2])|0)){if(-1!=(0|d)){T=A,k=d,Ke=145;break e}}else C=d,Ke=136;else A=0}else Ke=128}while(0);do{if(128==(0|Ke))if(-1!=(0|(y=0|gd(0)))&&(Qe=(A=(0==((Qe=(ze=0|p[5948])-1|0)&(A=y)|0)?0:(Qe+A&0-ze)-A|0)+X|0)+(ze=0|p[5937])|0,A>>>0>ye>>>0&A>>>0<2147483647)){if(0|(Te=0|p[5939])&&Qe>>>0<=ze>>>0|Qe>>>0>Te>>>0){A=0;break}if((0|(d=0|gd(0|A)))==(0|y)){T=A,k=y,Ke=145;break e}C=d,Ke=136}else A=0}while(0);do{if(136==(0|Ke)){if(y=0-A|0,!(O>>>0>A>>>0&A>>>0<2147483647&-1!=(0|C))){if(-1==(0|C)){A=0;break}T=A,k=C,Ke=145;break e}if((d=$-A+(d=0|p[5949])&0-d)>>>0>=2147483647){T=A,k=C,Ke=145;break e}if(-1==(0|gd(0|d))){gd(0|y),A=0;break}T=d+A|0,k=C,Ke=145;break e}}while(0);p[5940]=4|p[5940],Ke=143}}while(0);if((143==(0|Ke)&&X>>>0<2147483647?!(-1==(0|(qe=0|gd(0|X)))|1^(Lt=(wt=(Qe=0|gd(0))-qe|0)>>>0>(ye+40|0)>>>0)|qe>>>0<Qe>>>0&-1!=(0|qe)&-1!=(0|Qe)^1):0)&&(T=Lt?wt:A,k=qe,Ke=145),145==(0|Ke)){p[5937]=A=(0|p[5937])+T|0,A>>>0>(0|p[5938])>>>0&&(p[5938]=A),$=0|p[5835];e:do{if($){for(A=23764;;){if((0|k)==((d=0|p[A>>2])+(y=0|p[A+4>>2])|0)){Ke=154;break}if(!(C=0|p[A+8>>2]))break;A=C}if(154==(0|Ke)&&(gt=A+4|0,0==(8&p[A+12>>2]|0))&&k>>>0>$>>>0&d>>>0<=$>>>0){p[gt>>2]=y+T,gt=$+(qe=0==(7&(qe=$+8|0)|0)?0:0-qe&7)|0,qe=(Ie=(0|p[5832])+T|0)-qe|0,p[5835]=gt,p[5832]=qe,p[gt+4>>2]=1|qe,p[$+Ie+4>>2]=40,p[5836]=p[5951];break}for(k>>>0<(0|p[5833])>>>0&&(p[5833]=k),y=k+T|0,A=23764;;){if((0|p[A>>2])==(0|y)){Ke=162;break}if(!(d=0|p[A+8>>2]))break;A=d}if(162==(0|Ke)&&0==(8&p[A+12>>2]|0)){p[A>>2]=k,p[(ee=A+4|0)>>2]=(0|p[ee>>2])+T,X=(ee=k+(0==(7&(ee=k+8|0)|0)?0:0-ee&7)|0)+ye|0,O=(A=y+(0==(7&(A=y+8|0)|0)?0:0-A&7)|0)-ee-ye|0,p[ee+4>>2]=3|ye;t:do{if((0|$)==(0|A))Ie=(0|p[5832])+O|0,p[5832]=Ie,p[5835]=X,p[X+4>>2]=1|Ie;else{if((0|p[5834])==(0|A)){p[5831]=Ie=(0|p[5831])+O|0,p[5834]=X,p[X+4>>2]=1|Ie,p[X+Ie>>2]=Ie;break}if(1==(3&(d=0|p[A+4>>2])|0)){T=-8&d,C=d>>>3;n:do{if(d>>>0<256){if((0|(y=0|p[A+12>>2]))==(0|(d=0|p[A+8>>2]))){p[5829]=p[5829]&~(1<<C);break}p[d+12>>2]=y,p[y+8>>2]=d;break}k=0|p[A+24>>2],d=0|p[A+12>>2];do{if((0|d)==(0|A)){if(d=0|p[(C=4+(y=A+16|0)|0)>>2])y=C;else if(!(d=0|p[y>>2])){d=0;break}for(;;)if(C=0|p[(S=d+20|0)>>2])d=C,y=S;else{if(!(C=0|p[(S=d+16|0)>>2]))break;d=C,y=S}p[y>>2]=0}else p[12+(Ie=0|p[A+8>>2])>>2]=d,p[d+8>>2]=Ie}while(0);if(!k)break;C=23620+((y=0|p[A+28>>2])<<2)|0;do{if((0|p[C>>2])==(0|A)){if(p[C>>2]=d,0|d)break;p[5830]=p[5830]&~(1<<y);break n}if(p[((0|p[(Ie=k+16|0)>>2])==(0|A)?Ie:k+20|0)>>2]=d,!d)break n}while(0);if(p[d+24>>2]=k,0|(C=0|p[(y=A+16|0)>>2])&&(p[d+16>>2]=C,p[C+24>>2]=d),!(y=0|p[y+4>>2]))break;p[d+20>>2]=y,p[y+24>>2]=d}while(0);A=A+T|0,S=T+O|0}else S=O;if(p[(A=A+4|0)>>2]=-2&p[A>>2],p[X+4>>2]=1|S,p[X+S>>2]=S,A=S>>>3,S>>>0<256){y=23356+(A<<1<<2)|0,(d=0|p[5829])&(A=1<<A)?A=0|p[(d=y+8|0)>>2]:(p[5829]=d|A,A=y,d=y+8|0),p[d>>2]=X,p[A+12>>2]=X,p[X+8>>2]=A,p[X+12>>2]=y;break}A=S>>>8;do{if(A){if(S>>>0>16777215){C=31;break}C=S>>>(7+(C=14-((qe=(520192+(Ie=A<<(gt=(A+1048320|0)>>>16&8))|0)>>>16&4)|gt|(C=(245760+(Ie<<=qe)|0)>>>16&2))+(Ie<<C>>>15)|0)|0)&1|C<<1}else C=0}while(0);if(A=23620+(C<<2)|0,p[X+28>>2]=C,p[4+(d=X+16|0)>>2]=0,p[d>>2]=0,!((d=0|p[5830])&(y=1<<C))){p[5830]=d|y,p[A>>2]=X,p[X+24>>2]=A,p[X+12>>2]=X,p[X+8>>2]=X;break}A=0|p[A>>2];n:do{if((-8&p[A+4>>2]|0)!=(0|S)){for(C=S<<(31==(0|C)?0:25-(C>>>1)|0);d=0|p[(y=A+16+(C>>>31<<2)|0)>>2];){if((-8&p[d+4>>2]|0)==(0|S)){A=d;break n}C<<=1,A=d}p[y>>2]=X,p[X+24>>2]=A,p[X+12>>2]=X,p[X+8>>2]=X;break t}}while(0);p[12+(Ie=0|p[(gt=A+8|0)>>2])>>2]=X,p[gt>>2]=X,p[X+8>>2]=Ie,p[X+12>>2]=A,p[X+24>>2]=0}}while(0);return me=Nt,0|ee+8}for(A=23764;!((d=0|p[A>>2])>>>0<=$>>>0&&(Ie=d+(0|p[A+4>>2])|0,Ie>>>0>$>>>0));)A=0|p[A+8>>2];A=(d=(d=(S=Ie+-47|0)+(0==(7&(d=S+8|0)|0)?0:0-d&7)|0)>>>0<(S=$+16|0)>>>0?$:d)+8|0,gt=k+(qe=0==(7&(qe=k+8|0)|0)?0:0-qe&7)|0,qe=(y=T+-40|0)-qe|0,p[5835]=gt,p[5832]=qe,p[gt+4>>2]=1|qe,p[k+y+4>>2]=40,p[5836]=p[5951],p[(y=d+4|0)>>2]=27,p[A>>2]=p[5941],p[A+4>>2]=p[5942],p[A+8>>2]=p[5943],p[A+12>>2]=p[5944],p[5941]=k,p[5942]=T,p[5944]=0,p[5943]=A,A=d+24|0;do{gt=A,p[(A=A+4|0)>>2]=7}while((gt+8|0)>>>0<Ie>>>0);if((0|d)!=(0|$)){if(k=d-$|0,p[y>>2]=-2&p[y>>2],p[$+4>>2]=1|k,p[d>>2]=k,A=k>>>3,k>>>0<256){y=23356+(A<<1<<2)|0,(d=0|p[5829])&(A=1<<A)?A=0|p[(d=y+8|0)>>2]:(p[5829]=d|A,A=y,d=y+8|0),p[d>>2]=$,p[A+12>>2]=$,p[$+8>>2]=A,p[$+12>>2]=y;break}if(y=23620+((C=(A=k>>>8)?k>>>0>16777215?31:k>>>(7+(C=14-((qe=(520192+(Ie=A<<(gt=(A+1048320|0)>>>16&8))|0)>>>16&4)|gt|(C=(245760+(Ie<<=qe)|0)>>>16&2))+(Ie<<C>>>15)|0)|0)&1|C<<1:0)<<2)|0,p[$+28>>2]=C,p[$+20>>2]=0,p[S>>2]=0,!((A=0|p[5830])&(d=1<<C))){p[5830]=A|d,p[y>>2]=$,p[$+24>>2]=y,p[$+12>>2]=$,p[$+8>>2]=$;break}A=0|p[y>>2];t:do{if((-8&p[A+4>>2]|0)!=(0|k)){for(C=k<<(31==(0|C)?0:25-(C>>>1)|0);d=0|p[(y=A+16+(C>>>31<<2)|0)>>2];){if((-8&p[d+4>>2]|0)==(0|k)){A=d;break t}C<<=1,A=d}p[y>>2]=$,p[$+24>>2]=A,p[$+12>>2]=$,p[$+8>>2]=$;break e}}while(0);p[12+(Ie=0|p[(gt=A+8|0)>>2])>>2]=$,p[gt>>2]=$,p[$+8>>2]=Ie,p[$+12>>2]=A,p[$+24>>2]=0}}else Ie=0|p[5833],0==(0|Ie)|k>>>0<Ie>>>0&&(p[5833]=k),p[5941]=k,p[5942]=T,p[5944]=0,p[5838]=p[5947],p[5837]=-1,p[5842]=23356,p[5841]=23356,p[5844]=23364,p[5843]=23364,p[5846]=23372,p[5845]=23372,p[5848]=23380,p[5847]=23380,p[5850]=23388,p[5849]=23388,p[5852]=23396,p[5851]=23396,p[5854]=23404,p[5853]=23404,p[5856]=23412,p[5855]=23412,p[5858]=23420,p[5857]=23420,p[5860]=23428,p[5859]=23428,p[5862]=23436,p[5861]=23436,p[5864]=23444,p[5863]=23444,p[5866]=23452,p[5865]=23452,p[5868]=23460,p[5867]=23460,p[5870]=23468,p[5869]=23468,p[5872]=23476,p[5871]=23476,p[5874]=23484,p[5873]=23484,p[5876]=23492,p[5875]=23492,p[5878]=23500,p[5877]=23500,p[5880]=23508,p[5879]=23508,p[5882]=23516,p[5881]=23516,p[5884]=23524,p[5883]=23524,p[5886]=23532,p[5885]=23532,p[5888]=23540,p[5887]=23540,p[5890]=23548,p[5889]=23548,p[5892]=23556,p[5891]=23556,p[5894]=23564,p[5893]=23564,p[5896]=23572,p[5895]=23572,p[5898]=23580,p[5897]=23580,p[5900]=23588,p[5899]=23588,p[5902]=23596,p[5901]=23596,p[5904]=23604,p[5903]=23604,Ie=T+-40|0,qe=k+8|0,qe=0==(7&qe|0)?0:0-qe&7,gt=k+qe|0,qe=Ie-qe|0,p[5835]=gt,p[5832]=qe,p[gt+4>>2]=1|qe,p[k+Ie+4>>2]=40,p[5836]=p[5951]}while(0);if((A=0|p[5832])>>>0>ye>>>0)return p[5832]=qe=A-ye|0,p[5835]=gt=(Ie=0|p[5835])+ye|0,p[gt+4>>2]=1|qe,p[Ie+4>>2]=3|ye,me=Nt,0|Ie+8}return p[(Ie=23312)>>2]=12,me=Nt,0}function On(d){var A=0,y=0,C=0,S=0,k=0,T=0,O=0,$=0;if(d|=0){S=0|p[5833],$=(y=d+-8|0)+(A=-8&(d=0|p[d+-4>>2]))|0;do{if(1&d)O=y,T=y;else{if(C=0|p[y>>2],!(3&d)||(k=C+A|0,(T=y+(0-C)|0)>>>0<S>>>0))return;if((0|p[5834])==(0|T)){if(3!=(3&(A=0|p[(d=$+4|0)>>2])|0)){O=T,A=k;break}return p[5831]=k,p[d>>2]=-2&A,p[T+4>>2]=1|k,void(p[T+k>>2]=k)}if(y=C>>>3,C>>>0<256){if((0|(A=0|p[T+12>>2]))==(0|(d=0|p[T+8>>2]))){p[5829]=p[5829]&~(1<<y),O=T,A=k;break}p[d+12>>2]=A,p[A+8>>2]=d,O=T,A=k;break}S=0|p[T+24>>2],d=0|p[T+12>>2];do{if((0|d)==(0|T)){if(d=0|p[(y=4+(A=T+16|0)|0)>>2])A=y;else if(!(d=0|p[A>>2])){d=0;break}for(;;)if(y=0|p[(C=d+20|0)>>2])d=y,A=C;else{if(!(y=0|p[(C=d+16|0)>>2]))break;d=y,A=C}p[A>>2]=0}else p[12+(O=0|p[T+8>>2])>>2]=d,p[d+8>>2]=O}while(0);if(S){if((0|p[(y=23620+((A=0|p[T+28>>2])<<2)|0)>>2])==(0|T)){if(p[y>>2]=d,!d){p[5830]=p[5830]&~(1<<A),O=T,A=k;break}}else if(p[((0|p[(O=S+16|0)>>2])==(0|T)?O:S+20|0)>>2]=d,!d){O=T,A=k;break}p[d+24>>2]=S,0|(y=0|p[(A=T+16|0)>>2])&&(p[d+16>>2]=y,p[y+24>>2]=d),(A=0|p[A+4>>2])?(p[d+20>>2]=A,p[A+24>>2]=d,O=T,A=k):(O=T,A=k)}else O=T,A=k}}while(0);if(!(T>>>0>=$>>>0)&&1&(C=0|p[(d=$+4|0)>>2])){if(2&C)p[d>>2]=-2&C,p[O+4>>2]=1|A,p[T+A>>2]=A,S=A;else{if((0|p[5835])==(0|$)){if(p[5832]=$=(0|p[5832])+A|0,p[5835]=O,p[O+4>>2]=1|$,(0|O)!=(0|p[5834]))return;return p[5834]=0,void(p[5831]=0)}if((0|p[5834])==(0|$))return p[5831]=$=(0|p[5831])+A|0,p[5834]=T,p[O+4>>2]=1|$,void(p[T+$>>2]=$);S=(-8&C)+A|0,y=C>>>3;do{if(C>>>0<256){if((0|(d=0|p[$+12>>2]))==(0|(A=0|p[$+8>>2]))){p[5829]=p[5829]&~(1<<y);break}p[A+12>>2]=d,p[d+8>>2]=A;break}k=0|p[$+24>>2],d=0|p[$+12>>2];do{if((0|d)==(0|$)){if(d=0|p[(y=4+(A=$+16|0)|0)>>2])A=y;else if(!(d=0|p[A>>2])){y=0;break}for(;;)if(y=0|p[(C=d+20|0)>>2])d=y,A=C;else{if(!(y=0|p[(C=d+16|0)>>2]))break;d=y,A=C}p[A>>2]=0,y=d}else p[12+(y=0|p[$+8>>2])>>2]=d,p[d+8>>2]=y,y=d}while(0);if(0|k){if((0|p[(A=23620+((d=0|p[$+28>>2])<<2)|0)>>2])==(0|$)){if(p[A>>2]=y,!y){p[5830]=p[5830]&~(1<<d);break}}else if(p[((0|p[(C=k+16|0)>>2])==(0|$)?C:k+20|0)>>2]=y,!y)break;p[y+24>>2]=k,0|(A=0|p[(d=$+16|0)>>2])&&(p[y+16>>2]=A,p[A+24>>2]=y),0|(d=0|p[d+4>>2])&&(p[y+20>>2]=d,p[d+24>>2]=y)}}while(0);if(p[O+4>>2]=1|S,p[T+S>>2]=S,(0|O)==(0|p[5834]))return void(p[5831]=S)}if(d=S>>>3,S>>>0<256)return y=23356+(d<<1<<2)|0,(A=0|p[5829])&(d=1<<d)?d=0|p[(A=y+8|0)>>2]:(p[5829]=A|d,d=y,A=y+8|0),p[A>>2]=O,p[d+12>>2]=O,p[O+8>>2]=d,void(p[O+12>>2]=y);C=(d=S>>>8)?S>>>0>16777215?31:S>>>(7+(C=14-((k=(520192+($=d<<(T=(d+1048320|0)>>>16&8))|0)>>>16&4)|T|(C=(245760+($<<=k)|0)>>>16&2))+($<<C>>>15)|0)|0)&1|C<<1:0,d=23620+(C<<2)|0,p[O+28>>2]=C,p[O+20>>2]=0,p[O+16>>2]=0,A=0|p[5830],y=1<<C;e:do{if(A&y){d=0|p[d>>2];t:do{if((-8&p[d+4>>2]|0)!=(0|S)){for(C=S<<(31==(0|C)?0:25-(C>>>1)|0);A=0|p[(y=d+16+(C>>>31<<2)|0)>>2];){if((-8&p[A+4>>2]|0)==(0|S)){d=A;break t}C<<=1,d=A}p[y>>2]=O,p[O+24>>2]=d,p[O+12>>2]=O,p[O+8>>2]=O;break e}}while(0);p[12+($=0|p[(T=d+8|0)>>2])>>2]=O,p[T>>2]=O,p[O+8>>2]=$,p[O+12>>2]=d,p[O+24>>2]=0}else p[5830]=A|y,p[d>>2]=O,p[O+24>>2]=d,p[O+12>>2]=O,p[O+8>>2]=O}while(0);if(p[5837]=$=(0|p[5837])-1|0,!(0|$)){for(d=23772;d=0|p[d>>2];)d=d+8|0;p[5837]=-1}}}}function ec(d,A){A|=0;var y=0;return(d|=0)?(y=0|dh(A,d),(A|d)>>>0>65535&&(y=(0|(y>>>0)/(d>>>0))==(0|A)?y:-1)):y=0,!(d=0|ru(y))||!(3&p[d+-4>>2])||tc(0|d,0,0|y),0|d}function v0(d,A,y,C){return Mn(0|(C=(A|=0)-(C|=0)-((y|=0)>>>0>(d|=0)>>>0|0)>>>0)),0|d-y>>>0}function Pk(d){return 0|((d|=0)?31-(0|QA(d^d-1))|0:32)}function md(d,A,y,C){var S,k;return k=me,me=me+16|0,function(d,A,y,C,S){S|=0;var k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0;if(ee=d|=0,T=y|=0,O=Te=C|=0,!(X=$=A|=0))return k=0!=(0|S),O?k?(p[S>>2]=0|d,p[S+4>>2]=0&A,S=0,Mn(0|(Te=0)),0|S):(S=0,Mn(0|(Te=0)),0|S):(k&&(p[S>>2]=(ee>>>0)%(T>>>0),p[S+4>>2]=0),S=(ee>>>0)/(T>>>0)>>>0,Mn(0|(Te=0)),0|S);k=0==(0|O);do{if(T){if(!k){if((k=(0|QA(0|O))-(0|QA(0|X))|0)>>>0<=31){T=ye=k+1|0,d=ee>>>(ye>>>0)&(A=k-31>>31)|X<<(O=31-k|0),A&=X>>>(ye>>>0),k=0,O=ee<<O;break}return S?(p[S>>2]=0|d,p[S+4>>2]=$|0&A,S=0,Mn(0|(Te=0)),0|S):(S=0,Mn(0|(Te=0)),0|S)}if((k=T-1|0)&T|0){T=O=33+(0|QA(0|T))-(0|QA(0|X))|0,d=(ye=32-O|0)-1>>31&X>>>((ze=O-32|0)>>>0)|(X<<ye|ee>>>(O>>>0))&(A=ze>>31),A&=X>>>(O>>>0),k=ee<<(Qe=64-O|0)&($=ye>>31),O=(X<<Qe|ee>>>(ze>>>0))&$|ee<<ye&O-33>>31;break}return 0|S&&(p[S>>2]=k&ee,p[S+4>>2]=0),1==(0|T)?(Qe=0|d,Mn(0|(ze=$|0&A)),0|Qe):(ze=X>>>((Qe=0|Pk(0|T))>>>0)|0,Qe=X<<32-Qe|ee>>>(Qe>>>0)|0,Mn(0|ze),0|Qe)}if(k)return 0|S&&(p[S>>2]=(X>>>0)%(T>>>0),p[S+4>>2]=0),Qe=(X>>>0)/(T>>>0)>>>0,Mn(0|(ze=0)),0|Qe;if(!ee)return 0|S&&(p[S>>2]=0,p[S+4>>2]=(X>>>0)%(O>>>0)),Qe=(X>>>0)/(O>>>0)>>>0,Mn(0|(ze=0)),0|Qe;if(!((k=O-1|0)&O))return 0|S&&(p[S>>2]=0|d,p[S+4>>2]=k&X|0&A),ze=0,Qe=X>>>((0|Pk(0|O))>>>0),Mn(0|ze),0|Qe;if((k=(0|QA(0|O))-(0|QA(0|X))|0)>>>0<=30){T=A=k+1|0,d=X<<(O=31-k|0)|ee>>>(A>>>0),A=X>>>(A>>>0),k=0,O=ee<<O;break}return S?(p[S>>2]=0|d,p[S+4>>2]=$|0&A,Qe=0,Mn(0|(ze=0)),0|Qe):(Qe=0,Mn(0|(ze=0)),0|Qe)}while(0);if(T){X=0|function(d,A,y,C){return Mn((A|=0)+(C|=0)+((y=(d|=0)+(y|=0)>>>0)>>>0<d>>>0|0)>>>0|0),0|y}(0|(ye=0|y),0|(ee=Te|0&C),-1,-1),y=0|De(),$=O,O=0;do{C=$,$=k>>>31|$<<1,k=O|k<<1,v0(0|X,0|y,0|(C=d<<1|C>>>31|0),0|(Te=d>>>31|A<<1|0)),O=1&(ze=(Qe=0|De())>>31|((0|Qe)<0?-1:0)<<1),d=0|v0(0|C,0|Te,ze&ye|0,(((0|Qe)<0?-1:0)>>31|((0|Qe)<0?-1:0)<<1)&ee|0),A=0|De(),T=T-1|0}while(0!=(0|T));X=$,$=0}else X=O,$=0,O=0;T=0,0|S&&(p[S>>2]=d,p[S+4>>2]=A),Qe=-2&(k<<1|0)|O,Mn(0|(ze=(0|k)>>>31|(X|T)<<1|0&(T<<1|k>>>31)|$))}(d|=0,A|=0,y|=0,C|=0,S=0|k),me=k,Mn(0|p[S+4>>2]),0|p[S>>2]}function bt(d,A,y){return d|=0,A|=0,(0|(y|=0))<32?(Mn(A>>>y|0),d>>>y|(A&(1<<y)-1)<<32-y):(Mn(0),A>>>y-32|0)}function Ot(d,A,y){return d|=0,(0|(y|=0))<32?(Mn((A|=0)<<y|(d&(1<<y)-1<<32-y)>>>32-y|0),d<<y):(Mn(d<<y-32|0),0)}function Rk(d,A){return A=+A,(d=+d)!=d?+A:A!=A?+d:+NU(+d,+A)}function Av(d){return(d=+d)>=0?+aa(d+.5):+sv(d-.5)}function fv(d,A,y){d|=0,A|=0;var S,k,C=0;if((0|(y|=0))>=8192)return VU(0|d,0|A,0|y),0|d;if(k=0|d,S=d+y|0,(3&d)==(3&A)){for(;3&d;){if(!y)return 0|k;en[d>>0]=0|en[A>>0],d=d+1|0,A=A+1|0,y=y-1|0}for(C=(y=-4&S|0)-64|0;(0|d)<=(0|C);)p[d>>2]=p[A>>2],p[d+4>>2]=p[A+4>>2],p[d+8>>2]=p[A+8>>2],p[d+12>>2]=p[A+12>>2],p[d+16>>2]=p[A+16>>2],p[d+20>>2]=p[A+20>>2],p[d+24>>2]=p[A+24>>2],p[d+28>>2]=p[A+28>>2],p[d+32>>2]=p[A+32>>2],p[d+36>>2]=p[A+36>>2],p[d+40>>2]=p[A+40>>2],p[d+44>>2]=p[A+44>>2],p[d+48>>2]=p[A+48>>2],p[d+52>>2]=p[A+52>>2],p[d+56>>2]=p[A+56>>2],p[d+60>>2]=p[A+60>>2],d=d+64|0,A=A+64|0;for(;(0|d)<(0|y);)p[d>>2]=p[A>>2],d=d+4|0,A=A+4|0}else for(y=S-4|0;(0|d)<(0|y);)en[d>>0]=0|en[A>>0],en[d+1>>0]=0|en[A+1>>0],en[d+2>>0]=0|en[A+2>>0],en[d+3>>0]=0|en[A+3>>0],d=d+4|0,A=A+4|0;for(;(0|d)<(0|S);)en[d>>0]=0|en[A>>0],d=d+1|0,A=A+1|0;return 0|k}function tc(d,A,y){A|=0;var k,C=0,S=0,T=0;if(k=(d|=0)+(y|=0)|0,A&=255,(0|y)>=67){for(;3&d;)en[d>>0]=A,d=d+1|0;for(T=A|A<<8|A<<16|A<<24,S=(C=-4&k|0)-64|0;(0|d)<=(0|S);)p[d>>2]=T,p[d+4>>2]=T,p[d+8>>2]=T,p[d+12>>2]=T,p[d+16>>2]=T,p[d+20>>2]=T,p[d+24>>2]=T,p[d+28>>2]=T,p[d+32>>2]=T,p[d+36>>2]=T,p[d+40>>2]=T,p[d+44>>2]=T,p[d+48>>2]=T,p[d+52>>2]=T,p[d+56>>2]=T,p[d+60>>2]=T,d=d+64|0;for(;(0|d)<(0|C);)p[d>>2]=T,d=d+4|0}for(;(0|d)<(0|k);)en[d>>0]=A,d=d+1|0;return k-y|0}function Fk(d){return(d=+d)>=0?+aa(d+.5):+sv(d-.5)}function gd(d){var A,y,C;return d|=0,C=0|zU(),(0|d)>0&(0|(A=(y=0|p[cs>>2])+d|0))<(0|y)|(0|A)<0?(jU(0|A),JI(12),-1):(0|A)>(0|C)&&!(0|UU(0|A))?(JI(12),-1):(p[cs>>2]=A,0|y)}return{___uremdi3:md,_bitshift64Lshr:bt,_bitshift64Shl:Ot,_calloc:ec,_cellAreaKm2:function(d,A){var C,S,k,y=0;if(k=me,me=me+192|0,S=k,JA(d|=0,A|=0,C=k+168|0),ef(d,A,S),(0|(A=0|p[S>>2]))>0){if(y=+Qp(S+8|0,S+8+((1!=(0|A)&1)<<4)|0,C)+0,1!=(0|A)){d=1;do{y+=+Qp(S+8+(d<<4)|0,S+8+(((0|(d=d+1|0))%(0|A)|0)<<4)|0,C)}while((0|d)<(0|A))}}else y=0;return me=k,6371.007180918475*y*6371.007180918475},_cellAreaM2:function(d,A){var C,S,k,y=0;if(k=me,me=me+192|0,S=k,JA(d|=0,A|=0,C=k+168|0),ef(d,A,S),(0|(A=0|p[S>>2]))>0){if(y=+Qp(S+8|0,S+8+((1!=(0|A)&1)<<4)|0,C)+0,1!=(0|A)){d=1;do{y+=+Qp(S+8+(d<<4)|0,S+8+(((0|(d=d+1|0))%(0|A)|0)<<4)|0,C)}while((0|d)<(0|A))}}else y=0;return me=k,6371.007180918475*y*6371.007180918475*1e3*1e3},_cellAreaRads2:function(d,A){var C,S,k,y=0;if(k=me,me=me+192|0,S=k,JA(d|=0,A|=0,C=k+168|0),ef(d,A,S),(0|(A=0|p[S>>2]))<=0)return me=k,+(y=0);if(y=+Qp(S+8|0,S+8+((1!=(0|A)&1)<<4)|0,C)+0,1==(0|A))return me=k,+y;d=1;do{y+=+Qp(S+8+(d<<4)|0,S+8+(((0|(d=d+1|0))%(0|A)|0)<<4)|0,C)}while((0|d)<(0|A));return me=k,+y},_compact:function(d,A,y){A|=0;var Ie,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,Lt=0,qe=0,gt=0,Nt=0,zt=0,kt=0,Ft=0;if(!(y|=0))return 0;if(C=0|p[(S=d|=0)>>2],!0&0==(15728640&(S=0|p[S+4>>2])|0)){if((0|y)<=0||(p[(kt=A)>>2]=C,p[kt+4>>2]=S,1==(0|y)))return 0;C=1;do{zt=0|p[4+(Nt=d+(C<<3)|0)>>2],p[(kt=A+(C<<3)|0)>>2]=p[Nt>>2],p[kt+4>>2]=zt,C=C+1|0}while((0|C)!=(0|y));return 0}if(!(zt=0|ru(Nt=y<<3)))return-3;if(fv(0|zt,0|d,0|Nt),!(Ie=0|ec(y,8)))return On(zt),-3;C=y;e:for(;;){qe=0|bt(0|(ee=0|p[(T=zt)>>2]),0|(T=0|p[T+4>>2]),52),De(),gt=(qe&=15)-1|0,Lt=(0|C)>0;t:do{if(Lt){if(wt=((0|C)<0)<<31>>31,Qe=0|Ot(0|gt,0,52),Ke=0|De(),gt>>>0>15)for(S=0,d=ee,y=T;;){if(!(0==(0|d)&0==(0|y))){if(k=0|bt(0|d,0|y,52),De(),O=(0|(k&=15))<(0|gt),k=(0|k)==(0|gt),y=0|md(0|(X=O?0:k?d:0),0|(d=O?0:k?y:0),0|C,0|wt),De(),0==(0|($=0|p[(O=k=Ie+(y<<3)|0)>>2]))&0==(0|(O=0|p[O+4>>2])))y=X;else for(Qe=0,ze=y,Te=O,y=X;;){if((0|Qe)>(0|C)){kt=41;break e}if((0|$)==(0|y)&(-117440513&Te|0)==(0|d)){X=0|bt(0|$,0|Te,56),De(),ye=1+(X&=7)|0,Ke=0|bt(0|$,0|Te,45),De();n:do{if(0|fi(127&Ke)){if($=0|bt(0|$,0|Te,52),De(),!($&=15)){O=6;break}for(O=1;;){if(!(0==((Ke=0|Ot(7,0,3*(15-O|0)|0))&y|0)&0==((0|De())&d|0))){O=7;break n}if(!(O>>>0<$>>>0)){O=6;break}O=O+1|0}}else O=7}while(0);if((X+2|0)>>>0>O>>>0){kt=51;break e}Ke=0|Ot(0|ye,0,56),d=0|De()|-117440513&d,p[(O=k)>>2]=0,p[O+4>>2]=0,O=ze,y|=Ke}else O=(ze+1|0)%(0|C)|0;if(0==(0|($=0|p[(Te=k=Ie+(O<<3)|0)>>2]))&0==(0|(Te=0|p[Te+4>>2])))break;Qe=Qe+1|0,ze=O}p[(Ke=k)>>2]=y,p[Ke+4>>2]=d}if((0|(S=S+1|0))>=(0|C))break t;d=0|p[(y=zt+(S<<3)|0)>>2],y=0|p[y+4>>2]}for(S=0,d=ee,y=T;;){if(!(0==(0|d)&0==(0|y))){if(O=0|bt(0|d,0|y,52),De(),(0|(O&=15))>=(0|gt)){if((0|O)!=(0|gt)&&(d|=Qe,y=-15728641&y|Ke,O>>>0>=qe>>>0)){k=gt;do{ze=0|Ot(7,0,3*(14-k|0)|0),k=k+1|0,d|=ze,y=0|De()|y}while(k>>>0<O>>>0)}}else d=0,y=0;if(O=0|md(0|d,0|y,0|C,0|wt),De(),!(0==(0|(X=0|p[($=k=Ie+(O<<3)|0)>>2]))&0==(0|($=0|p[$+4>>2]))))for(ze=0;;){if((0|ze)>(0|C)){kt=41;break e}if((0|X)==(0|d)&(-117440513&$|0)==(0|y)){ye=0|bt(0|X,0|$,56),De(),Te=1+(ye&=7)|0,Ft=0|bt(0|X,0|$,45),De();n:do{if(0|fi(127&Ft)){if(X=0|bt(0|X,0|$,52),De(),!(X&=15)){$=6;break}for($=1;;){if(!(0==((Ft=0|Ot(7,0,3*(15-$|0)|0))&d|0)&0==((0|De())&y|0))){$=7;break n}if(!($>>>0<X>>>0)){$=6;break}$=$+1|0}}else $=7}while(0);if((ye+2|0)>>>0>$>>>0){kt=51;break e}Ft=0|Ot(0|Te,0,56),y=0|De()|-117440513&y,p[(Te=k)>>2]=0,p[Te+4>>2]=0,d|=Ft}else O=(O+1|0)%(0|C)|0;if(0==(0|(X=0|p[($=k=Ie+(O<<3)|0)>>2]))&0==(0|($=0|p[$+4>>2])))break;ze=ze+1|0}p[(Ft=k)>>2]=d,p[Ft+4>>2]=y}if((0|(S=S+1|0))>=(0|C))break t;d=0|p[(y=zt+(S<<3)|0)>>2],y=0|p[y+4>>2]}}}while(0);if((C+5|0)>>>0<11){kt=99;break}if(!(Ke=0|ec((0|C)/6|0,8))){kt=58;break}t:do{if(Lt){ze=0,Te=0;do{if(!(0==(0|(S=0|p[(d=O=Ie+(ze<<3)|0)>>2]))&0==(0|(d=0|p[d+4>>2])))){$=0|bt(0|S,0|d,56),De(),y=1+($&=7)|0,X=-117440513&d,Ft=0|bt(0|S,0|d,45),De();n:do{if(0|fi(127&Ft)){if(ye=0|bt(0|S,0|d,52),De(),0|(ye&=15))for(k=1;;){if(!(0==(S&(Ft=0|Ot(7,0,3*(15-k|0)|0))|0)&0==(X&(0|De())|0)))break n;if(!(k>>>0<ye>>>0))break;k=k+1|0}S|=d=0|Ot(0|y,0,56),d=0|De()|X,p[(y=O)>>2]=S,p[y+4>>2]=d,y=$+2|0}}while(0);7==(0|y)&&(p[(Ft=Ke+(Te<<3)|0)>>2]=S,p[Ft+4>>2]=-117440513&d,Te=Te+1|0)}ze=ze+1|0}while((0|ze)!=(0|C));if(Lt){if(Qe=((0|C)<0)<<31>>31,ye=0|Ot(0|gt,0,52),ze=0|De(),gt>>>0>15)for(d=0,S=0;;){do{if(!(0==(0|ee)&0==(0|T))){for($=0|bt(0|ee,0|T,52),De(),k=(0|($&=15))<(0|gt),$=(0|$)==(0|gt),k=0|md(0|(O=k?0:$?ee:0),0|($=k?0:$?T:0),0|C,0|Qe),De(),y=0;;){if((0|y)>(0|C)){kt=98;break e}if((-117440513&(X=0|p[4+(Ft=Ie+(k<<3)|0)>>2])|0)==(0|$)&&(0|p[Ft>>2])==(0|O)){kt=70;break}if((0|p[(Ft=Ie+((k=(k+1|0)%(0|C)|0)<<3)|0)>>2])==(0|O)&&(0|p[Ft+4>>2])==(0|$))break;y=y+1|0}if(70==(0|kt)&&(kt=0,!0&100663296==(117440512&X|0)))break;p[(Ft=A+(S<<3)|0)>>2]=ee,p[Ft+4>>2]=T,S=S+1|0}}while(0);if((0|(d=d+1|0))>=(0|C)){C=Te;break t}ee=0|p[(T=zt+(d<<3)|0)>>2],T=0|p[T+4>>2]}for(d=0,S=0;;){do{if(!(0==(0|ee)&0==(0|T))){if($=0|bt(0|ee,0|T,52),De(),(0|($&=15))>=(0|gt))if((0|$)!=(0|gt))if(y=ee|ye,k=-15728641&T|ze,$>>>0<qe>>>0)$=k;else{O=gt;do{Ft=0|Ot(7,0,3*(14-O|0)|0),O=O+1|0,y|=Ft,k=0|De()|k}while(O>>>0<$>>>0);$=k}else y=ee,$=T;else y=0,$=0;for(O=0|md(0|y,0|$,0|C,0|Qe),De(),k=0;;){if((0|k)>(0|C)){kt=98;break e}if((-117440513&(X=0|p[4+(Ft=Ie+(O<<3)|0)>>2])|0)==(0|$)&&(0|p[Ft>>2])==(0|y)){kt=93;break}if((0|p[(Ft=Ie+((O=(O+1|0)%(0|C)|0)<<3)|0)>>2])==(0|y)&&(0|p[Ft+4>>2])==(0|$))break;k=k+1|0}if(93==(0|kt)&&(kt=0,!0&100663296==(117440512&X|0)))break;p[(Ft=A+(S<<3)|0)>>2]=ee,p[Ft+4>>2]=T,S=S+1|0}}while(0);if((0|(d=d+1|0))>=(0|C)){C=Te;break t}ee=0|p[(T=zt+(d<<3)|0)>>2],T=0|p[T+4>>2]}}else S=0,C=Te}else S=0,C=0}while(0);if(tc(0|Ie,0,0|Nt),fv(0|zt,0|Ke,C<<3|0),On(Ke),!C)break;A=A+(S<<3)|0}return 41==(0|kt)?(On(zt),On(Ie),0|(Ft=-1)):51==(0|kt)?(On(zt),On(Ie),0|(Ft=-2)):58==(0|kt)?(On(zt),On(Ie),0|(Ft=-3)):98==(0|kt)?(On(Ke),On(zt),On(Ie),0|(Ft=-1)):(99==(0|kt)&&fv(0|A,0|zt,C<<3|0),On(zt),On(Ie),0|(Ft=0))},_destroyLinkedPolygon:function(d){var A=0,y=0,C=0,S=0;if(d|=0)for(C=1;;){if(0|(A=0|p[d>>2]))do{if(0|(y=0|p[A>>2]))do{S=y,y=0|p[y+16>>2],On(S)}while(0!=(0|y));S=A,A=0|p[A+8>>2],On(S)}while(0!=(0|A));if(A=d,d=0|p[d+8>>2],C||On(A),!d)break;C=0}},_edgeLengthKm:function(d){return+ +pe[20752+((d|=0)<<3)>>3]},_edgeLengthM:function(d){return+ +pe[20880+((d|=0)<<3)>>3]},_emscripten_replace_memory:function(d){return en=new Int8Array(d),new Uint8Array(d),p=new Int32Array(d),new Float32Array(d),pe=new Float64Array(d),It=d,!0},_exactEdgeLengthKm:function(d,A){var k,T,y=0,C=0,S=0,O=0,$=0,X=0;if(T=me,me=me+176|0,uv(d|=0,A|=0,k=T),(0|(d=0|p[k>>2]))<=1)return me=T,+(S=0);A=d+-1|0,d=0,y=0,C=+pe[k+8>>3],S=+pe[k+16>>3];do{$=C,O=S,O=(X=+or(.5*((C=+pe[k+8+((d=d+1|0)<<4)>>3])-$)))*X+(O=+or(.5*((S=+pe[k+8+(d<<4)+8>>3])-O)))*(+Zn(+$)*+Zn(+C)*O),y+=2*+hl(+ +Si(+O),+ +Si(+(1-O)))}while((0|d)!=(0|A));return me=T,+(X=6371.007180918475*y)},_exactEdgeLengthM:function(d,A){var k,T,y=0,C=0,S=0,O=0,$=0,X=0;if(T=me,me=me+176|0,uv(d|=0,A|=0,k=T),(0|(d=0|p[k>>2]))<=1)return me=T,+(S=0);A=d+-1|0,d=0,y=0,C=+pe[k+8>>3],S=+pe[k+16>>3];do{$=C,O=S,O=(X=+or(.5*((C=+pe[k+8+((d=d+1|0)<<4)>>3])-$)))*X+(O=+or(.5*((S=+pe[k+8+(d<<4)+8>>3])-O)))*(+Zn(+$)*+Zn(+C)*O),y+=2*+hl(+ +Si(+O),+ +Si(+(1-O)))}while((0|d)!=(0|A));return me=T,+(X=6371.007180918475*y*1e3)},_exactEdgeLengthRads:function(d,A){var k,T,y=0,C=0,S=0,O=0,$=0,X=0;if(T=me,me=me+176|0,uv(d|=0,A|=0,k=T),(0|(d=0|p[k>>2]))<=1)return me=T,+(S=0);A=d+-1|0,d=0,y=0,C=+pe[k+8>>3],S=+pe[k+16>>3];do{$=C,O=S,O=(X=+or(.5*((C=+pe[k+8+((d=d+1|0)<<4)>>3])-$)))*X+(O=+or(.5*((S=+pe[k+8+(d<<4)+8>>3])-O)))*(+Zn(+C)*+Zn(+$)*O),y+=2*+hl(+ +Si(+O),+ +Si(+(1-O)))}while((0|d)<(0|A));return me=T,+y},_experimentalH3ToLocalIj:function(d,A,y,C,S){var k,T;return S|=0,T=me,me=me+16|0,(d=0|Ah(d|=0,A|=0,y|=0,C|=0,k=T))||(function(d,A){var y;p[(A|=0)>>2]=(0|p[(d|=0)>>2])-(y=0|p[d+8>>2]),p[A+4>>2]=(0|p[d+4>>2])-y}(k,S),d=0),me=T,0|d},_experimentalLocalIjToH3:function(d,A,y,C){var S,k;return d|=0,A|=0,C|=0,S=me,me=me+16|0,function(d,A){var k,T,O,y=0,C=0,S=0;p[(A|=0)>>2]=C=0|p[(d|=0)>>2],p[(T=A+4|0)>>2]=d=0|p[d+4>>2],p[(O=A+8|0)>>2]=0,y=d-C|0,(0|C)<0?(d=0-C|0,p[T>>2]=y,p[O>>2]=d,p[A>>2]=0,C=0):(y=d,d=0),(0|y)<0&&(p[A>>2]=C=C-y|0,p[O>>2]=d=d-y|0,p[T>>2]=0,y=0),k=C-d|0,S=y-d|0,(0|d)<0?(p[A>>2]=k,p[T>>2]=S,p[O>>2]=0,y=S,S=k,d=0):S=C,!((0|(C=(0|d)<(0|(C=(0|y)<(0|S)?y:S))?d:C))<=0)&&(p[A>>2]=S-C,p[T>>2]=y-C,p[O>>2]=d-C)}(y|=0,k=S),C=0|Ck(d,A,k,C),me=S,0|C},_free:On,_geoToH3:yk,_getDestinationH3IndexFromUnidirectionalEdge:function(d,A){d|=0;var C,y=0,S=0;return C=me,me=me+16|0,y=C,!0&268435456==(2013265920&(A|=0)|0)?(S=0|bt(0|d,0|A,56),De(),p[y>>2]=0,y=0|so(d,-2130706433&A|134217728,7&S,y),A=0|De(),Mn(0|A),me=C,0|y):(y=0,Mn(0|(A=0)),me=C,0|y)},_getH3IndexesFromUnidirectionalEdge:function(d,A,y){d|=0;var C,S,k,T,O=0;k=me,me=me+16|0,C=k,S=-2130706433&(A|=0)|134217728,p[(O=y|=0)>>2]=(T=!0&268435456==(2013265920&A|0))?d:0,p[O+4>>2]=T?S:0,T?(A=0|bt(0|d,0|A,56),De(),p[C>>2]=0,d=0|so(d,S,7&A,C),A=0|De()):(d=0,A=0),p[(O=y+8|0)>>2]=d,p[O+4>>2]=A,me=k},_getH3UnidirectionalEdge:function(d,A,y,C){var T,X,S=0,k=0,O=0,$=0,ee=0;if(X=me,me=me+16|0,T=X,!(0|xk(d|=0,A|=0,y|=0,C|=0)))return $=0,Mn(0|(O=0)),me=X,0|$;for(O=-2130706433&A,S=(S=0==(0|_o(d,A)))?1:2;p[T>>2]=0,k=S+1|0,!((0|(ee=0|so(d,A,S,T)))==(0|y)&(0|De())==(0|C));){if(!(k>>>0<7)){S=0,d=0,$=6;break}S=k}return 6==(0|$)?(Mn(0|S),me=X,0|d):(ee=0|Ot(0|S,0,56),$=0|O|De()|268435456,ee|=d,Mn(0|$),me=X,0|ee)},_getH3UnidirectionalEdgeBoundary:uv,_getH3UnidirectionalEdgesFromHexagon:function(d,A,y){y|=0;var S,C=0;S=0==(0|_o(d|=0,A|=0)),A&=-2130706433,p[(C=y)>>2]=S?d:0,p[C+4>>2]=S?285212672|A:0,p[(C=y+8|0)>>2]=d,p[C+4>>2]=301989888|A,p[(C=y+16|0)>>2]=d,p[C+4>>2]=318767104|A,p[(C=y+24|0)>>2]=d,p[C+4>>2]=335544320|A,p[(C=y+32|0)>>2]=d,p[C+4>>2]=352321536|A,p[(y=y+40|0)>>2]=d,p[y+4>>2]=369098752|A},_getOriginH3IndexFromUnidirectionalEdge:function(d,A){var y;return d|=0,Mn(0|((y=!0&268435456==(2013265920&(A|=0)|0))?-2130706433&A|134217728:0)),0|(y?d:0)},_getPentagonIndexes:Vw,_getRes0Indexes:function(d){d|=0;var A=0,y=0,C=0;A=0;do{Ot(0|A,0,45),C=134225919|De(),p[(y=d+(A<<3)|0)>>2]=-1,p[y+4>>2]=C,A=A+1|0}while(122!=(0|A))},_h3Distance:function(d,A,y,C){var S,k,T;return y|=0,C|=0,T=me,me=me+32|0,k=T,d=0==(0|Ah(d|=0,A|=0,d,A,S=T+12|0))&&0==(0|Ah(d,A,y,C,k))?0|Ow(S,k):-1,me=T,0|d},_h3GetBaseCell:gk,_h3GetFaces:function vk(d,A,y){y|=0;var ye,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0;ye=me,me=me+128|0,X=ye+112|0,k=ye+96|0,ee=ye,S=0|bt(0|(d|=0),0|(A|=0),52),De(),p[X>>2]=O=15&S,T=0|bt(0|d,0|A,45),De(),T&=127;e:do{if(0|fi(T)){if(0|O)for(C=1;;){if(!(0==(($=0|Ot(7,0,3*(15-C|0)|0))&d|0)&0==((0|De())&A|0))){S=0;break e}if(!(C>>>0<O>>>0))break;C=C+1|0}if(!(1&S))return $=0|Ot(O+1|0,0,52),ee=0|De()|-15728641&A,vk(($|d)&~(X=0|Ot(7,0,3*(14-O|0)|0)),ee&~(0|De()),y),void(me=ye);S=1}else S=0}while(0);y0(d,A,k),S?(fk(k,X,ee),$=5):(mk(k,X,ee),$=6);e:do{if(0|fi(T))if(O)for(C=1;;){if(!(0==((T=0|Ot(7,0,3*(15-C|0)|0))&d|0)&0==((0|De())&A|0))){C=8;break e}if(!(C>>>0<O>>>0)){C=20;break}C=C+1|0}else C=20;else C=8}while(0);if(tc(0|y,-1,0|C),S){S=0;do{for(mj(k=ee+(S<<4)|0,0|p[X>>2]),k=0|p[k>>2],C=0;!(-1==(0|(O=0|p[(T=y+(C<<2)|0)>>2]))|(0|O)==(0|k));)C=C+1|0;p[T>>2]=k,S=S+1|0}while((0|S)!=(0|$))}else{S=0;do{for(Zp(k=ee+(S<<4)|0,0|p[X>>2],0,1),k=0|p[k>>2],C=0;!(-1==(0|(O=0|p[(T=y+(C<<2)|0)>>2]))|(0|O)==(0|k));)C=C+1|0;p[T>>2]=k,S=S+1|0}while((0|S)!=(0|$))}me=ye},_h3GetResolution:function(d,A){return A=0|bt(0|(d|=0),0|(A|=0),52),De(),15&A|0},_h3IndexesAreNeighbors:xk,_h3IsPentagon:_o,_h3IsResClassIII:function(d,A){return A=0|bt(0|(d|=0),0|(A|=0),52),De(),1&A|0},_h3IsValid:_k,_h3Line:function(d,A,y,C,S){y|=0,C|=0,S|=0;var Nt,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,Lt=0,qe=0,gt=0,Ie=0,zt=0;if(Nt=me,me=me+48|0,T=Nt+12|0,Ie=Nt,0==(0|Ah(d|=0,A|=0,d,A,k=Nt+24|0))&&0==(0|Ah(d,A,y,C,T))){if((0|(gt=0|Ow(k,T)))<0)return me=Nt,0|gt;for(p[k>>2]=0,p[k+4>>2]=0,p[k+8>>2]=0,p[T>>2]=0,p[T+4>>2]=0,p[T+8>>2]=0,Ah(d,A,d,A,k),Ah(d,A,y,C,T),dk(k),dk(T),gt?(qe=k,y=ee=0|p[k>>2],C=ye=0|p[(wt=k+4|0)>>2],k=Te=0|p[(Lt=k+8|0)>>2],Qe=+((0|p[T>>2])-ee|0)/(ze=+(0|gt)),Ke=+((0|p[T+4>>2])-ye|0)/ze,ze=+((0|p[T+8>>2])-Te|0)/ze):(wt=C=k+4|0,Lt=Te=k+8|0,qe=k,y=0|p[k>>2],C=0|p[C>>2],k=0|p[Te>>2],Qe=0,Ke=0,ze=0),p[Ie>>2]=y,p[(Te=Ie+4|0)>>2]=C,p[(ye=Ie+8|0)>>2]=k,ee=0;;){zt=Qe*($=+(0|ee))+ +(0|y),O=Ke*$+ +(0|p[wt>>2]),$=ze*$+ +(0|p[Lt>>2]),C=~~+Av(+zt),T=~~+Av(+O),y=~~+Av(+$),zt=+tr(+(+(0|C)-zt)),O=+tr(+(+(0|T)-O)),$=+tr(+(+(0|y)-$));do{if(!(zt>O&zt>$)){if(X=0-C|0,O>$){k=X-y|0;break}k=T,y=X-T|0;break}C=0-(T+y)|0,k=T}while(0);if(p[Ie>>2]=C,p[Te>>2]=k,p[ye>>2]=y,dj(Ie),Ck(d,A,Ie,S+(ee<<3)|0),(0|ee)==(0|gt))break;ee=ee+1|0,y=0|p[qe>>2]}return me=Nt,0}return me=Nt,-1},_h3LineSize:function(d,A,y,C){var S,k,T;return y|=0,C|=0,T=me,me=me+32|0,k=T,d=0==(0|Ah(d|=0,A|=0,d,A,S=T+12|0))&&0==(0|Ah(d,A,y,C,k))?0|Ow(S,k):-1,me=T,(d>>>31^1)+d|0},_h3SetToLinkedGeo:function(d,A,y){y|=0;var C,S,k,T=0;if(k=me,me=me+32|0,C=k,function(d,A,y){d|=0,y|=0;var $,X,C=0,S=0,k=0,T=0,O=0;if(X=me,me=me+176|0,$=X,(0|(A|=0))<1)return Mk(y,0,0),void(me=X);T=0|bt(0|p[(T=d)>>2],0|p[T+4>>2],52),De(),Mk(y,(0|A)>6?A:6,15&T),T=0;do{if(ef(0|p[(C=d+(T<<3)|0)>>2],0|p[C+4>>2],$),(0|(C=0|p[$>>2]))>0){O=0;do{k=$+8+(O<<4)|0,(S=0|g7(y,C=$+8+(((0|(O=O+1|0))%(0|C)|0)<<4)|0,k))?kk(y,S):m7(y,k,C),C=0|p[$>>2]}while((0|O)<(0|C))}T=T+1|0}while((0|T)!=(0|A));me=X}(d|=0,A|=0,S=k+16|0),p[y>>2]=0,p[y+4>>2]=0,p[y+8>>2]=0,!(d=0|Ik(S)))return bk(y),Tk(S),void(me=k);do{A=0|Qj(y);do{Xj(A,d),p[C>>2]=p[(T=d+16|0)>>2],p[C+4>>2]=p[T+4>>2],p[C+8>>2]=p[T+8>>2],p[C+12>>2]=p[T+12>>2],kk(S,d),d=0|_7(S,C)}while(0!=(0|d));d=0|Ik(S)}while(0!=(0|d));bk(y),Tk(S),me=k},_h3ToCenterChild:function(d,A,y){y|=0;var C=0,S=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|y)<16&(0|(C&=15))<=(0|y)){if((0|C)!=(0|y)&&(d|=S=0|Ot(0|y,0,52),A=0|De()|-15728641&A,(0|C)<(0|y)))do{S=0|Ot(7,0,3*(14-C|0)|0),C=C+1|0,d&=~S,A&=~(0|De())}while((0|C)<(0|y))}else A=0,d=0;return Mn(0|A),0|d},_h3ToChildren:la,_h3ToGeo:JA,_h3ToGeoBoundary:ef,_h3ToParent:Lw,_h3UnidirectionalEdgeIsValid:function(d,A){var y=0;if(!(!0&268435456==(2013265920&(A|=0)|0)))return 0;switch(y=0|bt(0|(d|=0),0|A,56),De(),7&y){case 0:case 7:return 0}return!0&16777216==(117440512&A|0)&0!=(0|_o(d,y=-2130706433&A|134217728))?0|(y=0):0|(y=0|_k(d,y))},_hexAreaKm2:function(d){return+ +pe[20496+((d|=0)<<3)>>3]},_hexAreaM2:function(d){return+ +pe[20624+((d|=0)<<3)>>3]},_hexRing:function(d,A,y,C){d|=0,A|=0,C|=0;var ye,S=0,k=0,T=0,O=0,$=0,X=0,ee=0;if(ye=me,me=me+16|0,ee=ye,!(y|=0))return p[(ee=C)>>2]=d,p[ee+4>>2]=A,me=ye,0;p[ee>>2]=0;e:do{if(0|_o(d,A))d=1;else{if(k=(0|y)>0){S=0,X=d;do{if(0==(0|(X=0|so(X,A,4,ee)))&0==(0|(A=0|De()))){d=2;break e}if(S=S+1|0,0|_o(X,A)){d=1;break e}}while((0|S)<(0|y));if(p[($=C)>>2]=X,p[$+4>>2]=A,$=y+-1|0,k){k=0,T=1,S=X,d=A;do{if(0==(0|(S=0|so(S,d,2,ee)))&0==(0|(d=0|De()))){d=2;break e}if(p[(O=C+(T<<3)|0)>>2]=S,p[O+4>>2]=d,T=T+1|0,0|_o(S,d)){d=1;break e}k=k+1|0}while((0|k)<(0|y));O=0,k=T;do{if(0==(0|(S=0|so(S,d,3,ee)))&0==(0|(d=0|De()))){d=2;break e}if(p[(T=C+(k<<3)|0)>>2]=S,p[T+4>>2]=d,k=k+1|0,0|_o(S,d)){d=1;break e}O=O+1|0}while((0|O)<(0|y));T=0;do{if(0==(0|(S=0|so(S,d,1,ee)))&0==(0|(d=0|De()))){d=2;break e}if(p[(O=C+(k<<3)|0)>>2]=S,p[O+4>>2]=d,k=k+1|0,0|_o(S,d)){d=1;break e}T=T+1|0}while((0|T)<(0|y));T=0;do{if(0==(0|(S=0|so(S,d,5,ee)))&0==(0|(d=0|De()))){d=2;break e}if(p[(O=C+(k<<3)|0)>>2]=S,p[O+4>>2]=d,k=k+1|0,0|_o(S,d)){d=1;break e}T=T+1|0}while((0|T)<(0|y));T=0;do{if(0==(0|(S=0|so(S,d,4,ee)))&0==(0|(d=0|De()))){d=2;break e}if(p[(O=C+(k<<3)|0)>>2]=S,p[O+4>>2]=d,k=k+1|0,0|_o(S,d)){d=1;break e}T=T+1|0}while((0|T)<(0|y));for(T=0;;){if(0==(0|(S=0|so(S,d,6,ee)))&0==(0|(d=0|De()))){d=2;break e}if((0|T)!=(0|$)){if(p[(O=C+(k<<3)|0)>>2]=S,p[O+4>>2]=d,0|_o(S,d)){d=1;break e}k=k+1|0}if((0|(T=T+1|0))>=(0|y)){T=X,k=A;break}}}else T=X,S=X,k=A,d=A}else p[(T=C)>>2]=d,p[T+4>>2]=A,T=d,S=d,k=A,d=A;d=1&((0|T)!=(0|S)|(0|k)!=(0|d))}}while(0);return me=ye,0|d},_i64Subtract:v0,_kRing:ek,_kRingDistances:function(d,A,y,C,S){var k=0;if(0|Mw(d|=0,A|=0,y|=0,C|=0,S|=0)){if(tc(0|C,0,(k=1+(0|dh(3*y|0,y+1|0))|0)<<3|0),0|S)return tc(0|S,0,k<<2|0),void nu(d,A,y,C,S,k,0);(S=0|ec(k,4))&&(nu(d,A,y,C,S,k,0),On(S))}},_llvm_minnum_f64:Rk,_llvm_round_f64:Av,_malloc:ru,_maxFaceCount:function(d,A){var y=0,C=0;if(C=0|bt(0|(d|=0),0|(A|=0),45),De(),!(0|fi(127&C)))return 2;if(C=0|bt(0|d,0|A,52),De(),!(C&=15))return 5;for(y=1;;){if(!(0==((0|Ot(7,0,3*(15-y|0)|0))&d|0)&0==((0|De())&A|0))){y=2,d=6;break}if(!(y>>>0<C>>>0)){y=5,d=6;break}y=y+1|0}return 6==(0|d)?0|y:0},_maxH3ToChildrenSize:function(d,A,y){return y|=0,d=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|y)<16&(0|(d&=15))<=(0|y)?0|(y=0|hv(7,y-d|0)):0|(y=0)},_maxKringSize:function(d){return 1+(0|dh(3*(d|=0)|0,d+1|0))|0},_maxPolyfillSize:function(d,A){A|=0;var k,y=0,C=0,S=0,T=0,O=0;if(k=me,me=me+48|0,S=k+8|0,T=0|p[4+(O=d|=0)>>2],p[(y=C=k)>>2]=p[O>>2],p[y+4>>2]=T,Uw(C,S),S=0|Pw(S,A),A=0|p[C>>2],(0|(C=0|p[d+8>>2]))<=0)return me=k,0|(O=(T=(0|S)<(0|(O=A)))?O:S)+12;y=0|p[d+12>>2],d=0;do{A=(0|p[y+(d<<3)>>2])+A|0,d=d+1|0}while((0|d)<(0|C));return me=k,0|(O=(O=(0|S)<(0|A))?A:S)+12},_maxUncompactSize:function(d,A,y){d|=0;var C=0,S=0,k=0,T=0;if((0|(A|=0))<=0)return 0;if((0|(y|=0))>=16){for(C=0;;){if(!(0==(0|p[(T=d+(C<<3)|0)>>2])&0==(0|p[T+4>>2]))){C=-1,S=13;break}if((0|(C=C+1|0))>=(0|A)){C=0,S=13;break}}if(13==(0|S))return 0|C}C=0,T=0;e:for(;;){k=0|p[(S=d+(T<<3)|0)>>2],S=0|p[S+4>>2];do{if(!(0==(0|k)&0==(0|S))){if(S=0|bt(0|k,0|S,52),De(),(0|(S&=15))>(0|y)){C=-1,S=13;break e}if((0|S)==(0|y)){C=C+1|0;break}C=(0|hv(7,y-S|0))+C|0;break}}while(0);if((0|(T=T+1|0))>=(0|A)){S=13;break}}return 13==(0|S)?0|C:0},_memcpy:fv,_memset:tc,_numHexagons:function(d){var A;return d=0|p[(A=21008+((d|=0)<<3)|0)>>2],Mn(0|p[A+4>>2]),0|d},_pentagonIndexCount:function(){return 12},_pointDistKm:_0,_pointDistM:function(d,A){var C,S,k,y=0;return y=(k=+or(.5*((S=+pe[(A|=0)>>3])-(C=+pe[(d|=0)>>3]))))*k+(y=+or(.5*(+pe[A+8>>3]-+pe[d+8>>3])))*(+Zn(+S)*+Zn(+C)*y),2*+hl(+ +Si(+y),+ +Si(+(1-y)))*6371.007180918475*1e3},_pointDistRads:function(d,A){var C,S,k,y=0;return y=(k=+or(.5*((S=+pe[(A|=0)>>3])-(C=+pe[(d|=0)>>3]))))*k+(y=+or(.5*(+pe[A+8>>3]-+pe[d+8>>3])))*(+Zn(+S)*+Zn(+C)*y),2*+hl(+ +Si(+y),+ +Si(+(1-y)))},_polyfill:function(d,A,y){var O,C=0,S=0,k=0,T=0,$=0;if(O=me,me=me+48|0,C=O+8|0,S=O,0|function(d,A,y){A|=0,y|=0;var vr,jr,pr,ti,_n,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,Lt=0,qe=0,gt=0,Ie=0,Nt=0,zt=0,kt=0,Ft=0,In=0,Ir=0,ni=0;if(_n=me,me=me+112|0,jr=_n+80|0,$=_n+72|0,pr=_n,ti=_n+56|0,(ni=0|ru(32+(p[(X=8+(d|=0)|0)>>2]<<5)|0))||Tr(22848,22448,800,22456),function(d,A){A|=0;var y=0,C=0,S=0,k=0,T=0,O=0,$=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,wt=0,Lt=0,qe=0,gt=0,Ie=0,Nt=0,zt=0,kt=0;if(Qe=0|p[(d|=0)>>2]){if(pe[(Ke=A+8|0)>>3]=17976931348623157e292,pe[(wt=A+24|0)>>3]=17976931348623157e292,pe[A>>3]=-17976931348623157e292,pe[(Lt=A+16|0)>>3]=-17976931348623157e292,(0|Qe)>0){for(S=0|p[d+4>>2],Te=17976931348623157e292,ze=-17976931348623157e292,C=0,y=-1,$=17976931348623157e292,X=17976931348623157e292,ye=-17976931348623157e292,T=-17976931348623157e292,qe=0;ee=+pe[S+(qe<<4)+8>>3],O=+pe[S+(((0|(zt=y+2|0))==(0|Qe)?0:zt)<<4)+8>>3],(k=+pe[S+(qe<<4)>>3])<$&&(pe[Ke>>3]=k,$=k),ee<X&&(pe[wt>>3]=ee,X=ee),k>ye?pe[A>>3]=k:k=ye,ee>T&&(pe[Lt>>3]=ee,T=ee),Te=ee>0&ee<Te?ee:Te,ze=ee<0&ee>ze?ee:ze,C|=+tr(+(ee-O))>3.141592653589793,(0|(y=qe+1|0))!=(0|Qe);)zt=qe,ye=k,qe=y,y=zt;C&&(pe[Lt>>3]=ze,pe[wt>>3]=Te)}}else p[A>>2]=0,p[A+4>>2]=0,p[A+8>>2]=0,p[A+12>>2]=0,p[A+16>>2]=0,p[A+20>>2]=0,p[A+24>>2]=0,p[A+28>>2]=0;if(!((0|(y=0|p[(zt=d+8|0)>>2]))<=0)){Nt=d+12|0,Ie=0;do{if(C=Ie,wt=A+((Ie=Ie+1|0)<<5)|0,Lt=0|p[(S=0|p[Nt>>2])+(C<<3)>>2]){if(pe[(qe=A+(Ie<<5)+8|0)>>3]=17976931348623157e292,pe[(d=A+(Ie<<5)+24|0)>>3]=17976931348623157e292,pe[wt>>3]=-17976931348623157e292,pe[(gt=A+(Ie<<5)+16|0)>>3]=-17976931348623157e292,(0|Lt)>0){for(Qe=0|p[S+(C<<3)+4>>2],Te=17976931348623157e292,ze=-17976931348623157e292,S=0,C=-1,Ke=0,$=17976931348623157e292,X=17976931348623157e292,ee=-17976931348623157e292,T=-17976931348623157e292;ye=+pe[Qe+(Ke<<4)+8>>3],O=+pe[Qe+(((0|(C=C+2|0))==(0|Lt)?0:C)<<4)+8>>3],(k=+pe[Qe+(Ke<<4)>>3])<$&&(pe[qe>>3]=k,$=k),ye<X&&(pe[d>>3]=ye,X=ye),k>ee?pe[wt>>3]=k:k=ee,ye>T&&(pe[gt>>3]=ye,T=ye),Te=ye>0&ye<Te?ye:Te,ze=ye<0&ye>ze?ye:ze,S|=+tr(+(ye-O))>3.141592653589793,(0|(C=Ke+1|0))!=(0|Lt);)kt=Ke,Ke=C,ee=k,C=kt;S&&(pe[gt>>3]=ze,pe[d>>3]=Te)}}else p[wt>>2]=0,p[wt+4>>2]=0,p[wt+8>>2]=0,p[wt+12>>2]=0,p[wt+16>>2]=0,p[wt+20>>2]=0,p[wt+24>>2]=0,p[wt+28>>2]=0,y=0|p[zt>>2]}while((0|Ie)<(0|y))}}(d,ni),C=0|p[(k=d)+4>>2],p[(O=$)>>2]=p[k>>2],p[O+4>>2]=C,Uw($,jr),O=0|Pw(jr,A),C=0|p[$>>2],(0|(k=0|p[X>>2]))>0){T=0|p[d+12>>2],S=0;do{C=(0|p[T+(S<<3)>>2])+C|0,S=S+1|0}while((0|S)!=(0|k))}if(S=0|ec(vr=(O=(0|O)<(0|C)?C:O)+12|0,8),ee=0|ec(vr,8),p[jr>>2]=0,Ir=0|p[(In=d)+4>>2],p[(C=$)>>2]=p[In>>2],p[C+4>>2]=Ir,0|(C=0|tk($,vr,A,jr,S,ee)))return On(S),On(ee),On(ni),me=_n,0|C;e:do{if((0|p[X>>2])>0){for(k=d+12|0,C=0;T=0|tk((0|p[k>>2])+(C<<3)|0,vr,A,jr,S,ee),C=C+1|0,!(0|T);)if((0|C)>=(0|p[X>>2]))break e;return On(S),On(ee),On(ni),me=_n,0|T}}while(0);(0|O)>-12&&tc(0|ee,0,((0|vr)>1?vr:1)<<3|0);e:do{if((0|p[jr>>2])>0){Ir=((0|vr)<0)<<31>>31,Ie=S,Nt=ee,zt=S,kt=S,Ft=ee,In=S,C=S,wt=S,Lt=ee,qe=ee,gt=ee,S=ee;t:for(;;){for(Ke=0|p[jr>>2],ze=0,Qe=0,k=0;;){O=(T=pr)+56|0;do{p[T>>2]=0,T=T+4|0}while((0|T)<(0|O));if(0|Mw($=0|p[(A=Ie+(ze<<3)|0)>>2],A=0|p[A+4>>2],1,pr,0)){O=(T=pr)+56|0;do{p[T>>2]=0,T=T+4|0}while((0|T)<(0|O));0|(T=0|ec(7,4))&&(nu($,A,1,pr,T,7,0),On(T))}Te=0;do{ee=0|p[(ye=pr+(Te<<3)|0)>>2],ye=0|p[ye+4>>2];n:do{if(!(0==(0|ee)&0==(0|ye))){if($=0|md(0|ee,0|ye,0|vr,0|Ir),De(),!(0==(0|(A=0|p[(O=T=y+($<<3)|0)>>2]))&0==(0|(O=0|p[O+4>>2]))))for(X=0;;){if((0|X)>(0|vr))break t;if((0|A)==(0|ee)&(0|O)==(0|ye))break n;if(0==(0|(A=0|p[(O=T=y+(($=($+1|0)%(0|vr)|0)<<3)|0)>>2]))&0==(0|(O=0|p[O+4>>2])))break;X=X+1|0}0==(0|ee)&0==(0|ye)||(JA(ee,ye,ti),0|i7(d,ni,ti)&&(p[(X=T)>>2]=ee,p[X+4>>2]=ye,p[(X=Nt+(k<<3)|0)>>2]=ee,p[X+4>>2]=ye,k=k+1|0))}}while(0);Te=Te+1|0}while(Te>>>0<7);if((0|(Qe=Qe+1|0))>=(0|Ke))break;ze=ze+1|0}if((0|Ke)>0&&tc(0|zt,0,Ke<<3|0),p[jr>>2]=k,!((0|k)>0))break e;ee=S,ye=gt,Te=In,ze=qe,Qe=Lt,Ke=Nt,S=wt,gt=C,qe=kt,Lt=zt,wt=ee,C=ye,In=Ft,Ft=Te,kt=ze,zt=Qe,Nt=Ie,Ie=Ke}return On(kt),On(Ft),On(ni),me=_n,-1}C=ee}while(0);return On(ni),On(S),On(C),me=_n,0}(d|=0,A|=0,y|=0)){if(k=0|p[($=d)+4>>2],p[(T=S)>>2]=p[$>>2],p[T+4>>2]=k,Uw(S,C),T=0|Pw(C,A),A=0|p[S>>2],(0|(k=0|p[d+8>>2]))>0){S=0|p[d+12>>2],C=0;do{A=(0|p[S+(C<<3)>>2])+A|0,C=C+1|0}while((0|C)!=(0|k))}(0|(A=(0|T)<(0|A)?A:T))<=-12||tc(0|y,0,8+(((0|($=A+11|0))>0?$:0)<<3)|0),me=O}else me=O},_res0IndexCount:function(){return 122},_round:Fk,_sbrk:gd,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(d,A,y,C,S){d|=0,y|=0,C|=0;var k=0,T=0,O=0,$=0,X=0,ee=0;if((0|(A|=0))<=0)return 0;if((0|(S|=0))>=16){for(k=0;;){if(!(0==(0|p[(ee=d+(k<<3)|0)>>2])&0==(0|p[ee+4>>2]))){k=14;break}if((0|(k=k+1|0))>=(0|A)){T=0,k=16;break}}if(14==(0|k))return 0|((0|C)>0?-2:-1);if(16==(0|k))return 0|T}k=0,ee=0;e:for(;;){T=0|p[(O=X=d+(ee<<3)|0)>>2],O=0|p[O+4>>2];do{if(!(0==(0|T)&0==(0|O))){if((0|k)>=(0|C)){T=-1,k=16;break e}if($=0|bt(0|T,0|O,52),De(),(0|($&=15))>(0|S)){T=-2,k=16;break e}if((0|$)==(0|S)){p[(X=y+(k<<3)|0)>>2]=T,p[X+4>>2]=O,k=k+1|0;break}if((0|(T=(0|hv(7,S-$|0))+k|0))>(0|C)){T=-1,k=16;break e}la(0|p[X>>2],0|p[X+4>>2],S,y+(k<<3)|0),k=T}}while(0);if((0|(ee=ee+1|0))>=(0|A)){T=0,k=16;break}}return 16==(0|k)?0|T:0},establishStackSpace:function(d,A){me=d|=0},stackAlloc:function(d){var A;return A=me,me=15+(me=me+(d|=0)|0)&-16,0|A},stackRestore:function(d){me=d|=0},stackSave:function(){return 0|me}}}({Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},{a:WA,b:function(je){U=je},c:K,d:function(je,st,It,en){WA("Assertion failed: "+zo(je)+", at: "+[st?zo(st):"unknown filename",It,en?zo(en):"unknown function"])},e:function(je){return e.___errno_location&&(dd[e.___errno_location()>>2]=je),je},f:ZI,g:function(je,st,It){tu.set(tu.subarray(st,st+It),je)},h:function(je){var st=ZI(),en=2130706432;if(je>en)return!1;for(var Ur=Math.max(st,16777216);Ur<je;)Ur=Ur<=536870912?Hp(2*Ur,16777216):Math.min(Hp((3*Ur+2147483648)/4,16777216),en);return!!WI(Ur)},i:function(je){WA("OOM")},j:function(je){return je},k:HI,l:WI,m:qI,n:function(){var je=qI();return e.extraStackTrace&&(je+="\n"+e.extraStackTrace()),HI(je)},o:24032,p:24016},eu),RU=(e.___uremdi3=Tt.___uremdi3,e._bitshift64Lshr=Tt._bitshift64Lshr,e._bitshift64Shl=Tt._bitshift64Shl,e._calloc=Tt._calloc,e._cellAreaKm2=Tt._cellAreaKm2,e._cellAreaM2=Tt._cellAreaM2,e._cellAreaRads2=Tt._cellAreaRads2,e._compact=Tt._compact,e._destroyLinkedPolygon=Tt._destroyLinkedPolygon,e._edgeLengthKm=Tt._edgeLengthKm,e._edgeLengthM=Tt._edgeLengthM,e._emscripten_replace_memory=Tt._emscripten_replace_memory),QI=(e._exactEdgeLengthKm=Tt._exactEdgeLengthKm,e._exactEdgeLengthM=Tt._exactEdgeLengthM,e._exactEdgeLengthRads=Tt._exactEdgeLengthRads,e._experimentalH3ToLocalIj=Tt._experimentalH3ToLocalIj,e._experimentalLocalIjToH3=Tt._experimentalLocalIjToH3,e._free=Tt._free,e._geoToH3=Tt._geoToH3,e._getDestinationH3IndexFromUnidirectionalEdge=Tt._getDestinationH3IndexFromUnidirectionalEdge,e._getH3IndexesFromUnidirectionalEdge=Tt._getH3IndexesFromUnidirectionalEdge,e._getH3UnidirectionalEdge=Tt._getH3UnidirectionalEdge,e._getH3UnidirectionalEdgeBoundary=Tt._getH3UnidirectionalEdgeBoundary,e._getH3UnidirectionalEdgesFromHexagon=Tt._getH3UnidirectionalEdgesFromHexagon,e._getOriginH3IndexFromUnidirectionalEdge=Tt._getOriginH3IndexFromUnidirectionalEdge,e._getPentagonIndexes=Tt._getPentagonIndexes,e._getRes0Indexes=Tt._getRes0Indexes,e._h3Distance=Tt._h3Distance,e._h3GetBaseCell=Tt._h3GetBaseCell,e._h3GetFaces=Tt._h3GetFaces,e._h3GetResolution=Tt._h3GetResolution,e._h3IndexesAreNeighbors=Tt._h3IndexesAreNeighbors,e._h3IsPentagon=Tt._h3IsPentagon,e._h3IsResClassIII=Tt._h3IsResClassIII,e._h3IsValid=Tt._h3IsValid,e._h3Line=Tt._h3Line,e._h3LineSize=Tt._h3LineSize,e._h3SetToLinkedGeo=Tt._h3SetToLinkedGeo,e._h3ToCenterChild=Tt._h3ToCenterChild,e._h3ToChildren=Tt._h3ToChildren,e._h3ToGeo=Tt._h3ToGeo,e._h3ToGeoBoundary=Tt._h3ToGeoBoundary,e._h3ToParent=Tt._h3ToParent,e._h3UnidirectionalEdgeIsValid=Tt._h3UnidirectionalEdgeIsValid,e._hexAreaKm2=Tt._hexAreaKm2,e._hexAreaM2=Tt._hexAreaM2,e._hexRing=Tt._hexRing,e._i64Subtract=Tt._i64Subtract,e._kRing=Tt._kRing,e._kRingDistances=Tt._kRingDistances,e._llvm_minnum_f64=Tt._llvm_minnum_f64,e._llvm_round_f64=Tt._llvm_round_f64,e._malloc=Tt._malloc,e._maxFaceCount=Tt._maxFaceCount,e._maxH3ToChildrenSize=Tt._maxH3ToChildrenSize,e._maxKringSize=Tt._maxKringSize,e._maxPolyfillSize=Tt._maxPolyfillSize,e._maxUncompactSize=Tt._maxUncompactSize,e._memcpy=Tt._memcpy,e._memset=Tt._memset,e._numHexagons=Tt._numHexagons,e._pentagonIndexCount=Tt._pentagonIndexCount,e._pointDistKm=Tt._pointDistKm,e._pointDistM=Tt._pointDistM,e._pointDistRads=Tt._pointDistRads,e._polyfill=Tt._polyfill,e._res0IndexCount=Tt._res0IndexCount,e._round=Tt._round,e._sbrk=Tt._sbrk,e._sizeOfCoordIJ=Tt._sizeOfCoordIJ,e._sizeOfGeoBoundary=Tt._sizeOfGeoBoundary,e._sizeOfGeoCoord=Tt._sizeOfGeoCoord,e._sizeOfGeoPolygon=Tt._sizeOfGeoPolygon,e._sizeOfGeofence=Tt._sizeOfGeofence,e._sizeOfH3Index=Tt._sizeOfH3Index,e._sizeOfLinkedGeoPolygon=Tt._sizeOfLinkedGeoPolygon,e._uncompact=Tt._uncompact,e.establishStackSpace=Tt.establishStackSpace,e.stackAlloc=Tt.stackAlloc),FU=e.stackRestore=Tt.stackRestore,OU=e.stackSave=Tt.stackSave;if(e.asm=Tt,e.cwrap=function(je,st,It,en){var p=(It=It||[]).every(function(br){return"number"===br});return"string"!==st&&p&&!en?He(je):function(){return Rt(je,st,It,arguments)}},e.setValue=function(je,st,It,en){switch("*"===(It=It||"i8").charAt(It.length-1)&&(It="i32"),It){case"i1":case"i8":ul[je>>0]=st;break;case"i16":qA[je>>1]=st;break;case"i32":dd[je>>2]=st;break;case"i64":ww=[st>>>0,(qp=st,+mU(qp)>=1?qp>0?(0|yU(+_U(qp/4294967296),4294967295))>>>0:~~+gU((qp-+(~~qp>>>0))/4294967296)>>>0:0)],dd[je>>2]=ww[0],dd[je+4>>2]=ww[1];break;case"float":yw[je>>2]=st;break;case"double":vw[je>>3]=st;break;default:WA("invalid type for setValue: "+It)}},e.getValue=function(je,st,It){switch("*"===(st=st||"i8").charAt(st.length-1)&&(st="i32"),st){case"i1":case"i8":return ul[je>>0];case"i16":return qA[je>>1];case"i32":case"i64":return dd[je>>2];case"float":return yw[je>>2];case"double":return vw[je>>3];default:WA("invalid type for getValue: "+st)}return null},e.getTempRet0=K,uh){$I(uh)||(je=uh,uh=e.locateFile?e.locateFile(je,c):c+je),ZA++,e.monitorRunDependencies&&e.monitorRunDependencies(ZA);var Ew=function(je){je.byteLength&&(je=new Uint8Array(je)),tu.set(je,8),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,function(je){if(ZA--,e.monitorRunDependencies&&e.monitorRunDependencies(ZA),0==ZA&&(null!==xw&&(clearInterval(xw),xw=null),p0)){var st=p0;p0=null,st()}}()},XI=function(){w(uh,Ew,function(){throw"could not load memory initializer "+uh})},YI=Cw(uh);if(YI)Ew(YI.buffer);else if(e.memoryInitializerRequest){var KI=function(){var je=e.memoryInitializerRequest,st=je.response;if(200!==je.status&&0!==je.status){var It=Cw(e.memoryInitializerRequestURL);if(!It)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+je.status+", retrying "+uh),void XI();st=It.buffer}Ew(st)};e.memoryInitializerRequest.response?setTimeout(KI,0):e.memoryInitializerRequest.addEventListener("load",KI)}else XI()}function Dw(je){function st(){ov||(ov=!0,!Re&&(iv(lU),iv(cU),e.onRuntimeInitialized&&e.onRuntimeInitialized(),function(){if(e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)je=e.postRun.shift(),jI.unshift(je);var je;iv(jI)}()))}je=je||s,ZA>0||(function(){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)je=e.preRun.shift(),UI.unshift(je);var je;iv(UI)}(),ZA>0)||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),st()},1)):st())}function WA(je){throw e.onAbort&&e.onAbort(je),I(je+=""),L(je),Re=!0,"abort("+je+"). Build with -s ASSERTIONS=1 for more info."}if(p0=function je(){ov||Dw(),ov||(p0=je)},e.run=Dw,e.abort=WA,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Dw(),n}("object"==typeof mt?mt:{}),Jt="number",Vt={};[["sizeOfH3Index",Jt],["sizeOfGeoCoord",Jt],["sizeOfGeoBoundary",Jt],["sizeOfGeoPolygon",Jt],["sizeOfGeofence",Jt],["sizeOfLinkedGeoPolygon",Jt],["sizeOfCoordIJ",Jt],["h3IsValid",Jt,[Jt,Jt]],["geoToH3",Jt,[Jt,Jt,Jt]],["h3ToGeo",null,[Jt,Jt,Jt]],["h3ToGeoBoundary",null,[Jt,Jt,Jt]],["maxKringSize",Jt,[Jt]],["kRing",null,[Jt,Jt,Jt,Jt]],["kRingDistances",null,[Jt,Jt,Jt,Jt,Jt]],["hexRing",null,[Jt,Jt,Jt,Jt]],["maxPolyfillSize",Jt,[Jt,Jt]],["polyfill",null,[Jt,Jt,Jt]],["h3SetToLinkedGeo",null,[Jt,Jt,Jt]],["destroyLinkedPolygon",null,[Jt]],["compact",Jt,[Jt,Jt,Jt]],["uncompact",Jt,[Jt,Jt,Jt,Jt,Jt]],["maxUncompactSize",Jt,[Jt,Jt,Jt]],["h3IsPentagon",Jt,[Jt,Jt]],["h3IsResClassIII",Jt,[Jt,Jt]],["h3GetBaseCell",Jt,[Jt,Jt]],["h3GetResolution",Jt,[Jt,Jt]],["maxFaceCount",Jt,[Jt,Jt]],["h3GetFaces",null,[Jt,Jt,Jt]],["h3ToParent",Jt,[Jt,Jt,Jt]],["h3ToChildren",null,[Jt,Jt,Jt,Jt]],["h3ToCenterChild",Jt,[Jt,Jt,Jt]],["maxH3ToChildrenSize",Jt,[Jt,Jt,Jt]],["h3IndexesAreNeighbors",Jt,[Jt,Jt,Jt,Jt]],["getH3UnidirectionalEdge",Jt,[Jt,Jt,Jt,Jt]],["getOriginH3IndexFromUnidirectionalEdge",Jt,[Jt,Jt]],["getDestinationH3IndexFromUnidirectionalEdge",Jt,[Jt,Jt]],["h3UnidirectionalEdgeIsValid",Jt,[Jt,Jt]],["getH3IndexesFromUnidirectionalEdge",null,[Jt,Jt,Jt]],["getH3UnidirectionalEdgesFromHexagon",null,[Jt,Jt,Jt]],["getH3UnidirectionalEdgeBoundary",null,[Jt,Jt,Jt]],["h3Distance",Jt,[Jt,Jt,Jt,Jt]],["h3Line",Jt,[Jt,Jt,Jt,Jt,Jt]],["h3LineSize",Jt,[Jt,Jt,Jt,Jt]],["experimentalH3ToLocalIj",Jt,[Jt,Jt,Jt,Jt,Jt]],["experimentalLocalIjToH3",Jt,[Jt,Jt,Jt,Jt]],["hexAreaM2",Jt,[Jt]],["hexAreaKm2",Jt,[Jt]],["edgeLengthM",Jt,[Jt]],["edgeLengthKm",Jt,[Jt]],["pointDistM",Jt,[Jt,Jt]],["pointDistKm",Jt,[Jt,Jt]],["pointDistRads",Jt,[Jt,Jt]],["cellAreaM2",Jt,[Jt,Jt]],["cellAreaKm2",Jt,[Jt,Jt]],["cellAreaRads2",Jt,[Jt,Jt]],["exactEdgeLengthM",Jt,[Jt,Jt]],["exactEdgeLengthKm",Jt,[Jt,Jt]],["exactEdgeLengthRads",Jt,[Jt,Jt]],["numHexagons",Jt,[Jt]],["getRes0Indexes",null,[Jt]],["res0IndexCount",Jt],["getPentagonIndexes",null,[Jt,Jt]],["pentagonIndexCount",Jt]].forEach(function(e){Vt[e[0]]=mt.cwrap.apply(mt,e)}),Vt.sizeOfH3Index(),Vt.sizeOfGeoCoord();var DT=Vt.sizeOfGeoBoundary();Vt.sizeOfGeoPolygon(),Vt.sizeOfGeofence(),Vt.sizeOfLinkedGeoPolygon(),Vt.sizeOfCoordIJ();var j8=/[^0-9a-fA-F]/;function Zy(n){return function(n){return 180*n/Math.PI}(mt.getValue(n,"double"))}function Wb(n){return[Zy(n),Zy(n+8)]}function FT(n){return[Zy(n+8),Zy(n)]}let LT=(()=>{class n{constructor(){}getGeojsonForHex(t){return{type:"Polygon",coordinates:[function(n,e){var t=mt._malloc(DT),r=function(n){if(Array.isArray(n)&&2===n.length&&Number.isInteger(n[0])&&Number.isInteger(n[1]))return n;if("string"!=typeof n||j8.test(n))return[0,0];var e=parseInt(n.substring(0,n.length-8),16);return[parseInt(n.substring(n.length-8),16),e]}(n);Vt.h3ToGeoBoundary(r[0],r[1],t);var m=function(n,e,t){for(var r=mt.getValue(n,"i32"),s=n+8,c=[],m=e?FT:Wb,w=0;w<2*r;w+=2)c.push(m(s+8*w));return t&&c.push(c[0]),c}(t,true,true);return mt._free(t),m}(t).map(c=>c)]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),BT=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(At(eh),At(To))},n.\u0275dir=Wt({type:n}),n})(),$A=(()=>{class n extends BT{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Wt({type:n,features:[si]}),n})();const Jc=new rn("NgValueAccessor"),e6={provide:Jc,useExisting:$n(()=>Xb),multi:!0},n6=new rn("CompositionEventMode");let Xb=(()=>{class n extends BT{constructor(t,r,s){super(t,r),this._compositionMode=s,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const n=Xc()?Xc().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(At(eh),At(To),At(n6,8))},n.\u0275dir=Wt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,r){1&t&&Ui("input",function(c){return r._handleInput(c.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(c){return r._compositionEnd(c.target.value)})},features:[ai([e6]),si]}),n})();const ls=new rn("NgValidators"),ad=new rn("NgAsyncValidators");function WT(n){return null!=n}function QT(n){const e=mg(n)?Pr(n):n;return T_(e),e}function XT(n){let e={};return n.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function YT(n,e){return e.map(t=>t(n))}function KT(n){return n.map(e=>function(n){return!n.validate}(e)?e:t=>e.validate(t))}function Yb(n){return null!=n?function(n){if(!n)return null;const e=n.filter(WT);return 0==e.length?null:function(t){return XT(YT(t,e))}}(KT(n)):null}function Kb(n){return null!=n?function(n){if(!n)return null;const e=n.filter(WT);return 0==e.length?null:function(t){return hT(YT(t,e).map(QT)).pipe(fn(XT))}}(KT(n)):null}function tI(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Jb(n){return n?Array.isArray(n)?n:[n]:[]}function Wy(n,e){return Array.isArray(n)?n.includes(e):n===e}function iI(n,e){const t=Jb(e);return Jb(n).forEach(s=>{Wy(t,s)||t.push(s)}),t}function oI(n,e){return Jb(e).filter(t=>!Wy(n,t))}let sI=(()=>{class n{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Yb(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=Kb(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,r){return!!this.control&&this.control.hasError(t,r)}getError(t,r){return this.control?this.control.getError(t,r):null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Wt({type:n}),n})(),Os=(()=>{class n extends sI{get formDirective(){return null}get path(){return null}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Wt({type:n,features:[si]}),n})();class cd extends sI{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let lI=(()=>{class n extends class{constructor(e){this._cd=e}is(e){var t,r,s;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(s=null===(r=this._cd)||void 0===r?void 0:r.control)||void 0===s?void 0:s[e])}}{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(At(cd,2))},n.\u0275dir=Wt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,r){2&t&&gg("ng-untouched",r.is("untouched"))("ng-touched",r.is("touched"))("ng-pristine",r.is("pristine"))("ng-dirty",r.is("dirty"))("ng-valid",r.is("valid"))("ng-invalid",r.is("invalid"))("ng-pending",r.is("pending"))},features:[si]}),n})();function h0(n,e){(function(n,e){const t=function(n){return n._rawValidators}(n);null!==e.validator?n.setValidators(tI(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const r=function(n){return n._rawAsyncValidators}(n);null!==e.asyncValidator?n.setAsyncValidators(tI(r,e.asyncValidator)):"function"==typeof r&&n.setAsyncValidators([r]);const s=()=>n.updateValueAndValidity();Ky(e._rawValidators,s),Ky(e._rawAsyncValidators,s)})(n,e),e.valueAccessor.writeValue(n.value),function(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&cI(n,e)})}(n,e),function(n,e){const t=(r,s)=>{e.valueAccessor.writeValue(r),s&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&cI(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function(n,e){if(e.valueAccessor.setDisabledState){const t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function Ky(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function cI(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function ev(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const d0="VALID",tv="INVALID",Gp="PENDING",A0="DISABLED";function ow(n){return(aw(n)?n.validators:n)||null}function dI(n){return Array.isArray(n)?Yb(n):n||null}function sw(n,e){return(aw(e)?e.asyncValidators:n)||null}function AI(n){return Array.isArray(n)?Kb(n):n||null}function aw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class lw{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=dI(this._rawValidators),this._composedAsyncValidatorFn=AI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===d0}get invalid(){return this.status===tv}get pending(){return this.status==Gp}get disabled(){return this.status===A0}get enabled(){return this.status!==A0}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=dI(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=AI(e)}addValidators(e){this.setValidators(iI(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(iI(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(oI(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(oI(e,this._rawAsyncValidators))}hasValidator(e){return Wy(this._rawValidators,e)}hasAsyncValidator(e){return Wy(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Gp,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=A0,this.errors=null,this._forEachChild(r=>{r.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=d0,this._forEachChild(r=>{r.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===d0||this.status===Gp)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?A0:d0}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Gp,this._hasOwnPendingAsyncValidator=!0;const t=QT(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(n,e,t){if(null==e||(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length))return null;let r=n;return e.forEach(s=>{r=r instanceof cw?r.controls.hasOwnProperty(s)?r.controls[s]:null:r instanceof g6&&r.at(s)||null}),r}(this,e)}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new lt,this.statusChanges=new lt}_calculateStatus(){return this._allControlsDisabled()?A0:this.errors?tv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Gp)?Gp:this._anyControlsHaveStatus(tv)?tv:d0}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){aw(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class nv extends lw{constructor(e=null,t,r){super(ow(t),sw(r,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){ev(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){ev(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class cw extends lw{constructor(e,t,r){super(ow(t),sw(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,s)=>{r.reset(e[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t instanceof nv?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const r=this.controls[t];if(this.contains(t)&&e(r))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,r)=>((t.enabled||this.disabled)&&(e[r]=t.value),e))}_reduceChildren(e,t){let r=e;return this._forEachChild((s,c)=>{r=t(r,s,c)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class g6 extends lw{constructor(e,t,r){super(ow(t),sw(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((r,s)=>{this._throwIfControlMissing(s),this.at(s).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((r,s)=>{this.at(s)&&this.at(s).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,s)=>{r.reset(e[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof nv?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const v6={provide:cd,useExisting:$n(()=>hw)},mI=(()=>Promise.resolve(null))();let hw=(()=>{class n extends cd{constructor(t,r,s,c){super(),this.control=new nv,this._registered=!1,this.update=new lt,this._parent=t,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=function(n,e){if(!e)return null;let t,r,s;return Array.isArray(e),e.forEach(c=>{c.constructor===Xb?t=c:function(n){return Object.getPrototypeOf(n.constructor)===$A}(c)?r=c:s=c}),s||r||t||null}(0,c)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?function(n,e){return[...e.path,n]}(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){h0(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){mI.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const r=t.isDisabled.currentValue,s=""===r||r&&"false"!==r;mI.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable()})}}return n.\u0275fac=function(t){return new(t||n)(At(Os,9),At(ls,10),At(ad,10),At(Jc,10))},n.\u0275dir=Wt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ai([v6]),si,Zr]}),n})(),_I=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({}),n})();const dw=new rn("NgModelWithFormControlWarning"),k6={provide:Jc,useExisting:$n(()=>rv),multi:!0};function CI(n,e){return null==n?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let rv=(()=>{class n extends $A{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const r=this._getOptionId(t);null==r&&this.setProperty("selectedIndex",-1);const s=CI(r,t);this.setProperty("value",s)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function(n){return n.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Wt({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,r){1&t&&Ui("change",function(c){return r.onChange(c.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[ai([k6]),si]}),n})(),EI=(()=>{class n{constructor(t,r,s){this._element=t,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(CI(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(At(To),At(eh),At(rv,9))},n.\u0275dir=Wt({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})();const R6={provide:Jc,useExisting:$n(()=>mw),multi:!0};function DI(n,e){return null==n?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let mw=(()=>{class n extends $A{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const s=t.map(c=>this._getOptionId(c));r=(c,m)=>{c._setSelected(s.indexOf(m.toString())>-1)}}else r=(s,c)=>{s._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const s=[];if(void 0!==r.selectedOptions){const c=r.selectedOptions;for(let m=0;m<c.length;m++){const w=c.item(m),I=this._getOptionValue(w.value);s.push(I)}}else{const c=r.options;for(let m=0;m<c.length;m++){const w=c.item(m);if(w.selected){const I=this._getOptionValue(w.value);s.push(I)}}}this.value=s,t(s)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function(n){return n.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Wt({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,r){1&t&&Ui("change",function(c){return r.onChange(c.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[ai([R6]),si]}),n})(),SI=(()=>{class n{constructor(t,r,s){this._element=t,this._renderer=r,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(DI(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(DI(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(At(To),At(eh),At(mw,9))},n.\u0275dir=Wt({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})(),BI=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({imports:[[_I]]}),n})(),$6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({imports:[BI]}),n})(),G6=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:dw,useValue:t.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n}),n.\u0275inj=_r({imports:[BI]}),n})();function H6(n,e){if(1&n&&(dn(0,"option",25),Mo(1),An()),2&n){const t=e.$implicit;Hr("ngValue",t.id),Or(1),MA(t.name)}}function q6(n,e){if(1&n){const t=pg();dn(0,"div",7),dn(1,"span",8),Mo(2,"City"),An(),dn(3,"div",9),dn(4,"select",10),Ui("ngModelChange",function(s){return Dl(t),rl().currentCityId=s})("ngModelChange",function(){return Dl(t),rl().onCitySelect()}),Ul(5,H6,2,2,"option",11),An(),An(),An()}if(2&n){const t=rl();Or(4),Hr("ngModel",t.currentCityId),Or(1),Hr("ngForOf",t.cities)}}function Z6(n,e){if(1&n&&(dn(0,"option",25),Mo(1),An()),2&n){const t=e.$implicit;Hr("ngValue",t.id),Or(1),MA(t.name)}}function W6(n,e){if(1&n){const t=pg();dn(0,"div",7),dn(1,"span",8),Mo(2,"Classifier"),An(),dn(3,"div",9),dn(4,"select",10),Ui("ngModelChange",function(s){return Dl(t),rl().currentClassifierId=s})("ngModelChange",function(){return Dl(t),rl().onClassifierSelect()}),dn(5,"option",25),Mo(6,"No classifier"),An(),Ul(7,Z6,2,2,"option",11),An(),An(),An()}if(2&n){const t=rl();Or(4),Hr("ngModel",t.currentClassifierId),Or(1),Hr("ngValue",null),Or(2),Hr("ngForOf",t.classifiers)}}function Q6(n,e){if(1&n&&(dn(0,"option",25),Mo(1),An()),2&n){const t=e.$implicit;Hr("ngValue",t),Or(1),k_("",100*t,"%")}}function X6(n,e){if(1&n){const t=pg();dn(0,"div",7),dn(1,"span",8),Mo(2,"Opacity"),An(),dn(3,"div",9),dn(4,"select",10),Ui("ngModelChange",function(s){return Dl(t),rl().currentOpacity=s}),Ul(5,Q6,2,2,"option",11),An(),An(),An()}if(2&n){const t=rl();Or(4),Hr("ngModel",t.currentOpacity),Or(1),Hr("ngForOf",t.opacities)}}function Y6(n,e){if(1&n&&(dn(0,"option",25),Mo(1),An()),2&n){const t=e.$implicit;Hr("ngValue",t.name),Or(1),MA(t.name)}}function K6(n,e){if(1&n){const t=pg();dn(0,"div",7),dn(1,"span",8),Mo(2,"Gradient"),An(),dn(3,"div",9),dn(4,"select",10),Ui("ngModelChange",function(s){return Dl(t),rl().currentGradientName=s}),Ul(5,Y6,2,2,"option",11),An(),An(),An()}if(2&n){const t=rl();Or(4),il(t.getGradientCss(t.currentGradient.colors)),Hr("ngModel",t.currentGradientName),Or(1),Hr("ngForOf",t.gradients)}}function J6(n,e){if(1&n&&(dn(0,"option",25),Mo(1),An()),2&n){const t=e.$implicit;Hr("ngValue",t),Or(1),MA(t.name)}}function eU(n,e){1&n&&(dn(0,"div",26),dn(1,"span",27),Mo(2,"Loading data"),An(),An()),2&n&&gg("is-loading",rl().loading)}const _w=function(n){return[n]},tU=function(n){return{"is-active":n}};let rU=(()=>{class n{constructor(t,r,s,c,m){this.titleService=t,this.googleSheetsDownloaderService=r,this.googleDriveDownloaderService=s,this.h3Service=c,this.sanitizer=m,this.title="Transfer learning approach to bicycle-sharing systems\u2019 station location planning using OpenStreetMap data",this.isModalActive=!1,this.loading=!1,this.initialized=!1,this.renderHexes=!1,this.currentCityId=1,this.currentClassifierId=null,this.currentOpacity=.5,this.currentGradientName="Sunset",this.opacities=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1],this.mapStyles=[{name:"Basic",styleUrl:"basic-v9"},{name:"Streets",styleUrl:"streets-v11"},{name:"Light",styleUrl:"light-v10"},{name:"Dark",styleUrl:"dark-v10"},{name:"Satellite",styleUrl:"satellite-v9"},{name:"Satellite streets",styleUrl:"satellite-streets-v11"}],this.gradients=[{name:"PinkYl",colors:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"]},{name:"Sunset",colors:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"]},{name:"SunsetDark",colors:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"]},{name:"Mint",colors:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"]},{name:"DarkMint",colors:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"]},{name:"TealGrn",colors:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"]},{name:"PurpOr",colors:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"]},{name:"Magenta",colors:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"]},{name:"Peach",colors:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"]},{name:"BluYl",colors:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"]},{name:"Emrld",colors:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"]},{name:"Temps",colors:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"]},{name:"Geyser",colors:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"]},{name:"Earth",colors:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"]},{name:"TealRose",colors:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"]},{name:"ArmyRose",colors:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"]}],this.cities=[],this.classifiers=[],this.currentHexes=[],this.currentGeojsonData=null,this.popup=new Vp.Popup({closeButton:!1,closeOnClick:!1}),this.currentPopupId=null,this.titleService.setTitle(this.title)}toggleModal(){this.isModalActive=!this.isModalActive}ngOnInit(){this.loading=!0,this.currentMapStyle=this.mapStyles[0],this.generateGeojsonData()}ngAfterViewInit(){hT([this.googleSheetsDownloaderService.getCities(),this.googleSheetsDownloaderService.getClassifiers()]).subscribe(([s,c])=>{this.loading=!1,this.cities=s.sort((m,w)=>m.name>w.name?1:-1),this.classifiers=c.sort((m,w)=>m.name>w.name?1:-1),this.currentCityId=this.cities[Math.floor(Math.random()*this.cities.length)].id,this.initialized=!0,this.onCitySelect()})}get currentGradient(){return this.gradients.find(t=>t.name===this.currentGradientName)}get currentCity(){var t=this.cities.find(r=>r.id==this.currentCityId);if(void 0===t)throw new Error("City get error: "+this.currentCityId);return t}getMapStyle(){return`mapbox://styles/mapbox/${this.currentMapStyle.styleUrl}`}generateGeojsonData(){var t={type:"FeatureCollection",features:this.currentHexes.map(r=>({type:"Feature",geometry:this.h3Service.getGeojsonForHex(r.hex),properties:{value:r.value}}))};this.currentGeojsonData=t}onCitySelect(){var t,r;this.map.mapInstance.getLayer("hex")&&this.map.mapInstance.setLayoutProperty("hex","visibility","none"),this.loading=!0,this.center=[null===(t=this.currentCity)||void 0===t?void 0:t.lon,null===(r=this.currentCity)||void 0===r?void 0:r.lat],this.zoom=12,this.pitch=0,this.bearing=0,this.loading=!1,this.onClassifierSelect()}interpolateGradient(){var t=this.gradients.find(c=>c.name===this.currentGradientName),r=[],s=t.colors.length;return t.colors.forEach((c,m)=>{r.push(m/(s-1)),r.push(c)}),r}getGradientCss(t){var r="",s=t.length;return t.forEach((c,m)=>{r+=`${c} ${100*m/(s-1)}%`,m<s-1&&(r+=", ")}),this.sanitizer.bypassSecurityTrustStyle(`background-image: linear-gradient(90deg, ${r});`)}getPaint(){return{"fill-color":["interpolate",["linear"],["get","value"],...this.interpolateGradient()],"fill-opacity":this.currentOpacity,"fill-antialias":!1}}showPopup(t){var r;if((null===(r=t.features)||void 0===r?void 0:r.length)>0){var s=t.features[0].properties.value;this.currentPopupId!==t.features[0].id&&(this.popup.remove(),this.popup.setLngLat(t.lngLat).setText(s).addTo(this.map.mapInstance))}}hidePopup(t){this.popup.remove()}onClassifierSelect(){this.loading=!0,this.renderHexes=!1,this.map.mapInstance.getLayer("hex")&&this.map.mapInstance.setLayoutProperty("hex","visibility","none"),this.currentClassifierId?this.googleDriveDownloaderService.getHexData(this.currentCityId,this.currentClassifierId).subscribe(t=>{this.currentHexes=t,this.generateGeojsonData(),this.loading=!1,this.map.mapInstance.setLayoutProperty("hex","visibility","visible")},t=>{console.log(t.message),console.log(t),this.currentHexes=[],this.generateGeojsonData(),this.loading=!1},()=>{this.loading=!1}):(this.currentHexes=[],this.generateGeojsonData(),this.loading=!1)}}return n.\u0275fac=function(t){return new(t||n)(At(HS),At(Hb),At(CT),At(LT),At(wy))},n.\u0275cmp=Ha({type:n,selectors:[["app-root"]],viewQuery:function(t,r){if(1&t&&hx(uT,5),2&t){let s;Bg(s=Ng())&&(r.map=s.first)}},decls:36,vars:26,consts:[["role","navigation","aria-label","main navigation",1,"navbar"],[1,"navbar-brand"],[1,"navbar-item","is-size-3","has-text-weight-medium"],["id","navbarBasicExample",1,"navbar-menu"],[1,"navbar-start"],["class","navbar-item",4,"ngIf"],[1,"navbar-end"],[1,"navbar-item"],[1,"pr-2"],[1,"select","is-rounded"],[3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"button","is-rounded",3,"click"],["src","assets/pwr_logo.svg",2,"max-height","3rem"],[1,"map-container"],["id","loading-overlay",3,"is-loading",4,"ngIf"],["movingMethod","jumpTo",3,"zoom","center","pitch","bearing","interactive"],["id","hex",3,"data"],["id","hex","type","fill","source","hex",3,"paint","layerMouseMove","layerMouseOut"],[1,"modal",3,"ngClass"],[1,"modal-background",3,"click"],[1,"modal-content"],[1,"is-size-3","has-text-centered"],[1,"is-size-4","has-text-centered"],[1,"is-size-6","has-text-centered"],[3,"ngValue"],["id","loading-overlay"],[1,"is-size-3",2,"margin","0 auto"]],template:function(t,r){1&t&&(dn(0,"nav",0),dn(1,"div",1),dn(2,"h3",2),Mo(3," OSM \u2794 BSS "),An(),An(),dn(4,"div",3),dn(5,"div",4),Ul(6,q6,6,2,"div",5),Ul(7,W6,8,3,"div",5),Ul(8,X6,6,2,"div",5),Ul(9,K6,6,4,"div",5),An(),dn(10,"div",6),dn(11,"div",7),dn(12,"span",8),Mo(13,"Map style"),An(),dn(14,"div",9),dn(15,"select",10),Ui("ngModelChange",function(c){return r.currentMapStyle=c}),Ul(16,J6,2,2,"option",11),An(),An(),An(),dn(17,"div",7),dn(18,"button",12),Ui("click",function(){return r.toggleModal()}),Mo(19,"About"),An(),An(),dn(20,"div",7),fg(21,"img",13),An(),An(),An(),An(),dn(22,"div",14),Ul(23,eU,3,2,"div",15),dn(24,"mgl-map",16),fg(25,"mgl-geojson-source",17),dn(26,"mgl-layer",18),Ui("layerMouseMove",function(c){return r.showPopup(c)})("layerMouseOut",function(c){return r.hidePopup(c)}),An(),An(),An(),dn(27,"div",19),dn(28,"div",20),Ui("click",function(){return r.toggleModal()}),An(),dn(29,"div",21),dn(30,"h2",22),Mo(31),An(),dn(32,"h4",23),Mo(33,"Kamil Raczycki | Piotr Szyma\u0144ski"),An(),dn(34,"div",24),Mo(35,"Advances in Intelligent and Resilient Cities - 2021"),An(),An(),An()),2&t&&(Or(6),Hr("ngIf",r.initialized),Or(1),Hr("ngIf",r.initialized),Or(1),Hr("ngIf",r.initialized),Or(1),Hr("ngIf",r.initialized),Or(6),Hr("ngModel",r.currentMapStyle),Or(1),Hr("ngForOf",r.mapStyles),Or(7),Hr("ngIf",r.loading),Or(1),il(r.getMapStyle()),Hr("zoom",Rg(18,_w,r.zoom))("center",r.center)("pitch",Rg(20,_w,r.pitch))("bearing",Rg(22,_w,r.bearing))("interactive",!0),Or(1),Hr("data",r.currentGeojsonData),Or(1),Hr("paint",r.getPaint()),Or(1),Hr("ngClass",Rg(24,tU,r.isModalActive)),Or(4),MA(r.title))},directives:[ES,rv,lI,hw,wS,uT,p8,m8,bS,EI,SI],styles:["[_nghost-%COMP%]{height:100vh;display:flex;flex:1;flex-direction:column}@supports ((-webkit-backdrop-filter: none) or (backdrop-filter: none)){.modal-background[_ngcontent-%COMP%], #loading-overlay[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}}.modal-background[_ngcontent-%COMP%]{background:transparent}.modal-content[_ngcontent-%COMP%]{background-color:#ffffff80;padding:3em;border-radius:2rem;width:80vw}.map-container[_ngcontent-%COMP%]{flex:1;position:relative}.map-container[_ngcontent-%COMP%]   #loading-overlay[_ngcontent-%COMP%], .map-container[_ngcontent-%COMP%]   mgl-map[_ngcontent-%COMP%], .map-container[_ngcontent-%COMP%]   #deck-container[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0}.map-container[_ngcontent-%COMP%]   #loading-overlay[_ngcontent-%COMP%]{z-index:20;align-items:center;display:flex;pointer-events:none;opacity:0;transition:opacity .6s linear}.map-container[_ngcontent-%COMP%]   .is-loading[_ngcontent-%COMP%]{opacity:1!important}.map-container[_ngcontent-%COMP%]   #deck-container[_ngcontent-%COMP%]{z-index:10}"]}),n})(),iU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=qi({type:n,bootstrap:[rU]}),n.\u0275inj=_r({providers:[{provide:Gb,useValue:"AIzaSyDVc71t2FNSlJ5sko_IZBGZVre45bYA94U"},Hb,CT,LT],imports:[[i5,WV,F8,_8.withConfig({accessToken:"pk.eyJ1IjoicmFjemVxIiwiYSI6ImNrb2Fmd3E3cjJwYmIyd2xwa2IwZGhxaXkifQ.VrDUIhReRiZxENDHOzCgqw"}),$6,G6]]}),n})();(function(){if(MD)throw new Error("Cannot enable prod mode after platform setup.");SD=!1})(),n5().bootstrapModule(iU).catch(n=>console.error(n))}},_d=>{_d(_d.s=610)}]);