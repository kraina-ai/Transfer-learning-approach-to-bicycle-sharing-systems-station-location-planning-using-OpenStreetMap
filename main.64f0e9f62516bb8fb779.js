(self.webpackChunkangular_kepler_test_app=self.webpackChunkangular_kepler_test_app||[]).push([[179],{255:xd=>{function js(Ba){return Promise.resolve().then(()=>{var Gs=new Error("Cannot find module '"+Ba+"'");throw Gs.code="MODULE_NOT_FOUND",Gs})}js.keys=()=>[],js.resolve=js,js.id=255,xd.exports=js},958:function(xd){xd.exports=function(){"use strict";var js,Ba,Gs;function bd(g,Co){if(js)if(Ba){var Ho="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+js+")(sharedChunk); ("+Ba+")(sharedChunk); self.onerror = null;",fo={};js(fo),Gs=Co(fo),"undefined"!=typeof window&&(Gs.workerUrl=window.URL.createObjectURL(new Blob([Ho],{type:"text/javascript"})))}else Ba=Co;else js=Co}return bd(0,function(g){var Ho=fo;function fo(a,i,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=l,this.p2y=u}fo.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},fo.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},fo.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},fo.prototype.solveCurveX=function(a,i){var l,u,f,x,b;for(void 0===i&&(i=1e-6),f=a,b=0;b<8;b++){if(x=this.sampleCurveX(f)-a,Math.abs(x)<i)return f;var M=this.sampleCurveDerivativeX(f);if(Math.abs(M)<1e-6)break;f-=x/M}if((f=a)<(l=0))return l;if(f>(u=1))return u;for(;l<u;){if(x=this.sampleCurveX(f),Math.abs(x-a)<i)return f;a>x?l=f:u=f,f=.5*(u-l)+l}return f},fo.prototype.solve=function(a,i){return this.sampleCurveY(this.solveCurveX(a,i))};var ut=st;function st(a,i){this.x=a,this.y=i}st.prototype={clone:function(){return new st(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,i){return this.clone()._rotateAround(a,i)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var i=a.x-this.x,l=a.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult:function(a){var i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var i=Math.cos(a),l=Math.sin(a),u=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,i){var l=Math.cos(a),u=Math.sin(a),f=i.y+u*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-u*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},st.convert=function(a){return a instanceof st?a:Array.isArray(a)?new st(a[0],a[1]):a};var wt="undefined"!=typeof self?self:{};const ps=Math.pow(2,53)-1,Na=Math.PI/180,cu=180/Math.PI;function $n(a){return a*Na}const uu=[[0,0],[1,0],[1,1],[0,1]];function hu(a){if(a<=0)return 0;if(a>=1)return 1;const i=a*a,l=i*a;return 4*(a<.5?l:3*(a-i)+l-.75)}function za(a,i,l,u){const f=new Ho(a,i,l,u);return function(x){return f.solve(x)}}const ms=za(.25,.1,.25,1);function ui(a,i,l){return Math.min(l,Math.max(i,a))}function Va(a,i,l){const u=l-i,f=((a-i)%u+u)%u+i;return f===i?l:f}function du(a,i,l){if(!a.length)return l(null,[]);let u=a.length;const f=new Array(a.length);let x=null;a.forEach((b,M)=>{i(b,(P,F)=>{P&&(x=P),f[M]=F,0==--u&&l(x,f)})})}function Gn(a){const i=[];for(const l in a)i.push(a[l]);return i}function hi(a,...i){for(const l of i)for(const u in l)a[u]=l[u];return a}let of=1;function gs(){return of++}function yl(){return function a(i){return i?(i^16*Math.random()>>i/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function vl(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function _i(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function sc(a,i){a.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function _s(a,i){return-1!==a.indexOf(i,a.length-i.length)}function An(a,i,l){const u={};for(const f in a)u[f]=i.call(l||this,a[f],f,a);return u}function qo(a,i,l){const u={};for(const f in a)i.call(l||this,a[f],f,a)&&(u[f]=a[f]);return u}function Or(a){return Array.isArray(a)?a.map(Or):"object"==typeof a&&a?An(a,Or):a}const Ua={};function zr(a){Ua[a]||("undefined"!=typeof console&&console.warn(a),Ua[a]=!0)}function ys(a,i,l){return(l.y-a.y)*(i.x-a.x)>(i.y-a.y)*(l.x-a.x)}function ja(a){let i=0;for(let l,u,f=0,x=a.length,b=x-1;f<x;b=f++)l=a[f],u=a[b],i+=(u.x-l.x)*(l.y+u.y);return i}function xl(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Ga(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,f,x)=>{const b=f||x;return i[u]=!b||b.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let $a,Bn,bl,wl=null;function Au(a){if(null==wl){const i=a.navigator?a.navigator.userAgent:null;wl=!!a.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return wl}function fu(a){try{const i=wt[a];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(i){return!1}}const po={now:()=>void 0!==bl?bl:wt.performance.now(),setNow(a){bl=a},restoreNow(){bl=void 0},frame(a){const i=wt.requestAnimationFrame(a);return{cancel:()=>wt.cancelAnimationFrame(i)}},getImageData(a,i=0){const l=wt.document.createElement("canvas"),u=l.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,u.drawImage(a,0,0,a.width,a.height),u.getImageData(-i,-i,a.width+2*i,a.height+2*i)},resolveURL:a=>($a||($a=wt.document.createElement("a")),$a.href=a,$a.href),get devicePixelRatio(){return wt.devicePixelRatio},get prefersReducedMotion(){return!!wt.matchMedia&&(null==Bn&&(Bn=wt.matchMedia("(prefers-reduced-motion: reduce)")),Bn.matches)}};let pa;const Xn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==pa){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{pa=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(i){pa=a}}return pa},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$s={supported:!1,testSupport:function(a){!ma&&Lr&&(wd?Hs(a):Ha=a)}};let Ha,Lr,ma=!1,wd=!1;function Hs(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Lr),a.isContextLost())return;$s.supported=!0}catch(l){}a.deleteTexture(i),ma=!0}wt.document&&(Lr=wt.document.createElement("img"),Lr.onload=function(){Ha&&Hs(Ha),Ha=null,wd=!0},Lr.onerror=function(){ma=!0,Ha=null},Lr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pu="01",ga="NO_ACCESS_TOKEN";function pr(a){return 0===a.indexOf("mapbox:")}function qa(a){return Xn.API_URL_REGEX.test(a)}const mu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vs(a){const i=a.match(mu);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Zo(a){const i=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${i}`}function Eo(a){if(!a)return null;const i=a.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(wt.atob(i[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class gu{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=Eo(Xn.ACCESS_TOKEN);let u="";return u=l&&l.u?wt.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,x)=>String.fromCharCode(Number("0x"+x)))):Xn.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const i=fu("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{const f=wt.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const x=wt.localStorage.getItem(u);x&&(this.anonId=x)}catch(f){zr("Unable to read from LocalStorage")}}saveEventData(){const i=fu("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(i)try{wt.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&wt.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){zr("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,u,f){if(!Xn.EVENTS_URL)return;const x=vs(Xn.EVENTS_URL);x.params.push(`access_token=${f||Xn.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.5.1",skuId:pu,userId:this.anonId},M=l?hi(b,l):b,P={url:Zo(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Y(P,F=>{this.pendingRequest=null,u(F),this.saveEventData(),this.processRequests(f)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const Cl=new class extends gu{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,i){Xn.EVENTS_URL&&Xn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>pr(l)||qa(l))&&this.queueRequest(Date.now(),i)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Eo(Xn.ACCESS_TOKEN),l=i?i.u:Xn.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;_i(this.anonId)||(this.anonId=yl(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),b=new Date(f),M=(f-this.eventData.lastSuccess)/864e5;u=u||M>=1||M<-1||x.getDate()!==b.getDate()}else u=!0;if(!u)return this.processRequests();this.postEvent(f,{"enabled.telemetry":!1},x=>{x||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a)}},yh=Cl.postTurnstileEvent.bind(Cl),ac=new class extends gu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,i,l,u){this.skuToken=i,this.errorCb=u,Xn.EVENTS_URL&&(l||Xn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ga)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),_i(this.anonId)||(this.anonId=yl()),this.postEvent(l,{skuToken:this.skuToken},u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},a))}},lc=ac.postMapLoadEvent.bind(ac),vh=new class extends gu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,i,l,u){if(!Xn.API_URL||!Xn.SESSION_PATH)return;const f=vs(Xn.API_URL+Xn.SESSION_PATH);f.params.push(`sku=${i||""}`),f.params.push(`access_token=${u||Xn.ACCESS_TOKEN||""}`);const x={url:Zo(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ae(x,b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(u)})}getSessionAPI(a,i,l,u){this.skuToken=i,this.errorCb=u,Xn.SESSION_PATH&&Xn.API_URL&&(l||Xn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ga)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):i&&(this.success[i]=!0)},a)}},Cd=vh.getSessionAPI.bind(vh),cc=new Set,uc="mapbox-tiles";let Wo,Za,xh=500,_u=50;function Pn(){wt.caches&&!Wo&&(Wo=wt.caches.open(uc))}function _a(a){const i=a.indexOf("?");return i<0?a:a.slice(0,i)}let ln=1/0;const ya={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ya);class hc extends Error{constructor(i,l,u){401===l&&qa(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Hn=xl()?()=>self.worker&&self.worker.referrer:()=>("blob:"===wt.location.protocol?wt.parent:wt).location.href,ne=function(a,i){if(!(/^file:/.test(l=a.url)||/^file:/.test(Hn())&&!/^\w+:/.test(l))){if(wt.fetch&&wt.Request&&wt.AbortController&&wt.Request.prototype.hasOwnProperty("signal"))return function(u,f){const x=new wt.AbortController,b=new wt.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Hn(),signal:x.signal});let M=!1,P=!1;const F=(N=b.url).indexOf("sku=")>0&&qa(N);var N;"json"===u.type&&b.headers.set("Accept","application/json");const V=(q,re,oe)=>{if(P)return;if(q&&"SecurityError"!==q.message&&zr(q),re&&oe)return j(re);const Ae=Date.now();wt.fetch(b).then(xe=>{if(xe.ok){const Me=F?xe.clone():null;return j(xe,Me,Ae)}return f(new hc(xe.statusText,xe.status,u.url))}).catch(xe=>{20!==xe.code&&f(new Error(xe.message))})},j=(q,re,oe)=>{("arrayBuffer"===u.type?q.arrayBuffer():"json"===u.type?q.json():q.text()).then(Ae=>{P||(re&&oe&&function(xe,Me,Le){if(Pn(),!Wo)return;const Be={status:Me.status,statusText:Me.statusText,headers:new wt.Headers};Me.headers.forEach((Ue,Ze)=>Be.headers.set(Ze,Ue));const Ne=Ga(Me.headers.get("Cache-Control")||"");Ne["no-store"]||(Ne["max-age"]&&Be.headers.set("Expires",new Date(Le+1e3*Ne["max-age"]).toUTCString()),new Date(Be.headers.get("Expires")).getTime()-Le<42e4||function(Ue,Ze){if(void 0===Za)try{new Response(new ReadableStream),Za=!0}catch(ot){Za=!1}Za?Ze(Ue.body):Ue.blob().then(Ze)}(Me,Ue=>{const Ze=new wt.Response(Ue,Be);Pn(),Wo&&Wo.then(ot=>ot.put(_a(xe.url),Ze)).catch(ot=>zr(ot.message))}))}(b,re,oe),M=!0,f(null,Ae,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(Ae=>{P||f(new Error(Ae.message))})};return F?function(q,re){if(Pn(),!Wo)return re(null);const oe=_a(q.url);Wo.then(Ae=>{Ae.match(oe).then(xe=>{const Me=function(Le){if(!Le)return!1;const Be=new Date(Le.headers.get("Expires")||0),Ne=Ga(Le.headers.get("Cache-Control")||"");return Be>Date.now()&&!Ne["no-cache"]}(xe);Ae.delete(oe),Me&&Ae.put(oe,xe.clone()),re(null,xe,Me)}).catch(re)}).catch(re)}(b,V):V(null,null),{cancel:()=>{P=!0,M||x.abort()}}}(a,i);if(xl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var l;return function(u,f){const x=new wt.XMLHttpRequest;x.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(x.responseType="arraybuffer");for(const b in u.headers)x.setRequestHeader(b,u.headers[b]);return"json"===u.type&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials="include"===u.credentials,x.onerror=()=>{f(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||0===x.status)&&null!==x.response){let b=x.response;if("json"===u.type)try{b=JSON.parse(x.response)}catch(M){return f(M)}f(null,b,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else f(new hc(x.statusText,x.status,u.url))},x.send(u.body),{cancel:()=>x.abort()}}(a,i)},Z=function(a,i){return ne(hi(a,{type:"arrayBuffer"}),i)},Y=function(a,i){return ne(hi(a,{method:"POST"}),i)},ae=function(a,i){return ne(hi(a,{method:"GET"}),i)};function he(a){const i=wt.document.createElement("a");return i.href=a,i.protocol===wt.document.location.protocol&&i.host===wt.document.location.host}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let we,ke;we=[],ke=0;const Ee=function(a,i){if($s.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ke>=Xn.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return we.push(x),x}ke++;let l=!1;const u=()=>{if(!l)for(l=!0,ke--;we.length&&ke<Xn.MAX_PARALLEL_IMAGE_REQUESTS;){const x=we.shift(),{requestParameters:b,callback:M,cancelled:P}=x;P||(x.cancel=Ee(b,M).cancel)}},f=Z(a,(x,b,M,P)=>{u(),x?i(x):b&&(wt.createImageBitmap?function(F,N){const V=new wt.Blob([new Uint8Array(F)],{type:"image/png"});wt.createImageBitmap(V).then(j=>{N(null,j)}).catch(j=>{N(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(F,N)=>i(F,N,M,P)):function(F,N){const V=new wt.Image,j=wt.URL;V.onload=()=>{N(null,V),j.revokeObjectURL(V.src),V.onload=null,wt.requestAnimationFrame(()=>{V.src=be})},V.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const q=new wt.Blob([new Uint8Array(F)],{type:"image/png"});V.src=F.byteLength?j.createObjectURL(q):be}(b,(F,N)=>i(F,N,M,P)))});return{cancel:()=>{f.cancel(),u()}}};function Oe(a,i,l){l[a]&&-1!==l[a].indexOf(i)||(l[a]=l[a]||[],l[a].push(i))}function Ye(a,i,l){if(l&&l[a]){const u=l[a].indexOf(i);-1!==u&&l[a].splice(u,1)}}class ft{constructor(i,l={}){hi(this,l),this.type=i}}class Xe extends ft{constructor(i,l={}){super("error",hi({error:i},l))}}class jt{on(i,l){return this._listeners=this._listeners||{},Oe(i,l,this._listeners),this}off(i,l){return Ye(i,l,this._listeners),Ye(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Oe(i,l,this._oneTimeListeners),this):new Promise(u=>this.once(i,u))}fire(i,l){"string"==typeof i&&(i=new ft(i,l||{}));const u=i.type;if(this.listens(u)){i.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const M of f)M.call(this,i);const x=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const M of x)Ye(u,M,this._oneTimeListeners),M.call(this,i);const b=this._eventedParent;b&&(hi(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(i))}else i instanceof Xe&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class $e{constructor(i,l,u,f){this.message=(i?`${i}: `:"")+u,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Gt(a){const i=a.value;return i?[new $e(a.key,i,"constants have been deprecated as of v8")]:[]}function mn(a,...i){for(const l of i)for(const u in l)a[u]=l[u];return a}function on(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Kn(a){if(Array.isArray(a))return a.map(Kn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const l in a)i[l]=Kn(a[l]);return i}return on(a)}class Nn extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class vr{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[u,f]of l)this.bindings[u]=f}concat(i){return new vr(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Wa={kind:"null"},vt={kind:"number"},vn={kind:"string"},Wt={kind:"boolean"},qn={kind:"color"},Yi={kind:"object"},xn={kind:"value"},Ed={kind:"collator"},$t={kind:"formatted"},yu={kind:"resolvedImage"};function mr(a,i){return{kind:"array",itemType:a,N:i}}function Jn(a){if("array"===a.kind){const i=Jn(a.itemType);return"number"==typeof a.N?`array<${i}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${i}>`}return a.kind}const Dd=[Wa,vt,vn,Wt,qn,$t,Yi,mr(xn),yu];function dc(a,i){if("error"===i.kind)return null;if("array"===a.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!dc(a.itemType,i.itemType))&&("number"!=typeof a.N||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if("value"===a.kind)for(const l of Dd)if(!dc(l,i))return null}return`Expected ${Jn(a)} but found ${Jn(i)} instead.`}function Ac(a,i){return i.some(l=>l.kind===a.kind)}function fc(a,i){return i.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}function Qo(a){var i={exports:{}};return a(i,i.exports),i.exports}var vu=Qo(function(a,i){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(M){return(M=Math.round(M))<0?0:M>255?255:M}function f(M){return u("%"===M[M.length-1]?parseFloat(M)/100*255:parseInt(M))}function x(M){return(P="%"===M[M.length-1]?parseFloat(M)/100:parseFloat(M))<0?0:P>1?1:P;var P}function b(M,P,F){return F<0?F+=1:F>1&&(F-=1),6*F<1?M+(P-M)*F*6:2*F<1?P:3*F<2?M+(P-M)*(2/3-F)*6:M}try{i.parseCSSColor=function(M){var P,F=M.replace(/ /g,"").toLowerCase();if(F in l)return l[F].slice();if("#"===F[0])return 4===F.length?(P=parseInt(F.substr(1),16))>=0&&P<=4095?[(3840&P)>>4|(3840&P)>>8,240&P|(240&P)>>4,15&P|(15&P)<<4,1]:null:7===F.length&&(P=parseInt(F.substr(1),16))>=0&&P<=16777215?[(16711680&P)>>16,(65280&P)>>8,255&P,1]:null;var N=F.indexOf("("),V=F.indexOf(")");if(-1!==N&&V+1===F.length){var j=F.substr(0,N),q=F.substr(N+1,V-(N+1)).split(","),re=1;switch(j){case"rgba":if(4!==q.length)return null;re=x(q.pop());case"rgb":return 3!==q.length?null:[f(q[0]),f(q[1]),f(q[2]),re];case"hsla":if(4!==q.length)return null;re=x(q.pop());case"hsl":if(3!==q.length)return null;var oe=(parseFloat(q[0])%360+360)%360/360,Ae=x(q[1]),xe=x(q[2]),Me=xe<=.5?xe*(Ae+1):xe+Ae-xe*Ae,Le=2*xe-Me;return[u(255*b(Le,Me,oe+1/3)),u(255*b(Le,Me,oe)),u(255*b(Le,Me,oe-1/3)),re];default:return null}}return null}}catch(M){}});class un{constructor(i,l,u,f=1){this.r=i,this.g=l,this.b=u,this.a=f}static parse(i){if(!i)return;if(i instanceof un)return i;if("string"!=typeof i)return;const l=vu.parseCSSColor(i);return l?new un(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,u,f]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(u)},${f})`}toArray(){const{r:i,g:l,b:u,a:f}=this;return 0===f?[0,0,0,0]:[255*i/f,255*l/f,255*u/f,f]}}un.black=new un(0,0,0,1),un.white=new un(1,1,1,1),un.transparent=new un(0,0,0,0),un.red=new un(1,0,0,1),un.blue=new un(0,0,1,1);class Sd{constructor(i,l,u){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qt{constructor(i,l,u,f,x){this.text=i,this.image=l,this.scale=u,this.fontStack=f,this.textColor=x}}class di{constructor(i){this.sections=i}static fromString(i){return new di([new Qt(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof di?i:di.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(u)}return i}}class Oo{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Oo({name:i,available:!1}):null}serialize(){return["image",this.name]}}function va(a,i,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,i,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,i,l,u]:[a,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xu(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof un||a instanceof Sd||a instanceof di||a instanceof Oo)return!0;if(Array.isArray(a)){for(const i of a)if(!xu(i))return!1;return!0}if("object"==typeof a){for(const i in a)if(!xu(a[i]))return!1;return!0}return!1}function yi(a){if(null===a)return Wa;if("string"==typeof a)return vn;if("boolean"==typeof a)return Wt;if("number"==typeof a)return vt;if(a instanceof un)return qn;if(a instanceof Sd)return Ed;if(a instanceof di)return $t;if(a instanceof Oo)return yu;if(Array.isArray(a)){const i=a.length;let l;for(const u of a){const f=yi(u);if(l){if(l===f)continue;l=xn;break}l=f}return mr(l||xn,i)}return Yi}function Lo(a){const i=typeof a;return null===a?"":"string"===i||"number"===i||"boolean"===i?String(a):a instanceof un||a instanceof di||a instanceof Oo?a.toString():JSON.stringify(a)}class Ai{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!xu(i[1]))return l.error("invalid value");const u=i[1];let f=yi(u);const x=l.expectedType;return"array"!==f.kind||0!==f.N||!x||"array"!==x.kind||"number"==typeof x.N&&0!==x.N||(f=x),new Ai(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof un?["rgba"].concat(this.value.toArray()):this.value instanceof di?this.value.serialize():this.value}}class Ki{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const bu={string:vn,number:vt,boolean:Wt,object:Yi};class gr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let u,f=1;const x=i[0];if("array"===x){let M,P;if(i.length>2){const F=i[1];if("string"!=typeof F||!(F in bu)||"object"===F)return l.error('The item type argument of "array" must be one of string, number, boolean',1);M=bu[F],f++}else M=xn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=i[2],f++}u=mr(M,P)}else u=bu[x];const b=[];for(;f<i.length;f++){const M=l.parse(i[f],f,xn);if(!M)return null;b.push(M)}return new gr(u,b)}evaluate(i){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(i);if(!dc(this.type,yi(u)))return u;if(l===this.args.length-1)throw new Ki(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(yi(u))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if("array"===i.kind){const u=i.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const f=i.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(u=>u.serialize()))}}class wu{constructor(i){this.type=$t,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const f=[];let x=!1;for(let b=1;b<=i.length-1;++b){const M=i[b];if(x&&"object"==typeof M&&!Array.isArray(M)){x=!1;let P=null;if(M["font-scale"]&&(P=l.parse(M["font-scale"],1,vt),!P))return null;let F=null;if(M["text-font"]&&(F=l.parse(M["text-font"],1,mr(vn)),!F))return null;let N=null;if(M["text-color"]&&(N=l.parse(M["text-color"],1,qn),!N))return null;const V=f[f.length-1];V.scale=P,V.font=F,V.textColor=N}else{const P=l.parse(i[b],1,xn);if(!P)return null;const F=P.type.kind;if("string"!==F&&"value"!==F&&"null"!==F&&"resolvedImage"!==F)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,f.push({content:P,scale:null,font:null,textColor:null})}}return new wu(f)}evaluate(i){return new di(this.sections.map(l=>{const u=l.content.evaluate(i);return yi(u)===yu?new Qt("",u,null,null,null):new Qt(Lo(u),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),i.push(u)}return i}}class bh{constructor(i){this.type=yu,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const u=l.parse(i[1],1,vn);return u?new bh(u):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),u=Oo.fromString(l);return u&&i.availableImages&&(u.available=i.availableImages.indexOf(l)>-1),u}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const rm={"to-boolean":Wt,"to-color":qn,"to-number":vt,"to-string":vn};class El{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const u=i[0];if(("to-boolean"===u||"to-string"===u)&&2!==i.length)return l.error("Expected one argument.");const f=rm[u],x=[];for(let b=1;b<i.length;b++){const M=l.parse(i[b],b,xn);if(!M)return null;x.push(M)}return new El(f,x)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let l,u;for(const f of this.args){if(l=f.evaluate(i),u=null,l instanceof un)return l;if("string"==typeof l){const x=i.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:va(l[0],l[1],l[2],l[3]),!u))return new un(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Ki(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(i),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new Ki(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?di.fromString(Lo(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Oo.fromString(Lo(this.args[0].evaluate(i))):Lo(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new wu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new bh(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const lr=["Unknown","Point","LineString","Polygon"];class im{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?lr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=un.parse(i)),l}}class Xo{constructor(i,l,u,f){this.name=i,this.type=l,this._evaluate=u,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const u=i[0],f=Xo.definitions[u];if(!f)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(f)?f[0]:f.type,b=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,M=b.filter(([F])=>!Array.isArray(F)||F.length===i.length-1);let P=null;for(const[F,N]of M){P=new Zs(l.registry,l.path,null,l.scope);const V=[];let j=!1;for(let q=1;q<i.length;q++){const re=i[q],oe=Array.isArray(F)?F[q-1]:F.type,Ae=P.parse(re,1+V.length,oe);if(!Ae){j=!0;break}V.push(Ae)}if(!j)if(Array.isArray(F)&&F.length!==V.length)P.error(`Expected ${F.length} arguments, but found ${V.length} instead.`);else{for(let q=0;q<V.length;q++){const re=Array.isArray(F)?F[q]:F.type,oe=V[q];P.concat(q+1).checkSubtype(re,oe.type)}if(0===P.errors.length)return new Xo(u,x,N,V)}}if(1===M.length)l.errors.push(...P.errors);else{const F=(M.length?M:b).map(([V])=>{return j=V,Array.isArray(j)?`(${j.map(Jn).join(", ")})`:`(${Jn(j.type)}...)`;var j}).join(" | "),N=[];for(let V=1;V<i.length;V++){const j=l.parse(i[V],1+N.length);if(!j)return null;N.push(Jn(j.type))}l.error(`Expected arguments of type ${F}, but found (${N.join(", ")}) instead.`)}return null}static register(i,l){Xo.definitions=l;for(const u in l)i[u]=Xo}}class Yo{constructor(i,l,u){this.type=Ed,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const u=i[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,Wt);if(!f)return null;const x=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,Wt);if(!x)return null;let b=null;return u.locale&&(b=l.parse(u.locale,1,vn),!b)?null:new Yo(f,x,b)}evaluate(i){return new Sd(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Zn=8192;function pc(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function mc(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function Md(a,i){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(l*f*Zn),Math.round(u*f*Zn)]}function sf(a,i,l){const u=a[0]-i[0],f=a[1]-i[1],x=a[0]-l[0],b=a[1]-l[1];return u*b-x*f==0&&u*x<=0&&f*b<=0}function Td(a,i){let l=!1;for(let b=0,M=i.length;b<M;b++){const P=i[b];for(let F=0,N=P.length;F<N-1;F++){if(sf(a,P[F],P[F+1]))return!1;(f=P[F])[1]>(u=a)[1]!=(x=P[F+1])[1]>u[1]&&u[0]<(x[0]-f[0])*(u[1]-f[1])/(x[1]-f[1])+f[0]&&(l=!l)}}var u,f,x;return l}function qs(a,i){for(let l=0;l<i.length;l++)if(Td(a,i[l]))return!0;return!1}function xa(a,i,l,u){const f=u[0]-l[0],x=u[1]-l[1],b=(a[0]-l[0])*x-f*(a[1]-l[1]),M=(i[0]-l[0])*x-f*(i[1]-l[1]);return b>0&&M<0||b<0&&M>0}function om(a,i,l){for(const F of l)for(let N=0;N<F.length-1;++N)if((M=[(b=F[N+1])[0]-(x=F[N])[0],b[1]-x[1]])[0]*(P=[(f=i)[0]-(u=a)[0],f[1]-u[1]])[1]-M[1]*P[0]!=0&&xa(u,f,x,b)&&xa(x,b,u,f))return!0;var u,f,x,b,M,P;return!1}function Bo(a,i){for(let l=0;l<a.length;++l)if(!Td(a[l],i))return!1;for(let l=0;l<a.length-1;++l)if(om(a[l],a[l+1],i))return!1;return!0}function sm(a,i){for(let l=0;l<i.length;l++)if(Bo(a,i[l]))return!0;return!1}function wh(a,i,l){const u=[];for(let f=0;f<a.length;f++){const x=[];for(let b=0;b<a[f].length;b++){const M=Md(a[f][b],l);pc(i,M),x.push(M)}u.push(x)}return u}function Ko(a,i,l){const u=[];for(let f=0;f<a.length;f++){const x=wh(a[f],i,l);u.push(x)}return u}function Ch(a,i,l,u){if(a[0]<l[0]||a[0]>l[2]){const f=.5*u;let x=a[0]-l[0]>f?-u:l[0]-a[0]>f?u:0;0===x&&(x=a[0]-l[2]>f?-u:l[2]-a[0]>f?u:0),a[0]+=x}pc(i,a)}function Ui(a,i,l,u){const f=Math.pow(2,u.z)*Zn,x=[u.x*Zn,u.y*Zn],b=[];for(const M of a)for(const P of M){const F=[P.x+x[0],P.y+x[1]];Ch(F,i,l,f),b.push(F)}return b}function Cu(a,i,l,u){const f=Math.pow(2,u.z)*Zn,x=[u.x*Zn,u.y*Zn],b=[];for(const P of a){const F=[];for(const N of P){const V=[N.x+x[0],N.y+x[1]];pc(i,V),F.push(V)}b.push(F)}if(i[2]-i[0]<=f/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of b)for(const F of P)Ch(F,i,l,f)}var M;return b}class Jo{constructor(i,l){this.type=Wt,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(xu(i[1])){const u=i[1];if("FeatureCollection"===u.type)for(let f=0;f<u.features.length;++f){const x=u.features[f].geometry.type;if("Polygon"===x||"MultiPolygon"===x)return new Jo(u,u.features[f].geometry)}else if("Feature"===u.type){const f=u.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Jo(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new Jo(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if("Polygon"===u.type){const M=wh(u.coordinates,x,b),P=Ui(l.geometry(),f,x,b);if(!mc(f,x))return!1;for(const F of P)if(!Td(F,M))return!1}if("MultiPolygon"===u.type){const M=Ko(u.coordinates,x,b),P=Ui(l.geometry(),f,x,b);if(!mc(f,x))return!1;for(const F of P)if(!qs(F,M))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,u){const f=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if("Polygon"===u.type){const M=wh(u.coordinates,x,b),P=Cu(l.geometry(),f,x,b);if(!mc(f,x))return!1;for(const F of P)if(!Bo(F,M))return!1}if("MultiPolygon"===u.type){const M=Ko(u.coordinates,x,b),P=Cu(l.geometry(),f,x,b);if(!mc(f,x))return!1;for(const F of P)if(!sm(F,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Xt(a){if(a instanceof Xo&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Jo)return!1;let i=!0;return a.eachChild(l=>{i&&!Xt(l)&&(i=!1)}),i}function vi(a){if(a instanceof Xo&&"feature-state"===a.name)return!1;let i=!0;return a.eachChild(l=>{i&&!vi(l)&&(i=!1)}),i}function Pi(a,i){if(a instanceof Xo&&i.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!Pi(u,i)&&(l=!1)}),l}class fn{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const u=i[1];return l.scope.has(u)?new fn(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Zs{constructor(i,l=[],u,f=new vr,x=[]){this.registry=i,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=f,this.errors=x,this.expectedType=u}parse(i,l,u,f,x={}){return l?this.concat(l,u,f)._parse(i,x):this._parse(i,x)}_parse(i,l){function u(f,x,b){return"assert"===b?new gr(x,[f]):"coerce"===b?new El(x,[f]):f}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=i[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[f];if(x){let b=x.parse(i,this);if(!b)return null;if(this.expectedType){const M=this.expectedType,P=b.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==P.kind)if("color"!==M.kind&&"formatted"!==M.kind&&"resolvedImage"!==M.kind||"value"!==P.kind&&"string"!==P.kind){if(this.checkSubtype(M,P))return null}else b=u(b,M,l.typeAnnotation||"coerce");else b=u(b,M,l.typeAnnotation||"assert")}if(!(b instanceof Ai)&&"resolvedImage"!==b.type.kind&&Do(b)){const M=new im;try{b=new Ai(b.type,b.evaluate(M))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,u){const f="number"==typeof i?this.path.concat(i):this.path,x=u?this.scope.concat(u):this.scope;return new Zs(this.registry,f,l||null,x,this.errors)}error(i,...l){const u=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Nn(u,i))}checkSubtype(i,l){const u=dc(i,l);return u&&this.error(u),u}}function Do(a){if(a instanceof fn)return Do(a.boundExpression);if(a instanceof Xo&&"error"===a.name||a instanceof Yo||a instanceof Jo)return!1;const i=a instanceof El||a instanceof gr;let l=!0;return a.eachChild(u=>{l=i?l&&Do(u):l&&u instanceof Ai}),!!l&&Xt(a)&&Pi(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function Eh(a,i){const l=a.length-1;let u,f,x=0,b=l,M=0;for(;x<=b;)if(M=Math.floor((x+b)/2),u=a[M],f=a[M+1],u<=i){if(M===l||i<f)return M;x=M+1}else{if(!(u>i))throw new Ki("Input is not a number.");b=M-1}return 0}class ji{constructor(i,l,u){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[f,x]of u)this.labels.push(f),this.outputs.push(x)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(i[1],1,vt);if(!u)return null;const f=[];let x=null;l.expectedType&&"value"!==l.expectedType.kind&&(x=l.expectedType);for(let b=1;b<i.length;b+=2){const M=1===b?-1/0:i[b],P=i[b+1],F=b,N=b+1;if("number"!=typeof M)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(f.length&&f[f.length-1][0]>=M)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const V=l.parse(P,N,x);if(!V)return null;x=x||V.type,f.push([M,V])}return new ji(x,u,f)}evaluate(i){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return u[0].evaluate(i);const x=l.length;return f>=l[x-1]?u[x-1].evaluate(i):u[Eh(l,f)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}function ht(a,i,l){return a*(1-l)+i*l}var bn=Object.freeze({__proto__:null,number:ht,color:function(a,i,l){return new un(ht(a.r,i.r,l),ht(a.g,i.g,l),ht(a.b,i.b,l),ht(a.a,i.a,l))},array:function(a,i,l){return a.map((u,f)=>ht(u,i[f],l))}});const ba=4/29,fi=6/29,Ws=3*fi*fi,Qr=Math.PI/180,Eu=180/Math.PI;function wa(a){return a>.008856451679035631?Math.pow(a,1/3):a/Ws+ba}function gn(a){return a>fi?a*a*a:Ws*(a-ba)}function Dl(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ca(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Du(a){const i=Ca(a.r),l=Ca(a.g),u=Ca(a.b),f=wa((.4124564*i+.3575761*l+.1804375*u)/.95047),x=wa((.2126729*i+.7151522*l+.072175*u)/1);return{l:116*x-16,a:500*(f-x),b:200*(x-wa((.0193339*i+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function Qa(a){let i=(a.l+16)/116,l=isNaN(a.a)?i:i+a.a/500,u=isNaN(a.b)?i:i-a.b/200;return i=1*gn(i),l=.95047*gn(l),u=1.08883*gn(u),new un(Dl(3.2404542*l-1.5371385*i-.4985314*u),Dl(-.969266*l+1.8760108*i+.041556*u),Dl(.0556434*l-.2040259*i+1.0572252*u),a.alpha)}function So(a,i,l){const u=i-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Qs={forward:Du,reverse:Qa,interpolate:function(a,i,l){return{l:ht(a.l,i.l,l),a:ht(a.a,i.a,l),b:ht(a.b,i.b,l),alpha:ht(a.alpha,i.alpha,l)}}},xs={forward:function(a){const{l:i,a:l,b:u}=Du(a),f=Math.atan2(u,l)*Eu;return{h:f<0?f+360:f,c:Math.sqrt(l*l+u*u),l:i,alpha:a.a}},reverse:function(a){const i=a.h*Qr,l=a.c;return Qa({l:a.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:a.alpha})},interpolate:function(a,i,l){return{h:So(a.h,i.h,l),c:ht(a.c,i.c,l),l:ht(a.l,i.l,l),alpha:ht(a.alpha,i.alpha,l)}}};var es=Object.freeze({__proto__:null,lab:Qs,hcl:xs});class Rn{constructor(i,l,u,f,x){this.type=i,this.operator=l,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[b,M]of x)this.labels.push(b),this.outputs.push(M)}static interpolationFactor(i,l,u,f){let x=0;if("exponential"===i.name)x=Id(l,i.base,u,f);else if("linear"===i.name)x=Id(l,1,u,f);else if("cubic-bezier"===i.name){const b=i.controlPoints;x=new Ho(b[0],b[1],b[2],b[3]).solve(Id(l,1,u,f))}return x}static parse(i,l){let[u,f,x,...b]=i;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const F=f[1];if("number"!=typeof F)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:F}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const F=f.slice(1);if(4!==F.length||F.some(N=>"number"!=typeof N||N<0||N>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:F}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,vt),!x)return null;const M=[];let P=null;"interpolate-hcl"===u||"interpolate-lab"===u?P=qn:l.expectedType&&"value"!==l.expectedType.kind&&(P=l.expectedType);for(let F=0;F<b.length;F+=2){const N=b[F],V=b[F+1],j=F+3,q=F+4;if("number"!=typeof N)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(M.length&&M[M.length-1][0]>=N)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const re=l.parse(V,q,P);if(!re)return null;P=P||re.type,M.push([N,re])}return"number"===P.kind||"color"===P.kind||"array"===P.kind&&"number"===P.itemType.kind&&"number"==typeof P.N?new Rn(P,u,f,x,M):l.error(`Type ${Jn(P)} is not interpolatable.`)}evaluate(i){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return u[0].evaluate(i);const x=l.length;if(f>=l[x-1])return u[x-1].evaluate(i);const b=Eh(l,f),M=Rn.interpolationFactor(this.interpolation,f,l[b],l[b+1]),P=u[b].evaluate(i),F=u[b+1].evaluate(i);return"interpolate"===this.operator?bn[this.type.kind.toLowerCase()](P,F,M):"interpolate-hcl"===this.operator?xs.reverse(xs.interpolate(xs.forward(P),xs.forward(F),M)):Qs.reverse(Qs.interpolate(Qs.forward(P),Qs.forward(F),M))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function Id(a,i,l,u){const f=u-l,x=a-l;return 0===f?0:1===i?x/f:(Math.pow(i,x)-1)/(Math.pow(i,f)-1)}class Dh{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let u=null;const f=l.expectedType;f&&"value"!==f.kind&&(u=f);const x=[];for(const M of i.slice(1)){const P=l.parse(M,1+x.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,x.push(P)}const b=f&&x.some(M=>dc(f,M.type));return new Dh(b?xn:u,x)}evaluate(i){let l,u=null,f=0;for(const x of this.args)if(f++,u=x.evaluate(i),u&&u instanceof Oo&&!u.available&&(l||(l=u.name),u=null,f===this.args.length&&(u=l)),null!==u)break;return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class Sl{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let x=1;x<i.length-1;x+=2){const b=i[x];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const M=l.parse(i[x+1],x+1);if(!M)return null;u.push([b,M])}const f=l.parse(i[i.length-1],i.length-1,l.expectedType,u);return f?new Sl(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,u]of this.bindings)i.push(l,u.serialize());return i.push(this.result.serialize()),i}}class gc{constructor(i,l,u){this.type=i,this.index=l,this.input=u}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,vt),f=l.parse(i[2],2,mr(l.expectedType||xn));return u&&f?new gc(f.type.itemType,u,f):null}evaluate(i){const l=this.index.evaluate(i),u=this.input.evaluate(i);if(l<0)throw new Ki(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new Ki(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new Ki(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ml{constructor(i,l){this.type=Wt,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,xn),f=l.parse(i[2],2,xn);return u&&f?Ac(u.type,[Wt,vn,vt,Wa,xn])?new Ml(u,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(u.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!u)return!1;if(!fc(l,["boolean","string","number","null"]))throw new Ki(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(yi(l))} instead.`);if(!fc(u,["string","array"]))throw new Ki(`Expected second argument to be of type array or string, but found ${Jn(yi(u))} instead.`);return u.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Tl{constructor(i,l,u){this.type=vt,this.needle=i,this.haystack=l,this.fromIndex=u}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,xn),f=l.parse(i[2],2,xn);if(!u||!f)return null;if(!Ac(u.type,[Wt,vn,vt,Wa,xn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(u.type)} instead`);if(4===i.length){const x=l.parse(i[3],3,vt);return x?new Tl(u,f,x):null}return new Tl(u,f)}evaluate(i){const l=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!fc(l,["boolean","string","number","null"]))throw new Ki(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(yi(l))} instead.`);if(!fc(u,["string","array"]))throw new Ki(`Expected second argument to be of type array or string, but found ${Jn(yi(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return u.indexOf(l,f)}return u.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ea{constructor(i,l,u,f,x,b){this.inputType=i,this.type=l,this.input=u,this.cases=f,this.outputs=x,this.otherwise=b}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let u,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const x={},b=[];for(let F=2;F<i.length-1;F+=2){let N=i[F];const V=i[F+1];Array.isArray(N)||(N=[N]);const j=l.concat(F);if(0===N.length)return j.error("Expected at least one branch label.");for(const re of N){if("number"!=typeof re&&"string"!=typeof re)return j.error("Branch labels must be numbers or strings.");if("number"==typeof re&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof re&&Math.floor(re)!==re)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,yi(re)))return null}else u=yi(re);if(void 0!==x[String(re)])return j.error("Branch labels must be unique.");x[String(re)]=b.length}const q=l.parse(V,F,f);if(!q)return null;f=f||q.type,b.push(q)}const M=l.parse(i[1],1,xn);if(!M)return null;const P=l.parse(i[i.length-1],i.length-1,f);return P?"value"!==M.type.kind&&l.concat(1).checkSubtype(u,M.type)?null:new Ea(u,f,M,x,b,P):null}evaluate(i){const l=this.input.evaluate(i);return(yi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],f={};for(const b of l){const M=f[this.cases[b]];void 0===M?(f[this.cases[b]]=u.length,u.push([this.cases[b],[b]])):u[M][1].push(b)}const x=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,M]of u)i.push(1===M.length?x(M[0]):M.map(x)),i.push(this.outputs[b].serialize());return i.push(this.otherwise.serialize()),i}}class xi{constructor(i,l,u){this.type=i,this.branches=l,this.otherwise=u}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const f=[];for(let b=1;b<i.length-1;b+=2){const M=l.parse(i[b],b,Wt);if(!M)return null;const P=l.parse(i[b+1],b+1,u);if(!P)return null;f.push([M,P]),u=u||P.type}const x=l.parse(i[i.length-1],i.length-1,u);return x?new xi(u,f,x):null}evaluate(i){for(const[l,u]of this.branches)if(l.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,u]of this.branches)i(l),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class Su{constructor(i,l,u,f){this.type=i,this.input=l,this.beginIndex=u,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=l.parse(i[1],1,xn),f=l.parse(i[2],2,vt);if(!u||!f)return null;if(!Ac(u.type,[mr(xn),vn,xn]))return l.error(`Expected first argument to be of type array or string, but found ${Jn(u.type)} instead`);if(4===i.length){const x=l.parse(i[3],3,vt);return x?new Su(u.type,u,f,x):null}return new Su(u.type,u,f)}evaluate(i){const l=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!fc(l,["string","array"]))throw new Ki(`Expected first argument to be of type array or string, but found ${Jn(yi(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return l.slice(u,f)}return l.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function bs(a,i){return"=="===a||"!="===a?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function No(a,i,l,u){return 0===u.compare(i,l)}function Xa(a,i,l){const u="=="!==a&&"!="!==a;return class Jk{constructor(x,b,M){this.type=Wt,this.lhs=x,this.rhs=b,this.collator=M,this.hasUntypedArgument="value"===x.type.kind||"value"===b.type.kind}static parse(x,b){if(3!==x.length&&4!==x.length)return b.error("Expected two or three arguments.");const M=x[0];let P=b.parse(x[1],1,xn);if(!P)return null;if(!bs(M,P.type))return b.concat(1).error(`"${M}" comparisons are not supported for type '${Jn(P.type)}'.`);let F=b.parse(x[2],2,xn);if(!F)return null;if(!bs(M,F.type))return b.concat(2).error(`"${M}" comparisons are not supported for type '${Jn(F.type)}'.`);if(P.type.kind!==F.type.kind&&"value"!==P.type.kind&&"value"!==F.type.kind)return b.error(`Cannot compare types '${Jn(P.type)}' and '${Jn(F.type)}'.`);u&&("value"===P.type.kind&&"value"!==F.type.kind?P=new gr(F.type,[P]):"value"!==P.type.kind&&"value"===F.type.kind&&(F=new gr(P.type,[F])));let N=null;if(4===x.length){if("string"!==P.type.kind&&"string"!==F.type.kind&&"value"!==P.type.kind&&"value"!==F.type.kind)return b.error("Cannot use collator to compare non-string types.");if(N=b.parse(x[3],3,Ed),!N)return null}return new Jk(P,F,N)}evaluate(x){const b=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(u&&this.hasUntypedArgument){const P=yi(b),F=yi(M);if(P.kind!==F.kind||"string"!==P.kind&&"number"!==P.kind)throw new Ki(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${P.kind}, ${F.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const P=yi(b),F=yi(M);if("string"!==P.kind||"string"!==F.kind)return i(x,b,M)}return this.collator?l(x,b,M,this.collator.evaluate(x)):i(x,b,M)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[a];return this.eachChild(b=>{x.push(b.serialize())}),x}}}const Sh=Xa("==",function(a,i,l){return i===l},No),Mu=Xa("!=",function(a,i,l){return i!==l},function(a,i,l,u){return!No(0,i,l,u)}),ts=Xa("<",function(a,i,l){return i<l},function(a,i,l,u){return u.compare(i,l)<0}),am=Xa(">",function(a,i,l){return i>l},function(a,i,l,u){return u.compare(i,l)>0}),w0=Xa("<=",function(a,i,l){return i<=l},function(a,i,l,u){return u.compare(i,l)<=0}),lm=Xa(">=",function(a,i,l){return i>=l},function(a,i,l,u){return u.compare(i,l)>=0});class kd{constructor(i,l,u,f,x){this.type=vn,this.number=i,this.locale=l,this.currency=u,this.minFractionDigits=f,this.maxFractionDigits=x}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const u=l.parse(i[1],1,vt);if(!u)return null;const f=i[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let x=null;if(f.locale&&(x=l.parse(f.locale,1,vn),!x))return null;let b=null;if(f.currency&&(b=l.parse(f.currency,1,vn),!b))return null;let M=null;if(f["min-fraction-digits"]&&(M=l.parse(f["min-fraction-digits"],1,vt),!M))return null;let P=null;return f["max-fraction-digits"]&&(P=l.parse(f["max-fraction-digits"],1,vt),!P)?null:new kd(u,x,b,M,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Tu{constructor(i){this.type=vt,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=l.parse(i[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Jn(u.type)} instead.`):new Tu(u):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new Ki(`Expected value to be of type string or array, but found ${Jn(yi(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const _c={"==":Sh,"!=":Mu,">":am,"<":ts,">=":lm,"<=":w0,array:gr,at:gc,boolean:gr,case:xi,coalesce:Dh,collator:Yo,format:wu,image:bh,in:Ml,"index-of":Tl,interpolate:Rn,"interpolate-hcl":Rn,"interpolate-lab":Rn,length:Tu,let:Sl,literal:Ai,match:Ea,number:gr,"number-format":kd,object:gr,slice:Su,step:ji,string:gr,"to-boolean":El,"to-color":El,"to-number":El,"to-string":El,var:fn,within:Jo};function af(a,[i,l,u,f]){i=i.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const x=f?f.evaluate(a):1,b=va(i,l,u,x);if(b)throw new Ki(b);return new un(i/255*x,l/255*x,u/255*x,x)}function cm(a,i){return a in i}function lf(a,i){const l=i[a];return void 0===l?null:l}function yc(a){return{type:a}}function cf(a){return{result:"success",value:a}}function vc(a){return{result:"error",value:a}}function xc(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function Pd(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function uf(a){return!!a.expression&&a.expression.interpolated}function rr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Rd(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function C0(a){return a}function Fd(a,i){const l="color"===i.type,u=a.stops&&"object"==typeof a.stops[0][0],f=u||!(u||void 0!==a.property),x=a.type||(uf(i)?"exponential":"interval");if(l&&((a=mn({},a)).stops&&(a.stops=a.stops.map(F=>[F[0],un.parse(F[1])])),a.default=un.parse(a.default?a.default:i.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!es[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,M,P;if("exponential"===x)b=Mh;else if("interval"===x)b=hm;else if("categorical"===x){b=um,M=Object.create(null);for(const F of a.stops)M[F[0]]=F[1];P=typeof a.stops[0][0]}else{if("identity"!==x)throw new Error(`Unknown function type "${x}"`);b=kl}if(u){const F={},N=[];for(let q=0;q<a.stops.length;q++){const re=a.stops[q],oe=re[0].zoom;void 0===F[oe]&&(F[oe]={zoom:oe,type:a.type,property:a.property,default:a.default,stops:[]},N.push(oe)),F[oe].stops.push([re[0].value,re[1]])}const V=[];for(const q of N)V.push([F[q].zoom,Fd(F[q],i)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Rn.interpolationFactor.bind(void 0,j),zoomStops:V.map(q=>q[0]),evaluate:({zoom:q},re)=>Mh({stops:V,base:a.base},i,q).evaluate(q,re)}}if(f){const F="exponential"===x?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Rn.interpolationFactor.bind(void 0,F),zoomStops:a.stops.map(N=>N[0]),evaluate:({zoom:N})=>b(a,i,N,M,P)}}return{kind:"source",evaluate(F,N){const V=N&&N.properties?N.properties[a.property]:void 0;return void 0===V?Il(a.default,i.default):b(a,i,V,M,P)}}}function Il(a,i,l){return void 0!==a?a:void 0!==i?i:void 0!==l?l:void 0}function um(a,i,l,u,f){return Il(typeof l===f?u[l]:void 0,a.default,i.default)}function hm(a,i,l){if("number"!==rr(l))return Il(a.default,i.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const f=Eh(a.stops.map(x=>x[0]),l);return a.stops[f][1]}function Mh(a,i,l){const u=void 0!==a.base?a.base:1;if("number"!==rr(l))return Il(a.default,i.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const x=Eh(a.stops.map(N=>N[0]),l),b=function(N,V,j,q){const re=q-j,oe=N-j;return 0===re?0:1===V?oe/re:(Math.pow(V,oe)-1)/(Math.pow(V,re)-1)}(l,u,a.stops[x][0],a.stops[x+1][0]),M=a.stops[x][1],P=a.stops[x+1][1];let F=bn[i.type]||C0;if(a.colorSpace&&"rgb"!==a.colorSpace){const N=es[a.colorSpace];F=(V,j)=>N.reverse(N.interpolate(N.forward(V),N.forward(j),b))}return"function"==typeof M.evaluate?{evaluate(...N){const V=M.evaluate.apply(void 0,N),j=P.evaluate.apply(void 0,N);if(void 0!==V&&void 0!==j)return F(V,j,b)}}:F(M,P,b)}function kl(a,i,l){return"color"===i.type?l=un.parse(l):"formatted"===i.type?l=di.fromString(l.toString()):"resolvedImage"===i.type?l=Oo.fromString(l.toString()):rr(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0),Il(l,a.default,i.default)}Xo.register(_c,{error:[{kind:"error"},[vn],(a,[i])=>{throw new Ki(i.evaluate(a))}],typeof:[vn,[xn],(a,[i])=>Jn(yi(i.evaluate(a)))],"to-rgba":[mr(vt,4),[qn],(a,[i])=>i.evaluate(a).toArray()],rgb:[qn,[vt,vt,vt],af],rgba:[qn,[vt,vt,vt,vt],af],has:{type:Wt,overloads:[[[vn],(a,[i])=>cm(i.evaluate(a),a.properties())],[[vn,Yi],(a,[i,l])=>cm(i.evaluate(a),l.evaluate(a))]]},get:{type:xn,overloads:[[[vn],(a,[i])=>lf(i.evaluate(a),a.properties())],[[vn,Yi],(a,[i,l])=>lf(i.evaluate(a),l.evaluate(a))]]},"feature-state":[xn,[vn],(a,[i])=>lf(i.evaluate(a),a.featureState||{})],properties:[Yi,[],a=>a.properties()],"geometry-type":[vn,[],a=>a.geometryType()],id:[xn,[],a=>a.id()],zoom:[vt,[],a=>a.globals.zoom],"heatmap-density":[vt,[],a=>a.globals.heatmapDensity||0],"line-progress":[vt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[vt,[],a=>a.globals.skyRadialProgress||0],accumulated:[xn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[vt,yc(vt),(a,i)=>{let l=0;for(const u of i)l+=u.evaluate(a);return l}],"*":[vt,yc(vt),(a,i)=>{let l=1;for(const u of i)l*=u.evaluate(a);return l}],"-":{type:vt,overloads:[[[vt,vt],(a,[i,l])=>i.evaluate(a)-l.evaluate(a)],[[vt],(a,[i])=>-i.evaluate(a)]]},"/":[vt,[vt,vt],(a,[i,l])=>i.evaluate(a)/l.evaluate(a)],"%":[vt,[vt,vt],(a,[i,l])=>i.evaluate(a)%l.evaluate(a)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(a,[i,l])=>Math.pow(i.evaluate(a),l.evaluate(a))],sqrt:[vt,[vt],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[vt,[vt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[vt,[vt],(a,[i])=>Math.log(i.evaluate(a))],log2:[vt,[vt],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[vt,[vt],(a,[i])=>Math.sin(i.evaluate(a))],cos:[vt,[vt],(a,[i])=>Math.cos(i.evaluate(a))],tan:[vt,[vt],(a,[i])=>Math.tan(i.evaluate(a))],asin:[vt,[vt],(a,[i])=>Math.asin(i.evaluate(a))],acos:[vt,[vt],(a,[i])=>Math.acos(i.evaluate(a))],atan:[vt,[vt],(a,[i])=>Math.atan(i.evaluate(a))],min:[vt,yc(vt),(a,i)=>Math.min(...i.map(l=>l.evaluate(a)))],max:[vt,yc(vt),(a,i)=>Math.max(...i.map(l=>l.evaluate(a)))],abs:[vt,[vt],(a,[i])=>Math.abs(i.evaluate(a))],round:[vt,[vt],(a,[i])=>{const l=i.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[vt,[vt],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[vt,[vt],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Wt,[vn,xn],(a,[i,l])=>a.properties()[i.value]===l.value],"filter-id-==":[Wt,[xn],(a,[i])=>a.id()===i.value],"filter-type-==":[Wt,[vn],(a,[i])=>a.geometryType()===i.value],"filter-<":[Wt,[vn,xn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Wt,[xn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l<u}],"filter->":[Wt,[vn,xn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u>f}],"filter-id->":[Wt,[xn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l>u}],"filter-<=":[Wt,[vn,xn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Wt,[xn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l<=u}],"filter->=":[Wt,[vn,xn],(a,[i,l])=>{const u=a.properties()[i.value],f=l.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Wt,[xn],(a,[i])=>{const l=a.id(),u=i.value;return typeof l==typeof u&&l>=u}],"filter-has":[Wt,[xn],(a,[i])=>i.value in a.properties()],"filter-has-id":[Wt,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Wt,[mr(vn)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Wt,[mr(xn)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Wt,[vn,mr(xn)],(a,[i,l])=>l.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Wt,[vn,mr(xn)],(a,[i,l])=>function(u,f,x,b){for(;x<=b;){const M=x+b>>1;if(f[M]===u)return!0;f[M]>u?b=M-1:x=M+1}return!1}(a.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Wt,overloads:[[[Wt,Wt],(a,[i,l])=>i.evaluate(a)&&l.evaluate(a)],[yc(Wt),(a,i)=>{for(const l of i)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Wt,overloads:[[[Wt,Wt],(a,[i,l])=>i.evaluate(a)||l.evaluate(a)],[yc(Wt),(a,i)=>{for(const l of i)if(l.evaluate(a))return!0;return!1}]]},"!":[Wt,[Wt],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Wt,[vn],(a,[i])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(i.evaluate(a))}],upcase:[vn,[vn],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[vn,[vn],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[vn,yc(xn),(a,i)=>i.map(l=>Lo(l.evaluate(a))).join("")],"resolved-locale":[vn,[Ed],(a,[i])=>i.evaluate(a).resolvedLocale()]});class Th{constructor(i,l){var u;this.expression=i,this._warningHistory={},this._evaluator=new im,this._defaultValue=l?"color"===(u=l).type&&Rd(u.default)?new un(0,0,0,0):"color"===u.type?un.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,u,f,x,b){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=f,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(i,l,u,f,x,b){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ki(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,"undefined"!=typeof console&&console.warn(M.message)),this._defaultValue}}}function Dr(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in _c}function ns(a,i){const l=new Zs(_c,[],i?function(f){const x={color:qn,string:vn,number:vt,enum:vn,boolean:Wt,formatted:$t,resolvedImage:yu};return"array"===f.type?mr(x[f.value]||xn,f.length):x[f.type]}(i):void 0),u=l.parse(a,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return u?cf(new Th(u,i)):vc(l.errors)}class Ih{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!vi(l.expression)}evaluateWithoutErrorHandling(i,l,u,f,x,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,u,f,x,b)}evaluate(i,l,u,f,x,b){return this._styleExpression.evaluate(i,l,u,f,x,b)}}class Ya{constructor(i,l,u,f){this.kind=i,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==i&&!vi(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,u,f,x,b){return this._styleExpression.evaluateWithoutErrorHandling(i,l,u,f,x,b)}evaluate(i,l,u,f,x,b){return this._styleExpression.evaluate(i,l,u,f,x,b)}interpolationFactor(i,l,u){return this.interpolationType?Rn.interpolationFactor(this.interpolationType,i,l,u):0}}function kh(a,i){if("error"===(a=ns(a,i)).result)return a;const l=a.value.expression,u=Xt(l);if(!u&&!xc(i))return vc([new Nn("","data expressions not supported")]);const f=Pi(l,["zoom"]);if(!f&&!Pd(i))return vc([new Nn("","zoom expressions not supported")]);const x=bc(l);return x||f?x instanceof Nn?vc([x]):x instanceof Rn&&!uf(i)?vc([new Nn("",'"interpolate" expressions cannot be used with this property')]):cf(x?new Ya(u?"camera":"composite",a.value,x.labels,x instanceof Rn?x.interpolation:void 0):new Ih(u?"constant":"source",a.value)):vc([new Nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Iu{constructor(i,l){this._parameters=i,this._specification=l,mn(this,Fd(this._parameters,this._specification))}static deserialize(i){return new Iu(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function bc(a){let i=null;if(a instanceof Sl)i=bc(a.result);else if(a instanceof Dh){for(const l of a.args)if(i=bc(l),i)break}else(a instanceof ji||a instanceof Rn)&&a.input instanceof Xo&&"zoom"===a.input.name&&(i=a);return i instanceof Nn||a.eachChild(l=>{const u=bc(l);u instanceof Nn?i=u:!i&&u?i=new Nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&u&&i!==u&&(i=new Nn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Gi(a){const i=a.key,l=a.value,u=a.valueSpec||{},f=a.objectElementValidators||{},x=a.style,b=a.styleSpec;let M=[];const P=rr(l);if("object"!==P)return[new $e(i,l,`object expected, ${P} found`)];for(const F in l){const N=F.split(".")[0],V=u[N]||u["*"];let j;if(f[N])j=f[N];else if(u[N])j=To;else if(f["*"])j=f["*"];else{if(!u["*"]){M.push(new $e(i,l[F],`unknown property "${F}"`));continue}j=To}M=M.concat(j({key:(i&&`${i}.`)+F,value:l[F],valueSpec:V,style:x,styleSpec:b,object:l,objectKey:F},l))}for(const F in u)f[F]||u[F].required&&void 0===u[F].default&&void 0===l[F]&&M.push(new $e(i,l,`missing required property "${F}"`));return M}function Od(a){const i=a.value,l=a.valueSpec,u=a.style,f=a.styleSpec,x=a.key,b=a.arrayElementValidator||To;if("array"!==rr(i))return[new $e(x,i,`array expected, ${rr(i)} found`)];if(l.length&&i.length!==l.length)return[new $e(x,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new $e(x,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let M={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum};f.$version<7&&(M.function=l.function),"object"===rr(l.value)&&(M=l.value);let P=[];for(let F=0;F<i.length;F++)P=P.concat(b({array:i,arrayIndex:F,value:i[F],valueSpec:M,style:u,styleSpec:f,key:`${x}[${F}]`}));return P}function mo(a){const i=a.key,l=a.value,u=a.valueSpec;let f=rr(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new $e(i,l,`number expected, ${f} found`)];if("minimum"in u){let x=u.minimum;if("array"===rr(u.minimum)&&(x=u.minimum[a.arrayIndex]),l<x)return[new $e(i,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in u){let x=u.maximum;if("array"===rr(u.maximum)&&(x=u.maximum[a.arrayIndex]),l>x)return[new $e(i,l,`${l} is greater than the maximum value ${x}`)]}return[]}function Ph(a){const i=a.valueSpec,l=on(a.value.type);let u,f,x,b={};const M="categorical"!==l&&void 0===a.value.property,P=!M,F="array"===rr(a.value.stops)&&"array"===rr(a.value.stops[0])&&"object"===rr(a.value.stops[0][0]),N=Gi({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(q){if("identity"===l)return[new $e(q.key,q.value,'identity function may not have a "stops" property')];let re=[];const oe=q.value;return re=re.concat(Od({key:q.key,value:oe,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:V})),"array"===rr(oe)&&0===oe.length&&re.push(new $e(q.key,oe,"array must have at least one stop")),re},default:function(q){return To({key:q.key,value:q.value,valueSpec:i,style:q.style,styleSpec:q.styleSpec})}}});return"identity"===l&&M&&N.push(new $e(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||N.push(new $e(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!uf(a.valueSpec)&&N.push(new $e(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!xc(a.valueSpec)?N.push(new $e(a.key,a.value,"property functions not supported")):M&&!Pd(a.valueSpec)&&N.push(new $e(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!F||void 0!==a.value.property||N.push(new $e(a.key,a.value,'"property" property is required')),N;function V(q){let re=[];const oe=q.value,Ae=q.key;if("array"!==rr(oe))return[new $e(Ae,oe,`array expected, ${rr(oe)} found`)];if(2!==oe.length)return[new $e(Ae,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if("object"!==rr(oe[0]))return[new $e(Ae,oe,`object expected, ${rr(oe[0])} found`)];if(void 0===oe[0].zoom)return[new $e(Ae,oe,"object stop key must have zoom")];if(void 0===oe[0].value)return[new $e(Ae,oe,"object stop key must have value")];if(x&&x>on(oe[0].zoom))return[new $e(Ae,oe[0].zoom,"stop zoom values must appear in ascending order")];on(oe[0].zoom)!==x&&(x=on(oe[0].zoom),f=void 0,b={}),re=re.concat(Gi({key:`${Ae}[0]`,value:oe[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:mo,value:j}}))}else re=re.concat(j({key:`${Ae}[0]`,value:oe[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},oe));return Dr(Kn(oe[1]))?re.concat([new $e(`${Ae}[1]`,oe[1],"expressions are not allowed in function stops.")]):re.concat(To({key:`${Ae}[1]`,value:oe[1],valueSpec:i,style:q.style,styleSpec:q.styleSpec}))}function j(q,re){const oe=rr(q.value),Ae=on(q.value),xe=null!==q.value?q.value:re;if(u){if(oe!==u)return[new $e(q.key,xe,`${oe} stop domain type must match previous stop domain type ${u}`)]}else u=oe;if("number"!==oe&&"string"!==oe&&"boolean"!==oe)return[new $e(q.key,xe,"stop domain value must be a number, string, or boolean")];if("number"!==oe&&"categorical"!==l){let Me=`number expected, ${oe} found`;return xc(i)&&void 0===l&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(q.key,xe,Me)]}return"categorical"!==l||"number"!==oe||isFinite(Ae)&&Math.floor(Ae)===Ae?"categorical"!==l&&"number"===oe&&void 0!==f&&Ae<f?[new $e(q.key,xe,"stop domain values must appear in ascending order")]:(f=Ae,"categorical"===l&&Ae in b?[new $e(q.key,xe,"stop domain values must be unique")]:(b[Ae]=!0,[])):[new $e(q.key,xe,`integer expected, found ${Ae}`)]}}function Da(a){const i=("property"===a.expressionContext?kh:ns)(Kn(a.value),a.valueSpec);if("error"===i.result)return i.value.map(u=>new $e(`${a.key}${u.key}`,a.value,u.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new $e(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!vi(l))return[new $e(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!vi(l))return[new $e(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Pi(l,["zoom","feature-state"]))return[new $e(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Xt(l))return[new $e(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ka(a){const i=a.key,l=a.value,u=a.valueSpec,f=[];return Array.isArray(u.values)?-1===u.values.indexOf(on(l))&&f.push(new $e(i,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(on(l))&&f.push(new $e(i,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Rh(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!Rh(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}const ku={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pu(a){if(null==a)return{filter:()=>!0,needGeometry:!1};Rh(a)||(a=Ja(a));const i=ns(a,ku);if("error"===i.result)throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,u,f)=>i.value.evaluate(l,u,{},f),needGeometry:dm(a)}}function qr(a,i){return a<i?-1:a>i?1:0}function dm(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let i=1;i<a.length;i++)if(dm(a[i]))return!0;return!1}function Ja(a){if(!a)return!0;const i=a[0];return a.length<=1?"any"!==i:"=="===i?Ld(a[1],a[2],"=="):"!="===i?Bd(Ld(a[1],a[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Ld(a[1],a[2],i):"any"===i?(l=a.slice(1),["any"].concat(l.map(Ja))):"all"===i?["all"].concat(a.slice(1).map(Ja)):"none"===i?["all"].concat(a.slice(1).map(Ja).map(Bd)):"in"===i?oi(a[1],a.slice(2)):"!in"===i?Bd(oi(a[1],a.slice(2))):"has"===i?hf(a[1]):"!has"===i?Bd(hf(a[1])):"within"!==i||a;var l}function Ld(a,i,l){switch(a){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,a,i]}}function oi(a,i){if(0===i.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",a,["literal",i.sort(qr)]]:["filter-in-small",a,["literal",i]]}}function hf(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Bd(a){return["!",a]}function wc(a){return Rh(Kn(a.value))?Da(mn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):eo(a)}function eo(a){const i=a.value,l=a.key;if("array"!==rr(i))return[new $e(l,i,`array expected, ${rr(i)} found`)];const u=a.styleSpec;let f,x=[];if(i.length<1)return[new $e(l,i,"filter array must have at least 1 element")];switch(x=x.concat(Ka({key:`${l}[0]`,value:i[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),on(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===on(i[1])&&x.push(new $e(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&x.push(new $e(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=rr(i[1]),"string"!==f&&x.push(new $e(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let b=2;b<i.length;b++)f=rr(i[b]),"$type"===on(i[1])?x=x.concat(Ka({key:`${l}[${b}]`,value:i[b],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&x.push(new $e(`${l}[${b}]`,i[b],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let b=1;b<i.length;b++)x=x.concat(eo({key:`${l}[${b}]`,value:i[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=rr(i[1]),2!==i.length?x.push(new $e(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==f&&x.push(new $e(`${l}[1]`,i[1],`string expected, ${f} found`));break;case"within":f=rr(i[1]),2!==i.length?x.push(new $e(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==f&&x.push(new $e(`${l}[1]`,i[1],`object expected, ${f} found`))}return x}function Ru(a,i){const l=a.key,u=a.style,f=a.styleSpec,x=a.value,b=a.objectKey,M=f[`${i}_${a.layerType}`];if(!M)return[];const P=b.match(/^(.*)-transition$/);if("paint"===i&&P&&M[P[1]]&&M[P[1]].transition)return To({key:l,value:x,valueSpec:f.transition,style:u,styleSpec:f});const F=a.valueSpec||M[b];if(!F)return[new $e(l,x,`unknown property "${b}"`)];let N;if("string"===rr(x)&&xc(F)&&!F.tokens&&(N=/^{([^}]+)}$/.exec(x)))return[new $e(l,x,`"${b}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const V=[];return"symbol"===a.layerType&&("text-field"===b&&u&&!u.glyphs&&V.push(new $e(l,x,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&Rd(Kn(x))&&"identity"===on(x.type)&&V.push(new $e(l,x,'"text-font" does not support identity functions'))),V.concat(To({key:a.key,value:x,valueSpec:F,style:u,styleSpec:f,expressionContext:"property",propertyType:i,propertyKey:b}))}function to(a){return Ru(a,"paint")}function Xs(a){return Ru(a,"layout")}function Mo(a){let i=[];const l=a.value,u=a.key,f=a.style,x=a.styleSpec;l.type||l.ref||i.push(new $e(u,l,'either "type" or "ref" is required'));let b=on(l.type);const M=on(l.ref);if(l.id){const P=on(l.id);for(let F=0;F<a.arrayIndex;F++){const N=f.layers[F];on(N.id)===P&&i.push(new $e(u,l.id,`duplicate layer id "${l.id}", previously used at line ${N.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach(F=>{F in l&&i.push(new $e(u,l[F],`"${F}" is prohibited for ref layers`))}),f.layers.forEach(F=>{on(F.id)===M&&(P=F)}),P?P.ref?i.push(new $e(u,l.ref,"ref cannot reference another ref layer")):b=on(P.type):i.push(new $e(u,l.ref,`ref layer "${M}" not found`))}else if("background"!==b&&"sky"!==b)if(l.source){const P=f.sources&&f.sources[l.source],F=P&&on(P.type);P?"vector"===F&&"raster"===b?i.push(new $e(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===F&&"raster"!==b?i.push(new $e(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==F||l["source-layer"]?"raster-dem"===F&&"hillshade"!==b?i.push(new $e(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]||"geojson"===F&&P.lineMetrics||i.push(new $e(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new $e(u,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new $e(u,l.source,`source "${l.source}" not found`))}else i.push(new $e(u,l,'missing required property "source"'));return i=i.concat(Gi({key:u,value:l,valueSpec:x.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>To({key:`${u}.type`,value:l.type,valueSpec:x.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:wc,layout:P=>Gi({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":F=>Xs(mn({layerType:b},F))}}),paint:P=>Gi({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":F=>to(mn({layerType:b},F))}})}})),i}function Pl(a){const i=a.value,l=a.key,u=rr(i);return"string"!==u?[new $e(l,i,`string expected, ${u} found`)]:[]}const Fh={promoteId:function({key:a,value:i}){if("string"===rr(i))return Pl({key:a,value:i});{const l=[];for(const u in i)l.push(...Pl({key:`${a}.${u}`,value:i[u]}));return l}}};function df(a){const i=a.value,l=a.key,u=a.styleSpec,f=a.style;if(!i.type)return[new $e(l,i,'"type" is required')];const x=on(i.type);let b;switch(x){case"vector":case"raster":case"raster-dem":return b=Gi({key:l,value:i,valueSpec:u[`source_${x.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Fh}),b;case"geojson":if(b=Gi({key:l,value:i,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:Fh}),i.cluster)for(const M in i.clusterProperties){const[P,F]=i.clusterProperties[M],N="string"==typeof P?[P,["accumulated"],["get",M]]:P;b.push(...Da({key:`${l}.${M}.map`,value:F,expressionContext:"cluster-map"})),b.push(...Da({key:`${l}.${M}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return b;case"video":return Gi({key:l,value:i,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return Gi({key:l,value:i,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new $e(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ka({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:u})}}function ws(a){const i=a.value,l=a.styleSpec,u=l.light,f=a.style;let x=[];const b=rr(i);if(void 0===i)return x;if("object"!==b)return x=x.concat([new $e("light",i,`object expected, ${b} found`)]),x;for(const M in i){const P=M.match(/^(.*)-transition$/);x=x.concat(P&&u[P[1]]&&u[P[1]].transition?To({key:M,value:i[M],valueSpec:l.transition,style:f,styleSpec:l}):u[M]?To({key:M,value:i[M],valueSpec:u[M],style:f,styleSpec:l}):[new $e(M,i[M],`unknown property "${M}"`)])}return x}function Nd(a){const i=a.value,l=a.key,u=a.style,f=a.styleSpec,x=f.terrain;let b=[];const M=rr(i);if(void 0===i)return b;if("object"!==M)return b=b.concat([new $e("terrain",i,`object expected, ${M} found`)]),b;for(const P in i){const F=P.match(/^(.*)-transition$/);b=b.concat(F&&x[F[1]]&&x[F[1]].transition?To({key:P,value:i[P],valueSpec:f.transition,style:u,styleSpec:f}):x[P]?To({key:P,value:i[P],valueSpec:x[P],style:u,styleSpec:f}):[new $e(P,i[P],`unknown property "${P}"`)])}if(i.source){const P=u.sources&&u.sources[i.source],F=P&&on(P.type);P?"raster-dem"!==F&&b.push(new $e(l,i.source,`terrain cannot be used with a source of type ${F}, it only be used with a "raster-dem" source type`)):b.push(new $e(l,i.source,`source "${i.source}" not found`))}else b.push(new $e(l,i,'terrain is missing required property "source"'));return b}function Cc(a){const i=a.value,l=a.style,u=a.styleSpec,f=u.fog;let x=[];const b=rr(i);if(void 0===i)return x;if("object"!==b)return x=x.concat([new $e("fog",i,`object expected, ${b} found`)]),x;for(const M in i){const P=M.match(/^(.*)-transition$/);x=x.concat(P&&f[P[1]]&&f[P[1]].transition?To({key:M,value:i[M],valueSpec:u.transition,style:l,styleSpec:u}):f[M]?To({key:M,value:i[M],valueSpec:f[M],style:l,styleSpec:u}):[new $e(M,i[M],`unknown property "${M}"`)])}return x}const sn={"*":()=>[],array:Od,boolean:function(a){const i=a.value,l=a.key,u=rr(i);return"boolean"!==u?[new $e(l,i,`boolean expected, ${u} found`)]:[]},number:mo,color:function(a){const i=a.key,l=a.value,u=rr(l);return"string"!==u?[new $e(i,l,`color expected, ${u} found`)]:null===vu.parseCSSColor(l)?[new $e(i,l,`color expected, "${l}" found`)]:[]},constants:Gt,enum:Ka,filter:wc,function:Ph,layer:Mo,object:Gi,source:df,light:ws,terrain:Nd,fog:Cc,string:Pl,formatted:function(a){return 0===Pl(a).length?[]:Da(a)},resolvedImage:function(a){return 0===Pl(a).length?[]:Da(a)}};function To(a){const i=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Rd(on(i))?Ph(a):l.expression&&Dr(Kn(i))?Da(a):l.type&&sn[l.type]?sn[l.type](a):Gi(mn({},a,{valueSpec:l.type?u[l.type]:l}))}function zd(a){const i=a.value,l=a.key,u=Pl(a);return u.length||(-1===i.indexOf("{fontstack}")&&u.push(new $e(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&u.push(new $e(l,i,'"glyphs" url must include a "{range}" token'))),u}function Sa(a,i=Ce){let l=[];return l=l.concat(To({key:"",value:a,valueSpec:i.$root,styleSpec:i,style:a,objectElementValidators:{glyphs:zd,"*":()=>[]}})),a.constants&&(l=l.concat(Gt({key:"constants",value:a.constants,style:a,styleSpec:i}))),Vd(l)}function Vd(a){return[].concat(a).sort((i,l)=>i.line-l.line)}function Ys(a){return function(...i){return Vd(a.apply(this,i))}}Sa.source=Ys(df),Sa.light=Ys(ws),Sa.terrain=Ys(Nd),Sa.fog=Ys(Cc),Sa.layer=Ys(Mo),Sa.filter=Ys(wc),Sa.paintProperty=Ys(to),Sa.layoutProperty=Ys(Xs);const Ec=Sa,Ud=Ec.light,ct=Ec.fog,Wn=Ec.paintProperty,el=Ec.layoutProperty;function si(a,i){let l=!1;if(i&&i.length)for(const u of i)a.fire(new Xe(new Error(u.message))),l=!0;return l}var Dc=no;function no(a,i,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(i=f[1])+2*(l=f[2]);for(var x=0;x<this.d*this.d;x++){var b=f[3+x],M=f[3+x+1];u.push(b===M?null:f.subarray(b,M))}var P=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],P),this.bboxes=f.subarray(P),this.insert=this._insertReadonly}else{this.d=i+2*l;for(var F=0;F<this.d*this.d;F++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=a,this.padding=l,this.scale=i/a,this.uid=0;var N=l/i*a;this.min=-N,this.max=a+N}no.prototype.insert=function(a,i,l,u,f){this._forEachCell(i,l,u,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(f)},no.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},no.prototype._insertCell=function(a,i,l,u,f,x){this.cells[f].push(x)},no.prototype.query=function(a,i,l,u,f){var x=this.min,b=this.max;if(a<=x&&i<=x&&b<=l&&b<=u&&!f)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,i,l,u,this._queryCell,M,{},f),M},no.prototype._queryCell=function(a,i,l,u,f,x,b,M){var P=this.cells[f];if(null!==P)for(var F=this.keys,N=this.bboxes,V=0;V<P.length;V++){var j=P[V];if(void 0===b[j]){var q=4*j;(M?M(N[q+0],N[q+1],N[q+2],N[q+3]):a<=N[q+2]&&i<=N[q+3]&&l>=N[q+0]&&u>=N[q+1])?(b[j]=!0,x.push(F[j])):b[j]=!1}}},no.prototype._forEachCell=function(a,i,l,u,f,x,b,M){for(var P=this._convertToCellCoord(a),F=this._convertToCellCoord(i),N=this._convertToCellCoord(l),V=this._convertToCellCoord(u),j=P;j<=N;j++)for(var q=F;q<=V;q++){var re=this.d*q+j;if((!M||M(this._convertFromCellCoord(j),this._convertFromCellCoord(q),this._convertFromCellCoord(j+1),this._convertFromCellCoord(q+1)))&&f.call(this,a,i,l,u,re,x,b,M))return}},no.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},no.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},no.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,i=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var f=new Int32Array(i+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var x=i,b=0;b<a.length;b++){var M=a[b];f[3+b]=x,f.set(M,x),x+=M.length}return f[3+a.length]=x,f.set(this.keys,x),f[3+a.length+1]=x+=this.keys.length,f.set(this.bboxes,x),x+=this.bboxes.length,f.buffer};const{ImageData:Cs,ImageBitmap:Oh}=wt,Rl={};function Pt(a,i,l={}){Object.defineProperty(i,"_classRegistryKey",{value:a,writeable:!1}),Rl[a]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Pt("Object",Object),Dc.serialize=function(a,i){const l=a.toArrayBuffer();return i&&i.push(l),{buffer:l}},Dc.deserialize=function(a){return new Dc(a.buffer)},Pt("Grid",Dc),Pt("Color",un),Pt("Error",Error),Pt("ResolvedImage",Oo),Pt("StylePropertyFunction",Iu),Pt("StyleExpression",Th,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",Ya),Pt("ZoomConstantExpression",Ih),Pt("CompoundExpression",Xo,{omit:["_evaluate"]});for(const a in _c)_c[a]._classRegistryKey||Pt(`Expression_${a}`,_c[a]);function jd(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Fu(a){return Oh&&a instanceof Oh}function tl(a,i){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(jd(a)||Fu(a))return i&&i.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return i&&i.push(l.buffer),l}if(a instanceof Cs)return i&&i.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(tl(u,i));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");const f=l.serialize?l.serialize(a,i):{};if(!l.serialize){for(const x in a){if(!a.hasOwnProperty(x)||Rl[u].omit.indexOf(x)>=0)continue;const b=a[x];f[x]=Rl[u].shallow.indexOf(x)>=0?b:tl(b,i)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof a)}function bi(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||jd(a)||Fu(a)||ArrayBuffer.isView(a)||a instanceof Cs)return a;if(Array.isArray(a))return a.map(bi);if("object"==typeof a){const i=a.$name||"Object",{klass:l}=Rl[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const f of Object.keys(a)){if("$name"===f)continue;const x=a[f];u[f]=Rl[i].shallow.indexOf(f)>=0?x:bi(x)}return u}throw new Error("can't deserialize object of type "+typeof a)}class Es{constructor(){this.first=!0}update(i,l){const u=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=u,!0))}}const Gd=a=>a>=1536&&a<=1791,Fl=a=>a>=1872&&a<=1919,Ks=a=>a>=2208&&a<=2303,Ou=a=>a>=11904&&a<=12031,$d=a=>a>=12032&&a<=12255,Af=a=>a>=12272&&a<=12287,Ol=a=>a>=12288&&a<=12351,Lu=a=>a>=12352&&a<=12447,Sc=a=>a>=12448&&a<=12543,Lh=a=>a>=12544&&a<=12591,Bu=a=>a>=12704&&a<=12735,Hd=a=>a>=12736&&a<=12783,Bh=a=>a>=12784&&a<=12799,Ll=a=>a>=12800&&a<=13055,Nu=a=>a>=13056&&a<=13311,qd=a=>a>=13312&&a<=19903,Nh=a=>a>=19968&&a<=40959,Mc=a=>a>=40960&&a<=42127,zu=a=>a>=42128&&a<=42191,Bl=a=>a>=44032&&a<=55215,ff=a=>a>=63744&&a<=64255,wi=a=>a>=64336&&a<=65023,Ma=a=>a>=65040&&a<=65055,Vr=a=>a>=65072&&a<=65103,pf=a=>a>=65104&&a<=65135,nl=a=>a>=65136&&a<=65279,Tc=a=>a>=65280&&a<=65519;function Nl(a){for(const i of a)if(Js(i.charCodeAt(0)))return!0;return!1}function Am(a){for(const i of a)if(!mf(i.charCodeAt(0)))return!1;return!0}function mf(a){return!(Gd(a)||Fl(a)||Ks(a)||wi(a)||nl(a))}function Js(a){return!(746!==a&&747!==a&&(a<4352||!(Bu(a)||Lh(a)||Vr(a)&&!(a>=65097&&a<=65103)||ff(a)||Nu(a)||Ou(a)||Hd(a)||!(!Ol(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||qd(a)||Nh(a)||Ll(a)||(i=a,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(a)||(i=>i>=55216&&i<=55295)(a)||(i=>i>=4352&&i<=4607)(a)||Bl(a)||Lu(a)||Af(a)||(i=>i>=12688&&i<=12703)(a)||$d(a)||Bh(a)||Sc(a)&&12540!==a||!(!Tc(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!pf(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(i=>i>=5120&&i<=5759)(a)||(i=>i>=6320&&i<=6399)(a)||Ma(a)||(i=>i>=19904&&i<=19967)(a)||Mc(a)||zu(a))));var i}function Vu(a){return!(Js(a)||(i=a,(l=i)>=128&&l<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(l=>l>=8192&&l<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(l=>l>=8448&&l<=8527)(i)||(l=>l>=8528&&l<=8591)(i)||(l=>l>=8960&&l<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(l=>l>=9216&&l<=9279)(i)&&9251!==i||(l=>l>=9280&&l<=9311)(i)||(l=>l>=9312&&l<=9471)(i)||(l=>l>=9632&&l<=9727)(i)||(l=>l>=9728&&l<=9983)(i)&&!(i>=9754&&i<=9759)||(l=>l>=11008&&l<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Ol(i)||Sc(i)||(l=>l>=57344&&l<=63743)(i)||Vr(i)||pf(i)||Tc(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,l}function Uu(a){return a>=1424&&a<=2303||wi(a)||nl(a)}function Ic(a,i){return!(!i&&Uu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function _(a){for(const i of a)if(Uu(i.charCodeAt(0)))return!0;return!1}const s="deferred",h="loading",v="loaded";let E=null,D="unavailable",R=null;const B=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(D="error"),E&&E(a)};function z(){$.fire(new ft("pluginStateChange",{pluginStatus:D,pluginURL:R}))}const $=new jt,H=function(){return D},Q=function(){if(D!==s||!R)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");D=h,z(),R&&Z({url:R},a=>{a?B(a):(D=v,z())})},J={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>D===v||null!=J.applyArabicShaping,isLoading:()=>D===h,setState(a){D=a.pluginStatus,R=a.pluginURL},isParsed:()=>null!=J.applyArabicShaping&&null!=J.processBidirectionalText&&null!=J.processStyledBidirectionalText,getPluginURL:()=>R};class te{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Es,this.transition={})}isSupportedScript(i){return function(l,u){for(const f of l)if(!Ic(f.charCodeAt(0),u))return!1;return!0}(i,J.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),u=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*l}}}class le{constructor(i,l){this.property=i,this.value=l,this.expression=function(u,f){if(Rd(u))return new Iu(u,f);if(Dr(u)){const x=kh(u,f);if("error"===x.result)throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=u;return"string"==typeof u&&"color"===f.type&&(x=un.parse(u)),{kind:"constant",evaluate:()=>x}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,u){return this.property.possiblyEvaluate(this,i,l,u)}}class ce{constructor(i){this.property=i,this.value=new le(i,void 0)}transitioned(i,l){return new se(this.property,this.value,l,hi({},i.transition,this.transition),i.now)}untransitioned(){return new se(this.property,this.value,null,{},0)}}class _e{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Or(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ce(this._values[i].property)),this._values[i].value=new le(this._values[i].property,null===l?void 0:Or(l))}getTransition(i){return Or(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ce(this._values[i].property)),this._values[i].transition=Or(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(i[l]=u);const f=this.getTransition(l);void 0!==f&&(i[`${l}-transition`]=f)}return i}transitioned(i,l){const u=new ue(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(i,l._values[f]);return u}untransitioned(){const i=new ue(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class se{constructor(i,l,u,f,x){const b=f.delay||0,M=f.duration||0;x=x||0,this.property=i,this.value=l,this.begin=x+b,this.end=this.begin+M,i.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(i,l,u){const f=i.now||0,x=this.value.possiblyEvaluate(i,l,u),b=this.prior;if(b){if(f>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(f<this.begin)return b.possiblyEvaluate(i,l,u);{const M=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(i,l,u),x,hu(M))}}return x}}class ue{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,u){const f=new Se(this._properties);for(const x of Object.keys(this._values))f._values[x]=this._values[x].possiblyEvaluate(i,l,u);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ge{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Or(this._values[i].value)}setValue(i,l){this._values[i]=new le(this._values[i].property,null===l?void 0:Or(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(i[l]=u)}return i}possiblyEvaluate(i,l,u){const f=new Se(this._properties);for(const x of Object.keys(this._values))f._values[x]=this._values[x].possiblyEvaluate(i,l,u);return f}}class ve{constructor(i,l,u){this.property=i,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,u,f){return this.property.evaluate(this.value,this.parameters,i,l,u,f)}}class Se{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class de{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,u){const f=bn[this.specification.type];return f?f(i,l,u):i}}class Fe{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,u,f){return new ve(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},u,f)}:i.expression,l)}interpolate(i,l,u){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new ve(this,{kind:"constant",value:void 0},i.parameters);const f=bn[this.specification.type];return f?new ve(this,{kind:"constant",value:f(i.value.value,l.value.value,u)},i.parameters):i}evaluate(i,l,u,f,x,b){return"constant"===i.kind?i.value:i.evaluate(l,u,f,x,b)}}class We extends Fe{possiblyEvaluate(i,l,u,f){if(void 0===i.value)return new ve(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const x=i.expression.evaluate(l,null,{},u,f),b="resolvedImage"===i.property.specification.type&&"string"!=typeof x?x.name:x,M=this._calculate(b,b,b,l);return new ve(this,{kind:"constant",value:M},l)}if("camera"===i.expression.kind){const x=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new ve(this,{kind:"constant",value:x},l)}return new ve(this,i.expression,l)}evaluate(i,l,u,f,x,b){if("source"===i.kind){const M=i.evaluate(l,u,f,x,b);return this._calculate(M,M,M,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},u,f),i.evaluate({zoom:Math.floor(l.zoom)},u,f),i.evaluate({zoom:Math.floor(l.zoom)+1},u,f),l):i.value}_calculate(i,l,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l,other:u}:{from:u,to:l,other:i}}interpolate(i){return i}}class nt{constructor(i){this.specification=i}possiblyEvaluate(i,l,u,f){if(void 0!==i.value){if("constant"===i.expression.kind){const x=i.expression.evaluate(l,null,{},u,f);return this._calculate(x,x,x,l)}return this._calculate(i.expression.evaluate(new te(Math.floor(l.zoom-1),l)),i.expression.evaluate(new te(Math.floor(l.zoom),l)),i.expression.evaluate(new te(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,u,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:u,to:l}}interpolate(i){return i}}class Pe{constructor(i){this.specification=i}possiblyEvaluate(i,l,u,f){return!!i.expression.evaluate(l,null,{},u,f)}interpolate(){return!1}}class Ge{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const u=i[l];u.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new le(u,void 0),x=this.defaultTransitionablePropertyValues[l]=new ce(u);this.defaultTransitioningPropertyValues[l]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate({})}}}function xt(a,i){return 256*(a=ui(Math.floor(a),0,255))+ui(Math.floor(i),0,255)}Pt("DataDrivenProperty",Fe),Pt("DataConstantProperty",de),Pt("CrossFadedDataDrivenProperty",We),Pt("CrossFadedProperty",nt),Pt("ColorRampProperty",Pe);const Dt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Et{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mt(a,i=1){let l=0,u=0;return{members:a.map(f=>{const x=Dt[f.type].BYTES_PER_ELEMENT,b=l=wn(l,Math.max(i,x)),M=f.components||1;return u=Math.max(u,x),l+=x*M,{name:f.name,type:f.type,components:M,offset:b}}),size:wn(l,Math.max(u,i)),alignment:i}}function wn(a,i){return Math.ceil(a/i)*i}class Jt extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const u=this.length;return this.resize(u+1),this.emplace(u,i,l)}emplace(i,l,u){const f=2*i;return this.int16[f+0]=l,this.int16[f+1]=u,i}}Jt.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",Jt);class Ur extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=4*i;return this.int16[b+0]=l,this.int16[b+1]=u,this.int16[b+2]=f,this.int16[b+3]=x,i}}Ur.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",Ur);class wr extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,l,u,f,x,b,M)}emplace(i,l,u,f,x,b,M,P){const F=6*i,N=12*i,V=3*i;return this.int16[F+0]=l,this.int16[F+1]=u,this.uint8[N+4]=f,this.uint8[N+5]=x,this.uint8[N+6]=b,this.uint8[N+7]=M,this.float32[V+2]=P,i}}wr.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4ub1f12",wr);class cn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,u)}emplace(i,l,u,f){const x=3*i;return this.float32[x+0]=l,this.float32[x+1]=u,this.float32[x+2]=f,i}}cn.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",cn);class Cn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N){const V=this.length;return this.resize(V+1),this.emplace(V,i,l,u,f,x,b,M,P,F,N)}emplace(i,l,u,f,x,b,M,P,F,N,V){const j=10*i;return this.uint16[j+0]=l,this.uint16[j+1]=u,this.uint16[j+2]=f,this.uint16[j+3]=x,this.uint16[j+4]=b,this.uint16[j+5]=M,this.uint16[j+6]=P,this.uint16[j+7]=F,this.uint16[j+8]=N,this.uint16[j+9]=V,i}}Cn.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",Cn);class Br extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P){const F=this.length;return this.resize(F+1),this.emplace(F,i,l,u,f,x,b,M,P)}emplace(i,l,u,f,x,b,M,P,F){const N=8*i;return this.uint16[N+0]=l,this.uint16[N+1]=u,this.uint16[N+2]=f,this.uint16[N+3]=x,this.uint16[N+4]=b,this.uint16[N+5]=M,this.uint16[N+6]=P,this.uint16[N+7]=F,i}}Br.prototype.bytesPerElement=16,Pt("StructArrayLayout8ui16",Br);class go extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae){const xe=this.length;return this.resize(xe+1),this.emplace(xe,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe){const Me=16*i;return this.int16[Me+0]=l,this.int16[Me+1]=u,this.int16[Me+2]=f,this.int16[Me+3]=x,this.uint16[Me+4]=b,this.uint16[Me+5]=M,this.uint16[Me+6]=P,this.uint16[Me+7]=F,this.int16[Me+8]=N,this.int16[Me+9]=V,this.int16[Me+10]=j,this.int16[Me+11]=q,this.int16[Me+12]=re,this.int16[Me+13]=oe,this.int16[Me+14]=Ae,this.int16[Me+15]=xe,i}}go.prototype.bytesPerElement=32,Pt("StructArrayLayout4i4ui4i4i32",go);class Io extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Io.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",Io);class ro extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q){const re=this.length;return this.resize(re+1),this.emplace(re,i,l,u,f,x,b,M,P,F,N,V,j,q)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re){const oe=20*i,Ae=10*i;return this.int16[oe+0]=l,this.int16[oe+1]=u,this.int16[oe+2]=f,this.int16[oe+3]=x,this.int16[oe+4]=b,this.float32[Ae+3]=M,this.float32[Ae+4]=P,this.float32[Ae+5]=F,this.float32[Ae+6]=N,this.int16[oe+14]=V,this.uint32[Ae+8]=j,this.uint16[oe+18]=q,this.uint16[oe+19]=re,i}}ro.prototype.bytesPerElement=40,Pt("StructArrayLayout5i4f1i1ul2ui40",ro);class _o extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,l,u,f,x,b,M)}emplace(i,l,u,f,x,b,M,P){const F=8*i;return this.int16[F+0]=l,this.int16[F+1]=u,this.int16[F+2]=f,this.int16[F+4]=x,this.int16[F+5]=b,this.int16[F+6]=M,this.int16[F+7]=P,i}}_o.prototype.bytesPerElement=16,Pt("StructArrayLayout3i2i2i16",_o);class Ds extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,u,f,x)}emplace(i,l,u,f,x,b){const M=4*i,P=8*i;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=f,this.int16[P+6]=x,this.int16[P+7]=b,i}}Ds.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",Ds);class ko extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=12*i,M=3*i;return this.uint8[b+0]=l,this.uint8[b+1]=u,this.float32[M+1]=f,this.float32[M+2]=x,i}}ko.prototype.bytesPerElement=12,Pt("StructArrayLayout2ub2f12",ko);class Tn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,u)}emplace(i,l,u,f){const x=3*i;return this.uint16[x+0]=l,this.uint16[x+1]=u,this.uint16[x+2]=f,i}}Tn.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",Tn);class Sr extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue){const Ze=30*i,ot=15*i,At=60*i;return this.int16[Ze+0]=l,this.int16[Ze+1]=u,this.int16[Ze+2]=f,this.float32[ot+2]=x,this.float32[ot+3]=b,this.uint16[Ze+8]=M,this.uint16[Ze+9]=P,this.uint32[ot+5]=F,this.uint32[ot+6]=N,this.uint32[ot+7]=V,this.uint16[Ze+16]=j,this.uint16[Ze+17]=q,this.uint16[Ze+18]=re,this.float32[ot+10]=oe,this.float32[ot+11]=Ae,this.uint8[At+48]=xe,this.uint8[At+49]=Me,this.uint8[At+50]=Le,this.uint32[ot+13]=Be,this.int16[Ze+28]=Ne,this.uint8[At+58]=Ue,i}}Sr.prototype.bytesPerElement=60,Pt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Sr);class zn extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue,Ze,ot,At,pt,et,it,yt,rt){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue,Ze,ot,At,pt,et,it,yt,rt)}emplace(i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe,Ae,xe,Me,Le,Be,Ne,Ue,Ze,ot,At,pt,et,it,yt,rt,Yt){const St=38*i,er=19*i;return this.int16[St+0]=l,this.int16[St+1]=u,this.int16[St+2]=f,this.float32[er+2]=x,this.float32[er+3]=b,this.int16[St+8]=M,this.int16[St+9]=P,this.int16[St+10]=F,this.int16[St+11]=N,this.int16[St+12]=V,this.int16[St+13]=j,this.uint16[St+14]=q,this.uint16[St+15]=re,this.uint16[St+16]=oe,this.uint16[St+17]=Ae,this.uint16[St+18]=xe,this.uint16[St+19]=Me,this.uint16[St+20]=Le,this.uint16[St+21]=Be,this.uint16[St+22]=Ne,this.uint16[St+23]=Ue,this.uint16[St+24]=Ze,this.uint16[St+25]=ot,this.uint16[St+26]=At,this.uint16[St+27]=pt,this.uint16[St+28]=et,this.uint32[er+15]=it,this.float32[er+16]=yt,this.float32[er+17]=rt,this.float32[er+18]=Yt,i}}zn.prototype.bytesPerElement=76,Pt("StructArrayLayout3i2f6i15ui1ul3f76",zn);class xr extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}xr.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",xr);class Ci extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,u)}emplace(i,l,u,f){const x=3*i;return this.int16[x+0]=l,this.int16[x+1]=u,this.int16[x+2]=f,i}}Ci.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",Ci);class ir extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=6*i;return this.uint32[3*i+0]=l,this.uint16[b+2]=u,this.uint16[b+3]=f,this.uint16[b+4]=x,i}}ir.prototype.bytesPerElement=12,Pt("StructArrayLayout1ul3ui12",ir);class ai extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const u=this.length;return this.resize(u+1),this.emplace(u,i,l)}emplace(i,l,u){const f=2*i;return this.uint16[f+0]=l,this.uint16[f+1]=u,i}}ai.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",ai);class Po extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Po.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",Po);class io extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,u,f,x)}emplace(i,l,u,f,x,b){const M=5*i;return this.float32[M+0]=l,this.float32[M+1]=u,this.float32[M+2]=f,this.float32[M+3]=x,this.float32[M+4]=b,i}}io.prototype.bytesPerElement=20,Pt("StructArrayLayout5f20",io);class Zd extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const u=this.length;return this.resize(u+1),this.emplace(u,i,l)}emplace(i,l,u){const f=2*i;return this.float32[f+0]=l,this.float32[f+1]=u,i}}Zd.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",Zd);class gf extends dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,u,f){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,u,f)}emplace(i,l,u,f,x){const b=4*i;return this.float32[b+0]=l,this.float32[b+1]=u,this.float32[b+2]=f,this.float32[b+3]=x,i}}gf.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",gf);class zh extends Et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}zh.prototype.size=40;class kc extends ro{get(i){return new zh(this,i)}}Pt("CollisionBoxArray",kc);class _f extends Et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}_f.prototype.size=60;class nn extends Sr{get(i){return new _f(this,i)}}Pt("PlacedSymbolArray",nn);class Vh extends Et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Vh.prototype.size=76;class fm extends zn{get(i){return new Vh(this,i)}}Pt("SymbolInstanceArray",fm);class Ev extends xr{getoffsetX(i){return this.float32[1*i+0]}}Pt("GlyphOffsetArray",Ev);class Dv extends Ci{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Pt("SymbolLineVertexArray",Dv);class Sv extends Et{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Sv.prototype.size=12;class Mv extends ir{get(i){return new Sv(this,i)}}Pt("FeatureIndexArray",Mv);class Tv extends Et{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Tv.prototype.size=4;class Iv extends ai{get(i){return new Tv(this,i)}}Pt("FillExtrusionCentroidArray",Iv);const e2=Mt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),t2=Mt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var kv=Qo(function(a){a.exports=function(i,l){var u,f,x,b,M,P,F,N;for(f=i.length-(u=3&i.length),x=l,M=3432918353,P=461845907,N=0;N<f;)F=255&i.charCodeAt(N)|(255&i.charCodeAt(++N))<<8|(255&i.charCodeAt(++N))<<16|(255&i.charCodeAt(++N))<<24,++N,x=27492+(65535&(b=5*(65535&(x=(x^=F=(65535&(F=(F=(65535&F)*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*P+(((F>>>16)*P&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(F=0,u){case 3:F^=(255&i.charCodeAt(N+2))<<16;case 2:F^=(255&i.charCodeAt(N+1))<<8;case 1:x^=F=(65535&(F=(F=(65535&(F^=255&i.charCodeAt(N)))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*P+(((F>>>16)*P&65535)<<16)&4294967295}return x^=i.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Wd=Qo(function(a){a.exports=function(i,l){for(var u,f=i.length,x=l^f,b=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24))+((1540483477*(u>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:x^=(255&i.charCodeAt(b+2))<<16;case 2:x^=(255&i.charCodeAt(b+1))<<8;case 1:x=1540483477*(65535&(x^=255&i.charCodeAt(b)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),yf=kv,$i=Wd;yf.murmur3=kv,yf.murmur2=$i;class ju{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,u,f){this.ids.push(Qd(i)),this.positions.push(l,u,f)}getPositions(i){const l=Qd(i);let u=0,f=this.ids.length-1;for(;u<f;){const b=u+f>>1;this.ids[b]>=l?f=b:u=b+1}const x=[];for(;this.ids[u]===l;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x}static serialize(i,l){const u=new Float64Array(i.ids),f=new Uint32Array(i.positions);return E0(u,f,0,u.length-1),l&&l.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(i){const l=new ju;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function Qd(a){const i=+a;return!isNaN(i)&&i<=ps?i:yf(String(a))}function E0(a,i,l,u){for(;l<u;){const f=a[l+u>>1];let x=l-1,b=u+1;for(;;){do{x++}while(a[x]<f);do{b--}while(a[b]>f);if(x>=b)break;vf(a,x,b),vf(i,3*x,3*b),vf(i,3*x+1,3*b+1),vf(i,3*x+2,3*b+2)}b-l<u-b?(E0(a,i,l,b),l=b+1):(E0(a,i,b+1,u),u=b)}}function vf(a,i,l){const u=a[i];a[i]=a[l],a[l]=u}Pt("FeaturePositionMap",ju);class Hi{constructor(i,l){this.gl=i.gl,this.location=l}}class Ss extends Hi{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Xd extends Hi{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Pc extends Hi{constructor(i,l){super(i,l),this.current=un.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Rc=new Float32Array(16),D0=new Float32Array(9);function pm(a){return[xt(255*a.r,255*a.g),xt(255*a.b,255*a.a)]}class Yd{constructor(i,l,u){this.value=i,this.uniformNames=l.map(f=>`u_${f}`),this.type=u}setUniform(i,l,u){i.set(u.constantOr(this.value))}getBinding(i,l,u){return"color"===this.type?new Pc(i,l):new Ss(i,l)}}class Kd{constructor(i,l){this.uniformNames=l.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tl.concat(l.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,l,u,f){const x="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;x&&i.set(x)}getBinding(i,l,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new Xd(i,l):new Ss(i,l)}}class Fc{constructor(i,l,u,f){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,l,u,f,x){const b=this.paintVertexArray.length,M=this.expression.evaluate(new te(0),l,{},f,[],x);this.paintVertexArray.resize(i),this._setPaintValue(b,i,M)}updatePaintArray(i,l,u,f){const x=this.expression.evaluate({zoom:0},u,f);this._setPaintValue(i,l,x)}_setPaintValue(i,l,u){if("color"===this.type){const f=pm(u);for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,f[0],f[1])}else{for(let f=i;f<l;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ea{constructor(i,l,u,f,x,b){this.expression=i,this.uniformNames=l.map(M=>`u_${M}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(i,l,u,f,x){const b=this.expression.evaluate(new te(this.zoom),l,{},f,[],x),M=this.expression.evaluate(new te(this.zoom+1),l,{},f,[],x),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,b,M)}updatePaintArray(i,l,u,f){const x=this.expression.evaluate({zoom:this.zoom},u,f),b=this.expression.evaluate({zoom:this.zoom+1},u,f);this._setPaintValue(i,l,x,b)}_setPaintValue(i,l,u,f){if("color"===this.type){const x=pm(u),b=pm(f);for(let M=i;M<l;M++)this.paintVertexArray.emplace(M,x[0],x[1],b[0],b[1])}else{for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const u=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,f=ui(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(f)}getBinding(i,l,u){return new Ss(i,l)}}class Ri{constructor(i,l,u,f,x,b,M){this.expression=i,this.type=u,this.useIntegerZoom=f,this.zoom=x,this.layerId=M,this.paintVertexAttributes=("array"===u?t2:e2).members;for(let P=0;P<l.length;++P);this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,l,u){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(f,i,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(i,l,u,f,x){this._setPaintValues(i,l,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(i,l,u,f){if(!f||!u)return;const{min:x,mid:b,max:M}=u,P=f[x],F=f[b],N=f[M];if(P&&F&&N)for(let V=i;V<l;V++)this._setPaintValue(this.zoomInPaintVertexArray,V,F,P),this._setPaintValue(this.zoomOutPaintVertexArray,V,F,N)}_setPaintValue(i,l,u,f){i.emplace(l,u.tl[0],u.tl[1],u.br[0],u.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],u.pixelRatio,f.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ta{constructor(i,l,u=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const x in i.paint._values){if(!u(x))continue;const b=i.paint.get(x);if(!(b instanceof ve&&xc(b.property.specification)))continue;const M=S0(x,i.type),P=b.value,F=b.property.specification.type,N=b.property.useIntegerZoom,V=b.property.specification["property-type"],j="cross-faded"===V||"cross-faded-data-driven"===V,q="line-dasharray"===String(x)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==P.kind||q)if("source"===P.kind||q||j){const re=M0(x,F,"source");this.binders[x]=j?new Ri(P,M,F,N,l,re,i.id):new Fc(P,M,F,re),f.push(`/a_${x}`)}else{const re=M0(x,F,"composite");this.binders[x]=new ea(P,M,F,N,l,re),f.push(`/z_${x}`)}else this.binders[x]=j?new Kd(P.value,M):new Yd(P.value,M,F),f.push(`/u_${x}`)}this.cacheKey=f.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof Fc||l instanceof ea?l.maxValue:0}populatePaintArrays(i,l,u,f,x){for(const b in this.binders){const M=this.binders[b];(M instanceof Fc||M instanceof ea||M instanceof Ri)&&M.populatePaintArray(i,l,u,f,x)}}setConstantPatternPositions(i,l){for(const u in this.binders){const f=this.binders[u];f instanceof Kd&&f.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,u,f,x){let b=!1;for(const M in i){const P=l.getPositions(M);for(const F of P){const N=u.feature(F.index);for(const V in this.binders){const j=this.binders[V];if((j instanceof Fc||j instanceof ea||j instanceof Ri)&&!0===j.expression.isStateDependent){const q=f.paint.get(V);j.expression=q.value,j.updatePaintArray(F.start,F.end,N,i[M],x),b=!0}}}}return b}defines(){const i=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Yd||u instanceof Kd)&&i.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Fc||u instanceof ea||u instanceof Ri)for(let f=0;f<u.paintVertexAttributes.length;f++)i.push(u.paintVertexAttributes[f].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Yd||u instanceof Kd||u instanceof ea)for(const f of u.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const u=[];for(const f in this.binders){const x=this.binders[f];if(x instanceof Yd||x instanceof Kd||x instanceof ea)for(const b of x.uniformNames)if(l[b]){const M=x.getBinding(i,l[b],b);u.push({name:b,property:f,binding:M})}}return u}setUniforms(i,l,u,f){for(const{name:x,property:b,binding:M}of l)this.binders[b].setUniform(M,f,u.get(b),x)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const u=this.binders[l];if(i&&u instanceof Ri){const f=2===i.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(u instanceof Fc||u instanceof ea)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(i){for(const l in this.binders){const u=this.binders[l];(u instanceof Fc||u instanceof ea||u instanceof Ri)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof Fc||l instanceof ea||l instanceof Ri)&&l.destroy()}}}class ta{constructor(i,l,u=(()=>!0)){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new Ta(f,l,u);this.needsUpload=!1,this._featureMap=new ju,this._bufferOffset=0}populatePaintArrays(i,l,u,f,x,b){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,l,f,x,b);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,u,f){for(const x of u)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(i,this._featureMap,l,x,f)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const n2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function S0(a,i){return n2[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}const Pv={"line-pattern":{source:Cn,composite:Cn},"fill-pattern":{source:Cn,composite:Cn},"fill-extrusion-pattern":{source:Cn,composite:Cn},"line-dasharray":{source:Br,composite:Br}},Rv={color:{source:Zd,composite:gf},number:{source:xr,composite:Zd}};function M0(a,i,l){const u=Pv[a];return u&&u[l]||Rv[i][l]}Pt("ConstantBinder",Yd),Pt("CrossFadedConstantBinder",Kd),Pt("SourceExpressionBinder",Fc),Pt("CrossFadedCompositeBinder",Ri),Pt("CompositeExpressionBinder",ea),Pt("ProgramConfiguration",Ta,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",ta);const xf="-transition";class Ia extends jt{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new ge(l.layout)),l.paint)){this._transitionablePaint=new _e(l.paint);for(const u in i.paint)this.setPaintProperty(u,i.paint[u],{validate:!1});for(const u in i.layout)this.setLayoutProperty(u,i.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Se(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,u={}){null!=l&&this._validate(el,`layers.${this.id}.layout.${i}`,i,l,u)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return _s(i,xf)?this._transitionablePaint.getTransition(i.slice(0,-xf.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,u={}){if(null!=l&&this._validate(Wn,`layers.${this.id}.paint.${i}`,i,l,u))return!1;if(_s(i,xf))return this._transitionablePaint.setTransition(i.slice(0,-xf.length),l||void 0),!1;{const f=this._transitionablePaint._values[i],x="cross-faded-data-driven"===f.property.specification["property-type"],b=f.value.isDataDriven(),M=f.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(i,M,P)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,l,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),qo(i,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(i,l,u,f,x={}){return(!x||!1!==x.validate)&&si(this,i.call(Ec,{key:l,layerType:this.type,objectKey:u,value:f,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof ve&&xc(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const Jd=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:mm}=Jd;class Fi{constructor(i=[]){this.segments=i}prepareSegment(i,l,u,f){let x=this.segments[this.segments.length-1];return i>Fi.MAX_VERTEX_ARRAY_LENGTH&&zr(`Max vertices per segment is ${Fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!x||x.vertexLength+i>Fi.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==f)&&(x={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==f&&(x.sortKey=f),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,u,f){return new Fi([{vertexOffset:i,primitiveOffset:l,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}Fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",Fi);var cr=8192;const Gu=Math.pow(2,14)-1,bf=-Gu-1;function na(a){const i=cr/a.extent,l=a.loadGeometry();for(let u=0;u<l.length;u++){const f=l[u];for(let x=0;x<f.length;x++){const b=f[x],M=Math.round(b.x*i),P=Math.round(b.y*i);b.x=ui(M,bf,Gu),b.y=ui(P,bf,Gu),(M<b.x||M>b.x+1||P<b.y||P>b.y+1)&&zr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function $u(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?na(a):[]}}function wf(a,i,l,u,f){a.emplaceBack(2*i+(u+1)/2,2*l+(f+1)/2)}class gm{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Jt,this.indexArray=new Tn,this.segments=new Fi,this.programConfigurations=new ta(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,u){const f=this.layers[0],x=[];let b=null;"circle"===f.type&&(b=f.layout.get("circle-sort-key"));for(const{feature:M,id:P,index:F,sourceLayerIndex:N}of i){const V=this.layers[0]._featureFilter.needGeometry,j=$u(M,V);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),j,u))continue;const q=b?b.evaluate(j,{},u):void 0,re={id:P,properties:M.properties,type:M.type,sourceLayerIndex:N,index:F,geometry:V?j.geometry:na(M),patterns:{},sortKey:q};x.push(re)}b&&x.sort((M,P)=>M.sortKey-P.sortKey);for(const M of x){const{geometry:P,index:F,sourceLayerIndex:N}=M,V=i[F].feature;this.addFeature(M,P,F,u),l.featureIndex.insert(V,P,F,N,this.index)}}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,mm),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,u,f){for(const x of l)for(const b of x){const M=b.x,P=b.y;if(M<0||M>=cr||P<0||P>=cr)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),N=F.vertexLength;wf(this.layoutVertexArray,M,P,-1,-1),wf(this.layoutVertexArray,M,P,1,-1),wf(this.layoutVertexArray,M,P,1,1),wf(this.layoutVertexArray,M,P,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},f)}}function Cf(a,i){for(let l=0;l<a.length;l++)if(ra(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(ra(a,i[l]))return!0;return!!Oc(a,i)}function r2(a,i,l){return!!ra(a,i)||!!_t(i,a,l)}function Ef(a,i){if(1===a.length)return T0(i,a[0]);for(let l=0;l<i.length;l++){const u=i[l];for(let f=0;f<u.length;f++)if(ra(a,u[f]))return!0}for(let l=0;l<a.length;l++)if(T0(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(Oc(a,i[l]))return!0;return!1}function eA(a,i,l){if(a.length>1){if(Oc(a,i))return!0;for(let u=0;u<i.length;u++)if(_t(i[u],a,l))return!0}for(let u=0;u<a.length;u++)if(_t(a[u],i,l))return!0;return!1}function Oc(a,i){if(0===a.length||0===i.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],f=a[l+1];for(let x=0;x<i.length-1;x++)if(Fv(u,f,i[x],i[x+1]))return!0}return!1}function Fv(a,i,l,u){return ys(a,l,u)!==ys(i,l,u)&&ys(a,i,l)!==ys(a,i,u)}function _t(a,i,l){const u=l*l;if(1===i.length)return a.distSqr(i[0])<u;for(let f=1;f<i.length;f++)if(_m(a,i[f-1],i[f])<u)return!0;return!1}function _m(a,i,l){const u=i.distSqr(l);if(0===u)return a.distSqr(i);const f=((a.x-i.x)*(l.x-i.x)+(a.y-i.y)*(l.y-i.y))/u;return a.distSqr(f<0?i:f>1?l:l.sub(i)._mult(f)._add(i))}function T0(a,i){let l,u,f,x=!1;for(let b=0;b<a.length;b++){l=a[b];for(let M=0,P=l.length-1;M<l.length;P=M++)u=l[M],f=l[P],u.y>i.y!=f.y>i.y&&i.x<(f.x-u.x)*(i.y-u.y)/(f.y-u.y)+u.x&&(x=!x)}return x}function ra(a,i){let l=!1;for(let u=0,f=a.length-1;u<a.length;f=u++){const x=a[u],b=a[f];x.y>i.y!=b.y>i.y&&i.x<(b.x-x.x)*(i.y-x.y)/(b.y-x.y)+x.x&&(l=!l)}return l}function Uh(a,i,l,u,f){for(const b of a)if(i<=b.x&&l<=b.y&&u>=b.x&&f>=b.y)return!0;const x=[new ut(i,l),new ut(i,f),new ut(u,f),new ut(u,l)];if(a.length>2)for(const b of x)if(ra(a,b))return!0;for(let b=0;b<a.length-1;b++)if(Ov(a[b],a[b+1],x))return!0;return!1}function Ov(a,i,l){const u=l[0],f=l[2];if(a.x<u.x&&i.x<u.x||a.x>f.x&&i.x>f.x||a.y<u.y&&i.y<u.y||a.y>f.y&&i.y>f.y)return!1;const x=ys(a,i,l[0]);return x!==ys(a,i,l[1])||x!==ys(a,i,l[2])||x!==ys(a,i,l[3])}function Hu(a,i,l){const u=i.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(i.id).getMaxValue(a)}function tA(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Lv(a,i,l,u,f){if(!i[0]&&!i[1])return a;const x=ut.convert(i)._mult(f);"viewport"===l&&x._rotate(-u);const b=[];for(let M=0;M<a.length;M++)b.push(a[M].sub(x));return b}function qu(a,i,l,u){const f=ut.convert(a)._mult(u);return"viewport"===i&&f._rotate(-l),f}Pt("CircleBucket",gm,{omit:["layers"]});const rs=new Ge({"circle-sort-key":new Fe(Ce.layout_circle["circle-sort-key"])});var Df={paint:new Ge({"circle-radius":new Fe(Ce.paint_circle["circle-radius"]),"circle-color":new Fe(Ce.paint_circle["circle-color"]),"circle-blur":new Fe(Ce.paint_circle["circle-blur"]),"circle-opacity":new Fe(Ce.paint_circle["circle-opacity"]),"circle-translate":new de(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new de(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new de(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new de(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fe(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fe(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fe(Ce.paint_circle["circle-stroke-opacity"])}),layout:rs},Ei="undefined"!=typeof Float32Array?Float32Array:Array;function I0(){var a=new Ei(9);return Ei!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Sf(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Mf(a,i,l){var u=i[0],f=i[1],x=i[2],b=i[3],M=i[4],P=i[5],F=i[6],N=i[7],V=i[8],j=i[9],q=i[10],re=i[11],oe=i[12],Ae=i[13],xe=i[14],Me=i[15],Le=l[0],Be=l[1],Ne=l[2],Ue=l[3];return a[0]=Le*u+Be*M+Ne*V+Ue*oe,a[1]=Le*f+Be*P+Ne*j+Ue*Ae,a[2]=Le*x+Be*F+Ne*q+Ue*xe,a[3]=Le*b+Be*N+Ne*re+Ue*Me,a[4]=(Le=l[4])*u+(Be=l[5])*M+(Ne=l[6])*V+(Ue=l[7])*oe,a[5]=Le*f+Be*P+Ne*j+Ue*Ae,a[6]=Le*x+Be*F+Ne*q+Ue*xe,a[7]=Le*b+Be*N+Ne*re+Ue*Me,a[8]=(Le=l[8])*u+(Be=l[9])*M+(Ne=l[10])*V+(Ue=l[11])*oe,a[9]=Le*f+Be*P+Ne*j+Ue*Ae,a[10]=Le*x+Be*F+Ne*q+Ue*xe,a[11]=Le*b+Be*N+Ne*re+Ue*Me,a[12]=(Le=l[12])*u+(Be=l[13])*M+(Ne=l[14])*V+(Ue=l[15])*oe,a[13]=Le*f+Be*P+Ne*j+Ue*Ae,a[14]=Le*x+Be*F+Ne*q+Ue*xe,a[15]=Le*b+Be*N+Ne*re+Ue*Me,a}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var Tf=Mf;function nA(){var a=new Ei(3);return Ei!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function k0(a){return Math.hypot(a[0],a[1],a[2])}function jh(a,i,l){var u=new Ei(3);return u[0]=a,u[1]=i,u[2]=l,u}function Zu(a,i,l){return a[0]=i[0]-l[0],a[1]=i[1]-l[1],a[2]=i[2]-l[2],a}function Gh(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a}function P0(a,i,l,u){return a[0]=i[0]+l[0]*u,a[1]=i[1]+l[1]*u,a[2]=i[2]+l[2]*u,a}function Bv(a,i){var l=i[0],u=i[1],f=i[2],x=l*l+u*u+f*f;return x>0&&(x=1/Math.sqrt(x)),a[0]=i[0]*x,a[1]=i[1]*x,a[2]=i[2]*x,a}function ym(a,i,l){var u=l[0],f=l[1],x=l[2],b=i[0],M=i[1],P=i[2],F=f*P-x*M,N=x*b-u*P,V=u*M-f*b,j=f*V-x*N,q=x*F-u*V,re=u*N-f*F,oe=2*l[3];return N*=oe,V*=oe,q*=2,re*=2,a[0]=b+(F*=oe)+(j*=2),a[1]=M+N+q,a[2]=P+V+re,a}var rA,i2=Zu,Nv=Gh,zv=k0;function iA(a,i,l){var u=i[0],f=i[1],x=i[2],b=i[3];return a[0]=l[0]*u+l[4]*f+l[8]*x+l[12]*b,a[1]=l[1]*u+l[5]*f+l[9]*x+l[13]*b,a[2]=l[2]*u+l[6]*f+l[10]*x+l[14]*b,a[3]=l[3]*u+l[7]*f+l[11]*x+l[15]*b,a}function $h(){var a=new Ei(4);return Ei!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function If(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Wu(a,i,l){l*=.5;var u=i[0],f=i[1],x=i[2],b=i[3],M=Math.sin(l),P=Math.cos(l);return a[0]=u*P+b*M,a[1]=f*P+x*M,a[2]=x*P-f*M,a[3]=b*P-u*M,a}function R0(a,i,l,u,f,x,b,M,P){if(x&&a.queryGeometry.isAboveHorizon)return!1;x&&(P*=a.pixelToTileUnitsFactor);for(const F of i)for(const N of F){const V=N.add(M),j=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(V.x,V.y,!0):0,q=x?V:Vv(V,j,u),re=x?a.tilespaceRays.map(Ae=>vm(Ae,j)):a.queryGeometry.screenGeometry,oe=iA([],[N.x,N.y,j,1],u);if(!b&&x?P*=oe[3]/l.cameraToCenterDistance:b&&!x&&(P*=l.cameraToCenterDistance/oe[3]),r2(re,q,P))return!0}return!1}function Vv(a,i,l){const u=iA([],[a.x,a.y,i,1],l);return new ut(u[0]/u[3],u[1]/u[3])}nA(),rA=new Ei(4),Ei!=Float32Array&&(rA[0]=0,rA[1]=0,rA[2]=0,rA[3]=0),nA(),jh(1,0,0),jh(0,1,0),$h(),$h(),I0();const Uv=jh(0,0,0),kf=jh(0,0,1);function vm(a,i){const l=nA();return Uv[2]=i,a.intersectsPlane(Uv,kf,l),new ut(l[0],l[1])}class xm extends gm{}function Pf(a,{width:i,height:l},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*l*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*l*u);return a.width=i,a.height=l,a.data=f,a}function bm(a,{width:i,height:l},u){if(i===a.width&&l===a.height)return;const f=Pf({},{width:i,height:l},u);zl(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,i),height:Math.min(a.height,l)},u),a.width=i,a.height=l,a.data=f.data}function zl(a,i,l,u,f,x){if(0===f.width||0===f.height)return i;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||u.x>i.width-f.width||u.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,M=i.data;for(let P=0;P<f.height;P++){const F=((l.y+P)*a.width+l.x)*x,N=((u.y+P)*i.width+u.x)*x;for(let V=0;V<f.width*x;V++)M[N+V]=b[F+V]}return i}Pt("HeatmapBucket",xm,{omit:["layers"]});class Lc{constructor(i,l){Pf(this,i,1,l)}resize(i){bm(this,i,1)}clone(){return new Lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,u,f,x){zl(i,l,u,f,x,1)}}class Ms{constructor(i,l){Pf(this,i,4,l)}resize(i){bm(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,u,f,x){zl(i,l,u,f,x,4)}}Pt("AlphaImage",Lc),Pt("RGBAImage",Ms);var jv={paint:new Ge({"heatmap-radius":new Fe(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fe(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new de(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pe(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new de(Ce.paint_heatmap["heatmap-opacity"])})};function wm(a){const i={},l=a.resolution||256,u=a.clips?a.clips.length:1,f=a.image||new Ms({width:l,height:u}),x=(b,M,P)=>{i[a.evaluationKey]=P;const F=a.expression.evaluate(i);f.data[b+M+0]=Math.floor(255*F.r/F.a),f.data[b+M+1]=Math.floor(255*F.g/F.a),f.data[b+M+2]=Math.floor(255*F.b/F.a),f.data[b+M+3]=Math.floor(255*F.a)};if(a.clips)for(let b=0,M=0;b<u;++b,M+=4*l)for(let P=0,F=0;P<l;P++,F+=4){const N=P/(l-1),{start:V,end:j}=a.clips[b];x(M,F,V*(1-N)+j*N)}else for(let b=0,M=0;b<l;b++,M+=4)x(0,M,b/(l-1));return f}var Gv={paint:new Ge({"hillshade-illumination-direction":new de(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new de(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new de(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new de(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new de(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new de(Ce.paint_hillshade["hillshade-accent-color"])})};const Ts=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:rl}=Ts;var Rf=Ff,$v=Ff;function Ff(a,i,l){l=l||2;var u,f,x,b,M,P,F,N=i&&i.length,V=N?i[0]*l:a.length,j=F0(a,0,V,l,!0),q=[];if(!j||j.next===j.prev)return q;if(N&&(j=function(oe,Ae,xe,Me){var Le,Be,Ne,Ue=[];for(Le=0,Be=Ae.length;Le<Be;Le++)(Ne=F0(oe,Ae[Le]*Me,Le<Be-1?Ae[Le+1]*Me:oe.length,Me,!1))===Ne.next&&(Ne.steiner=!0),Ue.push(L0(Ne));for(Ue.sort(Wv),Le=0;Le<Ue.length;Le++)o2(Ue[Le],xe),xe=Bc(xe,xe.next);return xe}(a,i,j,l)),a.length>80*l){u=x=a[0],f=b=a[1];for(var re=l;re<V;re+=l)(M=a[re])<u&&(u=M),(P=a[re+1])<f&&(f=P),M>x&&(x=M),P>b&&(b=P);F=0!==(F=Math.max(x-u,b-f))?1/F:0}return oA(j,q,l,u,f,F),q}function F0(a,i,l,u,f){var x,b;if(f===N0(a,i,l,u)>0)for(x=i;x<l;x+=u)b=Bf(x,a[x],a[x+1],b);else for(x=l-u;x>=i;x-=u)b=Bf(x,a[x],a[x+1],b);return b&&aA(b,b.next)&&(Xu(b),b=b.next),b}function Bc(a,i){if(!a)return a;i||(i=a);var l,u=a;do{if(l=!1,u.steiner||!aA(u,u.next)&&0!==Xr(u.prev,u,u.next))u=u.next;else{if(Xu(u),(u=i=u.prev)===u.next)break;l=!0}}while(l||u!==i);return i}function oA(a,i,l,u,f,x,b){if(a){!b&&x&&function(N,V,j,q){var re=N;do{null===re.z&&(re.z=Qu(re.x,re.y,V,j,q)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next}while(re!==N);re.prevZ.nextZ=null,re.prevZ=null,function(oe){var Ae,xe,Me,Le,Be,Ne,Ue,Ze,ot=1;do{for(xe=oe,oe=null,Be=null,Ne=0;xe;){for(Ne++,Me=xe,Ue=0,Ae=0;Ae<ot&&(Ue++,Me=Me.nextZ);Ae++);for(Ze=ot;Ue>0||Ze>0&&Me;)0!==Ue&&(0===Ze||!Me||xe.z<=Me.z)?(Le=xe,xe=xe.nextZ,Ue--):(Le=Me,Me=Me.nextZ,Ze--),Be?Be.nextZ=Le:oe=Le,Le.prevZ=Be,Be=Le;xe=Me}Be.nextZ=null,ot*=2}while(Ne>1)}(re)}(a,u,f,x);for(var M,P,F=a;a.prev!==a.next;)if(M=a.prev,P=a.next,x?Hv(a,u,f,x):O0(a))i.push(M.i/l),i.push(a.i/l),i.push(P.i/l),Xu(a),a=P.next,F=P.next;else if((a=P)===F){b?1===b?oA(a=qv(Bc(a),i,l),i,l,u,f,x,2):2===b&&Zv(a,i,l,u,f,x):oA(Bc(a),i,l,u,f,x,1);break}}}function O0(a){var i=a.prev,l=a,u=a.next;if(Xr(i,l,u)>=0)return!1;for(var f=a.next.next;f!==a.prev;){if(zo(i.x,i.y,l.x,l.y,u.x,u.y,f.x,f.y)&&Xr(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Hv(a,i,l,u){var f=a.prev,x=a,b=a.next;if(Xr(f,x,b)>=0)return!1;for(var M=f.x>x.x?f.x>b.x?f.x:b.x:x.x>b.x?x.x:b.x,P=f.y>x.y?f.y>b.y?f.y:b.y:x.y>b.y?x.y:b.y,F=Qu(f.x<x.x?f.x<b.x?f.x:b.x:x.x<b.x?x.x:b.x,f.y<x.y?f.y<b.y?f.y:b.y:x.y<b.y?x.y:b.y,i,l,u),N=Qu(M,P,i,l,u),V=a.prevZ,j=a.nextZ;V&&V.z>=F&&j&&j.z<=N;){if(V!==a.prev&&V!==a.next&&zo(f.x,f.y,x.x,x.y,b.x,b.y,V.x,V.y)&&Xr(V.prev,V,V.next)>=0||(V=V.prevZ,j!==a.prev&&j!==a.next&&zo(f.x,f.y,x.x,x.y,b.x,b.y,j.x,j.y)&&Xr(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;V&&V.z>=F;){if(V!==a.prev&&V!==a.next&&zo(f.x,f.y,x.x,x.y,b.x,b.y,V.x,V.y)&&Xr(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;j&&j.z<=N;){if(j!==a.prev&&j!==a.next&&zo(f.x,f.y,x.x,x.y,b.x,b.y,j.x,j.y)&&Xr(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function qv(a,i,l){var u=a;do{var f=u.prev,x=u.next.next;!aA(f,x)&&Cm(f,u,u.next,x)&&Of(f,x)&&Of(x,f)&&(i.push(f.i/l),i.push(u.i/l),i.push(x.i/l),Xu(u),Xu(u.next),u=a=x),u=u.next}while(u!==a);return Bc(u)}function Zv(a,i,l,u,f,x){var b=a;do{for(var M=b.next.next;M!==b.prev;){if(b.i!==M.i&&sA(b,M)){var P=Lf(b,M);return b=Bc(b,b.next),P=Bc(P,P.next),oA(b,i,l,u,f,x),void oA(P,i,l,u,f,x)}M=M.next}b=b.next}while(b!==a)}function Wv(a,i){return a.x-i.x}function o2(a,i){if(i=function(u,f){var x,b=f,M=u.x,P=u.y,F=-1/0;do{if(P<=b.y&&P>=b.next.y&&b.next.y!==b.y){var N=b.x+(P-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(N<=M&&N>F){if(F=N,N===M){if(P===b.y)return b;if(P===b.next.y)return b.next}x=b.x<b.next.x?b:b.next}}b=b.next}while(b!==f);if(!x)return null;if(M===F)return x;var V,j=x,q=x.x,re=x.y,oe=1/0;b=x;do{M>=b.x&&b.x>=q&&M!==b.x&&zo(P<re?M:F,P,q,re,P<re?F:M,P,b.x,b.y)&&(V=Math.abs(P-b.y)/(M-b.x),Of(b,u)&&(V<oe||V===oe&&(b.x>x.x||b.x===x.x&&Qv(x,b)))&&(x=b,oe=V)),b=b.next}while(b!==j);return x}(a,i)){var l=Lf(i,a);Bc(i,i.next),Bc(l,l.next)}}function Qv(a,i){return Xr(a.prev,a,i.prev)<0&&Xr(i.next,a,a.next)<0}function Qu(a,i,l,u,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*f)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-u)*f)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function L0(a){var i=a,l=a;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==a);return l}function zo(a,i,l,u,f,x,b,M){return(f-b)*(i-M)-(a-b)*(x-M)>=0&&(a-b)*(u-M)-(l-b)*(i-M)>=0&&(l-b)*(x-M)-(f-b)*(u-M)>=0}function sA(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(l,u){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==u.i&&f.next.i!==u.i&&Cm(f,f.next,l,u))return!0;f=f.next}while(f!==l);return!1}(a,i)&&(Of(a,i)&&Of(i,a)&&function(l,u){var f=l,x=!1,b=(l.x+u.x)/2,M=(l.y+u.y)/2;do{f.y>M!=f.next.y>M&&f.next.y!==f.y&&b<(f.next.x-f.x)*(M-f.y)/(f.next.y-f.y)+f.x&&(x=!x),f=f.next}while(f!==l);return x}(a,i)&&(Xr(a.prev,a,i.prev)||Xr(a,i.prev,i))||aA(a,i)&&Xr(a.prev,a,a.next)>0&&Xr(i.prev,i,i.next)>0)}function Xr(a,i,l){return(i.y-a.y)*(l.x-i.x)-(i.x-a.x)*(l.y-i.y)}function aA(a,i){return a.x===i.x&&a.y===i.y}function Cm(a,i,l,u){var f=Dm(Xr(a,i,l)),x=Dm(Xr(a,i,u)),b=Dm(Xr(l,u,a)),M=Dm(Xr(l,u,i));return f!==x&&b!==M||!(0!==f||!Em(a,l,i))||!(0!==x||!Em(a,u,i))||!(0!==b||!Em(l,a,u))||!(0!==M||!Em(l,i,u))}function Em(a,i,l){return i.x<=Math.max(a.x,l.x)&&i.x>=Math.min(a.x,l.x)&&i.y<=Math.max(a.y,l.y)&&i.y>=Math.min(a.y,l.y)}function Dm(a){return a>0?1:a<0?-1:0}function Of(a,i){return Xr(a.prev,a,a.next)<0?Xr(a,i,a.next)>=0&&Xr(a,a.prev,i)>=0:Xr(a,i,a.prev)<0||Xr(a,a.next,i)<0}function Lf(a,i){var l=new B0(a.i,a.x,a.y),u=new B0(i.i,i.x,i.y),f=a.next,x=i.prev;return a.next=i,i.prev=a,l.next=f,f.prev=l,u.next=l,l.prev=u,x.next=u,u.prev=x,u}function Bf(a,i,l,u){var f=new B0(a,i,l);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function Xu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function B0(a,i,l){this.i=a,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function N0(a,i,l,u){for(var f=0,x=i,b=l-u;x<l;x+=u)f+=(a[b]-a[x])*(a[x+1]+a[b+1]),b=x;return f}function z0(a,i,l,u,f){V0(a,i,l||0,u||a.length-1,f||Xv)}function V0(a,i,l,u,f){for(;u>l;){if(u-l>600){var x=u-l+1,b=i-l+1,M=Math.log(x),P=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*P*(x-P)/x)*(b-x/2<0?-1:1);V0(a,i,Math.max(l,Math.floor(i-b*P/x+F)),Math.min(u,Math.floor(i+(x-b)*P/x+F)),f)}var N=a[i],V=l,j=u;for(lA(a,l,i),f(a[u],N)>0&&lA(a,l,u);V<j;){for(lA(a,V,j),V++,j--;f(a[V],N)<0;)V++;for(;f(a[j],N)>0;)j--}0===f(a[l],N)?lA(a,l,j):lA(a,++j,u),j<=i&&(l=j+1),i<=j&&(u=j-1)}}function lA(a,i,l){var u=a[i];a[i]=a[l],a[l]=u}function Xv(a,i){return a<i?-1:a>i?1:0}function Sm(a,i){const l=a.length;if(l<=1)return[a];const u=[];let f,x;for(let b=0;b<l;b++){const M=ja(a[b]);0!==M&&(a[b].area=Math.abs(M),void 0===x&&(x=M<0),x===M<0?(f&&u.push(f),f=[a[b]]):f.push(a[b]))}if(f&&u.push(f),i>1)for(let b=0;b<u.length;b++)u[b].length<=i||(z0(u[b],i,1,u[b].length-1,U0),u[b]=u[b].slice(0,i));return u}function U0(a,i){return i.area-a.area}function Hh(a,i,l){const u=l.patternDependencies;let f=!1;for(const x of i){const b=x.paint.get(`${a}-pattern`);b.isConstant()||(f=!0);const M=b.constantOr(null);M&&(f=!0,u[M.to]=!0,u[M.from]=!0)}return f}function Nf(a,i,l,u,f){const x=f.patternDependencies;for(const b of i){const M=b.paint.get(`${a}-pattern`).value;if("constant"!==M.kind){let P=M.evaluate({zoom:u-1},l,{},f.availableImages),F=M.evaluate({zoom:u},l,{},f.availableImages),N=M.evaluate({zoom:u+1},l,{},f.availableImages);P=P&&P.name?P.name:P,F=F&&F.name?F.name:F,N=N&&N.name?N.name:N,x[P]=!0,x[F]=!0,x[N]=!0,l.patterns[b.id]={min:P,mid:F,max:N}}}return l}Ff.deviation=function(a,i,l,u){var f=i&&i.length,x=Math.abs(N0(a,0,f?i[0]*l:a.length,l));if(f)for(var b=0,M=i.length;b<M;b++)x-=Math.abs(N0(a,i[b]*l,b<M-1?i[b+1]*l:a.length,l));var P=0;for(b=0;b<u.length;b+=3){var F=u[b]*l,N=u[b+1]*l,V=u[b+2]*l;P+=Math.abs((a[F]-a[V])*(a[N+1]-a[F+1])-(a[F]-a[N])*(a[V+1]-a[F+1]))}return 0===x&&0===P?0:Math.abs((P-x)/x)},Ff.flatten=function(a){for(var i=a[0][0].length,l={vertices:[],holes:[],dimensions:i},u=0,f=0;f<a.length;f++){for(var x=0;x<a[f].length;x++)for(var b=0;b<i;b++)l.vertices.push(a[f][x][b]);f>0&&l.holes.push(u+=a[f-1].length)}return l},Rf.default=$v;class cA{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jt,this.indexArray=new Tn,this.indexArray2=new ai,this.programConfigurations=new ta(i.layers,i.zoom),this.segments=new Fi,this.segments2=new Fi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,u){this.hasPattern=Hh("fill",this.layers,l);const f=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:b,id:M,index:P,sourceLayerIndex:F}of i){const N=this.layers[0]._featureFilter.needGeometry,V=$u(b,N);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),V,u))continue;const j=f?f.evaluate(V,{},u,l.availableImages):void 0,q={id:M,properties:b.properties,type:b.type,sourceLayerIndex:F,index:P,geometry:N?V.geometry:na(b),patterns:{},sortKey:j};x.push(q)}f&&x.sort((b,M)=>b.sortKey-M.sortKey);for(const b of x){const{geometry:M,index:P,sourceLayerIndex:F}=b;if(this.hasPattern){const N=Nf("fill",this.layers,b,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(b,M,P,u,{});l.featureIndex.insert(i[P].feature,M,P,F,this.index)}}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}addFeatures(i,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rl),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,u,f,x){for(const b of Sm(l,500)){let M=0;for(const q of b)M+=q.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),F=P.vertexLength,N=[],V=[];for(const q of b){if(0===q.length)continue;q!==b[0]&&V.push(N.length/2);const re=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),oe=re.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(oe+q.length-1,oe),N.push(q[0].x),N.push(q[0].y);for(let Ae=1;Ae<q.length;Ae++)this.layoutVertexArray.emplaceBack(q[Ae].x,q[Ae].y),this.indexArray2.emplaceBack(oe+Ae-1,oe+Ae),N.push(q[Ae].x),N.push(q[Ae].y);re.vertexLength+=q.length,re.primitiveLength+=q.length}const j=Rf(N,V);for(let q=0;q<j.length;q+=3)this.indexArray.emplaceBack(F+j[q],F+j[q+1],F+j[q+2]);P.vertexLength+=M,P.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,f)}}Pt("FillBucket",cA,{omit:["layers","patternFeatures"]});const Yv=new Ge({"fill-sort-key":new Fe(Ce.layout_fill["fill-sort-key"])});var Nr={paint:new Ge({"fill-antialias":new de(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Fe(Ce.paint_fill["fill-opacity"]),"fill-color":new Fe(Ce.paint_fill["fill-color"]),"fill-outline-color":new Fe(Ce.paint_fill["fill-outline-color"]),"fill-translate":new de(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new de(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new We(Ce.paint_fill["fill-pattern"])}),layout:Yv};const Kv=Mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Jv=Mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Mm}=Kv;var Tm=qh;function qh(a,i,l,u,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=f,a.readFields(e1,this,i)}function e1(a,i,l){1==a?i.id=l.readVarint():2==a?function(u,f){for(var x=u.readVarint()+u.pos;u.pos<x;){var b=f._keys[u.readVarint()],M=f._values[u.readVarint()];f.properties[b]=M}}(l,i):3==a?i.type=l.readVarint():4==a&&(i._geometry=l.pos)}function t1(a){for(var i,l,u=0,f=0,x=a.length,b=x-1;f<x;b=f++)u+=((l=a[b]).x-(i=a[f]).x)*(i.y+l.y);return u}qh.types=["Unknown","Point","LineString","Polygon"],qh.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var i,l=a.readVarint()+a.pos,u=1,f=0,x=0,b=0,M=[];a.pos<l;){if(f<=0){var P=a.readVarint();u=7&P,f=P>>3}if(f--,1===u||2===u)x+=a.readSVarint(),b+=a.readSVarint(),1===u&&(i&&M.push(i),i=[]),i.push(new ut(x,b));else{if(7!==u)throw new Error("unknown command "+u);i&&i.push(i[0].clone())}}return i&&M.push(i),M},qh.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var i=a.readVarint()+a.pos,l=1,u=0,f=0,x=0,b=1/0,M=-1/0,P=1/0,F=-1/0;a.pos<i;){if(u<=0){var N=a.readVarint();l=7&N,u=N>>3}if(u--,1===l||2===l)(f+=a.readSVarint())<b&&(b=f),f>M&&(M=f),(x+=a.readSVarint())<P&&(P=x),x>F&&(F=x);else if(7!==l)throw new Error("unknown command "+l)}return[b,P,M,F]},qh.prototype.toGeoJSON=function(a,i,l){var u,f,x=this.extent*Math.pow(2,l),b=this.extent*a,M=this.extent*i,P=this.loadGeometry(),F=qh.types[this.type];function N(q){for(var re=0;re<q.length;re++){var oe=q[re];q[re]=[360*(oe.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(u=0;u<P.length;u++)V[u]=P[u][0];N(P=V);break;case 2:for(u=0;u<P.length;u++)N(P[u]);break;case 3:for(P=function(q){var re=q.length;if(re<=1)return[q];for(var oe,Ae,xe=[],Me=0;Me<re;Me++){var Le=t1(q[Me]);0!==Le&&(void 0===Ae&&(Ae=Le<0),Ae===Le<0?(oe&&xe.push(oe),oe=[q[Me]]):oe.push(q[Me]))}return oe&&xe.push(oe),xe}(P),u=0;u<P.length;u++)for(f=0;f<P[u].length;f++)N(P[u][f])}1===P.length?P=P[0]:F="Multi"+F;var j={type:"Feature",geometry:{type:F,coordinates:P},properties:this.properties};return"id"in this&&(j.id=this.id),j};var j0=G0;function G0(a,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(s2,this,i),this.length=this._features.length}function s2(a,i,l){15===a?i.version=l.readVarint():1===a?i.name=l.readString():5===a?i.extent=l.readVarint():2===a?i._features.push(l.pos):3===a?i._keys.push(l.readString()):4===a&&i._values.push(function(u){for(var f=null,x=u.readVarint()+u.pos;u.pos<x;){var b=u.readVarint()>>3;f=1===b?u.readString():2===b?u.readFloat():3===b?u.readDouble():4===b?u.readVarint64():5===b?u.readVarint():6===b?u.readSVarint():7===b?u.readBoolean():null}return f}(l))}function a2(a,i,l){if(3===a){var u=new j0(l,l.readVarint()+l.pos);u.length&&(i[u.name]=u)}}G0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var i=this._pbf.readVarint()+this._pbf.pos;return new Tm(this._pbf,i,this.extent,this._keys,this._values)};var ka={VectorTile:function(a,i){this.layers=a.readFields(a2,{},i)},VectorTileFeature:Tm,VectorTileLayer:j0};const Vo=ka.VectorTileFeature.types,Im=Math.pow(2,13);function Zh(a,i,l,u,f,x,b,M){a.emplaceBack((i<<1)+b,(l<<1)+x,(Math.floor(u*Im)<<1)+f,Math.round(M))}class km{constructor(){this.acc=new ut(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ut(i.x,i.y),this.max=new ut(i.x,i.y))}append(i,l){this.currentPolyCount.edges++,this.acc._add(i);let u=!!this.borders;const f=this.min,x=this.max;i.x<f.x?(f.x=i.x,u=!0):i.x>x.x&&(x.x=i.x,u=!0),i.y<f.y?(f.y=i.y,u=!0):i.y>x.y&&(x.y=i.y,u=!0),((0===i.x||i.x===cr)&&i.x===l.x)!=((0===i.y||i.y===cr)&&i.y===l.y)&&this.processBorderOverlap(i,l),u&&this.checkBorderIntersection(i,l)}checkBorderIntersection(i,l){l.x<0!=i.x<0&&this.addBorderIntersection(0,ht(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>cr!=i.x>cr&&this.addBorderIntersection(1,ht(l.y,i.y,(cr-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,ht(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>cr!=i.y>cr&&this.addBorderIntersection(3,ht(l.x,i.x,(cr-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const u=0===i.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,i.y)}else{const u=0===i.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,i.x)}}centroid(){const i=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==i?this.acc.div(i)._round():new ut(0,0)}span(){return new ut(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0)}}class oo{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Ur,this.centroidVertexArray=new Iv,this.indexArray=new Tn,this.programConfigurations=new ta(i.layers,i.zoom),this.segments=new Fi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=i.enableTerrain}populate(i,l,u){this.features=[],this.hasPattern=Hh("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const x=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*x/(x*x+1)/cr/(1<<f.z)}(u);for(const{feature:f,id:x,index:b,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=$u(f,P);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),F,u))continue;const N={id:x,sourceLayerIndex:M,index:b,geometry:P?F.geometry:na(f),properties:f.properties,type:f.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(Nf("fill-extrusion",this.layers,N,this.zoom,l)):this.addFeature(N,N.geometry,b,u,{}),l.featureIndex.insert(f,N.geometry,b,M,this.index,V)}this.sortBorders()}addFeatures(i,l,u){for(const f of this.features){const{geometry:x}=f;this.addFeature(f,x,f.index,l,u)}this.sortBorders()}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Mm),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Jv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,u,f,x){const b=this.enableTerrain?new km:null;for(const P of Sm(l,500)){let F=0,N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===P.length||(M=P[0]).every(oe=>oe.x<=0)||M.every(oe=>oe.x>=cr)||M.every(oe=>oe.y<=0)||M.every(oe=>oe.y>=cr))continue;for(let oe=0;oe<P.length;oe++){const Ae=P[oe];if(0===Ae.length)continue;F+=Ae.length;let xe=0;b&&b.startRing(Ae[0]);for(let Me=0;Me<Ae.length;Me++){const Le=Ae[Me];if(Me>=1){const Be=Ae[Me-1];if(!uA(Le,Be)){b&&b.append(Le,Be),N.vertexLength+4>Fi.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ne=Le.sub(Be)._perp(),Ue=Ne.x/(Math.abs(Ne.x)+Math.abs(Ne.y)),Ze=Ne.y>0?1:0,ot=Be.dist(Le);xe+ot>32768&&(xe=0),Zh(this.layoutVertexArray,Le.x,Le.y,Ue,Ze,0,0,xe),Zh(this.layoutVertexArray,Le.x,Le.y,Ue,Ze,0,1,xe),xe+=ot,Zh(this.layoutVertexArray,Be.x,Be.y,Ue,Ze,0,0,xe),Zh(this.layoutVertexArray,Be.x,Be.y,Ue,Ze,0,1,xe);const At=N.vertexLength;this.indexArray.emplaceBack(At,At+2,At+1),this.indexArray.emplaceBack(At+1,At+2,At+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+F>Fi.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),"Polygon"!==Vo[i.type])continue;const V=[],j=[],q=N.vertexLength;for(let oe=0;oe<P.length;oe++){const Ae=P[oe];if(0!==Ae.length){Ae!==P[0]&&j.push(V.length/2);for(let xe=0;xe<Ae.length;xe++){const Me=Ae[xe];Zh(this.layoutVertexArray,Me.x,Me.y,0,0,1,1,0),V.push(Me.x),V.push(Me.y),b&&b.currentPolyCount.top++}}}const re=Rf(V,j);for(let oe=0;oe<re.length;oe+=3)this.indexArray.emplaceBack(q+re[oe],q+re[oe+2],q+re[oe+1]);N.primitiveLength+=re.length/3,N.vertexLength+=F}var M;if(b&&b.polyCount.length>0){if(b.borders){b.vertexArrayOffset=this.centroidVertexArray.length;const P=b.borders,F=this.featuresOnBorder.push(b)-1;for(let N=0;N<4;N++)P[N][0]!==Number.MAX_VALUE&&this.borders[N].push(F)}this.encodeCentroid(b.borders?void 0:b.centroid(),b)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,f)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((l,u)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}encodeCentroid(i,l,u=!0){let f,x;if(i)if(0!==i.y){const M=l.span()._mult(this.tileToMeter);f=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(M.x/10)),x=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else f=Math.ceil(7*(i.x+450)),x=0;else f=0,x=+u;let b=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const M of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let P=0;P<2*M.edges;P++)this.centroidVertexArray.emplace(b++,0,x),this.centroidVertexArray.emplace(b++,f,x);for(let P=0;P<M.top;P++)this.centroidVertexArray.emplace(b++,f,x)}}}function uA(a,i){return a.x===i.x&&(a.x<0||a.x>cr)||a.y===i.y&&(a.y<0||a.y>cr)}Pt("FillExtrusionBucket",oo,{omit:["layers","features"]}),Pt("PartMetadata",km);var Pm={paint:new Ge({"fill-extrusion-opacity":new de(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fe(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new de(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new de(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new We(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fe(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fe(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new de(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function hA(a,i){return a.x*i.x+a.y*i.y}function $0(a,i){if(1===a.length){let l=0;const u=i[l++];let f;for(;!f||u.equals(f);)if(f=i[l++],!f)return 1/0;for(;l<i.length;l++){const x=i[l],b=a[0],M=f.sub(u),P=x.sub(u),F=b.sub(u),N=hA(M,M),V=hA(M,P),j=hA(P,P),q=hA(F,M),re=hA(F,P),oe=N*j-V*V,Ae=(j*q-V*re)/oe,xe=(N*re-V*q)/oe,Me=u.z*(1-Ae-xe)+f.z*Ae+x.z*xe;if(isFinite(Me))return Me}return 1/0}{let l=1/0;for(const u of i)l=Math.min(l,u.z);return l}}function Rm(a){const i=new ut(a[0],a[1]);return i.z=a[2],i}function n1(a,i,l,u,f,x,b,M){const P=b*f.getElevationAt(a,i,!0,!0),F=0!==x[0],N=F?0===x[1]?b*(x[0]/7-450):b*function(V,j,q){const re=Math.floor(j[0]/8),oe=Math.floor(j[1]/8),Ae=10*(j[0]-8*re),xe=10*(j[1]-8*oe),Me=V.getElevationAt(re,oe,!0,!0),Le=V.getMeterToDEM(q),Be=Math.floor(.5*(Ae*Le-1)),Ne=Math.floor(.5*(xe*Le-1)),Ue=V.tileCoordToPixel(re,oe),Ze=2*Be+1,ot=2*Ne+1,At=(Kt=Ze,Dn=ot,[(Yt=V).getElevationAtPixel(St=Ue.x-Be,er=Ue.y-Ne,!0),Yt.getElevationAtPixel(St+Dn,er,!0),Yt.getElevationAtPixel(St,er+Dn,!0),Yt.getElevationAtPixel(St+Kt,er+Dn,!0)]),pt=Math.abs(At[0]-At[1]),et=Math.abs(At[2]-At[3]),it=Math.abs(At[0]-At[2])+Math.abs(At[1]-At[3]),yt=Math.min(.25,.5*Le*(pt+et)/Ze),rt=Math.min(.25,.5*Le*it/ot);var Yt,St,er,Kt,Dn;return Me+Math.max(yt*Ae,rt*xe)}(f,x,M):P;return{base:P+(0===l)?-1:l,top:F?Math.max(N+u,P+l+2):P+u}}const H0=Mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:r1}=H0,q0=Mt([{name:"a_packed",components:3,type:"Float32"}]),{members:i1}=q0,o1=ka.VectorTileFeature.types,s1=Math.cos(Math.PI/180*37.5);class zf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new wr,this.layoutVertexArray2=new cn,this.indexArray=new Tn,this.programConfigurations=new ta(i.layers,i.zoom),this.segments=new Fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,u){this.hasPattern=Hh("line",this.layers,l);const f=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:F,id:N,index:V,sourceLayerIndex:j}of i){const q=this.layers[0]._featureFilter.needGeometry,re=$u(F,q);if(!this.layers[0]._featureFilter.filter(new te(this.zoom),re,u))continue;const oe=f?f.evaluate(re,{},u):void 0,Ae={id:N,properties:F.properties,type:F.type,sourceLayerIndex:j,index:V,geometry:q?re.geometry:na(F),patterns:{},sortKey:oe};x.push(Ae)}f&&x.sort((F,N)=>F.sortKey-N.sortKey);const{lineAtlas:b,featureIndex:M}=l,P=this.addConstantDashes(b);for(const F of x){const{geometry:N,index:V,sourceLayerIndex:j}=F;if(P&&this.addFeatureDashes(F,b),this.hasPattern){const q=Nf("line",this.layers,F,this.zoom,l);this.patternFeatures.push(q)}else this.addFeature(F,N,V,u,b.positions);M.insert(i[V].feature,N,V,j,this.index)}}addConstantDashes(i){let l=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,x=u.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==x.kind)l=!0;else{const b=x.value,M=f.value;if(!M)continue;i.addDash(M.from,b),i.addDash(M.to,b),M.other&&i.addDash(M.other,b)}}return l}addFeatureDashes(i,l){const u=this.zoom;for(const f of this.layers){const x=f.paint.get("line-dasharray").value,b=f.layout.get("line-cap").value;if("constant"===x.kind&&"constant"===b.kind)continue;let M,P,F,N,V,j;if("constant"===x.kind){const Ae=x.value;if(!Ae)continue;M=Ae.other||Ae.to,P=Ae.to,F=Ae.from}else M=x.evaluate({zoom:u-1},i),P=x.evaluate({zoom:u},i),F=x.evaluate({zoom:u+1},i);"constant"===b.kind?N=V=j=b.value:(N=b.evaluate({zoom:u-1},i),V=b.evaluate({zoom:u},i),j=b.evaluate({zoom:u+1},i)),l.addDash(M,N),l.addDash(P,V),l.addDash(F,j);const q=l.getKey(M,N),re=l.getKey(P,V),oe=l.getKey(F,j);i.patterns[f.id]={min:q,mid:re,max:oe}}}update(i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,u)}addFeatures(i,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,i1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,r1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,u,f,x){const b=this.layers[0].layout,M=b.get("line-join").evaluate(i,{}),P=b.get("line-cap").evaluate(i,{}),F=b.get("line-miter-limit"),N=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const V of l)this.addLine(V,i,M,P,F,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,x,f)}addLine(i,l,u,f,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M="Polygon"===o1[l.type];let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let F=0;for(;F<P-1&&i[F].equals(i[F+1]);)F++;if(P<(M?3:2))return;"bevel"===u&&(x=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let j,q,re,oe,Ae;this.e1=this.e2=-1,M&&(j=i[P-2],Ae=i[F].sub(j)._unit()._perp());for(let xe=F;xe<P;xe++){if(re=xe===P-1?M?i[F+1]:void 0:i[xe+1],re&&i[xe].equals(re))continue;Ae&&(oe=Ae),j&&(q=j),j=i[xe],Ae=re?re.sub(j)._unit()._perp():oe,oe=oe||Ae;let Me=oe.add(Ae);0===Me.x&&0===Me.y||Me._unit();const Le=oe.x*Ae.x+oe.y*Ae.y,Be=Me.x*Ae.x+Me.y*Ae.y,Ne=0!==Be?1/Be:1/0,Ue=2*Math.sqrt(2-2*Be),Ze=Be<s1&&q&&re,ot=oe.x*Ae.y-oe.y*Ae.x>0;if(Ze&&xe>F){const et=j.dist(q);if(et>2*N){const it=j.sub(j.sub(q)._mult(N/et)._round());this.updateDistance(q,it),this.addCurrentVertex(it,oe,0,0,V),q=it}}const At=q&&re;let pt=At?u:M?"butt":f;if(At&&"round"===pt&&(Ne<b?pt="miter":Ne<=2&&(pt="fakeround")),"miter"===pt&&Ne>x&&(pt="bevel"),"bevel"===pt&&(Ne>2&&(pt="flipbevel"),Ne<x&&(pt="miter")),q&&this.updateDistance(q,j),"miter"===pt)Me._mult(Ne),this.addCurrentVertex(j,Me,0,0,V);else if("flipbevel"===pt){if(Ne>100)Me=Ae.mult(-1);else{const et=Ne*oe.add(Ae).mag()/oe.sub(Ae).mag();Me._perp()._mult(et*(ot?-1:1))}this.addCurrentVertex(j,Me,0,0,V),this.addCurrentVertex(j,Me.mult(-1),0,0,V)}else if("bevel"===pt||"fakeround"===pt){const et=-Math.sqrt(Ne*Ne-1),it=ot?et:0,yt=ot?0:et;if(q&&this.addCurrentVertex(j,oe,it,yt,V),"fakeround"===pt){const rt=Math.round(180*Ue/Math.PI/20);for(let Yt=1;Yt<rt;Yt++){let St=Yt/rt;if(.5!==St){const Kt=St-.5;St+=St*Kt*(St-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*Kt*Kt+(.848013+Le*(.215638*Le-1.06021)))}const er=Ae.sub(oe)._mult(St)._add(oe)._unit()._mult(ot?-1:1);this.addHalfVertex(j,er.x,er.y,!1,ot,0,V)}}re&&this.addCurrentVertex(j,Ae,-it,-yt,V)}else if("butt"===pt)this.addCurrentVertex(j,Me,0,0,V);else if("square"===pt){const et=q?1:-1;q||this.addCurrentVertex(j,Me,et,et,V),this.addCurrentVertex(j,Me,0,0,V),q&&this.addCurrentVertex(j,Me,et,et,V)}else"round"===pt&&(q&&(this.addCurrentVertex(j,oe,0,0,V),this.addCurrentVertex(j,oe,1,1,V,!0)),re&&(this.addCurrentVertex(j,Ae,-1,-1,V,!0),this.addCurrentVertex(j,Ae,0,0,V)));if(Ze&&xe<P-1){const et=j.dist(re);if(et>2*N){const it=j.add(re.sub(j)._mult(N/et)._round());this.updateDistance(j,it),this.addCurrentVertex(it,Ae,0,0,V),j=it}}}}addCurrentVertex(i,l,u,f,x,b=!1){const M=l.y*f-l.x,P=-l.y-l.x*f;this.addHalfVertex(i,l.x+l.y*u,l.y-l.x*u,b,!1,u,x),this.addHalfVertex(i,M,P,b,!0,-f,x)}addHalfVertex({x:i,y:l},u,f,x,b,M,P){this.layoutVertexArray.emplaceBack((i<<1)+(x?1:0),(l<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(0===M?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const F=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),P.primitiveLength++),b?this.e2=F:this.e1=F}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}Pt("LineBucket",zf,{omit:["layers","patternFeatures"]});const Fm=new Ge({"line-cap":new Fe(Ce.layout_line["line-cap"]),"line-join":new Fe(Ce.layout_line["line-join"]),"line-miter-limit":new de(Ce.layout_line["line-miter-limit"]),"line-round-limit":new de(Ce.layout_line["line-round-limit"]),"line-sort-key":new Fe(Ce.layout_line["line-sort-key"])});var Om={paint:new Ge({"line-opacity":new Fe(Ce.paint_line["line-opacity"]),"line-color":new Fe(Ce.paint_line["line-color"]),"line-translate":new de(Ce.paint_line["line-translate"]),"line-translate-anchor":new de(Ce.paint_line["line-translate-anchor"]),"line-width":new Fe(Ce.paint_line["line-width"]),"line-gap-width":new Fe(Ce.paint_line["line-gap-width"]),"line-offset":new Fe(Ce.paint_line["line-offset"]),"line-blur":new Fe(Ce.paint_line["line-blur"]),"line-dasharray":new We(Ce.paint_line["line-dasharray"]),"line-pattern":new We(Ce.paint_line["line-pattern"]),"line-gradient":new Pe(Ce.paint_line["line-gradient"])}),layout:Fm};const Z0=new class extends Fe{possiblyEvaluate(a,i){return i=new te(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(a,i)}evaluate(a,i,l,u){return i=hi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(a,i,l,u)}}(Om.paint.properties["line-width"].specification);function a1(a,i){return i>0?i+2*a:a}Z0.useIntegerZoom=!0;const W0=Mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Vf=Mt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const l1=Mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),c1=Mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Nc=Mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),u1=Mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mt([{name:"triangle",components:3,type:"Uint16"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mt([{type:"Float32",name:"offsetX"}]),Mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const il=128;function Lm(a,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new te(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:f}=l;let x=0;for(;x<u.length&&u[x]<=a;)x++;x=Math.max(0,x-1);let b=x;for(;b<u.length&&u[b]<a+1;)b++;b=Math.min(u.length-1,b);const M=u[x],P=u[b];return"composite"===l.kind?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:f}:{kind:"camera",minZoom:M,maxZoom:P,minSize:l.evaluate(new te(M)),maxSize:l.evaluate(new te(P)),interpolationType:f}}}function Uf(a,{uSize:i,uSizeT:l},{lowerSize:u,upperSize:f}){return"source"===a.kind?u/il:"composite"===a.kind?ht(u/il,f/il,l):i}function Vl(a,i){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:x,maxZoom:b}=a,M=f?ui(Rn.interpolationFactor(f,i,x,b),0,1):0;"camera"===a.kind?u=ht(a.minSize,a.maxSize,M):l=M}return{uSizeT:l,uSize:u}}var ia=Object.freeze({__proto__:null,getSizeData:Lm,evaluateSizeForFeature:Uf,evaluateSizeForZoom:Vl,SIZE_PACK_FACTOR:il});function Q0(a,i,l){return a.sections.forEach(u=>{u.text=function(f,x,b){const M=x.layout.get("text-transform").evaluate(b,{});return"uppercase"===M?f=f.toLocaleUpperCase():"lowercase"===M&&(f=f.toLocaleLowerCase()),J.applyArabicShaping&&(f=J.applyArabicShaping(f)),f}(u.text,i,l)}),a}const dA={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function h1(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function X0(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var d1=function(a,i,l,u,f){var x,b,M=8*f-u-1,P=(1<<M)-1,F=P>>1,N=-7,V=l?f-1:0,j=l?-1:1,q=a[i+V];for(V+=j,x=q&(1<<-N)-1,q>>=-N,N+=M;N>0;x=256*x+a[i+V],V+=j,N-=8);for(b=x&(1<<-N)-1,x>>=-N,N+=u;N>0;b=256*b+a[i+V],V+=j,N-=8);if(0===x)x=1-F;else{if(x===P)return b?NaN:1/0*(q?-1:1);b+=Math.pow(2,u),x-=F}return(q?-1:1)*b*Math.pow(2,x-u)},Bm=function(a,i,l,u,f,x){var b,M,P,F=8*x-f-1,N=(1<<F)-1,V=N>>1,j=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,q=u?0:x-1,re=u?1:-1,oe=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,b=N):(b=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-b))<1&&(b--,P*=2),(i+=b+V>=1?j/P:j*Math.pow(2,1-V))*P>=2&&(b++,P/=2),b+V>=N?(M=0,b=N):b+V>=1?(M=(i*P-1)*Math.pow(2,f),b+=V):(M=i*Math.pow(2,V-1)*Math.pow(2,f),b=0));f>=8;a[l+q]=255&M,q+=re,M/=256,f-=8);for(b=b<<f|M,F+=f;F>0;a[l+q]=255&b,q+=re,b/=256,F-=8);a[l+q-re]|=128*oe},AA=_r;function _r(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}_r.Varint=0,_r.Fixed64=1,_r.Bytes=2,_r.Fixed32=5;var Nm=4294967296,Yu=1/Nm,Pa="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function zc(a){return a.type===_r.Bytes?a.readVarint()+a.pos:a.pos+1}function zm(a,i,l){var u=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(u);for(var f=l.pos-1;f>=a;f--)l.buf[f+u]=l.buf[f]}function l2(a,i){for(var l=0;l<a.length;l++)i.writeVarint(a[l])}function Is(a,i){for(var l=0;l<a.length;l++)i.writeSVarint(a[l])}function Vm(a,i){for(var l=0;l<a.length;l++)i.writeFloat(a[l])}function Um(a,i){for(var l=0;l<a.length;l++)i.writeDouble(a[l])}function A1(a,i){for(var l=0;l<a.length;l++)i.writeBoolean(a[l])}function Y0(a,i){for(var l=0;l<a.length;l++)i.writeFixed32(a[l])}function pA(a,i){for(var l=0;l<a.length;l++)i.writeSFixed32(a[l])}function K0(a,i){for(var l=0;l<a.length;l++)i.writeFixed64(a[l])}function J0(a,i){for(var l=0;l<a.length;l++)i.writeSFixed64(a[l])}function Wh(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+16777216*a[i+3]}function Vc(a,i,l){a[l]=i,a[l+1]=i>>>8,a[l+2]=i>>>16,a[l+3]=i>>>24}function jm(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+(a[i+3]<<24)}function c2(a,i,l){i.glyphs=[],1===a&&l.readMessage(Qh,i)}function Qh(a,i,l){if(3===a){const{id:u,bitmap:f,width:x,height:b,left:M,top:P,advance:F}=l.readMessage(Gm,{});i.glyphs.push({id:u,bitmap:new Lc({width:x+6,height:b+6},f),metrics:{width:x,height:b,left:M,top:P,advance:F}})}else 4===a?i.ascender=l.readSVarint():5===a&&(i.descender=l.readSVarint())}function Gm(a,i,l){1===a?i.id=l.readVarint():2===a?i.bitmap=l.readBytes():3===a?i.width=l.readVarint():4===a?i.height=l.readVarint():5===a?i.left=l.readSVarint():6===a?i.top=l.readSVarint():7===a&&(i.advance=l.readVarint())}function jf(a){let i=0,l=0;for(const b of a)i+=b.w*b.h,l=Math.max(l,b.w);a.sort((b,M)=>M.h-b.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let f=0,x=0;for(const b of a)for(let M=u.length-1;M>=0;M--){const P=u[M];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,x=Math.max(x,b.y+b.h),f=Math.max(f,b.x+b.w),b.w===P.w&&b.h===P.h){const F=u.pop();M<u.length&&(u[M]=F)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(u.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:f,h:x,fill:i/(f*x)||0}}_r.prototype={destroy:function(){this.buf=null},readFields:function(a,i,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),f=u>>3,x=this.pos;this.type=7&u,a(f,i,this),this.pos===x&&this.skip(u)}return i},readMessage:function(a,i){return this.readFields(a,i,this.readVarint()+this.pos)},readFixed32:function(){var a=Wh(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=jm(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Wh(this.buf,this.pos)+Wh(this.buf,this.pos+4)*Nm;return this.pos+=8,a},readSFixed64:function(){var a=Wh(this.buf,this.pos)+jm(this.buf,this.pos+4)*Nm;return this.pos+=8,a},readFloat:function(){var a=d1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=d1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var i,l,u=this.buf;return i=127&(l=u[this.pos++]),l<128?i:(i|=(127&(l=u[this.pos++]))<<7,l<128?i:(i|=(127&(l=u[this.pos++]))<<14,l<128?i:(i|=(127&(l=u[this.pos++]))<<21,l<128?i:function(f,x,b){var M,P,F=b.buf;if(M=(112&(P=F[b.pos++]))>>4,P<128||(M|=(127&(P=F[b.pos++]))<<3,P<128)||(M|=(127&(P=F[b.pos++]))<<10,P<128)||(M|=(127&(P=F[b.pos++]))<<17,P<128)||(M|=(127&(P=F[b.pos++]))<<24,P<128)||(M|=(1&(P=F[b.pos++]))<<31,P<128))return function(a,i,l){return l?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}(f,M,x);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&Pa?Pa.decode(this.buf.subarray(i,a)):function(l,u,f){for(var x="",b=u;b<f;){var M,P,F,N=l[b],V=null,j=N>239?4:N>223?3:N>191?2:1;if(b+j>f)break;1===j?N<128&&(V=N):2===j?128==(192&(M=l[b+1]))&&(V=(31&N)<<6|63&M)<=127&&(V=null):3===j?(P=l[b+2],128==(192&(M=l[b+1]))&&128==(192&P)&&((V=(15&N)<<12|(63&M)<<6|63&P)<=2047||V>=55296&&V<=57343)&&(V=null)):4===j&&(P=l[b+2],F=l[b+3],128==(192&(M=l[b+1]))&&128==(192&P)&&128==(192&F)&&((V=(15&N)<<18|(63&M)<<12|(63&P)<<6|63&F)<=65535||V>=1114112)&&(V=null)),null===V?(V=65533,j=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),b+=j}return x}(this.buf,i,a)},readBytes:function(){var a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i},readPackedVarint:function(a,i){if(this.type!==_r.Bytes)return a.push(this.readVarint(i));var l=zc(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(i));return a},readPackedSVarint:function(a){if(this.type!==_r.Bytes)return a.push(this.readSVarint());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==_r.Bytes)return a.push(this.readBoolean());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==_r.Bytes)return a.push(this.readFloat());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==_r.Bytes)return a.push(this.readDouble());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==_r.Bytes)return a.push(this.readFixed32());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==_r.Bytes)return a.push(this.readSFixed32());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==_r.Bytes)return a.push(this.readFixed64());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==_r.Bytes)return a.push(this.readSFixed64());var i=zc(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed64());return a},skip:function(a){var i=7&a;if(i===_r.Varint)for(;this.buf[this.pos++]>127;);else if(i===_r.Bytes)this.pos=this.readVarint()+this.pos;else if(i===_r.Fixed32)this.pos+=4;else{if(i!==_r.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(a,i){this.writeVarint(a<<3|i)},realloc:function(a){for(var i=this.length||16;i<this.pos+a;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Vc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Vc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Vc(this.buf,-1&a,this.pos),Vc(this.buf,Math.floor(a*Yu),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Vc(this.buf,-1&a,this.pos),Vc(this.buf,Math.floor(a*Yu),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(i,l){var u,f,x,M;if(i>=0?(u=i%4294967296|0,f=i/4294967296|0):(f=~(-i/4294967296),4294967295^(u=~(-i%4294967296))?u=u+1|0:(u=0,f=f+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),x=u,(M=l).buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7),function(x,b){var M=(7&x)<<4;b.buf[b.pos++]|=M|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var i=this.pos;this.pos=function(u,f,x){for(var b,M,P=0;P<f.length;P++){if((b=f.charCodeAt(P))>55295&&b<57344){if(!M){b>56319||P+1===f.length?(u[x++]=239,u[x++]=191,u[x++]=189):M=b;continue}if(b<56320){u[x++]=239,u[x++]=191,u[x++]=189,M=b;continue}b=M-55296<<10|b-56320|65536,M=null}else M&&(u[x++]=239,u[x++]=191,u[x++]=189,M=null);b<128?u[x++]=b:(b<2048?u[x++]=b>>6|192:(b<65536?u[x++]=b>>12|224:(u[x++]=b>>18|240,u[x++]=b>>12&63|128),u[x++]=b>>6&63|128),u[x++]=63&b|128)}return x}(this.buf,a,this.pos);var l=this.pos-i;l>=128&&zm(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Bm(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Bm(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var i=a.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,i){this.pos++;var l=this.pos;a(i,this);var u=this.pos-l;u>=128&&zm(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,i,l){this.writeTag(a,_r.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(a,i){i.length&&this.writeMessage(a,l2,i)},writePackedSVarint:function(a,i){i.length&&this.writeMessage(a,Is,i)},writePackedBoolean:function(a,i){i.length&&this.writeMessage(a,A1,i)},writePackedFloat:function(a,i){i.length&&this.writeMessage(a,Vm,i)},writePackedDouble:function(a,i){i.length&&this.writeMessage(a,Um,i)},writePackedFixed32:function(a,i){i.length&&this.writeMessage(a,Y0,i)},writePackedSFixed32:function(a,i){i.length&&this.writeMessage(a,pA,i)},writePackedFixed64:function(a,i){i.length&&this.writeMessage(a,K0,i)},writePackedSFixed64:function(a,i){i.length&&this.writeMessage(a,J0,i)},writeBytesField:function(a,i){this.writeTag(a,_r.Bytes),this.writeBytes(i)},writeFixed32Field:function(a,i){this.writeTag(a,_r.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(a,i){this.writeTag(a,_r.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(a,i){this.writeTag(a,_r.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(a,i){this.writeTag(a,_r.Fixed64),this.writeSFixed64(i)},writeVarintField:function(a,i){this.writeTag(a,_r.Varint),this.writeVarint(i)},writeSVarintField:function(a,i){this.writeTag(a,_r.Varint),this.writeSVarint(i)},writeStringField:function(a,i){this.writeTag(a,_r.Bytes),this.writeString(i)},writeFloatField:function(a,i){this.writeTag(a,_r.Fixed32),this.writeFloat(i)},writeDoubleField:function(a,i){this.writeTag(a,_r.Fixed64),this.writeDouble(i)},writeBooleanField:function(a,i){this.writeVarintField(a,Boolean(i))}};class $m{constructor(i,{pixelRatio:l,version:u,stretchX:f,stretchY:x,content:b}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=f,this.stretchY=x,this.content=b,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gf{constructor(i,l){const u={},f={};this.haveRenderCallbacks=[];const x=[];this.addImages(i,u,x),this.addImages(l,f,x);const{w:b,h:M}=jf(x),P=new Ms({width:b||1,height:M||1});for(const F in i){const N=i[F],V=u[F].paddedRect;Ms.copy(N.data,P,{x:0,y:0},{x:V.x+1,y:V.y+1},N.data)}for(const F in l){const N=l[F],V=f[F].paddedRect,j=V.x+1,q=V.y+1,re=N.data.width,oe=N.data.height;Ms.copy(N.data,P,{x:0,y:0},{x:j,y:q},N.data),Ms.copy(N.data,P,{x:0,y:oe-1},{x:j,y:q-1},{width:re,height:1}),Ms.copy(N.data,P,{x:0,y:0},{x:j,y:q+oe},{width:re,height:1}),Ms.copy(N.data,P,{x:re-1,y:0},{x:j-1,y:q},{width:1,height:oe}),Ms.copy(N.data,P,{x:0,y:0},{x:j+re,y:q},{width:1,height:oe})}this.image=P,this.iconPositions=u,this.patternPositions=f}addImages(i,l,u){for(const f in i){const x=i[f],b={x:0,y:0,w:x.data.width+2,h:x.data.height+2};u.push(b),l[f]=new $m(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in i.updatedImages)this.patchUpdatedImage(this.iconPositions[u],i.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],i.getImage(u),l)}patchUpdatedImage(i,l,u){if(!i||!l||i.version===l.version)return;i.version=l.version;const[f,x]=i.tl;u.update(l.data,void 0,{x:f,y:x})}}Pt("ImagePosition",$m),Pt("ImageAtlas",Gf);const ks={horizontal:1,vertical:2,horizontalOnly:3};class mA{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const u=new mA;return u.scale=i||1,u.fontStack=l,u}static forImage(i){const l=new mA;return l.imageName=i,l}}class Xh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const u=new Xh;for(let f=0;f<i.sections.length;f++){const x=i.sections[f];x.image?u.addImageSection(x):u.addTextSection(x,l)}return u}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(l,u){let f="";for(let x=0;x<l.length;x++){const b=l.charCodeAt(x+1)||null,M=l.charCodeAt(x-1)||null;f+=!u&&(b&&Vu(b)&&!dA[l[x+1]]||M&&Vu(M)&&!dA[l[x-1]])||!dA[l[x]]?l[x]:dA[l[x]]}return f}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&$f[this.text.charCodeAt(u)];u++)i++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&$f[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const u=new Xh;return u.text=this.text.substring(i,l),u.sectionIndex=this.sectionIndex.slice(i,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(mA.forText(i.scale,i.fontStack||l));const u=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(u)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void zr("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(mA.forImage(l)),this.sectionIndex.push(this.sections.length-1)):zr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hm(a,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe){const Ae=Xh.fromFeature(a,f);let xe;V===ks.vertical&&Ae.verticalizePunctuation(j);const{processBidirectionalText:Me,processStyledBidirectionalText:Le}=J;if(Me&&1===Ae.sections.length){xe=[];const Ue=Me(Ae.toString(),Zm(Ae,F,x,i,u,q,re));for(const Ze of Ue){const ot=new Xh;ot.text=Ze,ot.sections=Ae.sections;for(let At=0;At<Ze.length;At++)ot.sectionIndex.push(0);xe.push(ot)}}else if(Le){xe=[];const Ue=Le(Ae.text,Ae.sectionIndex,Zm(Ae,F,x,i,u,q,re));for(const Ze of Ue){const ot=new Xh;ot.text=Ze[0],ot.sectionIndex=Ze[1],ot.sections=Ae.sections,xe.push(ot)}}else xe=function(Ue,Ze){const ot=[],At=Ue.text;let pt=0;for(const et of Ze)ot.push(Ue.substring(pt,et)),pt=et;return pt<At.length&&ot.push(Ue.substring(pt,At.length)),ot}(Ae,Zm(Ae,F,x,i,u,q,re));const Be=[],Ne={positionedLines:Be,text:Ae.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ue,Ze,ot,At,pt,et,it,yt,rt,Yt,St,er){let Kt=0,Dn=0,Ut=0;const en="right"===yt?1:"left"===yt?0:.5;let On=!1;for(const ur of pt){const hr=ur.getSections();for(const Bi of hr){if(Bi.imageName)continue;const Zr=Ze[Bi.fontStack];if(Zr&&(On=void 0!==Zr.ascender&&void 0!==Zr.descender,!On))break}if(!On)break}let Di=0;for(const ur of pt){ur.trim();const hr=ur.getMaxScale(),Bi=24*(hr-1),Zr={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[Di]=Zr;const Ni=Zr.positionedGlyphs;let Si=0;if(!ur.length()){Dn+=et,++Di;continue}let dr=0,Kr=0;for(let Tr=0;Tr<ur.length();Tr++){const Jr=ur.getSection(Tr),Uo=ur.getSectionIndex(Tr),ei=ur.getCharCode(Tr);let ti=Jr.scale,Vn=null,zi=null,os=null,Rs=24,Fs=0;const Fa=!(rt===ks.horizontal||!St&&!Js(ei)||St&&($f[ei]||(jr=ei,Gd(jr)||Fl(jr)||Ks(jr)||wi(jr)||nl(jr))));if(Jr.imageName){const Oa=At[Jr.imageName];if(!Oa)continue;os=Jr.imageName,Ue.iconsInText=Ue.iconsInText||!0,zi=Oa.paddedRect;const yo=Oa.displaySize;ti=24*ti/er,Vn={width:yo[0],height:yo[1],left:1,top:-3,advance:Fa?yo[1]:yo[0],localGlyph:!1},Fs=On?-Vn.height*ti:24*hr-17-yo[1]*ti,Rs=Vn.advance;const aa=(Fa?yo[0]:yo[1])*ti-24*hr;aa>0&&aa>Si&&(Si=aa)}else{const Oa=ot[Jr.fontStack];if(!Oa)continue;Oa[ei]&&(zi=Oa[ei]);const yo=Ze[Jr.fontStack];if(!yo)continue;const aa=yo.glyphs[ei];if(!aa)continue;if(Vn=aa.metrics,Rs=8203!==ei?24:0,On){const nh=void 0!==yo.ascender?Math.abs(yo.ascender):0,Os=void 0!==yo.descender?Math.abs(yo.descender):0,Kh=(nh+Os)*ti;dr<Kh&&(dr=Kh,Kr=(nh-Os)/2*ti),Fs=-nh*ti}else Fs=24*(hr-ti)-17}Fa?(Ue.verticalizable=!0,Ni.push({glyph:ei,imageName:os,x:Kt,y:Dn+Fs,vertical:Fa,scale:ti,localGlyph:Vn.localGlyph,fontStack:Jr.fontStack,sectionIndex:Uo,metrics:Vn,rect:zi}),Kt+=Rs*ti+Yt):(Ni.push({glyph:ei,imageName:os,x:Kt,y:Dn+Fs,vertical:Fa,scale:ti,localGlyph:Vn.localGlyph,fontStack:Jr.fontStack,sectionIndex:Uo,metrics:Vn,rect:zi}),Kt+=Vn.advance*ti+Yt)}0!==Ni.length&&(Ut=Math.max(Kt-Yt,Ut),On?Wm(Ni,en,Si,Kr,et*hr/2):Wm(Ni,en,Si,0,et/2)),Kt=0;const Mr=et*hr+Si;Zr.lineOffset=Math.max(Si,Bi),Dn+=Mr,++Di}var jr;const Oi=Dn,{horizontalAlign:Li,verticalAlign:Gr}=Zf(it);(function(ur,hr,Bi,Zr,Ni,Si){const dr=(hr-Bi)*Ni,Kr=-Si*Zr;for(const Mr of ur)for(const Tr of Mr.positionedGlyphs)Tr.x+=dr,Tr.y+=Kr})(Ue.positionedLines,en,Li,Gr,Ut,Oi),Ue.top+=-Gr*Oi,Ue.bottom=Ue.top+Oi,Ue.left+=-Li*Ut,Ue.right=Ue.left+Ut,Ue.hasBaseline=On}(Ne,i,l,u,xe,b,M,P,V,F,j,oe),!function(Ue){for(const Ze of Ue)if(0!==Ze.positionedGlyphs.length)return!1;return!0}(Be)&&Ne}const $f={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},f1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qm(a,i,l,u,f,x){if(i.imageName){const b=u[i.imageName];return b?b.displaySize[0]*i.scale*24/x+f:0}{const b=l[i.fontStack],M=b&&b.glyphs[a];return M?M.metrics.advance*i.scale+f:0}}function Hf(a,i,l,u){const f=Math.pow(a-i,2);return u?a<i?f/2:2*f:f+Math.abs(l)*l}function e_(a,i,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==i&&65289!==i||(u+=50),u}function qf(a,i,l,u,f,x){let b=null,M=Hf(i,l,f,x);for(const P of u){const F=Hf(i-P.x,l,f,x)+P.badness;F<=M&&(b=P,M=F)}return{index:a,x:i,priorBreak:b,badness:M}}function t_(a){return a?t_(a.priorBreak).concat(a.index):[]}function Zm(a,i,l,u,f,x,b){if("point"!==x)return[];if(!a)return[];const M=[],P=function(j,q,re,oe,Ae,xe){let Me=0;for(let Le=0;Le<j.length();Le++){const Be=j.getSection(Le);Me+=qm(j.getCharCode(Le),Be,oe,Ae,q,xe)}return Me/Math.max(1,Math.ceil(Me/re))}(a,i,l,u,f,b),F=a.text.indexOf("\u200b")>=0;let N=0;for(let j=0;j<a.length();j++){const q=a.getSection(j),re=a.getCharCode(j);if($f[re]||(N+=qm(re,q,u,f,i,b)),j<a.length()-1){const oe=!((V=re)<11904||!(Bu(V)||Lh(V)||Vr(V)||ff(V)||Nu(V)||Ou(V)||Hd(V)||Ol(V)||qd(V)||Nh(V)||Ll(V)||Tc(V)||Lu(V)||Af(V)||$d(V)||Bh(V)||Sc(V)||Ma(V)||zu(V)||Mc(V)));(f1[re]||oe||q.imageName)&&M.push(qf(j+1,N,P,M,e_(re,a.getCharCode(j+1),oe&&F),!1))}}var V;return t_(qf(a.length(),N,P,M,0,!0))}function Zf(a){let i=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Wm(a,i,l,u,f){if(!(i||l||u||f))return;const x=a.length-1,b=a[x],M=(b.x+b.metrics.advance*b.scale)*i;for(let P=0;P<=x;P++)a[P].x-=M,a[P].y+=l+u+f}function Ku(a,i,l){const{horizontalAlign:u,verticalAlign:f}=Zf(l),x=i[0]-a.displaySize[0]*u,b=i[1]-a.displaySize[1]*f;return{image:a,top:b,bottom:b+a.displaySize[1],left:x,right:x+a.displaySize[0]}}function Qm(a,i,l,u,f,x){const b=a.image;let M;if(b.content){const Ae=b.content,xe=b.pixelRatio||1;M=[Ae[0]/xe,Ae[1]/xe,b.displaySize[0]-Ae[2]/xe,b.displaySize[1]-Ae[3]/xe]}const P=i.left*x,F=i.right*x;let N,V,j,q;"width"===l||"both"===l?(q=f[0]+P-u[3],V=f[0]+F+u[1]):(q=f[0]+(P+F-b.displaySize[0])/2,V=q+b.displaySize[0]);const re=i.top*x,oe=i.bottom*x;return"height"===l||"both"===l?(N=f[1]+re-u[0],j=f[1]+oe+u[2]):(N=f[1]+(re+oe-b.displaySize[1])/2,j=N+b.displaySize[1]),{image:b,top:N,right:V,bottom:j,left:q,collisionPadding:M}}class Ul extends ut{constructor(i,l,u,f,x){super(i,l),this.angle=f,this.z=u,void 0!==x&&(this.segment=x)}clone(){return new Ul(this.x,this.y,this.z,this.angle,this.segment)}}function n_(a,i,l,u,f){if(void 0===i.segment)return!0;let x=i,b=i.segment+1,M=0;for(;M>-l/2;){if(b--,b<0)return!1;M-=a[b].dist(x),x=a[b]}M+=a[b].dist(a[b+1]),b++;const P=[];let F=0;for(;M<l/2;){const N=a[b],V=a[b+1];if(!V)return!1;let j=a[b-1].angleTo(N)-N.angleTo(V);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:j}),F+=j;M-P[0].distance>u;)F-=P.shift().angleDelta;if(F>f)return!1;b++,M+=N.dist(V)}return!0}function gA(a){let i=0;for(let l=0;l<a.length-1;l++)i+=a[l].dist(a[l+1]);return i}function r_(a,i,l){return a?.6*i*l:0}function Xm(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function i_(a,i,l,u,f,x){const b=r_(l,f,x),M=Xm(l,u)*x;let P=0;const F=gA(a)/2;for(let N=0;N<a.length-1;N++){const V=a[N],j=a[N+1],q=V.dist(j);if(P+q>F){const re=(F-P)/q,oe=ht(V.x,j.x,re),Ae=ht(V.y,j.y,re),xe=new Ul(oe,Ae,0,j.angleTo(V),N);return!b||n_(a,xe,M,b,i)?xe:void 0}P+=q}}function o_(a,i,l,u,f,x,b,M,P){const F=r_(u,x,b),N=Xm(u,f),V=N*b,j=0===a[0].x||a[0].x===P||0===a[0].y||a[0].y===P;return i-V<i/4&&(i=V+i/4),Wf(a,j?i/2*M%i:(N/2+2*x)*b*M%i,i,F,l,V,j,!1,P)}function Wf(a,i,l,u,f,x,b,M,P){const F=x/2,N=gA(a);let V=0,j=i-l,q=[];for(let re=0;re<a.length-1;re++){const oe=a[re],Ae=a[re+1],xe=oe.dist(Ae),Me=Ae.angleTo(oe);for(;j+l<V+xe;){j+=l;const Le=(j-V)/xe,Be=ht(oe.x,Ae.x,Le),Ne=ht(oe.y,Ae.y,Le);if(Be>=0&&Be<P&&Ne>=0&&Ne<P&&j-F>=0&&j+F<=N){const Ue=new Ul(Be,Ne,0,Me,re);Ue._round(),u&&!n_(a,Ue,x,u,f)||q.push(Ue)}}V+=xe}return M||q.length||b||(q=Wf(a,V/2,l,u,f,x,b,!0,P)),q}function Ym(a,i,l,u,f){const x=[];for(let b=0;b<a.length;b++){const M=a[b];let P;for(let F=0;F<M.length-1;F++){let N=M[F],V=M[F+1];N.x<i&&V.x<i||(N.x<i?N=new ut(i,N.y+(i-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x<i&&(V=new ut(i,N.y+(i-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y<l&&V.y<l||(N.y<l?N=new ut(N.x+(l-N.y)/(V.y-N.y)*(V.x-N.x),l)._round():V.y<l&&(V=new ut(N.x+(l-N.y)/(V.y-N.y)*(V.x-N.x),l)._round()),N.x>=u&&V.x>=u||(N.x>=u?N=new ut(u,N.y+(u-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x>=u&&(V=new ut(u,N.y+(u-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y>=f&&V.y>=f||(N.y>=f?N=new ut(N.x+(f-N.y)/(V.y-N.y)*(V.x-N.x),f)._round():V.y>=f&&(V=new ut(N.x+(f-N.y)/(V.y-N.y)*(V.x-N.x),f)._round()),P&&N.equals(P[P.length-1])||(P=[N],x.push(P)),P.push(V)))))}}return x}Pt("Anchor",Ul);const Uc=1e20;function _A(a,i,l,u,f,x,b,M,P){for(let F=i;F<i+u;F++)Km(a,l*x+F,x,f,b,M,P);for(let F=l;F<l+f;F++)Km(a,F*x+i,1,u,b,M,P)}function Km(a,i,l,u,f,x,b){x[0]=0,b[0]=-Uc,b[1]=Uc,f[0]=a[i];for(let M=1,P=0,F=0;M<u;M++){f[M]=a[i+M*l];const N=M*M;do{const V=x[P];F=(f[M]-f[V]+N-V*V)/(M-V)/2}while(F<=b[P]&&--P>-1);P++,x[P]=M,b[P]=F,b[P+1]=Uc}for(let M=0,P=0;M<u;M++){for(;b[P+1]<M;)P++;const F=x[P],N=M-F;a[i+M*l]=f[F]+N*N}}const yA={none:0,ideographs:1,all:2};class Ju{constructor(i,l,u){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const u=[];for(const f in i)for(const x of i[f])u.push({stack:f,id:x});du(u,({stack:f,id:x},b)=>{let M=this.entries[f];M||(M=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=M.glyphs[x];if(void 0!==P)return void b(null,{stack:f,id:x,glyph:P});if(P=this._tinySDF(M,f,x),P)return M.glyphs[x]=P,void b(null,{stack:f,id:x,glyph:P});const F=Math.floor(x/256);if(256*F>65535)return void b(new Error("glyphs > 65535 not supported"));if(M.ranges[F])return void b(null,{stack:f,id:x,glyph:P});let N=M.requests[F];N||(N=M.requests[F]=[],Ju.loadGlyphRange(f,F,this.url,this.requestManager,(V,j)=>{if(j){M.ascender=j.ascender,M.descender=j.descender;for(const q in j.glyphs)this._doesCharSupportLocalGlyph(+q)||(M.glyphs[+q]=j.glyphs[+q]);M.ranges[F]=!0}for(const q of N)q(V,j);delete M.requests[F]})),N.push((V,j)=>{V?b(V):j&&b(null,{stack:f,id:x,glyph:j.glyphs[x]||null})})},(f,x)=>{if(f)l(f);else if(x){const b={};for(const{stack:M,id:P,glyph:F}of x)void 0===b[M]&&(b[M]={}),void 0===b[M].glyphs&&(b[M].glyphs={}),b[M].glyphs[P]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},b[M].ascender=this.entries[M].ascender,b[M].descender=this.entries[M].descender;l(null,b)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==yA.none&&(this.localGlyphMode===yA.all?!!this.localFontFamily:!!this.localFontFamily&&(Nh(i)||Bl(i)||Lu(i)||Sc(i))||Ol(i))}_tinySDF(i,l,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let x=i.tinySDF;if(!x){let oe="400";/bold/i.test(l)?oe="900":/medium/i.test(l)?oe="500":/light/i.test(l)&&(oe="200"),x=i.tinySDF=new Ju.TinySDF({fontFamily:f,fontWeight:oe,fontSize:48,buffer:6,radius:16}),x.fontWeight=oe}if(this.localGlyphs[x.fontWeight][u])return this.localGlyphs[x.fontWeight][u];const b=String.fromCharCode(u),{data:M,width:P,height:F,glyphWidth:N,glyphHeight:V,glyphLeft:j,glyphTop:q,glyphAdvance:re}=x.draw(b);return this.localGlyphs[x.fontWeight][u]={id:u,bitmap:new Lc({width:P,height:F},M),metrics:{width:N/2,height:V/2,left:j/2,top:q/2-27,advance:re/2,localGlyph:!0}}}}function Qf(a,i,l,u){const f=[],x=a.image,b=x.pixelRatio,M=x.paddedRect.w-2,P=x.paddedRect.h-2,F=a.right-a.left,N=a.bottom-a.top,V=x.stretchX||[[0,M]],j=x.stretchY||[[0,P]],q=(et,it)=>et+it[1]-it[0],re=V.reduce(q,0),oe=j.reduce(q,0),Ae=M-re,xe=P-oe;let Me=0,Le=re,Be=0,Ne=oe,Ue=0,Ze=Ae,ot=0,At=xe;if(x.content&&u){const et=x.content;Me=jc(V,0,et[0]),Be=jc(j,0,et[1]),Le=jc(V,et[0],et[2]),Ne=jc(j,et[1],et[3]),Ue=et[0]-Me,ot=et[1]-Be,Ze=et[2]-et[0]-Le,At=et[3]-et[1]-Ne}const pt=(et,it,yt,rt)=>{const Yt=vA(et.stretch-Me,Le,F,a.left),St=Xf(et.fixed-Ue,Ze,et.stretch,re),er=vA(it.stretch-Be,Ne,N,a.top),Kt=Xf(it.fixed-ot,At,it.stretch,oe),Dn=vA(yt.stretch-Me,Le,F,a.left),Ut=Xf(yt.fixed-Ue,Ze,yt.stretch,re),en=vA(rt.stretch-Be,Ne,N,a.top),On=Xf(rt.fixed-ot,At,rt.stretch,oe),Di=new ut(Yt,er),jr=new ut(Dn,er),Oi=new ut(Dn,en),Li=new ut(Yt,en),Gr=new ut(St/b,Kt/b),ur=new ut(Ut/b,On/b),hr=i*Math.PI/180;if(hr){const Ni=Math.sin(hr),Si=Math.cos(hr),dr=[Si,-Ni,Ni,Si];Di._matMult(dr),jr._matMult(dr),Li._matMult(dr),Oi._matMult(dr)}const Bi=et.stretch+et.fixed,Zr=it.stretch+it.fixed;return{tl:Di,tr:jr,bl:Li,br:Oi,tex:{x:x.paddedRect.x+1+Bi,y:x.paddedRect.y+1+Zr,w:yt.stretch+yt.fixed-Bi,h:rt.stretch+rt.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gr,pixelOffsetBR:ur,minFontScaleX:Ze/b/F,minFontScaleY:At/b/N,isSDF:l}};if(u&&(x.stretchX||x.stretchY)){const et=s_(V,Ae,re),it=s_(j,xe,oe);for(let yt=0;yt<et.length-1;yt++){const rt=et[yt],Yt=et[yt+1];for(let St=0;St<it.length-1;St++)f.push(pt(rt,it[St],Yt,it[St+1]))}}else f.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return f}function jc(a,i,l){let u=0;for(const f of a)u+=Math.max(i,Math.min(l,f[1]))-Math.max(i,Math.min(l,f[0]));return u}function s_(a,i,l){const u=[{fixed:-1,stretch:0}];for(const[f,x]of a){const b=u[u.length-1];u.push({fixed:f-b.stretch,stretch:b.stretch}),u.push({fixed:f-b.stretch,stretch:b.stretch+(x-f)})}return u.push({fixed:i+1,stretch:l}),u}function vA(a,i,l,u){return a/i*l+u}function Xf(a,i,l,u){return a-i*l/u}function p1(a,i,l,u){const f=i+a.positionedLines[u].lineOffset;return 0===u?l+f/2:l+(f+(i+a.positionedLines[u-1].lineOffset))/2}Ju.loadGlyphRange=function(a,i,l,u,f){const x=256*i,b=x+255,M=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${x}-${b}`),ya.Glyphs);Z(M,(P,F)=>{if(P)f(P);else if(F){const N={},V=new AA(F).readFields(c2,{});for(const j of V.glyphs)N[j.id]=j;f(null,{glyphs:N,ascender:V.ascender,descender:V.descender})}})},Ju.TinySDF=class{constructor({fontSize:a=24,buffer:i=3,radius:l=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:x="normal",fontStyle:b="normal"}){this.buffer=i,this.cutoff=u,this.radius=l;const M=this.size=a+4*i,P=this._createCanvas(M),F=this.ctx=P.getContext("2d",{willReadFrequently:!0});F.font=`${b} ${x} ${a}px ${f}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(a){const i=document.createElement("canvas");return i.width=i.height=a,i}draw(a){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:x}=this.ctx.measureText(a),b=Math.floor(l),M=Math.min(this.size-this.buffer,Math.ceil(x-f)),P=Math.min(this.size-this.buffer,Math.ceil(l)+Math.ceil(u)),F=M+2*this.buffer,N=P+2*this.buffer,V=F*N,j=new Uint8ClampedArray(V),q={data:j,width:F,height:N,glyphWidth:M,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:i};if(0===M||0===P)return q;const{ctx:re,buffer:oe,gridInner:Ae,gridOuter:xe}=this;re.clearRect(oe,oe,M,P),re.fillText(a,oe,oe+b+1);const Me=re.getImageData(oe,oe,M,P);xe.fill(Uc,0,V),Ae.fill(0,0,V);for(let Le=0;Le<P;Le++)for(let Be=0;Be<M;Be++){const Ne=Me.data[4*(Le*M+Be)+3]/255;if(0===Ne)continue;const Ue=(Le+oe)*F+Be+oe;if(1===Ne)xe[Ue]=0,Ae[Ue]=Uc;else{const Ze=.5-Ne;xe[Ue]=Ze>0?Ze*Ze:0,Ae[Ue]=Ze<0?Ze*Ze:0}}_A(xe,0,0,F,N,F,this.f,this.v,this.z),_A(Ae,oe,oe,M,P,F,this.f,this.v,this.z);for(let Le=0;Le<V;Le++){const Be=Math.sqrt(xe[Le])-Math.sqrt(Ae[Le]);j[Le]=Math.round(255-255*(Be/this.radius+this.cutoff))}return q}};class a_{constructor(i=[],l=Jm){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:u}=this,f=l[i];for(;i>0;){const x=i-1>>1,b=l[x];if(u(f,b)>=0)break;l[i]=b,i=x}l[i]=f}_down(i){const{data:l,compare:u}=this,f=this.length>>1,x=l[i];for(;i<f;){let b=1+(i<<1),M=l[b];const P=b+1;if(P<this.length&&u(l[P],M)<0&&(b=P,M=l[P]),u(M,x)>=0)break;l[i]=M,i=b}l[i]=x}}function Jm(a,i){return a<i?-1:a>i?1:0}function l_(a,i=1,l=!1){let u=1/0,f=1/0,x=-1/0,b=-1/0;const M=a[0];for(let q=0;q<M.length;q++){const re=M[q];(!q||re.x<u)&&(u=re.x),(!q||re.y<f)&&(f=re.y),(!q||re.x>x)&&(x=re.x),(!q||re.y>b)&&(b=re.y)}const P=Math.min(x-u,b-f);let F=P/2;const N=new a_([],u2);if(0===P)return new ut(u,f);for(let q=u;q<x;q+=P)for(let re=f;re<b;re+=P)N.push(new eh(q+F,re+F,F,a));let V=function(q){let re=0,oe=0,Ae=0;const xe=q[0];for(let Me=0,Le=xe.length,Be=Le-1;Me<Le;Be=Me++){const Ne=xe[Me],Ue=xe[Be],Ze=Ne.x*Ue.y-Ue.x*Ne.y;oe+=(Ne.x+Ue.x)*Ze,Ae+=(Ne.y+Ue.y)*Ze,re+=3*Ze}return new eh(oe/re,Ae/re,0,q)}(a),j=N.length;for(;N.length;){const q=N.pop();(q.d>V.d||!V.d)&&(V=q,l&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,j)),q.max-V.d<=i||(F=q.h/2,N.push(new eh(q.p.x-F,q.p.y-F,F,a)),N.push(new eh(q.p.x+F,q.p.y-F,F,a)),N.push(new eh(q.p.x-F,q.p.y+F,F,a)),N.push(new eh(q.p.x+F,q.p.y+F,F,a)),j+=4)}return l&&(console.log(`num probes: ${j}`),console.log(`best distance: ${V.d}`)),V.p}function u2(a,i){return i.max-a.max}function eh(a,i,l,u){this.p=new ut(a,i),this.h=l,this.d=function(f,x){let b=!1,M=1/0;for(let P=0;P<x.length;P++){const F=x[P];for(let N=0,V=F.length,j=V-1;N<V;j=N++){const q=F[N],re=F[j];q.y>f.y!=re.y>f.y&&f.x<(re.x-q.x)*(f.y-q.y)/(re.y-q.y)+q.x&&(b=!b),M=Math.min(M,_m(f,q,re))}}return(b?1:-1)*Math.sqrt(M)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const eg=Number.POSITIVE_INFINITY,c_=Math.sqrt(2);function u_(a,i){return i[1]!==eg?function(l,u,f){let x=0,b=0;switch(u=Math.abs(u),f=Math.abs(f),l){case"top-right":case"top-left":case"top":b=f-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-f}switch(l){case"top-right":case"bottom-right":case"right":x=-u;break;case"top-left":case"bottom-left":case"left":x=u}return[x,b]}(a,i[0],i[1]):function(l,u){let f=0,x=0;u<0&&(u=0);const b=u/c_;switch(l){case"top-right":case"top-left":x=b-7;break;case"bottom-right":case"bottom-left":x=7-b;break;case"bottom":x=7-u;break;case"top":x=u-7}switch(l){case"top-right":case"bottom-right":f=-b;break;case"top-left":case"bottom-left":f=b;break;case"left":f=u;break;case"right":f=-u}return[f,x]}(a,i[0])}function m1(a,i,l,u,f,x,b,M){a.createArrays(),a.tilePixelRatio=cr/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const P=a.layers[0].layout,F=a.layers[0]._unevaluatedLayout._values,N={};if("composite"===a.textSizeData.kind){const{minZoom:q,maxZoom:re}=a.textSizeData;N.compositeTextSizes=[F["text-size"].possiblyEvaluate(new te(q),b),F["text-size"].possiblyEvaluate(new te(re),b)]}if("composite"===a.iconSizeData.kind){const{minZoom:q,maxZoom:re}=a.iconSizeData;N.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new te(q),b),F["icon-size"].possiblyEvaluate(new te(re),b)]}N.layoutTextSize=F["text-size"].possiblyEvaluate(new te(M+1),b),N.layoutIconSize=F["icon-size"].possiblyEvaluate(new te(M+1),b),N.textMaxSize=F["text-size"].possiblyEvaluate(new te(18),b);const V="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),j=P.get("text-size");for(const q of a.features){const re=P.get("text-font").evaluate(q,{},b).join(","),oe=j.evaluate(q,{},b),Ae=N.layoutTextSize.evaluate(q,{},b),xe=(N.layoutIconSize.evaluate(q,{},b),{horizontal:{},vertical:void 0}),Me=q.text;let Le,Be=[0,0];if(Me){const Ze=Me.toString(),ot=24*P.get("text-letter-spacing").evaluate(q,{},b),At=24*P.get("text-line-height").evaluate(q,{},b),pt=Am(Ze)?ot:0,et=P.get("text-anchor").evaluate(q,{},b),it=P.get("text-variable-anchor");if(!it){const Kt=P.get("text-radial-offset").evaluate(q,{},b);Be=Kt?u_(et,[24*Kt,eg]):P.get("text-offset").evaluate(q,{},b).map(Dn=>24*Dn)}let yt=V?"center":P.get("text-justify").evaluate(q,{},b);const rt=P.get("symbol-placement"),Yt="point"===rt,St="point"===rt?24*P.get("text-max-width").evaluate(q,{},b):0,er=Kt=>{a.allowVerticalPlacement&&Nl(Ze)&&(xe.vertical=Hm(Me,i,l,f,re,St,At,et,Kt,pt,Be,ks.vertical,!0,rt,Ae,oe))};if(!V&&it){const Kt="auto"===yt?it.map(Ut=>Ps(Ut)):[yt];let Dn=!1;for(let Ut=0;Ut<Kt.length;Ut++){const en=Kt[Ut];if(!xe.horizontal[en])if(Dn)xe.horizontal[en]=xe.horizontal[0];else{const On=Hm(Me,i,l,f,re,St,At,"center",en,pt,Be,ks.horizontal,!1,rt,Ae,oe);On&&(xe.horizontal[en]=On,Dn=1===On.positionedLines.length)}}er("left")}else{if("auto"===yt&&(yt=Ps(et)),Yt||P.get("text-writing-mode").indexOf("horizontal")>=0||!Nl(Ze)){const Kt=Hm(Me,i,l,f,re,St,At,et,yt,pt,Be,ks.horizontal,!1,rt,Ae,oe);Kt&&(xe.horizontal[yt]=Kt)}er("point"===rt?"left":yt)}}let Ne=!1;if(q.icon&&q.icon.name){const Ze=u[q.icon.name];Ze&&(Le=Ku(f[q.icon.name],P.get("icon-offset").evaluate(q,{},b),P.get("icon-anchor").evaluate(q,{},b)),Ne=Ze.sdf,void 0===a.sdfIcons?a.sdfIcons=Ze.sdf:a.sdfIcons!==Ze.sdf&&zr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==a.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Ue=d_(xe.horizontal)||xe.vertical;a.iconsInText||(a.iconsInText=!!Ue&&Ue.iconsInText),(Ue||Le)&&g1(a,q,xe,Le,u,N,Ae,0,Be,Ne,b)}x&&a.generateCollisionDebugBuffers(M,a.collisionBoxArray)}function Ps(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function g1(a,i,l,u,f,x,b,M,P,F,N){let V=x.textMaxSize.evaluate(i,{},N);void 0===V&&(V=b);const j=a.layers[0].layout,q=j.get("icon-offset").evaluate(i,{},N),re=d_(l.horizontal)||l.vertical,oe=b/24,Ae=a.tilePixelRatio*V/24,xe=a.tilePixelRatio*j.get("symbol-spacing"),Me=j.get("text-padding")*a.tilePixelRatio,Le=j.get("icon-padding")*a.tilePixelRatio,Be=$n(j.get("text-max-angle")),Ne="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ue="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),Ze=j.get("symbol-placement"),ot=xe/2,At=j.get("icon-text-fit");let pt;u&&"none"!==At&&(a.allowVerticalPlacement&&l.vertical&&(pt=Qm(u,l.vertical,At,j.get("icon-text-fit-padding"),q,oe)),re&&(u=Qm(u,re,At,j.get("icon-text-fit-padding"),q,oe)));const et=(it,yt)=>{yt.x<0||yt.x>=cr||yt.y<0||yt.y>=cr||function(rt,Yt,St,er,Kt,Dn,Ut,en,On,Di,jr,Oi,Li,Gr,ur,hr,Bi,Zr,Ni,Si,dr,Kr,Mr,Tr){const Jr=rt.addToLineVertexArray(Yt,er);let Uo,ei,ti,Vn,zi,os,Rs,Fs=0,Fa=0,Oa=0,yo=0,aa=-1,nh=-1;const Os={};let Kh=yf(""),Zc=0,cp=0;if(void 0===On._unevaluatedLayout.getValue("text-radial-offset")?[Zc,cp]=On.layout.get("text-offset").evaluate(dr,{},Tr).map(ss=>24*ss):(Zc=24*On.layout.get("text-radial-offset").evaluate(dr,{},Tr),cp=eg),rt.allowVerticalPlacement&&Kt.vertical){const ss=Kt.vertical;if(ur)os=tg(ss),en&&(Rs=tg(en));else{const as=On.layout.get("text-rotate").evaluate(dr,{},Tr)+90;ti=Yf(Di,St,Yt,jr,Oi,Li,ss,Gr,as,hr),en&&(Vn=Yf(Di,St,Yt,jr,Oi,Li,en,Zr,as))}}if(Dn){const ss=On.layout.get("icon-rotate").evaluate(dr,{},Tr),as="none"!==On.layout.get("icon-text-fit"),TA=Qf(Dn,ss,Mr,as),gg=en?Qf(en,ss,Mr,as):void 0;ei=Yf(Di,St,Yt,jr,Oi,Li,Dn,Zr,ss),Fs=4*TA.length;const S1=rt.iconSizeData;let rh=null;"source"===S1.kind?(rh=[il*On.layout.get("icon-size").evaluate(dr,{},Tr)],rh[0]>jl&&zr(`${rt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===S1.kind&&(rh=[il*Kr.compositeIconSizes[0].evaluate(dr,{},Tr),il*Kr.compositeIconSizes[1].evaluate(dr,{},Tr)],(rh[0]>jl||rh[1]>jl)&&zr(`${rt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,TA,rh,Si,Ni,dr,!1,St,Yt,Jr.lineStartIndex,Jr.lineLength,-1,Tr),aa=rt.icon.placedSymbolArray.length-1,gg&&(Fa=4*gg.length,rt.addSymbols(rt.icon,gg,rh,Si,Ni,dr,ks.vertical,St,Yt,Jr.lineStartIndex,Jr.lineLength,-1,Tr),nh=rt.icon.placedSymbolArray.length-1)}for(const ss in Kt.horizontal){const as=Kt.horizontal[ss];Uo||(Kh=yf(as.text),ur?zi=tg(as):Uo=Yf(Di,St,Yt,jr,Oi,Li,as,Gr,On.layout.get("text-rotate").evaluate(dr,{},Tr),hr));const TA=1===as.positionedLines.length;if(Oa+=h_(rt,St,Yt,as,Ut,On,ur,dr,hr,Jr,Kt.vertical?ks.horizontal:ks.horizontalOnly,TA?Object.keys(Kt.horizontal):[ss],Os,aa,Kr,Tr),TA)break}Kt.vertical&&(yo+=h_(rt,St,Yt,Kt.vertical,Ut,On,ur,dr,hr,Jr,ks.vertical,["vertical"],Os,nh,Kr,Tr));let Wc=-1;const mg=(ss,as)=>ss?Math.max(ss,as):as;Wc=mg(zi,Wc),Wc=mg(os,Wc),Wc=mg(Rs,Wc);const Jh=Wc>-1?1:0;rt.glyphOffsetArray.length>=ao.MAX_GLYPHS&&zr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==dr.sortKey&&rt.addToSortKeyRanges(rt.symbolInstances.length,dr.sortKey),rt.symbolInstances.emplaceBack(St.x,St.y,St.z,Yt.x,Yt.y,Os.right>=0?Os.right:-1,Os.center>=0?Os.center:-1,Os.left>=0?Os.left:-1,Os.vertical>=0?Os.vertical:-1,aa,nh,Kh,void 0!==Uo?Uo:rt.collisionBoxArray.length,void 0!==Uo?Uo+1:rt.collisionBoxArray.length,void 0!==ti?ti:rt.collisionBoxArray.length,void 0!==ti?ti+1:rt.collisionBoxArray.length,void 0!==ei?ei:rt.collisionBoxArray.length,void 0!==ei?ei+1:rt.collisionBoxArray.length,Vn||rt.collisionBoxArray.length,Vn?Vn+1:rt.collisionBoxArray.length,jr,Oa,yo,Fs,Fa,Jh,0,Zc,cp,Wc)}(a,yt,yt,it,l,u,f,pt,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,Me,Ne,P,0,Le,Ue,q,i,x,F,N)};if("line"===Ze)for(const it of Ym(i.geometry,0,0,cr,cr)){const yt=o_(it,xe,Be,l.vertical||re,u,24,Ae,a.overscaling,cr);for(const rt of yt){const Yt=re;Yt&&A_(a,Yt.text,ot,rt)||et(it,rt)}}else if("line-center"===Ze){for(const it of i.geometry)if(it.length>1){const yt=i_(it,Be,l.vertical||re,u,24,Ae);yt&&et(it,yt)}}else if("Polygon"===i.type)for(const it of Sm(i.geometry,0)){const yt=l_(it,16);et(it[0],new Ul(yt.x,yt.y,0,0,void 0))}else if("LineString"===i.type)for(const it of i.geometry)et(it,new Ul(it[0].x,it[0].y,0,0,void 0));else if("Point"===i.type)for(const it of i.geometry)for(const yt of it)et([yt],new Ul(yt.x,yt.y,0,0,void 0))}const jl=32640;function h_(a,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe){const Ae=function(Le,Be,Ne,Ue,Ze,ot,At,pt){const et=[];if(0===Be.positionedLines.length)return et;const it=Ue.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,yt=function(Kt){const Dn=Kt[0],Ut=Kt[1],en=Dn*Ut;return en>0?[Dn,-Ut]:en<0?[-Dn,Ut]:0===Dn?[Ut,Dn]:[Ut,-Dn]}(Ne);let rt=Math.abs(Be.top-Be.bottom);for(const Kt of Be.positionedLines)rt-=Kt.lineOffset;const Yt=Be.positionedLines.length,St=rt/Yt;let er=Be.top-Ne[1];for(let Kt=0;Kt<Yt;++Kt){const Dn=Be.positionedLines[Kt];er=p1(Be,St,er,Kt);for(const Ut of Dn.positionedGlyphs){if(!Ut.rect)continue;const en=Ut.rect||{};let On=4,Di=!0,jr=1,Oi=0;if(Ut.imageName){const Vn=At[Ut.imageName];if(!Vn)continue;if(Vn.sdf){zr("SDF images are not supported in formatted text and will be ignored.");continue}Di=!1,jr=Vn.pixelRatio,On=1/jr}const Li=(Ze||pt)&&Ut.vertical,Gr=Ut.metrics.advance*Ut.scale/2,ur=Ut.metrics,hr=Ut.rect;if(null===hr)continue;pt&&Be.verticalizable&&(Oi=Ut.imageName?Gr-Ut.metrics.width*Ut.scale/2:0);const Bi=Ze?[Ut.x+Gr,Ut.y]:[0,0];let Zr=[0,0],Ni=[0,0],Si=!1;Ze||(Li?(Ni=[Ut.x+Gr+yt[0],Ut.y+yt[1]-Oi],Si=!0):Zr=[Ut.x+Gr+Ne[0],Ut.y+Ne[1]-Oi]);const dr=hr.w*Ut.scale/(jr*(Ut.localGlyph?2:1)),Kr=hr.h*Ut.scale/(jr*(Ut.localGlyph?2:1));let Mr,Tr,Jr,Uo;if(Li){const Vn=Ut.y-er,zi=new ut(-Gr,Gr-Vn),os=-Math.PI/2,Rs=new ut(...Ni);Mr=new ut(-Gr+Zr[0],Zr[1]),Mr._rotateAround(os,zi)._add(Rs),Mr.x+=-Vn+Gr,Mr.y-=(ur.left-On)*Ut.scale;const Fs=Ut.imageName?ur.advance*Ut.scale:24*Ut.scale,Fa=String.fromCharCode(Ut.glyph);h1(Fa)?Mr.x+=(1-On)*Ut.scale:X0(Fa)?Mr.x+=Fs-ur.height*Ut.scale+(-On-1)*Ut.scale:Mr.x+=Ut.imageName||ur.width+2*On===hr.w&&ur.height+2*On===hr.h?(Fs-Kr)/2:(Fs-(ur.height+2*On)*Ut.scale)/2,Tr=new ut(Mr.x,Mr.y-dr),Jr=new ut(Mr.x+Kr,Mr.y),Uo=new ut(Mr.x+Kr,Mr.y-dr)}else{const Vn=(ur.left-On)*Ut.scale-Gr+Zr[0],zi=(-ur.top-On)*Ut.scale+Zr[1],os=Vn+dr,Rs=zi+Kr;Mr=new ut(Vn,zi),Tr=new ut(os,zi),Jr=new ut(Vn,Rs),Uo=new ut(os,Rs)}if(it){let Vn;Vn=Ze?new ut(0,0):Si?new ut(yt[0],yt[1]):new ut(Ne[0],Ne[1]),Mr._rotateAround(it,Vn),Tr._rotateAround(it,Vn),Jr._rotateAround(it,Vn),Uo._rotateAround(it,Vn)}const ei=new ut(0,0),ti=new ut(0,0);et.push({tl:Mr,tr:Tr,bl:Jr,br:Uo,tex:en,writingMode:Be.writingMode,glyphOffset:Bi,sectionIndex:Ut.sectionIndex,isSDF:Di,pixelOffsetTL:ei,pixelOffsetBR:ti,minFontScaleX:0,minFontScaleY:0})}}return et}(0,u,P,x,b,M,f,a.allowVerticalPlacement),xe=a.textSizeData;let Me=null;"source"===xe.kind?(Me=[il*x.layout.get("text-size").evaluate(M,{},oe)],Me[0]>jl&&zr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===xe.kind&&(Me=[il*re.compositeTextSizes[0].evaluate(M,{},oe),il*re.compositeTextSizes[1].evaluate(M,{},oe)],(Me[0]>jl||Me[1]>jl)&&zr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,Ae,Me,P,b,M,N,i,l,F.lineStartIndex,F.lineLength,q,oe);for(const Le of V)j[Le]=a.text.placedSymbolArray.length-1;return 4*Ae.length}function d_(a){for(const i in a)return a[i];return null}function Yf(a,i,l,u,f,x,b,M,P,F){let N=b.top,V=b.bottom,j=b.left,q=b.right;const re=b.collisionPadding;if(re&&(j-=re[0],N-=re[1],q+=re[2],V+=re[3]),P){const oe=new ut(j,N),Ae=new ut(q,N),xe=new ut(j,V),Me=new ut(q,V),Le=$n(P);let Be=new ut(0,0);F&&(Be=new ut(F[0],F[1])),oe._rotateAround(Le,Be),Ae._rotateAround(Le,Be),xe._rotateAround(Le,Be),Me._rotateAround(Le,Be),j=Math.min(oe.x,Ae.x,xe.x,Me.x),q=Math.max(oe.x,Ae.x,xe.x,Me.x),N=Math.min(oe.y,Ae.y,xe.y,Me.y),V=Math.max(oe.y,Ae.y,xe.y,Me.y)}return a.emplaceBack(i.x,i.y,i.z,l.x,l.y,j,N,q,V,M,u,f,x),a.length-1}function tg(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const i=a.bottom-a.top;return i>0?Math.max(10,i):null}function A_(a,i,l,u){const f=a.compareText;if(i in f){const x=f[i];for(let b=x.length-1;b>=0;b--)if(u.dist(x[b])<l)return!0}else f[i]=[];return f[i].push(u),!1}const _1=ka.VectorTileFeature.types,y1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kf(a,i,l,u,f,x,b,M,P,F,N,V,j,q,re,oe){const Ae=N?Math.min(jl,Math.round(N[0])):0,xe=N?Math.min(jl,Math.round(N[1])):0;a.emplaceBack(i,l,Math.round(32*b),Math.round(32*M),P,F,(Ae<<1)+(V?1:0),xe,16*j,16*q,256*re,256*oe,u,f,x,0)}function hn(a,i,l){a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l)}function Fn(a){for(const i of a.sections)if(_(i.text))return!0;return!1}class Jf{constructor(i){this.layoutVertexArray=new go,this.indexArray=new Tn,this.programConfigurations=i,this.segments=new Fi,this.dynamicLayoutVertexArray=new cn,this.opacityVertexArray=new Io,this.placedSymbolArray=new nn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,W0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Vf.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,y1,!0),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pt("SymbolBuffers",Jf);class Yh{constructor(i,l,u){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new u,this.segments=new Fi,this.collisionVertexArray=new ko,this.collisionVertexArrayExt=new cn}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,l1.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,c1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pt("CollisionBuffers",Yh);class ao{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(b=>b.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Sf([]),this.placementViewportMatrix=Sf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lm(this.zoom,l["text-size"]),this.iconSizeData=Lm(this.zoom,l["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),x=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==x&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===x||"auto"===x&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(b=>ks[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=i.sourceID}createArrays(){this.text=new Jf(new ta(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Jf(new ta(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ev,this.lineVertexArray=new Dv,this.symbolInstances=new fm}calculateGlyphDependencies(i,l,u,f,x){for(let b=0;b<i.length;b++)if(l[i.charCodeAt(b)]=!0,f&&x){const M=dA[i.charAt(b)];M&&(l[M.charCodeAt(0)]=!0)}}populate(i,l,u){const f=this.layers[0],x=f.layout,b=x.get("text-font"),M=x.get("text-field"),P=x.get("icon-image"),F=("constant"!==M.value.kind||M.value.value instanceof di&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),N="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,V=x.get("symbol-sort-key");if(this.features=[],!F&&!N)return;const j=l.iconDependencies,q=l.glyphDependencies,re=l.availableImages,oe=new te(this.zoom);for(const{feature:Ae,id:xe,index:Me,sourceLayerIndex:Le}of i){const Be=f._featureFilter.needGeometry,Ne=$u(Ae,Be);if(!f._featureFilter.filter(oe,Ne,u))continue;let Ue,Ze;if(Be||(Ne.geometry=na(Ae)),F){const At=f.getValueAndResolveTokens("text-field",Ne,u,re),pt=di.factory(At);Fn(pt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===H()||this.hasRTLText&&J.isParsed())&&(Ue=Q0(pt,f,Ne))}if(N){const At=f.getValueAndResolveTokens("icon-image",Ne,u,re);Ze=At instanceof Oo?At:Oo.fromString(At)}if(!Ue&&!Ze)continue;const ot=this.sortFeaturesByKey?V.evaluate(Ne,{},u):void 0;if(this.features.push({id:xe,text:Ue,icon:Ze,index:Me,sourceLayerIndex:Le,geometry:Ne.geometry,properties:Ae.properties,type:_1[Ae.type],sortKey:ot}),Ze&&(j[Ze.name]=!0),Ue){const At=b.evaluate(Ne,{},u).join(","),pt="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ks.vertical)>=0;for(const et of Ue.sections)if(et.image)j[et.image.name]=!0;else{const it=Nl(Ue.toString()),yt=et.fontStack||At,rt=q[yt]=q[yt]||{};this.calculateGlyphDependencies(et.text,rt,pt,this.allowVerticalPlacement,it)}}}"line"===x.get("symbol-placement")&&(this.features=function(Ae){const xe={},Me={},Le=[];let Be=0;function Ne(At){Le.push(Ae[At]),Be++}function Ue(At,pt,et){const it=Me[At];return delete Me[At],Me[pt]=it,Le[it].geometry[0].pop(),Le[it].geometry[0]=Le[it].geometry[0].concat(et[0]),it}function Ze(At,pt,et){const it=xe[pt];return delete xe[pt],xe[At]=it,Le[it].geometry[0].shift(),Le[it].geometry[0]=et[0].concat(Le[it].geometry[0]),it}function ot(At,pt,et){const it=et?pt[0][pt[0].length-1]:pt[0][0];return`${At}:${it.x}:${it.y}`}for(let At=0;At<Ae.length;At++){const pt=Ae[At],et=pt.geometry,it=pt.text?pt.text.toString():null;if(!it){Ne(At);continue}const yt=ot(it,et),rt=ot(it,et,!0);if(yt in Me&&rt in xe&&Me[yt]!==xe[rt]){const Yt=Ze(yt,rt,et),St=Ue(yt,rt,Le[Yt].geometry);delete xe[yt],delete Me[rt],Me[ot(it,Le[St].geometry,!0)]=St,Le[Yt].geometry=null}else yt in Me?Ue(yt,rt,et):rt in xe?Ze(yt,rt,et):(Ne(At),xe[yt]=Be-1,Me[rt]=Be-1)}return Le.filter(At=>At.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ae,xe)=>Ae.sortKey-xe.sortKey)}update(i,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,u),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const u=this.lineVertexArray.length;if(void 0!==i.segment){let f=i.dist(l[i.segment+1]),x=i.dist(l[i.segment]);const b={};for(let M=i.segment+1;M<l.length;M++)b[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:f},M<l.length-1&&(f+=l[M+1].dist(l[M]));for(let M=i.segment||0;M>=0;M--)b[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=l[M-1].dist(l[M]));for(let M=0;M<l.length;M++){const P=b[M];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,l,u,f,x,b,M,P,F,N,V,j,q){const re=i.indexArray,oe=i.layoutVertexArray,Ae=i.segments.prepareSegment(4*l.length,oe,re,this.canOverlap?b.sortKey:void 0),xe=this.glyphOffsetArray.length,Me=Ae.vertexLength,Le=this.allowVerticalPlacement&&M===ks.vertical?Math.PI/2:0,Be=b.text&&b.text.sections;for(let Ne=0;Ne<l.length;Ne++){const{tl:Ue,tr:Ze,bl:ot,br:At,tex:pt,pixelOffsetTL:et,pixelOffsetBR:it,minFontScaleX:yt,minFontScaleY:rt,glyphOffset:Yt,isSDF:St,sectionIndex:er}=l[Ne],Kt=Ae.vertexLength,Dn=Yt[1];Kf(oe,P.x,P.y,P.z,F.x,F.y,Ue.x,Dn+Ue.y,pt.x,pt.y,u,St,et.x,et.y,yt,rt),Kf(oe,P.x,P.y,P.z,F.x,F.y,Ze.x,Dn+Ze.y,pt.x+pt.w,pt.y,u,St,it.x,et.y,yt,rt),Kf(oe,P.x,P.y,P.z,F.x,F.y,ot.x,Dn+ot.y,pt.x,pt.y+pt.h,u,St,et.x,it.y,yt,rt),Kf(oe,P.x,P.y,P.z,F.x,F.y,At.x,Dn+At.y,pt.x+pt.w,pt.y+pt.h,u,St,it.x,it.y,yt,rt),hn(i.dynamicLayoutVertexArray,P,Le),re.emplaceBack(Kt,Kt+1,Kt+2),re.emplaceBack(Kt+1,Kt+2,Kt+3),Ae.vertexLength+=4,Ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),Ne!==l.length-1&&er===l[Ne+1].sectionIndex||i.programConfigurations.populatePaintArrays(oe.length,b,b.index,{},q,Be&&Be[er])}i.placedSymbolArray.emplaceBack(P.x,P.y,P.z,F.x,F.y,xe,this.glyphOffsetArray.length-xe,Me,N,V,F.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],M,0,!1,0,j,0)}_commitLayoutVertex(i,l,u,f,x,b,M){i.emplaceBack(l,u,f,x,b,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(i,l,u,f,x,b,M){const P=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),F=P.vertexLength,N=M.tileAnchorX,V=M.tileAnchorY;for(let q=0;q<4;q++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-i.padding,-i.padding),u.collisionVertexArrayExt.emplaceBack(l,i.padding,-i.padding),u.collisionVertexArrayExt.emplaceBack(l,i.padding,i.padding),u.collisionVertexArrayExt.emplaceBack(l,-i.padding,i.padding),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ut(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ut(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ut(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,x,b,N,V,new ut(i.x1,i.y2)),P.vertexLength+=4;const j=u.indexArray;j.emplaceBack(F,F+1),j.emplaceBack(F+1,F+2),j.emplaceBack(F+2,F+3),j.emplaceBack(F+3,F),P.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,u,f,x,b){for(let M=f;M<x;M++){const P=u.get(M),F=this.getSymbolInstanceTextSize(i,b,l,M);this._addCollisionDebugVertices(P,F,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(i,l,u,f,x,b){for(let M=f;M<x;M++){const P=u.get(M),F=this.getSymbolInstanceIconSize(i,l,M);this._addCollisionDebugVertices(P,F,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yh(_o,Nc.members,ai),this.iconCollisionBox=new Yh(_o,Nc.members,ai);const u=Vl(this.iconSizeData,i),f=Vl(this.textSizeData,i);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(f,i,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(f,i,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(u,i,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(u,i,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,l,u,f){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),b=Uf(this.textSizeData,i,x)/24;return this.tilePixelRatio*b}getSymbolInstanceIconSize(i,l,u){const f=this.icon.placedSymbolArray.get(u),x=Uf(this.iconSizeData,i,f);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(i,l,u){i.emplaceBack(l,-u,-u),i.emplaceBack(l,u,-u),i.emplaceBack(l,u,u),i.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(i,l,u,f,x,b){for(let M=f;M<x;M++){const P=u.get(M),F=this.getSymbolInstanceTextSize(i,b,l,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,P.padding)}}_updateIconDebugCollisionBoxes(i,l,u,f,x){for(let b=f;b<x;b++){const M=u.get(b),P=this.getSymbolInstanceIconSize(i,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,M.padding)}}updateCollisionDebugBuffers(i,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Vl(this.iconSizeData,i),f=Vl(this.textSizeData,i);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(f,i,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(f,i,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(u,i,l,b.iconBoxStartIndex,b.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,i,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,u,f,x,b,M,P,F){const N={};for(let V=l;V<u;V++){const j=i.get(V);N.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.textFeatureIndex=j.featureIndex;break}for(let V=f;V<x;V++){const j=i.get(V);N.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.verticalTextFeatureIndex=j.featureIndex;break}for(let V=b;V<M;V++){const j=i.get(V);N.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.iconFeatureIndex=j.featureIndex;break}for(let V=P;V<F;V++){const j=i.get(V);N.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},N.verticalIconFeatureIndex=j.featureIndex;break}return N}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const u=i.placedSymbolArray.get(l),f=u.vertexStartIndex+4*u.numGlyphs;for(let x=u.vertexStartIndex;x<f;x+=4)i.indexArray.emplaceBack(x,x+1,x+2),i.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),u=Math.cos(i),f=[],x=[],b=[];for(let M=0;M<this.symbolInstances.length;++M){b.push(M);const P=this.symbolInstances.get(M);f.push(0|Math.round(l*P.tileAnchorX+u*P.tileAnchorY)),x.push(P.featureIndex)}return b.sort((M,P)=>f[M]-f[P]||x[P]-x[M]),b}addToSortKeyRanges(i,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((f,x,b)=>{f>=0&&b.indexOf(f)===x&&this.addIndicesForPlacedSymbol(this.text,f)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pt("SymbolBucket",ao,{omit:["layers","collisionBoxArray","features","compareText"]}),ao.MAX_GLYPHS=65535,ao.addDynamicAttributes=hn;const f_=new Ge({"symbol-placement":new de(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new de(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new de(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fe(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new de(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new de(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new de(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new de(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new de(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fe(Ce.layout_symbol["icon-size"]),"icon-text-fit":new de(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new de(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fe(Ce.layout_symbol["icon-image"]),"icon-rotate":new Fe(Ce.layout_symbol["icon-rotate"]),"icon-padding":new de(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new de(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Fe(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Fe(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new de(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new de(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new de(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Fe(Ce.layout_symbol["text-field"]),"text-font":new Fe(Ce.layout_symbol["text-font"]),"text-size":new Fe(Ce.layout_symbol["text-size"]),"text-max-width":new Fe(Ce.layout_symbol["text-max-width"]),"text-line-height":new Fe(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Fe(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Fe(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Fe(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new de(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Fe(Ce.layout_symbol["text-anchor"]),"text-max-angle":new de(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new de(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Fe(Ce.layout_symbol["text-rotate"]),"text-padding":new de(Ce.layout_symbol["text-padding"]),"text-keep-upright":new de(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Fe(Ce.layout_symbol["text-transform"]),"text-offset":new Fe(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new de(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new de(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new de(Ce.layout_symbol["text-optional"])});var ng={paint:new Ge({"icon-opacity":new Fe(Ce.paint_symbol["icon-opacity"]),"icon-color":new Fe(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Fe(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fe(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fe(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new de(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new de(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fe(Ce.paint_symbol["text-opacity"]),"text-color":new Fe(Ce.paint_symbol["text-color"],{runtimeType:qn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Fe(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Fe(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Fe(Ce.paint_symbol["text-halo-blur"]),"text-translate":new de(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new de(Ce.paint_symbol["text-translate-anchor"])}),layout:f_};class ep{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Wa,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt("FormatSectionOverride",ep,{omit:["defaultValue"]});class oa extends Ia{constructor(i){super(i,ng)}recalculate(i,l){super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const x of u)f.indexOf(x)<0&&f.push(x);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,l,u,f){const x=this.layout.get(i).evaluate(l,{},u,f),b=this._unevaluatedLayout._values[i];return b.isDataDriven()||Dr(b.value)||!x?x:(M=l.properties,x.replace(/{([^{}]+)}/g,(F,N)=>N in M?String(M[N]):""));var M}createBucket(i){return new ao(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of ng.paint.overridableProperties){if(!oa.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),u=new ep(l),f=new Th(u,l.property.specification);let x=null;x="constant"===l.value.kind||"source"===l.value.kind?new Ih("source",f):new Ya("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new ve(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&oa.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const u=i.get("text-field"),f=ng.paint.properties[l];let x=!1;const b=M=>{for(const P of M)if(f.overrides&&f.overrides.hasOverride(P))return void(x=!0)};if("constant"===u.value.kind&&u.value.value instanceof di)b(u.value.value.sections);else if("source"===u.value.kind){const M=F=>{x||(F instanceof Ai&&yi(F.value)===$t?b(F.value.sections):F instanceof wu?b(F.sections):F.eachChild(M))},P=u.value;P._styleExpression&&M(P._styleExpression.expression)}return x}getProgramConfiguration(i){return new Ta(this,i)}}var rg={paint:new Ge({"background-color":new de(Ce.paint_background["background-color"]),"background-pattern":new nt(Ce.paint_background["background-pattern"]),"background-opacity":new de(Ce.paint_background["background-opacity"])})},p_={paint:new Ge({"raster-opacity":new de(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new de(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new de(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new de(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new de(Ce.paint_raster["raster-saturation"]),"raster-contrast":new de(Ce.paint_raster["raster-contrast"]),"raster-resampling":new de(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new de(Ce.paint_raster["raster-fade-duration"])})};class ig extends Ia{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var h2={paint:new Ge({"sky-type":new de(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new de(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new de(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new de(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new de(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Pe(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new de(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new de(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new de(Ce.paint_sky["sky-opacity"])})};function tp(a,i,l){const u=jh(0,0,1),f=If($h());return function(x,b,M){M*=.5;var P=b[0],F=b[1],N=b[2],V=b[3],j=Math.sin(M),q=Math.cos(M);x[0]=P*q-N*j,x[1]=F*q+V*j,x[2]=N*q+P*j,x[3]=V*q-F*j}(f,f,l?-$n(a)+Math.PI:$n(a)),Wu(f,f,-$n(i)),ym(u,u,f),Bv(u,u)}const d2={circle:class extends Ia{constructor(a){super(a,Df)}createBucket(a){return new gm(a)}queryRadius(a){const i=a;return Hu("circle-radius",this,i)+Hu("circle-stroke-width",this,i)+tA(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,l,u,f,x,b,M){const P=qu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),F=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return R0(a,u,x,b,M,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),P,F)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Ta(this,a)}},heatmap:class extends Ia{createBucket(a){return new xm(a)}constructor(a){super(a,jv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Hu("heatmap-radius",this,a)}queryIntersectsFeature(a,i,l,u,f,x,b,M){const P=this.paint.get("heatmap-radius").evaluate(i,l);return R0(a,u,x,b,M,!0,!0,new ut(0,0),P)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Ta(this,a)}},hillshade:class extends Ia{constructor(a){super(a,Gv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(a){return new Ta(this,a)}},fill:class extends Ia{constructor(a){super(a,Nr)}getProgramIds(){const a=this.paint.get("fill-pattern"),i=a&&a.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Ta(this,a)}recalculate(a,i){super.recalculate(a,i);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new cA(a)}queryRadius(){return tA(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,l,u,f,x){return!a.queryGeometry.isAboveHorizon&&Ef(Lv(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Ia{constructor(a){super(a,Pm)}createBucket(a){return new oo(a)}queryRadius(){return tA(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Ta(this,a)}queryIntersectsFeature(a,i,l,u,f,x,b,M,P){const F=qu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(i,l),V=this.paint.get("fill-extrusion-base").evaluate(i,l),j=[0,0],q=M&&x.elevation,re=x.elevation?x.elevation.exaggeration():1;if(q){const xe=a.tile.getBucket(this).centroidVertexArray,Me=P+1;if(Me<xe.length){const Le=xe.get(Me);j[0]=Le.a_centroid_pos0,j[1]=Le.a_centroid_pos1}}if(0===j[0]&&1===j[1])return!1;const oe=(xe=u,Me=V,Le=N,Be=F,Ne=b,(Ue=q?M:null)?function(pt,et,it,yt,rt,Yt,St,er,Kt){const Dn=[],Ut=[],en=[0,0,0,1];for(const On of pt){const Di=[],jr=[];for(const Oi of On){const Li=Oi.x+yt.x,Gr=Oi.y+yt.y,ur=n1(Li,Gr,et,it,Yt,St,er,Kt);en[0]=Li,en[1]=Gr,en[2]=ur.base,en[3]=1,iA(en,en,rt),en[3]=Math.max(en[3],1e-5);const hr=Rm([en[0]/en[3],en[1]/en[3],en[2]/en[3]]);en[0]=Li,en[1]=Gr,en[2]=ur.top,en[3]=1,iA(en,en,rt),en[3]=Math.max(en[3],1e-5);const Bi=Rm([en[0]/en[3],en[1]/en[3],en[2]/en[3]]);Di.push(hr),jr.push(Bi)}Dn.push(Di),Ut.push(jr)}return[Dn,Ut]}(xe,Me,Le,Be,Ne,Ue,j,re,x.center.lat):function(pt,et,it,yt,rt){const Yt=[],St=[],er=rt[8]*et,Kt=rt[9]*et,Dn=rt[10]*et,Ut=rt[11]*et,en=rt[8]*it,On=rt[9]*it,Di=rt[10]*it,jr=rt[11]*it;for(const Oi of pt){const Li=[],Gr=[];for(const ur of Oi){const hr=ur.x+yt.x,Bi=ur.y+yt.y,Zr=rt[0]*hr+rt[4]*Bi+rt[12],Ni=rt[1]*hr+rt[5]*Bi+rt[13],Si=rt[2]*hr+rt[6]*Bi+rt[14],dr=rt[3]*hr+rt[7]*Bi+rt[15],Kr=Zr+er,Mr=Ni+Kt,Tr=Si+Dn,Jr=Math.max(dr+Ut,1e-5),Uo=Zr+en,ei=Ni+On,ti=Si+Di,Vn=Math.max(dr+jr,1e-5),zi=new ut(Kr/Jr,Mr/Jr);zi.z=Tr/Jr,Li.push(zi);const os=new ut(Uo/Vn,ei/Vn);os.z=ti/Vn,Gr.push(os)}Yt.push(Li),St.push(Gr)}return[Yt,St]}(xe,Me,Le,Be,Ne)),Ae=a.queryGeometry;var xe,Me,Le,Be,Ne,Ue;return function(xe,Me,Le){let Be=1/0;Ef(Le,Me)&&(Be=$0(Le,Me[0]));for(let Ne=0;Ne<Me.length;Ne++){const Ue=Me[Ne],Ze=xe[Ne];for(let ot=0;ot<Ue.length-1;ot++){const At=Ue[ot],pt=[At,Ue[ot+1],Ze[ot+1],Ze[ot],At];Cf(Le,pt)&&(Be=Math.min(Be,$0(Le,pt)))}}return Be!==1/0&&Be}(oe[0],oe[1],Ae.isPointQuery()?Ae.screenBounds:Ae.screenGeometry)}},line:class extends Ia{constructor(a){super(a,Om),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof ji,this.gradientVersion=(this.gradientVersion+1)%ps}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=Z0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new zf(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Ta(this,a)}queryRadius(a){const i=a,l=a1(Hu("line-width",this,i),Hu("line-gap-width",this,i)),u=Hu("line-offset",this,i);return l/2+Math.abs(u)+tA(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,l,u,f,x){if(a.queryGeometry.isAboveHorizon)return!1;const b=Lv(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,a.pixelToTileUnitsFactor),M=a.pixelToTileUnitsFactor/2*a1(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),P=this.paint.get("line-offset").evaluate(i,l);return P&&(u=function(F,N){const V=[],j=new ut(0,0);for(let q=0;q<F.length;q++){const re=F[q],oe=[];for(let Ae=0;Ae<re.length;Ae++){const xe=re[Ae-1],Me=re[Ae],Le=re[Ae+1],Be=0===Ae?j:Me.sub(xe)._unit()._perp(),Ne=Ae===re.length-1?j:Le.sub(Me)._unit()._perp(),Ue=Be._add(Ne)._unit();Ue._mult(1/(Ue.x*Ne.x+Ue.y*Ne.y)),oe.push(Ue._mult(N)._add(Me))}V.push(oe)}return V}(u,P*a.pixelToTileUnitsFactor)),function(F,N,V){for(let j=0;j<N.length;j++){const q=N[j];if(F.length>=3)for(let re=0;re<q.length;re++)if(ra(F,q[re]))return!0;if(eA(F,q,V))return!0}return!1}(b,u,M)}isTileClipped(){return!0}},symbol:oa,background:class extends Ia{constructor(a){super(a,rg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ia{constructor(a){super(a,p_)}getProgramIds(){return["raster"]}},sky:class extends Ia{constructor(a){super(a,h2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}}getCenter(a,i){const l=this.paint.get("sky-type");if("atmosphere"===l){const u=this.paint.get("sky-atmosphere-sun"),f=!u,x=a.style.light,b=x.properties.get("position");return f&&"viewport"===x.properties.get("anchor")&&zr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?tp(b.azimuthal,90-b.polar,i):tp(u[0],90-u[1],i)}if("gradient"===l){const u=this.paint.get("sky-gradient-center");return tp(u[0],90-u[1],i)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}},{HTMLImageElement:ol,HTMLCanvasElement:xA,HTMLVideoElement:bA,ImageData:np,ImageBitmap:og}=wt;class rp{constructor(i,l,u,f){this.context=i,this.format=u,this.texture=i.gl.createTexture(),this.update(l,f)}update(i,l,u){const{width:f,height:x}=i,b=!(this.size&&this.size[0]===f&&this.size[1]===x||u),{context:M}=this,{gl:P}=M;if(this.useMipmap=Boolean(l&&l.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!l||!1!==l.premultiply)),b)this.size=[f,x],i instanceof ol||i instanceof xA||i instanceof bA||i instanceof np||og&&i instanceof og?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,i):P.texImage2D(P.TEXTURE_2D,0,this.format,f,x,0,this.format,P.UNSIGNED_BYTE,i.data);else{const{x:F,y:N}=u||{x:0,y:0};i instanceof ol||i instanceof xA||i instanceof bA||i instanceof np||og&&i instanceof og?P.texSubImage2D(P.TEXTURE_2D,0,F,N,P.RGBA,P.UNSIGNED_BYTE,i):P.texSubImage2D(P.TEXTURE_2D,0,F,N,f,x,P.RGBA,P.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(i,l,u){const{context:f}=this,{gl:x}=f;x.bindTexture(x.TEXTURE_2D,this.texture),u!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=x.LINEAR),i!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,u||i),this.filter=i),l!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Gc{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Yr?new Yr(i.lng,i.lat):Yr.convert(i),this}setSouthWest(i){return this._sw=i instanceof Yr?new Yr(i.lng,i.lat):Yr.convert(i),this}extend(i){const l=this._sw,u=this._ne;let f,x;if(i instanceof Yr)f=i,x=i;else{if(!(i instanceof Gc))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Gc.convert(i)):this.extend(Yr.convert(i)):this;if(f=i._sw,x=i._ne,!f||!x)return this}return l||u?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),u.lng=Math.max(x.lng,u.lng),u.lat=Math.max(x.lat,u.lat)):(this._sw=new Yr(f.lng,f.lat),this._ne=new Yr(x.lng,x.lat)),this}getCenter(){return new Yr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Yr(this.getWest(),this.getNorth())}getSouthEast(){return new Yr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:u}=Yr.convert(i);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(i){return!i||i instanceof Gc?i:new Gc(i)}}const v1=6371008.8;class Yr{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yr(Va(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,u=this.lat*l,f=i.lat*l,x=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((i.lng-this.lng)*l);return v1*Math.acos(Math.min(x,1))}toBounds(i=0){const l=360*i/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new Gc(new Yr(this.lng-u,this.lat-l),new Yr(this.lng+u,this.lat+l))}static convert(i){if(i instanceof Yr)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Yr(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Yr(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const x1=2*Math.PI*v1;function sg(a){return x1*Math.cos(a*Math.PI/180)}function ag(a){return(180+a)/360}function m_(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function wA(a,i){return a/sg(i)}function lg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function g_(a,i){return a*sg(lg(i))}class CA{constructor(i,l,u=0){this.x=+i,this.y=+l,this.z=+u}static fromLngLat(i,l=0){const u=Yr.convert(i);return new CA(ag(u.lng),m_(u.lat),wA(l,u.lat))}toLngLat(){return new Yr(360*this.x-180,lg(this.y))}toAltitude(){return g_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/x1*(i=lg(this.y),1/Math.cos(i*Math.PI/180));var i}}class __{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new Lc({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const u=this.getKey(i,l);return this.positions[u]}trim(){const i=this.width,l=this.height=vl(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,u){const f=[];let x=i.length%2==1?-i[i.length-1]*u:0,b=i[0]*u,M=!0;f.push({left:x,right:b,isDash:M,zeroLength:0===i[0]});let P=i[0];for(let F=1;F<i.length;F++){M=!M;const N=i[F];x=P*u,P+=N,b=P*u,f.push({left:x,right:b,isDash:M,zeroLength:0===N})}return f}addRoundDash(i,l,u){const f=l/2;for(let x=-u;x<=u;x++){const b=this.width*(this.nextRow+u+x);let M=0,P=i[M];for(let F=0;F<this.width;F++){F/P.right>1&&(P=i[++M]);const N=Math.abs(F-P.left),V=Math.abs(F-P.right),j=Math.min(N,V);let q;const re=x/u*(f+1);if(P.isDash){const oe=f-Math.abs(re);q=Math.sqrt(j*j+oe*oe)}else q=f-Math.sqrt(j*j+re*re);this.image.data[b+F]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(i,l){for(let P=i.length-1;P>=0;--P){const F=i[P],N=i[P+1];F.zeroLength?i.splice(P,1):N&&N.isDash===F.isDash&&(N.left=F.left,i.splice(P,1))}const u=i[0],f=i[i.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const x=this.width*this.nextRow;let b=0,M=i[b];for(let P=0;P<this.width;P++){P/M.right>1&&(M=i[++b]);const F=Math.abs(P-M.left),N=Math.abs(P-M.right),V=Math.min(F,N);this.image.data[x+P]=Math.max(0,Math.min(255,(M.isDash?V:-V)+l+128))}}addDash(i,l){const u=this.getKey(i,l);if(this.positions[u])return this.positions[u];const f="round"===l,x=f?7:0,b=2*x+1;if(this.nextRow+b>this.height)return zr("LineAtlas out of space"),null;0===i.length&&i.push(1);let M=0;for(let N=0;N<i.length;N++)i[N]<0&&(zr("Negative value is found in line dasharray, replacing values with 0"),i[N]=0),M+=i[N];if(0!==M){const N=this.width/M,V=this.getDashRanges(i,this.width,N);f?this.addRoundDash(V,N,x):this.addRegularDash(V,"square"===l?.5*N:0)}const P=this.nextRow+x;this.nextRow+=b;const F={tl:[P,x],br:[M,0]};return this.positions[u]=F,F}}Pt("LineAtlas",__);class A2{constructor(i){this._callback=i,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const f2=wt.performance;function b1(a){const i=a?a.url.toString():void 0;return f2.getEntriesByName(i)}class p2{constructor(){this.tasks={},this.taskQueue=[],sc(["process"],this),this.invoker=new A2(this.process),this.nextId=0}add(i,l){const u=this.nextId++,f=function({type:x,isSymbolTile:b,zoom:M}){return M=M||0,"message"===x?0:"maybePrepare"!==x||b?"parseTile"!==x||b?"parseTile"===x&&b?300-M:"maybePrepare"===x&&b?400-M:500:200-M:100-M}(l);if(0===f){xl();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:i,metadata:l,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){xl();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const x=this.tasks[this.taskQueue[f]];x.priority<l&&(l=x.priority,i=f)}if(null===i)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}function w1(a,i,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,i*u-2*Math.PI*6378137/2]}class y_{constructor(i,l,u){this.z=i,this.x=l,this.y=u,this.key=th(0,i,i,l,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l){const u=(x=this.y,b=this.z,M=w1(256*(f=this.x),256*(x=Math.pow(2,b)-x-1),b),P=w1(256*(f+1),256*(x+1),b),M[0]+","+M[1]+","+P[0]+","+P[1]);var f,x,b,M,P;const F=function(N,V,j){let q,re="";for(let oe=N;oe>0;oe--)q=1<<oe-1,re+=(V&q?1:0)+(j&q?2:0);return re}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",u)}getTilePoint(i){const l=Math.pow(2,this.z);return new ut((i.x*l-this.x)*cr,(i.y*l-this.y)*cr)}getTileVec3(i){const l=Math.pow(2,this.z);return jh((i.x*l-this.x)*cr,(i.y*l-this.y)*cr,g_(i.z,i.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class C1{constructor(i,l){this.wrap=i,this.canonical=l,this.key=th(i,l.z,l.z,l.x,l.y)}}class pi{constructor(i,l,u,f,x){this.overscaledZ=i,this.wrap=l,this.canonical=new y_(u,+f,+x),this.key=0===l&&i===u?this.canonical.key:th(l,i,u,f,x)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new pi(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pi(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return th(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return th(this.wrap*+l,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new pi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new pi(l,this.wrap,l,u,f),new pi(l,this.wrap,l,u+1,f),new pi(l,this.wrap,l,u,f+1),new pi(l,this.wrap,l,u+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new pi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new pi(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new C1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new CA(i.x-this.wrap,i.y))}getTileVec3(i){return this.canonical.getTileVec3(new CA(i.x-this.wrap,i.y,i.z))}}function th(a,i,l,u,f){const x=1<<Math.min(l,22);let b=x*(f%x)+u%x;return a&&l<22&&(b+=x*x*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*b+l)+(i-l)}Pt("CanonicalTileID",y_),Pt("OverscaledTileID",pi,{omit:["projMatrix"]});class v_{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const u=i[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class cg{constructor(i,l,u,f,x){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=u,i._y=f,this.properties=i.properties,this.id=x}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(i[l]=this[l]);return i}}var ug=Mt([{name:"a_pos",type:"Int16",components:2}]);class hg{constructor(i,l,u){this.tileID=i,this.uid=gs(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const l=i+this.timeAdded;l<po.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(i,l,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,x){const b={};if(!x)return b;for(const M of f){const P=M.layerIds.map(F=>x.getLayer(F)).filter(Boolean);if(0!==P.length){M.layers=P,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(F=>P.filter(N=>N.id===F)[0]));for(const F of P)b[F.id]=M}}return b}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const x=this.buckets[f];if(x instanceof ao){if(this.hasSymbolBuckets=!0,!u)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const x=this.buckets[f];if(x instanceof ao&&x.hasRTLText){this.hasRTLText=!0,J.isLoading()||J.isLoaded()||"deferred"!==H()||Q();break}}this.queryPadding=0;for(const f in this.buckets){const x=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(x))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new kc}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(i)}const l=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rp(i,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rp(i,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new rp(i,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,l,u,f,x,b,M,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:M,transform:b,params:x},i,l,u):{}}querySourceFeatures(i,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),x=l?l.sourceLayer:"",b=f._geojsonTileLayer||f[x];if(!b)return;const M=Pu(l&&l.filter),{z:P,x:F,y:N}=this.tileID.canonical,V={z:P,x:F,y:N};for(let j=0;j<b.length;j++){const q=b.feature(j);if(M.needGeometry){const Ae=$u(q,!0);if(!M.filter(new te(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!M.filter(new te(this.tileID.overscaledZ),q))continue;const re=u.getId(q,x),oe=new cg(q,P,F,N,re);oe.tile=V,i.push(oe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const u=Ga(i.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const x=this.expirationTime-l;x?this.expirationTime=u+Math.max(x,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length)return;const u=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!l.style.hasLayer(f))continue;const x=this.buckets[f],b=x.layers[0].sourceLayer||"_geojsonTileLayer",M=u[b],P=i[b];if(!M||!P||0===Object.keys(P).length)continue;x.update(P,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=l&&l.style&&l.style.getLayer(f);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<po.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=po.now()+i}setDependencies(i,l){const u={};for(const f of l)u[f]=!0;this.dependencies[i]=u}hasDependency(i,l){for(const u of i){const f=this.dependencies[u];if(f)for(const x of l)if(f[x])return!0}return!1}clearQueryDebugViz(){}}class dg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,u){const f=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},hi(this.stateChanges[i][f],u),null===this.deletedStates[i]){this.deletedStates[i]={};for(const x in this.state[i])x!==f&&(this.deletedStates[i][x]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][f]){this.deletedStates[i][f]={};for(const x in this.state[i][f])u[x]||(this.deletedStates[i][f][x]=null)}else for(const x in u)this.deletedStates[i]&&this.deletedStates[i][f]&&null===this.deletedStates[i][f][x]&&delete this.deletedStates[i][f][x]}removeFeatureState(i,l,u){if(null===this.deletedStates[i])return;const f=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},u&&void 0!==l)null!==this.deletedStates[i][f]&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][u]=null);else if(void 0!==l)if(this.stateChanges[i]&&this.stateChanges[i][f])for(u in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][u]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,l){const u=String(l),f=hi({},(this.state[i]||{})[u],(this.stateChanges[i]||{})[u]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const x=this.deletedStates[i][l];if(null===x)return{};for(const b in x)delete f[b]}return f}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const x={};for(const b in this.stateChanges[f])this.state[f][b]||(this.state[f][b]={}),hi(this.state[f][b],this.stateChanges[f][b]),x[b]=this.state[f][b];u[f]=x}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const x={};if(null===this.deletedStates[f])for(const b in this.state[f])x[b]={},this.state[f][b]={};else for(const b in this.deletedStates[f]){if(null===this.deletedStates[f][b])this.state[f][b]={};else for(const M of Object.keys(this.deletedStates[f][b]))delete this.state[f][b][M];x[b]=this.state[f][b]}u[f]=u[f]||{},hi(u[f],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const f in i)i[f].setFeatureState(u,l)}}class x_{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const u=this.toIdx(i,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function Gl(a,i,l,u){let f=0,x=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(u[b])<1e-15){if(l[b]<a[b]||l[b]>i[b])return null}else{const M=1/u[b];let P=(a[b]-l[b])*M,F=(i[b]-l[b])*M;if(P>F){const N=P;P=F,F=N}if(P>f&&(f=P),F<x&&(x=F),f>x)return null}return f}function Ag(a,i,l,u,f,x,b,M,P,F,N){const V=u-a,j=f-i,q=x-l,re=b-a,oe=M-i,Ae=P-l,xe=N[1]*Ae-N[2]*oe,Me=N[2]*re-N[0]*Ae,Le=N[0]*oe-N[1]*re,Be=V*xe+j*Me+q*Le;if(Math.abs(Be)<1e-15)return null;const Ne=1/Be,Ue=F[0]-a,Ze=F[1]-i,ot=F[2]-l,At=(Ue*xe+Ze*Me+ot*Le)*Ne;if(At<0||At>1)return null;const pt=Ze*q-ot*j,et=ot*V-Ue*q,it=Ue*j-Ze*V,yt=(N[0]*pt+N[1]*et+N[2]*it)*Ne;return yt<0||At+yt>1?null:(re*pt+oe*et+Ae*it)*Ne}function b_(a,i,l){return(a-i)/(l-i)}function E1(a,i,l,u,f,x,b,M,P){const F=1<<l,N=x-u,V=b-f,j=(a+1)/F*N+u,q=(i+0)/F*V+f,re=(i+1)/F*V+f;M[0]=(a+0)/F*N+u,M[1]=q,P[0]=j,P[1]=re}class ip{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(x){const b=Math.ceil(Math.log2(x.dim/8)),M=[];let P=Math.ceil(Math.pow(2,b));const F=1/P,N=(q,re,oe,Ae,xe)=>{const Me=Ae?1:0,Le=(q+1)*oe-Me,Be=re*oe,Ne=(re+1)*oe-Me;xe[0]=q*oe,xe[1]=Be,xe[2]=Le,xe[3]=Ne};let V=new x_(P);const j=[];for(let q=0;q<P*P;q++){N(q%P,Math.floor(q/P),F,!1,j);const re=$l(j[0],j[1],x),oe=$l(j[2],j[1],x),Ae=$l(j[2],j[3],x),xe=$l(j[0],j[3],x);V.minimums.push(Math.min(re,oe,Ae,xe)),V.maximums.push(Math.max(re,oe,Ae,xe)),V.leaves.push(1)}for(M.push(V),P/=2;P>=1;P/=2){const q=M[M.length-1];V=new x_(P);for(let re=0;re<P*P;re++){N(re%P,Math.floor(re/P),2,!0,j);const oe=q.getElevation(j[0],j[1]),Ae=q.getElevation(j[2],j[1]),xe=q.getElevation(j[2],j[3]),Me=q.getElevation(j[0],j[3]),Le=q.isLeaf(j[0],j[1]),Be=q.isLeaf(j[2],j[1]),Ne=q.isLeaf(j[2],j[3]),Ue=q.isLeaf(j[0],j[3]),Ze=Math.min(oe.min,Ae.min,xe.min,Me.min),ot=Math.max(oe.max,Ae.max,xe.max,Me.max),At=Le&&Be&&Ne&&Ue;V.maximums.push(ot),V.minimums.push(Ze),V.leaves.push(ot-Ze<=5&&At?1:0)}M.push(V)}return M}(this.dem),u=l.length-1,f=l[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(i,l,u,f,x,b,M=1){return Gl([i,l,-100],[u,f,this.maximums[0]*M],x,b)}raycast(i,l,u,f,x,b,M=1){if(!this.nodeCount)return null;const P=this.raycastRoot(i,l,u,f,x,b,M);if(null==P)return null;const F=[],N=[],V=[],j=[],q=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;q.length>0;){const{idx:re,t:oe,nodex:Ae,nodey:xe,depth:Me}=q.pop();if(this.leaves[re]){E1(Ae,xe,Me,i,l,u,f,V,j);const Be=1<<Me,Ne=(Ae+0)/Be,Ue=(Ae+1)/Be,Ze=(xe+0)/Be,ot=(xe+1)/Be,At=$l(Ne,Ze,this.dem)*M,pt=$l(Ue,Ze,this.dem)*M,et=$l(Ue,ot,this.dem)*M,it=$l(Ne,ot,this.dem)*M,yt=Ag(V[0],V[1],At,j[0],V[1],pt,j[0],j[1],et,x,b),rt=Ag(j[0],j[1],et,V[0],j[1],it,V[0],V[1],At,x,b),Yt=Math.min(null!==yt?yt:Number.MAX_VALUE,null!==rt?rt:Number.MAX_VALUE);if(Yt!==Number.MAX_VALUE)return Yt;{const St=P0([],x,b,oe);if(w_(At,pt,it,et,b_(St[0],V[0],j[0]),b_(St[1],V[1],j[1]))>=St[2])return oe}continue}let Le=0;for(let Be=0;Be<this._siblingOffset.length;Be++){E1((Ae<<1)+this._siblingOffset[Be][0],(xe<<1)+this._siblingOffset[Be][1],Me+1,i,l,u,f,V,j),V[2]=-100,j[2]=this.maximums[this.childOffsets[re]+Be]*M;const Ne=Gl(V,j,x,b);if(null!=Ne){const Ue=Ne;F[Be]=Ue;let Ze=!1;for(let ot=0;ot<Le&&!Ze;ot++)Ue>=F[N[ot]]&&(N.splice(ot,0,Be),Ze=!0);Ze||(N[Le]=Be),Le++}}for(let Be=0;Be<Le;Be++){const Ne=N[Be];q.push({idx:this.childOffsets[re]+Ne,t:F[Ne],nodex:(Ae<<1)+this._siblingOffset[Ne][0],nodey:(xe<<1)+this._siblingOffset[Ne][1],depth:Me+1})}}return null}_addNode(i,l,u){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,u,f,x){if(1===i[f].isLeaf(l,u))return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const b=f-1,M=i[b];let P,F=0;for(let N=0;N<this._siblingOffset.length;N++){const V=2*l+this._siblingOffset[N][0],j=2*u+this._siblingOffset[N][1],q=M.getElevation(V,j),re=M.isLeaf(V,j),oe=this._addNode(q.min,q.max,re);re&&(F|=1<<N),P||(P=oe)}for(let N=0;N<this._siblingOffset.length;N++)F&1<<N||this._construct(i,2*l+this._siblingOffset[N][0],2*u+this._siblingOffset[N][1],b,P+N)}}function w_(a,i,l,u,f,x){return ht(ht(a,l,x),ht(i,u,x),f)}function $l(a,i,l){const u=l.dim,f=ui(a*u-.5,0,u-1),x=ui(i*u-.5,0,u-1),b=Math.floor(f),M=Math.floor(x),P=Math.min(b+1,u-1),F=Math.min(M+1,u-1);return w_(l.get(b,M),l.get(P,M),l.get(b,F),l.get(P,F),f-b,x-M)}const C_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class op{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,u,f=!1,x=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return zr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2;if(this.data=new Uint32Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let M=0;M<b;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(b,M)]=this.data[this._idx(b-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,b)]=this.data[this._idx(M,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ip(this)}get(i,l,u=!1){const f=new Uint8Array(this.data.buffer);u&&(i=ui(i,-1,this.dim),l=ui(l,-1,this.dim));const x=4*this._idx(i,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(f[x],f[x+1],f[x+2])}static getUnpackVector(i){return C_[i]}get unpackVector(){return C_[this.encoding]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,u){return(256*i*256+256*l+u)/10-1e4}_unpackTerrarium(i,l,u){return 256*i+l+u/256-32768}static pack(i,l){const u=[0,0,0,0],f=op.getUnpackVector(l);let x=Math.floor((i+f[3])/f[2]);return u[2]=x%256,x=Math.floor(x/256),u[1]=x%256,x=Math.floor(x/256),u[0]=x,u}getPixels(){return new Ms({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,x=l*this.dim+this.dim,b=u*this.dim,M=u*this.dim+this.dim;switch(l){case-1:f=x-1;break;case 1:x=f+1}switch(u){case-1:b=M-1;break;case 1:M=b+1}const P=-l*this.dim,F=-u*this.dim;for(let N=b;N<M;N++)for(let V=f;V<x;V++)this.data[this._idx(V,N)]=i.data[this._idx(V+P,N+F)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Pt("DEMData",op),Pt("DemMinMaxQuadTree",ip,{omit:["dem"]});class EA{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,u){const f=i.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const x={value:l,timeout:void 0};if(void 0!==u&&(x.timeout=setTimeout(()=>{this.remove(i,x)},u)),this.data[f].push(x),this.order.push(f),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const u=i.wrapped().key,f=void 0===l?0:this.data[u].indexOf(l),x=this.data[u][f];return this.data[u].splice(f,1),x.timeout&&clearTimeout(x.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(x.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const u in this.data)for(const f of this.data[u])i(f.value)||l.push(f);for(const u of l)this.remove(u.value.tileID,u)}}class Ra{constructor(i,l,u){this.func=i,this.mask=l,this.range=u}}Ra.ReadOnly=!1,Ra.ReadWrite=!0,Ra.disabled=new Ra(519,Ra.ReadOnly,[0,1]);class $c{constructor(i,l,u,f,x,b){this.test=i,this.ref=l,this.mask=u,this.fail=f,this.depthFail=x,this.pass=b}}$c.disabled=new $c({func:519,mask:0},0,0,7680,7680,7680);class is{constructor(i,l,u){this.blendFunction=i,this.blendColor=l,this.mask=u}}is.Replace=[1,0],is.disabled=new is(is.Replace,un.transparent,[!1,!1,!1,!1]),is.unblended=new is(is.Replace,un.transparent,[!0,!0,!0,!0]),is.alphaBlended=new is([1,771],un.transparent,[!0,!0,!0,!0]);class sa{constructor(i,l,u){this.enable=i,this.mode=l,this.frontFace=u}}sa.disabled=new sa(!1,1029,2305),sa.backCCW=new sa(!0,1029,2305),sa.backCW=new sa(!0,1029,2304),sa.frontCW=new sa(!0,1028,2304),sa.frontCCW=new sa(!0,1028,2305);class qc extends jt{constructor(i,l,u){super(),this.id=i,this._onlySymbols=u,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new EA(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new dg}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(i),u.prepare(this.map.style.imageManager)}}getIds(){return Gn(this._tiles).map(i=>i.tileID).sort(sp).map(i=>i.key)}getRenderableIds(i){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,i)&&l.push(this._tiles[u]);return i?l.sort((u,f)=>{const x=u.tileID,b=f.tileID,M=new ut(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),P=new ut(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-b.overscaledZ||P.y-M.y||P.x-M.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(sp).map(u=>u.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const u=this._tiles[i];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,i,l)))}_tileLoaded(i,l,u,f){if(f)return i.state="errored",void(404!==f.status?this._source.fire(new Xe(f,{tile:i})):this.update(this.transform));i.timeAdded=po.now(),"expired"===u&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),"raster-dem"===this.getSource().type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new ft("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const x=l[f];if(i.neighboringTiles&&i.neighboringTiles[x]){const b=this.getTileByID(x);u(i,b),u(b,i)}}function u(f,x){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let b=x.tileID.canonical.x-f.tileID.canonical.x;const M=x.tileID.canonical.y-f.tileID.canonical.y,P=Math.pow(2,f.tileID.canonical.z),F=x.tileID.key;0===b&&0===M||Math.abs(M)>1||(Math.abs(b)>1&&(1===Math.abs(b+P)?b+=P:1===Math.abs(b-P)&&(b-=P)),x.dem&&f.dem&&(f.dem.backfillBorder(x.dem,b,M),f.neighboringTiles&&f.neighboringTiles[F]&&(f.neighboringTiles[F].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,u,f){for(const x in this._tiles){let b=this._tiles[x];if(f[x]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>u)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const F=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[F.key],b&&b.hasData()&&(M=F)}let P=M;for(;P.overscaledZ>l;)if(P=P.scaledTo(P.overscaledZ-1),i[P.key]){f[M.key]=M;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const u=this._loadedParentTiles[i.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=i.overscaledZ-1;u>=l;u--){const f=i.scaledTo(u),x=this._getLoadedTile(f);if(x)return x}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const u=Math.ceil(i.width/l)+1,f=Math.ceil(i.height/l)+1,x=Math.floor(u*f*5),b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(b)}handleWrapJump(i){const l=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,l){const u={};for(const f in this._tiles){const x=this._tiles[f];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),u[x.tileID.key]=x}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(i,l,u){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(i,l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new pi(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(f=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(M=>this._source.hasTile(M)))):f=[];const x=this._updateRetainedTiles(f);if(ap(this._source.type)&&0!==f.length){const M={},P={},F=Object.keys(x);for(const V of F){const j=x[V],q=this._tiles[V];if(!q||q.fadeEndTime&&q.fadeEndTime<=po.now())continue;const re=this.findLoadedParent(j,Math.max(j.overscaledZ-qc.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),M[re.tileID.key]=re.tileID),P[V]=j}const N=f[f.length-1].overscaledZ;for(const V in this._tiles){const j=this._tiles[V];if(x[V]||!j.hasData())continue;let q=j.tileID;for(;q.overscaledZ>N;){q=q.scaledTo(q.overscaledZ-1);const re=this._tiles[q.key];if(re&&re.hasData()&&P[q.key]){x[V]=j.tileID;break}}}for(const V in M)x[V]||(this._coveredTiles[V]=!0,x[V]=M[V])}for(const M in x)this._tiles[M].clearFadeHold();const b=function(M,P){const F=[];for(const N in M)N in P||F.push(N);return F}(this._tiles,x);for(const M of b){const P=this._tiles[M];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(0===i.length)return l;const u={},f=i[i.length-1].overscaledZ,x=i[0].overscaledZ,b=Math.max(x-qc.maxOverzooming,this._source.minzoom),M=Math.max(x+qc.maxUnderzooming,this._source.minzoom),P={};for(const F of i){const N=this._addTile(F);l[F.key]=F,N.hasData()||f<this._source.maxzoom&&(P[F.key]=F)}this._retainLoadedChildren(P,f,M,l);for(const F of i){let N=this._tiles[F.key];if(N.hasData())continue;if(F.canonical.z>=this._source.maxzoom){const j=F.children(this._source.maxzoom)[0],q=this.getTile(j);if(q&&q.hasData()){l[j.key]=j;continue}}else{const j=F.children(this._source.maxzoom);if(l[j[0].key]&&l[j[1].key]&&l[j[2].key]&&l[j[3].key])continue}let V=N.wasRequested();for(let j=F.overscaledZ-1;j>=b;--j){const q=F.scaledTo(j);if(u[q.key]||(u[q.key]=!0,N=this.getTile(q),!N&&V&&(N=this._addTile(q)),N&&(l[q.key]=q,V=N.wasRequested(),N.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let u,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}l.push(f.key);const x=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(x),u)break;f=x}for(const x of l)this._loadedParentTiles[x]=u}}_addTile(i){let l=this._tiles[i.key];if(l)return l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const u=Boolean(l);return u||(l=new hg(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))),l?(l.uses++,this._tiles[i.key]=l,u||this._source.fire(new ft("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const u=l.getExpiryTimeout();u&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},u))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._cache.reset()}tilesIn(i,l,u){const f=[],x=this.transform;if(!x)return f;for(const b in this._tiles){const M=this._tiles[b];if(u&&M.clearQueryDebugViz(),M.holdingForFade())continue;const P=i.containsTile(M,x,l);P&&f.push(P)}return f}getVisibleCoordinates(i){const l=this.getRenderableIds(i).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ap(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=po.now())return!0}return!1}setFeatureState(i,l,u){this._state.updateState(i=i||"_geojsonTileLayer",l,u)}removeFeatureState(i,l,u){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,u)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,u){const f=this._tiles[i];f&&f.setDependencies(l,u)}reloadTilesForDependencies(i,l){for(const u in this._tiles)this._tiles[u].hasDependency(i,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(i,l))}}function sp(a,i){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*i.wrap)-+(i.wrap<0);return a.overscaledZ-i.overscaledZ||u-l||i.canonical.y-a.canonical.y||i.canonical.x-a.canonical.x}function ap(a){return"raster"===a||"image"===a||"video"===a}qc.maxOverzooming=10,qc.maxUnderzooming=3;class SA{constructor(i,l,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(i,l,u){const f=u||i.findDEMTileFor(l);if(!f||!f.dem)return;const x=f.dem,b=f.tileID,M=1<<l.canonical.z-b.canonical.z;return new SA(f,f.tileSize/cr/M,[(l.canonical.x/M-b.canonical.x)*x.dim,(l.canonical.y/M-b.canonical.y)*x.dim])}tileCoordToPixel(i,l){const u=l*this._scale+this._offset[1],f=Math.floor(i*this._scale+this._offset[0]),x=Math.floor(u);return new ut(f,x)}getElevationAt(i,l,u,f){const x=i*this._scale+this._offset[0],b=l*this._scale+this._offset[1],M=Math.floor(x),P=Math.floor(b),F=this._dem;return f=!!f,u?ht(ht(F.get(M,P,f),F.get(M,P+1,f),b-P),ht(F.get(M+1,P,f),F.get(M+1,P+1,f),b-P),x-M):F.get(M,P,f)}getElevationAtPixel(i,l,u){return this._dem.get(i,l,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*wA(1,i)*this._dem.stride}}class MA{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Dc(cr,16,0),this.featureIndexArray=new Mv,this.promoteId=l}insert(i,l,u,f,x,b=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,x,b);const P=this.grid;for(let F=0;F<l.length;F++){const N=l[F],V=[1/0,1/0,-1/0,-1/0];for(let j=0;j<N.length;j++){const q=N[j];V[0]=Math.min(V[0],q.x),V[1]=Math.min(V[1],q.y),V[2]=Math.max(V[2],q.x),V[3]=Math.max(V[3],q.y)}V[0]<cr&&V[1]<cr&&V[2]>=0&&V[3]>=0&&P.insert(M,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ka.VectorTile(new AA(this.rawTileData)).layers,this.sourceLayerCoder=new v_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,u,f){this.loadVTLayers();const x=i.params||{},b=Pu(x.filter),M=i.tileResult,P=i.transform,F=M.bufferedTilespaceBounds,N=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,(re,oe,Ae,xe)=>Uh(M.bufferedTilespaceGeometry,re,oe,Ae,xe));N.sort(D_);let V=null;P.elevation&&N.length>0&&(V=SA.create(P.elevation,this.tileID));const j={};let q;for(let re=0;re<N.length;re++){const oe=N[re];if(oe===q)continue;q=oe;const Ae=this.featureIndexArray.get(oe);let xe=null;this.loadMatchingFeature(j,Ae,b,x.layers,x.availableImages,l,u,f,(Me,Le,Be,Ne=0)=>(xe||(xe=na(Me)),Le.queryIntersectsFeature(M,Me,Be,xe,this.z,i.transform,i.pixelPosMatrix,V,Ne)))}return j}loadMatchingFeature(i,l,u,f,x,b,M,P,F){const{featureIndex:N,bucketIndex:V,sourceLayerIndex:j,layoutVertexArrayOffset:q}=l,re=this.bucketLayerIDs[V];if(f&&!function(Me,Le){for(let Be=0;Be<Me.length;Be++)if(Le.indexOf(Me[Be])>=0)return!0;return!1}(f,re))return;const oe=this.sourceLayerCoder.decode(j),Ae=this.vtLayers[oe].feature(N);if(u.needGeometry){const Me=$u(Ae,!0);if(!u.filter(new te(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!u.filter(new te(this.tileID.overscaledZ),Ae))return;const xe=this.getId(Ae,oe);for(let Me=0;Me<re.length;Me++){const Le=re[Me];if(f&&f.indexOf(Le)<0)continue;const Be=b[Le];if(!Be)continue;let Ne={};void 0!==xe&&P&&(Ne=P.getState(Be.sourceLayer||"_geojsonTileLayer",xe));const Ue=hi({},M[Le]);Ue.paint=E_(Ue.paint,Be.paint,Ae,Ne,x),Ue.layout=E_(Ue.layout,Be.layout,Ae,Ne,x);const Ze=!F||F(Ae,Be,Ne,q);if(!Ze)continue;const ot=new cg(Ae,this.z,this.x,this.y,xe);ot.layer=Ue;let At=i[Le];void 0===At&&(At=i[Le]=[]),At.push({featureIndex:N,feature:ot,intersectionZ:Ze})}}lookupSymbolFeatures(i,l,u,f,x,b,M,P){const F={};this.loadVTLayers();const N=Pu(x);for(const V of i)this.loadMatchingFeature(F,{bucketIndex:u,sourceLayerIndex:f,featureIndex:V,layoutVertexArrayOffset:0},N,b,M,P,l);return F}hasLayer(i){for(const l of this.bucketLayerIDs)for(const u of l)if(i===u)return!0;return!1}getId(i,l){let u=i.id;return this.promoteId&&(u=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof u&&(u=Number(u))),u}}function E_(a,i,l,u,f){return An(a,(x,b)=>{const M=i instanceof Se?i.get(b):null;return M&&M.evaluate?M.evaluate(l,u,f):M})}function D_(a,i){return i-a}Pt("FeatureIndex",MA,{omit:["rawTileData","sourceLayerCoder"]});class D1{constructor(i){const l={},u=[];for(const M in i){const P=i[M],F=l[M]={};for(const N in P.glyphs){const V=P.glyphs[+N];if(!V||0===V.bitmap.width||0===V.bitmap.height)continue;const j=V.metrics.localGlyph?2:1,q={x:0,y:0,w:V.bitmap.width+2*j,h:V.bitmap.height+2*j};u.push(q),F[N]=q}}const{w:f,h:x}=jf(u),b=new Lc({width:f||1,height:x||1});for(const M in i){const P=i[M];for(const F in P.glyphs){const N=P.glyphs[+F];if(!N||0===N.bitmap.width||0===N.bitmap.height)continue;const V=l[M][F],j=N.metrics.localGlyph?2:1;Lc.copy(N.bitmap,b,{x:0,y:0},{x:V.x+j,y:V.y+j},N.bitmap)}}this.image=b,this.positions=l}}Pt("GlyphAtlas",D1);class S_{constructor(i){this.tileID=new pi(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile}parse(i,l,u,f,x){this.status="parsing",this.data=i,this.collisionBoxArray=new kc;const b=new v_(Object.keys(i.layers).sort()),M=new MA(this.tileID,this.promoteId);M.bucketLayerIDs=[];const P={},F=new __(256,256),N={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:F,availableImages:u},V=l.familiesBySource[this.source];for(const Ne in V){const Ue=i.layers[Ne];if(!Ue)continue;let Ze=!1,ot=!1;for(const et of V[Ne])"symbol"===et[0].type?Ze=!0:ot=!0;if(!0===this.isSymbolTile&&!Ze||!1===this.isSymbolTile&&!ot)continue;1===Ue.version&&zr(`Vector tile source "${this.source}" layer "${Ne}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const At=b.encode(Ne),pt=[];for(let et=0;et<Ue.length;et++){const it=Ue.feature(et),yt=M.getId(it,Ne);pt.push({feature:it,id:yt,index:et,sourceLayerIndex:At})}for(const et of V[Ne]){const it=et[0];void 0!==this.isSymbolTile&&"symbol"===it.type!==this.isSymbolTile||it.minzoom&&this.zoom<Math.floor(it.minzoom)||it.maxzoom&&this.zoom>=it.maxzoom||"none"!==it.visibility&&(lp(et,this.zoom,u),(P[it.id]=it.createBucket({index:M.bucketLayerIDs.length,layers:et,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:At,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(pt,N,this.tileID.canonical),M.bucketLayerIDs.push(et.map(yt=>yt.id)))}}let j,q,re,oe;F.trim();const Ae={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xe=An(N.glyphDependencies,Ne=>Object.keys(Ne).map(Number));Object.keys(xe).length?f.send("getGlyphs",{uid:this.uid,stacks:xe},(Ne,Ue)=>{j||(j=Ne,q=Ue,Be.call(this))},void 0,!1,Ae):q={};const Me=Object.keys(N.iconDependencies);Me.length?f.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"icons"},(Ne,Ue)=>{j||(j=Ne,re=Ue,Be.call(this))},void 0,!1,Ae):re={};const Le=Object.keys(N.patternDependencies);function Be(){if(j)return x(j);if(q&&re&&oe){const Ne=new D1(q),Ue=new Gf(re,oe);for(const Ze in P){const ot=P[Ze];ot instanceof ao?(lp(ot.layers,this.zoom,u),m1(ot,q,Ne.positions,re,Ue.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):ot.hasPattern&&(ot instanceof zf||ot instanceof cA||ot instanceof oo)&&(lp(ot.layers,this.zoom,u),ot.addFeatures(N,this.tileID.canonical,Ue.patternPositions))}this.status="done",x(null,{buckets:Gn(P).filter(Ze=>!Ze.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ne.image,lineAtlas:F,imageAtlas:Ue,glyphMap:this.returnDependencies?q:null,iconMap:this.returnDependencies?re:null,glyphPositions:this.returnDependencies?Ne.positions:null})}}Le.length?f.send("getImages",{icons:Le,source:this.source,tileID:this.tileID,type:"patterns"},(Ne,Ue)=>{j||(j=Ne,oe=Ue,Be.call(this))},void 0,!1,Ae):oe={},Be.call(this)}}function lp(a,i,l){const u=new te(i);for(const f of a)f.recalculate(u,l)}class M_{constructor(i){this.entries={},this.scheduler=i}request(i,l,u,f){const x=this.entries[i]=this.entries[i]||{callbacks:[]};if(x.result){const[b,M]=x.result;return this.scheduler?this.scheduler.add(()=>{f(b,M)},l):f(b,M),()=>{}}return x.callbacks.push(f),x.cancel||(x.cancel=u((b,M)=>{x.result=[b,M];for(const P of x.callbacks)this.scheduler?this.scheduler.add(()=>{P(b,M)},l):P(b,M);setTimeout(()=>delete this.entries[i],3e3)})),()=>{x.result||(x.callbacks=x.callbacks.filter(b=>b!==f),x.callbacks.length||(x.cancel(),delete this.entries[i]))}}}function pg(a,i,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const x=Z(a.request,(b,M,P,F)=>{b?f(b):M&&f(null,{vectorTile:l?void 0:new ka.VectorTile(new AA(M)),rawData:M,cacheControl:P,expires:F})});return()=>{x.cancel(),f()}},i)}g.ARRAY_TYPE=Ei,g.AUTH_ERR_MSG=ga,g.Actor=class{constructor(a,i,l){this.target=a,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},sc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=xl()?a:wt,this.scheduler=new p2}send(a,i,l,u,f=!1,x){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[b]=l);const M=Au(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:a,hasCallback:!!l,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:tl(i,M)},M),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const i=a.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(i.mustQueue||xl()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,i),u&&u.metadata||{type:"message"})}else this.processTask(l,i)}processTask(a,i){if("<response>"===i.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(i.error?l(bi(i.error)):l(null,bi(i.data)))}else{const l=Au(this.globalScope)?void 0:[],u=i.hasCallback?(x,b)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:x?tl(x):null,data:tl(b,l)},l)}:x=>{},f=bi(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,u);else if(this.parent.getWorkerSource){const x=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,x[0],f.source)[x[1]](f,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},g.CanonicalTileID=y_,g.Color=un,g.ColorMode=is,g.CullFaceMode=sa,g.DEMData=op,g.DataConstantProperty=de,g.DedupedRequest=M_,g.DepthMode=Ra,g.EXTENT=cr,g.Elevation=class{getAtPointOrZero(a,i=0){return this.getAtPoint(a,i)||0}getAtPoint(a,i,l=!0){null==i&&(i=null);const u=this._source();if(!u||a.y<0||a.y>1)return i;const f=u.getSource().maxzoom,x=1<<f,b=Math.floor(a.x),M=a.x-b,P=new pi(f,b,f,Math.floor(M*x),Math.floor(a.y*x)),F=this.findDEMTileFor(P);if(!F||!F.dem)return i;const N=F.dem,V=1<<F.tileID.canonical.z,j=(M*V-F.tileID.canonical.x)*N.dim,q=(a.y*V-F.tileID.canonical.y)*N.dim,re=Math.floor(j),oe=Math.floor(q);return(l?this.exaggeration():1)*ht(ht(N.get(re,oe),N.get(re,oe+1),q-oe),ht(N.get(re+1,oe),N.get(re+1,oe+1),q-oe),j-re)}getAtTileOffset(a,i,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new CA(a.wrap+(a.canonical.x+i/cr)/u,(a.canonical.y+l/cr)/u))}getForTilePoints(a,i,l,u){const f=SA.create(this,a,u);return!!f&&(i.forEach(x=>{x[2]=this.exaggeration()*f.getElevationAt(x[0],x[1],l)}),!0)}getMinMaxForTile(a){const i=this.findDEMTileFor(a);if(!i||!i.dem)return null;const l=i.dem.tree,u=i.tileID,f=1<<a.canonical.z-u.canonical.z;let x=a.canonical.x/f-u.canonical.x,b=a.canonical.y/f-u.canonical.y,M=0;for(let P=0;P<a.canonical.z-u.canonical.z&&!l.leaves[M];P++){x*=2,b*=2;const F=2*Math.floor(b)+Math.floor(x);M=l.childOffsets[M]+F,x%=1,b%=1}return{min:this.exaggeration()*l.minimums[M],max:this.exaggeration()*l.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},g.ErrorEvent=Xe,g.EvaluationParameters=te,g.Event=ft,g.Evented=jt,g.GlyphManager=Ju,g.ImagePosition=$m,g.LineAtlas=__,g.LngLat=Yr,g.LngLatBounds=Gc,g.LocalGlyphMode=yA,g.MAX_SAFE_INTEGER=ps,g.MercatorCoordinate=CA,g.ONE_EM=24,g.OverscaledTileID=pi,g.Properties=Ge,g.RGBAImage=Ms,g.RequestManager=class{constructor(a,i,l){this._transformRequestFn=a,this._customAccessToken=i,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let i="";for(let l=0;l<10;l++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pu,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,i){return this._transformRequestFn&&this._transformRequestFn(a,i)||{url:a}}normalizeStyleURL(a,i){if(!pr(a))return a;const l=vs(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeGlyphsURL(a,i){if(!pr(a))return a;const l=vs(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeSourceURL(a,i){if(!pr(a))return a;const l=vs(a);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||i)}normalizeSpriteURL(a,i,l,u){const f=vs(a);return pr(a)?(f.path=`/styles/v1${f.path}/sprite${i}${l}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${i}${l}`,Zo(f))}normalizeTileURL(a,i,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!pr(a))return a;const u=vs(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||l&&"raster"!==u.authority&&512===l?"@2x":""}${$s.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${Xn.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${Xn.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(x){for(const b of x){const M=b.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||Xn.ACCESS_TOKEN;return Xn.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(a,i){const l=vs(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${Xn.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${Xn.TILE_URL_VERSION}/`,"")}`;let f=l.params;return i&&(f=f.filter(x=>!x.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(a,i){const l=!!i&&pr(i),u=[];for(const f of a.tiles||[])qa(f)?u.push(this.canonicalizeTileURL(f,l)):u.push(f);return u}_makeAPIURL(a,i){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=vs(Xn.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!Xn.REQUIRE_ACCESS_TOKEN)return Zo(a);if(i=i||Xn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${i||""}`),Zo(a)}},g.ResourceType=ya,g.SegmentVector=Fi,g.SourceCache=qc,g.StencilMode=$c,g.StructArrayLayout1ui2=Po,g.StructArrayLayout2f1f2i16=Ds,g.StructArrayLayout2i4=Jt,g.StructArrayLayout2ui4=ai,g.StructArrayLayout3f12=cn,g.StructArrayLayout3ui6=Tn,g.StructArrayLayout4i8=Ur,g.Texture=rp,g.Tile=hg,g.Transitionable=_e,g.Uniform1f=Ss,g.Uniform1i=class extends Hi{constructor(a,i){super(a,i),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},g.Uniform2f=class extends Hi{constructor(a,i){super(a,i),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},g.Uniform3f=class extends Hi{constructor(a,i){super(a,i),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},g.Uniform4f=Xd,g.UniformColor=Pc,g.UniformMatrix3f=class extends Hi{constructor(a,i){super(a,i),this.current=D0}set(a){for(let i=0;i<9;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},g.UniformMatrix4f=class extends Hi{constructor(a,i){super(a,i),this.current=Rc}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let i=1;i<16;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},g.UnwrappedTileID=C1,g.ValidationError=$e,g.VectorTileWorkerSource=class extends jt{constructor(a,i,l,u,f){super(),this.actor=a,this.layerIndex=i,this.availableImages=l,this.loadVectorData=f||pg,this.loading={},this.loaded={},this.deduped=new M_(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,i){const l=a.uid,u=a&&a.request,f=u&&u.collectResourceTiming,x=this.loading[l]=new S_(a);x.abort=this.loadVectorData(a,(b,M)=>{const P=!this.loading[l];if(delete this.loading[l],P||b||!M)return x.status="done",P||(this.loaded[l]=x),i(b);const F=M.rawData,N={};M.expires&&(N.expires=M.expires),M.cacheControl&&(N.cacheControl=M.cacheControl),x.vectorTile=M.vectorTile||new ka.VectorTile(new AA(F));const V=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,(j,q)=>{if(j||!q)return i(j);const re={};if(f){const oe=b1(u);oe.length>0&&(re.resourceTiming=JSON.parse(JSON.stringify(oe)))}i(null,hi({rawTileData:F.slice(0)},q,N,re))})};this.isSpriteLoaded?V():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):V()}),this.loaded=this.loaded||{},this.loaded[l]=x})}reloadTile(a,i){const l=this.loaded,u=a.uid,f=this;if(l&&l[u]){const x=l[u];x.showCollisionBoxes=a.showCollisionBoxes,x.enableTerrain=!!a.enableTerrain;const b=(M,P)=>{const F=x.reloadCallback;F&&(delete x.reloadCallback,x.parse(x.vectorTile,f.layerIndex,this.availableImages,f.actor,F)),i(M,P)};"parsing"===x.status?x.reloadCallback=b:"done"===x.status&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(a,i){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),i()}removeTile(a,i){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],i()}},g.WritingMode=ks,g.ZoomHistory=Es,g.add=function(a,i,l){return a[0]=i[0]+l[0],a[1]=i[1]+l[1],a[2]=i[2]+l[2],a},g.addDynamicAttributes=hn,g.altitudeFromMercatorZ=g_,g.asyncAll=du,g.bezier=za,g.bindAll=sc,g.bufferConvexPolygon=function(a,i){const l=[];for(let u=0;u<a.length;u++){const f=Va(u-1,-1,a.length-1),x=Va(u+1,-1,a.length-1),b=a[u],M=a[x],P=a[f].sub(b).unit(),F=M.sub(b).unit(),N=F.angleWithSep(P.x,P.y),V=P.add(F).unit().mult(-1*i/Math.sin(N/2));l.push(b.add(V))}return l},g.cacheEntryPossiblyAdded=function(a){ln++,ln>_u&&(a.getActor().send("enforceCacheSizeLimit",xh),ln=0)},g.clamp=ui,g.clearTileCache=function(a){const i=wt.caches.delete(uc);a&&i.catch(a).then(()=>a())},g.clipLine=Ym,g.clone=function(a){var i=new Ei(3);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i},g.clone$1=function(a){var i=new Ei(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},g.clone$2=Or,g.collisionCircleLayout=u1,g.config=Xn,g.conjugate=function(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[3]=i[3],a},g.copy=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a},g.create=nA,g.create$1=function(){var a=new Ei(16);return Ei!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},g.create$2=I0,g.createExpression=ns,g.createFilter=Pu,g.createLayout=Mt,g.createStyleLayer=function(a){return"custom"===a.type?new ig(a):new d2[a.type](a)},g.cross=function(a,i,l){var u=i[0],f=i[1],x=i[2],b=l[0],M=l[1],P=l[2];return a[0]=f*P-x*M,a[1]=x*b-u*P,a[2]=u*M-f*b,a},g.degToRad=$n,g.div=function(a,i,l){return a[0]=i[0]/l[0],a[1]=i[1]/l[1],a[2]=i[2]/l[2],a},g.dot=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]},g.dot$1=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]+a[3]*i[3]},g.ease=ms,g.easeCubicInOut=hu,g.emitValidationErrors=si,g.endsWith=_s,g.enforceCacheSizeLimit=function(a){Pn(),Wo&&Wo.then(i=>{i.keys().then(l=>{for(let u=0;u<l.length-a;u++)i.delete(l[u])})})},g.evaluateSizeForFeature=Uf,g.evaluateSizeForZoom=Vl,g.evaluateVariableOffset=u_,g.evented=$,g.exactEquals=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]&&a[3]===i[3]},g.exactEquals$1=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]},g.exported=po,g.exported$1=$s,g.extend=hi,g.filterObject=qo,g.fromMat4=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10],a},g.fromQuat=function(a,i){var l=i[0],u=i[1],f=i[2],x=i[3],b=l+l,M=u+u,P=f+f,F=l*b,N=u*b,V=u*M,j=f*b,q=f*M,re=f*P,oe=x*b,Ae=x*M,xe=x*P;return a[0]=1-V-re,a[1]=N+xe,a[2]=j-Ae,a[3]=0,a[4]=N-xe,a[5]=1-F-re,a[6]=q+oe,a[7]=0,a[8]=j+Ae,a[9]=q-oe,a[10]=1-F-V,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.fromRotation=function(a,i){var l=Math.sin(i),u=Math.cos(i);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},g.fromScaling=function(a,i){return a[0]=i[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=i[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.furthestTileCorner=function(a){const i=Math.round((a+45+360)%360/90)%4;return uu[i]},g.getAABBPointSquareDist=function(a,i,l){let u=0;for(let f=0;f<2;++f){const x=l?l[f]:0;a[f]>x&&(u+=(a[f]-x)*(a[f]-x)),i[f]<x&&(u+=(x-i[f])*(x-i[f]))}return u},g.getAnchorAlignment=Zf,g.getAnchorJustification=Ps,g.getBounds=function(a){let i=1/0,l=1/0,u=-1/0,f=-1/0;for(const x of a)i=Math.min(i,x.x),l=Math.min(l,x.y),u=Math.max(u,x.x),f=Math.max(f,x.y);return{min:new ut(i,l),max:new ut(u,f)}},g.getImage=Ee,g.getJSON=function(a,i){return ne(hi(a,{type:"json"}),i)},g.getMapSessionAPI=Cd,g.getPerformanceMeasurement=b1,g.getRTLTextPluginStatus=H,g.getReferrer=Hn,g.getVideo=function(a,i){const l=wt.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let u=0;u<a.length;u++){const f=wt.document.createElement("source");he(a[u])||(l.crossOrigin="Anonymous"),f.src=a[u],l.appendChild(f)}return{cancel:()=>{}}},g.identity=Sf,g.identity$1=If,g.invert=function(a,i){var l=i[0],u=i[1],f=i[2],x=i[3],b=i[4],M=i[5],P=i[6],F=i[7],N=i[8],V=i[9],j=i[10],q=i[11],re=i[12],oe=i[13],Ae=i[14],xe=i[15],Me=l*M-u*b,Le=l*P-f*b,Be=l*F-x*b,Ne=u*P-f*M,Ue=u*F-x*M,Ze=f*F-x*P,ot=N*oe-V*re,At=N*Ae-j*re,pt=N*xe-q*re,et=V*Ae-j*oe,it=V*xe-q*oe,yt=j*xe-q*Ae,rt=Me*yt-Le*it+Be*et+Ne*pt-Ue*At+Ze*ot;return rt?(a[0]=(M*yt-P*it+F*et)*(rt=1/rt),a[1]=(f*it-u*yt-x*et)*rt,a[2]=(oe*Ze-Ae*Ue+xe*Ne)*rt,a[3]=(j*Ue-V*Ze-q*Ne)*rt,a[4]=(P*pt-b*yt-F*At)*rt,a[5]=(l*yt-f*pt+x*At)*rt,a[6]=(Ae*Be-re*Ze-xe*Le)*rt,a[7]=(N*Ze-j*Be+q*Le)*rt,a[8]=(b*it-M*pt+F*ot)*rt,a[9]=(u*pt-l*it-x*ot)*rt,a[10]=(re*Ue-oe*Be+xe*Me)*rt,a[11]=(V*Be-N*Ue-q*Me)*rt,a[12]=(M*At-b*et-P*ot)*rt,a[13]=(l*et-u*At+f*ot)*rt,a[14]=(oe*Le-re*Ne-Ae*Me)*rt,a[15]=(N*Ne-V*Le+j*Me)*rt,a):null},g.isMapAuthenticated=function(a){return cc.has(a)},g.isMapboxURL=pr,g.latFromMercatorY=lg,g.len=zv,g.length=k0,g.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},g.loadVectorTile=pg,g.makeRequest=ne,g.mercatorXfromLng=ag,g.mercatorYfromLat=m_,g.mercatorZfromAltitude=wA,g.mul=function(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a[3]=i[3]*l[3],a},g.mul$1=Tf,g.mul$2=Nv,g.multiply=Mf,g.multiply$1=Gh,g.nextPowerOfTwo=vl,g.normalize=Bv,g.normalize$1=function(a,i){var l=i[0],u=i[1],f=i[2],x=i[3],b=l*l+u*u+f*f+x*x;return b>0&&(b=1/Math.sqrt(b)),a[0]=l*b,a[1]=u*b,a[2]=f*b,a[3]=x*b,a},g.number=ht,g.ortho=function(a,i,l,u,f,x,b){var M=1/(i-l),P=1/(u-f),F=1/(x-b);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*F,a[11]=0,a[12]=(i+l)*M,a[13]=(f+u)*P,a[14]=(b+x)*F,a[15]=1,a},g.pbf=AA,g.perspective=function(a,i,l,u,f){var x,b=1/Math.tan(i/2);return a[0]=b/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+u)*(x=1/(u-f)),a[14]=2*f*u*x):(a[10]=-1,a[14]=-2*u),a},g.pick=function(a,i){const l={};for(let u=0;u<i.length;u++){const f=i[u];f in a&&(l[f]=a[f])}return l},g.plugin=J,g.pointGeometry=ut,g.polygonIntersectsBox=Uh,g.polygonIntersectsPolygon=Cf,g.polygonizeBounds=function(a,i,l=0,u=!0){const f=new ut(l,l),x=a.sub(f),b=i.add(f),M=[x,new ut(b.x,x.y),b,new ut(x.x,b.y)];return u&&M.push(x),M},g.posAttributes=ug,g.postMapLoadEvent=lc,g.postTurnstileEvent=yh,g.potpack=jf,g.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},g.radToDeg=function(a){return a*cu},g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.registerForPluginStateChange=function(a){return a({pluginStatus:D,pluginURL:R}),$.on("pluginStateChange",a),a},g.removeAuthState=function(a){cc.delete(a)},g.renderColorRamp=wm,g.rotateX=function(a,i,l){var u=Math.sin(l),f=Math.cos(l),x=i[4],b=i[5],M=i[6],P=i[7],F=i[8],N=i[9],V=i[10],j=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=x*f+F*u,a[5]=b*f+N*u,a[6]=M*f+V*u,a[7]=P*f+j*u,a[8]=F*f-x*u,a[9]=N*f-b*u,a[10]=V*f-M*u,a[11]=j*f-P*u,a},g.rotateX$1=Wu,g.rotateY=function(a,i,l){var u=Math.sin(l),f=Math.cos(l),x=i[0],b=i[1],M=i[2],P=i[3],F=i[8],N=i[9],V=i[10],j=i[11];return i!==a&&(a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=x*f-F*u,a[1]=b*f-N*u,a[2]=M*f-V*u,a[3]=P*f-j*u,a[8]=x*u+F*f,a[9]=b*u+N*f,a[10]=M*u+V*f,a[11]=P*u+j*f,a},g.rotateZ=function(a,i,l){var u=Math.sin(l),f=Math.cos(l),x=i[0],b=i[1],M=i[2],P=i[3],F=i[4],N=i[5],V=i[6],j=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=x*f+F*u,a[1]=b*f+N*u,a[2]=M*f+V*u,a[3]=P*f+j*u,a[4]=F*f-x*u,a[5]=N*f-b*u,a[6]=V*f-M*u,a[7]=j*f-P*u,a},g.rotateZ$1=function(a,i,l){l*=.5;var u=i[0],f=i[1],x=i[2],b=i[3],M=Math.sin(l),P=Math.cos(l);return a[0]=u*P+f*M,a[1]=f*P-u*M,a[2]=x*P+b*M,a[3]=b*P-x*M,a},g.scale=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a},g.scale$1=function(a,i,l){var u=l[0],f=l[1],x=l[2];return a[0]=i[0]*u,a[1]=i[1]*u,a[2]=i[2]*u,a[3]=i[3]*u,a[4]=i[4]*f,a[5]=i[5]*f,a[6]=i[6]*f,a[7]=i[7]*f,a[8]=i[8]*x,a[9]=i[9]*x,a[10]=i[10]*x,a[11]=i[11]*x,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a},g.scale$2=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a[3]=i[3]*l,a},g.scaleAndAdd=P0,g.setCacheLimits=function(a,i){xh=a,_u=i},g.setRTLTextPlugin=function(a,i,l=!1){if(D===s||D===h||D===v)throw new Error("setRTLTextPlugin cannot be called multiple times.");R=po.resolveURL(a),D=s,E=i,z(),l||Q()},g.smoothstep=function(a,i,l){return(l=ui((l-a)/(i-a),0,1))*l*(3-2*l)},g.spec=Ce,g.storeAuthState=function(a,i){i?cc.add(a):cc.delete(a)},g.sub=i2,g.subtract=Zu,g.symbolSize=ia,g.transformMat3=function(a,i,l){var u=i[0],f=i[1],x=i[2];return a[0]=u*l[0]+f*l[3]+x*l[6],a[1]=u*l[1]+f*l[4]+x*l[7],a[2]=u*l[2]+f*l[5]+x*l[8],a},g.transformMat4=iA,g.transformMat4$1=function(a,i,l){var u=i[0],f=i[1],x=i[2],b=l[3]*u+l[7]*f+l[11]*x+l[15];return a[0]=(l[0]*u+l[4]*f+l[8]*x+l[12])/(b=b||1),a[1]=(l[1]*u+l[5]*f+l[9]*x+l[13])/b,a[2]=(l[2]*u+l[6]*f+l[10]*x+l[14])/b,a},g.transformQuat=ym,g.translate=function(a,i,l){var u,f,x,b,M,P,F,N,V,j,q,re,oe=l[0],Ae=l[1],xe=l[2];return i===a?(a[12]=i[0]*oe+i[4]*Ae+i[8]*xe+i[12],a[13]=i[1]*oe+i[5]*Ae+i[9]*xe+i[13],a[14]=i[2]*oe+i[6]*Ae+i[10]*xe+i[14],a[15]=i[3]*oe+i[7]*Ae+i[11]*xe+i[15]):(f=i[1],x=i[2],b=i[3],M=i[4],P=i[5],F=i[6],N=i[7],V=i[8],j=i[9],q=i[10],re=i[11],a[0]=u=i[0],a[1]=f,a[2]=x,a[3]=b,a[4]=M,a[5]=P,a[6]=F,a[7]=N,a[8]=V,a[9]=j,a[10]=q,a[11]=re,a[12]=u*oe+M*Ae+V*xe+i[12],a[13]=f*oe+P*Ae+j*xe+i[13],a[14]=x*oe+F*Ae+q*xe+i[14],a[15]=b*oe+N*Ae+re*xe+i[15]),a},g.triggerPluginCompletionEvent=B,g.uniqueId=gs,g.validateCustomStyleLayer=function(a){const i=[],l=a.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&i.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},g.validateFog=ct,g.validateLight=Ud,g.validateStyle=Ec,g.values=Gn,g.vectorTile=ka,g.version="2.5.1",g.warnOnce=zr,g.window=wt,g.wrap=Va}),bd(0,function(g){function Co(ne){const Z=typeof ne;if("number"===Z||"boolean"===Z||"string"===Z||null==ne)return JSON.stringify(ne);if(Array.isArray(ne)){let he="[";for(const be of ne)he+=`${Co(be)},`;return`${he}]`}const Y=Object.keys(ne).sort();let ae="{";for(let he=0;he<Y.length;he++)ae+=`${JSON.stringify(Y[he])}:${Co(ne[Y[he]])},`;return`${ae}}`}function Ho(ne){let Z="";for(const Y of g.refProperties)Z+=`/${Co(ne[Y])}`;return Z}class fo{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Y){for(const he of Z){this._layerConfigs[he.id]=he;const be=this._layers[he.id]=g.createStyleLayer(he);be._featureFilter=g.createFilter(be.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Y)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ae=function(he,be){const we={};for(let Ee=0;Ee<he.length;Ee++){const Oe=be&&be[he[Ee].id]||Ho(he[Ee]);be&&(be[he[Ee].id]=Oe);let Ye=we[Oe];Ye||(Ye=we[Oe]=[]),Ye.push(he[Ee])}const ke=[];for(const Ee in we)ke.push(we[Ee]);return ke}(g.values(this._layerConfigs),this.keyCache);for(const he of ae){const be=he.map(ft=>this._layers[ft.id]),we=be[0];if("none"===we.visibility)continue;const ke=we.source||"";let Ee=this.familiesBySource[ke];Ee||(Ee=this.familiesBySource[ke]={});const Oe=we.sourceLayer||"_geojsonTileLayer";let Ye=Ee[Oe];Ye||(Ye=Ee[Oe]=[]),Ye.push(be)}}}const{ImageBitmap:ut}=g.window;class st{loadTile(Z,Y){const{uid:ae,encoding:he,rawImageData:be,padding:we,buildQuadTree:ke}=Z,Ee=ut&&be instanceof ut?this.getImageData(be,we):be;Y(null,new g.DEMData(ae,Ee,he,we<1,ke))}getImageData(Z,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ae=this.offscreenCanvasContext.getImageData(-Y,-Y,Z.width+2*Y,Z.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:ae.width,height:ae.height},ae.data)}}var wt=function ne(Z,Y){var ae,he=Z&&Z.type;if("FeatureCollection"===he)for(ae=0;ae<Z.features.length;ae++)ne(Z.features[ae],Y);else if("GeometryCollection"===he)for(ae=0;ae<Z.geometries.length;ae++)ne(Z.geometries[ae],Y);else if("Feature"===he)ne(Z.geometry,Y);else if("Polygon"===he)ps(Z.coordinates,Y);else if("MultiPolygon"===he)for(ae=0;ae<Z.coordinates.length;ae++)ps(Z.coordinates[ae],Y);return Z};function ps(ne,Z){if(0!==ne.length){Na(ne[0],Z);for(var Y=1;Y<ne.length;Y++)Na(ne[Y],!Z)}}function Na(ne,Z){for(var Y=0,ae=0,he=ne.length,be=he-1;ae<he;be=ae++)Y+=(ne[ae][0]-ne[be][0])*(ne[be][1]+ne[ae][1]);Y>=0!=!!Z&&ne.reverse()}const cu=g.vectorTile.VectorTileFeature.prototype.toGeoJSON;class $n{constructor(Z){this._feature=Z,this.extent=g.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(1===this._feature.type){const Z=[];for(const Y of this._feature.geometry)Z.push([new g.pointGeometry(Y[0],Y[1])]);return Z}{const Z=[];for(const Y of this._feature.geometry){const ae=[];for(const he of Y)ae.push(new g.pointGeometry(he[0],he[1]));Z.push(ae)}return Z}}toGeoJSON(Z,Y,ae){return cu.call(this,Z,Y,ae)}}class uu{constructor(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=Z.length,this._features=Z}feature(Z){return new $n(this._features[Z])}}var hu=g.vectorTile.VectorTileFeature,za=ms;function ms(ne,Z){this.options=Z||{},this.features=ne,this.length=ne.length}function ui(ne,Z){this.id="number"==typeof ne.id?ne.id:void 0,this.type=ne.type,this.rawGeometry=1===ne.type?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=Z||4096}ms.prototype.feature=function(ne){return new ui(this.features[ne],this.options.extent)},ui.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var Z=0;Z<ne.length;Z++){for(var Y=ne[Z],ae=[],he=0;he<Y.length;he++)ae.push(new g.pointGeometry(Y[he][0],Y[he][1]));this.geometry.push(ae)}return this.geometry},ui.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,Z=1/0,Y=-1/0,ae=1/0,he=-1/0,be=0;be<ne.length;be++)for(var we=ne[be],ke=0;ke<we.length;ke++){var Ee=we[ke];Z=Math.min(Z,Ee.x),Y=Math.max(Y,Ee.x),ae=Math.min(ae,Ee.y),he=Math.max(he,Ee.y)}return[Z,ae,Y,he]},ui.prototype.toGeoJSON=hu.prototype.toGeoJSON;var Va=Gn,du=za;function Gn(ne){var Z=new g.pbf;return function(Y,ae){for(var he in Y.layers)ae.writeMessage(3,hi,Y.layers[he])}(ne,Z),Z.finish()}function hi(ne,Z){var Y;Z.writeVarintField(15,ne.version||1),Z.writeStringField(1,ne.name||""),Z.writeVarintField(5,ne.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<ne.length;Y++)ae.feature=ne.feature(Y),Z.writeMessage(2,of,ae);var he=ae.keys;for(Y=0;Y<he.length;Y++)Z.writeStringField(3,he[Y]);var be=ae.values;for(Y=0;Y<be.length;Y++)Z.writeMessage(4,sc,be[Y])}function of(ne,Z){var Y=ne.feature;void 0!==Y.id&&Z.writeVarintField(1,Y.id),Z.writeMessage(2,gs,ne),Z.writeVarintField(3,Y.type),Z.writeMessage(4,_i,Y)}function gs(ne,Z){var Y=ne.feature,ae=ne.keys,he=ne.values,be=ne.keycache,we=ne.valuecache;for(var ke in Y.properties){var Ee=be[ke];void 0===Ee&&(ae.push(ke),be[ke]=Ee=ae.length-1),Z.writeVarint(Ee);var Oe=Y.properties[ke],Ye=typeof Oe;"string"!==Ye&&"boolean"!==Ye&&"number"!==Ye&&(Oe=JSON.stringify(Oe));var ft=Ye+":"+Oe,Xe=we[ft];void 0===Xe&&(he.push(Oe),we[ft]=Xe=he.length-1),Z.writeVarint(Xe)}}function yl(ne,Z){return(Z<<3)+(7&ne)}function vl(ne){return ne<<1^ne>>31}function _i(ne,Z){for(var Y=ne.loadGeometry(),ae=ne.type,he=0,be=0,we=Y.length,ke=0;ke<we;ke++){var Ee=Y[ke],Oe=1;1===ae&&(Oe=Ee.length),Z.writeVarint(yl(1,Oe));for(var Ye=3===ae?Ee.length-1:Ee.length,ft=0;ft<Ye;ft++){1===ft&&1!==ae&&Z.writeVarint(yl(2,Ye-1));var Xe=Ee[ft].x-he,jt=Ee[ft].y-be;Z.writeVarint(vl(Xe)),Z.writeVarint(vl(jt)),he+=Xe,be+=jt}3===ae&&Z.writeVarint(yl(7,1))}}function sc(ne,Z){var Y=typeof ne;"string"===Y?Z.writeStringField(1,ne):"boolean"===Y?Z.writeBooleanField(7,ne):"number"===Y&&(ne%1!=0?Z.writeDoubleField(3,ne):ne<0?Z.writeSVarintField(6,ne):Z.writeVarintField(5,ne))}function _s(ne,Z,Y,ae,he,be){if(he-ae<=Y)return;const we=ae+he>>1;An(ne,Z,we,ae,he,be%2),_s(ne,Z,Y,ae,we-1,be+1),_s(ne,Z,Y,we+1,he,be+1)}function An(ne,Z,Y,ae,he,be){for(;he>ae;){if(he-ae>600){const Oe=he-ae+1,Ye=Y-ae+1,ft=Math.log(Oe),Xe=.5*Math.exp(2*ft/3),jt=.5*Math.sqrt(ft*Xe*(Oe-Xe)/Oe)*(Ye-Oe/2<0?-1:1);An(ne,Z,Y,Math.max(ae,Math.floor(Y-Ye*Xe/Oe+jt)),Math.min(he,Math.floor(Y+(Oe-Ye)*Xe/Oe+jt)),be)}const we=Z[2*Y+be];let ke=ae,Ee=he;for(qo(ne,Z,ae,Y),Z[2*he+be]>we&&qo(ne,Z,ae,he);ke<Ee;){for(qo(ne,Z,ke,Ee),ke++,Ee--;Z[2*ke+be]<we;)ke++;for(;Z[2*Ee+be]>we;)Ee--}Z[2*ae+be]===we?qo(ne,Z,ae,Ee):(Ee++,qo(ne,Z,Ee,he)),Ee<=Y&&(ae=Ee+1),Y<=Ee&&(he=Ee-1)}}function qo(ne,Z,Y,ae){Or(ne,Y,ae),Or(Z,2*Y,2*ae),Or(Z,2*Y+1,2*ae+1)}function Or(ne,Z,Y){const ae=ne[Z];ne[Z]=ne[Y],ne[Y]=ae}function Ua(ne,Z,Y,ae){const he=ne-Y,be=Z-ae;return he*he+be*be}Va.fromVectorTileJs=Gn,Va.fromGeojsonVt=function(ne,Z){Z=Z||{};var Y={};for(var ae in ne)Y[ae]=new za(ne[ae].features,Z),Y[ae].name=ae,Y[ae].version=Z.version,Y[ae].extent=Z.extent;return Gn({layers:Y})},Va.GeoJSONWrapper=du;const zr=ne=>ne[0],ys=ne=>ne[1];class ja{constructor(Z,Y=zr,ae=ys,he=64,be=Float64Array){this.nodeSize=he,this.points=Z;const we=Z.length<65536?Uint16Array:Uint32Array,ke=this.ids=new we(Z.length),Ee=this.coords=new be(2*Z.length);for(let Oe=0;Oe<Z.length;Oe++)ke[Oe]=Oe,Ee[2*Oe]=Y(Z[Oe]),Ee[2*Oe+1]=ae(Z[Oe]);_s(ke,Ee,he,0,ke.length-1,0)}range(Z,Y,ae,he){return function(be,we,ke,Ee,Oe,Ye,ft){const Xe=[0,be.length-1,0],jt=[];let Ce,$e;for(;Xe.length;){const Gt=Xe.pop(),mn=Xe.pop(),on=Xe.pop();if(mn-on<=ft){for(let vr=on;vr<=mn;vr++)Ce=we[2*vr],$e=we[2*vr+1],Ce>=ke&&Ce<=Oe&&$e>=Ee&&$e<=Ye&&jt.push(be[vr]);continue}const Kn=Math.floor((on+mn)/2);Ce=we[2*Kn],$e=we[2*Kn+1],Ce>=ke&&Ce<=Oe&&$e>=Ee&&$e<=Ye&&jt.push(be[Kn]);const Nn=(Gt+1)%2;(0===Gt?ke<=Ce:Ee<=$e)&&(Xe.push(on),Xe.push(Kn-1),Xe.push(Nn)),(0===Gt?Oe>=Ce:Ye>=$e)&&(Xe.push(Kn+1),Xe.push(mn),Xe.push(Nn))}return jt}(this.ids,this.coords,Z,Y,ae,he,this.nodeSize)}within(Z,Y,ae){return function(he,be,we,ke,Ee,Oe){const Ye=[0,he.length-1,0],ft=[],Xe=Ee*Ee;for(;Ye.length;){const jt=Ye.pop(),Ce=Ye.pop(),$e=Ye.pop();if(Ce-$e<=Oe){for(let Nn=$e;Nn<=Ce;Nn++)Ua(be[2*Nn],be[2*Nn+1],we,ke)<=Xe&&ft.push(he[Nn]);continue}const Gt=Math.floor(($e+Ce)/2),mn=be[2*Gt],on=be[2*Gt+1];Ua(mn,on,we,ke)<=Xe&&ft.push(he[Gt]);const Kn=(jt+1)%2;(0===jt?we-Ee<=mn:ke-Ee<=on)&&(Ye.push($e),Ye.push(Gt-1),Ye.push(Kn)),(0===jt?we+Ee>=mn:ke+Ee>=on)&&(Ye.push(Gt+1),Ye.push(Ce),Ye.push(Kn))}return ft}(this.ids,this.coords,Z,Y,ae,this.nodeSize)}}const xl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},Ga=Math.fround||($a=new Float32Array(1),ne=>($a[0]=+ne,$a[0]));var $a;class Bn{constructor(Z){this.options=$s(Object.create(xl),Z),this.trees=new Array(this.options.maxZoom+1)}load(Z){const{log:Y,minZoom:ae,maxZoom:he,nodeSize:be}=this.options;Y&&console.time("total time");const we=`prepare ${Z.length} points`;Y&&console.time(we),this.points=Z;let ke=[];for(let Ee=0;Ee<Z.length;Ee++)Z[Ee].geometry&&ke.push(wl(Z[Ee],Ee));this.trees[he+1]=new ja(ke,Ha,Lr,be,Float32Array),Y&&console.timeEnd(we);for(let Ee=he;Ee>=ae;Ee--){const Oe=+Date.now();ke=this._cluster(ke,Ee),this.trees[Ee]=new ja(ke,Ha,Lr,be,Float32Array),Y&&console.log("z%d: %d clusters in %dms",Ee,ke.length,+Date.now()-Oe)}return Y&&console.timeEnd("total time"),this}getClusters(Z,Y){let ae=((Z[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,Z[1]));let be=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ae=-180,be=180;else if(ae>be){const Ye=this.getClusters([ae,he,180,we],Y),ft=this.getClusters([-180,he,be,we],Y);return Ye.concat(ft)}const ke=this.trees[this._limitZoom(Y)],Ee=ke.range(po(ae),pa(we),po(be),pa(he)),Oe=[];for(const Ye of Ee){const ft=ke.points[Ye];Oe.push(ft.numPoints?Au(ft):this.points[ft.index])}return Oe}getChildren(Z){const Y=this._getOriginId(Z),ae=this._getOriginZoom(Z),he="No cluster with the specified id.",be=this.trees[ae];if(!be)throw new Error(he);const we=be.points[Y];if(!we)throw new Error(he);const ke=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Ee=be.within(we.x,we.y,ke),Oe=[];for(const Ye of Ee){const ft=be.points[Ye];ft.parentId===Z&&Oe.push(ft.numPoints?Au(ft):this.points[ft.index])}if(0===Oe.length)throw new Error(he);return Oe}getLeaves(Z,Y,ae){const he=[];return this._appendLeaves(he,Z,Y=Y||10,ae=ae||0,0),he}getTile(Z,Y,ae){const he=this.trees[this._limitZoom(Z)],be=Math.pow(2,Z),{extent:we,radius:ke}=this.options,Ee=ke/we,Oe=(ae-Ee)/be,Ye=(ae+1+Ee)/be,ft={features:[]};return this._addTileFeatures(he.range((Y-Ee)/be,Oe,(Y+1+Ee)/be,Ye),he.points,Y,ae,be,ft),0===Y&&this._addTileFeatures(he.range(1-Ee/be,Oe,1,Ye),he.points,be,ae,be,ft),Y===be-1&&this._addTileFeatures(he.range(0,Oe,Ee/be,Ye),he.points,-1,ae,be,ft),ft.features.length?ft:null}getClusterExpansionZoom(Z){let Y=this._getOriginZoom(Z)-1;for(;Y<=this.options.maxZoom;){const ae=this.getChildren(Z);if(Y++,1!==ae.length)break;Z=ae[0].properties.cluster_id}return Y}_appendLeaves(Z,Y,ae,he,be){const we=this.getChildren(Y);for(const ke of we){const Ee=ke.properties;if(Ee&&Ee.cluster?be+Ee.point_count<=he?be+=Ee.point_count:be=this._appendLeaves(Z,Ee.cluster_id,ae,he,be):be<he?be++:Z.push(ke),Z.length===ae)break}return be}_addTileFeatures(Z,Y,ae,he,be,we){for(const ke of Z){const Ee=Y[ke],Oe=Ee.numPoints;let Ye,ft,Xe;if(Oe)Ye=fu(Ee),ft=Ee.x,Xe=Ee.y;else{const $e=this.points[Ee.index];Ye=$e.properties,ft=po($e.geometry.coordinates[0]),Xe=pa($e.geometry.coordinates[1])}const jt={type:1,geometry:[[Math.round(this.options.extent*(ft*be-ae)),Math.round(this.options.extent*(Xe*be-he))]],tags:Ye};let Ce;Oe?Ce=Ee.id:this.options.generateId?Ce=Ee.index:this.points[Ee.index].id&&(Ce=this.points[Ee.index].id),void 0!==Ce&&(jt.id=Ce),we.features.push(jt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))}_cluster(Z,Y){const ae=[],{radius:he,extent:be,reduce:we,minPoints:ke}=this.options,Ee=he/(be*Math.pow(2,Y));for(let Oe=0;Oe<Z.length;Oe++){const Ye=Z[Oe];if(Ye.zoom<=Y)continue;Ye.zoom=Y;const ft=this.trees[Y+1],Xe=ft.within(Ye.x,Ye.y,Ee),jt=Ye.numPoints||1;let Ce=jt;for(const $e of Xe){const Gt=ft.points[$e];Gt.zoom>Y&&(Ce+=Gt.numPoints||1)}if(Ce>=ke){let $e=Ye.x*jt,Gt=Ye.y*jt,mn=we&&jt>1?this._map(Ye,!0):null;const on=(Oe<<5)+(Y+1)+this.points.length;for(const Kn of Xe){const Nn=ft.points[Kn];if(Nn.zoom<=Y)continue;Nn.zoom=Y;const vr=Nn.numPoints||1;$e+=Nn.x*vr,Gt+=Nn.y*vr,Nn.parentId=on,we&&(mn||(mn=this._map(Ye,!0)),we(mn,this._map(Nn)))}Ye.parentId=on,ae.push(bl($e/Ce,Gt/Ce,on,Ce,mn))}else if(ae.push(Ye),Ce>1)for(const $e of Xe){const Gt=ft.points[$e];Gt.zoom<=Y||(Gt.zoom=Y,ae.push(Gt))}}return ae}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Y){if(Z.numPoints)return Y?$s({},Z.properties):Z.properties;const ae=this.points[Z.index].properties,he=this.options.map(ae);return Y&&he===ae?$s({},he):he}}function bl(ne,Z,Y,ae,he){return{x:Ga(ne),y:Ga(Z),zoom:1/0,id:Y,parentId:-1,numPoints:ae,properties:he}}function wl(ne,Z){const[Y,ae]=ne.geometry.coordinates;return{x:Ga(po(Y)),y:Ga(pa(ae)),zoom:1/0,index:Z,parentId:-1}}function Au(ne){return{type:"Feature",id:ne.id,properties:fu(ne),geometry:{type:"Point",coordinates:[(Z=ne.x,360*(Z-.5)),Xn(ne.y)]}};var Z}function fu(ne){const Z=ne.numPoints,Y=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z;return $s($s({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:Z,point_count_abbreviated:Y})}function po(ne){return ne/360+.5}function pa(ne){const Z=Math.sin(ne*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function Xn(ne){const Z=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function $s(ne,Z){for(const Y in Z)ne[Y]=Z[Y];return ne}function Ha(ne){return ne.x}function Lr(ne){return ne.y}function ma(ne,Z,Y,ae){for(var he,be=ae,we=Y-Z>>1,ke=Y-Z,Ee=ne[Z],Oe=ne[Z+1],Ye=ne[Y],ft=ne[Y+1],Xe=Z+3;Xe<Y;Xe+=3){var jt=wd(ne[Xe],ne[Xe+1],Ee,Oe,Ye,ft);if(jt>be)he=Xe,be=jt;else if(jt===be){var Ce=Math.abs(Xe-we);Ce<ke&&(he=Xe,ke=Ce)}}be>ae&&(he-Z>3&&ma(ne,Z,he,ae),ne[he+2]=be,Y-he>3&&ma(ne,he,Y,ae))}function wd(ne,Z,Y,ae,he,be){var we=he-Y,ke=be-ae;if(0!==we||0!==ke){var Ee=((ne-Y)*we+(Z-ae)*ke)/(we*we+ke*ke);Ee>1?(Y=he,ae=be):Ee>0&&(Y+=we*Ee,ae+=ke*Ee)}return(we=ne-Y)*we+(ke=Z-ae)*ke}function Hs(ne,Z,Y,ae){var he={id:void 0===ne?null:ne,type:Z,geometry:Y,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(be){var we=be.geometry,ke=be.type;if("Point"===ke||"MultiPoint"===ke||"LineString"===ke)pu(be,we);else if("Polygon"===ke||"MultiLineString"===ke)for(var Ee=0;Ee<we.length;Ee++)pu(be,we[Ee]);else if("MultiPolygon"===ke)for(Ee=0;Ee<we.length;Ee++)for(var Oe=0;Oe<we[Ee].length;Oe++)pu(be,we[Ee][Oe])}(he),he}function pu(ne,Z){for(var Y=0;Y<Z.length;Y+=3)ne.minX=Math.min(ne.minX,Z[Y]),ne.minY=Math.min(ne.minY,Z[Y+1]),ne.maxX=Math.max(ne.maxX,Z[Y]),ne.maxY=Math.max(ne.maxY,Z[Y+1])}function ga(ne,Z,Y,ae){if(Z.geometry){var he=Z.geometry.coordinates,be=Z.geometry.type,we=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),ke=[],Ee=Z.id;if(Y.promoteId?Ee=Z.properties[Y.promoteId]:Y.generateId&&(Ee=ae||0),"Point"===be)pr(he,ke);else if("MultiPoint"===be)for(var Oe=0;Oe<he.length;Oe++)pr(he[Oe],ke);else if("LineString"===be)qa(he,ke,we,!1);else if("MultiLineString"===be){if(Y.lineMetrics){for(Oe=0;Oe<he.length;Oe++)qa(he[Oe],ke=[],we,!1),ne.push(Hs(Ee,"LineString",ke,Z.properties));return}mu(he,ke,we,!1)}else if("Polygon"===be)mu(he,ke,we,!0);else{if("MultiPolygon"!==be){if("GeometryCollection"===be){for(Oe=0;Oe<Z.geometry.geometries.length;Oe++)ga(ne,{id:Ee,geometry:Z.geometry.geometries[Oe],properties:Z.properties},Y,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Oe=0;Oe<he.length;Oe++){var Ye=[];mu(he[Oe],Ye,we,!0),ke.push(Ye)}}ne.push(Hs(Ee,be,ke,Z.properties))}}function pr(ne,Z){Z.push(vs(ne[0])),Z.push(Zo(ne[1])),Z.push(0)}function qa(ne,Z,Y,ae){for(var he,be,we=0,ke=0;ke<ne.length;ke++){var Ee=vs(ne[ke][0]),Oe=Zo(ne[ke][1]);Z.push(Ee),Z.push(Oe),Z.push(0),ke>0&&(we+=ae?(he*Oe-Ee*be)/2:Math.sqrt(Math.pow(Ee-he,2)+Math.pow(Oe-be,2))),he=Ee,be=Oe}var Ye=Z.length-3;Z[2]=1,ma(Z,0,Ye,Y),Z[Ye+2]=1,Z.size=Math.abs(we),Z.start=0,Z.end=Z.size}function mu(ne,Z,Y,ae){for(var he=0;he<ne.length;he++){var be=[];qa(ne[he],be,Y,ae),Z.push(be)}}function vs(ne){return ne/360+.5}function Zo(ne){var Z=Math.sin(ne*Math.PI/180),Y=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Y<0?0:Y>1?1:Y}function Eo(ne,Z,Y,ae,he,be,we,ke){if(ae/=Z,be>=(Y/=Z)&&we<ae)return ne;if(we<Y||be>=ae)return null;for(var Ee=[],Oe=0;Oe<ne.length;Oe++){var Ye=ne[Oe],ft=Ye.geometry,Xe=Ye.type,jt=0===he?Ye.minX:Ye.minY,Ce=0===he?Ye.maxX:Ye.maxY;if(jt>=Y&&Ce<ae)Ee.push(Ye);else if(!(Ce<Y||jt>=ae)){var $e=[];if("Point"===Xe||"MultiPoint"===Xe)gu(ft,$e,Y,ae,he);else if("LineString"===Xe)Cl(ft,$e,Y,ae,he,!1,ke.lineMetrics);else if("MultiLineString"===Xe)ac(ft,$e,Y,ae,he,!1);else if("Polygon"===Xe)ac(ft,$e,Y,ae,he,!0);else if("MultiPolygon"===Xe)for(var Gt=0;Gt<ft.length;Gt++){var mn=[];ac(ft[Gt],mn,Y,ae,he,!0),mn.length&&$e.push(mn)}if($e.length){if(ke.lineMetrics&&"LineString"===Xe){for(Gt=0;Gt<$e.length;Gt++)Ee.push(Hs(Ye.id,Xe,$e[Gt],Ye.tags));continue}"LineString"!==Xe&&"MultiLineString"!==Xe||(1===$e.length?(Xe="LineString",$e=$e[0]):Xe="MultiLineString"),"Point"!==Xe&&"MultiPoint"!==Xe||(Xe=3===$e.length?"Point":"MultiPoint"),Ee.push(Hs(Ye.id,Xe,$e,Ye.tags))}}}return Ee.length?Ee:null}function gu(ne,Z,Y,ae,he){for(var be=0;be<ne.length;be+=3){var we=ne[be+he];we>=Y&&we<=ae&&(Z.push(ne[be]),Z.push(ne[be+1]),Z.push(ne[be+2]))}}function Cl(ne,Z,Y,ae,he,be,we){for(var ke,Ee,Oe=yh(ne),Ye=0===he?vh:Cd,ft=ne.start,Xe=0;Xe<ne.length-3;Xe+=3){var jt=ne[Xe],Ce=ne[Xe+1],$e=ne[Xe+2],Gt=ne[Xe+3],mn=ne[Xe+4],on=0===he?jt:Ce,Kn=0===he?Gt:mn,Nn=!1;we&&(ke=Math.sqrt(Math.pow(jt-Gt,2)+Math.pow(Ce-mn,2))),on<Y?Kn>Y&&(Ee=Ye(Oe,jt,Ce,Gt,mn,Y),we&&(Oe.start=ft+ke*Ee)):on>ae?Kn<ae&&(Ee=Ye(Oe,jt,Ce,Gt,mn,ae),we&&(Oe.start=ft+ke*Ee)):lc(Oe,jt,Ce,$e),Kn<Y&&on>=Y&&(Ee=Ye(Oe,jt,Ce,Gt,mn,Y),Nn=!0),Kn>ae&&on<=ae&&(Ee=Ye(Oe,jt,Ce,Gt,mn,ae),Nn=!0),!be&&Nn&&(we&&(Oe.end=ft+ke*Ee),Z.push(Oe),Oe=yh(ne)),we&&(ft+=ke)}var vr=ne.length-3;jt=ne[vr],Ce=ne[vr+1],$e=ne[vr+2],(on=0===he?jt:Ce)>=Y&&on<=ae&&lc(Oe,jt,Ce,$e),vr=Oe.length-3,be&&vr>=3&&(Oe[vr]!==Oe[0]||Oe[vr+1]!==Oe[1])&&lc(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&Z.push(Oe)}function yh(ne){var Z=[];return Z.size=ne.size,Z.start=ne.start,Z.end=ne.end,Z}function ac(ne,Z,Y,ae,he,be){for(var we=0;we<ne.length;we++)Cl(ne[we],Z,Y,ae,he,be,!1)}function lc(ne,Z,Y,ae){ne.push(Z),ne.push(Y),ne.push(ae)}function vh(ne,Z,Y,ae,he,be){var we=(be-Z)/(ae-Z);return ne.push(be),ne.push(Y+(he-Y)*we),ne.push(1),we}function Cd(ne,Z,Y,ae,he,be){var we=(be-Y)/(he-Y);return ne.push(Z+(ae-Z)*we),ne.push(be),ne.push(1),we}function cc(ne,Z){for(var Y=[],ae=0;ae<ne.length;ae++){var he,be=ne[ae],we=be.type;if("Point"===we||"MultiPoint"===we||"LineString"===we)he=uc(be.geometry,Z);else if("MultiLineString"===we||"Polygon"===we){he=[];for(var ke=0;ke<be.geometry.length;ke++)he.push(uc(be.geometry[ke],Z))}else if("MultiPolygon"===we)for(he=[],ke=0;ke<be.geometry.length;ke++){for(var Ee=[],Oe=0;Oe<be.geometry[ke].length;Oe++)Ee.push(uc(be.geometry[ke][Oe],Z));he.push(Ee)}Y.push(Hs(be.id,we,he,be.tags))}return Y}function uc(ne,Z){var Y=[];Y.size=ne.size,void 0!==ne.start&&(Y.start=ne.start,Y.end=ne.end);for(var ae=0;ae<ne.length;ae+=3)Y.push(ne[ae]+Z,ne[ae+1],ne[ae+2]);return Y}function Wo(ne,Z){if(ne.transformed)return ne;var Y,ae,he,be=1<<ne.z,we=ne.x,ke=ne.y;for(Y=0;Y<ne.features.length;Y++){var Ee=ne.features[Y],Oe=Ee.geometry,Ye=Ee.type;if(Ee.geometry=[],1===Ye)for(ae=0;ae<Oe.length;ae+=2)Ee.geometry.push(Za(Oe[ae],Oe[ae+1],Z,be,we,ke));else for(ae=0;ae<Oe.length;ae++){var ft=[];for(he=0;he<Oe[ae].length;he+=2)ft.push(Za(Oe[ae][he],Oe[ae][he+1],Z,be,we,ke));Ee.geometry.push(ft)}}return ne.transformed=!0,ne}function Za(ne,Z,Y,ae,he,be){return[Math.round(Y*(ne*ae-he)),Math.round(Y*(Z*ae-be))]}function xh(ne,Z,Y,ae,he){for(var be=Z===he.maxZoom?0:he.tolerance/((1<<Z)*he.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ae,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<ne.length;ke++){we.numFeatures++,_u(we,ne[ke],be,he);var Ee=ne[ke].minX,Oe=ne[ke].minY,Ye=ne[ke].maxX,ft=ne[ke].maxY;Ee<we.minX&&(we.minX=Ee),Oe<we.minY&&(we.minY=Oe),Ye>we.maxX&&(we.maxX=Ye),ft>we.maxY&&(we.maxY=ft)}return we}function _u(ne,Z,Y,ae){var he=Z.geometry,be=Z.type,we=[];if("Point"===be||"MultiPoint"===be)for(var ke=0;ke<he.length;ke+=3)we.push(he[ke]),we.push(he[ke+1]),ne.numPoints++,ne.numSimplified++;else if("LineString"===be)Pn(we,he,ne,Y,!1,!1);else if("MultiLineString"===be||"Polygon"===be)for(ke=0;ke<he.length;ke++)Pn(we,he[ke],ne,Y,"Polygon"===be,0===ke);else if("MultiPolygon"===be)for(var Ee=0;Ee<he.length;Ee++){var Oe=he[Ee];for(ke=0;ke<Oe.length;ke++)Pn(we,Oe[ke],ne,Y,!0,0===ke)}if(we.length){var Ye=Z.tags||null;if("LineString"===be&&ae.lineMetrics){for(var ft in Ye={},Z.tags)Ye[ft]=Z.tags[ft];Ye.mapbox_clip_start=he.start/he.size,Ye.mapbox_clip_end=he.end/he.size}var Xe={geometry:we,type:"Polygon"===be||"MultiPolygon"===be?3:"LineString"===be||"MultiLineString"===be?2:1,tags:Ye};null!==Z.id&&(Xe.id=Z.id),ne.features.push(Xe)}}function Pn(ne,Z,Y,ae,he,be){var we=ae*ae;if(ae>0&&Z.size<(he?we:ae))Y.numPoints+=Z.length/3;else{for(var ke=[],Ee=0;Ee<Z.length;Ee+=3)(0===ae||Z[Ee+2]>we)&&(Y.numSimplified++,ke.push(Z[Ee]),ke.push(Z[Ee+1])),Y.numPoints++;he&&function(Oe,Ye){for(var ft=0,Xe=0,jt=Oe.length,Ce=jt-2;Xe<jt;Ce=Xe,Xe+=2)ft+=(Oe[Xe]-Oe[Ce])*(Oe[Xe+1]+Oe[Ce+1]);if(ft>0===Ye)for(Xe=0,jt=Oe.length;Xe<jt/2;Xe+=2){var $e=Oe[Xe],Gt=Oe[Xe+1];Oe[Xe]=Oe[jt-2-Xe],Oe[Xe+1]=Oe[jt-1-Xe],Oe[jt-2-Xe]=$e,Oe[jt-1-Xe]=Gt}}(ke,be),ne.push(ke)}}function _a(ne,Z){var Y=(Z=this.options=function(he,be){for(var we in be)he[we]=be[we];return he}(Object.create(this.options),Z)).debug;if(Y&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,be,we,ke,Ee,Oe,ae=function(he,be){var we=[];if("FeatureCollection"===he.type)for(var ke=0;ke<he.features.length;ke++)ga(we,he.features[ke],be,ke);else ga(we,"Feature"===he.type?he:{geometry:he},be);return we}(ne,Z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=ae,be=Z,we=be.buffer/be.extent,ke=he,Ee=Eo(he,1,-1-we,we,0,-1,2,be),Oe=Eo(he,1,1-we,2+we,0,-1,2,be),(Ee||Oe)&&(ke=Eo(he,1,-we,1+we,0,-1,2,be)||[],Ee&&(ke=cc(Ee,1).concat(ke)),Oe&&(ke=ke.concat(cc(Oe,-1)))),ae=ke).length&&this.splitTile(ae,0,0,0),Y&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ln(ne,Z,Y){return 32*((1<<ne)*Y+Z)+ne}function ya(ne,Z){const Y=ne.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ae=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ae)return Z(null,null);const he=new uu(ae.features);let be=Va(he);0===be.byteOffset&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),Z(null,{vectorTile:he,rawData:be.buffer})}_a.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_a.prototype.splitTile=function(ne,Z,Y,ae,he,be,we){for(var ke=[ne,Z,Y,ae],Ee=this.options,Oe=Ee.debug;ke.length;){ae=ke.pop(),Y=ke.pop(),Z=ke.pop(),ne=ke.pop();var Ye=1<<Z,ft=ln(Z,Y,ae),Xe=this.tiles[ft];if(!Xe&&(Oe>1&&console.time("creation"),Xe=this.tiles[ft]=xh(ne,Z,Y,ae,Ee),this.tileCoords.push({z:Z,x:Y,y:ae}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Y,ae,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var jt="z"+Z;this.stats[jt]=(this.stats[jt]||0)+1,this.total++}if(Xe.source=ne,he){if(Z===Ee.maxZoom||Z===he)continue;var Ce=1<<he-Z;if(Y!==Math.floor(be/Ce)||ae!==Math.floor(we/Ce))continue}else if(Z===Ee.indexMaxZoom||Xe.numPoints<=Ee.indexMaxPoints)continue;if(Xe.source=null,0!==ne.length){Oe>1&&console.time("clipping");var $e,Gt,mn,on,Kn,Nn,vr=.5*Ee.buffer/Ee.extent,Wa=.5-vr,vt=.5+vr,vn=1+vr;$e=Gt=mn=on=null,Kn=Eo(ne,Ye,Y-vr,Y+vt,0,Xe.minX,Xe.maxX,Ee),Nn=Eo(ne,Ye,Y+Wa,Y+vn,0,Xe.minX,Xe.maxX,Ee),ne=null,Kn&&($e=Eo(Kn,Ye,ae-vr,ae+vt,1,Xe.minY,Xe.maxY,Ee),Gt=Eo(Kn,Ye,ae+Wa,ae+vn,1,Xe.minY,Xe.maxY,Ee),Kn=null),Nn&&(mn=Eo(Nn,Ye,ae-vr,ae+vt,1,Xe.minY,Xe.maxY,Ee),on=Eo(Nn,Ye,ae+Wa,ae+vn,1,Xe.minY,Xe.maxY,Ee),Nn=null),Oe>1&&console.timeEnd("clipping"),ke.push($e||[],Z+1,2*Y,2*ae),ke.push(Gt||[],Z+1,2*Y,2*ae+1),ke.push(mn||[],Z+1,2*Y+1,2*ae),ke.push(on||[],Z+1,2*Y+1,2*ae+1)}}},_a.prototype.getTile=function(ne,Z,Y){var ae=this.options,he=ae.extent,be=ae.debug;if(ne<0||ne>24)return null;var we=1<<ne,ke=ln(ne,Z=(Z%we+we)%we,Y);if(this.tiles[ke])return Wo(this.tiles[ke],he);be>1&&console.log("drilling down to z%d-%d-%d",ne,Z,Y);for(var Ee,Oe=ne,Ye=Z,ft=Y;!Ee&&Oe>0;)Oe--,Ye=Math.floor(Ye/2),ft=Math.floor(ft/2),Ee=this.tiles[ln(Oe,Ye,ft)];return Ee&&Ee.source?(be>1&&console.log("found parent tile z%d-%d-%d",Oe,Ye,ft),be>1&&console.time("drilling down"),this.splitTile(Ee.source,Oe,Ye,ft,ne,Z,Y),be>1&&console.timeEnd("drilling down"),this.tiles[ke]?Wo(this.tiles[ke],he):null):null};class hc extends g.VectorTileWorkerSource{constructor(Z,Y,ae,he,be){super(Z,Y,ae,he,ya),be&&(this.loadGeoJSON=be)}loadData(Z,Y){const ae=Z&&Z.request,he=ae&&ae.collectResourceTiming;this.loadGeoJSON(Z,(be,we)=>{if(be||!we)return Y(be);if("object"!=typeof we)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{wt(we,!0);try{if(Z.filter){const Ee=g.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ee.result)throw new Error(Ee.value.map(Ye=>`${Ye.key}: ${Ye.message}`).join(", "));const Oe=we.features.filter(Ye=>Ee.value.evaluate({zoom:0},Ye));we={type:"FeatureCollection",features:Oe}}this._geoJSONIndex=Z.cluster?new Bn(function({superclusterOptions:Ee,clusterProperties:Oe}){if(!Oe||!Ee)return Ee;const Ye={},ft={},Xe={accumulated:null,zoom:0},jt={properties:null},Ce=Object.keys(Oe);for(const $e of Ce){const[Gt,mn]=Oe[$e],on=g.createExpression(mn),Kn=g.createExpression("string"==typeof Gt?[Gt,["accumulated"],["get",$e]]:Gt);Ye[$e]=on.value,ft[$e]=Kn.value}return Ee.map=$e=>{jt.properties=$e;const Gt={};for(const mn of Ce)Gt[mn]=Ye[mn].evaluate(Xe,jt);return Gt},Ee.reduce=($e,Gt)=>{jt.properties=Gt;for(const mn of Ce)Xe.accumulated=$e[mn],$e[mn]=ft[mn].evaluate(Xe,jt)},Ee}(Z)).load(we.features):new _a(Ee=we,Z.geojsonVtOptions)}catch(Ee){return Y(Ee)}this.loaded={};const ke={};if(he){const Ee=g.getPerformanceMeasurement(ae);Ee&&(ke.resourceTiming={},ke.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ee)))}Y(null,ke)}var Ee})}reloadTile(Z,Y){const ae=this.loaded;return ae&&ae[Z.uid]?super.reloadTile(Z,Y):this.loadTile(Z,Y)}loadGeoJSON(Z,Y){if(Z.request)g.getJSON(Z.request,Y);else{if("string"!=typeof Z.data)return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(Z.data))}catch(ae){return Y(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ae){Y(ae)}}getClusterChildren(Z,Y){try{Y(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ae){Y(ae)}}getClusterLeaves(Z,Y){try{Y(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ae){Y(ae)}}}class Hn{constructor(Z){this.self=Z,this.actor=new g.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:g.VectorTileWorkerSource,geojson:hc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,ae)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ae},this.self.registerRTLTextPlugin=Y=>{if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=Y.applyArabicShaping,g.plugin.processBidirectionalText=Y.processBidirectionalText,g.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}checkIfReady(Z,Y,ae){ae()}setReferrer(Z,Y){this.referrer=Y}spriteLoaded(Z,Y){this.isSpriteLoaded=Y;for(const ae in this.workerSources[Z]){const he=this.workerSources[Z][ae];for(const be in he)he[be]instanceof g.VectorTileWorkerSource&&(he[be].isSpriteLoaded=Y,he[be].fire(new g.Event("isSpriteLoaded")))}}setImages(Z,Y,ae){this.availableImages[Z]=Y;for(const he in this.workerSources[Z]){const be=this.workerSources[Z][he];for(const we in be)be[we].availableImages=Y}ae()}enableTerrain(Z,Y,ae){this.terrain=Y,ae()}setLayers(Z,Y,ae){this.getLayerIndex(Z).replace(Y),ae()}updateLayers(Z,Y,ae){this.getLayerIndex(Z).update(Y.layers,Y.removedIds),ae()}loadTile(Z,Y,ae){const he=this.enableTerrain?g.extend({enableTerrain:this.terrain},Y):Y;this.getWorkerSource(Z,Y.type,Y.source).loadTile(he,ae)}loadDEMTile(Z,Y,ae){const he=this.enableTerrain?g.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(Z,Y.source).loadTile(he,ae)}reloadTile(Z,Y,ae){const he=this.enableTerrain?g.extend({enableTerrain:this.terrain},Y):Y;this.getWorkerSource(Z,Y.type,Y.source).reloadTile(he,ae)}abortTile(Z,Y,ae){this.getWorkerSource(Z,Y.type,Y.source).abortTile(Y,ae)}removeTile(Z,Y,ae){this.getWorkerSource(Z,Y.type,Y.source).removeTile(Y,ae)}removeSource(Z,Y,ae){if(!this.workerSources[Z]||!this.workerSources[Z][Y.type]||!this.workerSources[Z][Y.type][Y.source])return;const he=this.workerSources[Z][Y.type][Y.source];delete this.workerSources[Z][Y.type][Y.source],void 0!==he.removeSource?he.removeSource(Y,ae):ae()}loadWorkerSource(Z,Y,ae){try{this.self.importScripts(Y.url),ae()}catch(he){ae(he.toString())}}syncRTLPluginState(Z,Y,ae){try{g.plugin.setState(Y);const he=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&null!=he){this.self.importScripts(he);const be=g.plugin.isParsed();ae(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),be)}}catch(he){ae(he.toString())}}getAvailableImages(Z){let Y=this.availableImages[Z];return Y||(Y=[]),Y}getLayerIndex(Z){let Y=this.layerIndexes[Z];return Y||(Y=this.layerIndexes[Z]=new fo),Y}getWorkerSource(Z,Y,ae){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Y]||(this.workerSources[Z][Y]={}),this.workerSources[Z][Y][ae]||(this.workerSources[Z][Y][ae]=new this.workerSourceTypes[Y]({send:(he,be,we,ke,Ee,Oe)=>{this.actor.send(he,be,we,Z,Ee,Oe)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded)),this.workerSources[Z][Y][ae]}getDEMWorkerSource(Z,Y){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Y]||(this.demWorkerSources[Z][Y]=new st),this.demWorkerSources[Z][Y]}enforceCacheSizeLimit(Z,Y){g.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(Z,Y,ae){ae(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Hn(self)),Hn}),bd(0,function(g){var Co=Ho;function Ho(_){return s=_,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,E,D=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(D);try{E=new Worker(R),v=!0}catch(B){v=!1}return E&&E.terminate(),URL.revokeObjectURL(R),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var E=v.getContext("2d");if(!E)return!1;var D=E.getImageData(0,0,1,1);return D&&D.width===v.width}()||(void 0===fo[h=s&&s.failIfMajorPerformanceCaveat]&&(fo[h]=function(v){var E,R,B,z,D=(R=v,B=document.createElement("canvas"),(z=Object.create(Ho.webGLContextAttributes)).failIfMajorPerformanceCaveat=R,B.getContext("webgl",z)||B.getContext("experimental-webgl",z));if(!D)return!1;try{E=D.createShader(D.VERTEX_SHADER)}catch(R){return!1}return!(!E||D.isContextLost())&&(D.shaderSource(E,"void main() {}"),D.compileShader(E),!0===D.getShaderParameter(E,D.COMPILE_STATUS))}(h)),!fo[h]||document.documentMode));var s,h}var fo={};function ut(_,s){if(Array.isArray(_)){if(!Array.isArray(s)||_.length!==s.length)return!1;for(let h=0;h<_.length;h++)if(!ut(_[h],s[h]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==s){if("object"!=typeof s||Object.keys(_).length!==Object.keys(s).length)return!1;for(const h in _)if(!ut(_[h],s[h]))return!1;return!0}return _===s}Ho.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const st={create:function(_,s,h){const v=g.window.document.createElement(_);return void 0!==s&&(v.className=s),h&&h.appendChild(v),v},createNS:function(_,s){return g.window.document.createElementNS(_,s)}},wt=g.window.document&&g.window.document.documentElement.style,ps=wt&&void 0!==wt.userSelect?"userSelect":"WebkitUserSelect";let Na;st.disableDrag=function(){wt&&ps&&(Na=wt[ps],wt[ps]="none")},st.enableDrag=function(){wt&&ps&&(wt[ps]=Na)},st.setTransform=function(_,s){_.style.transform=s};let cu=!1;try{const _=Object.defineProperty({},"passive",{get(){cu=!0}});g.window.addEventListener("test",_,_),g.window.removeEventListener("test",_,_)}catch(_){cu=!1}st.addEventListener=function(_,s,h,v={}){_.addEventListener(s,h,"passive"in v&&cu?v:v.capture)},st.removeEventListener=function(_,s,h,v={}){_.removeEventListener(s,h,"passive"in v&&cu?v:v.capture)};const $n=function(_){_.preventDefault(),_.stopPropagation(),g.window.removeEventListener("click",$n,!0)};function uu(_,s,h){const v=_.offsetWidth===s.width?1:_.offsetWidth/s.width;return new g.pointGeometry((h.clientX-s.left)*v,(h.clientY-s.top)*v)}st.suppressClick=function(){g.window.addEventListener("click",$n,!0),g.window.setTimeout(()=>{g.window.removeEventListener("click",$n,!0)},0)},st.mousePos=function(_,s){const h=_.getBoundingClientRect();return uu(_,h,s)},st.touchPos=function(_,s){const h=_.getBoundingClientRect(),v=[];for(let E=0;E<s.length;E++)v.push(uu(_,h,s[E]));return v},st.mouseButton=function(_){return void 0!==g.window.InstallTrigger&&2===_.button&&_.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button},st.remove=function(_){_.parentNode&&_.parentNode.removeChild(_)};class hu{constructor(s,h){this.pos=s,this.dir=h}intersectsPlane(s,h,v){const E=g.dot(h,this.dir);if(Math.abs(E)<1e-6)return!1;const D=g.dot(g.sub(g.create(),s,this.pos),h)/E,R=g.scaleAndAdd(g.create(),this.pos,this.dir,D);return g.copy(v,R),!0}}class za{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,v){const E=Math.pow(2,v),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const z=g.transformMat4([],B,s),$=1/z[3]/h*E;return g.mul(z,z,[$,$,1/z[3],$])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const z=g.sub([],D[B[0]],D[B[1]]),$=g.sub([],D[B[2]],D[B[1]]),H=g.normalize([],g.cross([],z,$)),Q=-g.dot(H,D[B[1]]);return H.concat(Q)});return new za(D,R)}}class ms{constructor(s,h){this.min=s,this.max=h,this.center=g.scale([],g.add([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],v=g.clone(this.min),E=g.clone(this.max);for(let D=0;D<h.length;D++)v[D]=h[D]?this.min[D]:this.center[D],E[D]=h[D]?this.center[D]:this.max[D];return E[2]=this.max[2],new ms(v,E)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let v=!0;for(let E=0;E<s.planes.length;E++){const D=s.planes[E];let R=0;for(let B=0;B<h.length;B++)R+=g.dot$1(D,h[B])>=0;if(0===R)return 0;R!==h.length&&(v=!1)}if(v)return 2;for(let E=0;E<3;E++){let D=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let B=0;B<s.points.length;B++){const z=s.points[B][E]-this.min[E];D=Math.min(D,z),R=Math.max(R,z)}if(R<0||D>this.max[E]-this.min[E])return 0}return 1}}function ui(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class Va extends g.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:v}of this.requestors)this._notify(h,v);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let v=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new g.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),v=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new g.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),v=!1),this._validateContent(h.content,h)||(this.fire(new g.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),v=!1),v}_validateStretch(s,h){if(!s)return!0;let v=0;for(const E of s){if(E[0]<v||E[1]<E[0]||h<E[1])return!1;v=E[1]}return!0}_validateContent(s,h){return!(s&&(4!==s.length||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let v=!0;if(!this.isLoaded())for(const E of s)this.images[E]||(v=!1);this.isLoaded()||v?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const v={};for(const E of s){this.images[E]||this.fire(new g.Event("styleimagemissing",{id:E}));const D=this.images[E];D?v[E]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:Boolean(D.userImage&&D.userImage.render)}:g.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,v)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],v=this.getImage(s);if(!v)return null;if(h&&h.position.version===v.version)return h.position;if(h)h.position.version=v.version;else{const E={w:v.data.width+2,h:v.data.height+2,x:0,y:0},D=new g.ImagePosition(E,v);this.patterns[s]={bin:E,position:D}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const D in this.patterns)s.push(this.patterns[D].bin);const{w:h,h:v}=g.potpack(s),E=this.atlasImage;E.resize({width:h||1,height:v||1});for(const D in this.patterns){const{bin:R}=this.patterns[D],B=R.x+1,z=R.y+1,$=this.images[D].data,H=$.width,Q=$.height;g.RGBAImage.copy($,E,{x:0,y:0},{x:B,y:z},{width:H,height:Q}),g.RGBAImage.copy($,E,{x:0,y:Q-1},{x:B,y:z-1},{width:H,height:1}),g.RGBAImage.copy($,E,{x:0,y:0},{x:B,y:z+Q},{width:H,height:1}),g.RGBAImage.copy($,E,{x:H-1,y:0},{x:B-1,y:z},{width:1,height:Q}),g.RGBAImage.copy($,E,{x:0,y:0},{x:B+H,y:z},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const v=this.images[h];ui(v)&&this.updateImage(h,v)}}}const du=new g.Properties({anchor:new g.DataConstantProperty(g.spec.light.anchor),position:new class{constructor(){this.specification=g.spec.light.position}possiblyEvaluate(_,s){return function([h,v,E]){const D=g.degToRad(v+90),R=g.degToRad(E);return{x:h*Math.cos(D)*Math.sin(R),y:h*Math.sin(D)*Math.sin(R),z:h*Math.cos(R),azimuthal:v,polar:E}}(_.expression.evaluate(s))}interpolate(_,s,h){return{x:g.number(_.x,s.x,h),y:g.number(_.y,s.y,h),z:g.number(_.z,s.z,h),azimuthal:g.number(_.azimuthal,s.azimuthal,h),polar:g.number(_.polar,s.polar,h)}}},color:new g.DataConstantProperty(g.spec.light.color),intensity:new g.DataConstantProperty(g.spec.light.intensity)}),Gn="-transition";class hi extends g.Evented{constructor(s){super(),this._transitionable=new g.Transitionable(du),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(g.validateLight,s,h))for(const v in s){const E=s[v];g.endsWith(v,Gn)?this._transitionable.setTransition(v.slice(0,-Gn.length),E):this._transitionable.setValue(v,E)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,v){return(!v||!1!==v.validate)&&g.emitValidationErrors(this,s.call(g.validateStyle,g.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}const of=new g.Properties({source:new g.DataConstantProperty(g.spec.terrain.source),exaggeration:new g.DataConstantProperty(g.spec.terrain.exaggeration)}),gs="-transition";class yl extends g.Evented{constructor(s){super(),this._transitionable=new g.Transitionable(of),this.set(s),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(s){for(const h in s){const v=s[h];g.endsWith(h,gs)?this._transitionable.setTransition(h.slice(0,-gs.length),v):this._transitionable.setValue(h,v)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}}function vl(_,s,h,v){const E=g.smoothstep(45,65,h),[D,R]=_i(_,v),B=g.length(s);let z=1-Math.min(1,Math.exp((B-D)/(R-D)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*E*_.alpha}function _i(_,s){const h=.5/Math.tan(.5*s);return[_.range[0]+h,_.range[1]+h]}const sc=new g.Properties({range:new g.DataConstantProperty(g.spec.fog.range),color:new g.DataConstantProperty(g.spec.fog.color),"horizon-blend":new g.DataConstantProperty(g.spec.fog["horizon-blend"])}),_s="-transition";class An extends g.Evented{constructor(s){super(),this._transitionable=new g.Transitionable(sc),this.set(s),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(g.validateFog,s,h))for(const v in s){const E=s[v];g.endsWith(v,_s)?this._transitionable.setTransition(v.slice(0,-_s.length),E):this._transitionable.setValue(v,E)}}getOpacity(s){const h=this.properties&&this.properties.get("color")||1;return g.smoothstep(45,65,s)*h.a}getOpacityAtLatLng(s,h){return function(v,E,D){const R=g.MercatorCoordinate.fromLngLat(E),B=D.elevation?D.elevation.getAtPointOrZero(R):0,z=[R.x,R.y,B];return g.transformMat4$1(z,z,D.mercatorFogMatrix),vl(v,z,D.pitch,D._fov)}(this.state,s,h)}getFovAdjustedRange(s){return _i(this.state,s)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,v){return(!v||!1!==v.validate)&&g.emitValidationErrors(this,s.call(g.validateStyle,g.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}class qo{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=g.uniqueId();const v=this.workerPool.acquire(this.id);for(let E=0;E<v.length;E++){const D=new qo.Actor(v[E],h,this.id);D.name=`Worker ${E}`,this.actors.push(D)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,v){g.asyncAll(this.actors,(E,D)=>{E.send(s,h,D)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Or(_,s,h){return s*(g.EXTENT/(_.tileSize*Math.pow(2,h-_.tileID.overscaledZ)))}qo.Actor=g.Actor;class Ua{constructor(s,h,v,E){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(D=>E.pointCoordinate3D(D)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(s,h){let v,E;if(s instanceof g.pointGeometry||"number"==typeof s[0]){const D=g.pointGeometry.convert(s);v=[g.pointGeometry.convert(s)],E=h.isPointAboveHorizon(D)}else{const D=g.pointGeometry.convert(s[0]),R=g.pointGeometry.convert(s[1]);v=[D,R],E=g.polygonizeBounds(D,R).every(B=>h.isPointAboveHorizon(B))}return new Ua(v,h.getCameraPoint(),E,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return g.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new g.pointGeometry(1,1)):this.screenBounds[1],E=g.polygonizeBounds(h,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<v.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?E[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(E[3]=this.cameraPoint)),g.bufferConvexPolygon(E,s)}containsTile(s,h,v){const E=s.queryPadding+1,D=v?this._bufferedCameraMercator(E,h).map(te=>s.tileID.getTilePoint(te)):this._bufferedScreenMercator(E,h).map(te=>s.tileID.getTilePoint(te)),R=this.screenGeometryMercator.map(te=>s.tileID.getTileVec3(te)),B=R.map(te=>new g.pointGeometry(te[0],te[1])),z=h.getFreeCameraOptions().position||new g.MercatorCoordinate(0,0,0),$=s.tileID.getTileVec3(z),H=R.map(te=>{const le=g.sub(te,te,$);return g.normalize(le,le),new hu($,le)}),Q=Or(s,1,h.zoom);if(g.polygonIntersectsBox(D,0,0,g.EXTENT,g.EXTENT))return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:H,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(J=g.getBounds(D),J.min.x=g.clamp(J.min.x,0,g.EXTENT),J.min.y=g.clamp(J.min.y,0,g.EXTENT),J.max.x=g.clamp(J.max.x,0,g.EXTENT),J.max.y=g.clamp(J.max.y,0,g.EXTENT),J),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:Q};var J}_bufferedScreenMercator(s,h){const v=zr(s);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{const E=this.bufferedScreenGeometry(s).map(D=>h.pointCoordinate3D(D));return this._screenRaycastCache[v]=E,E}}_bufferedCameraMercator(s,h){const v=zr(s);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{const E=this.bufferedCameraGeometry(s).map(D=>h.pointCoordinate3D(D));return this._cameraRaycastCache[v]=E,E}}}function zr(_){return 100*_|0}function ys(_,s,h){const v=function(E,D){if(E)return h(E);if(D){const R=g.pick(g.extend(D,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(R.vectorLayers=D.vector_layers,R.vectorLayerIds=R.vectorLayers.map(B=>B.id)),R.tiles=s.canonicalizeTileset(R,_.url),h(null,R)}};return _.url?g.getJSON(s.transformRequest(s.normalizeSourceURL(_.url),g.ResourceType.Source),v):g.exported.frame(()=>v(null,_))}class ja{constructor(s,h,v){this.bounds=g.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=v||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),v=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),E=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),D=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),R=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=v&&s.x<D&&s.y>=E&&s.y<R}}class xl{constructor(s,h,v){this.context=s;const E=s.gl;this.buffer=E.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ga={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $a{constructor(s,h,v,E){this.length=h.length,this.attributes=v,this.itemSize=h.bytesPerElement,this.dynamicDraw=E,this.context=s;const D=s.gl;this.buffer=D.createBuffer(),s.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let v=0;v<this.attributes.length;v++){const E=h.attributes[this.attributes[v].name];void 0!==E&&s.enableVertexAttribArray(E)}}setVertexAttribPointers(s,h,v){for(let E=0;E<this.attributes.length;E++){const D=this.attributes[E],R=h.attributes[D.name];void 0!==R&&s.vertexAttribPointer(R,D.components,s[Ga[D.type]],!1,this.itemSize,D.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Bn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bl extends Bn{getDefault(){return g.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class wl extends Bn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Au extends Bn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class fu extends Bn{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class po extends Bn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class pa extends Bn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Xn extends Bn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class $s extends Bn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Ha extends Bn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Lr extends Bn{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class ma extends Bn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class wd extends Bn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Hs extends Bn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class pu extends Bn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class ga extends Bn{getDefault(){return g.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class pr extends Bn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class qa extends Bn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class mu extends Bn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class vs extends Bn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Zo extends Bn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Eo extends Bn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class gu extends Bn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Cl extends Bn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class yh extends Bn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ac extends Bn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class lc extends Bn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class vh extends Bn{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Cd extends Bn{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class cc extends Bn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class uc extends Bn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Wo extends Bn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Za extends Bn{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class xh extends Za{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class _u extends Za{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Pn extends _u{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _a{constructor(s,h,v,E){this.context=s,this.width=h,this.height=v;const D=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new xh(s,D),E&&(this.depthAttachment=new _u(s,D))}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const v=this.depthAttachment.get();v&&s.deleteRenderbuffer(v)}s.deleteFramebuffer(this.framebuffer)}}class ln{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new bl(this),this.clearDepth=new wl(this),this.clearStencil=new Au(this),this.colorMask=new fu(this),this.depthMask=new po(this),this.stencilMask=new pa(this),this.stencilFunc=new Xn(this),this.stencilOp=new $s(this),this.stencilTest=new Ha(this),this.depthRange=new Lr(this),this.depthTest=new ma(this),this.depthFunc=new wd(this),this.blend=new Hs(this),this.blendFunc=new pu(this),this.blendColor=new ga(this),this.blendEquation=new pr(this),this.cullFace=new qa(this),this.cullFaceSide=new mu(this),this.frontFace=new vs(this),this.program=new Zo(this),this.activeTexture=new Eo(this),this.viewport=new gu(this),this.bindFramebuffer=new Cl(this),this.bindRenderbuffer=new yh(this),this.bindTexture=new ac(this),this.bindVertexBuffer=new lc(this),this.bindElementBuffer=new vh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Cd(this),this.pixelStoreUnpack=new cc(this),this.pixelStoreUnpackPremultiplyAlpha=new uc(this),this.pixelStoreUnpackFlipY=new Wo(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new xl(this,s,h)}createVertexBuffer(s,h,v){return new $a(this,s,h,v)}createRenderbuffer(s,h,v){const E=this.gl,D=E.createRenderbuffer();return this.bindRenderbuffer.set(D),E.renderbufferStorage(E.RENDERBUFFER,s,h,v),this.bindRenderbuffer.set(null),D}createFramebuffer(s,h,v){return new _a(this,s,h,v)}clear({color:s,depth:h,stencil:v}){const E=this.gl;let D=0;s&&(D|=E.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(D|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==v&&(D|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),E.clear(D)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){ut(s.blendFunction,g.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ya extends g.Evented{constructor(s,h,v,E){super(),this.id=s,this.dispatcher=v,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},h),g.extend(this,g.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ys(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new g.ErrorEvent(s)):h&&(g.extend(this,h),h.bounds&&(this.tileBounds=new ja(h.bounds,this.minzoom,this.maxzoom)),g.postTurnstileEvent(h.tiles),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const v=g.exported.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);s.request=g.getImage(this.map._requestManager.transformRequest(E,g.ResourceType.Tile),(D,R,B,z)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(D)s.state="errored",h(D);else if(R){this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:B,expires:z});const $=this.map.painter.context,H=$.gl;s.texture=this.map.painter.getTileTexture(R.width),s.texture?s.texture.update(R,{useMipmap:!0}):(s.texture=new g.Texture($,R,H.RGBA,{useMipmap:!0}),s.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),$.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax)),s.state="loaded",g.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let hc;var Hn=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ne extends g.Evented{constructor(s,h,v,E){super(),this.id=s,this.dispatcher=v,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h}load(s,h){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),(v,E)=>{this._loaded=!0,v?this.fire(new g.ErrorEvent(v)):E&&(this.image=g.exported.getImageData(E),s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const h=s.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(E){let D=1/0,R=1/0,B=-1/0,z=-1/0;for(const J of E)D=Math.min(D,J.x),R=Math.min(R,J.y),B=Math.max(B,J.x),z=Math.max(z,J.y);const $=Math.max(B-D,z-R),H=Math.max(0,Math.floor(-Math.log($)/Math.LN2)),Q=Math.pow(2,H);return new g.CanonicalTileID(H,Math.floor((D+B)/2*Q),Math.floor((R+z)/2*Q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const v=h.map(E=>this.tileID.getTilePoint(E)._round());return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(v[0].x,v[0].y,0,0),this._boundsArray.emplaceBack(v[1].x,v[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(v[3].x,v[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(v[2].x,v[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Hn.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const v in this.tiles){const E=this.tiles[v];"loaded"!==E.state&&(E.state="loaded",E.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Z={vector:class extends g.Evented{constructor(_,s,h,v){if(super(),this.id=_,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(s,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new g.DedupedRequest}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ys(this._options,this.map._requestManager,(_,s)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new g.ErrorEvent(_)):s&&(g.extend(this,s),s.bounds&&(this.tileBounds=new ja(s.bounds,this.minzoom,this.maxzoom)),g.postTurnstileEvent(s.tiles,this.map._requestManager._customAccessToken),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}onAdd(_){this.map=_,this.load()}setSourceProperty(_){this._tileJSONRequest&&this._tileJSONRequest.cancel(),_();const s=this.map.style._getSourceCaches(this.id);for(const h of s)h.clearTiles();this.load()}setTiles(_){return this.setSourceProperty(()=>{this._options.tiles=_}),this}setUrl(_){return this.setSourceProperty(()=>{this.url=_,this._options.url=_}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}loadTile(_,s){const h=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(h,g.ResourceType.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:_.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,_.actor&&"expired"!==_.state)"loading"===_.state?_.reloadCallback=s:_.request=_.actor.send("reloadTile",v,E.bind(this));else if(_.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)_.request=_.actor.send("loadTile",v,E.bind(this),void 0,!0);else{const D=g.loadVectorTile.call({deduped:this._deduped},v,(R,B)=>{R||!B?E.call(this,R):(v.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},_.actor&&_.actor.send("loadTile",v,E.bind(this),void 0,!0))},!0);_.request={cancel:D}}function E(D,R){return delete _.request,_.aborted?s(null):D&&404!==D.status?s(D):(R&&R.resourceTiming&&(_.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&_.setExpiryData(R),_.loadVectorData(R,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id})}unloadTile(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ya,"raster-dem":class extends ya{constructor(_,s,h,v){super(_,s,h,v),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(_,s){const h=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(E,D){E&&(_.state="errored",s(E)),D&&(_.dem=D,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",s(null))}_.request=g.getImage(this.map._requestManager.transformRequest(h,g.ResourceType.Tile),function(E,D,R,B){if(delete _.request,_.aborted)_.state="unloaded",s(null);else if(E)_.state="errored",s(E);else if(D){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:R,expires:B});const z=g.window.ImageBitmap&&D instanceof g.window.ImageBitmap&&(null==hc&&(hc=g.window.OffscreenCanvas&&new g.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof g.window.createImageBitmap),hc),$=1-(D.width-g.prevPowerOfTwo(D.width))/2;$<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const H=z?D:g.exported.getImageData(D,$),Q={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:H,encoding:this.encoding,padding:$};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",Q,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const s=_.canonical,h=Math.pow(2,s.z),v=(s.x-1+h)%h,E=0===s.x?_.wrap-1:_.wrap,D=(s.x+1+h)%h,R=s.x+1===h?_.wrap+1:_.wrap,B={};return B[new g.OverscaledTileID(_.overscaledZ,E,s.z,v,s.y).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,R,s.z,D,s.y).key]={backfilled:!1},s.y>0&&(B[new g.OverscaledTileID(_.overscaledZ,E,s.z,v,s.y-1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,_.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,R,s.z,D,s.y-1).key]={backfilled:!1}),s.y+1<h&&(B[new g.OverscaledTileID(_.overscaledZ,E,s.z,v,s.y+1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,_.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},B[new g.OverscaledTileID(_.overscaledZ,R,s.z,D,s.y+1).key]={backfilled:!1}),B}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends g.Evented{constructor(_,s,h,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(v),this._data=s.data,this._options=g.extend({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const E=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*E,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*E,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:g.EXTENT,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*E,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},s),this}getClusterChildren(_,s){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},s),this}getClusterLeaves(_,s,h,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:s,offset:h},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new g.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=g.extend({},this.workerOptions),s=this._data;"string"==typeof s?(_.request=this.map._requestManager.transformRequest(g.exported.resolveURL(s),g.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(h,v)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new g.ErrorEvent(h));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(E.resourceTiming=v.resourceTiming[this.id]),this.fire(new g.Event("data",E)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,s){const h=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(h,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,E)=>(delete _.request,_.unloadVectorData(),_.aborted?s(null):v?s(v):(_.loadVectorData(E,this.map.painter,"reloadTile"===h),s(null))),void 0,"loadTile"===h)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return g.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ne{constructor(_,s,h,v){super(_,s,h,v),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const s of _.urls)this.urls.push(this.map._requestManager.transformRequest(s,g.ResourceType.Source).url);g.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new g.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const s=this.video.seekable;_<s.start(0)||_>s.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,s=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,Hn.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(_,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const h in this.tiles){const v=this.tiles[h];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ne,canvas:class extends ne{constructor(_,s,h,v){super(_,s,h,v),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(E=>!Array.isArray(E)||2!==E.length||E.some(D=>"number"!=typeof D))||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Hn.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(s,this.canvas,h.RGBA,{premultiply:!0});for(const v in this.tiles){const E=this.tiles[v];"loaded"!==E.state&&(E.state="loaded",E.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}}},Y=function(_,s,h,v){const E=new Z[s.type](_,s,h,v);if(E.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${E.id}`);return g.bindAll(["load","abort","unload","serialize","prepare"],E),E};function ae(_,s){const h=g.identity([]);return g.scale$1(h,h,[.5*_.width,.5*-_.height,1]),g.translate(h,h,[1,-1,0]),g.multiply(h,h,_.calculateProjMatrix(s.toUnwrapped()))}function he(_,s,h,v,E,D,R,B=!1){const z=_.tilesIn(v,R,B);z.sort(we);const $=[];for(const Q of z)$.push({wrappedTileID:Q.tile.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(s,h,_._state,Q,E,D,ae(_.transform,Q.tile.tileID),B)});const H=function(Q){const J={},te={};for(const le of Q){const ce=le.queryResults,_e=le.wrappedTileID,se=te[_e]=te[_e]||{};for(const ue in ce){const ge=ce[ue],ve=se[ue]=se[ue]||{},Se=J[ue]=J[ue]||[];for(const de of ge)ve[de.featureIndex]||(ve[de.featureIndex]=!0,Se.push(de))}}return J}($);for(const Q in H)H[Q].forEach(J=>{const te=J.feature,le=_.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=le});return H}function be(_,s){const h=_.getRenderableIds().map(D=>_.getTileByID(D)),v=[],E={};for(let D=0;D<h.length;D++){const R=h[D],B=R.tileID.canonical.key;E[B]||(E[B]=!0,R.querySourceFeatures(v,s))}return v}function we(_,s){const h=_.tileID,v=s.tileID;return h.overscaledZ-v.overscaledZ||h.canonical.y-v.canonical.y||h.wrap-v.wrap||h.canonical.x-v.canonical.x}function ke(){return null!=Ic.workerClass?new Ic.workerClass:new g.window.Worker(Ic.workerUrl)}const Ee="mapboxgl_preloaded_worker_pool";class Oe{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Oe.workerCount;)this.workers.push(new ke);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ee]}numActive(){return Object.keys(this.active).length}}let Ye;function ft(){return Ye||(Ye=new Oe),Ye}function Xe(_,s){const h={};for(const v in _)"ref"!==v&&(h[v]=_[v]);return g.refProperties.forEach(v=>{v in s&&(h[v]=s[v])}),h}function jt(_){_=_.slice();const s=Object.create(null);for(let h=0;h<_.length;h++)s[_[h].id]=_[h];for(let h=0;h<_.length;h++)"ref"in _[h]&&(_[h]=Xe(_[h],s[_[h].ref]));return _}Oe.workerCount=2;const Ce={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function $e(_,s,h){h.push({command:Ce.addSource,args:[_,s[_]]})}function Gt(_,s,h){s.push({command:Ce.removeSource,args:[_]}),h[_]=!0}function mn(_,s,h,v){Gt(_,h,v),$e(_,s,h)}function on(_,s,h){let v;for(v in _[h])if(_[h].hasOwnProperty(v)&&"data"!==v&&!ut(_[h][v],s[h][v]))return!1;for(v in s[h])if(s[h].hasOwnProperty(v)&&"data"!==v&&!ut(_[h][v],s[h][v]))return!1;return!0}function Kn(_,s,h,v,E,D){let R;for(R in s=s||{},_=_||{})_.hasOwnProperty(R)&&(ut(_[R],s[R])||h.push({command:D,args:[v,R,s[R],E]}));for(R in s)s.hasOwnProperty(R)&&!_.hasOwnProperty(R)&&(ut(_[R],s[R])||h.push({command:D,args:[v,R,s[R],E]}))}function Nn(_){return _.id}function vr(_,s){return _[s.id]=s,_}class Wa{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=g.clamp(s,0,1);let h=1,v=this._distances[h];const E=s*this.paddedLength+this.padding;for(;v<E&&h<this._distances.length;)v=this._distances[++h];const D=h-1,R=this._distances[D],B=v-R,z=B>0?(E-R)/B:0;return this.points[D].mult(1-z).add(this.points[h].mult(z))}}class vt{constructor(s,h,v){const E=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(s/v),this.yCellCount=Math.ceil(h/v);for(let R=0;R<this.xCellCount*this.yCellCount;R++)E.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,v,E,D){this._forEachCell(h,v,E,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(E),this.bboxes.push(D)}insertCircle(s,h,v,E){this._forEachCell(h-E,v-E,h+E,v+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(v),this.circles.push(E)}_insertBoxCell(s,h,v,E,D,R){this.boxCells[D].push(R)}_insertCircleCell(s,h,v,E,D,R){this.circleCells[D].push(R)}_query(s,h,v,E,D,R){if(v<0||s>this.width||E<0||h>this.height)return!D&&[];const B=[];if(s<=0&&h<=0&&this.width<=v&&this.height<=E){if(D)return!0;for(let z=0;z<this.boxKeys.length;z++)B.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const $=this.circles[3*z],H=this.circles[3*z+1],Q=this.circles[3*z+2];B.push({key:this.circleKeys[z],x1:$-Q,y1:H-Q,x2:$+Q,y2:H+Q})}return R?B.filter(R):B}return this._forEachCell(s,h,v,E,this._queryCell,B,{hitTest:D,seenUids:{box:{},circle:{}}},R),D?B.length>0:B}_queryCircle(s,h,v,E,D){const R=s-v,B=s+v,z=h-v,$=h+v;if(B<0||R>this.width||$<0||z>this.height)return!E&&[];const H=[];return this._forEachCell(R,z,B,$,this._queryCellCircle,H,{hitTest:E,circle:{x:s,y:h,radius:v},seenUids:{box:{},circle:{}}},D),E?H.length>0:H}query(s,h,v,E,D){return this._query(s,h,v,E,!1,D)}hitTest(s,h,v,E,D){return this._query(s,h,v,E,!0,D)}hitTestCircle(s,h,v,E){return this._queryCircle(s,h,v,!0,E)}_queryCell(s,h,v,E,D,R,B,z){const $=B.seenUids,H=this.boxCells[D];if(null!==H){const J=this.bboxes;for(const te of H)if(!$.box[te]){$.box[te]=!0;const le=4*te;if(s<=J[le+2]&&h<=J[le+3]&&v>=J[le+0]&&E>=J[le+1]&&(!z||z(this.boxKeys[te]))){if(B.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[te],x1:J[le],y1:J[le+1],x2:J[le+2],y2:J[le+3]})}}}const Q=this.circleCells[D];if(null!==Q){const J=this.circles;for(const te of Q)if(!$.circle[te]){$.circle[te]=!0;const le=3*te;if(this._circleAndRectCollide(J[le],J[le+1],J[le+2],s,h,v,E)&&(!z||z(this.circleKeys[te]))){if(B.hitTest)return R.push(!0),!0;{const ce=J[le],_e=J[le+1],se=J[le+2];R.push({key:this.circleKeys[te],x1:ce-se,y1:_e-se,x2:ce+se,y2:_e+se})}}}}}_queryCellCircle(s,h,v,E,D,R,B,z){const $=B.circle,H=B.seenUids,Q=this.boxCells[D];if(null!==Q){const te=this.bboxes;for(const le of Q)if(!H.box[le]){H.box[le]=!0;const ce=4*le;if(this._circleAndRectCollide($.x,$.y,$.radius,te[ce+0],te[ce+1],te[ce+2],te[ce+3])&&(!z||z(this.boxKeys[le])))return R.push(!0),!0}}const J=this.circleCells[D];if(null!==J){const te=this.circles;for(const le of J)if(!H.circle[le]){H.circle[le]=!0;const ce=3*le;if(this._circlesCollide(te[ce],te[ce+1],te[ce+2],$.x,$.y,$.radius)&&(!z||z(this.circleKeys[le])))return R.push(!0),!0}}}_forEachCell(s,h,v,E,D,R,B,z){const $=this._convertToXCellCoord(s),H=this._convertToYCellCoord(h),Q=this._convertToXCellCoord(v),J=this._convertToYCellCoord(E);for(let te=$;te<=Q;te++)for(let le=H;le<=J;le++)if(D.call(this,s,h,v,E,this.xCellCount*le+te,R,B,z))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,v,E,D,R){const B=E-s,z=D-h,$=v+R;return $*$>B*B+z*z}_circleAndRectCollide(s,h,v,E,D,R,B){const z=(R-E)/2,$=Math.abs(s-(E+z));if($>z+v)return!1;const H=(B-D)/2,Q=Math.abs(h-(D+H));if(Q>H+v)return!1;if($<=z||Q<=H)return!0;const J=$-z,te=Q-H;return J*J+te*te<=v*v}}const vn=Math.tan(85*Math.PI/180);function Wt(_,s,h,v,E){const D=g.create$1();return s?(g.scale$1(D,D,[1/E,1/E,1]),h||g.rotateZ(D,D,v.angle)):g.multiply(D,v.labelPlaneMatrix,_),D}function qn(_,s,h,v,E){if(s){const D=g.clone$1(_);return g.scale$1(D,D,[E,E,1]),h||g.rotateZ(D,D,-v.angle),D}return v.glCoordMatrix}function Yi(_,s,h=0){const v=[_.x,_.y,h,1];h?g.transformMat4(v,v,s):vu(v,v,s);const E=v[3];return{point:new g.pointGeometry(v[0]/E,v[1]/E),signedDistanceFromCamera:E}}function xn(_,s){return Math.min(.5+_/s*.5,1.5)}function Ed(_,s){const h=_[0]/_[3],v=_[1]/_[3];return h>=-s[0]&&h<=s[0]&&v>=-s[1]&&v<=s[1]}function $t(_,s,h,v,E,D,R,B,z){const $=v?_.textSizeData:_.iconSizeData,H=g.evaluateSizeForZoom($,h.transform.zoom),Q=[256/h.width*2+1,256/h.height*2+1],J=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;J.clear();const te=_.lineVertexArray,le=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,ce=h.transform.width/h.transform.height;let _e=!1;for(let se=0;se<le.length;se++){const ue=le.get(se);if(ue.writingMode!==g.WritingMode.vertical||_e||0!==se&&le.get(se-1).writingMode===g.WritingMode.horizontal||(_e=!0),ue.hidden||ue.writingMode===g.WritingMode.vertical&&!_e){Qo(ue.numGlyphs,J);continue}_e=!1;const ge=new g.pointGeometry(ue.tileAnchorX,ue.tileAnchorY),ve=z?z(ge):0,Se=[ge.x,ge.y,ve],de=[...Se,1];if(g.transformMat4(de,de,s),!Ed(de,Q)){Qo(ue.numGlyphs,J);continue}const Fe=xn(h.transform.cameraToCenterDistance,de[3]),We=g.evaluateSizeForFeature($,H,ue),nt=R?We/Fe:We*Fe,Pe=Yi(new g.pointGeometry(Se[0],Se[1]),E,Se[2]);if(Pe.signedDistanceFromCamera<=0){Qo(ue.numGlyphs,J);continue}let Ge={};const xt=R?null:z,Dt=Jn(ue,nt,!1,B,s,E,D,_.glyphOffsetArray,te,J,Pe.point,ge,Ge,ce,xt);_e=Dt.useVertical,xt&&Dt.needsFlipping&&(Ge={}),(Dt.notEnoughRoom||_e||Dt.needsFlipping&&Jn(ue,nt,!0,B,s,E,D,_.glyphOffsetArray,te,J,Pe.point,ge,Ge,ce,xt).notEnoughRoom)&&Qo(ue.numGlyphs,J)}v?_.text.dynamicLayoutVertexBuffer.updateData(J):_.icon.dynamicLayoutVertexBuffer.updateData(J)}function yu(_,s,h,v,E,D,R,B,z,$,H,Q,J){const te=B.glyphStartIndex+B.numGlyphs,le=B.lineStartIndex,ce=B.lineStartIndex+B.lineLength,_e=s.getoffsetX(B.glyphStartIndex),se=s.getoffsetX(te-1),ue=Ac(_*_e,h,v,E,D,R,B.segment,le,ce,z,$,H,Q,J,!0);if(!ue)return null;const ge=Ac(_*se,h,v,E,D,R,B.segment,le,ce,z,$,H,Q,J,!0);return ge?{first:ue,last:ge}:null}function mr(_,s,h,v){return _.writingMode===g.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*v?{useVertical:!0}:_.writingMode===g.WritingMode.vertical?s.y<h.y?{needsFlipping:!0}:null:0!==_.flipState&&function(E,D,R){const B=(D.x-E.x)*R;return 0===B||Math.abs((D.y-E.y)/B)>vn}(s,h,v)?1===_.flipState?{needsFlipping:!0}:null:s.x>h.x?{needsFlipping:!0}:null}function Jn(_,s,h,v,E,D,R,B,z,$,H,Q,J,te,le){const ce=s/24,_e=_.lineOffsetX*ce,se=_.lineOffsetY*ce;let ue;if(_.numGlyphs>1){const ge=_.glyphStartIndex+_.numGlyphs,ve=_.lineStartIndex,Se=_.lineStartIndex+_.lineLength,de=yu(ce,B,_e,se,h,H,Q,_,z,D,J,le,!1);if(!de)return{notEnoughRoom:!0};const Fe=Yi(de.first.point,R).point,We=Yi(de.last.point,R).point;if(v&&!h){const nt=mr(_,Fe,We,te);if(_.flipState=nt&&nt.needsFlipping?1:2,nt)return nt}ue=[de.first];for(let nt=_.glyphStartIndex+1;nt<ge-1;nt++)ue.push(Ac(ce*B.getoffsetX(nt),_e,se,h,H,Q,_.segment,ve,Se,z,D,J,le,!1,!1));ue.push(de.last)}else{if(v&&!h){const ve=Yi(Q,E).point,Se=_.lineStartIndex+_.segment+1,de=new g.pointGeometry(z.getx(Se),z.gety(Se)),Fe=Yi(de,E),We=mr(_,ve,Fe.signedDistanceFromCamera>0?Fe.point:dc(Q,de,ve,1,E,void 0),te);if(_.flipState=We&&We.needsFlipping?1:2,We)return We}const ge=Ac(ce*B.getoffsetX(_.glyphStartIndex),_e,se,h,H,Q,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,z,D,J,le,!1,!1);if(!ge)return{notEnoughRoom:!0};ue=[ge]}for(const ge of ue)g.addDynamicAttributes($,ge.point,ge.angle);return{}}function Dd(_,s,h){const v={x:_.x,y:_.y,z:0};if(!h)return Yi(v,s,v.z);const E=h(_);return Yi(new g.pointGeometry(v.x,v.y),s,v.z+E)}function dc(_,s,h,v,E,D){const R=Dd(_.add(_.sub(s)._unit()),E,D).point,B=h.sub(R);return h.add(B._mult(v/B.mag()))}function Ac(_,s,h,v,E,D,R,B,z,$,H,Q,J,te,le){const ce=v?_-s:_+s;let _e=ce>0?1:-1,se=0;v&&(_e*=-1,se=Math.PI),_e<0&&(se+=Math.PI);let ue=_e>0?B+R:B+R+1,ge=E,ve=E,Se=0,de=0;const Fe=Math.abs(ce),We=[],nt=[];let Pe=D;const Ge=()=>{const wn=ue-_e;return 0===Se?D:new g.pointGeometry($.getx(wn),$.gety(wn))},xt=()=>dc(Ge(),Pe,ve,Fe-Se+1,H,J);for(;Se+de<=Fe;){if(ue+=_e,ue<B||ue>=z)return null;if(ve=ge,We.push(ge),te&&nt.push(Pe||Ge()),ge=Q[ue],void 0===ge){Pe=new g.pointGeometry($.getx(ue),$.gety(ue));const wn=Dd(Pe,H,J);ge=wn.signedDistanceFromCamera>0?Q[ue]=wn.point:xt()}else Pe=null;Se+=de,de=ve.dist(ge)}le&&J&&(Pe=Pe||new g.pointGeometry($.getx(ue),$.gety(ue)),Q[ue]=ge=void 0===Q[ue]?ge:xt(),de=ve.dist(ge));const Dt=(Fe-Se)/de,Et=ge.sub(ve),dt=Et.mult(Dt)._add(ve);h&&dt._add(Et._unit()._perp()._mult(h*_e));const Mt=se+Math.atan2(ge.y-ve.y,ge.x-ve.x);return We.push(dt),te&&(Pe=Pe||new g.pointGeometry($.getx(ue),$.gety(ue)),nt.push(function(wn,Jt,Ur){const wr=1-Ur;return new g.pointGeometry(wn.x*wr+Jt.x*Ur,wn.y*wr+Jt.y*Ur)}(nt.length>0?nt[nt.length-1]:Pe,Pe,Dt))),{point:dt,angle:Mt,path:We,tilePath:nt}}const fc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qo(_,s){for(let h=0;h<_;h++){const v=s.length;s.resize(v+4),s.float32.set(fc,3*v)}}function vu(_,s,h){const v=s[0],E=s[1];return _[0]=h[0]*v+h[4]*E+h[12],_[1]=h[1]*v+h[5]*E+h[13],_[3]=h[3]*v+h[7]*E+h[15],_}const un=100;class Sd{constructor(s,h,v=new vt(s.width+200,s.height+200,25),E=new vt(s.width+200,s.height+200,25)){this.transform=s,this.grid=v,this.ignoredGrid=E,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+un,this.screenBottomBoundary=s.height+un,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,v,E,D,R,B){let z=h.projectedAnchorZ;h.elevation&&(z+=h.elevation);const $=this.projectAndGetPerspectiveRatio(R,h.projectedAnchorX,h.projectedAnchorY,z,h.tileID),H=D*$.perspectiveRatio,Q=(h.x1*s+v.x-h.padding)*H+$.point.x,J=(h.y1*s+v.y-h.padding)*H+$.point.y,te=(h.x2*s+v.x+h.padding)*H+$.point.x,le=(h.y2*s+v.y+h.padding)*H+$.point.y,ce=$.perspectiveRatio<=.55||$.aboveHorizon;return!this.isInsideGrid(Q,J,te,le)||!E&&this.grid.hitTest(Q,J,te,le,B)||ce?{box:[],offscreen:!1}:{box:[Q,J,te,le],offscreen:this.isOffscreen(Q,J,te,le)}}placeCollisionCircles(s,h,v,E,D,R,B,z,$,H,Q,J,te,le){const ce=[],_e=this.transform.elevation,se=_e?xt=>_e.getAtTileOffset(le,xt.x,xt.y):xt=>0,ue=new g.pointGeometry(h.tileAnchorX,h.tileAnchorY),ge=se(ue),ve=this.projectAndGetPerspectiveRatio(R,ue.x,ue.y,ge,le),{perspectiveRatio:Se}=ve,de=(H?D/Se:D*Se)/g.ONE_EM,Fe=Yi(ue,B,ge).point,We=ve.signedDistanceFromCamera>0?yu(de,E,h.lineOffsetX*de,h.lineOffsetY*de,!1,Fe,ue,h,v,B,{},_e&&!H?se:null,H&&!!_e):null;let nt=!1,Pe=!1,Ge=!0;if(We&&!ve.aboveHorizon){const xt=.5*J*Se+te,Dt=new g.pointGeometry(-100,-100),Et=new g.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),dt=new Wa,Mt=We.first,wn=We.last;let Jt=[];for(let cn=Mt.path.length-1;cn>=1;cn--)Jt.push(Mt.path[cn]);for(let cn=1;cn<wn.path.length;cn++)Jt.push(wn.path[cn]);const Ur=2.5*xt;if(z){const cn=Jt.map(_e?(Cn,Br)=>{const go=se(Br<Mt.path.length-1?Mt.tilePath[Mt.path.length-1-Br]:wn.tilePath[Br-Mt.path.length+2]);return Yi(Cn,z,go)}:Cn=>Yi(Cn,z));Jt=cn.some(Cn=>Cn.signedDistanceFromCamera<=0)?[]:cn.map(Cn=>Cn.point)}let wr=[];if(Jt.length>0){const cn=Jt[0].clone(),Cn=Jt[0].clone();for(let Br=1;Br<Jt.length;Br++)cn.x=Math.min(cn.x,Jt[Br].x),cn.y=Math.min(cn.y,Jt[Br].y),Cn.x=Math.max(Cn.x,Jt[Br].x),Cn.y=Math.max(Cn.y,Jt[Br].y);wr=cn.x>=Dt.x&&Cn.x<=Et.x&&cn.y>=Dt.y&&Cn.y<=Et.y?[Jt]:Cn.x<Dt.x||cn.x>Et.x||Cn.y<Dt.y||cn.y>Et.y?[]:g.clipLine([Jt],Dt.x,Dt.y,Et.x,Et.y)}for(const cn of wr){dt.reset(cn,.25*xt);let Cn=0;Cn=dt.length<=.5*xt?1:Math.ceil(dt.paddedLength/Ur)+1;for(let Br=0;Br<Cn;Br++){const go=Br/Math.max(Cn-1,1),Io=dt.lerp(go),ro=Io.x+un,_o=Io.y+un;ce.push(ro,_o,xt,0);const Ds=ro-xt,ko=_o-xt,Tn=ro+xt,Sr=_o+xt;if(Ge=Ge&&this.isOffscreen(Ds,ko,Tn,Sr),Pe=Pe||this.isInsideGrid(Ds,ko,Tn,Sr),!s&&this.grid.hitTestCircle(ro,_o,xt,Q)&&(nt=!0,!$))return{circles:[],offscreen:!1,collisionDetected:nt}}}}return{circles:!$&&nt||!Pe?[]:ce,offscreen:Ge,collisionDetected:nt}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let v=1/0,E=1/0,D=-1/0,R=-1/0;for(const H of s){const Q=new g.pointGeometry(H.x+un,H.y+un);v=Math.min(v,Q.x),E=Math.min(E,Q.y),D=Math.max(D,Q.x),R=Math.max(R,Q.y),h.push(Q)}const B=this.grid.query(v,E,D,R).concat(this.ignoredGrid.query(v,E,D,R)),z={},$={};for(const H of B){const Q=H.key;if(void 0===z[Q.bucketInstanceId]&&(z[Q.bucketInstanceId]={}),z[Q.bucketInstanceId][Q.featureIndex])continue;const J=[new g.pointGeometry(H.x1,H.y1),new g.pointGeometry(H.x2,H.y1),new g.pointGeometry(H.x2,H.y2),new g.pointGeometry(H.x1,H.y2)];g.polygonIntersectsPolygon(h,J)&&(z[Q.bucketInstanceId][Q.featureIndex]=!0,void 0===$[Q.bucketInstanceId]&&($[Q.bucketInstanceId]=[]),$[Q.bucketInstanceId].push(Q.featureIndex))}return $}insertCollisionBox(s,h,v,E,D){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:E,collisionGroupID:D},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,v,E,D){const R=h?this.ignoredGrid:this.grid,B={bucketInstanceId:v,featureIndex:E,collisionGroupID:D};for(let z=0;z<s.length;z+=4)R.insertCircle(B,s[z],s[z+1],s[z+2])}projectAndGetPerspectiveRatio(s,h,v,E,D){const R=[h,v,E||0,1];let B=!1;if(E||this.transform.pitch>0){g.transformMat4(R,R,s);let z=!1;this.fogState&&D&&(z=function($,H,Q,J,te,le){const ce=le.calculateFogTileMatrix(te),_e=[H,Q,J];return g.transformMat4$1(_e,_e,ce),vl($,_e,le.pitch,le._fov)}(this.fogState,h,v,E||0,D.toUnwrapped(),this.transform)>.9),B=R[2]>R[3]||z}else vu(R,R,s);return{point:new g.pointGeometry((R[0]/R[3]+1)/2*this.transform.width+un,(-R[1]/R[3]+1)/2*this.transform.height+un),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/R[3]*.5,1.5),signedDistanceFromCamera:R[3],aboveHorizon:B}}isOffscreen(s,h,v,E){return v<un||s>=this.screenRightBoundary||E<un||h>this.screenBottomBoundary}isInsideGrid(s,h,v,E){return v>=0&&s<this.gridRightBoundary&&E>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=g.identity([]);return g.translate(s,s,[-100,-100,0]),s}}class Qt{constructor(s,h,v,E){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):E&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class di{constructor(s,h,v,E,D){this.text=new Qt(s?s.text:null,h,v,D),this.icon=new Qt(s?s.icon:null,h,E,D)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Oo{constructor(s,h,v){this.text=s,this.icon=h,this.skipFade=v}}class va{constructor(){this.invProjMatrix=g.create$1(),this.viewportMatrix=g.create$1(),this.circles=[]}}class xu{constructor(s,h,v,E,D){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=v,this.bucketIndex=E,this.tileID=D}}class yi{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:v=>v.collisionGroupID===h}}return this.collisionGroups[s]}}function Lo(_,s,h,v,E){const{horizontalAlign:D,verticalAlign:R}=g.getAnchorAlignment(_),B=-(D-.5)*s,z=-(R-.5)*h,$=g.evaluateVariableOffset(_,v);return new g.pointGeometry(B+$[0]*E,z+$[1]*E)}function Ai(_,s,h,v,E){const D=new g.pointGeometry(_,s);return h&&D._rotate(v?E:-E),D}class Ki{constructor(s,h,v,E,D){this.transform=s.clone(),this.collisionIndex=new Sd(this.transform,D),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new yi(v),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,v,E){const D=v.getBucket(h),R=v.latestFeatureIndex;if(!D||!R||h.id!==D.layerIds[0])return;const B=v.collisionBoxArray,z=D.layers[0].layout,$=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),H=v.tileSize/g.EXTENT,Q=this.transform.calculateProjMatrix(v.tileID.toUnwrapped()),J="map"===z.get("text-pitch-alignment"),te="map"===z.get("text-rotation-alignment"),le=Or(v,1,this.transform.zoom),ce=Wt(Q,J,te,this.transform,le);let _e=null;if(J){const ue=qn(Q,J,te,this.transform,le);_e=g.multiply([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[D.bucketInstanceId]=new xu(D.bucketInstanceId,R,D.sourceLayerIndex,D.index,v.tileID);const se={bucket:D,layout:z,posMatrix:Q,textLabelPlaneMatrix:ce,labelToScreenMatrix:_e,scale:$,textPixelRatio:H,holdingForFade:v.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:g.evaluateSizeForZoom(D.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(E)for(const ue of D.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:ve,symbolInstanceEnd:Se}=ue;s.push({sortKey:ge,symbolInstanceStart:ve,symbolInstanceEnd:Se,parameters:se})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:se})}attemptAnchorPlacement(s,h,v,E,D,R,B,z,$,H,Q,J,te,le,ce,_e,se,ue){const ge=[J.textOffset0,J.textOffset1],ve=Lo(s,v,E,ge,D),Se=this.collisionIndex.placeCollisionBox(D,h,Ai(ve.x,ve.y,R,B,this.transform.angle),Q,z,$,H.predicate);if((!_e||0!==this.collisionIndex.placeCollisionBox(le.getSymbolInstanceIconSize(ue,this.transform.zoom,te),_e,Ai(ve.x,ve.y,R,B,this.transform.angle),Q,z,$,H.predicate).box.length)&&Se.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(de=this.prevPlacement.variableOffsets[J.crossTileID].anchor),this.variableOffsets[J.crossTileID]={textOffset:ge,width:v,height:E,anchor:s,textScale:D,prevAnchor:de},this.markUsedJustification(le,s,J,ce),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ce,J),this.placedOrientations[J.crossTileID]=ce),{shift:ve,placedGlyphBoxes:Se}}}placeLayerBucketPart(s,h,v,E){const{bucket:D,layout:R,posMatrix:B,textLabelPlaneMatrix:z,labelToScreenMatrix:$,textPixelRatio:H,holdingForFade:Q,collisionBoxArray:J,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:le,collisionGroup:ce}=s.parameters,_e=R.get("text-optional"),se=R.get("icon-optional"),ue=R.get("text-allow-overlap"),ge=R.get("icon-allow-overlap"),ve="map"===R.get("text-rotation-alignment"),Se="map"===R.get("text-pitch-alignment"),de="none"!==R.get("icon-text-fit"),Fe="viewport-y"===R.get("symbol-z-order"),We=ue&&(ge||!D.hasIconData()||se),nt=ge&&(ue||!D.hasTextData()||_e);!D.collisionArrays&&J&&D.deserializeCollisionBoxes(J),v&&E&&D.updateCollisionDebugBuffers(this.transform.zoom,J);const Pe=(Ge,xt,Dt)=>{if(h[Ge.crossTileID])return;if(Q)return void(this.placements[Ge.crossTileID]=new Oo(!1,!1,!1));let Et=!1,dt=!1,Mt=!0,wn=null,Jt={box:null,offscreen:null},Ur={box:null,offscreen:null},wr=null,cn=null,Cn=null,Br=0,go=0,Io=0;Dt.textFeatureIndex?Br=Dt.textFeatureIndex:Ge.useRuntimeCollisionCircles&&(Br=Ge.featureIndex),Dt.verticalTextFeatureIndex&&(go=Dt.verticalTextFeatureIndex);const ro=Tn=>{Tn.tileID=this.retainedQueryData[D.bucketInstanceId].tileID,(this.transform.elevation||Tn.elevation)&&(Tn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[D.bucketInstanceId].tileID,Tn.tileAnchorX,Tn.tileAnchorY):0)},_o=Dt.textBox;if(_o){ro(_o);const Tn=zn=>{let xr=g.WritingMode.horizontal;if(D.allowVerticalPlacement&&!zn&&this.prevPlacement){const Ci=this.prevPlacement.placedOrientations[Ge.crossTileID];Ci&&(this.placedOrientations[Ge.crossTileID]=Ci,xr=Ci,this.markUsedOrientation(D,xr,Ge))}return xr},Sr=(zn,xr)=>{if(D.allowVerticalPlacement&&Ge.numVerticalGlyphVertices>0&&Dt.verticalTextBox){for(const Ci of D.writingModes)if(Ci===g.WritingMode.vertical?(Jt=xr(),Ur=Jt):Jt=zn(),Jt&&Jt.box&&Jt.box.length)break}else Jt=zn()};if(R.get("text-variable-anchor")){let zn=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ge.crossTileID]){const ir=this.prevPlacement.variableOffsets[Ge.crossTileID];zn.indexOf(ir.anchor)>0&&(zn=zn.filter(ai=>ai!==ir.anchor),zn.unshift(ir.anchor))}const xr=(ir,ai,Po)=>{const io=D.getSymbolInstanceTextSize(te,Ge,this.transform.zoom,xt),Zd=(ir.x2-ir.x1)*io+2*ir.padding,gf=(ir.y2-ir.y1)*io+2*ir.padding,zh=de&&!ge?ai:null;zh&&ro(zh);let kc={box:[],offscreen:!1};const _f=ue?2*zn.length:zn.length;for(let nn=0;nn<_f;++nn){const Vh=this.attemptAnchorPlacement(zn[nn%zn.length],ir,Zd,gf,io,ve,Se,H,B,ce,nn>=zn.length,Ge,xt,D,Po,zh,te,le);if(Vh&&(kc=Vh.placedGlyphBoxes,kc&&kc.box&&kc.box.length)){Et=!0,wn=Vh.shift;break}}return kc};Sr(()=>xr(_o,Dt.iconBox,g.WritingMode.horizontal),()=>{const ir=Dt.verticalTextBox;return ir&&ro(ir),D.allowVerticalPlacement&&!(Jt&&Jt.box&&Jt.box.length)&&Ge.numVerticalGlyphVertices>0&&ir?xr(ir,Dt.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),Jt&&(Et=Jt.box,Mt=Jt.offscreen);const Ci=Tn(Jt&&Jt.box);if(!Et&&this.prevPlacement){const ir=this.prevPlacement.variableOffsets[Ge.crossTileID];ir&&(this.variableOffsets[Ge.crossTileID]=ir,this.markUsedJustification(D,ir.anchor,Ge,Ci))}}else{const zn=(xr,Ci)=>{const ir=D.getSymbolInstanceTextSize(te,Ge,this.transform.zoom,xt),ai=this.collisionIndex.placeCollisionBox(ir,xr,new g.pointGeometry(0,0),ue,H,B,ce.predicate);return ai&&ai.box&&ai.box.length&&(this.markUsedOrientation(D,Ci,Ge),this.placedOrientations[Ge.crossTileID]=Ci),ai};Sr(()=>zn(_o,g.WritingMode.horizontal),()=>{const xr=Dt.verticalTextBox;return D.allowVerticalPlacement&&Ge.numVerticalGlyphVertices>0&&xr?(ro(xr),zn(xr,g.WritingMode.vertical)):{box:null,offscreen:null}}),Tn(Jt&&Jt.box&&Jt.box.length)}}if(wr=Jt,Et=wr&&wr.box&&wr.box.length>0,Mt=wr&&wr.offscreen,Ge.useRuntimeCollisionCircles){const Tn=D.text.placedSymbolArray.get(Ge.centerJustifiedTextSymbolIndex>=0?Ge.centerJustifiedTextSymbolIndex:Ge.verticalPlacedTextSymbolIndex),Sr=g.evaluateSizeForFeature(D.textSizeData,te,Tn),zn=R.get("text-padding");cn=this.collisionIndex.placeCollisionCircles(ue,Tn,D.lineVertexArray,D.glyphOffsetArray,Sr,B,z,$,v,Se,ce.predicate,Ge.collisionCircleDiameter*Sr/g.ONE_EM,zn,this.retainedQueryData[D.bucketInstanceId].tileID),Et=ue||cn.circles.length>0&&!cn.collisionDetected,Mt=Mt&&cn.offscreen}if(Dt.iconFeatureIndex&&(Io=Dt.iconFeatureIndex),Dt.iconBox){const Tn=Sr=>{ro(Sr);const zn=de&&wn?Ai(wn.x,wn.y,ve,Se,this.transform.angle):new g.pointGeometry(0,0),xr=D.getSymbolInstanceIconSize(le,this.transform.zoom,xt);return this.collisionIndex.placeCollisionBox(xr,Sr,zn,ge,H,B,ce.predicate)};Ur&&Ur.box&&Ur.box.length&&Dt.verticalIconBox?(Cn=Tn(Dt.verticalIconBox),dt=Cn.box.length>0):(Cn=Tn(Dt.iconBox),dt=Cn.box.length>0),Mt=Mt&&Cn.offscreen}const Ds=_e||0===Ge.numHorizontalGlyphVertices&&0===Ge.numVerticalGlyphVertices,ko=se||0===Ge.numIconVertices;if(Ds||ko?ko?Ds||(dt=dt&&Et):Et=dt&&Et:dt=Et=dt&&Et,Et&&wr&&wr.box&&this.collisionIndex.insertCollisionBox(wr.box,R.get("text-ignore-placement"),D.bucketInstanceId,Ur&&Ur.box&&go?go:Br,ce.ID),dt&&Cn&&this.collisionIndex.insertCollisionBox(Cn.box,R.get("icon-ignore-placement"),D.bucketInstanceId,Io,ce.ID),cn&&(Et&&this.collisionIndex.insertCollisionCircles(cn.circles,R.get("text-ignore-placement"),D.bucketInstanceId,Br,ce.ID),v)){const Tn=D.bucketInstanceId;let Sr=this.collisionCircleArrays[Tn];void 0===Sr&&(Sr=this.collisionCircleArrays[Tn]=new va);for(let zn=0;zn<cn.circles.length;zn+=4)Sr.circles.push(cn.circles[zn+0]),Sr.circles.push(cn.circles[zn+1]),Sr.circles.push(cn.circles[zn+2]),Sr.circles.push(cn.collisionDetected?1:0)}this.placements[Ge.crossTileID]=new Oo(Et||We,dt||nt,Mt||D.justReloaded),h[Ge.crossTileID]=!0};if(Fe){const Ge=D.getSortedSymbolIndexes(this.transform.angle);for(let xt=Ge.length-1;xt>=0;--xt){const Dt=Ge[xt];Pe(D.symbolInstances.get(Dt),Dt,D.collisionArrays[Dt])}}else for(let Ge=s.symbolInstanceStart;Ge<s.symbolInstanceEnd;Ge++)Pe(D.symbolInstances.get(Ge),Ge,D.collisionArrays[Ge]);if(v&&D.bucketInstanceId in this.collisionCircleArrays){const Ge=this.collisionCircleArrays[D.bucketInstanceId];g.invert(Ge.invProjMatrix,B),Ge.viewportMatrix=this.collisionIndex.getViewportMatrix()}D.justReloaded=!1}markUsedJustification(s,h,v,E){let D;D=E===g.WritingMode.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];const R=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const B of R)B>=0&&(s.text.placedSymbolArray.get(B).crossTileID=D>=0&&B!==D?0:v.crossTileID)}markUsedOrientation(s,h,v){const E=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,D=h===g.WritingMode.vertical?h:0,R=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const B of R)s.text.placedSymbolArray.get(B).placedOrientation=E;v.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=D)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let v=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const E=h?h.symbolFadeChange(s):1,D=h?h.opacities:{},R=h?h.variableOffsets:{},B=h?h.placedOrientations:{};for(const z in this.placements){const $=this.placements[z],H=D[z];H?(this.opacities[z]=new di(H,E,$.text,$.icon),v=v||$.text!==H.text.placed||$.icon!==H.icon.placed):(this.opacities[z]=new di(null,E,$.text,$.icon,$.skipFade),v=v||$.text||$.icon)}for(const z in D){const $=D[z];if(!this.opacities[z]){const H=new di($,E,!1,!1);H.isHidden()||(this.opacities[z]=H,v=v||$.text.placed||$.icon.placed)}}for(const z in R)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=R[z]);for(const z in B)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=B[z]);v?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const v={};for(const E of h){const D=E.getBucket(s);D&&E.latestFeatureIndex&&s.id===D.layerIds[0]&&this.updateBucketOpacities(D,v,E.collisionBoxArray)}}updateBucketOpacities(s,h,v){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const E=s.layers[0].layout,D=new di(null,0,!1,!1,!0),R=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),z=E.get("text-variable-anchor"),$="map"===E.get("text-rotation-alignment"),H="map"===E.get("text-pitch-alignment"),Q="none"!==E.get("icon-text-fit"),J=new di(null,0,R&&(B||!s.hasIconData()||E.get("icon-optional")),B&&(R||!s.hasTextData()||E.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const te=(le,ce,_e)=>{for(let se=0;se<ce/4;se++)le.opacityVertexArray.emplaceBack(_e)};for(let le=0;le<s.symbolInstances.length;le++){const ce=s.symbolInstances.get(le),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:se,crossTileID:ue}=ce;let ge=this.opacities[ue];h[ue]?ge=D:ge||(ge=J,this.opacities[ue]=ge),h[ue]=!0;const ve=ce.numIconVertices>0,Se=this.placedOrientations[ce.crossTileID],de=Se===g.WritingMode.vertical,Fe=Se===g.WritingMode.horizontal||Se===g.WritingMode.horizontalOnly;if(_e>0||se>0){const We=Xo(ge.text);te(s.text,_e,de?Yo:We),te(s.text,se,Fe?Yo:We);const nt=ge.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(xt=>{xt>=0&&(s.text.placedSymbolArray.get(xt).hidden=nt||de?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=nt||Fe?1:0);const Pe=this.variableOffsets[ce.crossTileID];Pe&&this.markUsedJustification(s,Pe.anchor,ce,Se);const Ge=this.placedOrientations[ce.crossTileID];Ge&&(this.markUsedJustification(s,"left",ce,Ge),this.markUsedOrientation(s,Ge,ce))}if(ve){const We=Xo(ge.icon);ce.placedIconSymbolIndex>=0&&(te(s.icon,ce.numIconVertices,de?Yo:We),s.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=ge.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(te(s.icon,ce.numVerticalIconVertices,Fe?Yo:We),s.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const We=s.collisionArrays[le];if(We){let nt=new g.pointGeometry(0,0);if(We.textBox||We.verticalTextBox){let Ge=!0;if(z){const xt=this.variableOffsets[ue];xt?(nt=Lo(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textScale),$&&nt._rotate(H?this.transform.angle:-this.transform.angle)):Ge=!1}We.textBox&&bu(s.textCollisionBox.collisionVertexArray,ge.text.placed,!Ge||de,nt.x,nt.y),We.verticalTextBox&&bu(s.textCollisionBox.collisionVertexArray,ge.text.placed,!Ge||Fe,nt.x,nt.y)}const Pe=Boolean(!Fe&&We.verticalIconBox);We.iconBox&&bu(s.iconCollisionBox.collisionVertexArray,ge.icon.placed,Pe,Q?nt.x:0,Q?nt.y:0),We.verticalIconBox&&bu(s.iconCollisionBox.collisionVertexArray,ge.icon.placed,!Pe,Q?nt.x:0,Q?nt.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=le.invProjMatrix,s.placementViewportMatrix=le.viewportMatrix,s.collisionCircleArray=le.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const v=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*v>s}setStale(){this.stale=!0}}function bu(_,s,h,v,E){_.emplaceBack(s?1:0,h?1:0,v||0,E||0),_.emplaceBack(s?1:0,h?1:0,v||0,E||0),_.emplaceBack(s?1:0,h?1:0,v||0,E||0),_.emplaceBack(s?1:0,h?1:0,v||0,E||0)}const gr=Math.pow(2,25),wu=Math.pow(2,24),bh=Math.pow(2,17),rm=Math.pow(2,16),El=Math.pow(2,9),lr=Math.pow(2,8),im=Math.pow(2,1);function Xo(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const s=_.placed?1:0,h=Math.floor(127*_.opacity);return h*gr+s*wu+h*bh+s*rm+h*El+s*lr+h*im+s}const Yo=0;class Zn{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,v,E,D){const R=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(R,E,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((B,z)=>B.sortKey-z.sortKey));this._currentPartIndex<R.length;){const B=R[this._currentPartIndex];if(h.placeLayerBucketPart(B,this._seenCrossTileIDs,v,0===B.symbolInstanceStart),this._currentPartIndex++,D())return!0}return!1}}class pc{constructor(s,h,v,E,D,R,B,z){this.placement=new Ki(s,D,R,B,z),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(s,h,v){const E=g.exported.now(),D=()=>{const R=g.exported.now()-E;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=h[s[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if("symbol"===R.type&&(!R.minzoom||R.minzoom<=B)&&(!R.maxzoom||R.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Zn(R)),this._inProgressLayer.continuePlacement(v[R.source],this.placement,this._showCollisionBoxes,R,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const mc=512/g.EXTENT/2;class Md{constructor(s,h,v){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=v;for(let E=0;E<h.length;E++){const D=h.get(E),R=D.key;this.indexedSymbolInstances[R]||(this.indexedSymbolInstances[R]=[]),this.indexedSymbolInstances[R].push({crossTileID:D.crossTileID,coord:this.getScaledCoordinates(D,s)})}}getScaledCoordinates(s,h){const v=mc/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+s.tileAnchorX)*v),y:Math.floor((h.canonical.y*g.EXTENT+s.tileAnchorY)*v)}}findMatches(s,h,v){const E=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let D=0;D<s.length;D++){const R=s.get(D);if(R.crossTileID)continue;const B=this.indexedSymbolInstances[R.key];if(!B)continue;const z=this.getScaledCoordinates(R,h);for(const $ of B)if(Math.abs($.coord.x-z.x)<=E&&Math.abs($.coord.y-z.y)<=E&&!v[$.crossTileID]){v[$.crossTileID]=!0,R.crossTileID=$.crossTileID;break}}}}class sf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Td{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(0!==h)for(const v in this.indexes){const E=this.indexes[v],D={};for(const R in E){const B=E[R];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+h),D[B.tileID.key]=B}this.indexes[v]=D}this.lng=s}addBucket(s,h,v){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let D=0;D<h.symbolInstances.length;D++)h.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const E=this.usedCrossTileIDs[s.overscaledZ];for(const D in this.indexes){const R=this.indexes[D];if(Number(D)>s.overscaledZ)for(const B in R){const z=R[B];z.tileID.isChildOf(s)&&z.findMatches(h.symbolInstances,s,E)}else{const B=R[s.scaledTo(Number(D)).key];B&&B.findMatches(h.symbolInstances,s,E)}}for(let D=0;D<h.symbolInstances.length;D++){const R=h.symbolInstances.get(D);R.crossTileID||(R.crossTileID=v.generate(),E[R.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Md(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const v in h.indexedSymbolInstances)for(const E of h.indexedSymbolInstances[v])delete this.usedCrossTileIDs[s][E.crossTileID]}removeStaleBuckets(s){let h=!1;for(const v in this.indexes){const E=this.indexes[v];for(const D in E)s[E[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,E[D]),delete E[D],h=!0)}return h}}class qs{constructor(){this.layerIndexes={},this.crossTileIDs=new sf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,v){let E=this.layerIndexes[s.id];void 0===E&&(E=this.layerIndexes[s.id]=new Td);let D=!1;const R={};E.handleWrapJump(v);for(const B of h){const z=B.getBucket(s);z&&s.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(B.tileID,z,this.crossTileIDs)&&(D=!0),R[z.bucketInstanceId]=!0)}return E.removeStaleBuckets(R)&&(D=!0),D}pruneUnusedLayers(s){const h={};s.forEach(v=>{h[v]=!0});for(const v in this.layerIndexes)h[v]||delete this.layerIndexes[v]}}const xa=(_,s)=>g.emitValidationErrors(_,s&&s.filter(h=>"source.canvas"!==h.identifier)),om=g.pick(Ce,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Bo=g.pick(Ce,["setCenter","setZoom","setBearing","setPitch"]),sm=function(){const _={},s=g.spec.$version;for(const h in g.spec.$root){const v=g.spec.$root[h];if(v.required){let E=null;E="version"===h?s:"array"===v.type?[]:{},null!=E&&(_[h]=E)}}return _}(),wh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ko extends g.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new qo(ft(),this),this.imageManager=new Va,this.imageManager.setEventedParent(this),this.glyphManager=new g.GlyphManager(s._requestManager,h.localFontFamily?g.LocalGlyphMode.all:h.localIdeographFontFamily?g.LocalGlyphMode.ideographs:g.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new g.LineAtlas(256,512),this.crossTileSymbolIndex=new qs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());const v=this;this._rtlTextPluginCallback=Ko.registerForPluginStateChange(E=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(D,R)=>{if(g.triggerPluginCompletionEvent(D),R&&R.every(B=>B))for(const B in v._sourceCaches){const z=v._sourceCaches[B],$=z.getSource().type;"vector"!==$&&"geojson"!==$||z.reload()}})}),this.on("data",E=>{if("source"!==E.dataType||"metadata"!==E.sourceDataType)return;const D=this.getSource(E.sourceId);if(D&&D.vectorLayerIds)for(const R in this._layers){const B=this._layers[R];B.source===D.id&&this._validateLayer(B)}})}loadURL(s,h={}){this.fire(new g.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof h.validate?h.validate:!g.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);const E=this.map._requestManager.transformRequest(s,g.ResourceType.Style);this._request=g.getJSON(E,(D,R)=>{this._request=null,D?this.fire(new g.ErrorEvent(D)):R&&this._load(R,v)})}loadJSON(s,h={}){this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.exported.frame(()=>{this._request=null,this._load(s,!1!==h.validate)})}loadEmpty(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(sm,!1)}_updateLayerCount(s,h){const v=h?1:-1;s.is3D()&&(this._num3DLayers+=v),"circle"===s.type&&(this._numCircleLayers+=v),"symbol"===s.type&&(this._numSymbolLayers+=v)}_load(s,h){if(h&&xa(this,g.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const E in s.sources)this.addSource(E,s.sources[E],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const v=jt(this.stylesheet.layers);this._order=v.map(E=>E.id),this._layers={},this._serializedLayers={};for(let E of v)E=g.createStyleLayer(E),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new hi(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(h,v,E){let D,R,B;const z=g.exported.devicePixelRatio>1?"@2x":"";let $=g.getJSON(v.transformRequest(v.normalizeSpriteURL(h,z,".json"),g.ResourceType.SpriteJSON),(J,te)=>{$=null,B||(B=J,D=te,Q())}),H=g.getImage(v.transformRequest(v.normalizeSpriteURL(h,z,".png"),g.ResourceType.SpriteImage),(J,te)=>{H=null,B||(B=J,R=te,Q())});function Q(){if(B)E(B);else if(D&&R){const J=g.exported.getImageData(R),te={};for(const le in D){const{width:ce,height:_e,x:se,y:ue,sdf:ge,pixelRatio:ve,stretchX:Se,stretchY:de,content:Fe}=D[le],We=new g.RGBAImage({width:ce,height:_e});g.RGBAImage.copy(J,We,{x:se,y:ue},{x:0,y:0},{width:ce,height:_e}),te[le]={data:We,pixelRatio:ve,sdf:ge,stretchX:Se,stretchY:de,content:Fe}}E(null,te)}}return{cancel(){$&&($.cancel(),$=null),H&&(H.cancel(),H=null)}}}(s,this.map._requestManager,(h,v)=>{if(this._spriteRequest=null,h)this.fire(new g.ErrorEvent(h));else if(v)for(const E in v)this.imageManager.addImage(E,v[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new g.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.getSource(s.source);if(!h)return;const v=s.sourceLayer;v&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(v))&&this.fire(new g.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const v of s){const E=this._layers[v];"custom"!==E.type&&h.push(E.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&wh[s.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(E.length||D.length)&&this._updateWorkerLayers(E,D);for(const R in this._updatedSources){const B=this._updatedSources[R];"reload"===B?this._reloadSource(R):"clear"===B&&this._clearSource(R)}this._updateTilesForChangedImages();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const v={};for(const E in this._sourceCaches){const D=this._sourceCaches[E];v[E]=D.used,D.used=!1}for(const E of this._order){const D=this._layers[E];if(D.recalculate(s,this._availableImages),!D.isHidden(s.zoom)){const B=this._getLayerSourceCache(D);B&&(B.used=!0)}const R=this.map.painter;if(R){const B=D.getProgramIds();if(!B)continue;const z=D.getProgramConfiguration(s.zoom);for(const $ of B)R.useProgram($,z)}}for(const E in v){const D=this._sourceCaches[E];v[E]!==D.used&&D.getSource().fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new g.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),xa(this,g.validateStyle(s)))return!1;(s=g.clone$2(s)).layers=jt(s.layers);const h=function(E,D){if(!E)return[{command:Ce.setStyle,args:[D]}];let R=[];try{if(!ut(E.version,D.version))return[{command:Ce.setStyle,args:[D]}];ut(E.center,D.center)||R.push({command:Ce.setCenter,args:[D.center]}),ut(E.zoom,D.zoom)||R.push({command:Ce.setZoom,args:[D.zoom]}),ut(E.bearing,D.bearing)||R.push({command:Ce.setBearing,args:[D.bearing]}),ut(E.pitch,D.pitch)||R.push({command:Ce.setPitch,args:[D.pitch]}),ut(E.sprite,D.sprite)||R.push({command:Ce.setSprite,args:[D.sprite]}),ut(E.glyphs,D.glyphs)||R.push({command:Ce.setGlyphs,args:[D.glyphs]}),ut(E.transition,D.transition)||R.push({command:Ce.setTransition,args:[D.transition]}),ut(E.light,D.light)||R.push({command:Ce.setLight,args:[D.light]}),ut(E.fog,D.fog)||R.push({command:Ce.setFog,args:[D.fog]});const B={},z=[];!function(Q,J,te,le){let ce;for(ce in J=J||{},Q=Q||{})Q.hasOwnProperty(ce)&&(J.hasOwnProperty(ce)||Gt(ce,te,le));for(ce in J)J.hasOwnProperty(ce)&&(Q.hasOwnProperty(ce)?ut(Q[ce],J[ce])||("geojson"===Q[ce].type&&"geojson"===J[ce].type&&on(Q,J,ce)?te.push({command:Ce.setGeoJSONSourceData,args:[ce,J[ce].data]}):mn(ce,J,te,le)):$e(ce,J,te))}(E.sources,D.sources,z,B);const $=[];E.layers&&E.layers.forEach(Q=>{B[Q.source]?R.push({command:Ce.removeLayer,args:[Q.id]}):$.push(Q)});let H=E.terrain;H&&B[H.source]&&(R.push({command:Ce.setTerrain,args:[void 0]}),H=void 0),R=R.concat(z),ut(H,D.terrain)||R.push({command:Ce.setTerrain,args:[D.terrain]}),function(Q,J,te){J=J||[];const le=(Q=Q||[]).map(Nn),ce=J.map(Nn),_e=Q.reduce(vr,{}),se=J.reduce(vr,{}),ue=le.slice(),ge=Object.create(null);let ve,Se,de,Fe,We,nt,Pe;for(ve=0,Se=0;ve<le.length;ve++)de=le[ve],se.hasOwnProperty(de)?Se++:(te.push({command:Ce.removeLayer,args:[de]}),ue.splice(ue.indexOf(de,Se),1));for(ve=0,Se=0;ve<ce.length;ve++)de=ce[ce.length-1-ve],ue[ue.length-1-ve]!==de&&(_e.hasOwnProperty(de)?(te.push({command:Ce.removeLayer,args:[de]}),ue.splice(ue.lastIndexOf(de,ue.length-Se),1)):Se++,nt=ue[ue.length-ve],te.push({command:Ce.addLayer,args:[se[de],nt]}),ue.splice(ue.length-ve,0,de),ge[de]=!0);for(ve=0;ve<ce.length;ve++)if(de=ce[ve],Fe=_e[de],We=se[de],!ge[de]&&!ut(Fe,We))if(ut(Fe.source,We.source)&&ut(Fe["source-layer"],We["source-layer"])&&ut(Fe.type,We.type)){for(Pe in Kn(Fe.layout,We.layout,te,de,null,Ce.setLayoutProperty),Kn(Fe.paint,We.paint,te,de,null,Ce.setPaintProperty),ut(Fe.filter,We.filter)||te.push({command:Ce.setFilter,args:[de,We.filter]}),ut(Fe.minzoom,We.minzoom)&&ut(Fe.maxzoom,We.maxzoom)||te.push({command:Ce.setLayerZoomRange,args:[de,We.minzoom,We.maxzoom]}),Fe)Fe.hasOwnProperty(Pe)&&"layout"!==Pe&&"paint"!==Pe&&"filter"!==Pe&&"metadata"!==Pe&&"minzoom"!==Pe&&"maxzoom"!==Pe&&(0===Pe.indexOf("paint.")?Kn(Fe[Pe],We[Pe],te,de,Pe.slice(6),Ce.setPaintProperty):ut(Fe[Pe],We[Pe])||te.push({command:Ce.setLayerProperty,args:[de,Pe,We[Pe]]}));for(Pe in We)We.hasOwnProperty(Pe)&&!Fe.hasOwnProperty(Pe)&&"layout"!==Pe&&"paint"!==Pe&&"filter"!==Pe&&"metadata"!==Pe&&"minzoom"!==Pe&&"maxzoom"!==Pe&&(0===Pe.indexOf("paint.")?Kn(Fe[Pe],We[Pe],te,de,Pe.slice(6),Ce.setPaintProperty):ut(Fe[Pe],We[Pe])||te.push({command:Ce.setLayerProperty,args:[de,Pe,We[Pe]]}))}else te.push({command:Ce.removeLayer,args:[de]}),nt=ue[ue.lastIndexOf(de)+1],te.push({command:Ce.addLayer,args:[We,nt]})}($,D.layers,R)}catch(B){console.warn("Unable to compute style diff:",B),R=[{command:Ce.setStyle,args:[D]}]}return R}(this.serialize(),s).filter(E=>!(E.command in Bo));if(0===h.length)return!1;const v=h.filter(E=>!(E.command in om));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);return h.forEach(E=>{"setTransition"!==E.command&&this[E.command].apply(this,E.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,v={}){if(this._checkLoaded(),void 0!==this.getSource(s))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(g.validateStyle.source,`sources.${s}`,h,null,v))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const E=Y(s,h,this.dispatcher,this);E.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:E.serialize(),sourceId:s}));const D=R=>{const B=(R?"symbol:":"other:")+s,z=this._sourceCaches[B]=new g.SourceCache(B,E,R);(R?this._symbolSourceCaches:this._otherSourceCaches)[s]=z,z.style=this,z.onAdd(this.map)};D(!1),"vector"!==h.type&&"geojson"!==h.type||D(!0),E.onAdd&&E.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const h=this.getSource(s);if(void 0===h)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===s)return this.fire(new g.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new g.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(s);for(const E of v)delete this._sourceCaches[E.id],delete this._updatedSources[E.id],E.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles();delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){const h=this._getSourceCache(s);return h&&h.getSource()}addLayer(s,h,v={}){this._checkLoaded();const E=s.id;if(this.getLayer(E))return void this.fire(new g.ErrorEvent(new Error(`Layer with id "${E}" already exists on this map`)));let D;if("custom"===s.type){if(xa(this,g.validateCustomStyleLayer(s)))return;D=g.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(E,s.source),s=g.clone$2(s),s=g.extend(s,{source:E})),this._validate(g.validateStyle.layer,`layers.${E}`,s,{arrayIndex:-1},v))return;D=g.createStyleLayer(s),this._validateLayer(D),D.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[D.id]=D.serialize(),this._updateLayerCount(D,!0)}const R=h?this._order.indexOf(h):this._order.length;if(h&&-1===R)return void this.fire(new g.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(R,0,E),this._layerOrderChanged=!0,this._layers[E]=D;const B=this._getLayerSourceCache(D);if(this._removedLayers[E]&&D.source&&B&&"custom"!==D.type){const z=this._removedLayers[E];delete this._removedLayers[E],z.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",B.pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const v=this._order.indexOf(s);this._order.splice(v,1);const E=h?this._order.indexOf(h):this._order.length;h&&-1===E?this.fire(new g.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(E,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const v=this._order.indexOf(s);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,v){this._checkLoaded();const E=this.getLayer(s);E?E.minzoom===h&&E.maxzoom===v||(null!=h&&(E.minzoom=h),null!=v&&(E.maxzoom=v),this._updateLayer(E)):this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,v={}){this._checkLoaded();const E=this.getLayer(s);if(E){if(!ut(E.filter,h))return null==h?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(g.validateStyle.filter,`layers.${E.id}.filter`,h,null,v)||(E.filter=g.clone$2(h),this._updateLayer(E)))}else this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){return g.clone$2(this.getLayer(s).filter)}setLayoutProperty(s,h,v,E={}){this._checkLoaded();const D=this.getLayer(s);D?ut(D.getLayoutProperty(h),v)||(D.setLayoutProperty(h,v,E),this._updateLayer(D)):this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){const v=this.getLayer(s);if(v)return v.getLayoutProperty(h);this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,v,E={}){this._checkLoaded();const D=this.getLayer(s);D?ut(D.getPaintProperty(h),v)||(D.setPaintProperty(h,v,E)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new g.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const v=s.source,E=s.sourceLayer,D=this.getSource(v);if(void 0===D)return void this.fire(new g.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const R=D.type;if("geojson"===R&&E)return void this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===R&&!E)return void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided.")));const B=this._getSourceCaches(v);for(const z of B)z.setFeatureState(E,s.id,h)}removeFeatureState(s,h){this._checkLoaded();const v=s.source,E=this.getSource(v);if(void 0===E)return void this.fire(new g.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const D=E.type,R="vector"===D?s.sourceLayer:void 0;if("vector"===D&&!R)return void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const B=this._getSourceCaches(v);for(const z of B)z.removeFeatureState(R,s.id,h)}getFeatureState(s){this._checkLoaded();const h=s.source,v=s.sourceLayer,E=this.getSource(h);if(void 0!==E){if("vector"!==E.type||v)return void 0===s.id&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(v,s.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const h in this._sourceCaches){const v=this._sourceCaches[h].getSource();s[v.id]||(s[v.id]=v.serialize())}return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(s){this._updatedLayers[s.id]=!0;const h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=R=>"fill-extrusion"===this._layers[R].type,v={},E=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(h(B)){v[B]=R;for(const z of s){const $=z[B];if($)for(const H of $)E.push(H)}}}E.sort((R,B)=>B.intersectionZ-R.intersectionZ);const D=[];for(let R=this._order.length-1;R>=0;R--){const B=this._order[R];if(h(B))for(let z=E.length-1;z>=0;z--){const $=E[z].feature;if(v[$.layer.id]<R)break;D.push($),E.pop()}else for(const z of s){const $=z[B];if($)for(const H of $)D.push(H.feature)}}return D}queryRenderedFeatures(s,h,v){h&&h.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const z of h.layers){const $=this._layers[z];if(!$)return this.fire(new g.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];E[$.source]=!0}}const D=[];h.availableImages=this._availableImages;const R=h&&h.layers?h.layers.some(z=>{const $=this.getLayer(z);return $&&$.is3D()}):this.has3DLayers(),B=Ua.createFromScreenPoints(s,v);for(const z in this._sourceCaches){const $=this._sourceCaches[z].getSource().id;h.layers&&!E[$]||D.push(he(this._sourceCaches[z],this._layers,this._serializedLayers,B,h,v,R,!!this.map._showQueryGeometry))}return this.placement&&D.push(function(z,$,H,Q,J,te,le){const ce={},_e=te.queryRenderedSymbols(Q),se=[];for(const ue of Object.keys(_e).map(Number))se.push(le[ue]);se.sort(we);for(const ue of se){const ge=ue.featureIndex.lookupSymbolFeatures(_e[ue.bucketInstanceId],$,ue.bucketIndex,ue.sourceLayerIndex,J.filter,J.layers,J.availableImages,z);for(const ve in ge){const Se=ce[ve]=ce[ve]||[],de=ge[ve];de.sort((Fe,We)=>{const nt=ue.featureSortOrder;if(nt){const Pe=nt.indexOf(Fe.featureIndex);return nt.indexOf(We.featureIndex)-Pe}return We.featureIndex-Fe.featureIndex});for(const Fe of de)Se.push(Fe)}}for(const ue in ce)ce[ue].forEach(ge=>{const ve=ge.feature,Se=H(z[ue]).getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Se});return ce}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),B.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(s,h){h&&h.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const v=this._getSourceCaches(s);let E=[];for(const D of v)E=E.concat(be(D,h));return E}addSourceType(s,h,v){return Ko.getSourceType(s)?v(new Error(`A source type called "${s}" already exists.`)):(Ko.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const v=this.light.getLight();let E=!1;for(const R in s)if(!ut(s[R],v[R])){E=!0;break}if(!E)return;const D={now:g.exported.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(D)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(s){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof s.source){const h="terrain-dem-src";this.addSource(h,s.source),s=g.clone$2(s),s=g.extend(s,{source:h})}if(!this._validate(g.validateStyle.terrain,"terrain",s)){if(this.terrain){const h=this.terrain,v=h.get();for(const E in s)if(!ut(s[E],v[E])){h.set(s),this.stylesheet.terrain=s;const D={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(D);break}}else this._createTerrain(s);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(s){const h=this.fog=new An(s);this.stylesheet.fog=s;const v={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,v=h.get();for(const E in s)if(!ut(s[E],v[E])){h.set(s),this.stylesheet.fog=s;const D={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(D);break}}else this._createFog(s);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(v=>this.isLayerDraped(this._layers[v])),h=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s){const h=this.terrain=new yl(s);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:g.exported.now(),transition:g.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];"fill-extrusion"===h.type&&this._updateLayer(h)}}_validate(s,h,v,E,D={}){return(!D||!1!==D.validate)&&xa(this,s.call(g.validateStyle,g.extend({key:h,style:this.serialize(),value:v,styleSpec:g.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const h=this._getSourceCaches(s);for(const v of h)v.clearTiles()}_reloadSource(s){const h=this._getSourceCaches(s);for(const v of h)v.resume(),v.reload()}_updateSources(s){for(const h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,v,E,D=!1){let R=!1,B=!1;const z={};for(const $ of this._order){const H=this._layers[$];if("symbol"!==H.type)continue;if(!z[H.source]){const J=this._getLayerSourceCache(H);if(!J)continue;z[H.source]=J.getRenderableIds(!0).map(te=>J.getTileByID(te)).sort((te,le)=>le.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(le.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(H,z[H.source],s.center.lng);R=R||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),D=D||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new g.Event("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.exported.now(),s.zoom))&&(this.pauseablePlacement=new pc(s,this._order,D,h,v,E,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.exported.now()),B=!0),R&&this.pauseablePlacement.placement.setStale()),B||R)for(const $ of this._order){const H=this._layers[$];"symbol"===H.type&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,v){this.imageManager.getImages(h.icons,v),this._updateTilesForChangedImages();const E=D=>{D&&D.setDependencies(h.tileID.key,h.type,h.icons)};E(this._otherSourceCaches[h.source]),E(this._symbolSourceCaches[h.source])}getGlyphs(s,h,v){this.glyphManager.getGlyphs(h.stacks,v)}getResource(s,h,v){return g.makeRequest(h,v)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Ko.getSourceType=function(_){return Z[_]},Ko.setSourceType=function(_,s){Z[_]=s},Ko.registerForPluginStateChange=g.registerForPluginStateChange;var Ch="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ui="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Cu={},Jo={};Cu=fn("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),Jo=fn("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Xt=fn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),vi=Ch;var Pi={background:fn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:fn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:fn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:fn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:fn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:fn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:fn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:fn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:fn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:fn("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:fn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:fn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:fn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:fn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:fn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:fn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:fn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:fn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:fn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:fn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:fn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ui),skyboxGradient:fn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ui),skyboxCapture:fn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fn("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:fn("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:fn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function fn(_,s,h){const v=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,E=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,D=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),R=_.match(E),B=s.match(E),z=Ch.match(E);let $=B?B.concat(R):R;h||(Cu.staticUniforms&&($=Cu.staticUniforms.concat($)),Jo.staticUniforms&&($=Jo.staticUniforms.concat($))),$&&($=$.concat(z));const H={};return{fragmentSource:_=_.replace(v,(Q,J,te,le,ce)=>(H[ce]=!0,"define"===J?`\n#ifndef HAS_UNIFORM_u_${ce}\nvarying ${te} ${le} ${ce};\n#else\nuniform ${te} ${le} u_${ce};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${ce}\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`)),vertexSource:s=s.replace(v,(Q,J,te,le,ce)=>{const _e="float"===le?"vec2":"vec4",se=ce.match(/color/)?"color":_e;return H[ce]?"define"===J?`\n#ifndef HAS_UNIFORM_u_${ce}\nuniform lowp float u_${ce}_t;\nattribute ${te} ${_e} a_${ce};\nvarying ${te} ${le} ${ce};\n#else\nuniform ${te} ${le} u_${ce};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${ce} = a_${ce};\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${ce} = unpack_mix_${se}(a_${ce}, u_${ce}_t);\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`:"define"===J?`\n#ifndef HAS_UNIFORM_u_${ce}\nuniform lowp float u_${ce}_t;\nattribute ${te} ${_e} a_${ce};\n#else\nuniform ${te} ${le} u_${ce};\n#endif\n`:"vec4"===se?`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${te} ${le} ${ce} = a_${ce};\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ce}\n    ${te} ${le} ${ce} = unpack_mix_${se}(a_${ce}, u_${ce}_t);\n#else\n    ${te} ${le} ${ce} = u_${ce};\n#endif\n`}),staticAttributes:D,staticUniforms:$}}class Zs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,v,E,D,R,B,z){this.context=s;let $=this.boundPaintVertexBuffers.length!==E.length;for(let H=0;!$&&H<E.length;H++)this.boundPaintVertexBuffers[H]!==E[H]&&($=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===v&&!$&&this.boundIndexBuffer===D&&this.boundVertexOffset===R&&this.boundDynamicVertexBuffer===B&&this.boundDynamicVertexBuffer2===z?(s.bindVertexArrayOES.set(this.vao),B&&B.bind(),D&&D.dynamicDraw&&D.bind(),z&&z.bind()):this.freshBind(h,v,E,D,R,B,z)}freshBind(s,h,v,E,D,R,B){let z;const $=s.numAttributes,H=this.context,Q=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=E,this.boundVertexOffset=D,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=B;else{z=H.currentNumAttributes||0;for(let J=$;J<z;J++)Q.disableVertexAttribArray(J)}h.enableAttributes(Q,s);for(const J of v)J.enableAttributes(Q,s);R&&R.enableAttributes(Q,s),B&&B.enableAttributes(Q,s),h.bind(),h.setVertexAttribPointers(Q,s,D);for(const J of v)J.bind(),J.setVertexAttribPointers(Q,s,D);R&&(R.bind(),R.setVertexAttribPointers(Q,s,D)),E&&E.bind(),B&&(B.bind(),B.setVertexAttribPointers(Q,s,D)),H.currentNumAttributes=$}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Do(_,s){const h=Math.pow(2,s.canonical.z),v=s.canonical.y;return[new g.MercatorCoordinate(0,v/h).toLngLat().lat,new g.MercatorCoordinate(0,(v+1)/h).toLngLat().lat]}function Eh(_,s,h,v,E,D,R){const B=_.context,z=B.gl,$=h.fbo;if(!$)return;_.prepareDrawTile(s);const H=_.useProgram("hillshade");B.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,$.colorAttachment.get());const Q=((J,te,le,ce)=>{const _e=le.paint.get("hillshade-shadow-color"),se=le.paint.get("hillshade-highlight-color"),ue=le.paint.get("hillshade-accent-color");let ge=le.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===le.paint.get("hillshade-illumination-anchor")&&(ge-=J.transform.angle);const ve=!J.options.moving;return{u_matrix:ce||J.transform.calculateProjMatrix(te.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Do(0,te.tileID),u_light:[le.paint.get("hillshade-exaggeration"),ge],u_shadow:_e,u_highlight:se,u_accent:ue}})(_,h,v,_.terrain?s.projMatrix:null);_.prepareDrawProgram(B,H,s.toUnwrapped()),H.draw(B,z.TRIANGLES,E,D,R,g.CullFaceMode.disabled,Q,v.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function ji(_,s,h){if(!s.needsDEMTextureUpload)return;const v=_.context,E=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture(h.stride);const D=h.getPixels();s.demTexture?s.demTexture.update(D,{premultiply:!1}):s.demTexture=new g.Texture(v,D,E.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function ht(_,s,h,v,E,D){const R=_.context,B=R.gl;if(!s.dem)return;const z=s.dem;if(R.activeTexture.set(B.TEXTURE1),ji(_,s,z),!s.demTexture)return;s.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);const $=z.dim;R.activeTexture.set(B.TEXTURE0);let H=s.fbo;if(!H){const Q=new g.Texture(R,{width:$,height:$,data:null},B.RGBA);Q.bind(B.LINEAR,B.CLAMP_TO_EDGE),H=s.fbo=R.createFramebuffer($,$,!0),H.colorAttachment.set(Q.texture)}R.bindFramebuffer.set(H.framebuffer),R.viewport.set([0,0,$,$]),_.useProgram("hillshadePrepare").draw(R,B.TRIANGLES,v,E,D,g.CullFaceMode.disabled,((Q,J)=>{const te=J.stride,le=g.create$1();return g.ortho(le,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(le,le,[0,-g.EXTENT,0]),{u_matrix:le,u_image:1,u_dimension:[te,te],u_zoom:Q.overscaledZ,u_unpack:J.unpackVector}})(s.tileID,z),h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),s.needsHillshadePrepare=!1}const bn=(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_image0:new g.Uniform1i(_,s.u_image0),u_skirt_height:new g.Uniform1f(_,s.u_skirt_height)}),Er=(_,s)=>({u_matrix:_,u_image0:0,u_skirt_height:s}),Ji=new class{constructor(){this.operations={}}newMorphing(_,s,h,v,E){if(_ in this.operations){const D=this.operations[_];D.to.tileID.key!==h.tileID.key&&(D.queued=h)}else this.operations[_]={startTime:v,phase:0,duration:E,from:s,to:h,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const s=this.operations[_];return{from:s.from,to:s.to,phase:s.phase}}update(_){for(const s in this.operations){const h=this.operations[s];for(h.phase=(_-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,_)){delete this.operations[s];break}}}_nextOp(_,s){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=s,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},ba={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function fi(_,s){const h=1<<_.z;return!s&&(0===_.x||_.x===h-1)||0===_.y||_.y===h-1}const Ws=_=>({u_matrix:_});function Qr(_,s,h,v,E){if(E>0){const D=g.exported.now(),R=(D-_.timeAdded)/E,B=s?(D-s.timeAdded)/E:-1,z=h.getSource(),$=v.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),H=!s||Math.abs(s.tileID.overscaledZ-$)>Math.abs(_.tileID.overscaledZ-$),Q=H&&_.refreshedUponExpiration?1:g.clamp(H?R:1-B,0,1);return _.refreshedUponExpiration&&R>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}class Eu extends g.SourceCache{constructor(s){const h=Y("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new qo(ft(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,v){if(s.freezeTileCoverage)return;this.transform=s;const E=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((D,R)=>{if(D[R.key]="",!this._tiles[R.key]){const B=new g.Tile(R,this._source.tileSize*R.overscaleFactor(),s.tileZoom);B.state="loaded",this._tiles[R.key]=B}return D},{});for(const D in this._tiles)D in E||(this.freeFBO(D),this._tiles[D].unloadVectorData(),delete this._tiles[D])}freeFBO(s){const h=this.proxyCachedFBO[s];if(void 0!==h){const v=Object.values(h);this.renderCachePool.push(...v),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wa extends g.OverscaledTileID{constructor(s,h,v){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=v}}class gn extends g.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,E,D]=function(z){const $=new g.StructArrayLayout4i8,H=new g.StructArrayLayout3ui6,Q=131;$.reserve(17161),H.reserve(33800);const J=g.EXTENT/128,te=g.EXTENT+J/2,le=te+J;for(let _e=-J;_e<le;_e+=J)for(let se=-J;se<le;se+=J){const ue=se<0||se>te||_e<0||_e>te?24575:0,ge=g.clamp(Math.round(se),0,g.EXTENT),ve=g.clamp(Math.round(_e),0,g.EXTENT);$.emplaceBack(ge+ue,ve,ge,ve)}const ce=(_e,se)=>{const ue=se*Q+_e;H.emplaceBack(ue+1,ue,ue+Q),H.emplaceBack(ue+Q,ue+Q+1,ue+1)};for(let _e=1;_e<129;_e++)for(let se=1;se<129;se++)ce(se,_e);return[0,129].forEach(_e=>{for(let se=0;se<130;se++)ce(se,_e),ce(_e,se)}),[$,H,32768]}(),R=s.context;this.gridBuffer=R.createVertexBuffer(v,Hn.members),this.gridIndexBuffer=R.createIndexBuffer(E),this.gridSegments=g.SegmentVector.simpleSegment(0,0,v.length,E.length),this.gridNoSkirtSegments=g.SegmentVector.simpleSegment(0,0,v.length,D),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Eu(h.map),this.orthoMatrix=g.create$1(),g.ortho(this.orthoMatrix,0,g.EXTENT,0,g.EXTENT,0,1);const B=R.gl;this._overlapStencilMode=new g.StencilMode({func:B.GEQUAL,mask:255},0,255,B.KEEP,B.KEEP,B.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency()}update(s,h,v){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const E=s.terrain.properties;this.sourceCache=s._getSourceCache(E.get("source")),this._exaggeration=E.get("exaggeration");const D=()=>{this.sourceCache.used&&g.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.sourceCache.getSource().tileSize/128,B=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(h,R*B,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),h.updateElevation(!v),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==s.efficiency&&g.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=h.getIds().map(z=>{const $=h.getTileByID(z).tileID;return $.projMatrix=v.calculateProjMatrix($.toUnwrapped()),$});(function(z,$){const H=$.transform.pointCoordinate($.transform.getCameraPoint()),Q=new g.pointGeometry(H.x,H.y);z.sort((J,te)=>{if(te.overscaledZ-J.overscaledZ)return te.overscaledZ-J.overscaledZ;const le=new g.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ce=new g.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),_e=Q.mult(1<<J.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(le)-_e.distSqr(ce)})})(E,this.painter),this._previousZoom=v.zoom;const D=this.proxyToSource||{};this.proxyToSource={},E.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const R=this._style._sourceCaches;for(const z in R){const $=R[z];if(!$.used||($!==this.sourceCache&&(this._findCoveringTileCache[$.id]={}),this._setupProxiedCoordsForOrtho($,s[z],D),$.usedForTerrain))continue;const H=s[z];$.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[h.id]=E.map(z=>new wa(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(D),this.renderingToTexture=!1,this._updateTimestamp=g.exported.now();const B={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const $=this.terrainTileForTile[z.key];if(!$)continue;const H=$.tileID.key;H in B||(this._visibleDemTiles.push($),B[H]=H)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const v=this._findTileCoveringTileID(h,this.sourceCache);v&&(this.terrainTileForTile[h.key]=v)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const v in this.terrainTileForTile){const E=this.terrainTileForTile[v],D=E.dem;!D||E.demTexture&&!E.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),ji(this.painter,E,D))}}_prepareDemTileUniforms(s,h,v,E){if(!h||null==h.demTexture)return!1;const D=s.tileID.canonical,R=Math.pow(2,h.tileID.canonical.z-D.z),B=E||"";return v[`u_dem_tl${B}`]=[D.x*R%1,D.y*R%1],v[`u_dem_scale${B}`]=R,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let s=0;const h=this._visibleDemTiles.reduce((v,E)=>{if(!E.dem)return v;const D=E.dem.tree.minimums[0];return D>0&&s++,v+D},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const v=this._getLoadedAreaMinimum(),E={width:1,height:1,data:new Uint8Array(g.DEMData.pack(v,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let D=this._emptyDEMTexture;return D?D.update(E,{premultiply:!1}):D=this._emptyDEMTexture=new g.Texture(s,E,h.RGBA,{premultiply:!1}),D}setupElevationDraw(s,h,v){const E=this.painter.context,D=E.gl,R=(B=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:g.DEMData.getUnpackVector(B),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var B;R.u_dem_size=this.sourceCache.getSource().tileSize,R.u_exaggeration=this.exaggeration();let z=null,$=null,H=1;if(v&&v.morphing&&this._useVertexMorphing){const Q=v.morphing.srcDemTile,J=v.morphing.dstDemTile;H=v.morphing.phase,Q&&J&&(this._prepareDemTileUniforms(s,Q,R,"_prev")&&($=Q),this._prepareDemTileUniforms(s,J,R)&&(z=J))}if($&&z?(E.activeTexture.set(D.TEXTURE2),z.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),E.activeTexture.set(D.TEXTURE4),$.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),R.u_dem_lerp=H):(z=this.terrainTileForTile[s.tileID.key],E.activeTexture.set(D.TEXTURE2),(this._prepareDemTileUniforms(s,z,R)?z.demTexture:this.emptyDEMTexture).bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST)),v&&v.useDepthForOcclusion&&(E.activeTexture.set(D.TEXTURE3),this._depthTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),R.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),v&&v.useMeterToDem&&z){const Q=(1<<z.tileID.canonical.z)*g.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;R.u_meter_to_dem=Q}v&&v.labelPlaneMatrixInv&&(R.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),h.setTerrainUniformValues(E,R)}renderToBackBuffer(s){const h=this.painter,v=this.painter.context;0!==s.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(E,D,R,B,z){const $=E.context,H=$.gl;let Q,J;const te=E.options.showTerrainWireframe?2:0,le=(ge,ve)=>{if(J===ge)return;const Se=[ba[ge]];ve&&Se.push(ba[te]),Q=E.useProgram("terrainRaster",null,Se),J=ge},ce=E.colorModeForRenderPass(),_e=new g.DepthMode(H.LEQUAL,g.DepthMode.ReadWrite,E.depthRangeFor3D);Ji.update(z);const se=E.transform,ue=6*Math.pow(1.5,22-se.zoom)*D.exaggeration();(te?[!1,!0]:[!1]).forEach(ge=>{J=-1;const ve=ge?H.LINES:H.TRIANGLES,[Se,de]=ge?D.getWirefameBuffer():[D.gridIndexBuffer,D.gridSegments];for(const nt of B){const Pe=R.getTile(nt),Ge=g.StencilMode.disabled,xt=D.prevTerrainTileForTile[nt.key],Dt=D.terrainTileForTile[nt.key];We=Dt,null!=(Fe=xt)&&null!=We&&Fe.hasData()&&We.hasData()&&null!=Fe.demTexture&&null!=We.demTexture&&Fe.tileID.key!==We.tileID.key&&Ji.newMorphing(nt.key,xt,Dt,z,250),$.activeTexture.set(H.TEXTURE0),Pe.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST);const Et=Ji.getMorphValuesForProxy(nt.key),dt=Et?1:0;let Mt;Et&&(Mt={morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:g.easeCubicInOut(Et.phase)}});const wn=Er(nt.projMatrix,fi(nt.canonical,se.renderWorldCopies)?ue/10:ue);le(dt,ge),D.setupElevationDraw(Pe,Q,Mt),E.prepareDrawProgram($,Q,nt.toUnwrapped()),Q.draw($,ve,_e,Ge,ce,g.CullFaceMode.backCCW,wn,"terrain_raster",D.gridBuffer,Se,de)}var Fe,We})}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const h=this.painter,v=this.painter.context,E=this.proxySourceCache,D=this.proxiedCoords[E.id],R=this._drapedRenderBatches.shift(),B=[],z=h.style.order;let $=0;for(const H of D){const Q=E.getTileByID(H.proxyTileKey),J=E.proxyCachedFBO[H.key]?E.proxyCachedFBO[H.key][s]:void 0,te=void 0!==J?E.renderCache[J]:this.pool[$++],le=void 0!==J;if(Q.texture=te.tex,le&&!te.dirty){B.push(Q.tileID);continue}let ce;v.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(v.clear({color:g.Color.transparent}),te.dirty=!1);for(let _e=R.start;_e<=R.end;++_e){const se=h.style._layers[z[_e]];if(se.isHidden(h.transform.zoom))continue;const ue=h.style._getLayerSourceCache(se),ge=ue?this.proxyToSource[H.key][ue.id]:[H];if(!ge)continue;const ve=ge;v.viewport.set([0,0,te.fb.width,te.fb.height]),ce!==(ue?ue.id:null)&&(this._setupStencil(te,ge,se,ue),ce=ue?ue.id:null),h.renderLayer(h,ue,se,ve)}this.renderedToTile?(te.dirty=!0,B.push(Q.tileID)):le||--$,5===$&&($=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),R.end+1}postRender(){}renderCacheEfficiency(s){const h=s.order.length;if(0===h)return{efficiency:100};let v,E=0,D=0,R=!1;for(let B=0;B<h;++B){const z=s._layers[s.order[B]];this._style.isLayerDraped(z)?(R&&++E,++D):R||(R=!0,v=z.id)}return 0===D?{efficiency:100}:{efficiency:100*(1-E/D),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,h,v){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(D=>D.dem).map(D=>{const R=D.tileID,B=Math.pow(2,R.overscaledZ),{x:z,y:$}=R.canonical,H=z/B,Q=(z+1)/B,J=$/B,te=($+1)/B;return{minx:H,miny:J,maxx:Q,maxy:te,t:D.dem.tree.raycastRoot(H,J,Q,te,s,h,v),tile:D}});E.sort((D,R)=>(null!==D.t?D.t:Number.MAX_VALUE)-(null!==R.t?R.t:Number.MAX_VALUE));for(const D of E){if(null==D.t)return null;const R=D.tile.dem.tree.raycast(D.minx,D.miny,D.maxx,D.maxy,s,h,v);if(null!=R)return R}return null}_createFBO(){const s=this.painter.context,h=s.gl,v=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const E=new g.Texture(s,{width:v[0],height:v[1],data:null},h.RGBA);E.bind(h.LINEAR,h.CLAMP_TO_EDGE);const D=s.createFramebuffer(v[0],v[1],!1);return D.colorAttachment.set(E.texture),D.depthAttachment=new Pn(s,D.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,D.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):D.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:D,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._layers[s],v=h.isHidden(this.painter.transform.zoom),E=h.getCrossfadeParameters(),D=!!E&&1!==E.t,R=h.hasTransition();return"custom"!==h.type&&!v&&(D||R)})}_clearRasterFadeFromRenderCache(){let s=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof ya){s=!0;break}if(s)for(let h=0;h<this._style.order.length;++h){const v=this._style._layers[this._style.order[h]],E=v.isHidden(this.painter.transform.zoom),D=this._style._getLayerSourceCache(v);if("raster"!==v.type||E||!D)continue;const R=v.paint.get("raster-fade-duration");for(const B of this.proxyCoords){const z=this.proxyToSource[B.key][D.id];if(z)for(const $ of z){const H=Qr(D.getTile($),D.findLoadedParent($,0),D,this.painter.transform,R);(1!==H.opacity||0!==H.mix)&&this._clearRenderCacheForTile(D.id,$)}}}}_setupDrapedRenderBatches(){const s=this._style.order,h=s.length;if(0===h)return;const v=[];let E,D=0,R=this._style._layers[s[D]];for(;!this._style.isLayerDraped(R)&&R.isHidden(this.painter.transform.zoom)&&++D<h;)R=this._style._layers[s[D]];for(;D<h;++D){const B=this._style._layers[s[D]];B.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(B)?void 0===E&&(E=D):void 0!==E&&(v.push({start:E,end:D-1}),E=void 0))}void 0!==E&&v.push({start:E,end:D-1}),this._drapedRenderBatches=v}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const R=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let B=0;B<R.length;++B){const z=Object.values(R[B]);h.renderCachePool.push(...z)}}return}this._clearRasterFadeFromRenderCache();const v=this.proxyCoords,E=this._tilesDirty;for(let R=v.length-1;R>=0;R--){const B=v[R];if(h.getTileByID(B.key),void 0!==h.proxyCachedFBO[B.key]){const z=s[B.key],$=this.proxyToSource[B.key];let H=0;for(const Q in $){const J=$[Q],te=z[Q];if(!te||te.length!==J.length||J.some((le,ce)=>le!==te[ce]||E[Q]&&E[Q].hasOwnProperty(le.key))){H=-1;break}++H}for(const Q in h.proxyCachedFBO[B.key])h.renderCache[h.proxyCachedFBO[B.key][Q]].dirty=H<0||H!==Object.values(z).length}}const D=[...this._drapedRenderBatches];D.sort((R,B)=>B.end-B.start-(R.end-R.start));for(const R of D)for(const B of v){if(h.proxyCachedFBO[B.key])continue;let z=h.renderCachePool.pop();void 0===z&&h.renderCache.length<50&&(z=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==z&&(h.proxyCachedFBO[B.key]={},h.proxyCachedFBO[B.key][R.start]=z,h.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,v,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const D=this.painter.context,R=D.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let B;if(v.isTileClipped())B=h.length,this._overlapStencilMode.test={func:R.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);B=1,this._overlapStencilMode.test={func:R.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+B>255&&(D.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=B,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):g.StencilMode.disabled}_renderTileClippingMasks(s,h){const v=this.painter,E=this.painter.context,D=E.gl;v._tileClippingMaskIDs={},E.setColorMode(g.ColorMode.disabled),E.setDepthMode(g.DepthMode.disabled);const R=v.useProgram("clippingMask");for(const B of s){const z=v._tileClippingMaskIDs[B.key]=--h;R.draw(E,D.TRIANGLES,g.DepthMode.disabled,new g.StencilMode({func:D.ALWAYS,mask:0},z,255,D.KEEP,D.KEEP,D.REPLACE),g.ColorMode.disabled,g.CullFaceMode.disabled,Ws(B.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const v=[s.x,s.y,1,1];g.transformMat4(v,v,h.pixelMatrixInverse),g.scale$2(v,v,1/v[3]),v[0]/=h.worldSize,v[1]/=h.worldSize;const E=h._camera.position,D=g.mercatorZfromAltitude(1,h.center.lat),R=[E[0],E[1],E[2]/D,0],B=g.subtract([],v.slice(0,3),R);g.normalize(B,B);const z=this.raycast(R,B,this._exaggeration);return null!==z&&z?(g.scaleAndAdd(R,R,B,z),R[3]=R[2],R[2]*=D,R):null}drawDepth(){const s=this.painter,h=s.context,v=this.proxySourceCache,E=Math.ceil(s.width),D=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===E&&this._depthFBO.height===D||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const R=h.gl,B=h.createFramebuffer(E,D,!0);h.activeTexture.set(R.TEXTURE0);const z=new g.Texture(h,{width:E,height:D,data:null},R.RGBA);z.bind(R.NEAREST,R.CLAMP_TO_EDGE),B.colorAttachment.set(z.texture);const $=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,E,D);B.depthAttachment.set($),this._depthFBO=B,this._depthTexture=z}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,E,D]),function(R,B,z,$){const H=R.context,Q=H.gl;H.clear({depth:1});const J=R.useProgram("terrainDepth"),te=new g.DepthMode(Q.LESS,g.DepthMode.ReadWrite,R.depthRangeFor3D);for(const le of $){const ce=z.getTile(le),_e=Er(le.projMatrix,0);B.setupElevationDraw(ce,J),J.draw(H,Q.TRIANGLES,te,g.StencilMode.disabled,g.ColorMode.unblended,g.CullFaceMode.backCCW,_e,"terrain_depth",B.gridBuffer,B.gridIndexBuffer,B.gridNoSkirtSegments)}}(s,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,v){if(s.getSource()instanceof ne)return this._setupProxiedCoordsForImageSource(s,h,v);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const E=this.proxiedCoords[s.id]=[],D=this.proxyCoords;for(let B=0;B<D.length;B++){const z=D[B],$=this._findTileCoveringTileID(z,s);if($){const H=this._createProxiedId(z,$,v[z.key]&&v[z.key][s.id]);E.push(H),this.proxyToSource[z.key][s.id]=[H]}}let R=!1;for(let B=0;B<h.length;B++){const z=s.getTile(h[B]);if(!z||!z.hasData())continue;const $=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==z.tileID.canonical.z){const H=this.proxyToSource[$.tileID.key][s.id],Q=this._createProxiedId($.tileID,z,v[$.tileID.key]&&v[$.tileID.key][s.id]);H?H.splice(H.length-1,0,Q):this.proxyToSource[$.tileID.key][s.id]=[Q],E.push(Q),R=!0}}this._sourceTilesOverlap[s.id]=R}_setupProxiedCoordsForImageSource(s,h,v){if(!s.getSource().loaded())return;const E=this.proxiedCoords[s.id]=[],D=this.proxyCoords,R=s.getSource(),B=new g.pointGeometry(R.tileID.x,R.tileID.y)._div(1<<R.tileID.z),z=R.coordinates.map(g.MercatorCoordinate.fromLngLat).reduce((H,Q)=>(H.min.x=Math.min(H.min.x,Q.x-B.x),H.min.y=Math.min(H.min.y,Q.y-B.y),H.max.x=Math.max(H.max.x,Q.x-B.x),H.max.y=Math.max(H.max.y,Q.y-B.y),H),{min:new g.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new g.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(H,Q)=>{const J=H.wrap+H.canonical.x/(1<<H.canonical.z),te=H.canonical.y/(1<<H.canonical.z),le=g.EXTENT/(1<<H.canonical.z),ce=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),_e=Q.canonical.y/(1<<Q.canonical.z);return J+le<ce+z.min.x||J>ce+z.max.x||te+le<_e+z.min.y||te>_e+z.max.y};for(let H=0;H<D.length;H++){const Q=D[H];for(let J=0;J<h.length;J++){const te=s.getTile(h[J]);if(!te||!te.hasData()||$(Q,te.tileID))continue;const le=this._createProxiedId(Q,te,v[Q.key]&&v[Q.key][s.id]),ce=this.proxyToSource[Q.key][s.id];ce?ce.push(le):this.proxyToSource[Q.key][s.id]=[le],E.push(le)}}}_createProxiedId(s,h,v){let E=this.orthoMatrix;if(v){const D=v.find(R=>R.key===h.tileID.key);if(D)return D}if(h.tileID.key!==s.key){const D=s.canonical.z-h.tileID.canonical.z;let R,B,z;E=g.create$1();const $=h.tileID.wrap-s.wrap<<s.overscaledZ;D>0?(R=g.EXTENT>>D,B=R*((h.tileID.canonical.x<<D)-s.canonical.x+$),z=R*((h.tileID.canonical.y<<D)-s.canonical.y)):(R=g.EXTENT<<-D,B=g.EXTENT*(h.tileID.canonical.x-(s.canonical.x+$<<-D)),z=g.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-D))),g.ortho(E,0,R,0,R,0,1),g.translate(E,E,[B,z,0])}return new wa(h.tileID,s.key,E)}_findTileCoveringTileID(s,h){let v=h.getTile(s);if(v&&v.hasData())return v;const E=this._findCoveringTileCache[h.id],D=E[s.key];if(v=D?h.getTileByID(D):null,v&&v.hasData()||null===D)return v;let R=v?v.tileID:s,B=R.overscaledZ;const z=h.getSource().minzoom,$=[];if(!D){const Q=h.getSource().maxzoom;if(s.canonical.z>=Q){const J=s.canonical.z-Q;h.getSource().reparseOverscaled?(B=Math.max(s.canonical.z+2,h.transform.tileZoom),R=new g.OverscaledTileID(B,s.wrap,Q,s.canonical.x>>J,s.canonical.y>>J)):0!==J&&(B=Q,R=new g.OverscaledTileID(B,s.wrap,Q,s.canonical.x>>J,s.canonical.y>>J))}R.key!==s.key&&($.push(R.key),v=h.getTile(R))}const H=Q=>{$.forEach(J=>{E[J]=Q}),$.length=0};for(B-=1;B>=z&&(!v||!v.hasData());B--){v&&H(v.tileID.key);const Q=R.calculateScaledKey(B);if(v=h.getTileByID(Q),v&&v.hasData())break;const J=E[Q];if(null===J)break;void 0===J?$.push(Q):v=h.getTileByID(J)}return H(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(s){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let v=this._tilesDirty[s];v||(v=this._tilesDirty[s]={}),v[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(h){let v,E,D;const R=new g.StructArrayLayout2ui4,B=131;for(E=1;E<129;E++){for(v=1;v<129;v++)D=E*B+v,R.emplaceBack(D,D+1),R.emplaceBack(D,D+B),R.emplaceBack(D+1,D+B),128===E&&R.emplaceBack(D+B,D+B+1);R.emplaceBack(D+1,D+1+B)}return R}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=g.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Dl(_){const s=[];for(let h=0;h<_.length;h++){if(null===_[h])continue;const v=_[h].split(" ");s.push(v.pop())}return s}class Ca{static cacheKey(s,h,v){let E=`${s}${v?v.cacheKey:""}`;for(const D of h)E+=`/${D}`;return E}constructor(s,h,v,E,D,R){const B=s.gl;this.program=B.createProgram();const z=Dl(v.staticAttributes),$=E?E.getBinderAttributes():[],H=z.concat($),Q=v.staticUniforms?Dl(v.staticUniforms):[],J=E?E.getBinderUniforms():[],te=Q.concat(J),le=[];for(const Se of te)le.indexOf(Se)<0&&le.push(Se);let ce=E?E.defines():[];ce=ce.concat(R.map(Se=>`#define ${Se}`));const _e=ce.concat(Xt.fragmentSource,vi,Jo.fragmentSource,v.fragmentSource).join("\n"),se=ce.concat(Xt.vertexSource,vi,Jo.vertexSource,Cu.vertexSource,v.vertexSource).join("\n"),ue=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(ue,_e),B.compileShader(ue),B.attachShader(this.program,ue);const ge=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(ge,se),B.compileShader(ge),B.attachShader(this.program,ge),this.attributes={};const ve={};this.numAttributes=H.length;for(let Se=0;Se<this.numAttributes;Se++)H[Se]&&(B.bindAttribLocation(this.program,Se,H[Se]),this.attributes[H[Se]]=Se);B.linkProgram(this.program),B.deleteShader(ge),B.deleteShader(ue);for(let Se=0;Se<le.length;Se++){const de=le[Se];if(de&&!ve[de]){const Fe=B.getUniformLocation(this.program,de);Fe&&(ve[de]=Fe)}}var Se,de;this.fixedUniforms=D(s,ve),this.binderUniforms=E?E.getUniforms(s,ve):[],-1!==R.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new g.Uniform1i(Se=s,(de=ve).u_dem),u_dem_prev:new g.Uniform1i(Se,de.u_dem_prev),u_dem_unpack:new g.Uniform4f(Se,de.u_dem_unpack),u_dem_tl:new g.Uniform2f(Se,de.u_dem_tl),u_dem_scale:new g.Uniform1f(Se,de.u_dem_scale),u_dem_tl_prev:new g.Uniform2f(Se,de.u_dem_tl_prev),u_dem_scale_prev:new g.Uniform1f(Se,de.u_dem_scale_prev),u_dem_size:new g.Uniform1f(Se,de.u_dem_size),u_dem_lerp:new g.Uniform1f(Se,de.u_dem_lerp),u_exaggeration:new g.Uniform1f(Se,de.u_exaggeration),u_depth:new g.Uniform1i(Se,de.u_depth),u_depth_size_inv:new g.Uniform2f(Se,de.u_depth_size_inv),u_meter_to_dem:new g.Uniform1f(Se,de.u_meter_to_dem),u_label_plane_matrix_inv:new g.UniformMatrix4f(Se,de.u_label_plane_matrix_inv),u_tile_tl_up:new g.Uniform3f(Se,de.u_tile_tl_up),u_tile_tr_up:new g.Uniform3f(Se,de.u_tile_tr_up),u_tile_br_up:new g.Uniform3f(Se,de.u_tile_br_up),u_tile_bl_up:new g.Uniform3f(Se,de.u_tile_bl_up),u_tile_up_scale:new g.Uniform1f(Se,de.u_tile_up_scale)}),-1!==R.indexOf("FOG")&&(this.fogUniforms=((Se,de)=>({u_fog_matrix:new g.UniformMatrix4f(Se,de.u_fog_matrix),u_fog_range:new g.Uniform2f(Se,de.u_fog_range),u_fog_color:new g.Uniform4f(Se,de.u_fog_color),u_fog_horizon_blend:new g.Uniform1f(Se,de.u_fog_horizon_blend),u_fog_temporal_offset:new g.Uniform1f(Se,de.u_fog_temporal_offset)}))(s,ve))}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const E in h)v[E].set(h[E])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const E in h)v[E].location&&v[E].set(h[E])}}draw(s,h,v,E,D,R,B,z,$,H,Q,J,te,le,ce,_e){const se=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(v),s.setStencilMode(E),s.setColorMode(D),s.setCullFace(R);for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(B[ge]);le&&le.setUniforms(s,this.binderUniforms,J,{zoom:te});const ue={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[h];for(const ge of Q.get()){const ve=ge.vaos||(ge.vaos={});(ve[z]||(ve[z]=new Zs)).bind(s,this,$,le?le.getPaintVertexBuffers():[],H,ge.vertexOffset,ce,_e),se.drawElements(h,ge.primitiveLength*ue,se.UNSIGNED_SHORT,ge.primitiveOffset*ue*2)}}}function Du(_,s,h){const v=1/Or(h,1,s.transform.tileZoom),E=Math.pow(2,h.tileID.overscaledZ),D=h.tileSize*Math.pow(2,s.transform.tileZoom)/E,R=D*(h.tileID.canonical.x+h.tileID.wrap*E),B=D*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[v,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[R>>16,B>>16],u_pixel_coord_lower:[65535&R,65535&B]}}const Qa=(_,s,h,v)=>{const E=s.style.light,D=E.properties.get("position"),R=[D.x,D.y,D.z],B=g.create$2();"viewport"===E.properties.get("anchor")&&(g.fromRotation(B,-s.transform.angle),g.transformMat3(R,R,B));const z=E.properties.get("color");return{u_matrix:_,u_lightpos:R,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+h,u_opacity:v}},So=(_,s,h,v,E,D,R)=>g.extend(Qa(_,s,h,v),Du(D,s,R),{u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8}),Qs=_=>({u_matrix:_}),xs=(_,s,h,v)=>g.extend(Qs(_),Du(h,s,v)),es=(_,s)=>({u_matrix:_,u_world:s}),Rn=(_,s,h,v,E)=>g.extend(xs(_,s,h,v),{u_world:E}),Id=(_,s,h,v)=>{const E=_.transform;let D;if("map"===v.paint.get("circle-pitch-alignment")){const R=Or(h,1,E.zoom);D=[R,R]}else D=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:_.translatePosMatrix(s.projMatrix,h,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:g.exported.devicePixelRatio,u_extrude_scale:D}},Dh=_=>{const s=[];return"map"===_.paint.get("circle-pitch-alignment")&&s.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&s.push("SCALE_WITH_MAP"),s},Sl=(_,s,h)=>{const v=g.EXTENT/h.tileSize;return{u_matrix:_,u_camera_to_center_distance:s.cameraToCenterDistance,u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},gc=(_,s,h=1)=>({u_matrix:_,u_color:s,u_overlay:0,u_overlay_scale:h}),Ml=(_,s,h,v)=>({u_matrix:_,u_extrude_scale:Or(s,1,h),u_intensity:v}),Tl=(_,s,h,v,E,D)=>{const R=_.transform,B={u_matrix:Su(_,s,h,E),u_ratio:1/Or(s,1,R.zoom),u_device_pixel_ratio:g.exported.devicePixelRatio,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:D,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(No(h)){const z=xi(s,_.transform);B.u_texsize=s.lineAtlasTexture.size,B.u_scale=[z,v.fromScale,v.toScale],B.u_mix=v.t}return B},Ea=(_,s,h,v,E)=>{const D=_.transform,R=xi(s,D);return{u_matrix:Su(_,s,h,E),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Or(s,1,D.zoom),u_device_pixel_ratio:g.exported.devicePixelRatio,u_image:0,u_scale:[R,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]]}};function xi(_,s){return 1/Or(_,1,s.tileZoom)}function Su(_,s,h,v){return _.translatePosMatrix(v||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const bs=_=>{const s=[];return No(_)&&s.push("RENDER_LINE_DASH"),_.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT"),s};function No(_){const s=_.paint.get("line-dasharray").value;return s.value||"constant"!==s.kind}const Xa=(_,s,h,v,E)=>{return{u_matrix:_,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:v.mix,u_opacity:v.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(R=E.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(D=E.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Sh(E.paint.get("raster-hue-rotate"))};var D,R};function Sh(_){_*=Math.PI/180;const s=Math.sin(_),h=Math.cos(_);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Mu=(_,s,h,v,E,D,R,B,z,$)=>{const H=E.transform;return{u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:H.width/H.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:R,u_coord_matrix:B,u_is_text:+z,u_pitch_with_map:+v,u_texsize:$,u_texture:0}},ts=(_,s,h,v,E,D,R,B,z,$,H)=>{const{cameraToCenterDistance:Q,_pitch:J}=E.transform;return g.extend(Mu(_,s,h,v,E,D,R,B,z,$),{u_gamma_scale:v?Q*Math.cos(E.terrain?0:J):1,u_device_pixel_ratio:g.exported.devicePixelRatio,u_is_halo:+H})},am=(_,s,h,v,E,D,R,B,z,$)=>g.extend(ts(_,s,h,v,E,D,R,B,!0,z,!0),{u_texsize_icon:$,u_texture_icon:1}),w0=(_,s,h)=>({u_matrix:_,u_opacity:s,u_color:h}),lm=(_,s,h,v,E,D)=>g.extend(function(R,B,z,$){const H=z.imageManager.getPattern(R.from.toString()),Q=z.imageManager.getPattern(R.to.toString()),{width:J,height:te}=z.imageManager.getPixelSize(),le=Math.pow(2,$.tileID.overscaledZ),ce=$.tileSize*Math.pow(2,z.transform.tileZoom)/le,_e=ce*($.tileID.canonical.x+$.tileID.wrap*le),se=ce*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[J,te],u_mix:B.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Or($,1,z.transform.tileZoom),u_pixel_coord_upper:[_e>>16,se>>16],u_pixel_coord_lower:[65535&_e,65535&se]}}(v,D,h,E),{u_matrix:_,u_opacity:s}),kd={fillExtrusion:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_lightpos:new g.Uniform3f(_,s.u_lightpos),u_lightintensity:new g.Uniform1f(_,s.u_lightintensity),u_lightcolor:new g.Uniform3f(_,s.u_lightcolor),u_vertical_gradient:new g.Uniform1f(_,s.u_vertical_gradient),u_opacity:new g.Uniform1f(_,s.u_opacity)}),fillExtrusionPattern:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_lightpos:new g.Uniform3f(_,s.u_lightpos),u_lightintensity:new g.Uniform1f(_,s.u_lightintensity),u_lightcolor:new g.Uniform3f(_,s.u_lightcolor),u_vertical_gradient:new g.Uniform1f(_,s.u_vertical_gradient),u_height_factor:new g.Uniform1f(_,s.u_height_factor),u_image:new g.Uniform1i(_,s.u_image),u_texsize:new g.Uniform2f(_,s.u_texsize),u_pixel_coord_upper:new g.Uniform2f(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,s.u_pixel_coord_lower),u_scale:new g.Uniform3f(_,s.u_scale),u_fade:new g.Uniform1f(_,s.u_fade),u_opacity:new g.Uniform1f(_,s.u_opacity)}),fill:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix)}),fillPattern:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_image:new g.Uniform1i(_,s.u_image),u_texsize:new g.Uniform2f(_,s.u_texsize),u_pixel_coord_upper:new g.Uniform2f(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,s.u_pixel_coord_lower),u_scale:new g.Uniform3f(_,s.u_scale),u_fade:new g.Uniform1f(_,s.u_fade)}),fillOutline:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_world:new g.Uniform2f(_,s.u_world)}),fillOutlinePattern:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_world:new g.Uniform2f(_,s.u_world),u_image:new g.Uniform1i(_,s.u_image),u_texsize:new g.Uniform2f(_,s.u_texsize),u_pixel_coord_upper:new g.Uniform2f(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,s.u_pixel_coord_lower),u_scale:new g.Uniform3f(_,s.u_scale),u_fade:new g.Uniform1f(_,s.u_fade)}),circle:(_,s)=>({u_camera_to_center_distance:new g.Uniform1f(_,s.u_camera_to_center_distance),u_extrude_scale:new g.Uniform2f(_,s.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(_,s.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(_,s.u_matrix)}),collisionBox:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_camera_to_center_distance:new g.Uniform1f(_,s.u_camera_to_center_distance),u_extrude_scale:new g.Uniform2f(_,s.u_extrude_scale)}),collisionCircle:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_inv_matrix:new g.UniformMatrix4f(_,s.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(_,s.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(_,s.u_viewport_size)}),debug:(_,s)=>({u_color:new g.UniformColor(_,s.u_color),u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_overlay:new g.Uniform1i(_,s.u_overlay),u_overlay_scale:new g.Uniform1f(_,s.u_overlay_scale)}),clippingMask:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix)}),heatmap:(_,s)=>({u_extrude_scale:new g.Uniform1f(_,s.u_extrude_scale),u_intensity:new g.Uniform1f(_,s.u_intensity),u_matrix:new g.UniformMatrix4f(_,s.u_matrix)}),heatmapTexture:(_,s)=>({u_image:new g.Uniform1i(_,s.u_image),u_color_ramp:new g.Uniform1i(_,s.u_color_ramp),u_opacity:new g.Uniform1f(_,s.u_opacity)}),hillshade:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_image:new g.Uniform1i(_,s.u_image),u_latrange:new g.Uniform2f(_,s.u_latrange),u_light:new g.Uniform2f(_,s.u_light),u_shadow:new g.UniformColor(_,s.u_shadow),u_highlight:new g.UniformColor(_,s.u_highlight),u_accent:new g.UniformColor(_,s.u_accent)}),hillshadePrepare:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_image:new g.Uniform1i(_,s.u_image),u_dimension:new g.Uniform2f(_,s.u_dimension),u_zoom:new g.Uniform1f(_,s.u_zoom),u_unpack:new g.Uniform4f(_,s.u_unpack)}),line:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_ratio:new g.Uniform1f(_,s.u_ratio),u_device_pixel_ratio:new g.Uniform1f(_,s.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(_,s.u_units_to_pixels),u_dash_image:new g.Uniform1i(_,s.u_dash_image),u_gradient_image:new g.Uniform1i(_,s.u_gradient_image),u_image_height:new g.Uniform1f(_,s.u_image_height),u_texsize:new g.Uniform2f(_,s.u_texsize),u_scale:new g.Uniform3f(_,s.u_scale),u_mix:new g.Uniform1f(_,s.u_mix)}),linePattern:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_texsize:new g.Uniform2f(_,s.u_texsize),u_ratio:new g.Uniform1f(_,s.u_ratio),u_device_pixel_ratio:new g.Uniform1f(_,s.u_device_pixel_ratio),u_image:new g.Uniform1i(_,s.u_image),u_units_to_pixels:new g.Uniform2f(_,s.u_units_to_pixels),u_scale:new g.Uniform3f(_,s.u_scale),u_fade:new g.Uniform1f(_,s.u_fade)}),raster:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_tl_parent:new g.Uniform2f(_,s.u_tl_parent),u_scale_parent:new g.Uniform1f(_,s.u_scale_parent),u_buffer_scale:new g.Uniform1f(_,s.u_buffer_scale),u_fade_t:new g.Uniform1f(_,s.u_fade_t),u_opacity:new g.Uniform1f(_,s.u_opacity),u_image0:new g.Uniform1i(_,s.u_image0),u_image1:new g.Uniform1i(_,s.u_image1),u_brightness_low:new g.Uniform1f(_,s.u_brightness_low),u_brightness_high:new g.Uniform1f(_,s.u_brightness_high),u_saturation_factor:new g.Uniform1f(_,s.u_saturation_factor),u_contrast_factor:new g.Uniform1f(_,s.u_contrast_factor),u_spin_weights:new g.Uniform3f(_,s.u_spin_weights)}),symbolIcon:(_,s)=>({u_is_size_zoom_constant:new g.Uniform1i(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(_,s.u_is_size_feature_constant),u_size_t:new g.Uniform1f(_,s.u_size_t),u_size:new g.Uniform1f(_,s.u_size),u_camera_to_center_distance:new g.Uniform1f(_,s.u_camera_to_center_distance),u_pitch:new g.Uniform1f(_,s.u_pitch),u_rotate_symbol:new g.Uniform1i(_,s.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(_,s.u_aspect_ratio),u_fade_change:new g.Uniform1f(_,s.u_fade_change),u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(_,s.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(_,s.u_coord_matrix),u_is_text:new g.Uniform1i(_,s.u_is_text),u_pitch_with_map:new g.Uniform1i(_,s.u_pitch_with_map),u_texsize:new g.Uniform2f(_,s.u_texsize),u_texture:new g.Uniform1i(_,s.u_texture)}),symbolSDF:(_,s)=>({u_is_size_zoom_constant:new g.Uniform1i(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(_,s.u_is_size_feature_constant),u_size_t:new g.Uniform1f(_,s.u_size_t),u_size:new g.Uniform1f(_,s.u_size),u_camera_to_center_distance:new g.Uniform1f(_,s.u_camera_to_center_distance),u_pitch:new g.Uniform1f(_,s.u_pitch),u_rotate_symbol:new g.Uniform1i(_,s.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(_,s.u_aspect_ratio),u_fade_change:new g.Uniform1f(_,s.u_fade_change),u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(_,s.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(_,s.u_coord_matrix),u_is_text:new g.Uniform1i(_,s.u_is_text),u_pitch_with_map:new g.Uniform1i(_,s.u_pitch_with_map),u_texsize:new g.Uniform2f(_,s.u_texsize),u_texture:new g.Uniform1i(_,s.u_texture),u_gamma_scale:new g.Uniform1f(_,s.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(_,s.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(_,s.u_is_halo)}),symbolTextAndIcon:(_,s)=>({u_is_size_zoom_constant:new g.Uniform1i(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(_,s.u_is_size_feature_constant),u_size_t:new g.Uniform1f(_,s.u_size_t),u_size:new g.Uniform1f(_,s.u_size),u_camera_to_center_distance:new g.Uniform1f(_,s.u_camera_to_center_distance),u_pitch:new g.Uniform1f(_,s.u_pitch),u_rotate_symbol:new g.Uniform1i(_,s.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(_,s.u_aspect_ratio),u_fade_change:new g.Uniform1f(_,s.u_fade_change),u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(_,s.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(_,s.u_coord_matrix),u_is_text:new g.Uniform1i(_,s.u_is_text),u_pitch_with_map:new g.Uniform1i(_,s.u_pitch_with_map),u_texsize:new g.Uniform2f(_,s.u_texsize),u_texsize_icon:new g.Uniform2f(_,s.u_texsize_icon),u_texture:new g.Uniform1i(_,s.u_texture),u_texture_icon:new g.Uniform1i(_,s.u_texture_icon),u_gamma_scale:new g.Uniform1f(_,s.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(_,s.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(_,s.u_is_halo)}),background:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_opacity:new g.Uniform1f(_,s.u_opacity),u_color:new g.UniformColor(_,s.u_color)}),backgroundPattern:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_opacity:new g.Uniform1f(_,s.u_opacity),u_image:new g.Uniform1i(_,s.u_image),u_pattern_tl_a:new g.Uniform2f(_,s.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(_,s.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(_,s.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(_,s.u_pattern_br_b),u_texsize:new g.Uniform2f(_,s.u_texsize),u_mix:new g.Uniform1f(_,s.u_mix),u_pattern_size_a:new g.Uniform2f(_,s.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(_,s.u_pattern_size_b),u_scale_a:new g.Uniform1f(_,s.u_scale_a),u_scale_b:new g.Uniform1f(_,s.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(_,s.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(_,s.u_tile_units_to_pixels)}),terrainRaster:bn,terrainDepth:bn,skybox:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_sun_direction:new g.Uniform3f(_,s.u_sun_direction),u_cubemap:new g.Uniform1i(_,s.u_cubemap),u_opacity:new g.Uniform1f(_,s.u_opacity),u_temporal_offset:new g.Uniform1f(_,s.u_temporal_offset)}),skyboxGradient:(_,s)=>({u_matrix:new g.UniformMatrix4f(_,s.u_matrix),u_color_ramp:new g.Uniform1i(_,s.u_color_ramp),u_center_direction:new g.Uniform3f(_,s.u_center_direction),u_radius:new g.Uniform1f(_,s.u_radius),u_opacity:new g.Uniform1f(_,s.u_opacity),u_temporal_offset:new g.Uniform1f(_,s.u_temporal_offset)}),skyboxCapture:(_,s)=>({u_matrix_3f:new g.UniformMatrix3f(_,s.u_matrix_3f),u_sun_direction:new g.Uniform3f(_,s.u_sun_direction),u_sun_intensity:new g.Uniform1f(_,s.u_sun_intensity),u_color_tint_r:new g.Uniform4f(_,s.u_color_tint_r),u_color_tint_m:new g.Uniform4f(_,s.u_color_tint_m),u_luminance:new g.Uniform1f(_,s.u_luminance)})};let Tu;function _c(_,s,h,v,E,D,R){const B=_.context,z=B.gl,$=_.useProgram("collisionBox"),H=[];let Q=0,J=0;for(let ge=0;ge<v.length;ge++){const ve=v[ge],Se=s.getTile(ve),de=Se.getBucket(h);if(!de)continue;let Fe=ve.projMatrix;0===E[0]&&0===E[1]||(Fe=_.translatePosMatrix(ve.projMatrix,Se,E,D));const We=R?de.textCollisionBox:de.iconCollisionBox,nt=de.collisionCircleArray;if(nt.length>0){const Pe=g.create$1(),Ge=Fe;g.mul$1(Pe,de.placementInvProjMatrix,_.transform.glCoordMatrix),g.mul$1(Pe,Pe,de.placementViewportMatrix),H.push({circleArray:nt,circleOffset:J,transform:Ge,invTransform:Pe}),Q+=nt.length/4,J=Q}We&&(_.terrain&&_.terrain.setupElevationDraw(Se,$),$.draw(B,z.LINES,g.DepthMode.disabled,g.StencilMode.disabled,_.colorModeForRenderPass(),g.CullFaceMode.disabled,Sl(Fe,_.transform,Se),h.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,_.transform.zoom,null,We.collisionVertexBuffer,We.collisionVertexBufferExt))}if(!R||!H.length)return;const te=_.useProgram("collisionCircle"),le=new g.StructArrayLayout2f1f2i16;le.resize(4*Q),le._trim();let ce=0;for(const ge of H)for(let ve=0;ve<ge.circleArray.length/4;ve++){const Se=4*ve,de=ge.circleArray[Se+0],Fe=ge.circleArray[Se+1],We=ge.circleArray[Se+2],nt=ge.circleArray[Se+3];le.emplace(ce++,de,Fe,We,nt,0),le.emplace(ce++,de,Fe,We,nt,1),le.emplace(ce++,de,Fe,We,nt,2),le.emplace(ce++,de,Fe,We,nt,3)}(!Tu||Tu.length<2*Q)&&(Tu=function(ge){const ve=2*ge,Se=new g.StructArrayLayout3ui6;Se.resize(ve),Se._trim();for(let de=0;de<ve;de++){const Fe=6*de;Se.uint16[Fe+0]=4*de+0,Se.uint16[Fe+1]=4*de+1,Se.uint16[Fe+2]=4*de+2,Se.uint16[Fe+3]=4*de+2,Se.uint16[Fe+4]=4*de+3,Se.uint16[Fe+5]=4*de+0}return Se}(Q));const _e=B.createIndexBuffer(Tu,!0),se=B.createVertexBuffer(le,g.collisionCircleLayout.members,!0);for(const ge of H){const ve={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(ue=_.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};te.draw(B,z.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,_.colorModeForRenderPass(),g.CullFaceMode.disabled,ve,h.id,se,_e,g.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,_.transform.zoom,null,null,null)}var ue;se.destroy(),_e.destroy()}const af=g.identity(new Float32Array(16));function cm(_,s,h,v,E,D){const{horizontalAlign:R,verticalAlign:B}=g.getAnchorAlignment(_),z=-(R-.5)*s,$=-(B-.5)*h,H=g.evaluateVariableOffset(_,v);return new g.pointGeometry((z/E+H[0])*D,($/E+H[1])*D)}function lf(_,s,h,v,E,D,R,B,z,$,H,Q){const J=_.text.placedSymbolArray,te=_.text.dynamicLayoutVertexArray,le=_.icon.dynamicLayoutVertexArray,ce={};te.clear();for(let _e=0;_e<J.length;_e++){const se=J.get(_e),ue=_.allowVerticalPlacement&&!se.placedOrientation,ge=se.hidden||!se.crossTileID||ue?null:v[se.crossTileID];if(ge){const ve=new g.pointGeometry(se.tileAnchorX,se.tileAnchorY),Se=Q(ve),de=Yi(ve,h?B:R,Se),Fe=xn(D.cameraToCenterDistance,de.signedDistanceFromCamera);let We=E.evaluateSizeForFeature(_.textSizeData,$,se)*Fe/g.ONE_EM;h&&(We*=_.tilePixelRatio/z);const{width:nt,height:Pe,anchor:Ge,textOffset:xt,textScale:Dt}=ge,Et=cm(Ge,nt,Pe,xt,Dt,We),dt=h?Yi(ve.add(Et),R,Se).point:de.point.add(s?Et.rotate(-D.angle):Et),Mt=_.allowVerticalPlacement&&se.placedOrientation===g.WritingMode.vertical?Math.PI/2:0;for(let wn=0;wn<se.numGlyphs;wn++)g.addDynamicAttributes(te,dt,Mt);H&&se.associatedIconIndex>=0&&(ce[se.associatedIconIndex]={shiftedAnchor:dt,angle:Mt})}else Qo(se.numGlyphs,te)}if(H){le.clear();const _e=_.icon.placedSymbolArray;for(let se=0;se<_e.length;se++){const ue=_e.get(se);if(ue.hidden)Qo(ue.numGlyphs,le);else{const ge=ce[se];if(ge)for(let ve=0;ve<ue.numGlyphs;ve++)g.addDynamicAttributes(le,ge.shiftedAnchor,ge.angle);else Qo(ue.numGlyphs,le)}}_.icon.dynamicLayoutVertexBuffer.updateData(le)}_.text.dynamicLayoutVertexBuffer.updateData(te)}function yc(_,s,h){return h.iconsInText&&s?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function cf(_,s,h,v,E,D,R,B,z,$,H,Q){const J=_.context,te=J.gl,le=_.transform,ce="map"===B,_e="map"===z,se=ce&&"point"!==h.layout.get("symbol-placement"),ue=ce&&!_e&&!se,ge=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ve=!1;const Se=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),de=h.layout.get("text-variable-anchor"),Fe=[],We=_.terrain&&_e?["PITCH_WITH_MAP_TERRAIN"]:null;for(const nt of v){const Pe=s.getTile(nt),Ge=Pe.getBucket(h);if(!Ge)continue;const xt=E?Ge.text:Ge.icon;if(!xt||!xt.segments.get().length)continue;const Dt=xt.programConfigurations.get(h.id),Et=E||Ge.sdfIcons,dt=E?Ge.textSizeData:Ge.iconSizeData,Mt=_e||0!==le.pitch,wn=_.useProgram(yc(Et,E,Ge),Dt,We),Jt=g.evaluateSizeForZoom(dt,le.zoom);let Ur,wr,cn,Cn,Br=[0,0],go=null;if(E){if(wr=Pe.glyphAtlasTexture,cn=te.LINEAR,Ur=Pe.glyphAtlasTexture.size,Ge.iconsInText){Br=Pe.imageAtlasTexture.size,go=Pe.imageAtlasTexture;const Po="composite"===dt.kind||"camera"===dt.kind;Cn=Mt||_.options.rotating||_.options.zooming||Po?te.LINEAR:te.NEAREST}}else{const Po=1!==h.layout.get("icon-size").constantOr(0)||Ge.iconsNeedLinear;wr=Pe.imageAtlasTexture,cn=Et||_.options.rotating||_.options.zooming||Po||Mt?te.LINEAR:te.NEAREST,Ur=Pe.imageAtlasTexture.size}const Io=Or(Pe,1,_.transform.zoom),ro=Wt(nt.projMatrix,_e,ce,_.transform,Io),_o=_.terrain&&_e&&se?g.invert(new Float32Array(16),ro):af,Ds=qn(nt.projMatrix,_e,ce,_.transform,Io),ko=de&&Ge.hasTextData(),Tn="none"!==h.layout.get("icon-text-fit")&&ko&&Ge.hasIconData();if(se){const Po=le.elevation;$t(Ge,nt.projMatrix,_,E,ro,Ds,_e,$,Po?io=>Po.getAtTileOffset(nt,io.x,io.y):null)}const Sr=_.translatePosMatrix(nt.projMatrix,Pe,D,R),zn=se||E&&de||Tn?af:ro,xr=_.translatePosMatrix(Ds,Pe,D,R,!0),Ci=Et&&0!==h.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1);let ir;ir=Et?Ge.iconsInText?am(dt.kind,Jt,ue,_e,_,Sr,zn,xr,Ur,Br):ts(dt.kind,Jt,ue,_e,_,Sr,zn,xr,E,Ur,!0):Mu(dt.kind,Jt,ue,_e,_,Sr,zn,xr,E,Ur);const ai={program:wn,buffers:xt,uniformValues:ir,atlasTexture:wr,atlasTextureIcon:go,atlasInterpolation:cn,atlasInterpolationIcon:Cn,isSDF:Et,hasHalo:Ci,tile:Pe,labelPlaneMatrixInv:_o};if(ge&&Ge.canOverlap){ve=!0;const Po=xt.segments.get();for(const io of Po)Fe.push({segments:new g.SegmentVector([io]),sortKey:io.sortKey,state:ai})}else Fe.push({segments:xt.segments,sortKey:0,state:ai})}ve&&Fe.sort((nt,Pe)=>nt.sortKey-Pe.sortKey);for(const nt of Fe){const Pe=nt.state;if(_.terrain&&_.terrain.setupElevationDraw(Pe.tile,Pe.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Pe.labelPlaneMatrixInv}),J.activeTexture.set(te.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,te.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(J.activeTexture.set(te.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Pe.isSDF){const Ge=Pe.uniformValues;Pe.hasHalo&&(Ge.u_is_halo=1,vc(Pe.buffers,nt.segments,h,_,Pe.program,Se,H,Q,Ge)),Ge.u_is_halo=0}vc(Pe.buffers,nt.segments,h,_,Pe.program,Se,H,Q,Pe.uniformValues)}}function vc(_,s,h,v,E,D,R,B,z){const $=v.context;E.draw($,$.gl.TRIANGLES,D,R,B,g.CullFaceMode.disabled,z,h.id,_.layoutVertexBuffer,_.indexBuffer,s,h.paint,v.transform.zoom,_.programConfigurations.get(h.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function xc(_,s,h,v,E,D,R){const B=_.context.gl,z=h.paint.get("fill-pattern"),$=z&&z.constantOr(1),H=h.getCrossfadeParameters();let Q,J,te,le,ce;R?(J=$&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=B.LINES):(J=$?"fillPattern":"fill",Q=B.TRIANGLES);for(const _e of v){const se=s.getTile(_e);if($&&!se.patternsLoaded())continue;const ue=se.getBucket(h);if(!ue)continue;_.prepareDrawTile(_e);const ge=ue.programConfigurations.get(h.id),ve=_.useProgram(J,ge);$&&(_.context.activeTexture.set(B.TEXTURE0),se.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ge.updatePaintBuffers(H));const Se=z.constantOr(null);if(Se&&se.imageAtlas){const Fe=se.imageAtlas,We=Fe.patternPositions[Se.to.toString()],nt=Fe.patternPositions[Se.from.toString()];We&&nt&&ge.setConstantPatternPositions(We,nt)}const de=_.translatePosMatrix(_e.projMatrix,se,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(R){le=ue.indexBuffer2,ce=ue.segments2;const Fe=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];te="fillOutlinePattern"===J&&$?Rn(de,_,H,se,Fe):es(de,Fe)}else le=ue.indexBuffer,ce=ue.segments,te=$?xs(de,_,H,se):Qs(de);_.prepareDrawProgram(_.context,ve,_e.toUnwrapped()),ve.draw(_.context,Q,E,_.stencilModeForClipping(_e),D,g.CullFaceMode.disabled,te,h.id,ue.layoutVertexBuffer,le,ce,h.paint,_.transform.zoom,ge)}}function Pd(_,s,h,v,E,D,R){const B=_.context,z=B.gl,$=h.paint.get("fill-extrusion-pattern"),H=$.constantOr(1),Q=h.getCrossfadeParameters(),J=h.paint.get("fill-extrusion-opacity");for(const te of v){const le=s.getTile(te),ce=le.getBucket(h);if(!ce)continue;const _e=ce.programConfigurations.get(h.id),se=_.useProgram(H?"fillExtrusionPattern":"fillExtrusion",_e);if(_.terrain){const de=_.terrain;if(!ce.enableTerrain)continue;if(de.setupElevationDraw(le,se,{useMeterToDem:!0}),uf(B,s,te,ce,h,de),!ce.centroidVertexBuffer){const Fe=se.attributes.a_centroid_pos;void 0!==Fe&&z.vertexAttrib2f(Fe,0,0)}}H&&(_.context.activeTexture.set(z.TEXTURE0),le.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),_e.updatePaintBuffers(Q));const ue=$.constantOr(null);if(ue&&le.imageAtlas){const de=le.imageAtlas,Fe=de.patternPositions[ue.to.toString()],We=de.patternPositions[ue.from.toString()];Fe&&We&&_e.setConstantPatternPositions(Fe,We)}const ge=_.translatePosMatrix(te.projMatrix,le,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ve=h.paint.get("fill-extrusion-vertical-gradient"),Se=H?So(ge,_,ve,J,te,Q,le):Qa(ge,_,ve,J);_.prepareDrawProgram(B,se,te.toUnwrapped()),se.draw(B,B.gl.TRIANGLES,E,D,R,g.CullFaceMode.backCCW,Se,h.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,h.paint,_.transform.zoom,_e,_.terrain?ce.centroidVertexBuffer:null)}}function uf(_,s,h,v,E,D){const R=[se=>{let ue=se.canonical.x-1,ge=se.wrap;return ue<0&&(ue=(1<<se.canonical.z)-1,ge--),new g.OverscaledTileID(se.overscaledZ,ge,se.canonical.z,ue,se.canonical.y)},se=>{let ue=se.canonical.x+1,ge=se.wrap;return ue===1<<se.canonical.z&&(ue=0,ge++),new g.OverscaledTileID(se.overscaledZ,ge,se.canonical.z,ue,se.canonical.y)},se=>new g.OverscaledTileID(se.overscaledZ,se.wrap,se.canonical.z,se.canonical.x,(0===se.canonical.y?1<<se.canonical.z:se.canonical.y)-1),se=>new g.OverscaledTileID(se.overscaledZ,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y===(1<<se.canonical.z)-1?0:se.canonical.y+1)],B=se=>{const ue=s.getSource().maxzoom,ge=Fe=>{const We=s.getTileByID(Fe);if(We&&We.hasData())return We.getBucket(E)};let ve,Se,de;return(se.overscaledZ===se.canonical.z||se.overscaledZ>=ue)&&(ve=ge(se.key)),se.overscaledZ>=ue&&(Se=ge(se.calculateScaledKey(se.overscaledZ+1))),se.overscaledZ>ue&&(de=ge(se.calculateScaledKey(se.overscaledZ-1))),ve||Se||de},z=[0,0,0],$=(se,ue)=>(z[0]=Math.min(se.min.y,ue.min.y),z[1]=Math.max(se.max.y,ue.max.y),z[2]=g.EXTENT-ue.min.x>se.max.x?ue.min.x-g.EXTENT:se.max.x,z),H=(se,ue)=>(z[0]=Math.min(se.min.x,ue.min.x),z[1]=Math.max(se.max.x,ue.max.x),z[2]=g.EXTENT-ue.min.y>se.max.y?ue.min.y-g.EXTENT:se.max.y,z),Q=[(se,ue)=>$(se,ue),(se,ue)=>$(ue,se),(se,ue)=>H(se,ue),(se,ue)=>H(ue,se)],J=new g.pointGeometry(0,0);let te,le,ce;const _e=(se,ue,ge,ve,Se)=>{const de=[[ve?ge:se,ve?se:ge,0],[ve?ge:ue,ve?ue:ge,0]],Fe=Se<0?g.EXTENT+Se:Se,We=[ve?Fe:(se+ue)/2,ve?(se+ue)/2:Fe,0];return 0===ge&&Se<0||0!==ge&&Se>0?D.getForTilePoints(ce,[We],!0,le):de.push(We),D.getForTilePoints(h,de,!0,te),Math.max(de[0][2],de[1][2],We[2])/D.exaggeration()};for(let se=0;se<4;se++){const ue=v.borders[se];if(0===ue.length&&(v.borderDone[se]=!0),v.borderDone[se])continue;const ge=ce=R[se](h),ve=B(ge);if(!(ve&&ve.enableTerrain&&(le=D.findDEMTileFor(ge),le&&le.dem)))continue;if(!te){const We=D.findDEMTileFor(h);if(!We||!We.dem)return;te=We}const Se=(se<2?1:5)-se,de=ve.borders[Se];let Fe=0;for(let We=0;We<ue.length;We++){const nt=v.featuresOnBorder[ue[We]],Pe=nt.borders[se];let Ge;for(;Fe<de.length&&(Ge=ve.featuresOnBorder[de[Fe]],!(Ge.borders[Se][1]>Pe[0]+3));)ve.borderDone[Se]||ve.encodeCentroid(void 0,Ge,!1),Fe++;if(Ge&&Fe<de.length){const xt=Fe;let Dt=0;for(;!(Ge.borders[Se][0]>Pe[1]-3)&&(Dt++,++Fe!==de.length);)Ge=ve.featuresOnBorder[de[Fe]];if(Ge=ve.featuresOnBorder[de[xt]],nt.intersectsCount()>1||Ge.intersectsCount()>1||1!==Dt){1!==Dt&&(Fe=xt),v.encodeCentroid(void 0,nt,!1),ve.borderDone[Se]||ve.encodeCentroid(void 0,Ge,!1);continue}const Et=Q[se](nt,Ge),dt=se%2?g.EXTENT-1:0;J.x=_e(Et[0],Math.min(g.EXTENT-1,Et[1]),dt,se<2,Et[2]),J.y=0,v.encodeCentroid(J,nt,!1),ve.borderDone[Se]||ve.encodeCentroid(J,Ge,!1)}else v.encodeCentroid(void 0,nt,!1)}v.borderDone[se]=v.needsCentroidUpdate=!0,ve.borderDone[Se]||(ve.borderDone[Se]=ve.needsCentroidUpdate=!0)}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(_)}const rr=new g.Color(1,0,0,1),Rd=new g.Color(0,1,0,1),C0=new g.Color(0,0,1,1),Fd=new g.Color(1,0,1,1),Il=new g.Color(0,1,1,1);function um(_,s,h,v){Mh(_,0,s+h/2,_.transform.width,h,v)}function hm(_,s,h,v){Mh(_,s-h/2,0,h,_.transform.height,v)}function Mh(_,s,h,v,E,D){const R=_.context,B=R.gl;B.enable(B.SCISSOR_TEST),B.scissor(s*g.exported.devicePixelRatio,h*g.exported.devicePixelRatio,v*g.exported.devicePixelRatio,E*g.exported.devicePixelRatio),R.clear({color:D}),B.disable(B.SCISSOR_TEST)}function kl(_,s,h){const v=_.context,E=v.gl,D=h.projMatrix,R=_.useProgram("debug"),B=s.getTileByID(h.key);_.terrain&&_.terrain.setupElevationDraw(B,R);const z=g.DepthMode.disabled,$=g.StencilMode.disabled,H=_.colorModeForRenderPass(),Q="$debug";v.activeTexture.set(E.TEXTURE0),_.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),R.draw(v,E.LINE_STRIP,z,$,H,g.CullFaceMode.disabled,gc(D,g.Color.red),Q,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments);const J=B.latestRawTileData,te=Math.floor((J&&J.byteLength||0)/1024),le=s.getTile(h).tileSize,ce=512/Math.min(le,512)*(h.overscaledZ/_.transform.zoom)*.5;let _e=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(_e+=` => ${h.overscaledZ}`),function(se,ue){se.initDebugOverlayCanvas();const ge=se.debugOverlayCanvas,ve=se.context.gl,Se=se.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,ge.width,ge.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(ue,5,5),Se.strokeText(ue,5,5),se.debugOverlayTexture.update(ge),se.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(_,`${_e} ${te}kb`),R.draw(v,E.TRIANGLES,z,$,g.ColorMode.alphaBlended,g.CullFaceMode.disabled,gc(D,g.Color.transparent,ce),Q,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments)}const Th=g.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Dr}=Th;function ns(_,s,h,v){_.emplaceBack(s,h,v)}class Ih{constructor(s){this.vertexArray=new g.StructArrayLayout3f12,this.indices=new g.StructArrayLayout3ui6,ns(this.vertexArray,-1,-1,1),ns(this.vertexArray,1,-1,1),ns(this.vertexArray,-1,1,1),ns(this.vertexArray,1,1,1),ns(this.vertexArray,-1,-1,-1),ns(this.vertexArray,1,-1,-1),ns(this.vertexArray,-1,1,-1),ns(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Dr),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=g.SegmentVector.simpleSegment(0,0,36,12)}}function Ya(_,s,h,v,E,D){const R=_.gl,B=s.paint.get("sky-atmosphere-color"),z=s.paint.get("sky-atmosphere-halo-color"),$=s.paint.get("sky-atmosphere-sun-intensity"),H={u_matrix_3f:g.fromMat4([],v),u_sun_direction:E,u_sun_intensity:$,u_color_tint_r:[(le=B).r,le.g,le.b,le.a],u_color_tint_m:[(ce=z).r,ce.g,ce.b,ce.a],u_luminance:5e-5};var le,ce;R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+D,s.skyboxTexture,0),h.draw(_,R.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,g.ColorMode.unblended,g.CullFaceMode.frontCW,H,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const kh={symbol:function(_,s,h,v,E){if("translucent"!==_.renderPass)return;const D=g.StencilMode.disabled,R=_.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(B,z,$,H,Q,J,te){const le=z.transform,ce="map"===Q,_e="map"===J;for(const se of B){const ue=H.getTile(se),ge=ue.getBucket($);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const ve=g.evaluateSizeForZoom(ge.textSizeData,le.zoom),Se=Or(ue,1,z.transform.zoom),de=Wt(se.projMatrix,_e,ce,z.transform,Se),Fe="none"!==$.layout.get("icon-text-fit")&&ge.hasIconData();if(ve){const We=Math.pow(2,le.zoom-ue.tileID.overscaledZ),nt=le.elevation;lf(ge,ce,_e,te,g.symbolSize,le,de,se.projMatrix,We,ve,Fe,nt?Pe=>nt.getAtTileOffset(se,Pe.x,Pe.y):Pe=>0)}}}(v,_,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E),0!==h.paint.get("icon-opacity").constantOr(1)&&cf(_,s,h,v,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),D,R),0!==h.paint.get("text-opacity").constantOr(1)&&cf(_,s,h,v,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),D,R),s.map.showCollisionBoxes&&(_c(_,s,h,v,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),_c(_,s,h,v,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(_,s,h,v){if("translucent"!==_.renderPass)return;const E=h.paint.get("circle-opacity"),D=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),B=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===E.constantOr(1)&&(0===D.constantOr(1)||0===R.constantOr(1)))return;const z=_.context,$=z.gl,H=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),Q=g.StencilMode.disabled,J=_.colorModeForRenderPass(),te=[];for(let le=0;le<v.length;le++){const ce=v[le],_e=s.getTile(ce),se=_e.getBucket(h);if(!se)continue;const ue=se.programConfigurations.get(h.id),ge=Dh(h),ve={programConfiguration:ue,program:_.useProgram("circle",ue,ge),layoutVertexBuffer:se.layoutVertexBuffer,indexBuffer:se.indexBuffer,uniformValues:Id(_,ce,_e,h),tile:_e};if(B){const Se=se.segments.get();for(const de of Se)te.push({segments:new g.SegmentVector([de]),sortKey:de.sortKey,state:ve})}else te.push({segments:se.segments,sortKey:0,state:ve})}B&&te.sort((le,ce)=>le.sortKey-ce.sortKey);for(const le of te){const{programConfiguration:ce,program:_e,layoutVertexBuffer:se,indexBuffer:ue,uniformValues:ge,tile:ve}=le.state,Se=le.segments;_.terrain&&_.terrain.setupElevationDraw(ve,_e,{useDepthForOcclusion:!0}),_.prepareDrawProgram(z,_e,ve.tileID.toUnwrapped()),_e.draw(z,$.TRIANGLES,H,Q,J,g.CullFaceMode.disabled,ge,h.id,se,ue,Se,h.paint,_.transform.zoom,ce)}},heatmap:function(_,s,h,v){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const E=_.context,D=E.gl,R=g.StencilMode.disabled,B=new g.ColorMode([D.ONE,D.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(z,$,H){const Q=z.gl;z.activeTexture.set(Q.TEXTURE1),z.viewport.set([0,0,$.width/4,$.height/4]);let J=H.heatmapFbo;if(J)Q.bindTexture(Q.TEXTURE_2D,J.colorAttachment.get()),z.bindFramebuffer.set(J.framebuffer);else{const te=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,te),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),J=H.heatmapFbo=z.createFramebuffer($.width/4,$.height/4,!1),function(le,ce,_e,se){const ue=le.gl;ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,ce.width/4,ce.height/4,0,ue.RGBA,le.extRenderToTextureHalfFloat?le.extTextureHalfFloat.HALF_FLOAT_OES:ue.UNSIGNED_BYTE,null),se.colorAttachment.set(_e)}(z,$,te,J)}})(E,_,h),E.clear({color:g.Color.transparent});for(let z=0;z<v.length;z++){const $=v[z];if(s.hasRenderableParent($))continue;const H=s.getTile($),Q=H.getBucket(h);if(!Q)continue;const J=Q.programConfigurations.get(h.id),te=_.useProgram("heatmap",J),{zoom:le}=_.transform;_.terrain&&_.terrain.setupElevationDraw(H,te),_.prepareDrawProgram(E,te,$.toUnwrapped()),te.draw(E,D.TRIANGLES,g.DepthMode.disabled,R,B,g.CullFaceMode.disabled,Ml($.projMatrix,H,le,h.paint.get("heatmap-intensity")),h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,_.transform.zoom,J)}E.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(E,D){const R=E.context,B=R.gl,z=D.heatmapFbo;if(!z)return;R.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,z.colorAttachment.get()),R.activeTexture.set(B.TEXTURE1);let $=D.colorRampTexture;$||($=D.colorRampTexture=new g.Texture(R,D.colorRamp,B.RGBA)),$.bind(B.LINEAR,B.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(R,B.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,E.colorModeForRenderPass(),g.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")},D.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,D.paint,E.transform.zoom)}(_,h))},line:function(_,s,h,v){if("translucent"!==_.renderPass)return;const E=h.paint.get("line-opacity"),D=h.paint.get("line-width");if(0===E.constantOr(1)||0===D.constantOr(1))return;const R=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),B=_.colorModeForRenderPass(),z=h.paint.get("line-dasharray"),$=z.constantOr(1),H=h.layout.get("line-cap"),Q=h.paint.get("line-pattern"),J=Q.constantOr(1),te=h.paint.get("line-gradient"),le=h.getCrossfadeParameters(),ce=J?"linePattern":"line",_e=_.context,se=_e.gl;for(const ue of v){const ge=s.getTile(ue);if(J&&!ge.patternsLoaded())continue;const ve=ge.getBucket(h);if(!ve)continue;_.prepareDrawTile(ue);const Se=ve.programConfigurations.get(h.id),de=bs(h),Fe=_.useProgram(ce,Se,de),We=Q.constantOr(null);if(We&&ge.imageAtlas){const Dt=ge.imageAtlas,Et=Dt.patternPositions[We.to.toString()],dt=Dt.patternPositions[We.from.toString()];Et&&dt&&Se.setConstantPatternPositions(Et,dt)}const nt=z.constantOr(null),Pe=H.constantOr(null);if(!J&&nt&&Pe&&ge.lineAtlas){const Dt=ge.lineAtlas,Et=Dt.getDash(nt.to,Pe),dt=Dt.getDash(nt.from,Pe);Et&&dt&&Se.setConstantPatternPositions(Et,dt)}const Ge=_.terrain?ue.projMatrix:null,xt=J?Ea(_,ge,h,le,Ge):Tl(_,ge,h,le,Ge,ve.lineClipsArray.length);if(te){const Dt=ve.gradients[h.id];let Et=Dt.texture;if(h.gradientVersion!==Dt.version){let dt=256;if(h.stepInterpolant){const Mt=s.getSource().maxzoom,wn=ue.canonical.z===Mt?Math.ceil(1<<_.transform.maxZoom-ue.canonical.z):1;dt=g.clamp(g.nextPowerOfTwo(ve.maxLineLength/g.EXTENT*1024*wn),256,_e.maxTextureSize)}Dt.gradient=g.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:dt,image:Dt.gradient||void 0,clips:ve.lineClipsArray}),Dt.texture?Dt.texture.update(Dt.gradient):Dt.texture=new g.Texture(_e,Dt.gradient,se.RGBA),Dt.version=h.gradientVersion,Et=Dt.texture}_e.activeTexture.set(se.TEXTURE1),Et.bind(h.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}$&&(_e.activeTexture.set(se.TEXTURE0),ge.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Se.updatePaintBuffers(le)),J&&(_e.activeTexture.set(se.TEXTURE0),ge.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Se.updatePaintBuffers(le)),_.prepareDrawProgram(_e,Fe,ue.toUnwrapped()),Fe.draw(_e,se.TRIANGLES,R,_.stencilModeForClipping(ue),B,g.CullFaceMode.disabled,xt,h.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,h.paint,_.transform.zoom,Se,ve.layoutVertexBuffer2)}},fill:function(_,s,h,v){const E=h.paint.get("fill-color"),D=h.paint.get("fill-opacity");if(0===D.constantOr(1))return;const R=_.colorModeForRenderPass(),B=h.paint.get("fill-pattern"),z=_.opaquePassEnabledForLayer()&&!B.constantOr(1)&&1===E.constantOr(g.Color.transparent).a&&1===D.constantOr(0)?"opaque":"translucent";if(_.renderPass===z){const $=_.depthModeForSublayer(1,"opaque"===_.renderPass?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly);xc(_,s,h,v,$,R,!1)}if("translucent"===_.renderPass&&h.paint.get("fill-antialias")){const $=_.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,g.DepthMode.ReadOnly);xc(_,s,h,v,$,R,!0)}},"fill-extrusion":function(_,s,h,v){const E=h.paint.get("fill-extrusion-opacity");if(0!==E&&"translucent"===_.renderPass){const D=new g.DepthMode(_.context.gl.LEQUAL,g.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==E||h.paint.get("fill-extrusion-pattern").constantOr(1))Pd(_,s,h,v,D,g.StencilMode.disabled,g.ColorMode.disabled),Pd(_,s,h,v,D,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const R=_.colorModeForRenderPass();Pd(_,s,h,v,D,g.StencilMode.disabled,R)}}},hillshade:function(_,s,h,v){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const E=_.context,D=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),R=_.colorModeForRenderPass(),B=_.terrain&&_.terrain.renderingToTexture,[z,$]="translucent"!==_.renderPass||B?[{},v]:_.stencilConfigForOverlap(v);for(const H of $){const Q=s.getTile(H);if(Q.needsHillshadePrepare&&"offscreen"===_.renderPass)ht(_,Q,h,D,g.StencilMode.disabled,R);else if("translucent"===_.renderPass){const J=B&&_.terrain?_.terrain.stencilModeForRTTOverlap(H):z[H.overscaledZ];Eh(_,H,Q,h,D,J,R)}}E.viewport.set([0,0,_.width,_.height])},raster:function(_,s,h,v,E,D){if("translucent"!==_.renderPass||0===h.paint.get("raster-opacity")||!v.length)return;const R=_.context,B=R.gl,z=s.getSource(),$=_.useProgram("raster"),H=_.colorModeForRenderPass(),Q=_.terrain&&_.terrain.renderingToTexture,[J,te]=z instanceof ne||Q?[{},v]:_.stencilConfigForOverlap(v),le=te[te.length-1].overscaledZ,ce=!_.options.moving;for(const _e of te){const se=Q?g.DepthMode.disabled:_.depthModeForSublayer(_e.overscaledZ-le,1===h.paint.get("raster-opacity")?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly,B.LESS),ue=_e.toUnwrapped(),ge=s.getTile(_e);if(Q&&(!ge||!ge.hasData()))continue;const ve=Q?_e.projMatrix:_.transform.calculateProjMatrix(ue,ce),Se=_.terrain&&Q?_.terrain.stencilModeForRTTOverlap(_e):J[_e.overscaledZ],de=D?0:h.paint.get("raster-fade-duration");ge.registerFadeDuration(de);const Fe=s.findLoadedParent(_e,0),We=Qr(ge,Fe,s,_.transform,de);let nt,Pe;_.terrain&&_.terrain.prepareDrawTile(_e);const Ge="nearest"===h.paint.get("raster-resampling")?B.NEAREST:B.LINEAR;R.activeTexture.set(B.TEXTURE0),ge.texture.bind(Ge,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(B.TEXTURE1),Fe?(Fe.texture.bind(Ge,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),nt=Math.pow(2,Fe.tileID.overscaledZ-ge.tileID.overscaledZ),Pe=[ge.tileID.canonical.x*nt%1,ge.tileID.canonical.y*nt%1]):ge.texture.bind(Ge,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const xt=Xa(ve,Pe||[0,0],nt||1,We,h);_.prepareDrawProgram(R,$,ue),z instanceof ne?$.draw(R,B.TRIANGLES,se,g.StencilMode.disabled,H,g.CullFaceMode.disabled,xt,h.id,z.boundsBuffer,_.quadTriangleIndexBuffer,z.boundsSegments):$.draw(R,B.TRIANGLES,se,Se,H,g.CullFaceMode.disabled,xt,h.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}},background:function(_,s,h,v){const E=h.paint.get("background-color"),D=h.paint.get("background-opacity");if(0===D)return;const R=_.context,B=R.gl,z=_.transform,$=z.tileSize,H=h.paint.get("background-pattern");if(_.isPatternMissing(H))return;const Q=!H&&1===E.a&&1===D&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Q)return;const J=g.StencilMode.disabled,te=_.depthModeForSublayer(0,"opaque"===Q?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly),le=_.colorModeForRenderPass(),ce=_.useProgram(H?"backgroundPattern":"background"),_e=v||z.coveringTiles({tileSize:$});H&&(R.activeTexture.set(B.TEXTURE0),_.imageManager.bind(_.context));const se=h.getCrossfadeParameters();for(const ue of _e){const ge=ue.toUnwrapped(),ve=v?ue.projMatrix:_.transform.calculateProjMatrix(ge);_.prepareDrawTile(ue);const Se=H?lm(ve,D,_,H,{tileID:ue,tileSize:$},se):w0(ve,D,E);_.prepareDrawProgram(R,ce,ge),ce.draw(R,B.TRIANGLES,te,J,le,g.CullFaceMode.disabled,Se,h.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}},sky:function(_,s,h){const v=h.paint.get("sky-opacity");if(0===v)return;const E=_.context,D=h.paint.get("sky-type"),R=new g.DepthMode(E.gl.LEQUAL,g.DepthMode.ReadOnly,[0,1]),B=_.frameCounter/1e3%1;"atmosphere"===D?"offscreen"===_.renderPass?h.needsSkyboxCapture(_)&&(function(z,$,H,Q){const J=z.context,te=J.gl;let le=$.skyboxFbo;if(!le){le=$.skyboxFbo=J.createFramebuffer(32,32,!1),$.skyboxGeometry=new Ih(J),$.skyboxTexture=J.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,$.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let ue=0;ue<6;++ue)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(le.framebuffer),J.viewport.set([0,0,32,32]);const ce=$.getCenter(z,!0),_e=z.useProgram("skyboxCapture"),se=new Float64Array(16);g.identity(se),g.rotateY(se,se,.5*-Math.PI),Ya(J,$,_e,se,ce,0),g.identity(se),g.rotateY(se,se,.5*Math.PI),Ya(J,$,_e,se,ce,1),g.identity(se),g.rotateX(se,se,.5*-Math.PI),Ya(J,$,_e,se,ce,2),g.identity(se),g.rotateX(se,se,.5*Math.PI),Ya(J,$,_e,se,ce,3),g.identity(se),Ya(J,$,_e,se,ce,4),g.identity(se),g.rotateY(se,se,Math.PI),Ya(J,$,_e,se,ce,5),J.viewport.set([0,0,z.width,z.height])}(_,h),h.markSkyboxValid(_)):"sky"===_.renderPass&&function(z,$,H,Q,J){const te=z.context,le=te.gl,ce=z.transform,_e=z.useProgram("skybox");te.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,$.skyboxTexture);const se={u_matrix:ce.skyboxMatrix,u_sun_direction:$.getCenter(z,!1),u_cubemap:0,u_opacity:Q,u_temporal_offset:J};z.prepareDrawProgram(te,_e),_e.draw(te,le.TRIANGLES,H,g.StencilMode.disabled,z.colorModeForRenderPass(),g.CullFaceMode.backCW,se,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(_,h,R,v,B):"gradient"===D&&"sky"===_.renderPass&&function(z,$,H,Q,J){const te=z.context,le=te.gl,ce=z.transform,_e=z.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new Ih(te)),te.activeTexture.set(le.TEXTURE0);let se=$.colorRampTexture;se||(se=$.colorRampTexture=new g.Texture(te,$.colorRamp,le.RGBA)),se.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ue=(ge=ce.skyboxMatrix,ve=$.getCenter(z,!1),Se=$.paint.get("sky-gradient-radius"),de=Q,Fe=J,{u_matrix:ge,u_color_ramp:0,u_center_direction:ve,u_radius:g.degToRad(Se),u_opacity:de,u_temporal_offset:Fe});var ge,ve,Se,de,Fe;z.prepareDrawProgram(te,_e),_e.draw(te,le.TRIANGLES,H,g.StencilMode.disabled,z.colorModeForRenderPass(),g.CullFaceMode.backCW,ue,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(_,h,R,v,B)},debug:function(_,s,h){for(let v=0;v<h.length;v++)kl(_,s,h[v])},custom:function(_,s,h){const v=_.context,E=h.implementation;if("offscreen"===_.renderPass){const D=E.prerender;D&&(_.setCustomLayerDefaults(),v.setColorMode(_.colorModeForRenderPass()),D.call(E,v.gl,_.transform.customLayerMatrix()),v.setDirty(),_.setBaseState())}else if("translucent"===_.renderPass){_.setCustomLayerDefaults(),v.setColorMode(_.colorModeForRenderPass()),v.setStencilMode(g.StencilMode.disabled);const D="3d"===E.renderingMode?new g.DepthMode(_.context.gl.LEQUAL,g.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,g.DepthMode.ReadOnly);v.setDepthMode(D),E.render(v.gl,_.transform.customLayerMatrix()),v.setDirty(),_.setBaseState(),v.bindFramebuffer.set(null)}}};class Iu{constructor(s,h){this.context=new ln(s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=g.SourceCache.maxUnderzooming+g.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs,this.gpuTimers={},this.frameCounter=0}updateTerrain(s,h){const v=!!s&&!!s.terrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gn(this,s));const E=this._terrain;this.transform.elevation=v?E:null,E.update(s,this.transform,h)}_updateFog(s){const h=s.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,E]=h.getFovAdjustedRange(this.transform._fov);if(v>E)return void(this.transform.fogCullDistSq=null);const D=v+.78*(E-v);this.transform.fogCullDistSq=D*D}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*g.exported.devicePixelRatio,this.height=h*g.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const s=this.context,h=new g.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,g.posAttributes.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);const v=new g.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(g.EXTENT,0),v.emplaceBack(0,g.EXTENT),v.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=s.createVertexBuffer(v,g.posAttributes.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);const E=new g.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(g.EXTENT,0,g.EXTENT,0),E.emplaceBack(0,g.EXTENT,0,g.EXTENT),E.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(E,Hn.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);const D=new g.StructArrayLayout2i4;D.emplaceBack(-1,-1),D.emplaceBack(1,-1),D.emplaceBack(-1,1),D.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(D,g.posAttributes.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);const R=new g.StructArrayLayout1ui2;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(R);const B=new g.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(B),this.emptyTexture=new g.Texture(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA),this.identityMat=g.create$1();const z=this.context.gl;this.stencilClearMode=new g.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(g.window.performance.now())}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(s,h.TRIANGLES,g.DepthMode.disabled,this.stencilClearMode,g.ColorMode.disabled,g.CullFaceMode.disabled,Ws(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h,v){if(!(h&&this.currentStencilSource!==h.id&&s.isTileClipped()&&v&&v.length))return;this.currentStencilSource=h.id;const E=this.context,D=E.gl;this.nextStencilID+v.length>256&&this.clearStencil(),E.setColorMode(g.ColorMode.disabled),E.setDepthMode(g.DepthMode.disabled);const R=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of v){const z=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;R.draw(E,D.TRIANGLES,g.DepthMode.disabled,new g.StencilMode({func:D.ALWAYS,mask:0},z,255,D.KEEP,D.KEEP,D.REPLACE),g.ColorMode.disabled,g.CullFaceMode.disabled,Ws(B.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new g.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new g.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,v=s.sort((R,B)=>B.overscaledZ-R.overscaledZ),E=v[v.length-1].overscaledZ,D=v[0].overscaledZ-E+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();const R={};for(let B=0;B<D;B++)R[B+E]=new g.StencilMode({func:h.GEQUAL,mask:255},B+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=D,[R,v]}return[{[E]:g.StencilMode.disabled},v]}colorModeForRenderPass(){const s=this.context.gl;if(this._showOverdrawInspector){const h=1/8;return new g.ColorMode([s.CONSTANT_COLOR,s.ONE],new g.Color(h,h,h,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?g.ColorMode.unblended:g.ColorMode.alphaBlended}depthModeForSublayer(s,h,v){if(!this.opaquePassEnabledForLayer())return g.DepthMode.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new g.DepthMode(v||this.context.gl.LEQUAL,h,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(g.exported.now()),this.imageManager.beginFrame();const v=this.style.order,E=this.style._sourceCaches;for(const $ in E){const H=E[$];H.used&&H.prepare(this.context)}const D={},R={},B={};for(const $ in E){const H=E[$];D[$]=H.getVisibleCoordinates(),R[$]=D[$].slice().reverse(),B[$]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<v.length;$++)if(this.style._layers[v[$]].is3D()){this.opaquePassCutoff=$;break}if(this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0),!g.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const $ of v){const H=this.style._layers[$],Q=s._getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const J=Q?R[Q.id]:void 0;("custom"===H.type||H.isSky()||J&&J.length)&&this.renderLayer(this,Q,H,J)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let z=g.Color.transparent;if(this.style.fog&&(z=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?g.Color.black:z,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[v[this.currentLayer]],H=s._getLayerSourceCache($);if($.isSky())continue;const Q=H?R[H.id]:void 0;this._renderTileClippingMasks($,H,Q),this.renderLayer(this,H,$,Q)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const $=this.style._layers[v[this.currentLayer]],H=s._getLayerSourceCache($);$.isSky()&&this.renderLayer(this,H,$,H?R[H.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const $=this.style._layers[v[this.currentLayer]],H=s._getLayerSourceCache($);if($.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const Q=H?("symbol"===$.type?B:R)[H.id]:void 0;this._renderTileClippingMasks($,H,H?D[H.id]:void 0),this.renderLayer(this,H,$,Q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let $=null;g.values(this.style._layers).forEach(H=>{const Q=s._getLayerSourceCache(H);Q&&!H.isHidden(this.transform.zoom)&&(!$||$.getSource().maxzoom<Q.getSource().maxzoom)&&($=Q)}),$&&this.options.showTileBoundaries&&kh.debug(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const H=$.transform.padding;um($,$.transform.height-(H.top||0),3,rr),um($,H.bottom||0,3,Rd),hm($,H.left||0,3,C0),hm($,$.transform.width-(H.right||0),3,Fd);const Q=$.transform.centerPoint;var J,te,le,ce;Mh(J=$,(te=Q.x)-1,(le=$.transform.height-Q.y)-10,2,20,ce=Il),Mh(J,te-10,le-1,20,2,ce)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%g.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(g.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,h,v,E){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||E&&E.length)&&(this.id=v.id,this.gpuTimingStart(v),kh[v.type](s,h,v,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),v.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,v.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const v in s){const E=s[v],D=this.context.extTimerQuery,R=D.getQueryObjectEXT(E.query,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(E.query),h[v]=R}return h}translatePosMatrix(s,h,v,E,D){if(!v[0]&&!v[1])return s;const R=D?"map"===E?this.transform.angle:0:"viewport"===E?-this.transform.angle:0;if(R){const $=Math.sin(R),H=Math.cos(R);v=[v[0]*H-v[1]*$,v[0]*$+v[1]*H]}const B=[D?v[0]:Or(h,v[0],this.transform.zoom),D?v[1]:Or(h,v[1],this.transform.zoom),0],z=new Float32Array(16);return g.translate(z,s,B),z}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),v=this.imageManager.getPattern(s.to.toString());return!h||!v}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,v=[];return this.terrain&&!this.terrain.renderingToTexture&&v.push("TERRAIN"),h&&!s&&0!==h.getOpacity(this.transform.pitch)&&v.push("FOG"),s&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(s,h,v){this.cache=this.cache||{};const E=v||[],D=this.currentGlobalDefines().concat(E),R=Ca.cacheKey(s,D,h);return this.cache[R]||(this.cache[R]=new Ca(this.context,s,Pi[s],h,kd[s],D)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(s){this.terrain&&this.terrain.prepareDrawTile(s)}prepareDrawProgram(s,h,v){if(this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const D=E.getOpacity(this.transform.pitch);0!==D&&h.setFogUniformValues(s,((R,B,z,$)=>{const H=B.properties.get("color"),Q=R.frameCounter/1e3%1,J=[H.r/H.a,H.g/H.a,H.b/H.a,$];return{u_fog_matrix:z?R.transform.calculateFogTileMatrix(z):R.identityMat,u_fog_range:B.getFovAdjustedRange(R.transform._fov),u_fog_color:J,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:Q}})(this,E,v,D))}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}}class bc{constructor(s=0,h=0,v=0,E=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(v)||v<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=v,this.right=E}interpolate(s,h,v){return null!=h.top&&null!=s.top&&(this.top=g.number(s.top,h.top,v)),null!=h.bottom&&null!=s.bottom&&(this.bottom=g.number(s.bottom,h.bottom,v)),null!=h.left&&null!=s.left&&(this.left=g.number(s.left,h.left,v)),null!=h.right&&null!=s.right&&(this.right=g.number(s.right,h.right,v)),this}getCenter(s,h){const v=g.clamp((this.left+s-this.right)/2,0,s),E=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.pointGeometry(v,E)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new bc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gi(_,s){return[_[4*s],_[4*s+1],_[4*s+2],_[4*s+3]]}function Od(_,s,h){_[4*s+0]=h[0],_[4*s+1]=h[1],_[4*s+2]=h[2],_[4*s+3]=h[3]}function mo(_,s){const h=Gi(_,3);g.fromQuat(_,s),Od(_,3,h)}function Ph(_,s){Od(_,3,[s[0],s[1],s[2],1])}function Da(_,s){const h=g.identity$1([]);return g.rotateZ$1(h,h,-s),g.rotateX$1(h,h,-_),h}function Ka(_,s){const h=[_[0],_[1],0],v=[s[0],s[1],0];if(g.length(h)>=1e-15){const R=g.normalize([],h);g.scale(v,R,g.dot(v,R)),s[0]=v[0],s[1]=v[1]}const E=g.cross([],s,_);if(g.len(E)<1e-15)return null;const D=Math.atan2(-E[1],E[0]);return Da(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),D)}class Rh{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){this._position=this._renderWorldCopies?function(h){if(!h)return;const v=Array.isArray(h)?new g.MercatorCoordinate(h[0],h[1],h[2]):h;return v.x=g.wrap(v.x,0,1),v}(s):s}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;const v=this._elevation?this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(s)):0,E=this.position,D=g.MercatorCoordinate.fromLngLat(s,v),R=[D.x-E.x,D.y-E.y,D.z-E.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Ka(R,h)}setPitchBearing(s,h){this.orientation=Da(g.degToRad(s),g.degToRad(-h))}}class ku{constructor(s,h){this._transform=g.identity([]),this._orientation=g.identity$1([]),h&&(this._orientation=h,mo(this._transform,this._orientation)),s&&Ph(this._transform,s)}get mercatorPosition(){const s=this.position;return new g.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=Gi(this._transform,3);return[s[0],s[1],s[2]]}set position(s){Ph(this._transform,s)}get orientation(){return this._orientation}set orientation(s){this._orientation=s,mo(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Da(s,h),mo(this._transform,this._orientation)}forward(){const s=Gi(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=Gi(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=Gi(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const v=new Float64Array(16);return g.invert(v,this.getWorldToCamera(s,h)),v}getWorldToCameraPosition(s,h,v){const E=this.position;g.scale(E,E,-s);const D=new Float64Array(16);return g.fromScaling(D,[v,v,v]),g.translate(D,D,E),D[10]*=h,D}getWorldToCamera(s,h){const v=new Float64Array(16),E=new Float64Array(4),D=this.position;return g.conjugate(E,this._orientation),g.scale(D,D,-s),g.fromQuat(v,E),g.translate(v,v,D),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=h,v[9]*=h,v[10]*=h,v[11]*=h,v}getCameraToClipPerspective(s,h,v,E){const D=new Float64Array(16);return g.perspective(D,s,h,v,E),D}getDistanceToElevation(s){const h=0===s?0:g.mercatorZfromAltitude(s,this.position[1]),v=this.forward();return(h-this.position[2])/v[2]}clone(){return new ku([...this.position],[...this.orientation])}}class Pu{constructor(s,h,v,E,D){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===D||D,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=null==v?0:v,this._maxPitch=null==E?60:E,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new bc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new ku,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const s=new Pu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._cameraZoom=this._cameraZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,s?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(s){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),s&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return g.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-g.wrap(s,-180,180)*Math.PI/180;var v,E,D,R,B,z,$,H,Q,J;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(v=new g.ARRAY_TYPE(4),g.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),E=this.rotationMatrix,R=this.angle,B=(D=this.rotationMatrix)[0],z=D[1],$=D[2],H=D[3],Q=Math.sin(R),J=Math.cos(R),E[0]=B*J+$*Q,E[1]=z*J+H*Q,E[2]=B*-Q+$*J,E[3]=z*-Q+H*J)}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=g.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const s=this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(this.center),-1);return-1===s?(this._cameraZoom=null,!1):(this._centerAltitude=s,!0)}_updateCameraOnTerrain(){const s=this.cameraToCenterDistance/this.worldSize,h=g.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(h+s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let E=0,D=0;for(let R=0;R<h.length;R++){const B=new g.pointGeometry(h[R][0]*this.width,v+h[R][1]*(this.height-v)),z=s.pointCoordinate(B);if(!z)continue;const $=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);E+=z[3]*$,D+=$}return 0===D?NaN:E/D}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const s=this._cameraZoom,h=this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(this.center)),v=g.mercatorZfromAltitude(h,this.center.lat),E=this._mercatorZfromZoom(s),D=this._mercatorZfromZoom(this._maxZoom),R=Math.max(E-v,D);this._setZoom(this._zoomFromMercatorZ(R))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let v;v=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const E=g.length(g.sub([],this._camera.position,v));return g.clamp(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!g.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const v=[s.position.x,s.position.y,s.position.z];g.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new Rh;return h.position=new g.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this._renderWorldCopies,h}_setCameraOrientation(s){if(!g.length$1(s))return!1;g.normalize$1(s,s);const h=g.transformQuat([],[0,0,-1],s),v=g.transformQuat([],[0,-1,0],s);if(v[2]<0)return!1;const E=Ka(h,v);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;s[2]=g.clamp(s[2],E/v,E/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,v){this._unmodified=!1,this._edgeInsets.interpolate(s,h,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new g.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const v=this.pointCoordinate(new g.pointGeometry(0,0)),E=this.pointCoordinate(new g.pointGeometry(this.width,0)),D=this.pointCoordinate(new g.pointGeometry(this.width,this.height)),R=this.pointCoordinate(new g.pointGeometry(0,this.height)),B=Math.floor(Math.min(v.x,E.x,D.x,R.x)),z=Math.floor(Math.max(v.x,E.x,D.x,R.x)),$=1;for(let H=B-$;H<=z+$;H++)0!==H&&h.push(new g.UnwrappedTileID(H,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s);const v=h,E=this.elevation&&!s.isTerrainDEM;if(void 0!==s.minzoom&&h<s.minzoom)return[];void 0!==s.maxzoom&&h>s.maxzoom&&(h=s.maxzoom);const D=g.MercatorCoordinate.fromLngLat(this.center),R=1<<h,B=[R*D.x,R*D.y,0],z=za.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),$=this.pointCoordinate(this.getCameraPoint()),H=R*g.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/g.mercatorZfromAltitude(1,this.center.lat),J=[R*$.x,R*$.y,Q],te=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),le=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?h:0,ce=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=s.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=Pe=>({aabb:new ms([Pe*R,0,_e],[(Pe+1)*R,R,ce]),zoom:0,x:0,y:0,wrap:Pe,fullyVisible:!1}),ue=[];let ge=[];const ve=h,Se=s.reparseOverscaled?v:h,de=Pe=>{if(!this._elevation||!Pe.tileID)return;const Ge=this._elevation.getMinMaxForTile(Pe.tileID),xt=Pe.aabb;Ge?(xt.min[2]=Ge.min,xt.max[2]=Ge.max,xt.center[2]=(xt.min[2]+xt.max[2])/2):(Pe.shouldSplit=nt(Pe),Pe.shouldSplit||(xt.min[2]=xt.max[2]=xt.center[2]=this._centerAltitude))},Fe=Pe=>Pe*Pe,We=Fe((Q-this._centerAltitude)*H),nt=Pe=>{if(Pe.zoom<le)return!0;if(Pe.zoom===ve)return!1;if(null!=Pe.shouldSplit)return Pe.shouldSplit;const Ge=Pe.aabb.distanceX(J),xt=Pe.aabb.distanceY(J);let Dt=We;E&&(Dt=Fe(Pe.aabb.distanceZ(J)*H));const Et=Ge*Ge+xt*xt+Dt;return Et<Fe((1<<ve-Pe.zoom)*te*((dt,Mt)=>{if(Mt*Fe(.707)<dt)return 1;const wn=Math.sqrt(Mt/dt);return wn/(1.4144271570014144+(Math.pow(1.1,wn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Dt,We),Et))};if(this._renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)ue.push(se(-Pe)),ue.push(se(Pe));for(ue.push(se(0));ue.length>0;){const Pe=ue.pop(),Ge=Pe.x,xt=Pe.y;let Dt=Pe.fullyVisible;if(!Dt){const Et=Pe.aabb.intersects(z);if(0===Et)continue;Dt=2===Et}if(Pe.zoom!==ve&&nt(Pe))for(let Et=0;Et<4;Et++){const dt=(Ge<<1)+Et%2,Mt=(xt<<1)+(Et>>1),wn={aabb:Pe.aabb.quadrant(Et),zoom:Pe.zoom+1,x:dt,y:Mt,wrap:Pe.wrap,fullyVisible:Dt,tileID:void 0,shouldSplit:void 0};E&&(wn.tileID=new g.OverscaledTileID(Pe.zoom+1===ve?Se:Pe.zoom+1,Pe.wrap,Pe.zoom+1,dt,Mt),de(wn)),ue.push(wn)}else{const Et=Pe.zoom===ve?Se:Pe.zoom;if(s.minzoom&&s.minzoom>Et)continue;const dt=B[0]-(.5+Ge+(Pe.wrap<<Pe.zoom))*(1<<h-Pe.zoom),Mt=B[1]-.5-xt,wn=Pe.tileID?Pe.tileID:new g.OverscaledTileID(Et,Pe.wrap,Pe.zoom,Ge,xt);ge.push({tileID:wn,distanceSq:dt*dt+Mt*Mt})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,Ge=this.horizonLineFromTop();ge=ge.filter(xt=>{const Dt=[0,0,0,1],Et=[g.EXTENT,g.EXTENT,0,1],dt=this.calculateFogTileMatrix(xt.tileID.toUnwrapped());g.transformMat4(Dt,Dt,dt),g.transformMat4(Et,Et,dt);const Mt=g.getAABBPointSquareDist(Dt,Et);if(0===Mt)return!0;let wn=!1;const Jt=this._elevation;if(Jt&&Mt>Pe&&0!==Ge){const Ur=this.calculateProjMatrix(xt.tileID.toUnwrapped());let wr;s.isTerrainDEM||(wr=Jt.getMinMaxForTile(xt.tileID)),wr||(wr={min:_e,max:ce});const cn=g.furthestTileCorner(this.bearing),Cn=[cn[0]*g.EXTENT,cn[1]*g.EXTENT,wr.max];g.transformMat4$1(Cn,Cn,Ur),wn=(1-Cn[1])*this.height*.5<Ge}return Mt<Pe||wn})}return ge.sort((Pe,Ge)=>Pe.distanceSq-Ge.distanceSq).map(Pe=>Pe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=g.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.pointGeometry(g.mercatorXfromLng(s.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new g.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(s,h){const v=this.pointCoordinate(h),E=this.pointCoordinate(this.centerPoint),D=this.locationCoordinate(s),R=new g.MercatorCoordinate(D.x-(v.x-E.x),D.y-(v.y-E.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(s){this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s){return this._coordinatePoint(this.locationCoordinate(s),!1)}locationPoint3D(s){return this._coordinatePoint(this.locationCoordinate(s),!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s){return g.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s.toLngLat()}pointRayIntersection(s,h){const v=null!=h?h:this._centerAltitude,E=[s.x,s.y,0,1],D=[s.x,s.y,1,1];g.transformMat4(E,E,this.pixelMatrixInverse),g.transformMat4(D,D,this.pixelMatrixInverse);const R=D[3];g.scale$2(E,E,1/E[3]),g.scale$2(D,D,1/R);const B=E[2],z=D[2];return{p0:E,p1:D,t:B===z?0:(v-B)/(z-B)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],v=[s.x,s.y,1,1];return g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(v,v,this.pixelMatrixInverse),g.scale$2(h,h,1/h[3]),g.scale$2(v,v,1/v[3]),h[2]=g.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,v[2]=g.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,g.scale$2(h,h,1/this.worldSize),g.scale$2(v,v,1/this.worldSize),new hu([h[0],h[1],h[2]],g.normalize([],g.sub([],v,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:v,t:E}=s,D=g.mercatorZfromAltitude(h[2],this._center.lat),R=g.mercatorZfromAltitude(v[2],this._center.lat);return new g.MercatorCoordinate(g.number(h[0],v[0],E)/this.worldSize,g.number(h[1],v[1],E)/this.worldSize,g.number(D,R,E))}pointCoordinate(s,h=this._centerAltitude){const v=this.horizonLineFromTop(!1),E=new g.pointGeometry(s.x,Math.max(v,s.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(E,h))}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);const h=this.elevation;let v=this.elevation.pointCoordinate(s);if(v)return new g.MercatorCoordinate(v[0],v[1],v[2]);let E=0,D=this.horizonLineFromTop();if(s.y>D)return this.pointCoordinate(s);const R=.02*D,B=s.clone();for(let z=0;z<10&&D-E>R;z++){B.y=g.number(E,D,.66);const $=h.pointCoordinate(B);$?(D=B.y,v=$):E=B.y}return v?new g.MercatorCoordinate(v[0],v[1],v[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){if(this.elevation)return!this.elevation.pointCoordinate(s);{const h=this.horizonLineFromTop();return s.y<h}}_coordinatePoint(s,h){const v=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,E=[s.x*this.worldSize,s.y*this.worldSize,v+s.toAltitude(),1];return g.transformMat4(E,E,this.pixelMatrix),E[3]>0?new g.pointGeometry(E[0]/E[3],E[1]/E[3]):new g.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(s,h){const v=new g.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),E=new g.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),D=new g.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),R=new g.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let B=this.pointCoordinate(v,s),z=this.pointCoordinate(E,s);const $=this.pointCoordinate(D,h),H=this.pointCoordinate(R,h),Q=(J,te)=>(te.y-J.y)/(te.x-J.x);return B.y>1&&z.y>=0?B=new g.MercatorCoordinate((1-H.y)/Q(H,B)+H.x,1):B.y<0&&z.y<=1&&(B=new g.MercatorCoordinate(-H.y/Q(H,B)+H.x,0)),z.y>1&&B.y>=0?z=new g.MercatorCoordinate((1-$.y)/Q($,z)+$.x,1):z.y<0&&B.y<=1&&(z=new g.MercatorCoordinate(-$.y/Q($,z)+$.x,0)),(new g.LngLatBounds).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation($))}_getBounds3D(){const s=this.elevation,h=s.visibleDemTiles.reduce((v,E)=>{if(E.dem){const D=E.dem.tree;v.min=Math.min(v.min,D.minimums[0]),v.max=Math.max(v.max,D.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,v):v}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(s){if(s){const h=s.getEast(),v=s.getWest();this.lngRange=[v,h>v?h:h+360],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(s,h){const v=s.canonical,E=h/this.zoomScale(v.z),D=v.x+Math.pow(2,v.z)*s.wrap,R=g.identity(new Float64Array(16));return g.translate(R,R,[D*E,v.y*E,0]),g.scale$1(R,R,[E/g.EXTENT,E/g.EXTENT,1]),R}calculateFogTileMatrix(s){const h=s.key,v=this._fogTileMatrixCache;if(v[h])return v[h];const E=this.calculatePosMatrix(s,this.cameraWorldSize);return g.multiply(E,this.worldToFogMatrix,E),v[h]=new Float32Array(E),v[h]}calculateProjMatrix(s,h=!1){const v=s.key,E=h?this._alignedProjMatrixCache:this._projMatrixCache;if(E[v])return E[v];const D=this.calculatePosMatrix(s,this.worldSize);return g.multiply(D,h?this.alignedProjMatrix:this.projMatrix,D),E[v]=new Float32Array(D),E[v]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const h=this._camera.position,v=this._camera.forward();if(h[2]<=0||v[2]>=0)return;const E=g.mercatorZfromAltitude(1,this._center.lat);h[2]/=E,v[2]/=E,g.normalize(v,v);const D=s.raycast(h,v,s.exaggeration());if(D){const R=g.scaleAndAdd([],h,v,D),B=new g.MercatorCoordinate(R[0],R[1],g.mercatorZfromAltitude(R[2],g.latFromMercatorY(R[1]))),z=this._camera.position,$=B.z+g.length([B.x-z[0],B.y-z[1],B.z-z[2]]);this._cameraZoom=this._zoomFromMercatorZ($),this._centerAltitude=B.toAltitude(),this._center=B.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const h=s.getAtPointOrZero(this._camera.mercatorPosition),v=this._minimumHeightOverTerrain()*Math.cos(g.degToRad(this._maxPitch)),E=g.mercatorZfromAltitude(h,this._center.lat),D=this._camera.position[2]-E;if(D<v){const R=g.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),B=this._camera.mercatorPosition,z=[R.x-B.x,R.y-B.y,R.z-B.z],$=g.length(z);z[2]-=v-D;const H=g.length(z);if(0===H)return;g.scale(z,z,$/H),this._camera.position=[R.x-z[0],R.y-z[1],R.z-z[2]],this._camera.orientation=Ka(z,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,v,E,D,R=1/0,B=-1/0;const z=this.size,$=this._unmodified;if(this.latRange){const te=this.latRange;R=g.mercatorYfromLat(te[1])*this.worldSize,B=g.mercatorYfromLat(te[0])*this.worldSize,v=B-R<z.y?z.y/(B-R):0}if(this.lngRange){const te=this.lngRange;s=g.mercatorXfromLng(te[0])*this.worldSize,h=g.mercatorXfromLng(te[1])*this.worldSize,E=h-s<z.x?z.x/(h-s):0}const H=this.point,Q=Math.max(E||0,v||0);if(Q)return this.center=this.unproject(new g.pointGeometry(E?(h+s)/2:H.x,v?(B+R)/2:H.y)),this.zoom+=this.scaleZoom(Q),this._unmodified=$,void(this._constraining=!1);if(this.latRange){const te=H.y,le=z.y/2;te-le<R&&(D=R+le),te+le>B&&(D=B-le)}let J=H.x;if(this.lngRange){const te=this.worldSize/2-(s+h)/2;J=(J+te+this.worldSize)%this.worldSize,s+=te,h+=te;const le=z.x/2;J-le<s&&(J=s+le),J+le>h&&(J=h-le),J-=te}J===H.x&&void 0===D||(this.center=this.unproject(new g.pointGeometry(J,void 0!==D?D:H.y))),this._constrainCameraAltitude(),this._unmodified=$,this._constraining=!1}_minZoomForBounds(){const s=(E,D)=>Math.log2(E/(this.tileSize*Math.abs(D[1]-D[0])));let h=0;if(this.latRange){const E=this.latRange;h=s(this.height,[g.mercatorYfromLat(E[0]),g.mercatorYfromLat(E[1])])}let v=0;if(this.lngRange){const E=this.lngRange;v=s(this.width,[g.mercatorXfromLng(E[0]),g.mercatorXfromLng(E[1])])}return Math.max(h,v)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=this.pixelsPerMeter;this._updateCameraState();const v=Math.PI/2+this._pitch,E=this.fovAboveCenter,D=this.elevation?this.elevation.getMinElevationBelowMSL()*h:0,R=(this._camera.position[2]*this.worldSize-D)/Math.cos(this._pitch),B=Math.sin(E)*R/Math.sin(g.clamp(Math.PI-v-E,.01,Math.PI-.01)),z=this.point,$=z.x,H=z.y,Q=Math.cos(Math.PI/2-this._pitch)*B+R,J=Math.min(1.01*Q,R*(1/this._horizonShift)),te=this.height/50,le=this._camera.getWorldToCamera(this.worldSize,h),ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,te,J);ce[8]=2*-s.x/this.width,ce[9]=2*s.y/this.height;let _e=g.mul$1([],ce,le);this.mercatorMatrix=g.scale$1([],_e,[this.worldSize,this.worldSize,this.worldSize/h]),this.projMatrix=_e,this.invProjMatrix=g.invert(new Float64Array(16),this.projMatrix);const se=new Float32Array(16);g.identity(se),g.scale$1(se,se,[1,-1,1]),g.rotateX(se,se,this._pitch),g.rotateZ(se,se,this.angle);const ue=g.perspective(new Float32Array(16),this._fov,this.width/this.height,te,J),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ue[8]=2*-s.x/this.width,ue[9]=2*(s.y+ge)/this.height,this.skyboxMatrix=g.multiply(se,ue,se);const ve=this.width%2/2,Se=this.height%2/2,de=Math.cos(this.angle),Fe=Math.sin(this.angle),We=$-Math.round($)+de*ve+Fe*Se,nt=H-Math.round(H)+de*Se+Fe*ve,Pe=new Float64Array(_e);if(g.translate(Pe,Pe,[We>.5?We-1:We,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Pe,_e=g.create$1(),g.scale$1(_e,_e,[this.width/2,-this.height/2,1]),g.translate(_e,_e,[1,-1,0]),this.labelPlaneMatrix=_e,_e=g.create$1(),g.scale$1(_e,_e,[1,-1,1]),g.translate(_e,_e,[-1,-1,0]),g.scale$1(_e,_e,[2/this.width,2/this.height,1]),this.glCoordMatrix=_e,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),_e=g.invert(new Float64Array(16),this.pixelMatrix),!_e)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_e,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSize,h=this.cameraPixelsPerMeter,v=this._camera.position,E=1/this.height,D=[s,s,h];g.scale(D,D,E),g.scale(v,v,-1),g.multiply$1(v,v,D);const R=g.create$1();g.translate(R,R,v),g.scale$1(R,R,D),this.mercatorFogMatrix=R,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,E)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const s=this._camera.forward(),h=this.cameraToCenterDistance,v=this.point,E=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-g.mercatorZfromAltitude(this._centerAltitude,this.center.lat),D=this.cameraToCenterDistance/E;this._camera.position=[v.x/this.worldSize-s[0]*h/D,v.y/this.worldSize-s[1]*h/D,g.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-s[2]*h/D]}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=s[2];let E=1;v>0&&(E=Math.min((h-this._camera.position[2])/v,1)),this._camera.position=g.scaleAndAdd([],this._camera.position,s,E),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:v,bearing:E}=this._camera.getPitchBearing(),D=g.mercatorZfromAltitude(this._centerAltitude,this.center.lat),R=this._mercatorZfromZoom(this._maxZoom)*Math.cos(g.degToRad(this._maxPitch)),B=Math.max((s[2]-D)/Math.cos(v),R),z=this._zoomFromMercatorZ(B);g.scaleAndAdd(s,s,h,B),this._pitch=g.clamp(v,g.degToRad(this.minPitch),g.degToRad(this.maxPitch)),this.angle=g.wrap(E,-Math.PI,Math.PI),this._setZoom(g.clamp(z,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new g.MercatorCoordinate(s[0],s[1],s[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(s,h){const v=Math.min(s.x,h.x),E=Math.max(s.x,h.x),D=Math.min(s.y,h.y),R=Math.max(s.y,h.y);if(D<this.horizonLineFromTop(!1))return!0;const B=[new g.pointGeometry(v,D),new g.pointGeometry(E,R),new g.pointGeometry(v,R),new g.pointGeometry(E,D)],z=this._renderWorldCopies?-3:0,$=this._renderWorldCopies?4:1;for(const H of B){const Q=this.pointRayIntersection(H);if(Q.t<0)return!0;const J=this.rayIntersectionCoordinate(Q);if(J.x<z||J.y<0||J.x>$||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+g.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new g.pointGeometry(0,0),new g.pointGeometry(this.width,this.height))}zoomDeltaToMovement(s,h){const v=g.length(g.sub([],this._camera.position,s)),E=this._zoomFromMercatorZ(v)+h;return v-this._mercatorZfromZoom(E)}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.pointGeometry(0,s))}}function qr(_,s){let h=!1,v=null;const E=()=>{v=null,h&&(_(),v=setTimeout(E,s),h=!1)};return()=>(h=!0,v||E(),v)}class dm{constructor(s){this._hashName=s&&encodeURIComponent(s),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qr(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,E=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,E),R=Math.round(h.lng*D)/D,B=Math.round(h.lat*D)/D,z=this._map.getBearing(),$=this._map.getPitch();let H="";if(H+=s?`/${R}/${B}/${v}`:`${v}/${B}/${R}`,(z||$)&&(H+="/"+Math.round(10*z)/10),$&&(H+=`/${Math.round($)}`),this._hashName){const Q=this._hashName;let J=!1;const te=g.window.location.hash.slice(1).split("&").map(le=>{const ce=le.split("=")[0];return ce===Q?(J=!0,`${ce}=${H}`):le}).filter(le=>le);return J||te.push(`${Q}=${H}`),`#${te.join("&")}`}return`#${H}`}_getCurrentHash(){const s=g.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(h=v)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=g.window.location.href.replace(/(#.+)?$/,this.getHashString());g.window.history.replaceState(g.window.history.state,null,s)}}const Ja={linearity:.3,easing:g.bezier(0,0,.3,1)},Ld=g.extend({deceleration:2500,maxSpeed:1400},Ja),oi=g.extend({deceleration:20,maxSpeed:1400},Ja),hf=g.extend({deceleration:1e3,maxSpeed:360},Ja),Bd=g.extend({deceleration:1e3,maxSpeed:90},Ja);class wc{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=g.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new g.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:D}of this._inertiaBuffer)h.zoom+=D.zoomDelta||0,h.bearing+=D.bearingDelta||0,h.pitch+=D.pitchDelta||0,D.panDelta&&h.pan._add(D.panDelta),D.around&&(h.around=D.around),D.pinchAround&&(h.pinchAround=D.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(h.pan.mag()){const D=Ru(h.pan.mag(),v,g.extend({},Ld,s||{}));E.offset=h.pan.mult(D.amount/h.pan.mag()),E.center=this._map.transform.center,eo(E,D)}if(h.zoom){const D=Ru(h.zoom,v,oi);E.zoom=this._map.transform.zoom+D.amount,eo(E,D)}if(h.bearing){const D=Ru(h.bearing,v,hf);E.bearing=this._map.transform.bearing+g.clamp(D.amount,-179,179),eo(E,D)}if(h.pitch){const D=Ru(h.pitch,v,Bd);E.pitch=this._map.transform.pitch+D.amount,eo(E,D)}if(E.zoom||E.bearing){const D=void 0===h.pinchAround?h.around:h.pinchAround;E.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),g.extend(E,{noMoveStart:!0})}}function eo(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function Ru(_,s,h){const{maxSpeed:v,linearity:E,deceleration:D}=h,R=g.clamp(_*E/(s/1e3),-v,v),B=Math.abs(R)/(D*E);return{easing:h.easing,duration:1e3*B,amount:R*(B/2)}}class to extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v,E={}){const D=st.mousePos(h.getCanvasContainer(),v),R=h.unproject(D);super(s,g.extend({point:D,lngLat:R,originalEvent:v},E)),this._defaultPrevented=!1,this.target=h}}class Xs extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v){const E="touchend"===s?v.changedTouches:v.touches,D=st.touchPos(h.getCanvasContainer(),E),R=D.map(z=>h.unproject(z)),B=D.reduce((z,$,H,Q)=>z.add($.div(Q.length)),new g.pointGeometry(0,0));super(s,{points:D,point:B,lngLats:R,lngLat:h.unproject(B),originalEvent:v}),this._defaultPrevented=!1}}class Mo extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v){super(s,{originalEvent:v}),this._defaultPrevented=!1}}class Pl{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Mo(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new to(s.type,this._map,s))}mouseup(s){this._map.fire(new to(s.type,this._map,s))}preclick(s){const h=g.extend({},s);h.type="preclick",this._map.fire(new to(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new to(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new to(s.type,this._map,s))}mouseover(s){this._map.fire(new to(s.type,this._map,s))}mouseout(s){this._map.fire(new to(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Xs(s.type,this._map,s))}touchmove(s){this._map.fire(new Xs(s.type,this._map,s))}touchend(s){this._map.fire(new Xs(s.type,this._map,s))}touchcancel(s){this._map.fire(new Xs(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fh{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(s){this._map.fire(new to(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new to("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new to(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class df{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&0===s.button&&(st.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const v=h;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const E=this._startPos;this._lastPos=v,this._box||(this._box=st.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const D=Math.min(E.x,v.x),R=Math.max(E.x,v.x),B=Math.min(E.y,v.y),z=Math.max(E.y,v.y);this._map._requestDomTask(()=>{this._box&&(st.setTransform(this._box,`translate(${D}px,${B}px)`),this._box.style.width=R-D+"px",this._box.style.height=z-B+"px")})}mouseupWindow(s,h){if(!this._active||0!==s.button)return;const v=this._startPos,E=h;if(this.reset(),st.suppressClick(),v.x!==E.x||v.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:D=>D.fitScreenCoordinates(v,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(st.remove(this._box),this._box=null),st.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new g.Event(s,{originalEvent:h}))}}function ws(_,s){const h={};for(let v=0;v<_.length;v++)h[_[v].identifier]=s[v];return h}class Nd{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),v.length===this.numTouches&&(this.centroid=function(E){const D=new g.pointGeometry(0,0);for(const R of E)D._add(R);return D.div(E.length)}(h),this.touches=ws(v,h)))}touchmove(s,h,v){if(this.aborted||!this.centroid)return;const E=ws(v,h);for(const D in this.touches){const R=this.touches[D],B=E[D];(!B||B.dist(R)>30)&&(this.aborted=!0)}}touchend(s,h,v){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class Cc{constructor(s){this.singleTap=new Nd(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,v){this.singleTap.touchstart(s,h,v)}touchmove(s,h,v){this.singleTap.touchmove(s,h,v)}touchend(s,h,v){const E=this.singleTap.touchend(s,h,v);if(E){const D=s.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(E)<30;if(D&&R||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class sn{constructor(){this._zoomIn=new Cc({numTouches:1,numTaps:2}),this._zoomOut=new Cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,v){this._zoomIn.touchstart(s,h,v),this._zoomOut.touchstart(s,h,v)}touchmove(s,h,v){this._zoomIn.touchmove(s,h,v),this._zoomOut.touchmove(s,h,v)}touchend(s,h,v){const E=this._zoomIn.touchend(s,h,v),D=this._zoomOut.touchend(s,h,v);return E?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(E)},{originalEvent:s})}):D?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(D)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const To={0:1,2:2};class zd{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const v=st.mouseButton(s);this._correctButton(s,v)&&(this._lastPoint=h,this._eventButton=v)}mousemoveWindow(s,h){const v=this._lastPoint;if(v)if(s.preventDefault(),function(E,D){const R=To[D];return void 0===E.buttons||(E.buttons&R)!==R}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(v,h)}mouseupWindow(s){this._lastPoint&&st.mouseButton(s)===this._eventButton&&(this._moved&&st.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sa extends zd{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return 0===h&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Vd extends zd{_correctButton(s,h){return 0===h&&s.ctrlKey||2===h}_move(s,h){const v=.8*(h.x-s.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(s){s.preventDefault()}}class Ys extends zd{_correctButton(s,h){return 0===h&&s.ctrlKey||2===h}_move(s,h){const v=-.5*(h.y-s.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(s){s.preventDefault()}}class Ec{constructor(s){this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new g.pointGeometry(0,0)}touchstart(s,h,v){return this._calculateTransform(s,h,v)}touchmove(s,h,v){if(this._active&&!(v.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,v)}touchend(s,h,v){this._calculateTransform(s,h,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,v){v.length>0&&(this._active=!0);const E=ws(v,h),D=new g.pointGeometry(0,0),R=new g.pointGeometry(0,0);let B=0;for(const $ in E){const H=E[$],Q=this._touches[$];Q&&(D._add(H),R._add(H.sub(Q)),B++,E[$]=H)}if(this._touches=E,B<this._minTouches||!R.mag())return;const z=R.div(B);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(B),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ud{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,v){return{}}touchstart(s,h,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,v){if(!this._firstTwoTouches)return;s.preventDefault();const[E,D]=this._firstTwoTouches,R=ct(v,h,E),B=ct(v,h,D);if(!R||!B)return;const z=this._aroundCenter?null:R.add(B).div(2);return this._move([R,B],z,s)}touchend(s,h,v){if(!this._firstTwoTouches)return;const[E,D]=this._firstTwoTouches,R=ct(v,h,E),B=ct(v,h,D);R&&B||(this._active&&st.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ct(_,s,h){for(let v=0;v<_.length;v++)if(_[v].identifier===h)return s[v]}function Wn(_,s){return Math.log(_/s)/Math.LN2}class el extends Ud{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const v=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Wn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wn(this._distance,v),pinchAround:h}}}function si(_,s){return 180*_.angleWith(s)/Math.PI}class Dc extends Ud{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const v=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:si(this._vector,v),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,v=si(s,this._startVector);return Math.abs(v)<h}}function no(_){return Math.abs(_.y)>Math.abs(_.x)}class Cs extends Ud{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(s){this._lastPoints=s,no(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,v){const E=s[0].sub(this._lastPoints[0]),D=s[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(E,D,v.timeStamp),this._valid)return this._lastPoints=s,this._active=!0,{pitchDelta:(E.y+D.y)/2*-.5}}gestureBeginsVertically(s,h,v){if(void 0!==this._valid)return this._valid;const E=s.mag()>=2,D=h.mag()>=2;if(!E&&!D)return;if(!E||!D)return void 0===this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const R=s.y>0==h.y>0;return no(s)&&no(h)&&R}}const Oh={panStep:100,bearingStep:15,pitchStep:10};class Rl{constructor(){const s=Oh;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,v=0,E=0,D=0,R=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?v=-1:(s.preventDefault(),D=-1);break;case 39:s.shiftKey?v=1:(s.preventDefault(),D=1);break;case 38:s.shiftKey?E=1:(s.preventDefault(),R=-1);break;case 40:s.shiftKey?E=-1:(s.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(v=0,E=0),{cameraAnimation:B=>{const z=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:Pt,zoom:h?Math.round(z)+h*(s.shiftKey?2:1):z,bearing:B.getBearing()+v*this._bearingStep,pitch:B.getPitch()+E*this._pitchStep,offset:[-D*this._panStep,-R*this._panStep],center:B.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pt(_){return _*(2-_)}const jd=4.000244140625;class Fu{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,g.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;let h=s.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const v=g.exported.now(),E=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==h&&h%jd==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(E*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=st.mousePos(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform,h=()=>s._terrainEnabled()?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const z="wheel"===this._type&&Math.abs(this._delta)>jd?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&0!==$&&($=1/$);const H=h(),Q=Math.pow(2,H),J="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):Q;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(J*$))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:h(),E=this._startZoom,D=this._easing;let R,B=!1;if("wheel"===this._type&&E&&D){const z=Math.min((g.exported.now()-this._lastWheelEventTime)/200,1),$=D(z);R=g.number(E,v,$),z<1?this._frameId||(this._frameId=!0):B=!0}else R=v,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:R-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=g.ease;if(this._prevEase){const v=this._prevEase,E=(g.exported.now()-v.start)/v.duration,D=v.easing(E+.01)-v.easing(E),R=.27/Math.sqrt(D*D+1e-4)*.01,B=Math.sqrt(.0729-R*R);h=g.bezier(R,B,.25,1)}return this._prevEase={start:g.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}}class tl{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(s.shiftKey?-1:1),around:v.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Es{constructor(){this._tap=new Cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,v){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=h[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(s,h,v))}touchmove(s,h,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const E=h[0],D=E.y-this._swipePoint.y;return this._swipePoint=E,s.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(s,h,v)}touchend(s,h,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(s,h,v)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gd{constructor(s,h,v){this._el=s,this._mousePan=h,this._touchPan=v}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fl{constructor(s,h,v){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ks{constructor(s,h,v,E){this._el=s,this._touchZoom=h,this._touchRotate=v,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ou=_=>_.zoom||_.drag||_.pitch||_.rotate;class $d extends g.Event{}class Af{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const v=g.sub([],h,s);this.radius=g.length(v[2]<0?g.div([],v,this.constants):[v[0],v[1],0])}projectRay(s){g.div(s,s,this.constants),g.normalize(s,s),g.mul$2(s,s,this.constants);const h=g.scale([],s,this.radius);if(h[2]>0){const v=g.scale([],[0,0,1],g.dot(h,[0,0,1])),E=g.scale([],g.normalize([],[h[0],h[1],0]),this.radius),D=g.add([],h,g.scale([],g.sub([],g.add([],E,v),h),2));h[0]=D[0],h[1]=D[1]}return h}}function Ol(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Lu{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wc(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Af,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[g.window,"blur",void 0]];for(const[E,D,R]of this._listeners)st.addEventListener(E,D,E===g.window.document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[s,h,v]of this._listeners)st.removeEventListener(s,h,s===g.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(s){const h=this._map,v=h.getCanvasContainer();this._add("mapEvent",new Pl(h,s));const E=h.boxZoom=new df(h,s);this._add("boxZoom",E);const D=new sn,R=new bi;h.doubleClickZoom=new tl(R,D),this._add("tapZoom",D),this._add("clickZoom",R);const B=new Es;this._add("tapDragZoom",B);const z=h.touchPitch=new Cs;this._add("touchPitch",z);const $=new Vd(s),H=new Ys(s);h.dragRotate=new Fl(s,$,H),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Q=new Sa(s),J=new Ec(s);h.dragPan=new Gd(v,Q,J),this._add("mousePan",Q),this._add("touchPan",J,["touchZoom","touchRotate"]);const te=new Dc,le=new el;h.touchZoomRotate=new Ks(v,le,te,B),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fh(h));const ce=h.scrollZoom=new Fu(h,this);this._add("scrollZoom",ce,["mousePan"]);const _e=h.keyboard=new Rl;this._add("keyboard",_e);for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[se]&&h[se].enable(s[se])}_add(s,h,v){this._handlers.push({handlerName:s,handler:h,allowed:v}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ou(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,h,v){for(const E in s)if(E!==v&&(!h||h.indexOf(E)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const v of s)this._el.contains(v.target)&&h.push(v);return h}handleEvent(s,h){this._updatingCamera=!0;const v="renderFrame"===s.type,E=v?void 0:s,D={needsRenderFrame:!1},R={},B={},z=s.touches?this._getMapTouches(s.touches):void 0,$=z?st.touchPos(this._el,z):v?void 0:st.mousePos(this._el,s);for(const{handlerName:J,handler:te,allowed:le}of this._handlers){if(!te.isEnabled())continue;let ce;this._blockedByActive(B,le,J)?te.reset():te[h||s.type]&&(ce=te[h||s.type](s,$,z),this.mergeHandlerResult(D,R,ce,J,E),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||te.isActive())&&(B[J]=te)}const H={};for(const J in this._previousActiveHandlers)B[J]||(H[J]=E);this._previousActiveHandlers=B,(Object.keys(H).length||Ol(D))&&(this._changes.push([D,R,H]),this._triggerRenderFrame()),(Object.keys(B).length||Ol(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=D;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(s,h,v,E,D){if(!v)return;g.extend(s,v);const R={handlerName:E,originalEvent:v.originalEvent||D};void 0!==v.zoomDelta&&(h.zoom=R),void 0!==v.panDelta&&(h.drag=R),void 0!==v.pitchDelta&&(h.pitch=R),void 0!==v.bearingDelta&&(h.rotate=R)}_applyChanges(){const s={},h={},v={};for(const[E,D,R]of this._changes)E.panDelta&&(s.panDelta=(s.panDelta||new g.pointGeometry(0,0))._add(E.panDelta)),E.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+E.pitchDelta),void 0!==E.around&&(s.around=E.around),void 0!==E.aroundCoord&&(s.aroundCoord=E.aroundCoord),void 0!==E.pinchAround&&(s.pinchAround=E.pinchAround),E.noInertia&&(s.noInertia=E.noInertia),g.extend(h,D),g.extend(v,R);this._updateMapTransform(s,h,v),this._changes=[]}_updateMapTransform(s,h,v){const E=this._map,D=E.transform,R=ue=>[ue.x,ue.y,ue.z];if((ue=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Ol(s)){const ue=D.zoom;D.cameraElevationReference="sea",D.recenterOnTerrain(),D.cameraElevationReference="ground",ue!==D.zoom&&this._map._update(!0)}if(!Ol(s))return this._fireEvents(h,v,!0);let{panDelta:B,zoomDelta:z,bearingDelta:$,pitchDelta:H,around:Q,aroundCoord:J,pinchAround:te}=s;void 0!==te&&(Q=te),(ue=>h.drag&&!this._eventsInProgress.drag)()&&Q&&(this._dragOrigin=R(D.pointCoordinate3D(Q)),this._trackingEllipsoid.setup(D._camera.position,this._dragOrigin)),D.cameraElevationReference="sea",E._stop(!0),Q=Q||E.transform.centerPoint,$&&(D.bearing+=$),H&&(D.pitch+=H),D._updateCameraState();const le=[0,0,0];if(B){const ue=D.screenPointToMercatorRay(Q),ge=D.screenPointToMercatorRay(Q.sub(B)),ve=this._trackingEllipsoid.projectRay(ue.dir),Se=this._trackingEllipsoid.projectRay(ge.dir);le[0]=Se[0]-ve[0],le[1]=Se[1]-ve[1]}const ce=D.zoom,_e=[0,0,0];if(z){const ue=R(J||D.pointCoordinate3D(Q)),ge={dir:g.normalize([],g.sub([],ue,D._camera.position))},ve=D.screenPointToMercatorRay(D.centerPoint);if(ge.dir[2]<0){const Se=g.altitudeFromMercatorZ(ue[2],ue[1]),de=D.rayIntersectionCoordinate(D.pointRayIntersection(D.centerPoint,Se)),Fe=D.zoomDeltaToMovement(R(de),z)*(ve.dir[2]/ge.dir[2]);g.scale(_e,ge.dir,Fe)}else if(D._terrainEnabled()){const Se=D.zoomDeltaToMovement(ue,z);g.scale(_e,ge.dir,Se)}}const se=g.add(le,le,_e);D._translateCameraConstrained(se),z&&Math.abs(D.zoom-ce)>1e-4&&D.recenterOnTerrain(),D.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,v,!0)}_fireEvents(s,h,v){const E=Ou(this._eventsInProgress),D=Ou(s),R={};for(const H in s){const{originalEvent:Q}=s[H];this._eventsInProgress[H]||(R[`${H}start`]=Q),this._eventsInProgress[H]=s[H]}!E&&D&&this._fireEvent("movestart",D.originalEvent);for(const H in R)this._fireEvent(H,R[H]);D&&this._fireEvent("move",D.originalEvent);for(const H in s){const{originalEvent:Q}=s[H];this._fireEvent(H,Q)}const B={};let z;for(const H in this._eventsInProgress){const{handlerName:Q,originalEvent:J}=this._eventsInProgress[H];this._handlersById[Q].isActive()||(delete this._eventsInProgress[H],z=h[Q]||J,B[`${H}end`]=z)}for(const H in B)this._fireEvent(H,B[H]);const $=Ou(this._eventsInProgress);if(v&&(E||D)&&!$){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=J=>0!==J&&-this._bearingSnap<J&&J<this._bearingSnap;H?(Q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:z})):(this._map.fire(new g.Event("moveend",{originalEvent:z})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new g.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new $d("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Sc extends g.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}getCenter(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,v){return s=g.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,g.extend({offset:s},h),v)}panTo(s,h,v){return this.easeTo(g.extend({center:s},h),v)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,v){return this.easeTo(g.extend({zoom:s},h),v)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,v){return this.easeTo(g.extend({bearing:s},h),v)}resetNorth(s,h){return this.rotateTo(0,g.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=g.LngLatBounds.convert(s);const v=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),v,h)}_extendCameraOptions(s){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(s=g.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding){const v=s.padding;s.padding={top:v,bottom:v,right:v,left:v}}return s.padding=g.extend(h,s.padding),s}_cameraForBoxAndBearing(s,h,v,E){const D=this._extendCameraOptions(E),R=this.transform,B=R.padding,z=R.project(g.LngLat.convert(s)),$=R.project(g.LngLat.convert(h)),H=z.rotate(-g.degToRad(v)),Q=$.rotate(-g.degToRad(v)),J=new g.pointGeometry(Math.max(H.x,Q.x),Math.max(H.y,Q.y)),te=new g.pointGeometry(Math.min(H.x,Q.x),Math.min(H.y,Q.y)),le=J.sub(te),ce=(R.width-(B.left+B.right+D.padding.left+D.padding.right))/le.x,_e=(R.height-(B.top+B.bottom+D.padding.top+D.padding.bottom))/le.y;if(_e<0||ce<0)return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(R.scaleZoom(R.scale*Math.min(ce,_e)),D.maxZoom),ue="number"==typeof D.offset.x?new g.pointGeometry(D.offset.x,D.offset.y):g.pointGeometry.convert(D.offset),ge=new g.pointGeometry((D.padding.left-D.padding.right)/2,(D.padding.top-D.padding.bottom)/2).rotate(v*Math.PI/180),ve=ue.add(ge).mult(R.scale/R.zoomScale(se));return{center:R.unproject(z.add($).div(2).sub(ve)),zoom:se,bearing:v}}_cameraForBox(s,h,v,E,D){const R=this._extendCameraOptions(D);v=v||0,E=E||0,s=g.LngLat.convert(s),h=g.LngLat.convert(h);const B=this.transform.clone();B.padding=R.padding;const z=this.getFreeCameraOptions(),$=new g.LngLat(.5*(s.lng+h.lng),.5*(s.lat+h.lat)),H=.5*(v+E);if(B._camera.position[2]<g.mercatorZfromAltitude(H,$.lat))return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");z.lookAtPoint($),B.setFreeCameraOptions(z);const Q=g.MercatorCoordinate.fromLngLat(s),J=g.MercatorCoordinate.fromLngLat(h),te=B.pointRayIntersection(B.centerPoint,H),le=[(ce=B.rayIntersectionCoordinate(te)).x,ce.y,ce.z];var ce;const _e=B.screenPointToMercatorRay(B.centerPoint);let se,ue=0;do{const ge=Math.floor(B.zoom),ve=1<<ge,Se=Math.min(ve*Q.x,ve*J.x),de=Math.min(ve*Q.y,ve*J.y),Fe=Math.max(ve*Q.x,ve*J.x),We=Math.max(ve*Q.y,ve*J.y),nt=new ms([Se,de,v],[Fe,We,E]),Pe=za.fromInvProjectionMatrix(B.invProjMatrix,B.worldSize,ge);if(2!==nt.intersects(Pe)){se&&(B._camera.position=g.scaleAndAdd([],B._camera.position,_e.dir,-se),B._updateStateFromCamera());break}const Ge=g.sub([],B._camera.position,le);se=.5*g.length(Ge),B._camera.position=g.scaleAndAdd([],B._camera.position,_e.dir,se);try{B._updateStateFromCamera()}catch(xt){return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ue<10);return{center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch}}fitBounds(s,h,v){return this._fitInternal(this.cameraForBounds(s,h),h,v)}_raycastElevationBox(s,h){const v=this.transform.elevation;if(!v)return;const E=new g.pointGeometry(s.x,h.y),D=new g.pointGeometry(h.x,s.y),R=v.pointCoordinate(s);if(!R)return;const B=v.pointCoordinate(h);if(!B)return;const z=v.pointCoordinate(E);if(!z)return;const $=v.pointCoordinate(D);if(!$)return;const H=new g.MercatorCoordinate(R[0],R[1]).toLngLat(),Q=new g.MercatorCoordinate(B[0],B[1]).toLngLat(),J=new g.MercatorCoordinate(z[0],z[1]).toLngLat(),te=new g.MercatorCoordinate($[0],$[1]).toLngLat(),le=Math.min(H.lng,Math.min(Q.lng,Math.min(J.lng,te.lng))),ce=Math.min(H.lat,Math.min(Q.lat,Math.min(J.lat,te.lat))),_e=Math.max(H.lng,Math.max(Q.lng,Math.max(J.lng,te.lng))),se=Math.max(H.lat,Math.max(Q.lat,Math.max(J.lat,te.lat))),ue=Math.min(R[3],Math.min(B[3],Math.min(z[3],$[3]))),ge=Math.max(R[3],Math.max(B[3],Math.max(z[3],$[3])));return{minLngLat:new g.LngLat(le,ce),maxLngLat:new g.LngLat(_e,se),minAltitude:ue,maxAltitude:ge}}fitScreenCoordinates(s,h,v,E,D){let R,B,z,$;const H=g.pointGeometry.convert(s),Q=g.pointGeometry.convert(h),J=this._raycastElevationBox(H,Q);if(J)R=J.minLngLat,B=J.maxLngLat,z=J.minAltitude,$=J.maxAltitude;else{if(this.transform.isCornerOffEdge(H,Q))return this;R=this.transform.pointLocation(H),B=this.transform.pointLocation(Q)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(g.pointGeometry.convert(s)),this.transform.pointLocation(g.pointGeometry.convert(h)),v,E):this._cameraForBox(R,B,z,$,E),E,D)}_fitInternal(s,h,v){return s?(delete(h=g.extend(s,h)).padding,h.linear?this.easeTo(h,v):this.flyTo(h,v)):this}jumpTo(s,h){this.stop();const v=this.transform;let E=!1,D=!1,R=!1;return"zoom"in s&&v.zoom!==+s.zoom&&(E=!0,v.zoom=+s.zoom),void 0!==s.center&&(v.center=g.LngLat.convert(s.center)),"bearing"in s&&v.bearing!==+s.bearing&&(D=!0,v.bearing=+s.bearing),"pitch"in s&&v.pitch!==+s.pitch&&(R=!0,v.pitch=+s.pitch),null==s.padding||v.isPaddingEqual(s.padding)||(v.padding=s.padding),this.fire(new g.Event("movestart",h)).fire(new g.Event("move",h)),E&&this.fire(new g.Event("zoomstart",h)).fire(new g.Event("zoom",h)).fire(new g.Event("zoomend",h)),D&&this.fire(new g.Event("rotatestart",h)).fire(new g.Event("rotate",h)).fire(new g.Event("rotateend",h)),R&&this.fire(new g.Event("pitchstart",h)).fire(new g.Event("pitch",h)).fire(new g.Event("pitchend",h)),this.fire(new g.Event("moveend",h))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){this.stop();const v=this.transform,E=v.zoom,D=v.pitch,R=v.bearing;v.setFreeCameraOptions(s);const B=E!==v.zoom,z=D!==v.pitch,$=R!==v.bearing;return this.fire(new g.Event("movestart",h)).fire(new g.Event("move",h)),B&&this.fire(new g.Event("zoomstart",h)).fire(new g.Event("zoom",h)).fire(new g.Event("zoomend",h)),$&&this.fire(new g.Event("rotatestart",h)).fire(new g.Event("rotate",h)).fire(new g.Event("rotateend",h)),z&&this.fire(new g.Event("pitchstart",h)).fire(new g.Event("pitch",h)).fire(new g.Event("pitchend",h)),this.fire(new g.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),(!1===(s=g.extend({offset:[0,0],duration:500,easing:g.ease},s)).animate||!s.essential&&g.exported.prefersReducedMotion)&&(s.duration=0);const v=this.transform,E=this.getZoom(),D=this.getBearing(),R=this.getPitch(),B=this.getPadding(),z="zoom"in s?+s.zoom:E,$="bearing"in s?this._normalizeBearing(s.bearing,D):D,H="pitch"in s?+s.pitch:R,Q="padding"in s?s.padding:v.padding,J=g.pointGeometry.convert(s.offset);let te=v.centerPoint.add(J);const le=v.pointLocation(te),ce=g.LngLat.convert(s.center||le);this._normalizeCenter(ce);const _e=v.project(le),se=v.project(ce).sub(_e),ue=v.zoomScale(z-E);let ge,ve;s.around&&(ge=g.LngLat.convert(s.around),ve=v.locationPoint(ge));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||z!==E,this._rotating=this._rotating||D!==$,this._pitching=this._pitching||H!==R,this._padding=!v.isPaddingEqual(Q),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Se),this._ease(de=>{if(this._zooming&&(v.zoom=g.number(E,z,de)),this._rotating&&(v.bearing=g.number(D,$,de)),this._pitching&&(v.pitch=g.number(R,H,de)),this._padding&&(v.interpolatePadding(B,Q,de),te=v.centerPoint.add(J)),ge)v.setLocationAtPoint(ge,ve);else{const Fe=v.zoomScale(v.zoom-E),We=z>E?Math.min(2,ue):Math.max(.5,ue),nt=Math.pow(We,1-de),Pe=v.unproject(_e.add(se.mult(de*nt)).mult(Fe));v.setLocationAtPoint(v.renderWorldCopies?Pe.wrap():Pe,te)}this._fireMoveEvents(h)},de=>{v.recenterOnTerrain(),this._afterEase(h,de)},s),this}_prepareEase(s,h,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||v.moving||this.fire(new g.Event("movestart",s)),this._zooming&&!v.zooming&&this.fire(new g.Event("zoomstart",s)),this._rotating&&!v.rotating&&this.fire(new g.Event("rotatestart",s)),this._pitching&&!v.pitching&&this.fire(new g.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new g.Event("move",s)),this._zooming&&this.fire(new g.Event("zoom",s)),this._rotating&&this.fire(new g.Event("rotate",s)),this._pitching&&this.fire(new g.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.transform.cameraElevationReference="ground";const v=this._zooming,E=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new g.Event("zoomend",s)),E&&this.fire(new g.Event("rotateend",s)),D&&this.fire(new g.Event("pitchend",s)),this.fire(new g.Event("moveend",s))}flyTo(s,h){if(!s.essential&&g.exported.prefersReducedMotion){const dt=g.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(dt,h)}this.stop(),s=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},s);const v=this.transform,E=this.getZoom(),D=this.getBearing(),R=this.getPitch(),B=this.getPadding(),z="zoom"in s?g.clamp(+s.zoom,v.minZoom,v.maxZoom):E,$="bearing"in s?this._normalizeBearing(s.bearing,D):D,H="pitch"in s?+s.pitch:R,Q="padding"in s?s.padding:v.padding,J=v.zoomScale(z-E),te=g.pointGeometry.convert(s.offset);let le=v.centerPoint.add(te);const ce=v.pointLocation(le),_e=g.LngLat.convert(s.center||ce);this._normalizeCenter(_e);const se=v.project(ce),ue=v.project(_e).sub(se);let ge=s.curve;const ve=Math.max(v.width,v.height),Se=ve/J,de=ue.mag();if("minZoom"in s){const dt=g.clamp(Math.min(s.minZoom,E,z),v.minZoom,v.maxZoom),Mt=ve/v.zoomScale(dt-E);ge=Math.sqrt(Mt/de*2)}const Fe=ge*ge;function We(dt){const Mt=(Se*Se-ve*ve+(dt?-1:1)*Fe*Fe*de*de)/(2*(dt?Se:ve)*Fe*de);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function nt(dt){return(Math.exp(dt)-Math.exp(-dt))/2}function Pe(dt){return(Math.exp(dt)+Math.exp(-dt))/2}const Ge=We(0);let xt=function(dt){return Pe(Ge)/Pe(Ge+ge*dt)},Dt=function(dt){return ve*((Pe(Ge)*(nt(Mt=Ge+ge*dt)/Pe(Mt))-nt(Ge))/Fe)/de;var Mt},Et=(We(1)-Ge)/ge;if(Math.abs(de)<1e-6||!isFinite(Et)){if(Math.abs(ve-Se)<1e-6)return this.easeTo(s,h);const dt=Se<ve?-1:1;Et=Math.abs(Math.log(Se/ve))/ge,Dt=function(){return 0},xt=function(Mt){return Math.exp(dt*ge*Mt)}}return s.duration="duration"in s?+s.duration:1e3*Et/("screenSpeed"in s?+s.screenSpeed/ge:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=D!==$,this._pitching=H!==R,this._padding=!v.isPaddingEqual(Q),this._prepareEase(h,!1),this._ease(dt=>{const Mt=dt*Et,wn=1/xt(Mt);v.zoom=1===dt?z:E+v.scaleZoom(wn),this._rotating&&(v.bearing=g.number(D,$,dt)),this._pitching&&(v.pitch=g.number(R,H,dt)),this._padding&&(v.interpolatePadding(B,Q,dt),le=v.centerPoint.add(te));const Jt=1===dt?_e:v.unproject(se.add(ue.mult(Dt(Mt))).mult(wn));v.setLocationAtPoint(v.renderWorldCopies?Jt.wrap():Jt,le),v._updateCenterElevation(),this._fireMoveEvents(h)},()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,h)}if(!s){const v=this.handlers;v&&v.stop(!1)}return this}_ease(s,h,v){!1===v.animate||0===v.duration?(s(1),h()):(this._easeStart=g.exported.now(),this._easeOptions=v,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((g.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=g.wrap(s,-180,180);const v=Math.abs(s-h);return Math.abs(s-360-h)<v&&(s-=360),Math.abs(s+360-h)<v&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const v=s.lng-h.center.lng;s.lng+=v>180?-360:v<-180?360:0}}class Lh{constructor(s={}){this.options=s,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact;return this._map=s,this._container=st.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=st.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=st.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){st.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const v=this._map._getUIString(`AttributionControl.${h}`);s.title=v,s.setAttribute("aria-label",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(s){const v=h.reduce((E,D,R)=>(D.value&&(E+=`${D.key}=${D.value}${R<h.length-1?"&":""}`),E),"?");s.href=`${g.config.FEEDBACK_URL}/${v}${this._map._hash?this._map._hash.getHashString(!0):""}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(E=>"string"!=typeof E?"":E)):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const h=this._map.style._sourceCaches;for(const E in h){const D=h[E];if(D.used){const R=D.getSource();R.attribution&&s.indexOf(R.attribution)<0&&s.push(R.attribution)}}s.sort((E,D)=>E.length-D.length),s=s.filter((E,D)=>{for(let R=D+1;R<s.length;R++)if(s[R].indexOf(E)>=0)return!1;return!0});const v=s.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,s.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bu{constructor(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)}onAdd(s){this._map=s,this._container=st.create("div","mapboxgl-ctrl");const h=st.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){st.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const h in s){const v=s[h].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Hd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,v=h?this._queue.concat(h):this._queue;for(const E of v)if(E.id===s)return void(E.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const v of h)if(!v.cancelled&&(v.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Bh(_,s,h){if(_=new g.LngLat(_.lng,_.lat),s){const v=new g.LngLat(_.lng-360,_.lat),E=new g.LngLat(_.lng+360,_.lat),D=360*Math.ceil(Math.abs(_.lng-h.center.lng)/360),R=h.locationPoint(_).distSqr(s),B=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(v).distSqr(s)<R&&(B||Math.abs(v.lng-h.center.lng)<D)?_=v:h.locationPoint(E).distSqr(s)<R&&(B||Math.abs(E.lng-h.center.lng)<D)&&(_=E)}for(;Math.abs(_.lng-h.center.lng)>180;){const v=h.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;_.lng>h.center.lng?_.lng-=360:_.lng+=360}return _}const Ll={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Nu extends g.Evented{constructor(s,h){if(super(),(s instanceof g.window.HTMLElement||h)&&(s=g.extend({element:s},h)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&"auto"!==s.pitchAlignment?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=g.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=st.create("div"),this._element.setAttribute("aria-label","Map marker");const E=st.createNS("http://www.w3.org/2000/svg","svg"),D=41,R=27;E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height",`${D}px`),E.setAttributeNS(null,"width",`${R}px`),E.setAttributeNS(null,"viewBox",`0 0 ${R} ${D}`);const B=st.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"stroke","none"),B.setAttributeNS(null,"stroke-width","1"),B.setAttributeNS(null,"fill","none"),B.setAttributeNS(null,"fill-rule","evenodd");const z=st.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill-rule","nonzero");const $=st.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(3.0, 29.0)"),$.setAttributeNS(null,"fill","#000000");const H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of H){const ve=st.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",ge.rx),ve.setAttributeNS(null,"ry",ge.ry),$.appendChild(ve)}const Q=st.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const J=st.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(J);const te=st.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const le=st.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(le);const ce=st.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ce.setAttributeNS(null,"fill","#FFFFFF");const _e=st.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=st.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const ue=st.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#FFFFFF"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962"),_e.appendChild(se),_e.appendChild(ue),z.appendChild($),z.appendChild(Q),z.appendChild(te),z.appendChild(ce),z.appendChild(_e),E.appendChild(z),E.setAttributeNS(null,"height",D*this._scale+"px"),E.setAttributeNS(null,"width",R*this._scale+"px"),this._element.appendChild(E),this._offset=g.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const v=this._element.classList;for(const E in Ll)v.remove(`mapboxgl-marker-anchor-${E}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),st.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=g.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const h=38.1,v=13.5,E=Math.sqrt(Math.pow(v,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-h],"bottom-left":[E,-1*(h-v+E)],"bottom-right":[-E,-1*(h-v+E)],left:[v,-1*(h-v)],right:[-v,-1*(h-v)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,v=s.charCode||s.keyCode;"Space"!==h&&"Enter"!==h&&32!==v&&13!==v||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,v=this._element;this._popup&&(h===v||v.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_evaluateOpacity(){const s=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(s))return void this._clearFadeTimer();const h=this._map.unproject(s);let v=!1;if(this._map.getTerrain()){const D=this._map.getFreeCameraOptions();if(D.position){const R=D.position.toLngLat();v=R.distanceTo(h)<.9*R.distanceTo(this._lngLat)}}const E=(1-this._map._queryFogOpacity(h))*(v?.2:1);this._element.style.opacity=`${E}`,this._popup&&this._popup._setOpacity(`${E}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(s){const h=this._map.transform;return!!s&&s.x>=0&&s.x<h.width&&s.y>=0&&s.y<h.height}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Bh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let h="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?h=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?v="rotateX(0deg)":"map"===this._pitchAlignment&&(v=`rotateX(${this._map.getPitch()}deg)`),s&&"moveend"!==s.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&st.setTransform(this._element,`${Ll[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${h}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const s=this._map.transform,h=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&h._rotate(s.angle),"map"===this._pitchAlignment&&(h.y*=Math.cos(s._pitch)),h}getOffset(){return this._offset}setOffset(s){return this._offset=g.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new g.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&"auto"!==s?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class qd{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=g.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,v){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+v}}const Nh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Mc,HTMLElement:zu,ImageBitmap:Bl}=g.window,ff={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function wi(_){_.parentNode&&_.parentNode.removeChild(_)}const Ma={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vr{constructor(s,h,v=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Vd({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,v&&(this.mousePitch=new Ys({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),st.addEventListener(h,"mousedown",this.mousedown),st.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),st.addEventListener(h,"touchmove",this.touchmove),st.addEventListener(h,"touchend",this.touchend),st.addEventListener(h,"touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),st.disableDrag()}move(s,h){const v=this.map,E=this.mouseRotate.mousemoveWindow(s,h);if(E&&E.bearingDelta&&v.setBearing(v.getBearing()+E.bearingDelta),this.mousePitch){const D=this.mousePitch.mousemoveWindow(s,h);D&&D.pitchDelta&&v.setPitch(v.getPitch()+D.pitchDelta)}}off(){const s=this.element;st.removeEventListener(s,"mousedown",this.mousedown),st.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),st.removeEventListener(s,"touchmove",this.touchmove),st.removeEventListener(s,"touchend",this.touchend),st.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){st.enableDrag(),st.removeEventListener(g.window,"mousemove",this.mousemove),st.removeEventListener(g.window,"mouseup",this.mouseup)}mousedown(s){this.down(g.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),st.mousePos(this.element,s)),st.addEventListener(g.window,"mousemove",this.mousemove),st.addEventListener(g.window,"mouseup",this.mouseup)}mousemove(s){this.move(s,st.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=st.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=st.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const pf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let nl,Tc=0,Nl=!1;const Am={maxWidth:100,unit:"metric"};function mf(_,s,h){const v=h&&h.maxWidth||100,E=_._container.getBoundingClientRect().height/2,D=_.unproject([0,E]),R=_.unproject([v,E]),B=D.distanceTo(R);if(h&&"imperial"===h.unit){const z=3.2808*B;z>5280?Js(s,v,z/5280,_._getUIString("ScaleControl.Miles"),_):Js(s,v,z,_._getUIString("ScaleControl.Feet"),_)}else h&&"nautical"===h.unit?Js(s,v,B/1852,_._getUIString("ScaleControl.NauticalMiles"),_):B>=1e3?Js(s,v,B/1e3,_._getUIString("ScaleControl.Kilometers"),_):Js(s,v,B,_._getUIString("ScaleControl.Meters"),_)}function Js(_,s,h,v,E){const D=function(B){const z=Math.pow(10,`${Math.floor(B)}`.length-1);let $=B/z;return $=$>=10?10:$>=5?5:$>=3?3:$>=2?2:$>=1?1:function(H){const Q=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*Q)/Q}($),z*$}(h),R=D/h;E._requestDomTask(()=>{_.style.width=s*R+"px",_.innerHTML=`${D}&nbsp;${v}`})}const Vu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Uu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ic={version:g.version,supported:Co,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:class extends Sc{constructor(_){if(null!=(_=g.extend({},ff,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Pu(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._renderTaskQueue=new Hd,this._domRenderTaskQueue=new Hd,this._controls=[],this._markers=[],this._mapId=g.uniqueId(),this._locale=g.extend({},Nh,_.locale),this._clickTolerance=_.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new qd(0),this._requestManager=new g.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=g.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof zu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==g.window&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1),g.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Lu(this,_),this._hash=_.hash&&new dm("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,g.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.attributionControl&&this.addControl(new Lh({customAttribution:_.customAttribution})),this._logoControl=new Bu,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update("style"===s.dataType),this.fire(new g.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new g.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(_,s){if(void 0===s&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[s];return-1!==s.indexOf("bottom")?v.insertBefore(h,v.firstChild):v.appendChild(h),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){const[s,h]=this._containerDimensions();if(s===this.transform.width&&h===this.transform.height)return this;this._resizeCanvas(s,h),this.transform.resize(s,h),this.painter.resize(Math.ceil(s),Math.ceil(h));const v=!this._moving;return v&&this.fire(new g.Event("movestart",_)).fire(new g.Event("move",_)),this.fire(new g.Event("resize",_)),v&&this.fire(new g.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(g.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=null==_?-2:_)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=null==_?22:_)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=null==_?0:_)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=null==_?85:_)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint3D(g.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(g.pointGeometry.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(_,s,h){if("mouseenter"===_||"mouseover"===_){let v=!1;return{layer:s,listener:h,delegates:{mousemove:D=>{const R=this.getLayer(s)?this.queryRenderedFeatures(D.point,{layers:[s]}):[];R.length?v||(v=!0,h.call(this,new to(_,this,D.originalEvent,{features:R}))):v=!1},mouseout:()=>{v=!1}}}}if("mouseleave"===_||"mouseout"===_){let v=!1;return{layer:s,listener:h,delegates:{mousemove:R=>{(this.getLayer(s)?this.queryRenderedFeatures(R.point,{layers:[s]}):[]).length?v=!0:v&&(v=!1,h.call(this,new to(_,this,R.originalEvent)))},mouseout:R=>{v&&(v=!1,h.call(this,new to(_,this,R.originalEvent)))}}}}{const v=E=>{const D=this.getLayer(s)?this.queryRenderedFeatures(E.point,{layers:[s]}):[];D.length&&(E.features=D,h.call(this,E),delete E.features)};return{layer:s,listener:h,delegates:{[_]:v}}}}on(_,s,h){if(void 0===h)return super.on(_,s);const v=this._createDelegatedListener(_,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const E in v.delegates)this.on(E,v.delegates[E]);return this}once(_,s,h){if(void 0===h)return super.once(_,s);const v=this._createDelegatedListener(_,s,h);for(const E in v.delegates)this.once(E,v.delegates[E]);return this}off(_,s,h){return void 0===h?super.off(_,s):(this._delegatedListeners&&this._delegatedListeners[_]&&(v=>{const E=this._delegatedListeners[_];for(let D=0;D<E.length;D++){const R=E[D];if(R.layer===s&&R.listener===h){for(const B in R.delegates)this.off(B,R.delegates[B]);return E.splice(D,1),this}}})(),this)}queryRenderedFeatures(_,s){return this.style?(void 0!==s||void 0===_||_ instanceof g.pointGeometry||Array.isArray(_)||(s=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(_,s){return this.style.querySourceFeatures(_,s)}queryTerrainElevation(_,s){const h=this.transform.elevation;return h?(s=g.extend({},{exaggerated:!0},s),h.getAtPoint(g.MercatorCoordinate.fromLngLat(_),null,s.exaggerated)):null}setStyle(_,s){return!1!==(s=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(_,s))}_getUIString(_){const s=this._locale[_];if(null==s)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),_&&(this.style=new Ko(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ko(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,s){if("string"==typeof _){const h=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(h,g.ResourceType.Style);g.getJSON(v,(E,D)=>{E?this.fire(new g.ErrorEvent(E)):D&&this._updateDiff(D,s)})}else"object"==typeof _&&this._updateDiff(_,s)}_updateDiff(_,s){try{this.style.setState(_)&&this._update(!0)}catch(h){g.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(_,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")}addSource(_,s){return this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)}isSourceLoaded(_){const s=this.style&&this.style._getSourceCaches(_);if(0!==s.length)return s.every(h=>h.loaded());this.fire(new g.ErrorEvent(new Error(`There is no source with ID '${_}'`)))}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const s in _){const h=_[s]._tiles;for(const v in h){const E=h[v];if("loaded"!==E.state&&"errored"!==E.state)return!1}}return!0}addSourceType(_,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,s,h)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,s,{pixelRatio:h=1,sdf:v=!1,stretchX:E,stretchY:D,content:R}={}){if(this._lazyInitEmptyStyle(),s instanceof Mc||Bl&&s instanceof Bl){const{width:B,height:z,data:$}=g.exported.getImageData(s);this.style.addImage(_,{data:new g.RGBAImage({width:B,height:z},$),pixelRatio:h,stretchX:E,stretchY:D,content:R,sdf:v,version:0})}else{if(void 0===s.width||void 0===s.height)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:z,data:$}=s,H=s;this.style.addImage(_,{data:new g.RGBAImage({width:B,height:z},new Uint8Array($)),pixelRatio:h,stretchX:E,stretchY:D,content:R,sdf:v,version:0,userImage:H}),H.onAdd&&H.onAdd(this,_)}}}updateImage(_,s){const h=this.style.getImage(_);if(!h)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=s instanceof Mc||Bl&&s instanceof Bl?g.exported.getImageData(s):s,{width:E,height:D,data:R}=v;return void 0===E||void 0===D?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):E!==h.data.width||D!==h.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(h.data.replace(R,!(s instanceof Mc||Bl&&s instanceof Bl)),void this.style.updateImage(_,h))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,s){g.getImage(this._requestManager.transformRequest(_,g.ResourceType.Image),(h,v)=>{s(h,v instanceof Mc?g.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(_,s){return this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)}moveLayer(_,s){return this.style.moveLayer(_,s),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,s,h){return this.style.setLayerZoomRange(_,s,h),this._update(!0)}setFilter(_,s,h={}){return this.style.setFilter(_,s,h),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,s,h,v={}){return this.style.setPaintProperty(_,s,h,v),this._update(!0)}getPaintProperty(_,s){return this.style.getPaintProperty(_,s)}setLayoutProperty(_,s,h,v={}){return this.style.setLayoutProperty(_,s,h,v),this._update(!0)}getLayoutProperty(_,s){return this.style.getLayoutProperty(_,s)}setLight(_,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(g.LngLat.convert(_),this.transform):0}setFeatureState(_,s){return this.style.setFeatureState(_,s),this._update()}removeFeatureState(_,s){return this.style.removeFeatureState(_,s),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_containerDimensions(){let _=0,s=0;return this._container&&(_=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300),[_,s]}_detectMissingCSS(){"rgb(250, 128, 114)"!==g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=st.create("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=st.create("div","mapboxgl-canvas-container",_);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=st.create("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1]);const v=this._controlContainer=st.create("div","mapboxgl-control-container",_),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(D=>{E[D]=st.create("div",`mapboxgl-ctrl-${D}`,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,s){const h=g.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(_),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const s=this._markers.indexOf(_);-1!==s&&this._markers.splice(s,1)}_setupPainter(){const _=g.extend({},Co.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);s?(g.storeAuthState(s,!0),this.painter=new Iu(s,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),g.exported$1.testSupport(s)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.isMoving()&&this.loaded()?_():this._domRenderTaskQueue.add(_)}_render(_){let s;const h=this.painter.context.extTimerQuery,v=g.exported.now();this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s));let E=this._updateAverageElevation(v);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;let D=!1;const R=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,$=g.exported.now();this.style.zoomHistory.update(z,$);const H=new g.EvaluationParameters(z,{now:$,fadeDuration:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=H.crossFadingFactor();1===Q&&Q===this._crossFadingFactor||(D=!0,this._crossFadingFactor=Q),this.style.update(H)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,R,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:R,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const z=g.exported.now()-v;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{const $=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new g.Event("gpu-timing-frame",{cpuTime:z,gpuTime:$}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const $=this.painter.queryGpuTimers(z);this.fire(new g.Event("gpu-timing-layer",{layerTimes:$}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(B||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(E=this._updateAverageElevation(v,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new g.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const $=this._calculateSpeedIndex();this.fire(new g.Event("speedindexcompleted",{speedIndex:$})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const _ of this._markers)_._update()}_updateAverageElevation(_,s=!1){const h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((s||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const v=this.transform.averageElevation;let E=this.transform.sampleAverageElevation();isNaN(E)?E=0:this._averageElevationLastSampledAt=_;const D=Math.abs(v-E);if(D>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(E),h(E);this._averageElevation.easeTo(E,_,300)}else if(D>1e-4)return this._averageElevation.jumpTo(E),h(E)}return!!this._averageElevation.isEasing(_)&&h(this._averageElevation.getValue(_))}_authenticate(){g.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===g.AUTH_ERR_MSG||401===_.status)){const s=this.painter.context.gl;g.storeAuthState(s,!1),this._logoControl instanceof Bu&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new g.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),g.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,v=h.createFramebuffer();function E(D){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,D,0);const R=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,R),R}return h.bindFramebuffer(h.FRAMEBUFFER,v),this._canvasPixelComparison(E(_),s.canvasCopies.map(E),s.timeStamps)}_canvasPixelComparison(_,s,h){let v=h[1]-h[0];const E=_.length/4;for(let D=0;D<s.length;D++){const R=s[D];let B=0;for(let z=0;z<R.length;z+=4)R[z]===_[z]&&R[z+1]===_[z+1]&&R[z+2]===_[z+2]&&R[z+3]===_[z+3]&&(B+=1);v+=(h[D+2]-h[D+1])*(1-B/E)}return v}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==g.window&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),wi(this._canvasContainer),wi(this._controlContainer),wi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),g.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new g.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=g.exported.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}_setCacheLimits(_,s){g.setCacheLimits(_,s)}get version(){return g.version}},NavigationControl:class{constructor(_){this.options=g.extend({},Ma,_),this._container=st.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),st.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),st.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=st.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const _=this._map.getZoom(),s=_===this._map.getMaxZoom(),h=_===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const _=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=_)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){st.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,s){const h=st.create("button",_,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(_,s){const h=this._map._getUIString(`NavigationControl.${s}`);_.title=h,_.setAttribute("aria-label",h)}},GeolocateControl:class extends g.Evented{constructor(_){super(),this.options=g.extend({},pf,_),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=qr(this._updateMarkerRotation,20)}onAdd(_){var s;return this._map=_,this._container=st.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,void 0!==nl?s(nl):void 0!==g.window.navigator.permissions?g.window.navigator.permissions.query({name:"geolocation"}).then(h=>{nl="denied"!==h.state,s(nl)}):(nl=!!g.window.navigator.geolocation,s(nl)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),st.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Tc=0,Nl=!1}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),h=_.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",_)),this._finish()}}_updateCamera(_){const s=new g.LngLat(_.coords.longitude,_.coords.latitude),h=_.coords.accuracy,v=this._map.getBearing(),E=g.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),E,{geolocateSource:!0})}_updateMarker(_){if(_){const s=new g.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map._container.getBoundingClientRect().height/2,s=this._map.unproject([0,_]),h=this._map.unproject([100,_]),v=s.distanceTo(h)/100,E=Math.ceil(2*this._accuracy/v);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&Nl)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=st.create("button","mapboxgl-ctrl-geolocate",this._container),st.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===_){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=st.create("div","mapboxgl-user-location"),this._dotElement.appendChild(st.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(st.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Nu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=st.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new g.Event("trackuserlocationend")))})}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Tc--,Nl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Tc++,Tc>1?(_={maximumAge:6e5,timeout:0},Nl=!0):(_=this.options.positionOptions,Nl=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{g.window.addEventListener("ondeviceorientationabsolute"in g.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==g.window.DeviceMotionEvent&&"function"==typeof g.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&_()}).catch(console.error):_()}_clearWatch(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),g.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),g.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lh,ScaleControl:class{constructor(_){this.options=g.extend({},Am,_),g.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){mf(this._map,this._container,this.options)}onAdd(_){return this._map=_,this._container=st.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){st.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(_){this.options.unit=_,mf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof g.window.HTMLElement?this._container=_.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in g.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=st.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){st.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!g.window.document.fullscreenEnabled&&!g.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=st.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);st.create("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden",!0),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(g.window.document.fullscreenElement||g.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends g.Evented{constructor(_){super(),this.options=g.extend(Object.create(Vu),_),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&st.remove(this._content),this._container&&(st.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=g.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(g.window.document.createTextNode(_))}setHTML(_){const s=g.window.document.createDocumentFragment(),h=g.window.document.createElement("body");let v;for(h.innerHTML=_;v=h.firstChild,v;)s.appendChild(v);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=st.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._container&&this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._container&&this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let s;return this._classList.delete(_)?s=!1:(this._classList.add(_),s=!0),this._container&&this._updateClassList(),s}_createCloseButton(){this.options.closeButton&&(this._closeButton=st.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(_){this._update(_.point)}_onMouseMove(_){this._update(_.point)}_onDrag(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const s=this._pos,h=this._container.offsetWidth,v=this._container.offsetHeight;let E;return E=s.y+_.bottom.y<v?["top"]:s.y>this._map.transform.height-v?["bottom"]:[],s.x<h/2?E.push("left"):s.x>this._map.transform.width-h/2&&E.push("right"),0===E.length?"bottom":E.join("-")}_updateClassList(){const _=[...this._classList];_.push("mapboxgl-popup"),this._anchor&&_.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&_.push("mapboxgl-popup-track-pointer"),this._container.className=_.join(" ")}_update(_){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=st.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=st.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bh(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||_){const s=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat),h=function(D){if(D||(D=new g.pointGeometry(0,0)),"number"==typeof D){const R=Math.round(Math.sqrt(.5*Math.pow(D,2)));return{center:new g.pointGeometry(0,0),top:new g.pointGeometry(0,D),"top-left":new g.pointGeometry(R,R),"top-right":new g.pointGeometry(-R,R),bottom:new g.pointGeometry(0,-D),"bottom-left":new g.pointGeometry(R,-R),"bottom-right":new g.pointGeometry(-R,-R),left:new g.pointGeometry(D,0),right:new g.pointGeometry(-D,0)}}if(D instanceof g.pointGeometry||Array.isArray(D)){const R=g.pointGeometry.convert(D);return{center:R,top:R,"top-left":R,"top-right":R,bottom:R,"bottom-left":R,"bottom-right":R,left:R,right:R}}return{center:g.pointGeometry.convert(D.center||[0,0]),top:g.pointGeometry.convert(D.top||[0,0]),"top-left":g.pointGeometry.convert(D["top-left"]||[0,0]),"top-right":g.pointGeometry.convert(D["top-right"]||[0,0]),bottom:g.pointGeometry.convert(D.bottom||[0,0]),"bottom-left":g.pointGeometry.convert(D["bottom-left"]||[0,0]),"bottom-right":g.pointGeometry.convert(D["bottom-right"]||[0,0]),left:g.pointGeometry.convert(D.left||[0,0]),right:g.pointGeometry.convert(D.right||[0,0])}}(this.options.offset),v=this._anchor=this._getAnchor(h),E=s.add(h[v]).round();this._map._requestDomTask(()=>{this._container&&v&&st.setTransform(this._container,`${Ll[v]} translate(${E.x}px,${E.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Uu);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._content&&(this._content.style.opacity=_),this._tip&&(this._tip.style.opacity=_)}},Marker:Nu,Style:Ko,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.pointGeometry,MercatorCoordinate:g.MercatorCoordinate,FreeCameraOptions:Rh,Evented:g.Evented,config:g.config,prewarm:function(){ft().acquire(Ee)},clearPrewarmedResources:function(){const _=Ye;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(Ee),Ye=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(_){g.config.ACCESS_TOKEN=_},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(_){g.config.API_URL=_},get workerCount(){return Oe.workerCount},set workerCount(_){Oe.workerCount=_},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){g.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){g.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:g.exported.setNow,restoreNow:g.exported.restoreNow};return Ic}),Gs}()},177:(xd,js,Ba)=>{"use strict";function Gs(n){return"function"==typeof n}let bd=!1;const fa={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else bd&&console.log("RxJS: Back to a better error behavior. Thank you. <3");bd=n},get useDeprecatedSynchronousErrorHandling(){return bd}};function g(n){setTimeout(()=>{throw n},0)}const Co={closed:!0,next(n){},error(n){if(fa.useDeprecatedSynchronousErrorHandling)throw n;g(n)},complete(){}},Ho=Array.isArray||(n=>n&&"number"==typeof n.length);function fo(n){return null!==n&&"object"==typeof n}const st=(()=>{function n(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,r)=>`${r+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return n.prototype=Object.create(Error.prototype),n})();class wt{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:r,_unsubscribe:o,_subscriptions:c}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof wt)t.remove(this);else if(null!==t)for(let p=0;p<t.length;++p)t[p].remove(this);if(Gs(o)){r&&(this._unsubscribe=void 0);try{o.call(this)}catch(p){e=p instanceof st?ps(p.errors):[p]}}if(Ho(c)){let p=-1,w=c.length;for(;++p<w;){const T=c[p];if(fo(T))try{T.unsubscribe()}catch(L){e=e||[],L instanceof st?e=e.concat(ps(L.errors)):e.push(L)}}}if(e)throw new st(e)}add(e){let t=e;if(!e)return wt.EMPTY;switch(typeof e){case"function":t=new wt(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof wt)){const c=t;t=new wt,t._subscriptions=[c]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=t;if(null===r)t._parentOrParents=this;else if(r instanceof wt){if(r===this)return t;t._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return t;r.push(this)}const o=this._subscriptions;return null===o?this._subscriptions=[t]:o.push(t),t}remove(e){const t=this._subscriptions;if(t){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}var n;function ps(n){return n.reduce((e,t)=>e.concat(t instanceof st?t.errors:t),[])}wt.EMPTY=((n=new wt).closed=!0,n);const Na="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class $n extends wt{constructor(e,t,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Co;break;case 1:if(!e){this.destination=Co;break}if("object"==typeof e){e instanceof $n?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new uu(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new uu(this,e,t,r)}}[Na](){return this}static create(e,t,r){const o=new $n(e,t,r);return o.syncErrorThrowable=!1,o}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class uu extends $n{constructor(e,t,r,o){super(),this._parentSubscriber=e;let c,p=this;Gs(t)?c=t:t&&(c=t.next,r=t.error,o=t.complete,t!==Co&&(p=Object.create(t),Gs(p.unsubscribe)&&this.add(p.unsubscribe.bind(p)),p.unsubscribe=this.unsubscribe.bind(this))),this._context=p,this._next=c,this._error=r,this._complete=o}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;fa.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:r}=fa;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):g(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;g(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);fa.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),fa.useDeprecatedSynchronousErrorHandling)throw r;g(r)}}__tryOrSetError(e,t,r){if(!fa.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(o){return fa.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=o,e.syncErrorThrown=!0,!0):(g(o),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const ms="function"==typeof Symbol&&Symbol.observable||"@@observable";function ui(n){return n}let Gn=(()=>{class n{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,o){const{operator:c}=this,p=function(n,e,t){if(n){if(n instanceof $n)return n;if(n[Na])return n[Na]()}return n||e||t?new $n(n,e,t):new $n(Co)}(t,r,o);if(p.add(c?c.call(p,this.source):this.source||fa.useDeprecatedSynchronousErrorHandling&&!p.syncErrorThrowable?this._subscribe(p):this._trySubscribe(p)),fa.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable&&(p.syncErrorThrowable=!1,p.syncErrorThrown))throw p.syncErrorValue;return p}_trySubscribe(t){try{return this._subscribe(t)}catch(r){fa.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),function(n){for(;n;){const{closed:e,destination:t,isStopped:r}=n;if(e||r)return!1;n=t&&t instanceof $n?t:null}return!0}(t)?t.error(r):console.warn(r)}}forEach(t,r){return new(r=hi(r))((o,c)=>{let p;p=this.subscribe(w=>{try{t(w)}catch(T){c(T),p&&p.unsubscribe()}},c,o)})}_subscribe(t){const{source:r}=this;return r&&r.subscribe(t)}[ms](){return this}pipe(...t){return 0===t.length?this:function(n){return 0===n.length?ui:1===n.length?n[0]:function(t){return n.reduce((r,o)=>o(r),t)}}(t)(this)}toPromise(t){return new(t=hi(t))((r,o)=>{let c;this.subscribe(p=>c=p,p=>o(p),()=>r(c))})}}return n.create=e=>new n(e),n})();function hi(n){if(n||(n=fa.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const gs=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class yl extends wt{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}class vl extends $n{constructor(e){super(e),this.destination=e}}let _i=(()=>{class n extends Gn{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Na](){return new vl(this)}lift(t){const r=new sc(this,this);return r.operator=t,r}next(t){if(this.closed)throw new gs;if(!this.isStopped){const{observers:r}=this,o=r.length,c=r.slice();for(let p=0;p<o;p++)c[p].next(t)}}error(t){if(this.closed)throw new gs;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:r}=this,o=r.length,c=r.slice();for(let p=0;p<o;p++)c[p].error(t);this.observers.length=0}complete(){if(this.closed)throw new gs;this.isStopped=!0;const{observers:t}=this,r=t.length,o=t.slice();for(let c=0;c<r;c++)o[c].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new gs;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new gs;return this.hasError?(t.error(this.thrownError),wt.EMPTY):this.isStopped?(t.complete(),wt.EMPTY):(this.observers.push(t),new yl(this,t))}asObservable(){const t=new Gn;return t.source=this,t}}return n.create=(e,t)=>new sc(e,t),n})();class sc extends _i{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):wt.EMPTY}}function _s(n){return n&&"function"==typeof n.schedule}function An(n,e){return function(r){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new qo(n,e))}}class qo{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new Or(e,this.project,this.thisArg))}}class Or extends $n{constructor(e,t,r){super(e),this.project=t,this.count=0,this.thisArg=r||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const Ua=n=>e=>{for(let t=0,r=n.length;t<r&&!e.closed;t++)e.next(n[t]);e.complete()},ja="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Bn=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function bl(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const wl=n=>{if(n&&"function"==typeof n[ms])return(n=>e=>{const t=n[ms]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(n);if(Bn(n))return Ua(n);if(bl(n))return(n=>e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,g),e))(n);if(n&&"function"==typeof n[ja])return(n=>e=>{const t=n[ja]();for(;;){let r;try{r=t.next()}catch(o){return e.error(o),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(n);{const t=`You provided ${fo(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function po(n,e){return new Gn(t=>{const r=new wt;let o=0;return r.add(e.schedule(function(){o!==n.length?(t.next(n[o++]),t.closed||r.add(this.schedule())):t.complete()})),r})}function Lr(n,e){return e?function(n,e){if(null!=n){if(function(n){return n&&"function"==typeof n[ms]}(n))return function(n,e){return new Gn(t=>{const r=new wt;return r.add(e.schedule(()=>{const o=n[ms]();r.add(o.subscribe({next(c){r.add(e.schedule(()=>t.next(c)))},error(c){r.add(e.schedule(()=>t.error(c)))},complete(){r.add(e.schedule(()=>t.complete()))}}))})),r})}(n,e);if(bl(n))return function(n,e){return new Gn(t=>{const r=new wt;return r.add(e.schedule(()=>n.then(o=>{r.add(e.schedule(()=>{t.next(o),r.add(e.schedule(()=>t.complete()))}))},o=>{r.add(e.schedule(()=>t.error(o)))}))),r})}(n,e);if(Bn(n))return po(n,e);if(function(n){return n&&"function"==typeof n[ja]}(n)||"string"==typeof n)return function(n,e){if(!n)throw new Error("Iterable cannot be null");return new Gn(t=>{const r=new wt;let o;return r.add(()=>{o&&"function"==typeof o.return&&o.return()}),r.add(e.schedule(()=>{o=n[ja](),r.add(e.schedule(function(){if(t.closed)return;let c,p;try{const w=o.next();c=w.value,p=w.done}catch(w){return void t.error(w)}p?t.complete():(t.next(c),this.schedule())}))})),r})}(n,e)}throw new TypeError((null!==n&&typeof n||n)+" is not observable")}(n,e):n instanceof Gn?n:new Gn(wl(n))}class ma extends $n{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Hs extends $n{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function ga(n,e){if(e.closed)return;if(n instanceof Gn)return n.subscribe(e);let t;try{t=wl(n)(e)}catch(r){e.error(r)}return t}function pr(n,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(pr((o,c)=>Lr(n(o,c)).pipe(An((p,w)=>e(o,p,c,w))),t)):("number"==typeof e&&(t=e),r=>r.lift(new qa(n,t)))}class qa{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new mu(e,this.project,this.concurrent))}}class mu extends Hs{constructor(e,t,r=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(o){return void this.destination.error(o)}this.active++,this._innerSub(t)}_innerSub(e){const t=new ma(this),r=this.destination;r.add(t);const o=ga(e,t);o!==t&&r.add(o)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Zo(n=Number.POSITIVE_INFINITY){return pr(ui,n)}function Eo(n,e){return e?po(n,e):new Gn(Ua(n))}function Cl(){return function(e){return e.lift(new yh(e))}}class yh{constructor(e){this.connectable=e}call(e,t){const{connectable:r}=this;r._refCount++;const o=new ac(e,r),c=t.subscribe(o);return o.closed||(o.connection=r.connect()),c}}class ac extends $n{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:r}=this,o=e._connection;this.connection=null,o&&(!r||o===r)&&o.unsubscribe()}}class lc extends Gn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new wt,e.add(this.source.subscribe(new Cd(this.getSubject(),this))),e.closed&&(this._connection=null,e=wt.EMPTY)),e}refCount(){return Cl()(this)}}const vh=(()=>{const n=lc.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class Cd extends vl{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}function xh(){return new _i}function Pn(n){for(let e in n)if(n[e]===Pn)return e;throw Error("Could not find renamed property on target object.")}function _a(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function ln(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(ln).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function ya(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const hc=Pn({__forward_ref__:Pn});function Hn(n){return n.__forward_ref__=Hn,n.toString=function(){return ln(this())},n}function ne(n){return Z(n)?n():n}function Z(n){return"function"==typeof n&&n.hasOwnProperty(hc)&&n.__forward_ref__===Hn}class ae extends Error{constructor(e,t){super(function(n,e){return`${n?`NG0${n}: `:""}${e}`}(e,t)),this.code=e}}function we(n){return"string"==typeof n?n:null==n?"":String(n)}function ke(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():we(n)}function ft(n,e){const t=e?` in ${e}`:"";throw new ae("201",`No provider for ${ke(n)} found${t}`)}function Wt(n,e){null==n&&function(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function $t(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function mr(n){return{providers:n.providers||[],imports:n.imports||[]}}function Jn(n){return Dd(n,Qo)||Dd(n,un)}function Dd(n,e){return n.hasOwnProperty(e)?n[e]:null}function fc(n){return n&&(n.hasOwnProperty(vu)||n.hasOwnProperty(Sd))?n[vu]:null}const Qo=Pn({\u0275prov:Pn}),vu=Pn({\u0275inj:Pn}),un=Pn({ngInjectableDef:Pn}),Sd=Pn({ngInjectorDef:Pn});var Qt=(()=>((Qt=Qt||{})[Qt.Default=0]="Default",Qt[Qt.Host=1]="Host",Qt[Qt.Self=2]="Self",Qt[Qt.SkipSelf=4]="SkipSelf",Qt[Qt.Optional=8]="Optional",Qt))();let di;function va(n){const e=di;return di=n,e}function xu(n,e,t){const r=Jn(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Qt.Optional?null:void 0!==e?e:void ft(ln(n),"Injector")}function Lo(n){return{toString:n}.toString()}var Ai=(()=>((Ai=Ai||{})[Ai.OnPush=0]="OnPush",Ai[Ai.Default=1]="Default",Ai))(),gr=(()=>((gr=gr||{})[gr.Emulated=0]="Emulated",gr[gr.None=2]="None",gr[gr.ShadowDom=3]="ShadowDom",gr))();const wu="undefined"!=typeof globalThis&&globalThis,bh="undefined"!=typeof window&&window,rm="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,lr=wu||"undefined"!=typeof global&&global||bh||rm,Yo={},Zn=[],pc=Pn({\u0275cmp:Pn}),mc=Pn({\u0275dir:Pn}),Md=Pn({\u0275pipe:Pn}),sf=Pn({\u0275mod:Pn}),Td=Pn({\u0275loc:Pn}),qs=Pn({\u0275fac:Pn}),xa=Pn({__NG_ELEMENT_ID__:Pn});let om=0;function Bo(n){return Lo(()=>{const t={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Ai.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||Zn,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||gr.Emulated,id:"c",styles:n.styles||Zn,_:null,setInput:null,schemas:n.schemas||null,tView:null},o=n.directives,c=n.features,p=n.pipes;return r.id+=om++,r.inputs=Jo(n.inputs,t),r.outputs=Jo(n.outputs),c&&c.forEach(w=>w(r)),r.directiveDefs=o?()=>("function"==typeof o?o():o).map(wh):null,r.pipeDefs=p?()=>("function"==typeof p?p():p).map(Ko):null,r})}function wh(n){return Pi(n)||function(n){return n[mc]||null}(n)}function Ko(n){return function(n){return n[Md]||null}(n)}const Ch={};function Ui(n){return Lo(()=>{const e={type:n.type,bootstrap:n.bootstrap||Zn,declarations:n.declarations||Zn,imports:n.imports||Zn,exports:n.exports||Zn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Ch[n.id]=n.type),e})}function Jo(n,e){if(null==n)return Yo;const t={};for(const r in n)if(n.hasOwnProperty(r)){let o=n[r],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),t[o]=r,e&&(e[o]=c)}return t}const Xt=Bo;function vi(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function Pi(n){return n[pc]||null}function Do(n,e){const t=n[sf]||null;if(!t&&!0===e)throw new Error(`Type ${ln(n)} does not have '\u0275mod' property.`);return t}function bs(n){return Array.isArray(n)&&"object"==typeof n[1]}function No(n){return Array.isArray(n)&&!0===n[1]}function Xa(n){return 0!=(8&n.flags)}function Sh(n){return 2==(2&n.flags)}function Mu(n){return 1==(1&n.flags)}function ts(n){return null!==n.template}function am(n){return 0!=(512&n[2])}function kl(n,e){return n.hasOwnProperty(qs)?n[qs]:null}class Th{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Dr(){return ns}function ns(n){return n.type.prototype.ngOnChanges&&(n.setInput=Ya),Ih}function Ih(){const n=Iu(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===Yo)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function Ya(n,e,t,r){const o=Iu(n)||function(n,e){return n[kh]=e}(n,{previous:Yo,current:null}),c=o.current||(o.current={}),p=o.previous,w=this.declaredInputs[t],T=p[w];c[w]=new Th(T&&T.currentValue,e,p===Yo),n[r]=e}Dr.ngInherit=!0;const kh="__ngSimpleChanges__";function Iu(n){return n[kh]||null}let Ka;function qr(n){return!!n.listen}const Ja={createRenderer:(n,e)=>void 0!==Ka?Ka:"undefined"!=typeof document?document:void 0};function oi(n){for(;Array.isArray(n);)n=n[0];return n}function wc(n,e){return oi(e[n])}function eo(n,e){return oi(e[n.index])}function to(n,e){return n.data[e]}function Mo(n,e){const t=e[n];return bs(t)?t:t[0]}function Pl(n){return 4==(4&n[2])}function Fh(n){return 128==(128&n[2])}function ws(n,e){return null==e?null:n[e]}function Nd(n){n[18]=0}function Cc(n,e){n[5]+=e;let t=n,r=n[3];for(;null!==r&&(1===e&&1===t[5]||-1===e&&0===t[5]);)r[5]+=e,t=r,r=r[3]}const sn={lFrame:qd(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Ys(){return sn.bindingsEnabled}function ct(){return sn.lFrame.lView}function Wn(){return sn.lFrame.tView}function el(n){return sn.lFrame.contextLView=n,n[8]}function si(){let n=Dc();for(;null!==n&&64===n.type;)n=n.parent;return n}function Dc(){return sn.lFrame.currentTNode}function Cs(n,e){const t=sn.lFrame;t.currentTNode=n,t.isParent=e}function Oh(){return sn.lFrame.isParent}function Rl(){sn.lFrame.isParent=!1}function Fu(){return sn.isInCheckNoChangesMode}function tl(n){sn.isInCheckNoChangesMode=n}function bi(){const n=sn.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Es(){return sn.lFrame.bindingIndex}function Fl(){return sn.lFrame.bindingIndex++}function Ks(n){const e=sn.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function Af(n,e){const t=sn.lFrame;t.bindingIndex=t.bindingRootIndex=n,Lu(e)}function Lu(n){sn.lFrame.currentDirectiveIndex=n}function Lh(){return sn.lFrame.currentQueryIndex}function Bu(n){sn.lFrame.currentQueryIndex=n}function Hd(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Bh(n,e,t){if(t&Qt.SkipSelf){let o=e,c=n;for(;!(o=o.parent,null!==o||t&Qt.Host||(o=Hd(c),null===o||(c=c[15],10&o.type))););if(null===o)return!1;e=o,n=c}const r=sn.lFrame=Nu();return r.currentTNode=e,r.lView=n,!0}function Ll(n){const e=Nu(),t=n[1];sn.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function Nu(){const n=sn.lFrame,e=null===n?null:n.child;return null===e?qd(n):e}function qd(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Nh(){const n=sn.lFrame;return sn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Mc=Nh;function zu(){const n=Nh();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function wi(){return sn.lFrame.selectedIndex}function Ma(n){sn.lFrame.selectedIndex=n}function Vr(){const n=sn.lFrame;return to(n.tView,n.selectedIndex)}function Js(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const c=n.data[t].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:w,ngAfterViewInit:T,ngAfterViewChecked:L,ngOnDestroy:U}=c;p&&(n.contentHooks||(n.contentHooks=[])).push(-t,p),w&&((n.contentHooks||(n.contentHooks=[])).push(t,w),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,w)),T&&(n.viewHooks||(n.viewHooks=[])).push(-t,T),L&&((n.viewHooks||(n.viewHooks=[])).push(t,L),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,L)),null!=U&&(n.destroyHooks||(n.destroyHooks=[])).push(t,U)}}function Vu(n,e,t){_(n,e,3,t)}function Uu(n,e,t,r){(3&n[2])===t&&_(n,e,t,r)}function Ic(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function _(n,e,t,r){const c=null!=r?r:-1,p=e.length-1;let w=0;for(let T=void 0!==r?65535&n[18]:0;T<p;T++)if("number"==typeof e[T+1]){if(w=e[T],null!=r&&w>=r)break}else e[T]<0&&(n[18]+=65536),(w<c||-1==c)&&(s(n,t,e,T),n[18]=(4294901760&n[18])+T+2),T++}function s(n,e,t,r){const o=t[r]<0,c=t[r+1],w=n[o?-t[r]:t[r]];if(o){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{c.call(w)}finally{}}}else try{c.call(w)}finally{}}const h=-1;class v{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function J(n,e,t){const r=qr(n);let o=0;for(;o<t.length;){const c=t[o];if("number"==typeof c){if(0!==c)break;o++;const p=t[o++],w=t[o++],T=t[o++];r?n.setAttribute(e,w,T,p):e.setAttributeNS(p,w,T)}else{const p=c,w=t[++o];le(p)?r&&n.setProperty(e,p,w):r?n.setAttribute(e,p,w):e.setAttribute(p,w),o++}}return o}function te(n){return 3===n||4===n||6===n}function le(n){return 64===n.charCodeAt(0)}function ce(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const o=e[r];"number"==typeof o?t=o:0===t||_e(n,t,o,null,-1===t||2===t?e[++r]:null)}}return n}function _e(n,e,t,r,o){let c=0,p=n.length;if(-1===e)p=-1;else for(;c<n.length;){const w=n[c++];if("number"==typeof w){if(w===e){p=-1;break}if(w>e){p=c-1;break}}}for(;c<n.length;){const w=n[c];if("number"==typeof w)break;if(w===t){if(null===r)return void(null!==o&&(n[c+1]=o));if(r===n[c+1])return void(n[c+2]=o)}c++,null!==r&&c++,null!==o&&c++}-1!==p&&(n.splice(p,0,e),c=p+1),n.splice(c++,0,t),null!==r&&n.splice(c++,0,r),null!==o&&n.splice(c++,0,o)}function se(n){return n!==h}function ue(n){return 32767&n}function ve(n,e){let t=function(n){return n>>16}(n),r=e;for(;t>0;)r=r[15],t--;return r}let Se=!0;function de(n){const e=Se;return Se=n,e}let Pe=0;function xt(n,e){const t=Et(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,Dt(r.data,n),Dt(e,null),Dt(r.blueprint,null));const o=dt(n,e),c=n.injectorIndex;if(se(o)){const p=ue(o),w=ve(o,e),T=w[1].data;for(let L=0;L<8;L++)e[c+L]=w[p+L]|T[p+L]}return e[c+8]=o,c}function Dt(n,e){n.push(0,0,0,0,0,0,0,0,e)}function Et(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function dt(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,o=e;for(;null!==o;){const c=o[1],p=c.type;if(r=2===p?c.declTNode:1===p?o[6]:null,null===r)return h;if(t++,o=o[15],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return h}function Mt(n,e,t){!function(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(xa)&&(r=t[xa]),null==r&&(r=t[xa]=Pe++);const o=255&r;e.data[n+(o>>5)]|=1<<o}(n,e,t)}function Jt(n,e,t){if(t&Qt.Optional)return n;ft(e,"NodeInjector")}function Ur(n,e,t,r){if(t&Qt.Optional&&void 0===r&&(r=null),0==(t&(Qt.Self|Qt.Host))){const o=n[9],c=va(void 0);try{return o?o.get(e,r,t&Qt.Optional):xu(e,r,t&Qt.Optional)}finally{va(c)}}return Jt(r,e,t)}function wr(n,e,t,r=Qt.Default,o){if(null!==n){const c=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(xa)?n[xa]:void 0;return"number"==typeof e?e>=0?255&e:Cn:e}(t);if("function"==typeof c){if(!Bh(e,n,r))return r&Qt.Host?Jt(o,t,r):Ur(e,t,r,o);try{const p=c(r);if(null!=p||r&Qt.Optional)return p;ft(t)}finally{Mc()}}else if("number"==typeof c){let p=null,w=Et(n,e),T=h,L=r&Qt.Host?e[16][6]:null;for((-1===w||r&Qt.SkipSelf)&&(T=-1===w?dt(n,e):e[w+8],T!==h&&Ds(r,!1)?(p=e[1],w=ue(T),e=ve(T,e)):w=-1);-1!==w;){const U=e[1];if(_o(c,w,U.data)){const W=Br(w,e,t,p,r,L);if(W!==cn)return W}T=e[w+8],T!==h&&Ds(r,e[1].data[w+8]===L)&&_o(c,w,e)?(p=U,w=ue(T),e=ve(T,e)):w=-1}}}return Ur(e,t,r,o)}const cn={};function Cn(){return new ko(si(),ct())}function Br(n,e,t,r,o,c){const p=e[1],w=p.data[n+8],U=go(w,p,t,null==r?Sh(w)&&Se:r!=p&&0!=(3&w.type),o&Qt.Host&&c===w);return null!==U?Io(e,p,U,w):cn}function go(n,e,t,r,o){const c=n.providerIndexes,p=e.data,w=1048575&c,T=n.directiveStart,U=c>>20,K=o?w+U:n.directiveEnd;for(let ie=r?w:w+U;ie<K;ie++){const fe=p[ie];if(ie<T&&t===fe||ie>=T&&fe.type===t)return ie}if(o){const ie=p[T];if(ie&&ts(ie)&&ie.type===t)return T}return null}function Io(n,e,t,r){let o=n[t];const c=e.data;if(function(n){return n instanceof v}(o)){const p=o;p.resolving&&function(n,e){throw new ae("200",`Circular dependency in DI detected for ${n}`)}(ke(c[t]));const w=de(p.canSeeViewProviders);p.resolving=!0;const T=p.injectImpl?va(p.injectImpl):null;Bh(n,r,Qt.Default);try{o=n[t]=p.factory(void 0,c,n,r),e.firstCreatePass&&t>=r.directiveStart&&function(n,e,t){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:c}=e.type.prototype;if(r){const p=ns(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,p),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,p)}o&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,o),c&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,c),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,c))}(t,c[t],e)}finally{null!==T&&va(T),de(w),p.resolving=!1,Mc()}}return o}function _o(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function Ds(n,e){return!(n&Qt.Self||n&Qt.Host&&e)}class ko{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return wr(this._tNode,this._lView,e,void 0,t)}}function Tn(n){return Lo(()=>{const e=n.prototype.constructor,t=e[qs]||Sr(e),r=Object.prototype;let o=Object.getPrototypeOf(n.prototype).constructor;for(;o&&o!==r;){const c=o[qs]||Sr(o);if(c&&c!==t)return c;o=Object.getPrototypeOf(o)}return c=>new c})}function Sr(n){return Z(n)?()=>{const e=Sr(ne(n));return e&&e()}:kl(n)}const Ci="__parameters__";function io(n,e,t){return Lo(()=>{const r=function(n){return function(...t){if(n){const r=n(...t);for(const o in r)this[o]=r[o]}}}(e);function o(...c){if(this instanceof o)return r.apply(this,c),this;const p=new o(...c);return w.annotation=p,w;function w(T,L,U){const W=T.hasOwnProperty(Ci)?T[Ci]:Object.defineProperty(T,Ci,{value:[]})[Ci];for(;W.length<=U;)W.push(null);return(W[U]=W[U]||[]).push(p),T}}return t&&(o.prototype=Object.create(t.prototype)),o.prototype.ngMetadataName=n,o.annotationCls=o,o})}class nn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=$t({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Vh=new nn("AnalyzeForEntryComponents"),ju=Function;function Hi(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)?(e===n&&(e=n.slice(0,t)),Hi(r,e)):e!==n&&e.push(r)}return e}function Ss(n,e){n.forEach(t=>Array.isArray(t)?Ss(t,e):e(t))}function Xd(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Pc(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Rc(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}function Ri(n,e,t){let r=ta(n,e);return r>=0?n[1|r]=t:(r=~r,function(n,e,t,r){let o=n.length;if(o==e)n.push(t,r);else if(1===o)n.push(r,n[0]),n[0]=t;else{for(o--,n.push(n[o-1],n[o]);o>e;)n[o]=n[o-2],o--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function Ta(n,e){const t=ta(n,e);if(t>=0)return n[1|t]}function ta(n,e){return function(n,e,t){let r=0,o=n.length>>t;for(;o!==r;){const c=r+(o-r>>1),p=n[c<<t];if(e===p)return c<<t;p>e?o=c:r=c+1}return~(o<<t)}(n,e,1)}const Gu={},bf="__NG_DI_FLAG__",na="ngTempTokenPath",wf=/\n/gm,Cf="__source",Ef=Pn({provide:String,useValue:Pn});let eA;function Oc(n){const e=eA;return eA=n,e}function Fv(n,e=Qt.Default){if(void 0===eA)throw new Error("inject() must be called from an injection context");return null===eA?xu(n,void 0,e):eA.get(n,e&Qt.Optional?null:void 0,e)}function _t(n,e=Qt.Default){return(di||Fv)(ne(n),e)}const T0=_t;function ra(n){const e=[];for(let t=0;t<n.length;t++){const r=ne(n[t]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let o,c=Qt.Default;for(let p=0;p<r.length;p++){const w=r[p],T=Ov(w);"number"==typeof T?-1===T?o=w.token:c|=T:o=w}e.push(_t(o,c))}else e.push(_t(r))}return e}function Uh(n,e){return n[bf]=e,n.prototype[bf]=e,n}function Ov(n){return n[bf]}function Hu(n,e,t,r){const o=n[na];throw e[Cf]&&o.unshift(e[Cf]),n.message=function(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let o=ln(e);if(Array.isArray(e))o=e.map(ln).join(" -> ");else if("object"==typeof e){let c=[];for(let p in e)if(e.hasOwnProperty(p)){let w=e[p];c.push(p+":"+("string"==typeof w?JSON.stringify(w):ln(w)))}o=`{${c.join(", ")}}`}return`${t}${r?"("+r+")":""}[${o}]: ${n.replace(wf,"\n  ")}`}("\n"+n.message,o,t,r),n.ngTokenPath=o,n[na]=null,n}const qu=Uh(io("Inject",n=>({token:n})),-1),rs=Uh(io("Optional"),8),Ei=Uh(io("SkipSelf"),4);let $h;function Wu(n){var e;return(null===(e=function(){if(void 0===$h&&($h=null,lr.trustedTypes))try{$h=lr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return $h}())||void 0===e?void 0:e.createHTML(n))||n}class zl{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Lc extends zl{getTypeName(){return"HTML"}}class Ms extends zl{getTypeName(){return"Style"}}class jv extends zl{getTypeName(){return"Script"}}class wm extends zl{getTypeName(){return"URL"}}class Gv extends zl{getTypeName(){return"ResourceURL"}}function Ts(n){return n instanceof zl?n.changingThisBreaksApplicationSecurity:n}function rl(n,e){const t=Rf(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}function Rf(n){return n instanceof zl&&n.getTypeName()||null}class Hv{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(Wu(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch(t){return null}}}class qv{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const r=this.inertDocument.createElement("body");t.appendChild(r)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=Wu(e),t;const r=this.inertDocument.createElement("body");return r.innerHTML=Wu(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(r),r}stripCustomNsAttrs(e){const t=e.attributes;for(let o=t.length-1;0<o;o--){const p=t.item(o).name;("xmlns:ns1"===p||0===p.indexOf("ns1:"))&&e.removeAttribute(p)}let r=e.firstChild;for(;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling}}const Wv=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Qv=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Qu(n){return(n=String(n)).match(Wv)||n.match(Qv)?n:"unsafe:"+n}function L0(n){return(n=String(n)).split(",").map(e=>Qu(e.trim())).join(", ")}function zo(n){const e={};for(const t of n.split(","))e[t]=!0;return e}function sA(...n){const e={};for(const t of n)for(const r in t)t.hasOwnProperty(r)&&(e[r]=!0);return e}const Xr=zo("area,br,col,hr,img,wbr"),aA=zo("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Cm=zo("rp,rt"),Lf=sA(Xr,sA(aA,zo("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),sA(Cm,zo("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),sA(Cm,aA)),Bf=zo("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Xu=zo("srcset"),z0=sA(Bf,Xu,zo("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),zo("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),V0=zo("script,style,template");class lA{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,r=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?r=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,r&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let o=this.checkClobberedElement(t,t.nextSibling);if(o){t=o;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!Lf.hasOwnProperty(t))return this.sanitizedSomething=!0,!V0.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const r=e.attributes;for(let o=0;o<r.length;o++){const c=r.item(o),p=c.name,w=p.toLowerCase();if(!z0.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let T=c.value;Bf[w]&&(T=Qu(T)),Xu[w]&&(T=L0(T)),this.buf.push(" ",p,'="',U0(T),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();Lf.hasOwnProperty(t)&&!Xr.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(U0(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const Xv=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Sm=/([^\#-~ |!])/g;function U0(n){return n.replace(/&/g,"&amp;").replace(Xv,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(Sm,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Hh;function Nf(n,e){let t=null;try{Hh=Hh||function(n){const e=new qv(n);return function(){try{return!!(new window.DOMParser).parseFromString(Wu(""),"text/html")}catch(n){return!1}}()?new Hv(e):e}(n);let r=e?String(e):"";t=Hh.getInertBodyElement(r);let o=5,c=r;do{if(0===o)throw new Error("Failed to sanitize html because the input is unstable");o--,r=c,c=t.innerHTML,t=Hh.getInertBodyElement(r)}while(r!==c);return Wu((new lA).sanitizeChildren(cA(t)||t))}finally{if(t){const r=cA(t)||t;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function cA(n){return"content"in n&&function(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var Nr=(()=>((Nr=Nr||{})[Nr.NONE=0]="NONE",Nr[Nr.HTML=1]="HTML",Nr[Nr.STYLE=2]="STYLE",Nr[Nr.SCRIPT=3]="SCRIPT",Nr[Nr.URL=4]="URL",Nr[Nr.RESOURCE_URL=5]="RESOURCE_URL",Nr))();const km="__ngContext__";function oo(n,e){n[km]=e}function Pm(n){const e=function(n){return n[km]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function Vf(n){return n.ngOriginalError}function c1(n,...e){n.error(...e)}class Nc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=this._findContext(e),o=function(n){return n&&n.ngErrorLogger||c1}(e);o(this._console,"ERROR",e),t&&o(this._console,"ORIGINAL ERROR",t),r&&o(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(n){return n.ngDebugContext}(e)||this._findContext(Vf(e)):null}_findOriginalError(e){let t=e&&Vf(e);for(;t&&Vf(t);)t=Vf(t);return t||null}}const Bm=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(lr))();function Pa(n){return n instanceof Function?n():n}var Is=(()=>((Is=Is||{})[Is.Important=1]="Important",Is[Is.DashCase=2]="DashCase",Is))();function Um(n,e){return undefined(n,e)}function pA(n){const e=n[3];return No(e)?e[3]:e}function Wh(n){return jm(n[13])}function Vc(n){return jm(n[4])}function jm(n){for(;null!==n&&!No(n);)n=n[4];return n}function Qh(n,e,t,r,o){if(null!=r){let c,p=!1;No(r)?c=r:bs(r)&&(p=!0,r=r[0]);const w=oi(r);0===n&&null!==t?null==o?Qm(e,t,w):Ku(e,t,w,o||null,!0):1===n&&null!==t?Ku(e,t,w,o||null,!0):2===n?function(n,e,t){const r=gA(n,e);r&&function(n,e,t,r){qr(n)?n.removeChild(e,t,r):e.removeChild(t)}(n,r,e,t)}(e,w,p):3===n&&e.destroyNode(w),null!=c&&function(n,e,t,r,o){const c=t[7];c!==oi(t)&&Qh(e,n,r,c,o);for(let w=10;w<t.length;w++){const T=t[w];jc(T[1],T,n,e,r,c)}}(e,n,c,t,o)}}function Gf(n,e,t){return qr(n)?n.createElement(e,t):null===t?n.createElement(e):n.createElementNS(t,e)}function qm(n,e){const t=n[9],r=t.indexOf(e),o=e[3];1024&e[2]&&(e[2]&=-1025,Cc(o,-1)),t.splice(r,1)}function Hf(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const o=r[17];null!==o&&o!==n&&qm(o,r),e>0&&(n[t-1][4]=r[4]);const c=Pc(n,10+e);!function(n,e){jc(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const p=c[19];null!==p&&p.detachView(c[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function e_(n,e){if(!(256&e[2])){const t=e[11];qr(t)&&t.destroyNode&&jc(n,e,t,3,null,null),function(n){let e=n[13];if(!e)return qf(n[1],n);for(;e;){let t=null;if(bs(e))t=e[13];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)bs(e)&&qf(e[1],e),e=e[3];null===e&&(e=n),bs(e)&&qf(e[1],e),t=e&&e[4]}e=t}}(e)}}function qf(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const o=e[t[r]];if(!(o instanceof v)){const c=t[r+1];if(Array.isArray(c))for(let p=0;p<c.length;p+=2){const w=o[c[p]],T=c[p+1];try{T.call(w)}finally{}}else try{c.call(o)}finally{}}}}(n,e),function(n,e){const t=n.cleanup,r=e[7];let o=-1;if(null!==t)for(let c=0;c<t.length-1;c+=2)if("string"==typeof t[c]){const p=t[c+1],w="function"==typeof p?p(e):oi(e[p]),T=r[o=t[c+2]],L=t[c+3];"boolean"==typeof L?w.removeEventListener(t[c],T,L):L>=0?r[o=L]():r[o=-L].unsubscribe(),c+=2}else{const p=r[o=t[c+1]];t[c].call(p)}if(null!==r){for(let c=o+1;c<r.length;c++)r[c]();e[7]=null}}(n,e),1===e[1].type&&qr(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&No(e[3])){t!==e[3]&&qm(t,e);const r=e[19];null!==r&&r.detachView(n)}}}function Zf(n,e,t){return function(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[0];if(2&r.flags){const o=n.data[r.directiveStart].encapsulation;if(o===gr.None||o===gr.Emulated)return null}return eo(r,t)}(n,e.parent,t)}function Ku(n,e,t,r,o){qr(n)?n.insertBefore(e,t,r,o):e.insertBefore(t,r,o)}function Qm(n,e,t){qr(n)?n.appendChild(e,t):e.appendChild(t)}function Ul(n,e,t,r,o){null!==r?Ku(n,e,t,r,o):Qm(n,e,t)}function gA(n,e){return qr(n)?n.parentNode(e):e.parentNode}function Xm(n,e,t){return o_(n,e,t)}let o_=function(n,e,t){return 40&n.type?eo(n,t):null};function Uc(n,e,t,r){const o=Zf(n,r,e),c=e[11],w=Xm(r.parent||e[6],r,e);if(null!=o)if(Array.isArray(t))for(let T=0;T<t.length;T++)Ul(c,o,t[T],w,!1);else Ul(c,o,t,w,!1)}function _A(n,e){if(null!==e){const t=e.type;if(3&t)return eo(e,n);if(4&t)return yA(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return _A(n,r);{const o=n[e.index];return No(o)?yA(-1,o):oi(o)}}if(32&t)return Um(e,n)()||oi(n[e.index]);{const r=Km(n,e);return null!==r?Array.isArray(r)?r[0]:_A(pA(n[16]),r):_A(n,e.next)}}return null}function Km(n,e){return null!==e?n[16][6].projection[e.projection]:null}function yA(n,e){const t=10+n+1;if(t<e.length){const r=e[t],o=r[1].firstChild;if(null!==o)return _A(r,o)}return e[7]}function Qf(n,e,t,r,o,c,p){for(;null!=t;){const w=r[t.index],T=t.type;if(p&&0===e&&(w&&oo(oi(w),r),t.flags|=4),64!=(64&t.flags))if(8&T)Qf(n,e,t.child,r,o,c,!1),Qh(e,n,o,w,c);else if(32&T){const L=Um(t,r);let U;for(;U=L();)Qh(e,n,o,U,c);Qh(e,n,o,w,c)}else 16&T?vA(n,e,r,t,o,c):Qh(e,n,o,w,c);t=p?t.projectionNext:t.next}}function jc(n,e,t,r,o,c){Qf(t,r,n.firstChild,e,o,c,!1)}function vA(n,e,t,r,o,c){const p=t[16],T=p[6].projection[r.projection];if(Array.isArray(T))for(let L=0;L<T.length;L++)Qh(e,n,o,T[L],c);else Qf(n,e,T,p[3],o,c,!0)}function a_(n,e,t){qr(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function Jm(n,e,t){qr(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function l_(n,e,t){let r=n.length;for(;;){const o=n.indexOf(e,t);if(-1===o)return o;if(0===o||n.charCodeAt(o-1)<=32){const c=e.length;if(o+c===r||n.charCodeAt(o+c)<=32)return o}t=o+1}}const eh="ng-template";function eg(n,e,t){let r=0;for(;r<n.length;){let o=n[r++];if(t&&"class"===o){if(o=n[r],-1!==l_(o.toLowerCase(),e,0))return!0}else if(1===o){for(;r<n.length&&"string"==typeof(o=n[r++]);)if(o.toLowerCase()===e)return!0;return!1}}return!1}function c_(n){return 4===n.type&&n.value!==eh}function u_(n,e,t){return e===(4!==n.type||t?n.value:eh)}function m1(n,e,t){let r=4;const o=n.attrs||[],c=function(n){for(let e=0;e<n.length;e++)if(te(n[e]))return e;return n.length}(o);let p=!1;for(let w=0;w<e.length;w++){const T=e[w];if("number"!=typeof T){if(!p)if(4&r){if(r=2|1&r,""!==T&&!u_(n,T,t)||""===T&&1===e.length){if(Ps(r))return!1;p=!0}}else{const L=8&r?T:e[++w];if(8&r&&null!==n.attrs){if(!eg(n.attrs,L,t)){if(Ps(r))return!1;p=!0}continue}const W=g1(8&r?"class":T,o,c_(n),t);if(-1===W){if(Ps(r))return!1;p=!0;continue}if(""!==L){let K;K=W>c?"":o[W+1].toLowerCase();const ie=8&r?K:null;if(ie&&-1!==l_(ie,L,0)||2&r&&L!==K){if(Ps(r))return!1;p=!0}}}}else{if(!p&&!Ps(r)&&!Ps(T))return!1;if(p&&Ps(T))continue;p=!1,r=T|1&r}}return Ps(r)||p}function Ps(n){return 0==(1&n)}function g1(n,e,t,r){if(null===e)return-1;let o=0;if(r||!t){let c=!1;for(;o<e.length;){const p=e[o];if(p===n)return o;if(3===p||6===p)c=!0;else{if(1===p||2===p){let w=e[++o];for(;"string"==typeof w;)w=e[++o];continue}if(4===p)break;if(0===p){o+=4;continue}}o+=c?1:2}return-1}return function(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function jl(n,e,t=!1){for(let r=0;r<e.length;r++)if(m1(n,e[r],t))return!0;return!1}function tg(n,e){e:for(let t=0;t<e.length;t++){const r=e[t];if(n.length===r.length){for(let o=0;o<n.length;o++)if(n[o]!==r[o])continue e;return!0}}return!1}function A_(n,e){return n?":not("+e.trim()+")":e}function _1(n){let e=n[0],t=1,r=2,o="",c=!1;for(;t<n.length;){let p=n[t];if("string"==typeof p)if(2&r){const w=n[++t];o+="["+p+(w.length>0?'="'+w+'"':"")+"]"}else 8&r?o+="."+p:4&r&&(o+=" "+p);else""!==o&&!Ps(p)&&(e+=A_(c,o),o=""),r=p,c=c||!Ps(r);t++}return""!==o&&(e+=A_(c,o)),e}const hn={};function Fn(n){Jf(Wn(),ct(),wi()+n,Fu())}function Jf(n,e,t,r){if(!r)if(3==(3&e[2])){const c=n.preOrderCheckHooks;null!==c&&Vu(e,c,t)}else{const c=n.preOrderHooks;null!==c&&Uu(e,c,0,t)}Ma(t)}function Yh(n,e){return n<<17|e<<2}function ao(n){return n>>17&32767}function ep(n){return 2|n}function oa(n){return(131068&n)>>2}function rg(n,e){return-131069&n|e<<2}function ig(n){return 1|n}function $l(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const o=t[r],c=t[r+1];if(-1!==c){const p=n.data[c];Bu(o),p.contentQueries(2,e[c],c)}}}function EA(n,e,t,r,o,c,p,w,T,L){const U=e.blueprint.slice();return U[0]=o,U[2]=140|r,Nd(U),U[3]=U[15]=n,U[8]=t,U[10]=p||n&&n[10],U[11]=w||n&&n[11],U[12]=T||n&&n[12]||null,U[9]=L||n&&n[9]||null,U[6]=c,U[16]=2==e.type?n[16]:U,U}function Ra(n,e,t,r,o){let c=n.data[e];if(null===c)c=function(n,e,t,r,o){const c=Dc(),p=Oh(),T=n.data[e]=function(n,e,t,r,o,c){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?c:c&&c.parent,t,e,r,o);return null===n.firstChild&&(n.firstChild=T),null!==c&&(p?null==c.child&&null!==T.parent&&(c.child=T):null===c.next&&(c.next=T)),T}(n,e,t,r,o),sn.lFrame.inI18n&&(c.flags|=64);else if(64&c.type){c.type=t,c.value=r,c.attrs=o;const p=function(){const n=sn.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();c.injectorIndex=null===p?-1:p.injectorIndex}return Cs(c,!0),c}function $c(n,e,t,r){if(0===t)return-1;const o=e.length;for(let c=0;c<t;c++)e.push(r),n.blueprint.push(r),n.data.push(null);return o}function is(n,e,t){Ll(e);try{const r=n.viewQuery;null!==r&&Gr(1,r,t);const o=n.template;null!==o&&sa(n,e,o,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&$l(n,e),n.staticViewQueries&&Gr(2,n.viewQuery,t);const c=n.components;null!==c&&function(n,e){for(let t=0;t<e.length;t++)er(n,e[t])}(e,c)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,zu()}}function Hc(n,e,t,r){const o=e[2];if(256==(256&o))return;Ll(e);const c=Fu();try{Nd(e),function(n){sn.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&sa(n,e,t,2,r);const p=3==(3&o);if(!c)if(p){const L=n.preOrderCheckHooks;null!==L&&Vu(e,L,null)}else{const L=n.preOrderHooks;null!==L&&Uu(e,L,0,null),Ic(e,0)}if(function(n){for(let e=Wh(n);null!==e;e=Vc(e)){if(!e[2])continue;const t=e[9];for(let r=0;r<t.length;r++){const o=t[r],c=o[3];0==(1024&o[2])&&Cc(c,1),o[2]|=1024}}}(e),function(n){for(let e=Wh(n);null!==e;e=Vc(e))for(let t=10;t<e.length;t++){const r=e[t],o=r[1];Fh(r)&&Hc(o,r,o.template,r[8])}}(e),null!==n.contentQueries&&$l(n,e),!c)if(p){const L=n.contentCheckHooks;null!==L&&Vu(e,L)}else{const L=n.contentHooks;null!==L&&Uu(e,L,1),Ic(e,1)}!function(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const o=t[r];if(o<0)Ma(~o);else{const c=o,p=t[++r],w=t[++r];Af(p,c),w(2,e[c])}}}finally{Ma(-1)}}(n,e);const w=n.components;null!==w&&function(n,e){for(let t=0;t<e.length;t++)Yt(n,e[t])}(e,w);const T=n.viewQuery;if(null!==T&&Gr(2,T,r),!c)if(p){const L=n.viewCheckHooks;null!==L&&Vu(e,L)}else{const L=n.viewHooks;null!==L&&Uu(e,L,2),Ic(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),c||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,Cc(e[3],-1))}finally{zu()}}function fg(n,e,t,r){const o=e[10],c=!Fu(),p=Pl(e);try{c&&!p&&o.begin&&o.begin(),p&&is(n,e,r),Hc(n,e,t,r)}finally{c&&!p&&o.end&&o.end()}}function sa(n,e,t,r,o){const c=wi(),p=2&r;try{Ma(-1),p&&e.length>20&&Jf(n,e,20,Fu()),t(r,o)}finally{Ma(c)}}function qc(n,e,t){if(Xa(e)){const o=e.directiveEnd;for(let c=e.directiveStart;c<o;c++){const p=n.data[c];p.contentQueries&&p.contentQueries(1,t[c],c)}}}function sp(n,e,t){!Ys()||(function(n,e,t,r){const o=t.directiveStart,c=t.directiveEnd;n.firstCreatePass||xt(t,e),oo(r,e);const p=t.initialInputs;for(let w=o;w<c;w++){const T=n.data[w],L=ts(T);L&&Ue(e,t,T);const U=Io(e,n,w,t);oo(U,e),null!==p&&At(0,w-o,U,T,0,p),L&&(Mo(t.index,e)[8]=U)}}(n,e,t,eo(t,e)),128==(128&t.flags)&&function(n,e,t){const r=t.directiveStart,o=t.directiveEnd,p=t.index,w=sn.lFrame.currentDirectiveIndex;try{Ma(p);for(let T=r;T<o;T++){const L=n.data[T],U=e[T];Lu(T),(null!==L.hostBindings||0!==L.hostVars||null!==L.hostAttrs)&&oe(L,U)}}finally{Ma(-1),Lu(w)}}(n,e,t))}function ap(n,e,t=eo){const r=e.localNames;if(null!==r){let o=e.index+1;for(let c=0;c<r.length;c+=2){const p=r[c+1],w=-1===p?t(e,n):n[p];n[o++]=w}}}function SA(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=MA(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function MA(n,e,t,r,o,c,p,w,T,L){const U=20+r,W=U+o,K=function(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:hn);return t}(U,W),ie="function"==typeof L?L():L;return K[1]={type:n,blueprint:K,template:t,queries:null,viewQuery:w,declTNode:e,data:K.slice().fill(null,U),bindingStartIndex:U,expandoStartIndex:W,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:T,consts:ie,incompleteFirstPass:!1}}function lp(n,e,t,r){const o=Bi(e);null===t?o.push(r):(o.push(t),n.firstCreatePass&&Zr(n).push(r,o.length-1))}function pg(n,e,t){for(let r in n)if(n.hasOwnProperty(r)){const o=n[r];(t=null===t?{}:t).hasOwnProperty(r)?t[r].push(e,o):t[r]=[e,o]}return t}function l(n,e,t,r,o,c,p,w){const T=eo(e,t);let U,L=e.inputs;!w&&null!=L&&(U=L[r])?(dr(n,t,U,r,o),Sh(e)&&function(n,e){const t=Mo(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(r=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),o=null!=p?p(o,e.value||"",r):o,qr(c)?c.setProperty(T,r,o):le(r)||(T.setProperty?T.setProperty(r,o):T[r]=o))}function N(n,e,t,r){let o=!1;if(Ys()){const c=function(n,e,t){const r=n.directiveRegistry;let o=null;if(r)for(let c=0;c<r.length;c++){const p=r[c];jl(t,p.selectors,!1)&&(o||(o=[]),Mt(xt(t,e),n,p.type),ts(p)?(xe(n,t),o.unshift(p)):o.push(p))}return o}(n,e,t),p=null===r?null:{"":-1};if(null!==c){o=!0,Be(t,n.data.length,c.length);for(let U=0;U<c.length;U++){const W=c[U];W.providersResolver&&W.providersResolver(W)}let w=!1,T=!1,L=$c(n,e,c.length,null);for(let U=0;U<c.length;U++){const W=c[U];t.mergedAttrs=ce(t.mergedAttrs,W.hostAttrs),Ne(n,t,e,L,W),Le(L,W,p),null!==W.contentQueries&&(t.flags|=8),(null!==W.hostBindings||null!==W.hostAttrs||0!==W.hostVars)&&(t.flags|=128);const K=W.type.prototype;!w&&(K.ngOnChanges||K.ngOnInit||K.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),w=!0),!T&&(K.ngOnChanges||K.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),T=!0),L++}!function(n,e){const r=e.directiveEnd,o=n.data,c=e.attrs,p=[];let w=null,T=null;for(let L=e.directiveStart;L<r;L++){const U=o[L],W=U.inputs,K=null===c||c_(e)?null:pt(W,c);p.push(K),w=pg(W,L,w),T=pg(U.outputs,L,T)}null!==w&&(w.hasOwnProperty("class")&&(e.flags|=16),w.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=p,e.inputs=w,e.outputs=T}(n,t)}p&&function(n,e,t){if(e){const r=n.localNames=[];for(let o=0;o<e.length;o+=2){const c=t[e[o+1]];if(null==c)throw new ae("301",`Export of name '${e[o+1]}' not found!`);r.push(e[o],c)}}}(t,r,p)}return t.mergedAttrs=ce(t.mergedAttrs,t.attrs),o}function V(n,e,t,r,o,c){const p=c.hostBindings;if(p){let w=n.hostBindingOpCodes;null===w&&(w=n.hostBindingOpCodes=[]);const T=~e.index;(function(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(w)!=T&&w.push(T),w.push(r,o,p)}}function oe(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function xe(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function Le(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;ts(e)&&(t[""]=n)}}function Be(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Ne(n,e,t,r,o){n.data[r]=o;const c=o.factory||(o.factory=kl(o.type)),p=new v(c,ts(o),null);n.blueprint[r]=p,t[r]=p,V(n,e,0,r,$c(n,t,o.hostVars,hn),o)}function Ue(n,e,t){const r=eo(e,n),o=SA(t),c=n[10],p=Dn(n,EA(n,o,null,t.onPush?64:16,r,e,c,c.createRenderer(r,t),null,null));n[e.index]=p}function At(n,e,t,r,o,c){const p=c[e];if(null!==p){const w=r.setInput;for(let T=0;T<p.length;){const L=p[T++],U=p[T++],W=p[T++];null!==w?r.setInput(t,W,L,U):t[U]=W}}}function pt(n,e){let t=null,r=0;for(;r<e.length;){const o=e[r];if(0!==o)if(5!==o){if("number"==typeof o)break;n.hasOwnProperty(o)&&(null===t&&(t=[]),t.push(o,n[o],e[r+1])),r+=2}else r+=2;else r+=4}return t}function it(n,e,t,r){return new Array(n,!0,!1,e,null,0,r,t,null,null)}function Yt(n,e){const t=Mo(e,n);if(Fh(t)){const r=t[1];80&t[2]?Hc(r,t,r.template,t[8]):t[5]>0&&St(t)}}function St(n){for(let r=Wh(n);null!==r;r=Vc(r))for(let o=10;o<r.length;o++){const c=r[o];if(1024&c[2]){const p=c[1];Hc(p,c,p.template,c[8])}else c[5]>0&&St(c)}const t=n[1].components;if(null!==t)for(let r=0;r<t.length;r++){const o=Mo(t[r],n);Fh(o)&&o[5]>0&&St(o)}}function er(n,e){const t=Mo(e,n),r=t[1];(function(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),is(r,t,t[8])}function Dn(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function Ut(n){for(;n;){n[2]|=64;const e=pA(n);if(am(n)&&!e)return n;n=e}return null}function Di(n,e,t){const r=e[10];r.begin&&r.begin();try{Hc(n,e,n.template,t)}catch(o){throw Si(e,o),o}finally{r.end&&r.end()}}function jr(n){!function(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],r=Pm(t),o=r[1];fg(o,r,o.template,t)}}(n[8])}function Gr(n,e,t){Bu(0),e(n,t)}const hr=(()=>Promise.resolve(null))();function Bi(n){return n[7]||(n[7]=[])}function Zr(n){return n.cleanup||(n.cleanup=[])}function Si(n,e){const t=n[9],r=t?t.get(Nc,null):null;r&&r.handleError(e)}function dr(n,e,t,r,o){for(let c=0;c<t.length;){const p=t[c++],w=t[c++],T=e[p],L=n.data[p];null!==L.setInput?L.setInput(T,o,r,w):T[w]=o}}function Kr(n,e,t){const r=wc(e,n);!function(n,e,t){qr(n)?n.setValue(e,t):e.textContent=t}(n[11],r,t)}function Mr(n,e,t){let r=t?n.styles:null,o=t?n.classes:null,c=0;if(null!==e)for(let p=0;p<e.length;p++){const w=e[p];"number"==typeof w?c=w:1==c?o=ya(o,w):2==c&&(r=ya(r,w+": "+e[++p]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=o:n.classesWithoutHost=o}const ei=new nn("INJECTOR",-1);class ti{get(e,t=Gu){if(t===Gu){const r=new Error(`NullInjectorError: No provider for ${ln(e)}!`);throw r.name="NullInjectorError",r}return t}}const Vn=new nn("Set Injector scope."),zi={},os={};let Rs;function Fs(){return void 0===Rs&&(Rs=new ti),Rs}function Oa(n,e=null,t=null,r){return new yo(n,t,e||Fs(),r)}class yo{constructor(e,t,r,o=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const c=[];t&&Ss(t,w=>this.processProvider(w,e,t)),Ss([e],w=>this.processInjectorType(w,[],c)),this.records.set(ei,Zc(void 0,this));const p=this.records.get(Vn);this.scope=null!=p?p.value:null,this.source=o||("object"==typeof e?null:ln(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=Gu,r=Qt.Default){this.assertNotDestroyed();const o=Oc(this),c=va(void 0);try{if(!(r&Qt.SkipSelf)){let w=this.records.get(e);if(void 0===w){const T=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof nn}(e)&&Jn(e);w=T&&this.injectableDefInScope(T)?Zc(aa(e),zi):null,this.records.set(e,w)}if(null!=w)return this.hydrate(e,w)}return(r&Qt.Self?Fs():this.parent).get(e,t=r&Qt.Optional&&t===Gu?null:t)}catch(p){if("NullInjectorError"===p.name){if((p[na]=p[na]||[]).unshift(ln(e)),o)throw p;return Hu(p,e,"R3InjectorError",this.source)}throw p}finally{va(c),Oc(o)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,o)=>e.push(ln(o))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,r){if(!(e=ne(e)))return!1;let o=fc(e);const c=null==o&&e.ngModule||void 0,p=void 0===c?e:c,w=-1!==r.indexOf(p);if(void 0!==c&&(o=fc(c)),null==o)return!1;if(null!=o.imports&&!w){let U;r.push(p);try{Ss(o.imports,W=>{this.processInjectorType(W,t,r)&&(void 0===U&&(U=[]),U.push(W))})}finally{}if(void 0!==U)for(let W=0;W<U.length;W++){const{ngModule:K,providers:ie}=U[W];Ss(ie,fe=>this.processProvider(fe,K,ie||Zn))}}this.injectorDefTypes.add(p);const T=kl(p)||(()=>new p);this.records.set(p,Zc(T,zi));const L=o.providers;if(null!=L&&!w){const U=e;Ss(L,W=>this.processProvider(W,U,L))}return void 0!==c&&void 0!==e.providers}processProvider(e,t,r){let o=Jh(e=ne(e))?e:ne(e&&e.provide);const c=function(n,e,t){return cp(n)?Zc(void 0,n.useValue):Zc(Kh(n),zi)}(e);if(Jh(e)||!0!==e.multi)this.records.get(o);else{let p=this.records.get(o);p||(p=Zc(void 0,zi,!0),p.factory=()=>ra(p.multi),this.records.set(o,p)),o=e,p.multi.push(e)}this.records.set(o,c)}hydrate(e,t){return t.value===zi&&(t.value=os,t.value=t.factory()),"object"==typeof t.value&&t.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=ne(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function aa(n){const e=Jn(n),t=null!==e?e.factory:kl(n);if(null!==t)return t;if(n instanceof nn)throw new Error(`Token ${ln(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const e=n.length;if(e>0){const r=Rc(e,"?");throw new Error(`Can't resolve all parameters for ${ln(n)}: (${r.join(", ")}).`)}const t=function(n){const e=n&&(n[Qo]||n[un]);if(e){const t=function(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Error("unreachable")}function Kh(n,e,t){let r;if(Jh(n)){const o=ne(n);return kl(o)||aa(o)}if(cp(n))r=()=>ne(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...ra(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))r=()=>_t(ne(n.useExisting));else{const o=ne(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return kl(o)||aa(o);r=()=>new o(...ra(n.deps))}return r}function Zc(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function cp(n){return null!==n&&"object"==typeof n&&Ef in n}function Jh(n){return"function"==typeof n}const m2=function(n,e,t){return function(n,e=null,t=null,r){const o=Oa(n,e,t,r);return o._resolveInjectorDefTypes(),o}({name:t},e,n,t)};let Ir=(()=>{class n{static create(t,r){return Array.isArray(t)?m2(t,r,""):m2(t.providers,t.parent,t.name||"")}}return n.THROW_IF_NOT_FOUND=Gu,n.NULL=new ti,n.\u0275prov=$t({token:n,providedIn:"any",factory:()=>_t(ei)}),n.__NG_ELEMENT_ID__=-1,n})();function hP(n,e){Js(Pm(n)[1],si())}function li(n){let e=function(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let o;if(ts(n))o=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");o=e.\u0275dir}if(o){if(t){r.push(o);const p=n;p.inputs=R1(n.inputs),p.declaredInputs=R1(n.declaredInputs),p.outputs=R1(n.outputs);const w=o.hostBindings;w&&pP(n,w);const T=o.viewQuery,L=o.contentQueries;if(T&&AP(n,T),L&&fP(n,L),_a(n.inputs,o.inputs),_a(n.declaredInputs,o.declaredInputs),_a(n.outputs,o.outputs),ts(o)&&o.data.animation){const U=n.data;U.animation=(U.animation||[]).concat(o.data.animation)}}const c=o.features;if(c)for(let p=0;p<c.length;p++){const w=c[p];w&&w.ngInherit&&w(n),w===li&&(t=!1)}}e=Object.getPrototypeOf(e)}!function(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const o=n[r];o.hostVars=e+=o.hostVars,o.hostAttrs=ce(o.hostAttrs,t=ce(t,o.hostAttrs))}}(r)}function R1(n){return n===Yo?{}:n===Zn?[]:n}function AP(n,e){const t=n.viewQuery;n.viewQuery=t?(r,o)=>{e(r,o),t(r,o)}:e}function fP(n,e){const t=n.contentQueries;n.contentQueries=t?(r,o,c)=>{e(r,o,c),t(r,o,c)}:e}function pP(n,e){const t=n.hostBindings;n.hostBindings=t?(r,o)=>{e(r,o),t(r,o)}:e}let T_=null;function up(){if(!T_){const n=lr.Symbol;if(n&&n.iterator)T_=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(T_=r)}}}return T_}class ql{constructor(e){this.wrapped=e}static wrap(e){return new ql(e)}static unwrap(e){return ql.isWrapped(e)?e.wrapped:e}static isWrapped(e){return e instanceof ql}}function yg(n){return!!F1(n)&&(Array.isArray(n)||!(n instanceof Map)&&up()in n)}function F1(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Qc(n,e,t){return n[e]=t}function ls(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function IA(n,e,t,r){const o=ls(n,e,t);return ls(n,e+1,r)||o}function jo(n,e,t,r,o,c,p,w){const T=ct(),L=Wn(),U=n+20,W=L.firstCreatePass?function(n,e,t,r,o,c,p,w,T){const L=e.consts,U=Ra(e,n,4,p||null,ws(L,w));N(e,t,U,ws(L,T)),Js(e,U);const W=U.tViews=MA(2,U,r,o,c,e.directiveRegistry,e.pipeRegistry,null,e.schemas,L);return null!==e.queries&&(e.queries.template(e,U),W.queries=e.queries.embeddedTView(U)),U}(U,L,T,e,t,r,o,c,p):L.data[U];Cs(W,!1);const K=T[11].createComment("");Uc(L,T,K,W),oo(K,T),Dn(T,T[U]=it(K,T,K,W)),Mu(W)&&sp(L,T,W),null!=p&&ap(T,W,w)}function at(n,e=Qt.Default){const t=ct();return null===t?_t(n,e):wr(si(),t,ne(n),e)}function or(n,e,t){const r=ct();return ls(r,Fl(),e)&&l(Wn(),Vr(),r,n,e,r[11],t,!1),or}function z1(n,e,t,r,o){const p=o?"class":"style";dr(n,t,e.inputs[p],p,r)}function Ht(n,e,t,r){const o=ct(),c=Wn(),p=20+n,w=o[11],T=o[p]=Gf(w,e,sn.lFrame.currentNamespace),L=c.firstCreatePass?function(n,e,t,r,o,c,p){const w=e.consts,L=Ra(e,n,2,o,ws(w,c));return N(e,t,L,ws(w,p)),null!==L.attrs&&Mr(L,L.attrs,!1),null!==L.mergedAttrs&&Mr(L,L.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,L),L}(p,c,o,0,e,t,r):c.data[p];Cs(L,!0);const U=L.mergedAttrs;null!==U&&J(w,T,U);const W=L.classes;null!==W&&Jm(w,T,W);const K=L.styles;null!==K&&a_(w,T,K),64!=(64&L.flags)&&Uc(c,o,T,L),0===sn.lFrame.elementDepthCount&&oo(T,o),sn.lFrame.elementDepthCount++,Mu(L)&&(sp(c,o,L),qc(c,L,o)),null!==r&&ap(o,L)}function qt(){let n=si();Oh()?Rl():(n=n.parent,Cs(n,!1));const e=n;sn.lFrame.elementDepthCount--;const t=Wn();t.firstCreatePass&&(Js(t,n),Xa(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(e)&&z1(t,e,ct(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(e)&&z1(t,e,ct(),e.stylesWithoutHost,!1)}function kA(n,e,t,r){Ht(n,e,t,r),qt()}function P_(n,e,t){const r=ct(),o=Wn(),c=n+20,p=o.firstCreatePass?function(n,e,t,r,o){const c=e.consts,p=ws(c,r),w=Ra(e,n,8,"ng-container",p);return null!==p&&Mr(w,p,!0),N(e,t,w,ws(c,o)),null!==e.queries&&e.queries.elementStart(e,w),w}(c,o,r,e,t):o.data[c];Cs(p,!0);const w=r[c]=r[11].createComment("");Uc(o,r,w,p),oo(w,r),Mu(p)&&(sp(o,r,p),qc(o,p,r)),null!=t&&ap(r,p)}function R_(){let n=si();const e=Wn();Oh()?Rl():(n=n.parent,Cs(n,!1)),e.firstCreatePass&&(Js(e,n),Xa(n)&&e.queries.elementEnd(n))}function xp(){return ct()}function xg(n){return!!n&&"function"==typeof n.then}const F_=function(n){return!!n&&"function"==typeof n.subscribe};function qi(n,e,t,r){const o=ct(),c=Wn(),p=si();return function(n,e,t,r,o,c,p,w){const T=Mu(r),U=n.firstCreatePass&&Zr(n),W=e[8],K=Bi(e);let ie=!0;if(3&r.type||w){const Re=eo(r,e),Je=w?w(Re):Re,He=K.length,Rt=w?Zt=>w(oi(Zt[r.index])):r.index;if(qr(t)){let Zt=null;if(!w&&T&&(Zt=function(n,e,t,r){const o=n.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const p=o[c];if(p===t&&o[c+1]===r){const w=e[7],T=o[c+2];return w.length>T?w[T]:null}"string"==typeof p&&(c+=2)}return null}(n,e,o,r.index)),null!==Zt)(Zt.__ngLastListenerFn__||Zt).__ngNextListenerFn__=c,Zt.__ngLastListenerFn__=c,ie=!1;else{c=V1(r,e,W,c,!1);const kn=t.listen(Je,o,c);K.push(c,kn),U&&U.push(o,Rt,He,He+1)}}else c=V1(r,e,W,c,!0),Je.addEventListener(o,c,p),K.push(c),U&&U.push(o,Rt,He,p)}else c=V1(r,e,W,c,!1);const fe=r.outputs;let Ve;if(ie&&null!==fe&&(Ve=fe[o])){const Re=Ve.length;if(Re)for(let Je=0;Je<Re;Je+=2){const Xi=e[Ve[Je]][Ve[Je+1]].subscribe(c),$o=K.length;K.push(c,Xi),U&&U.push(o,r.index,$o,-($o+1))}}}(c,o,o[11],p,n,e,!!t,r),qi}function rC(n,e,t,r){try{return!1!==t(r)}catch(o){return Si(n,o),!1}}function V1(n,e,t,r,o){return function c(p){if(p===Function)return r;const w=2&n.flags?Mo(n.index,e):e;0==(32&e[2])&&Ut(w);let T=rC(e,0,r,p),L=c.__ngNextListenerFn__;for(;L;)T=rC(e,0,L,p)&&T,L=L.__ngNextListenerFn__;return o&&!1===T&&(p.preventDefault(),p.returnValue=!1),T}}function Zi(n=1){return function(n){return(sn.lFrame.contextLView=function(n,e){for(;n>0;)e=e[15],n--;return e}(n,sn.lFrame.contextLView))[8]}(n)}function YP(n,e){let t=null;const r=function(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(n);for(let o=0;o<e.length;o++){const c=e[o];if("*"!==c){if(null===r?jl(n,c,!0):tg(r,c))return o}else t=o}return t}function AC(n,e,t,r,o){const c=n[t+1],p=null===e;let w=r?ao(c):oa(c),T=!1;for(;0!==w&&(!1===T||p);){const U=n[w+1];eR(n[w],e)&&(T=!0,n[w+1]=r?ig(U):ep(U)),w=r?ao(U):oa(U)}T&&(n[t+1]=r?ep(c):ig(c))}function eR(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&ta(n,e)>=0}const vo={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function fC(n){return n.substring(vo.key,vo.keyEnd)}function tR(n){return n.substring(vo.value,vo.valueEnd)}function mC(n,e){const t=vo.textEnd;let r=vo.key=bp(n,e,t);return t===r?-1:(r=vo.keyEnd=function(n,e,t){let r;for(;e<t&&(45===(r=n.charCodeAt(e))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)e++;return e}(n,r,t),r=_C(n,r,t),r=vo.value=bp(n,r,t),r=vo.valueEnd=function(n,e,t){let r=-1,o=-1,c=-1,p=e,w=p;for(;p<t;){const T=n.charCodeAt(p++);if(59===T)return w;34===T||39===T?w=p=yC(n,T,p,t):e===p-4&&85===c&&82===o&&76===r&&40===T?w=p=yC(n,41,p,t):T>32&&(w=p),c=o,o=r,r=-33&T}return w}(n,r,t),_C(n,r,t))}function bp(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function _C(n,e,t,r){return(e=bp(n,e,t))<t&&e++,e}function yC(n,e,t,r){let o=-1,c=t;for(;c<r;){const p=n.charCodeAt(c++);if(p==e&&92!==o)return c;o=92==p&&92===o?0:p}throw new Error}function O_(n,e,t){return Zl(n,e,t,!1),O_}function bg(n,e){return Zl(n,e,null,!0),bg}function al(n){!function(n,e,t,r){const o=Wn(),c=Ks(2);o.firstUpdatePass&&xC(o,null,c,r);const p=ct();if(t!==hn&&ls(p,c,t)){const w=o.data[wi()];if(EC(w,r)&&!vC(o,c)){let T=r?w.classesWithoutHost:w.stylesWithoutHost;null!==T&&(t=ya(T,t||"")),z1(o,w,p,t,r)}else!function(n,e,t,r,o,c,p,w){o===hn&&(o=Zn);let T=0,L=0,U=0<o.length?o[0]:null,W=0<c.length?c[0]:null;for(;null!==U||null!==W;){const K=T<o.length?o[T+1]:void 0,ie=L<c.length?c[L+1]:void 0;let Ve,fe=null;U===W?(T+=2,L+=2,K!==ie&&(fe=W,Ve=ie)):null===W||null!==U&&U<W?(T+=2,fe=U):(L+=2,fe=W,Ve=ie),null!==fe&&wC(n,e,t,r,fe,Ve,p,w),U=T<o.length?o[T]:null,W=L<c.length?c[L]:null}}(o,w,p,p[11],p[c+1],p[c+1]=function(n,e,t){if(null==t||""===t)return Zn;const r=[],o=Ts(t);if(Array.isArray(o))for(let c=0;c<o.length;c++)n(r,o[c],!0);else if("object"==typeof o)for(const c in o)o.hasOwnProperty(c)&&n(r,c,o[c]);else"string"==typeof o&&e(r,o);return r}(n,e,t),r,c)}}(bC,aR,n,!1)}function aR(n,e){for(let t=function(n){return function(n){vo.key=0,vo.keyEnd=0,vo.value=0,vo.valueEnd=0,vo.textEnd=n.length}(n),mC(n,bp(n,0,vo.textEnd))}(e);t>=0;t=mC(e,t))bC(n,fC(e),tR(e))}function Zl(n,e,t,r){const o=ct(),c=Wn(),p=Ks(2);c.firstUpdatePass&&xC(c,n,p,r),e!==hn&&ls(o,p,e)&&wC(c,c.data[wi()],o,o[11],n,o[p+1]=function(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=ln(Ts(n)))),n}(e,t),r,p)}function vC(n,e){return e>=n.expandoStartIndex}function xC(n,e,t,r){const o=n.data;if(null===o[t+1]){const c=o[wi()],p=vC(n,t);EC(c,r)&&null===e&&!p&&(e=!1),e=function(n,e,t,r){const o=function(n){const e=sn.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let c=r?e.residualClasses:e.residualStyles;if(null===o)0===(r?e.classBindings:e.styleBindings)&&(t=wg(t=$1(null,n,e,t,r),e.attrs,r),c=null);else{const p=e.directiveStylingLast;if(-1===p||n[p]!==o)if(t=$1(o,n,e,t,r),null===c){let T=function(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==oa(r))return n[ao(r)]}(n,e,r);void 0!==T&&Array.isArray(T)&&(T=$1(null,n,e,T[1],r),T=wg(T,e.attrs,r),function(n,e,t,r){n[ao(t?e.classBindings:e.styleBindings)]=r}(n,e,r,T))}else c=function(n,e,t){let r;const o=e.directiveEnd;for(let c=1+e.directiveStylingLast;c<o;c++)r=wg(r,n[c].hostAttrs,t);return wg(r,e.attrs,t)}(n,e,r)}return void 0!==c&&(r?e.residualClasses=c:e.residualStyles=c),t}(o,c,e,r),function(n,e,t,r,o,c){let p=c?e.classBindings:e.styleBindings,w=ao(p),T=oa(p);n[r]=t;let U,L=!1;if(Array.isArray(t)){const W=t;U=W[1],(null===U||ta(W,U)>0)&&(L=!0)}else U=t;if(o)if(0!==T){const K=ao(n[w+1]);n[r+1]=Yh(K,w),0!==K&&(n[K+1]=rg(n[K+1],r)),n[w+1]=function(n,e){return 131071&n|e<<17}(n[w+1],r)}else n[r+1]=Yh(w,0),0!==w&&(n[w+1]=rg(n[w+1],r)),w=r;else n[r+1]=Yh(T,0),0===w?w=r:n[T+1]=rg(n[T+1],r),T=r;L&&(n[r+1]=ep(n[r+1])),AC(n,U,r,!0),AC(n,U,r,!1),function(n,e,t,r,o){const c=o?n.residualClasses:n.residualStyles;null!=c&&"string"==typeof e&&ta(c,e)>=0&&(t[r+1]=ig(t[r+1]))}(e,U,n,r,c),p=Yh(w,T),c?e.classBindings=p:e.styleBindings=p}(o,c,e,t,p,r)}}function $1(n,e,t,r,o){let c=null;const p=t.directiveEnd;let w=t.directiveStylingLast;for(-1===w?w=t.directiveStart:w++;w<p&&(c=e[w],r=wg(r,c.hostAttrs,o),c!==n);)w++;return null!==n&&(t.directiveStylingLast=w),r}function wg(n,e,t){const r=t?1:2;let o=-1;if(null!==e)for(let c=0;c<e.length;c++){const p=e[c];"number"==typeof p?o=p:o===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Ri(n,p,!!t||e[++c]))}return void 0===n?null:n}function bC(n,e,t){Ri(n,e,Ts(t))}function wC(n,e,t,r,o,c,p,w){if(!(3&e.type))return;const T=n.data,L=T[w+1];L_(function(n){return 1==(1&n)}(L)?CC(T,e,t,o,oa(L),p):void 0)||(L_(c)||function(n){return 2==(2&n)}(L)&&(c=CC(T,null,t,o,w,p)),function(n,e,t,r,o){const c=qr(n);if(e)o?c?n.addClass(t,r):t.classList.add(r):c?n.removeClass(t,r):t.classList.remove(r);else{let p=-1===r.indexOf("-")?void 0:Is.DashCase;if(null==o)c?n.removeStyle(t,r,p):t.style.removeProperty(r);else{const w="string"==typeof o&&o.endsWith("!important");w&&(o=o.slice(0,-10),p|=Is.Important),c?n.setStyle(t,r,o,p):t.style.setProperty(r,o,w?"important":"")}}}(r,p,wc(wi(),t),o,c))}function CC(n,e,t,r,o,c){const p=null===e;let w;for(;o>0;){const T=n[o],L=Array.isArray(T),U=L?T[1]:T,W=null===U;let K=t[o+1];K===hn&&(K=W?Zn:void 0);let ie=W?Ta(K,r):U===r?K:void 0;if(L&&!L_(ie)&&(ie=Ta(T,r)),L_(ie)&&(w=ie,p))return w;const fe=n[o+1];o=p?ao(fe):oa(fe)}if(null!==e){let T=c?e.residualClasses:e.residualStyles;null!=T&&(w=Ta(T,r))}return w}function L_(n){return void 0!==n}function EC(n,e){return 0!=(n.flags&(e?16:32))}function Wr(n,e=""){const t=ct(),r=Wn(),o=n+20,c=r.firstCreatePass?Ra(r,o,1,e,null):r.data[o],p=t[o]=function(n,e){return qr(n)?n.createText(e):n.createTextNode(e)}(t[11],e);Uc(r,t,p,c),Cs(c,!1)}function H1(n){return ll("",n,""),H1}function ll(n,e,t){const r=ct(),o=function(n,e,t,r){return ls(n,Fl(),t)?e+we(t)+r:hn}(r,n,e,t);return o!==hn&&Kr(r,wi(),o),ll}function q1(n,e,t,r,o){const c=ct(),p=function(n,e,t,r,o,c){const w=IA(n,Es(),t,o);return Ks(2),w?e+we(t)+r+we(o)+c:hn}(c,n,e,t,r,o);return p!==hn&&Kr(c,wi(),p),q1}function B_(n,e,t){const r=ct();return ls(r,Fl(),e)&&l(Wn(),Vr(),r,n,e,r[11],t,!0),B_}const PA=void 0;var OR=["en",[["a","p"],["AM","PM"],PA],[["AM","PM"],PA,PA],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],PA,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],PA,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",PA,"{1} 'at' {0}",PA],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const e=Math.floor(Math.abs(n)),t=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===t?1:5}];let wp={};function Ls(n){const e=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=$C(e);if(t)return t;const r=e.split("-")[0];if(t=$C(r),t)return t;if("en"===r)return OR;throw new Error(`Missing locale data for the locale "${n}".`)}function $C(n){return n in wp||(wp[n]=lr.ng&&lr.ng.common&&lr.ng.common.locales&&lr.ng.common.locales[n]),wp[n]}var Bt=(()=>((Bt=Bt||{})[Bt.LocaleId=0]="LocaleId",Bt[Bt.DayPeriodsFormat=1]="DayPeriodsFormat",Bt[Bt.DayPeriodsStandalone=2]="DayPeriodsStandalone",Bt[Bt.DaysFormat=3]="DaysFormat",Bt[Bt.DaysStandalone=4]="DaysStandalone",Bt[Bt.MonthsFormat=5]="MonthsFormat",Bt[Bt.MonthsStandalone=6]="MonthsStandalone",Bt[Bt.Eras=7]="Eras",Bt[Bt.FirstDayOfWeek=8]="FirstDayOfWeek",Bt[Bt.WeekendRange=9]="WeekendRange",Bt[Bt.DateFormat=10]="DateFormat",Bt[Bt.TimeFormat=11]="TimeFormat",Bt[Bt.DateTimeFormat=12]="DateTimeFormat",Bt[Bt.NumberSymbols=13]="NumberSymbols",Bt[Bt.NumberFormats=14]="NumberFormats",Bt[Bt.CurrencyCode=15]="CurrencyCode",Bt[Bt.CurrencySymbol=16]="CurrencySymbol",Bt[Bt.CurrencyName=17]="CurrencyName",Bt[Bt.Currencies=18]="Currencies",Bt[Bt.Directionality=19]="Directionality",Bt[Bt.PluralCase=20]="PluralCase",Bt[Bt.ExtraData=21]="ExtraData",Bt))();const N_="en-US";let HC=N_;function Z1(n){Wt(n,"Expected localeId to be defined"),"string"==typeof n&&(HC=n.toLowerCase().replace(/_/g,"-"))}function X1(n,e,t,r,o){if(n=ne(n),Array.isArray(n))for(let c=0;c<n.length;c++)X1(n[c],e,t,r,o);else{const c=Wn(),p=ct();let w=Jh(n)?n:ne(n.provide),T=Kh(n);const L=si(),U=1048575&L.providerIndexes,W=L.directiveStart,K=L.providerIndexes>>20;if(Jh(n)||!n.multi){const ie=new v(T,o,at),fe=K1(w,e,o?U:U+K,W);-1===fe?(Mt(xt(L,p),c,w),Y1(c,n,e.length),e.push(w),L.directiveStart++,L.directiveEnd++,o&&(L.providerIndexes+=1048576),t.push(ie),p.push(ie)):(t[fe]=ie,p[fe]=ie)}else{const ie=K1(w,e,U+K,W),fe=K1(w,e,U,U+K),Ve=ie>=0&&t[ie],Re=fe>=0&&t[fe];if(o&&!Re||!o&&!Ve){Mt(xt(L,p),c,w);const Je=function(n,e,t,r,o){const c=new v(n,t,at);return c.multi=[],c.index=e,c.componentProviders=0,pE(c,o,r&&!t),c}(o?P3:k3,t.length,o,r,T);!o&&Re&&(t[fe].providerFactory=Je),Y1(c,n,e.length,0),e.push(w),L.directiveStart++,L.directiveEnd++,o&&(L.providerIndexes+=1048576),t.push(Je),p.push(Je)}else Y1(c,n,ie>-1?ie:fe,pE(t[o?fe:ie],T,!o&&r));!o&&r&&Re&&t[fe].componentProviders++}}}function Y1(n,e,t,r){const o=Jh(e);if(o||function(n){return!!n.useClass}(e)){const p=(e.useClass||e).prototype.ngOnDestroy;if(p){const w=n.destroyHooks||(n.destroyHooks=[]);if(!o&&e.multi){const T=w.indexOf(t);-1===T?w.push(t,[r,p]):w[T+1].push(r,p)}else w.push(t,p)}}}function pE(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function K1(n,e,t,r){for(let o=t;o<r;o++)if(e[o]===n)return o;return-1}function k3(n,e,t,r){return J1(this.multi,[])}function P3(n,e,t,r){const o=this.multi;let c;if(this.providerFactory){const p=this.providerFactory.componentProviders,w=Io(t,t[1],this.providerFactory.index,r);c=w.slice(0,p),J1(o,c);for(let T=p;T<w.length;T++)c.push(w[T])}else c=[],J1(o,c);return c}function J1(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function ci(n,e=[]){return t=>{t.providersResolver=(r,o)=>function(n,e,t){const r=Wn();if(r.firstCreatePass){const o=ts(n);X1(t,r.data,r.blueprint,o,!0),X1(e,r.data,r.blueprint,o,!1)}}(r,o?o(n):n,e)}}class mE{}const _E="ngComponent";class O3{resolveComponentFactory(e){throw function(n){const e=Error(`No component factory found for ${ln(n)}. Did you add it to @NgModule.entryComponents?`);return e[_E]=n,e}(e)}}let RA=(()=>{class n{}return n.NULL=new O3,n})();function G_(...n){}function Ep(n,e){return new Wi(eo(n,e))}const N3=function(){return Ep(si(),ct())};let Wi=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=N3,n})();function yE(n){return n instanceof Wi?n.nativeElement:n}class $_{}let oh=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>V3(),n})();const V3=function(){const n=ct(),t=Mo(si().index,n);return function(n){return n[11]}(bs(t)?t:n)};let tx=(()=>{class n{}return n.\u0275prov=$t({token:n,providedIn:"root",factory:()=>null}),n})();class Mg{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const vE=new Mg("12.2.12");class xE{constructor(){}supports(e){return yg(e)}create(e){return new $3(e)}}const G3=(n,e)=>e;class $3{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||G3}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,o=0,c=null;for(;t||r;){const p=!r||t&&t.currentIndex<wE(r,o,c)?t:r,w=wE(p,o,c),T=p.currentIndex;if(p===r)o--,r=r._nextRemoved;else if(t=t._next,null==p.previousIndex)o++;else{c||(c=[]);const L=w-o,U=T-o;if(L!=U){for(let K=0;K<L;K++){const ie=K<c.length?c[K]:c[K]=0,fe=ie+K;U<=fe&&fe<L&&(c[K]=ie+1)}c[p.previousIndex]=U-L}}w!==T&&e(p,w,T)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!yg(e))throw new Error(`Error trying to diff '${ln(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let o,c,p,t=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let w=0;w<this.length;w++)c=e[w],p=this._trackByFn(w,c),null!==t&&Object.is(t.trackById,p)?(r&&(t=this._verifyReinsertion(t,c,p,w)),Object.is(t.item,c)||this._addIdentityChange(t,c)):(t=this._mismatch(t,c,p,w),r=!0),t=t._next}else o=0,function(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[up()]();let r;for(;!(r=t.next()).done;)e(r.value)}}(e,w=>{p=this._trackByFn(o,w),null!==t&&Object.is(t.trackById,p)?(r&&(t=this._verifyReinsertion(t,w,p,o)),Object.is(t.item,w)||this._addIdentityChange(t,w)):(t=this._mismatch(t,w,p,o),r=!0),t=t._next,o++}),this.length=o;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,o){let c;return null===e?c=this._itTail:(c=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,c,o)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,c,o)):e=this._addAfter(new H3(t,r),c,o),e}_verifyReinsertion(e,t,r,o){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==c?e=this._reinsertAfter(c,e._prev,o):e.currentIndex!=o&&(e.currentIndex=o,this._addToMoves(e,o)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const o=e._prevRemoved,c=e._nextRemoved;return null===o?this._removalsHead=c:o._nextRemoved=c,null===c?this._removalsTail=o:c._prevRemoved=o,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){const o=null===t?this._itHead:t._next;return e._next=o,e._prev=t,null===o?this._itTail=e:o._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new bE),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new bE),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class H3{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class q3{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}class bE{constructor(){this.map=new Map}put(e){const t=e.trackById;let r=this.map.get(t);r||(r=new q3,this.map.set(t,r)),r.add(e)}get(e,t){const o=this.map.get(e);return o?o.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function wE(n,e,t){const r=n.previousIndex;if(null===r)return r;let o=0;return t&&r<t.length&&(o=t[r]),r+e+o}class CE{constructor(){}supports(e){return e instanceof Map||F1(e)}create(){return new Z3}}class Z3{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||F1(e)))throw new Error(`Error trying to diff '${ln(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,o)=>{if(t&&t.key===o)this._maybeAddToChanges(t,r),this._appendAfter=t,t=t._next;else{const c=this._getOrCreateRecordForKey(o,r);t=this._insertBeforeOrAppend(t,c)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let r=t;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const o=this._records.get(e);this._maybeAddToChanges(o,t);const c=o._prev,p=o._next;return c&&(c._next=p),p&&(p._prev=c),o._next=null,o._prev=null,o}const r=new W3(e);return this._records.set(e,r),r.currentValue=t,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(r=>t(e[r],r))}}class W3{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function EE(){return new Tg([new xE])}let Tg=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(null!=r){const o=r.factories.slice();t=t.concat(o)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||EE()),deps:[[n,new Ei,new rs]]}}find(t){const r=this.factories.find(o=>o.supports(t));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'`)}}return n.\u0275prov=$t({token:n,providedIn:"root",factory:EE}),n})();function DE(){return new Dp([new CE])}let Dp=(()=>{class n{constructor(t){this.factories=t}static create(t,r){if(r){const o=r.factories.slice();t=t.concat(o)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||DE()),deps:[[n,new Ei,new rs]]}}find(t){const r=this.factories.find(o=>o.supports(t));if(r)return r;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return n.\u0275prov=$t({token:n,providedIn:"root",factory:DE}),n})();function H_(n,e,t,r,o=!1){for(;null!==t;){const c=e[t.index];if(null!==c&&r.push(oi(c)),No(c))for(let w=10;w<c.length;w++){const T=c[w],L=T[1].firstChild;null!==L&&H_(T[1],T,L,r)}const p=t.type;if(8&p)H_(n,e,t.child,r);else if(32&p){const w=Um(t,e);let T;for(;T=w();)r.push(T)}else if(16&p){const w=Km(e,t);if(Array.isArray(w))r.push(...w);else{const T=pA(e[16]);H_(T[1],T,w,r,!0)}}t=o?t.projectionNext:t.next}return r}class Ig{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return H_(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(No(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(Hf(e,r),Pc(t,r))}this._attachedToViewContainer=!1}e_(this._lView[1],this._lView)}onDestroy(e){lp(this._lView[1],this._lView,null,e)}markForCheck(){Ut(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Di(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,e,t){tl(!0);try{Di(n,e,t)}finally{tl(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,e){jc(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class X3 extends Ig{constructor(e){super(e),this._view=e}detectChanges(){jr(this._view)}checkNoChanges(){!function(n){tl(!0);try{jr(n)}finally{tl(!1)}}(this._view)}get context(){return null}}const K3=function(n){return function(n,e,t){if(Sh(n)&&!t){const r=Mo(n.index,e);return new Ig(r,r)}return 47&n.type?new Ig(e[16],e):null}(si(),ct(),16==(16&n))};let nx=(()=>{class n{}return n.__NG_ELEMENT_ID__=K3,n})();const tF=[new CE],rF=new Tg([new xE]),iF=new Dp(tF),sF=function(){return q_(si(),ct())};let sh=(()=>{class n{}return n.__NG_ELEMENT_ID__=sF,n})();const aF=sh,lF=class extends aF{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=EA(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(r[19]=c.createEmbeddedView(t)),is(t,r,e),new Ig(r)}};function q_(n,e){return 4&n.type?new lF(e,n,Ep(n,e)):null}class Kc{}class SE{}const hF=function(){return IE(si(),ct())};let Ql=(()=>{class n{}return n.__NG_ELEMENT_ID__=hF,n})();const AF=Ql,ME=class extends AF{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return Ep(this._hostTNode,this._hostLView)}get injector(){return new ko(this._hostTNode,this._hostLView)}get parentInjector(){const e=dt(this._hostTNode,this._hostLView);if(se(e)){const t=ve(e,this._hostLView),r=ue(e);return new ko(t[1].data[r+8],t)}return new ko(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=TE(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){const o=e.createEmbeddedView(t||{});return this.insert(o,r),o}createComponent(e,t,r,o,c){const p=r||this.parentInjector;if(!c&&null==e.ngModule&&p){const T=p.get(Kc,null);T&&(c=T)}const w=e.create(p,o,void 0,c);return this.insert(w.hostView,t),w}insert(e,t){const r=e._lView,o=r[1];if(function(n){return No(n[3])}(r)){const U=this.indexOf(e);if(-1!==U)this.detach(U);else{const W=r[3],K=new ME(W,W[6],W[3]);K.detach(K.indexOf(e))}}const c=this._adjustIndex(t),p=this._lContainer;!function(n,e,t,r){const o=10+r,c=t.length;r>0&&(t[o-1][4]=e),r<c-10?(e[4]=t[o],Xd(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const p=e[17];null!==p&&t!==p&&function(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(p,e);const w=e[19];null!==w&&w.insertView(n),e[2]|=128}(o,r,p,c);const w=yA(c,p),T=r[11],L=gA(T,p[7]);return null!==L&&function(n,e,t,r,o,c){r[0]=o,r[6]=e,jc(n,r,t,1,o,c)}(o,p[6],T,r,L,w),e.attachToViewContainerRef(),Xd(rx(p),c,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=TE(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=Hf(this._lContainer,t);r&&(Pc(rx(this._lContainer),t),e_(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=Hf(this._lContainer,t);return r&&null!=Pc(rx(this._lContainer),t)?new Ig(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function TE(n){return n[8]}function rx(n){return n[8]||(n[8]=[])}function IE(n,e){let t;const r=e[n.index];if(No(r))t=r;else{let o;if(8&n.type)o=oi(r);else{const c=e[11];o=c.createComment("");const p=eo(n,e);Ku(c,gA(c,p),o,function(n,e){return qr(n)?n.nextSibling(e):e.nextSibling}(c,p),!1)}e[n.index]=t=it(r,e,o,n),Dn(e,t)}return new ME(t,n,e)}const Ip={};class XE extends RA{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Pi(e);return new KE(t,this.ngModule)}}function YE(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}const cO=new nn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Bm});class KE extends mE{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function(n){return n.map(_1).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return YE(this.componentDef.inputs)}get outputs(){return YE(this.componentDef.outputs)}create(e,t,r,o){const c=(o=o||this.ngModule)?function(n,e){return{get:(t,r,o)=>{const c=n.get(t,Ip,o);return c!==Ip||r===Ip?c:e.get(t,r,o)}}}(e,o.injector):e,p=c.get($_,Ja),w=c.get(tx,null),T=p.createRenderer(null,this.componentDef),L=this.componentDef.selectors[0][0]||"div",U=r?function(n,e,t){if(qr(n))return n.selectRootElement(e,t===gr.ShadowDom);let r="string"==typeof e?n.querySelector(e):e;return r.textContent="",r}(T,r,this.componentDef.encapsulation):Gf(p.createRenderer(null,this.componentDef),L,function(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(L)),W=this.componentDef.onPush?576:528,K=function(n,e){return{components:[],scheduler:n||Bm,clean:hr,playerHandler:e||null,flags:0}}(),ie=MA(0,null,null,1,0,null,null,null,null,null),fe=EA(null,ie,K,W,null,null,p,T,w,c);let Ve,Re;Ll(fe);try{const Je=function(n,e,t,r,o,c){const p=t[1];t[20]=n;const T=Ra(p,20,2,"#host",null),L=T.mergedAttrs=e.hostAttrs;null!==L&&(Mr(T,L,!0),null!==n&&(J(o,n,L),null!==T.classes&&Jm(o,n,T.classes),null!==T.styles&&a_(o,n,T.styles)));const U=r.createRenderer(n,e),W=EA(t,SA(e),null,e.onPush?64:16,t[20],T,r,U,c||null,null);return p.firstCreatePass&&(Mt(xt(T,t),p,e.type),xe(p,T),Be(T,t.length,1)),Dn(t,W),t[20]=W}(U,this.componentDef,fe,p,T);if(U)if(r)J(T,U,["ng-version",vE.full]);else{const{attrs:He,classes:Rt}=function(n){const e=[],t=[];let r=1,o=2;for(;r<n.length;){let c=n[r];if("string"==typeof c)2===o?""!==c&&e.push(c,n[++r]):8===o&&t.push(c);else{if(!Ps(o))break;o=c}r++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);He&&J(T,U,He),Rt&&Rt.length>0&&Jm(T,U,Rt.join(" "))}if(Re=to(ie,20),void 0!==t){const He=Re.projection=[];for(let Rt=0;Rt<this.ngContentSelectors.length;Rt++){const Zt=t[Rt];He.push(null!=Zt?Array.from(Zt):null)}}Ve=function(n,e,t,r,o){const c=t[1],p=function(n,e,t){const r=si();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),Ne(n,r,e,$c(n,e,1,null),t));const o=Io(e,n,r.directiveStart,r);oo(o,e);const c=eo(r,e);return c&&oo(c,e),o}(c,t,e);if(r.components.push(p),n[8]=p,o&&o.forEach(T=>T(p,e)),e.contentQueries){const T=si();e.contentQueries(1,p,T.directiveStart)}const w=si();return!c.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Ma(w.index),V(t[1],w,0,w.directiveStart,w.directiveEnd,e),oe(e,p)),p}(Je,this.componentDef,fe,K,[hP]),is(ie,fe,null)}finally{zu()}return new dO(this.componentType,Ve,Ep(Re,fe),fe,Re)}}class dO extends class{}{constructor(e,t,r,o,c){super(),this.location=r,this._rootLView=o,this._tNode=c,this.instance=t,this.hostView=this.changeDetectorRef=new X3(o),this.componentType=e}get injector(){return new ko(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const kp=new Map;class pO extends Kc{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new XE(this);const r=Do(e),o=function(n){return n[Td]||null}(e);o&&Z1(o),this._bootstrapComponents=Pa(r.bootstrap),this._r3Injector=Oa(e,t,[{provide:Kc,useValue:this},{provide:RA,useValue:this.componentFactoryResolver}],ln(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=Ir.THROW_IF_NOT_FOUND,r=Qt.Default){return e===Ir||e===Kc||e===ei?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class mx extends SE{constructor(e){super(),this.moduleType=e,null!==Do(e)&&function(n){const e=new Set;!function t(r){const o=Do(r,!0),c=o.id;null!==c&&(function(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${ln(e)} vs ${ln(e.name)}`)}(c,kp.get(c),r),kp.set(c,r));const p=Pa(o.imports);for(const w of p)e.has(w)||(e.add(w),t(w))}(n)}(e)}create(e){return new pO(this.moduleType,e)}}function tD(n,e,t,r){return function(n,e,t,r,o,c){const p=e+t;return ls(n,p,o)?Qc(n,p+1,c?r.call(c,o):r(o)):Ng(n,p+1)}(ct(),bi(),n,e,t,r)}function Ng(n,e){const t=n[e];return t===hn?void 0:t}function gx(n,e){const t=Wn();let r;const o=n+20;t.firstCreatePass?(r=function(n,e){if(e)for(let t=e.length-1;t>=0;t--){const r=e[t];if(n===r.name)return r}throw new ae("302",`The pipe '${n}' could not be found!`)}(e,t.pipeRegistry),t.data[o]=r,r.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(o,r.onDestroy)):r=t.data[o];const c=r.factory||(r.factory=kl(r.type)),p=va(at);try{const w=de(!1),T=c();return de(w),function(n,e,t,r){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=r}(t,ct(),o,T),T}finally{va(p)}}function _x(n,e,t,r){const o=n+20,c=ct(),p=function(n,e){return n[e]}(c,o);return function(n,e){ql.isWrapped(e)&&(e=ql.unwrap(e),n[Es()]=hn);return e}(c,function(n,e){return n[1].data[e].pure}(c,o)?function(n,e,t,r,o,c,p){const w=e+t;return IA(n,w,o,c)?Qc(n,w+2,p?r.call(p,o,c):r(o,c)):Ng(n,w+2)}(c,bi(),e,p.transform,t,r,p):p.transform(t,r))}function yx(n){return e=>{setTimeout(n,void 0,e)}}const tt=class extends _i{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var o,c,p;let w=e,T=t||(()=>null),L=r;if(e&&"object"==typeof e){const W=e;w=null===(o=W.next)||void 0===o?void 0:o.bind(W),T=null===(c=W.error)||void 0===c?void 0:c.bind(W),L=null===(p=W.complete)||void 0===p?void 0:p.bind(W)}this.__isAsync&&(T=yx(T),w&&(w=yx(w)),L&&(L=yx(L)));const U=super.subscribe({next:w,error:T,complete:L});return e instanceof wt&&e.add(U),U}};function kO(){return this._results[up()]()}class Y_{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=up(),r=Y_.prototype;r[t]||(r[t]=kO)}get changes(){return this._changes||(this._changes=new tt)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const o=Hi(e);(this._changesDetected=!function(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let o=n[r],c=e[r];if(t&&(o=t(o),c=t(c)),c!==o)return!1}return!0}(r._results,o,t))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class vx{constructor(e){this.queryList=e,this.matches=null}clone(){return new vx(this.queryList)}setDirty(){this.queryList.setDirty()}}class xx{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,o=[];for(let c=0;c<r;c++){const p=t.getByIndex(c);o.push(this.queries[p.indexInDeclarationView].clone())}return new xx(o)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==hD(e,t).matches&&this.queries[t].setDirty()}}class aD{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class bx{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const o=null!==t?t.length:0,c=this.getByIndex(r).embeddedTView(e,o);c&&(c.indexInDeclarationView=r,null!==t?t.push(c):t=[c])}return null!==t?new bx(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class wx{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new wx(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const c=r[o];this.matchTNodeWithReadOption(e,t,FO(t,c)),this.matchTNodeWithReadOption(e,t,go(t,e,c,!1,!1))}else r===sh?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,go(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===Wi||o===Ql||o===sh&&4&t.type)this.addMatch(t.index,-2);else{const c=go(t,e,o,!1,!1);null!==c&&this.addMatch(t.index,c)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function FO(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function LO(n,e,t,r){return-1===t?function(n,e){return 11&n.type?Ep(n,e):4&n.type?q_(n,e):null}(e,n):-2===t?function(n,e,t){return t===Wi?Ep(e,n):t===sh?q_(e,n):t===Ql?IE(e,n):void 0}(n,e,r):Io(n,n[1],t,e)}function lD(n,e,t,r){const o=e[19].queries[r];if(null===o.matches){const c=n.data,p=t.matches,w=[];for(let T=0;T<p.length;T+=2){const L=p[T];w.push(L<0?null:LO(e,c[L],p[T+1],t.metadata.read))}o.matches=w}return o.matches}function Cx(n,e,t,r){const o=n.queries.getByIndex(t),c=o.matches;if(null!==c){const p=lD(n,e,o,t);for(let w=0;w<c.length;w+=2){const T=c[w];if(T>0)r.push(p[w/2]);else{const L=c[w+1],U=e[-T];for(let W=10;W<U.length;W++){const K=U[W];K[17]===K[3]&&Cx(K[1],K,L,r)}if(null!==U[9]){const W=U[9];for(let K=0;K<W.length;K++){const ie=W[K];Cx(ie[1],ie,L,r)}}}}}return r}function Pp(n){const e=ct(),t=Wn(),r=Lh();Bu(r+1);const o=hD(t,r);if(n.dirty&&Pl(e)===(2==(2&o.metadata.flags))){if(null===o.matches)n.reset([]);else{const c=o.crossesNgTemplate?Cx(t,e,r,[]):lD(t,e,o,r);n.reset(c,yE),n.notifyOnChanges()}return!0}return!1}function Ex(n,e,t){const r=Wn();r.firstCreatePass&&(uD(r,new aD(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),cD(r,ct(),e)}function Rp(){return function(n,e){return n[19].queries[e].queryList}(ct(),Lh())}function cD(n,e,t){const r=new Y_(4==(4&t));lp(n,e,r,r.destroy),null===e[19]&&(e[19]=new xx),e[19].queries.push(new vx(r))}function uD(n,e,t){null===n.queries&&(n.queries=new bx),n.queries.track(new wx(e,t))}function hD(n,e){return n.queries.getByIndex(e)}const jg=new nn("Application Initializer");let Op=(()=>{class n{constructor(t){this.appInits=t,this.resolve=G_,this.reject=G_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const c=this.appInits[o]();if(xg(c))t.push(c);else if(F_(c)){const p=new Promise((w,T)=>{c.subscribe({complete:w,error:T})});t.push(p)}}Promise.all(t).then(()=>{r()}).catch(o=>{this.reject(o)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(_t(jg,8))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const Gg=new nn("AppId"),AL={provide:Gg,useFactory:function(){return`${kx()}${kx()}${kx()}`},deps:[]};function kx(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const TD=new nn("Platform Initializer"),ty=new nn("Platform ID"),ID=new nn("appBootstrapListener");let ny=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const ah=new nn("LocaleId"),kD=new nn("DefaultCurrencyCode");class pL{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const Px=function(n){return new mx(n)},mL=Px,gL=function(n){return Promise.resolve(Px(n))},PD=function(n){const e=Px(n),r=Pa(Do(n).declarations).reduce((o,c)=>{const p=Pi(c);return p&&o.push(new KE(p)),o},[]);return new pL(e,r)},_L=PD,yL=function(n){return Promise.resolve(PD(n))};let LA=(()=>{class n{constructor(){this.compileModuleSync=mL,this.compileModuleAsync=gL,this.compileModuleAndAllComponentsSync=_L,this.compileModuleAndAllComponentsAsync=yL}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const bL=(()=>Promise.resolve(0))();function Rx(n){"undefined"==typeof Zone?bL.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class mi{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tt(!1),this.onMicrotaskEmpty=new tt(!1),this.onStable=new tt(!1),this.onError=new tt(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&t,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function(){let n=lr.requestAnimationFrame,e=lr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(n){const e=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(lr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Ox(n),n.isCheckStableRunning=!0,Fx(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Ox(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,o,c,p,w)=>{try{return RD(n),t.invokeTask(o,c,p,w)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||n.shouldCoalesceRunChangeDetection)&&e(),FD(n)}},onInvoke:(t,r,o,c,p,w,T)=>{try{return RD(n),t.invoke(o,c,p,w,T)}finally{n.shouldCoalesceRunChangeDetection&&e(),FD(n)}},onHasTask:(t,r,o,c)=>{t.hasTask(o,c),r===o&&("microTask"==c.change?(n._hasPendingMicrotasks=c.microTask,Ox(n),Fx(n)):"macroTask"==c.change&&(n.hasPendingMacrotasks=c.macroTask))},onHandleError:(t,r,o,c)=>(t.handleError(o,c),n.runOutsideAngular(()=>n.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!mi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(mi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,o){const c=this._inner,p=c.scheduleEventTask("NgZoneEvent: "+o,e,CL,G_,G_);try{return c.runTask(p,t,r)}finally{c.cancelTask(p)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const CL={};function Fx(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Ox(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function RD(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function FD(n){n._nesting--,Fx(n)}class SL{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tt,this.onMicrotaskEmpty=new tt,this.onStable=new tt,this.onError=new tt}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,o){return e.apply(t,r)}}let Lx=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{mi.assertNotInAngularZone(),Rx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Rx(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,o){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==c),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:c,updateCb:o})}whenStable(t,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,r,o){return[]}}return n.\u0275fac=function(t){return new(t||n)(_t(mi))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),OD=(()=>{class n{constructor(){this._applications=new Map,Bx.addToWindow(this)}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return Bx.findTestabilityInTree(this,t,r)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();class ML{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let Bx=new ML,LD=!0,BD=!1;let Kl;const zD=new nn("AllowMultipleToken");class Nx{constructor(e,t){this.name=e,this.token=t}}function VD(n,e,t=[]){const r=`Platform: ${e}`,o=new nn(r);return(c=[])=>{let p=UD();if(!p||p.injector.get(zD,!1))if(n)n(t.concat(c).concat({provide:o,useValue:!0}));else{const w=t.concat(c).concat({provide:o,useValue:!0},{provide:Vn,useValue:"platform"});!function(n){if(Kl&&!Kl.destroyed&&!Kl.injector.get(zD,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Kl=n.get(jD);const e=n.get(TD,null);e&&e.forEach(t=>t())}(Ir.create({providers:w,name:r}))}return function(n){const e=UD();if(!e)throw new Error("No platform exists!");if(!e.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(o)}}function UD(){return Kl&&!Kl.destroyed?Kl:null}let jD=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const w=function(n,e){let t;return t="noop"===n?new SL:("zone.js"===n?void 0:n)||new mi({enableLongStackTrace:(BD=!0,LD),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),T=[{provide:mi,useValue:w}];return w.run(()=>{const L=Ir.create({providers:T,parent:this.injector,name:t.moduleType.name}),U=t.create(L),W=U.injector.get(Nc,null);if(!W)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return w.runOutsideAngular(()=>{const K=w.onError.subscribe({next:ie=>{W.handleError(ie)}});U.onDestroy(()=>{zx(this._modules,U),K.unsubscribe()})}),function(n,e,t){try{const r=t();return xg(r)?r.catch(o=>{throw e.runOutsideAngular(()=>n.handleError(o)),o}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(W,w,()=>{const K=U.injector.get(Op);return K.runInitializers(),K.donePromise.then(()=>(Z1(U.injector.get(ah,N_)||N_),this._moduleDoBootstrap(U),U))})})}bootstrapModule(t,r=[]){const o=GD({},r);return function(n,e,t){const r=new mx(t);return Promise.resolve(r)}(0,0,t).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(t){const r=t.injector.get(Lp);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${ln(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(_t(Ir))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function GD(n,e){return Array.isArray(e)?e.reduce(GD,n):Object.assign(Object.assign({},n),e)}let Lp=(()=>{class n{constructor(t,r,o,c,p){this._zone=t,this._injector=r,this._exceptionHandler=o,this._componentFactoryResolver=c,this._initStatus=p,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new Gn(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),T=new Gn(L=>{let U;this._zone.runOutsideAngular(()=>{U=this._zone.onStable.subscribe(()=>{mi.assertNotInAngularZone(),Rx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const W=this._zone.onUnstable.subscribe(()=>{mi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{U.unsubscribe(),W.unsubscribe()}});this.isStable=function(...n){let e=Number.POSITIVE_INFINITY,t=null,r=n[n.length-1];return _s(r)?(t=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(e=n.pop())):"number"==typeof r&&(e=n.pop()),null===t&&1===n.length&&n[0]instanceof Gn?n[0]:Zo(e)(Eo(n,t))}(w,T.pipe(n=>Cl()(function(n,e){return function(r){let o;o="function"==typeof n?n:function(){return n};const c=Object.create(r,vh);return c.source=r,c.subjectFactory=o,c}}(xh)(n))))}bootstrap(t,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let o;o=t instanceof mE?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(o.componentType);const c=function(n){return n.isBoundToModule}(o)?void 0:this._injector.get(Kc),w=o.create(Ir.NULL,[],r||o.selector,c),T=w.location.nativeElement,L=w.injector.get(Lx,null),U=L&&w.injector.get(OD);return L&&U&&U.registerApplication(T,L),w.onDestroy(()=>{this.detachView(w.hostView),zx(this.components,w),U&&U.unregisterApplication(T)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;zx(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(ID,[]).concat(this._bootstrapListeners).forEach(o=>o(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(_t(mi),_t(Ir),_t(Nc),_t(RA),_t(Op))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function zx(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class iy{}class GL{}const $L={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let HL=(()=>{class n{constructor(t,r){this._compiler=t,this._config=r||$L}load(t){return this.loadAndCompile(t)}loadAndCompile(t){let[r,o]=t.split("#");return void 0===o&&(o="default"),Ba(255)(r).then(c=>c[o]).then(c=>ZD(c,r,o)).then(c=>this._compiler.compileModuleAsync(c))}loadFactory(t){let[r,o]=t.split("#"),c="NgFactory";return void 0===o&&(o="default",c=""),Ba(255)(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(p=>p[o+c]).then(p=>ZD(p,r,o))}}return n.\u0275fac=function(t){return new(t||n)(_t(LA),_t(GL,8))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function ZD(n,e,t){if(!n)throw new Error(`Cannot find '${t}' in '${e}'`);return n}const t4=VD(null,"core",[{provide:ty,useValue:"unknown"},{provide:jD,deps:[Ir]},{provide:OD,deps:[]},{provide:ny,deps:[]}]),a4=[{provide:Lp,useClass:Lp,deps:[mi,Ir,Nc,RA,Op]},{provide:cO,deps:[mi],useFactory:function(n){let e=[];return n.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:Op,useClass:Op,deps:[[new rs,jg]]},{provide:LA,useClass:LA,deps:[]},AL,{provide:Tg,useFactory:function(){return rF},deps:[]},{provide:Dp,useFactory:function(){return iF},deps:[]},{provide:ah,useFactory:function(n){return Z1(n=n||"undefined"!=typeof $localize&&$localize.locale||N_),n},deps:[[new qu(ah),new rs,new Ei]]},{provide:kD,useValue:"USD"}];let c4=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(_t(Lp))},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({providers:a4}),n})(),fy=null;function Jc(){return fy}const lo=new nn("DocumentToken");let zA=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({factory:lB,token:n,providedIn:"platform"}),n})();function lB(){return _t(gS)}const cB=new nn("Location Initialized");let gS=(()=>{class n extends zA{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Jc().getBaseHref(this._doc)}onPopState(t){const r=Jc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=Jc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,r,o){_S()?this._history.pushState(t,r,o):this.location.hash=o}replaceState(t,r,o){_S()?this._history.replaceState(t,r,o):this.location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(_t(lo))},n.\u0275prov=$t({factory:uB,token:n,providedIn:"platform"}),n})();function _S(){return!!window.history.pushState}function uB(){return new gS(_t(lo))}function eb(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function yS(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function ch(n){return n&&"?"!==n[0]?"?"+n:n}let zp=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({factory:hB,token:n,providedIn:"root"}),n})();function hB(n){const e=_t(lo).location;return new vS(_t(zA),e&&e.origin||"")}const tb=new nn("appBaseHref");let vS=(()=>{class n extends zp{constructor(t,r){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return eb(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+ch(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${r}${o}`:r}pushState(t,r,o,c){const p=this.prepareExternalUrl(o+ch(c));this._platformLocation.pushState(t,r,p)}replaceState(t,r,o,c){const p=this.prepareExternalUrl(o+ch(c));this._platformLocation.replaceState(t,r,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,o;null===(o=(r=this._platformLocation).historyGo)||void 0===o||o.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(_t(zA),_t(tb,8))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),dB=(()=>{class n extends zp{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=eb(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,o,c){let p=this.prepareExternalUrl(o+ch(c));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(t,r,p)}replaceState(t,r,o,c){let p=this.prepareExternalUrl(o+ch(c));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,o;null===(o=(r=this._platformLocation).historyGo)||void 0===o||o.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(_t(zA),_t(tb,8))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),py=(()=>{class n{constructor(t,r){this._subject=new tt,this._urlChangeListeners=[],this._platformStrategy=t;const o=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=yS(xS(o)),this._platformStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+ch(r))}normalize(t){return n.stripTrailingSlash(function(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,xS(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,r="",o=null){this._platformStrategy.pushState(o,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ch(r)),o)}replaceState(t,r="",o=null){this._platformStrategy.replaceState(o,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ch(r)),o)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var r,o;null===(o=(r=this._platformStrategy).historyGo)||void 0===o||o.call(r,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}))}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(o=>o(t,r))}subscribe(t,r,o){return this._subject.subscribe({next:t,error:r,complete:o})}}return n.\u0275fac=function(t){return new(t||n)(_t(zp),_t(zA))},n.normalizeQueryParams=ch,n.joinWithSlash=eb,n.stripTrailingSlash=yS,n.\u0275prov=$t({factory:AB,token:n,providedIn:"root"}),n})();function AB(){return new py(_t(zp),_t(zA))}function xS(n){return n.replace(/\/index.html$/,"")}var la=(()=>((la=la||{})[la.Decimal=0]="Decimal",la[la.Percent=1]="Percent",la[la.Currency=2]="Currency",la[la.Scientific=3]="Scientific",la))(),co=(()=>((co=co||{})[co.Zero=0]="Zero",co[co.One=1]="One",co[co.Two=2]="Two",co[co.Few=3]="Few",co[co.Many=4]="Many",co[co.Other=5]="Other",co))(),an=(()=>((an=an||{})[an.Decimal=0]="Decimal",an[an.Group=1]="Group",an[an.List=2]="List",an[an.PercentSign=3]="PercentSign",an[an.PlusSign=4]="PlusSign",an[an.MinusSign=5]="MinusSign",an[an.Exponential=6]="Exponential",an[an.SuperscriptingExponent=7]="SuperscriptingExponent",an[an.PerMille=8]="PerMille",an[an.Infinity=9]="Infinity",an[an.NaN=10]="NaN",an[an.TimeSeparator=11]="TimeSeparator",an[an.CurrencyDecimal=12]="CurrencyDecimal",an[an.CurrencyGroup=13]="CurrencyGroup",an))();function hl(n,e){const t=Ls(n),r=t[Bt.NumberSymbols][e];if(void 0===r){if(e===an.CurrencyDecimal)return t[Bt.NumberSymbols][an.Decimal];if(e===an.CurrencyGroup)return t[Bt.NumberSymbols][an.Group]}return r}const xB=function(n){return Ls(n)[Bt.PluralCase]},VB=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function cb(n){const e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}class Ey{}let XB=(()=>{class n extends Ey{constructor(t){super(),this.locale=t}getPluralCategory(t,r){switch(xB(r||this.locale)(t)){case co.Zero:return"zero";case co.One:return"one";case co.Two:return"two";case co.Few:return"few";case co.Many:return"many";default:return"other"}}}return n.\u0275fac=function(t){return new(t||n)(_t(ah))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function IS(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[o,c]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(o.trim()===e)return decodeURIComponent(c)}return null}let kS=(()=>{class n{constructor(t,r,o,c){this._iterableDiffers=t,this._keyValueDiffers=r,this._ngEl=o,this._renderer=c,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(yg(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(r=>this._toggleClass(r.key,r.currentValue)),t.forEachChangedItem(r=>this._toggleClass(r.key,r.currentValue)),t.forEachRemovedItem(r=>{r.previousValue&&this._toggleClass(r.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(r=>{if("string"!=typeof r.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${ln(r.item)}`);this._toggleClass(r.item,!0)}),t.forEachRemovedItem(r=>this._toggleClass(r.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(r=>this._toggleClass(r,!0)):Object.keys(t).forEach(r=>this._toggleClass(r,!!t[r])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(r=>this._toggleClass(r,!1)):Object.keys(t).forEach(r=>this._toggleClass(r,!1)))}_toggleClass(t,r){(t=t.trim())&&t.split(/\s+/g).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}}return n.\u0275fac=function(t){return new(t||n)(at(Tg),at(Dp),at(Wi),at(oh))},n.\u0275dir=Xt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),n})();class KB{constructor(e,t,r,o){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let PS=(()=>{class n{constructor(t,r,o){this._viewContainer=t,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error(`Cannot find a differ supporting object '${t}' of type '${function(n){return n.name||typeof n}(t)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const r=[];t.forEachOperation((o,c,p)=>{if(null==o.previousIndex){const w=this._viewContainer.createEmbeddedView(this._template,new KB(null,this._ngForOf,-1,-1),null===p?void 0:p),T=new RS(o,w);r.push(T)}else if(null==p)this._viewContainer.remove(null===c?void 0:c);else if(null!==c){const w=this._viewContainer.get(c);this._viewContainer.move(w,p);const T=new RS(o,w);r.push(T)}});for(let o=0;o<r.length;o++)this._perViewChange(r[o].view,r[o].record);for(let o=0,c=this._viewContainer.length;o<c;o++){const p=this._viewContainer.get(o);p.context.index=o,p.context.count=c,p.context.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{this._viewContainer.get(o.currentIndex).context.$implicit=o.item})}_perViewChange(t,r){t.context.$implicit=r.item}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(at(Ql),at(sh),at(Tg))},n.\u0275dir=Xt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();class RS{constructor(e,t){this.record=e,this.view=t}}let FS=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new eN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){OS("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){OS("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(at(Ql),at(sh))},n.\u0275dir=Xt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class eN{constructor(){this.$implicit=null,this.ngIf=null}}function OS(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${ln(e)}'.`)}let NS=(()=>{class n{constructor(t){this._locale=t}transform(t,r,o){if(!function(n){return!(null==n||""===n||n!=n)}(t))return null;o=o||this._locale;try{return function(n,e,t){return function(n,e,t,r,o,c,p=!1){let w="",T=!1;if(isFinite(n)){let L=function(n){let r,o,c,p,w,e=Math.abs(n)+"",t=0;for((o=e.indexOf("."))>-1&&(e=e.replace(".","")),(c=e.search(/e/i))>0?(o<0&&(o=c),o+=+e.slice(c+1),e=e.substring(0,c)):o<0&&(o=e.length),c=0;"0"===e.charAt(c);c++);if(c===(w=e.length))r=[0],o=1;else{for(w--;"0"===e.charAt(w);)w--;for(o-=c,r=[],p=0;c<=w;c++,p++)r[p]=Number(e.charAt(c))}return o>22&&(r=r.splice(0,21),t=o-1,o=1),{digits:r,exponent:t,integerLen:o}}(n);p&&(L=function(n){if(0===n.digits[0])return n;const e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(0===e?n.digits.push(0,0):1===e&&n.digits.push(0),n.integerLen+=2),n}(L));let U=e.minInt,W=e.minFrac,K=e.maxFrac;if(c){const He=c.match(VB);if(null===He)throw new Error(`${c} is not a valid digit info`);const Rt=He[1],Zt=He[3],kn=He[5];null!=Rt&&(U=cb(Rt)),null!=Zt&&(W=cb(Zt)),null!=kn?K=cb(kn):null!=Zt&&W>K&&(K=W)}!function(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let r=n.digits,o=r.length-n.integerLen;const c=Math.min(Math.max(e,o),t);let p=c+n.integerLen,w=r[p];if(p>0){r.splice(Math.max(n.integerLen,p));for(let W=p;W<r.length;W++)r[W]=0}else{o=Math.max(0,o),n.integerLen=1,r.length=Math.max(1,p=c+1),r[0]=0;for(let W=1;W<p;W++)r[W]=0}if(w>=5)if(p-1<0){for(let W=0;W>p;W--)r.unshift(0),n.integerLen++;r.unshift(1),n.integerLen++}else r[p-1]++;for(;o<Math.max(0,c);o++)r.push(0);let T=0!==c;const L=e+n.integerLen,U=r.reduceRight(function(W,K,ie,fe){return fe[ie]=(K+=W)<10?K:K-10,T&&(0===fe[ie]&&ie>=L?fe.pop():T=!1),K>=10?1:0},0);U&&(r.unshift(U),n.integerLen++)}(L,W,K);let ie=L.digits,fe=L.integerLen;const Ve=L.exponent;let Re=[];for(T=ie.every(He=>!He);fe<U;fe++)ie.unshift(0);for(;fe<0;fe++)ie.unshift(0);fe>0?Re=ie.splice(fe,ie.length):(Re=ie,ie=[0]);const Je=[];for(ie.length>=e.lgSize&&Je.unshift(ie.splice(-e.lgSize,ie.length).join(""));ie.length>e.gSize;)Je.unshift(ie.splice(-e.gSize,ie.length).join(""));ie.length&&Je.unshift(ie.join("")),w=Je.join(hl(t,r)),Re.length&&(w+=hl(t,o)+Re.join("")),Ve&&(w+=hl(t,an.Exponential)+"+"+Ve)}else w=hl(t,an.Infinity);return w=n<0&&!T?e.negPre+w+e.negSuf:e.posPre+w+e.posSuf,w}(n,function(n,e="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=n.split(";"),o=r[0],c=r[1],p=-1!==o.indexOf(".")?o.split("."):[o.substring(0,o.lastIndexOf("0")+1),o.substring(o.lastIndexOf("0")+1)],w=p[0],T=p[1]||"";t.posPre=w.substr(0,w.indexOf("#"));for(let U=0;U<T.length;U++){const W=T.charAt(U);"0"===W?t.minFrac=t.maxFrac=U+1:"#"===W?t.maxFrac=U+1:t.posSuf+=W}const L=w.split(",");if(t.gSize=L[1]?L[1].length:0,t.lgSize=L[2]||L[1]?(L[2]||L[1]).length:0,c){const U=o.length-t.posPre.length-t.posSuf.length,W=c.indexOf("#");t.negPre=c.substr(0,W).replace(/'/g,""),t.negSuf=c.substr(W+U).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}(function(n,e){return Ls(n)[Bt.NumberFormats][e]}(e,la.Decimal),hl(e,an.MinusSign)),e,an.Group,an.Decimal,t)}(function(n){if("string"==typeof n&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if("number"!=typeof n)throw new Error(`${n} is not a number`);return n}(t),o,r)}catch(c){throw function(n,e){return Error(`InvalidPipeArgument: '${e}' for pipe '${ln(n)}'`)}(n,c.message)}}}return n.\u0275fac=function(t){return new(t||n)(at(ah,16))},n.\u0275pipe=vi({name:"number",type:n,pure:!0}),n})();let zS=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({providers:[{provide:Ey,useClass:XB}]}),n})();let US=(()=>{class n{}return n.\u0275prov=$t({token:n,providedIn:"root",factory:()=>new MN(_t(lo),window)}),n})();class MN{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const c=o.shadowRoot;if(c){const p=c.getElementById(e)||c.querySelector(`[name="${e}"]`);if(p)return p}o=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,o=t.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],o-c[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=jS(this.window.history)||jS(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function jS(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class GS{}class fb extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){fy||(fy=n)}(new fb)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(Xg=Xg||document.querySelector("base"),Xg?Xg.getAttribute("href"):null);return null==t?null:function(n){Dy=Dy||document.createElement("a"),Dy.setAttribute("href",n);const e=Dy.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Xg=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return IS(document.cookie,e)}}let Dy,Xg=null;const $S=new nn("TRANSITION_ID"),FN=[{provide:jg,useFactory:function(n,e,t){return()=>{t.get(Op).donePromise.then(()=>{const r=Jc(),o=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let c=0;c<o.length;c++)r.remove(o[c])})}},deps:[$S,lo,Ir],multi:!0}];class pb{static init(){!function(n){Bx=n}(new pb)}addToWindow(e){lr.getAngularTestability=(r,o=!0)=>{const c=e.findTestabilityInTree(r,o);if(null==c)throw new Error("Could not find testability for element.");return c},lr.getAllAngularTestabilities=()=>e.getAllTestabilities(),lr.getAllAngularRootElements=()=>e.getAllRootElements(),lr.frameworkStabilizers||(lr.frameworkStabilizers=[]),lr.frameworkStabilizers.push(r=>{const o=lr.getAllAngularTestabilities();let c=o.length,p=!1;const w=function(T){p=p||T,c--,0==c&&r(p)};o.forEach(function(T){T.whenStable(w)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const o=e.getTestability(t);return null!=o?o:r?Jc().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let ON=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const Yg=new nn("EventManagerPlugins");let My=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(o=>o.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,r,o){return this._findPluginFor(r).addEventListener(t,r,o)}addGlobalEventListener(t,r,o){return this._findPluginFor(r).addGlobalEventListener(t,r,o)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const o=this._plugins;for(let c=0;c<o.length;c++){const p=o[c];if(p.supports(t))return this._eventNameToPlugin.set(t,p),p}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(_t(Yg),_t(mi))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();class mb{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const o=Jc().getGlobalEventTarget(this._doc,e);if(!o)throw new Error(`Unsupported event target ${o} for event ${t}`);return this.addEventListener(o,t,r)}}let qS=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const r=new Set;t.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),r.add(o))}),this.onStylesAdded(r)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),Kg=(()=>{class n extends qS{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,r,o){t.forEach(c=>{const p=this._doc.createElement("style");p.textContent=c,o.push(r.appendChild(p))})}addHost(t){const r=[];this._addStylesToHost(this._stylesSet,t,r),this._hostNodes.set(t,r)}removeHost(t){const r=this._hostNodes.get(t);r&&r.forEach(ZS),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((r,o)=>{this._addStylesToHost(t,o,r)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(ZS))}}return n.\u0275fac=function(t){return new(t||n)(_t(lo))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function ZS(n){Jc().remove(n)}const gb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},_b=/%COMP%/g;function Ty(n,e,t){for(let r=0;r<e.length;r++){let o=e[r];Array.isArray(o)?Ty(n,o,t):(o=o.replace(_b,n),t.push(o))}return t}function XS(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let yb=(()=>{class n{constructor(t,r,o){this.eventManager=t,this.sharedStylesHost=r,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new vb(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;switch(r.encapsulation){case gr.Emulated:{let o=this.rendererByCompId.get(r.id);return o||(o=new XN(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,o)),o.applyToHost(t),o}case 1:case gr.ShadowDom:return new YN(this.eventManager,this.sharedStylesHost,t,r);default:if(!this.rendererByCompId.has(r.id)){const o=Ty(r.id,r.styles,[]);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(_t(My),_t(Kg),_t(Gg))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();class vb{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(gb[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,o){if(o){t=o+":"+t;const c=gb[o];c?e.setAttributeNS(c,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const o=gb[r];o?e.removeAttributeNS(o,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,o){o&(Is.DashCase|Is.Important)?e.style.setProperty(t,r,o&Is.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Is.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,XS(r)):this.eventManager.addEventListener(e,t,XS(r))}}class XN extends vb{constructor(e,t,r,o){super(e),this.component=r;const c=Ty(o+"-"+r.id,r.styles,[]);t.addStyles(c),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(_b,n)}(o+"-"+r.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(_b,n)}(o+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class YN extends vb{constructor(e,t,r,o){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=Ty(o.id,o.styles,[]);for(let p=0;p<c.length;p++){const w=document.createElement("style");w.textContent=c[p],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let KN=(()=>{class n extends mb{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,o){return t.addEventListener(r,o,!1),()=>this.removeEventListener(t,r,o)}removeEventListener(t,r,o){return t.removeEventListener(r,o)}}return n.\u0275fac=function(t){return new(t||n)(_t(lo))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const JS=["alt","control","meta","shift"],oz={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},eM={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},sz={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let az=(()=>{class n extends mb{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,o){const c=n.parseEventName(r),p=n.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Jc().onAndCancel(t,c.domEventName,p))}static parseEventName(t){const r=t.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const c=n._normalizeKey(r.pop());let p="";if(JS.forEach(T=>{const L=r.indexOf(T);L>-1&&(r.splice(L,1),p+=T+".")}),p+=c,0!=r.length||0===c.length)return null;const w={};return w.domEventName=o,w.fullKey=p,w}static getEventFullKey(t){let r="",o=function(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&eM.hasOwnProperty(e)&&(e=eM[e]))}return oz[e]||e}(t);return o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),JS.forEach(c=>{c!=o&&sz[c](t)&&(r+=c+".")}),r+=o,r}static eventCallback(t,r,o){return c=>{n.getEventFullKey(c)===t&&o.runGuarded(()=>r(c))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return n.\u0275fac=function(t){return new(t||n)(_t(lo))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),Iy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({factory:function(){return _t(bb)},token:n,providedIn:"root"}),n})(),bb=(()=>{class n extends Iy{constructor(t){super(),this._doc=t}sanitize(t,r){if(null==r)return null;switch(t){case Nr.NONE:return r;case Nr.HTML:return rl(r,"HTML")?Ts(r):Nf(this._doc,String(r)).toString();case Nr.STYLE:return rl(r,"Style")?Ts(r):r;case Nr.SCRIPT:if(rl(r,"Script"))return Ts(r);throw new Error("unsafe value used in a script context");case Nr.URL:return Rf(r),rl(r,"URL")?Ts(r):Qu(String(r));case Nr.RESOURCE_URL:if(rl(r,"ResourceURL"))return Ts(r);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(t){return function(n){return new Lc(n)}(t)}bypassSecurityTrustStyle(t){return function(n){return new Ms(n)}(t)}bypassSecurityTrustScript(t){return function(n){return new jv(n)}(t)}bypassSecurityTrustUrl(t){return function(n){return new wm(n)}(t)}bypassSecurityTrustResourceUrl(t){return function(n){return new Gv(n)}(t)}}return n.\u0275fac=function(t){return new(t||n)(_t(lo))},n.\u0275prov=$t({factory:function(){return function(n){return new bb(n.get(lo))}(_t(ei))},token:n,providedIn:"root"}),n})();const pz=VD(t4,"browser",[{provide:ty,useValue:"browser"},{provide:TD,useValue:function(){fb.makeCurrent(),pb.init()},multi:!0},{provide:lo,useFactory:function(){return function(n){Ka=n}(document),document},deps:[]}]),mz=[[],{provide:Vn,useValue:"root"},{provide:Nc,useFactory:function(){return new Nc},deps:[]},{provide:Yg,useClass:KN,multi:!0,deps:[lo,mi,ty]},{provide:Yg,useClass:az,multi:!0,deps:[lo]},[],{provide:yb,useClass:yb,deps:[My,Kg,Gg]},{provide:$_,useExisting:yb},{provide:qS,useExisting:Kg},{provide:Kg,useClass:Kg,deps:[lo]},{provide:Lx,useClass:Lx,deps:[mi]},{provide:My,useClass:My,deps:[Yg,mi]},{provide:GS,useClass:ON,deps:[]},[]];let gz=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:Gg,useValue:t.appId},{provide:$S,useExisting:Gg},FN]}}}return n.\u0275fac=function(t){return new(t||n)(_t(n,12))},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({providers:mz,imports:[zS,c4]}),n})();function yz(){return new tM(_t(lo))}let tM=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(_t(lo))},n.\u0275prov=$t({factory:yz,token:n,providedIn:"root"}),n})();function pn(...n){let e=n[n.length-1];return _s(e)?(n.pop(),po(n,e)):Eo(n)}"undefined"!=typeof window&&window;class Al extends _i{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new gs;return this._value}next(e){super.next(this._value=e)}}class Ez extends $n{notifyNext(e,t,r,o,c){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class Dz extends $n{constructor(e,t,r){super(),this.parent=e,this.outerValue=t,this.outerIndex=r,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function Sz(n,e,t,r,o=new Dz(n,t,r)){if(!o.closed)return e instanceof Gn?e.subscribe(o):wl(e)(o)}const rM={};function Cb(...n){let e,t;return _s(n[n.length-1])&&(t=n.pop()),"function"==typeof n[n.length-1]&&(e=n.pop()),1===n.length&&Ho(n[0])&&(n=n[0]),Eo(n,t).lift(new Mz(e))}class Mz{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new Tz(e,this.resultSelector))}}class Tz extends Ez{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(rM),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let r=0;r<t;r++)this.add(Sz(this,e[r],void 0,r))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,r){const o=this.values,p=this.toRespond?o[r]===rM?--this.toRespond:this.toRespond:0;o[r]=t,0===p&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}const ky=(()=>{function n(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return n.prototype=Object.create(Error.prototype),n})();function Eb(...n){return Zo(1)(pn(...n))}const Vp=new Gn(n=>n.complete());function Py(n){return n?function(n){return new Gn(e=>n.schedule(()=>e.complete()))}(n):Vp}function iM(n){return new Gn(e=>{let t;try{t=n()}catch(o){return void e.error(o)}return(t?Lr(t):Py()).subscribe(e)})}function eu(n,e){return"function"==typeof e?t=>t.pipe(eu((r,o)=>Lr(n(r,o)).pipe(An((c,p)=>e(r,c,o,p))))):t=>t.lift(new Pz(n))}class Pz{constructor(e){this.project=e}call(e,t){return t.subscribe(new Rz(e,this.project))}}class Rz extends Hs{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const r=this.index++;try{t=this.project(e,r)}catch(o){return void this.destination.error(o)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const r=new ma(this),o=this.destination;o.add(r),this.innerSubscription=ga(e,r),this.innerSubscription!==r&&o.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const oM=(()=>{function n(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return n.prototype=Object.create(Error.prototype),n})();function Db(n){return e=>0===n?Py():e.lift(new Fz(n))}class Fz{constructor(e){if(this.total=e,this.total<0)throw new oM}call(e,t){return t.subscribe(new Oz(e,this.total))}}class Oz extends $n{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))}}function sM(...n){const e=n[n.length-1];return _s(e)?(n.pop(),t=>Eb(n,t,e)):t=>Eb(n,t)}function aM(n,e){let t=!1;return arguments.length>=2&&(t=!0),function(o){return o.lift(new Lz(n,e,t))}}class Lz{constructor(e,t,r=!1){this.accumulator=e,this.seed=t,this.hasSeed=r}call(e,t){return t.subscribe(new Bz(e,this.accumulator,this.seed,this.hasSeed))}}class Bz extends $n{constructor(e,t,r,o){super(e),this.accumulator=t,this._seed=r,this.hasSeed=o,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let r;try{r=this.accumulator(this.seed,e,t)}catch(o){this.destination.error(o)}this.seed=r,this.destination.next(r)}}function tu(n,e){return function(r){return r.lift(new Nz(n,e))}}class Nz{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new zz(e,this.predicate,this.thisArg))}}class zz extends $n{constructor(e,t,r){super(e),this.predicate=t,this.thisArg=r,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)}}function rd(n){return function(t){const r=new Vz(n),o=t.lift(r);return r.caught=o}}class Vz{constructor(e){this.selector=e}call(e,t){return t.subscribe(new Uz(e,this.selector,this.caught))}}class Uz extends Hs{constructor(e,t,r){super(e),this.selector=t,this.caught=r}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(c){return void super.error(c)}this._unsubscribeAndRecycle();const r=new ma(this);this.add(r);const o=ga(t,r);o!==r&&this.add(o)}}}function Up(n,e){return pr(n,e,1)}function Sb(n){return function(t){return 0===n?Py():t.lift(new jz(n))}}class jz{constructor(e){if(this.total=e,this.total<0)throw new oM}call(e,t){return t.subscribe(new Gz(e,this.total))}}class Gz extends $n{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,r=this.total,o=this.count++;t.length<r?t.push(e):t[o%r]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const r=this.count>=this.total?this.total:this.count,o=this.ring;for(let c=0;c<r;c++){const p=t++%r;e.next(o[p])}}e.complete()}}function lM(n=qz){return e=>e.lift(new $z(n))}class $z{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new Hz(e,this.errorFactory))}}class Hz extends $n{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function qz(){return new ky}function cM(n=null){return e=>e.lift(new Zz(n))}class Zz{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new Wz(e,this.defaultValue))}}class Wz extends $n{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function VA(n,e){const t=arguments.length>=2;return r=>r.pipe(n?tu((o,c)=>n(o,c,r)):ui,Db(1),t?cM(e):lM(()=>new ky))}function id(){}function bo(n,e,t){return function(o){return o.lift(new Xz(n,e,t))}}class Xz{constructor(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}call(e,t){return t.subscribe(new Yz(e,this.nextOrObserver,this.error,this.complete))}}class Yz extends $n{constructor(e,t,r,o){super(e),this._tapNext=id,this._tapError=id,this._tapComplete=id,this._tapError=r||id,this._tapComplete=o||id,Gs(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||id,this._tapError=t.error||id,this._tapComplete=t.complete||id)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class Jz{constructor(e){this.callback=e}call(e,t){return t.subscribe(new e5(e,this.callback))}}class e5 extends $n{constructor(e,t){super(e),this.add(new wt(t))}}class hh{constructor(e,t){this.id=e,this.url=t}}class Mb extends hh{constructor(e,t,r="imperative",o=null){super(e,t),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Jg extends hh{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class uM extends hh{constructor(e,t,r){super(e,t),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class t5 extends hh{constructor(e,t,r){super(e,t),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class n5 extends hh{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class r5 extends hh{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class i5 extends hh{constructor(e,t,r,o,c){super(e,t),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=c}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class o5 extends hh{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class s5 extends hh{constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class hM{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class dM{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class a5{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class l5{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class c5{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class u5{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class AM{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Yn="primary";class h5{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function jp(n){return new h5(n)}const fM="ngNavigationCancelingError";function Tb(n){const e=Error("NavigationCancelingError: "+n);return e[fM]=!0,e}function A5(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const o={};for(let c=0;c<r.length;c++){const p=r[c],w=n[c];if(p.startsWith(":"))o[p.substring(1)]=w;else if(p!==w.path)return null}return{consumed:n.slice(0,r.length),posParams:o}}function nu(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let o;for(let c=0;c<t.length;c++)if(o=t[c],!pM(n[o],e[o]))return!1;return!0}function pM(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((o,c)=>r[c]===o)}return n===e}function mM(n){return Array.prototype.concat.apply([],n)}function gM(n){return n.length>0?n[n.length-1]:null}function Go(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function ru(n){return F_(n)?n:xg(n)?Lr(Promise.resolve(n)):pn(n)}const m5={exact:function vM(n,e,t){if(!jA(n.segments,e.segments)||!Ry(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!vM(n.children[r],e.children[r],t))return!1;return!0},subset:xM},_M={exact:function(n,e){return nu(n,e)},subset:function(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>pM(n[t],e[t]))},ignored:()=>!0};function yM(n,e,t){return m5[t.paths](n.root,e.root,t.matrixParams)&&_M[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function xM(n,e,t){return bM(n,e,e.segments,t)}function bM(n,e,t,r){if(n.segments.length>t.length){const o=n.segments.slice(0,t.length);return!(!jA(o,t)||e.hasChildren()||!Ry(o,t,r))}if(n.segments.length===t.length){if(!jA(n.segments,t)||!Ry(n.segments,t,r))return!1;for(const o in e.children)if(!n.children[o]||!xM(n.children[o],e.children[o],r))return!1;return!0}{const o=t.slice(0,n.segments.length),c=t.slice(n.segments.length);return!!(jA(n.segments,o)&&Ry(n.segments,o,r)&&n.children[Yn])&&bM(n.children[Yn],e,c,r)}}function Ry(n,e,t){return e.every((r,o)=>_M[t](n[o].parameters,r.parameters))}class UA{constructor(e,t,r){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=jp(this.queryParams)),this._queryParamMap}toString(){return x5.serialize(this)}}class sr{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Go(t,(r,o)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Fy(this)}}class e0{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=jp(this.parameters)),this._parameterMap}toString(){return DM(this)}}function jA(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}class Ib{}class wM{parse(e){const t=new I5(e);return new UA(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){return`${`/${t0(e.root,!0)}`}${function(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(o=>`${Oy(t)}=${Oy(o)}`).join("&"):`${Oy(t)}=${Oy(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${function(n){return encodeURI(n)}(e.fragment)}`:""}`}}const x5=new wM;function Fy(n){return n.segments.map(e=>DM(e)).join("/")}function t0(n,e){if(!n.hasChildren())return Fy(n);if(e){const t=n.children[Yn]?t0(n.children[Yn],!1):"",r=[];return Go(n.children,(o,c)=>{c!==Yn&&r.push(`${c}:${t0(o,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function(n,e){let t=[];return Go(n.children,(r,o)=>{o===Yn&&(t=t.concat(e(r,o)))}),Go(n.children,(r,o)=>{o!==Yn&&(t=t.concat(e(r,o)))}),t}(n,(r,o)=>o===Yn?[t0(n.children[Yn],!1)]:[`${o}:${t0(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Yn]?`${Fy(n)}/${t[0]}`:`${Fy(n)}/(${t.join("//")})`}}function CM(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Oy(n){return CM(n).replace(/%3B/gi,";")}function kb(n){return CM(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ly(n){return decodeURIComponent(n)}function EM(n){return Ly(n.replace(/\+/g,"%20"))}function DM(n){return`${kb(n.path)}${function(n){return Object.keys(n).map(e=>`;${kb(e)}=${kb(n[e])}`).join("")}(n.parameters)}`}const E5=/^[^\/()?;=#]+/;function By(n){const e=n.match(E5);return e?e[0]:""}const D5=/^[^=?&#]+/,M5=/^[^?&#]+/;class I5{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new sr([],{}):new sr([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[Yn]=new sr(e,t)),r}parseSegment(){const e=By(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new e0(Ly(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=By(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const o=By(this.remaining);o&&(r=o,this.capture(r))}e[Ly(t)]=Ly(r)}parseQueryParam(e){const t=function(n){const e=n.match(D5);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const p=function(n){const e=n.match(M5);return e?e[0]:""}(this.remaining);p&&(r=p,this.capture(r))}const o=EM(t),c=EM(r);if(e.hasOwnProperty(o)){let p=e[o];Array.isArray(p)||(p=[p],e[o]=p),p.push(c)}else e[o]=c}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=By(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new Error(`Cannot parse url '${this.url}'`);let c;r.indexOf(":")>-1?(c=r.substr(0,r.indexOf(":")),this.capture(c),this.capture(":")):e&&(c=Yn);const p=this.parseChildren();t[c]=1===Object.keys(p).length?p[Yn]:new sr([],p),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class SM{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=Pb(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=Pb(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=Rb(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return Rb(e,this._root).map(t=>t.value)}}function Pb(n,e){if(n===e.value)return e;for(const t of e.children){const r=Pb(n,t);if(r)return r}return null}function Rb(n,e){if(n===e.value)return[e];for(const t of e.children){const r=Rb(n,t);if(r.length)return r.unshift(e),r}return[]}class dh{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function n0(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class MM extends SM{constructor(e,t){super(e),this.snapshot=t,Fb(this,e)}toString(){return this.snapshot.toString()}}function TM(n,e){const t=function(n,e){const p=new Ny([],{},{},"",{},Yn,e,null,n.root,-1,{});return new kM("",new dh(p,[]))}(n,e),r=new Al([new e0("",{})]),o=new Al({}),c=new Al({}),p=new Al({}),w=new Al(""),T=new Gp(r,o,p,w,c,Yn,e,t.root);return T.snapshot=t.root,new MM(new dh(T,[]),t)}class Gp{constructor(e,t,r,o,c,p,w,T){this.url=e,this.params=t,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=p,this.component=w,this._futureSnapshot=T}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(An(e=>jp(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(An(e=>jp(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function IM(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const o=t[r],c=t[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(c.component)break;r--}}return function(n){return n.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Ny{constructor(e,t,r,o,c,p,w,T,L,U,W){this.url=e,this.params=t,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=p,this.component=w,this.routeConfig=T,this._urlSegment=L,this._lastPathIndex=U,this._resolve=W}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=jp(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=jp(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class kM extends SM{constructor(e,t){super(t),this.url=e,Fb(this,t)}toString(){return PM(this._root)}}function Fb(n,e){e.value._routerState=n,e.children.forEach(t=>Fb(n,t))}function PM(n){const e=n.children.length>0?` { ${n.children.map(PM).join(", ")} } `:"";return`${n.value}${e}`}function Ob(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,nu(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),nu(e.params,t.params)||n.params.next(t.params),function(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!nu(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),nu(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function Lb(n,e){return nu(n.params,e.params)&&function(n,e){return jA(n,e)&&n.every((t,r)=>nu(t.parameters,e[r].parameters))}(n.url,e.url)&&!(!n.parent!=!e.parent)&&(!n.parent||Lb(n.parent,e.parent))}function zy(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const o=function(n,e,t){return e.children.map(r=>{for(const o of t.children)if(n.shouldReuseRoute(r.value,o.value.snapshot))return zy(n,r,o);return zy(n,r)})}(n,e,t);return new dh(r,o)}{if(n.shouldAttach(e.value)){const c=n.retrieve(e.value);if(null!==c){const p=c.route;return RM(e,p),p}}const r=function(n){return new Gp(new Al(n.url),new Al(n.params),new Al(n.queryParams),new Al(n.fragment),new Al(n.data),n.outlet,n.component,n)}(e.value),o=e.children.map(c=>zy(n,c));return new dh(r,o)}}function RM(n,e){if(n.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(n.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=n.value;for(let t=0;t<n.children.length;++t)RM(n.children[t],e.children[t])}function Vy(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function r0(n){return"object"==typeof n&&null!=n&&n.outlets}function Bb(n,e,t,r,o){let c={};return r&&Go(r,(p,w)=>{c[w]=Array.isArray(p)?p.map(T=>`${T}`):`${p}`}),new UA(t.root===n?e:FM(t.root,n,e),c,o)}function FM(n,e,t){const r={};return Go(n.children,(o,c)=>{r[c]=o===e?t:FM(o,e,t)}),new sr(n.segments,r)}class OM{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Vy(r[0]))throw new Error("Root segment cannot have matrix parameters");const o=r.find(r0);if(o&&o!==gM(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Nb{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function LM(n,e,t){if(n||(n=new sr([],{})),0===n.segments.length&&n.hasChildren())return Uy(n,e,t);const r=function(n,e,t){let r=0,o=e;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<n.segments.length;){if(r>=t.length)return c;const p=n.segments[o],w=t[r];if(r0(w))break;const T=`${w}`,L=r<t.length-1?t[r+1]:null;if(o>0&&void 0===T)break;if(T&&L&&"object"==typeof L&&void 0===L.outlets){if(!NM(T,L,p))return c;r+=2}else{if(!NM(T,{},p))return c;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(n,e,t),o=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const c=new sr(n.segments.slice(0,r.pathIndex),{});return c.children[Yn]=new sr(n.segments.slice(r.pathIndex),n.children),Uy(c,0,o)}return r.match&&0===o.length?new sr(n.segments,{}):r.match&&!n.hasChildren()?zb(n,e,t):r.match?Uy(n,0,o):zb(n,e,t)}function Uy(n,e,t){if(0===t.length)return new sr(n.segments,{});{const r=function(n){return r0(n[0])?n[0].outlets:{[Yn]:n}}(t),o={};return Go(r,(c,p)=>{"string"==typeof c&&(c=[c]),null!==c&&(o[p]=LM(n.children[p],e,c))}),Go(n.children,(c,p)=>{void 0===r[p]&&(o[p]=c)}),new sr(n.segments,o)}}function zb(n,e,t){const r=n.segments.slice(0,e);let o=0;for(;o<t.length;){const c=t[o];if(r0(c)){const T=j5(c.outlets);return new sr(r,T)}if(0===o&&Vy(t[0])){r.push(new e0(n.segments[e].path,BM(t[0]))),o++;continue}const p=r0(c)?c.outlets[Yn]:`${c}`,w=o<t.length-1?t[o+1]:null;p&&w&&Vy(w)?(r.push(new e0(p,BM(w))),o+=2):(r.push(new e0(p,{})),o++)}return new sr(r,{})}function j5(n){const e={};return Go(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=zb(new sr([],{}),0,t))}),e}function BM(n){const e={};return Go(n,(t,r)=>e[r]=`${t}`),e}function NM(n,e,t){return n==t.path&&nu(e,t.parameters)}class $5{constructor(e,t,r,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=o}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Ob(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const o=n0(t);e.children.forEach(c=>{const p=c.value.outlet;this.deactivateRoutes(c,o[p],r),delete o[p]}),Go(o,(c,p)=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(e,t,r){const o=e.value,c=t?t.value:null;if(o===c)if(o.component){const p=r.getContext(o.outlet);p&&this.deactivateChildRoutes(e,t,p.children)}else this.deactivateChildRoutes(e,t,r);else c&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet);if(r&&r.outlet){const o=r.outlet.detach(),c=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:c})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),o=r&&e.value.component?r.children:t,c=n0(e);for(const p of Object.keys(c))this.deactivateRouteAndItsChildren(c[p],o);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const o=n0(t);e.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],r),this.forwardEvent(new u5(c.value.snapshot))}),e.children.length&&this.forwardEvent(new l5(e.value.snapshot))}activateRoutes(e,t,r){const o=e.value,c=t?t.value:null;if(Ob(o),o===c)if(o.component){const p=r.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,p.children)}else this.activateChildRoutes(e,t,r);else if(o.component){const p=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const w=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),p.children.onOutletReAttached(w.contexts),p.attachRef=w.componentRef,p.route=w.route.value,p.outlet&&p.outlet.attach(w.componentRef,w.route.value),zM(w.route)}else{const w=function(n){for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(o.snapshot),T=w?w.module.componentFactoryResolver:null;p.attachRef=null,p.route=o,p.resolver=T,p.outlet&&p.outlet.activateWith(o,T),this.activateChildRoutes(e,null,p.children)}}else this.activateChildRoutes(e,null,r)}}function zM(n){Ob(n.value),n.children.forEach(zM)}class Vb{constructor(e,t){this.routes=e,this.module=t}}function od(n){return"function"==typeof n}function GA(n){return n instanceof UA}const o0=Symbol("INITIAL_VALUE");function s0(){return eu(n=>Cb(n.map(e=>e.pipe(Db(1),sM(o0)))).pipe(aM((e,t)=>{let r=!1;return t.reduce((o,c,p)=>o!==o0?o:(c===o0&&(r=!0),r||!1!==c&&p!==t.length-1&&!GA(c)?o:c),e)},o0),tu(e=>e!==o0),An(e=>GA(e)?e:!0===e),Db(1)))}let VM=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Bo({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,r){1&t&&kA(0,"router-outlet")},directives:function(){return[rT]},encapsulation:2}),n})();function UM(n,e=""){for(let t=0;t<n.length;t++){const r=n[t];Y5(r,K5(e,r))}}function Y5(n,e){n.children&&UM(n.children,e)}function K5(n,e){return e?n||e.path?n&&!e.path?`${n}/`:!n&&e.path?e.path:`${n}/${e.path}`:"":n}function Ub(n){const e=n.children&&n.children.map(Ub),t=e?Object.assign(Object.assign({},n),{children:e}):Object.assign({},n);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Yn&&(t.component=VM),t}function fl(n){return n.outlet||Yn}function jM(n,e){const t=n.filter(r=>fl(r)===e);return t.push(...n.filter(r=>fl(r)!==e)),t}const GM={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function jy(n,e,t){var r;if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?Object.assign({},GM):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const c=(e.matcher||A5)(t,n,e);if(!c)return Object.assign({},GM);const p={};Go(c.posParams,(T,L)=>{p[L]=T.path});const w=c.consumed.length>0?Object.assign(Object.assign({},p),c.consumed[c.consumed.length-1].parameters):p;return{matched:!0,consumedSegments:c.consumed,lastChild:c.consumed.length,parameters:w,positionalParamSegments:null!==(r=c.posParams)&&void 0!==r?r:{}}}function Gy(n,e,t,r,o="corrected"){if(t.length>0&&function(n,e,t){return t.some(r=>$y(n,e,r)&&fl(r)!==Yn)}(n,t,r)){const p=new sr(e,function(n,e,t,r){const o={};o[Yn]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const c of t)if(""===c.path&&fl(c)!==Yn){const p=new sr([],{});p._sourceSegment=n,p._segmentIndexShift=e.length,o[fl(c)]=p}return o}(n,e,r,new sr(t,n.children)));return p._sourceSegment=n,p._segmentIndexShift=e.length,{segmentGroup:p,slicedSegments:[]}}if(0===t.length&&function(n,e,t){return t.some(r=>$y(n,e,r))}(n,t,r)){const p=new sr(n.segments,function(n,e,t,r,o,c){const p={};for(const w of r)if($y(n,t,w)&&!o[fl(w)]){const T=new sr([],{});T._sourceSegment=n,T._segmentIndexShift="legacy"===c?n.segments.length:e.length,p[fl(w)]=T}return Object.assign(Object.assign({},o),p)}(n,e,t,r,n.children,o));return p._sourceSegment=n,p._segmentIndexShift=e.length,{segmentGroup:p,slicedSegments:t}}const c=new sr(n.segments,n.children);return c._sourceSegment=n,c._segmentIndexShift=e.length,{segmentGroup:c,slicedSegments:t}}function $y(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function $M(n,e,t,r){return!!(fl(n)===r||r!==Yn&&$y(e,t,n))&&("**"===n.path||jy(e,n,t).matched)}function HM(n,e,t){return 0===e.length&&!n.children[t]}class a0{constructor(e){this.segmentGroup=e||null}}class qM{constructor(e){this.urlTree=e}}function Hy(n){return new Gn(e=>e.error(new a0(n)))}function ZM(n){return new Gn(e=>e.error(new qM(n)))}function rV(n){return new Gn(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n}'`)))}class sV{constructor(e,t,r,o,c){this.configLoader=t,this.urlSerializer=r,this.urlTree=o,this.config=c,this.allowRedirects=!0,this.ngModule=e.get(Kc)}apply(){const e=Gy(this.urlTree.root,[],[],this.config).segmentGroup,t=new sr(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,Yn).pipe(An(c=>this.createUrlTree(jb(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(rd(c=>{if(c instanceof qM)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof a0?this.noMatchError(c):c}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Yn).pipe(An(o=>this.createUrlTree(jb(o),e.queryParams,e.fragment))).pipe(rd(o=>{throw o instanceof a0?this.noMatchError(o):o}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,r){const o=e.segments.length>0?new sr([],{[Yn]:e}):e;return new UA(o,t,r)}expandSegmentGroup(e,t,r,o){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe(An(c=>new sr([],c))):this.expandSegment(e,r,t,r.segments,o,!0)}expandChildren(e,t,r){const o=[];for(const c of Object.keys(r.children))"primary"===c?o.unshift(c):o.push(c);return Lr(o).pipe(Up(c=>{const p=r.children[c],w=jM(t,c);return this.expandSegmentGroup(e,w,p,c).pipe(An(T=>({segment:T,outlet:c})))}),aM((c,p)=>(c[p.outlet]=p.segment,c),{}),function(n,e){const t=arguments.length>=2;return r=>r.pipe(n?tu((o,c)=>n(o,c,r)):ui,Sb(1),t?cM(e):lM(()=>new ky))}())}expandSegment(e,t,r,o,c,p){return Lr(r).pipe(Up(w=>this.expandSegmentAgainstRoute(e,t,r,w,o,c,p).pipe(rd(L=>{if(L instanceof a0)return pn(null);throw L}))),VA(w=>!!w),rd((w,T)=>{if(w instanceof ky||"EmptyError"===w.name){if(HM(t,o,c))return pn(new sr([],{}));throw new a0(t)}throw w}))}expandSegmentAgainstRoute(e,t,r,o,c,p,w){return $M(o,t,c,p)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(e,t,o,c,p):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,o,c,p):Hy(t):Hy(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,o,c,p){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,o,p):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,o,c,p)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,o){const c=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?ZM(c):this.lineralizeSegments(r,c).pipe(pr(p=>{const w=new sr(p,{});return this.expandSegment(e,w,t,p,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,o,c,p){const{matched:w,consumedSegments:T,lastChild:L,positionalParamSegments:U}=jy(t,o,c);if(!w)return Hy(t);const W=this.applyRedirectCommands(T,o.redirectTo,U);return o.redirectTo.startsWith("/")?ZM(W):this.lineralizeSegments(o,W).pipe(pr(K=>this.expandSegment(e,t,r,K.concat(c.slice(L)),p,!1)))}matchSegmentAgainstRoute(e,t,r,o,c){if("**"===r.path)return r.loadChildren?(r._loadedConfig?pn(r._loadedConfig):this.configLoader.load(e.injector,r)).pipe(An(K=>(r._loadedConfig=K,new sr(o,{})))):pn(new sr(o,{}));const{matched:p,consumedSegments:w,lastChild:T}=jy(t,r,o);if(!p)return Hy(t);const L=o.slice(T);return this.getChildConfig(e,r,o).pipe(pr(W=>{const K=W.module,ie=W.routes,{segmentGroup:fe,slicedSegments:Ve}=Gy(t,w,L,ie),Re=new sr(fe.segments,fe.children);if(0===Ve.length&&Re.hasChildren())return this.expandChildren(K,ie,Re).pipe(An(Zt=>new sr(w,Zt)));if(0===ie.length&&0===Ve.length)return pn(new sr(w,{}));const Je=fl(r)===c;return this.expandSegment(K,Re,ie,Ve,Je?Yn:c,!0).pipe(An(Rt=>new sr(w.concat(Rt.segments),Rt.children)))}))}getChildConfig(e,t,r){return t.children?pn(new Vb(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?pn(t._loadedConfig):this.runCanLoadGuards(e.injector,t,r).pipe(pr(o=>o?this.configLoader.load(e.injector,t).pipe(An(c=>(t._loadedConfig=c,c))):function(n){return new Gn(e=>e.error(Tb(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`)))}(t))):pn(new Vb([],e))}runCanLoadGuards(e,t,r){const o=t.canLoad;return o&&0!==o.length?pn(o.map(p=>{const w=e.get(p);let T;if(function(n){return n&&od(n.canLoad)}(w))T=w.canLoad(t,r);else{if(!od(w))throw new Error("Invalid CanLoad guard");T=w(t,r)}return ru(T)})).pipe(s0(),bo(p=>{if(!GA(p))return;const w=Tb(`Redirecting to "${this.urlSerializer.serialize(p)}"`);throw w.url=p,w}),An(p=>!0===p)):pn(!0)}lineralizeSegments(e,t){let r=[],o=t.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return pn(r);if(o.numberOfChildren>1||!o.children[Yn])return rV(e.redirectTo);o=o.children[Yn]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreatreUrlTree(e,t,r,o){const c=this.createSegmentGroup(e,t.root,r,o);return new UA(c,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return Go(e,(o,c)=>{if("string"==typeof o&&o.startsWith(":")){const w=o.substring(1);r[c]=t[w]}else r[c]=o}),r}createSegmentGroup(e,t,r,o){const c=this.createSegments(e,t.segments,r,o);let p={};return Go(t.children,(w,T)=>{p[T]=this.createSegmentGroup(e,w,r,o)}),new sr(c,p)}createSegments(e,t,r,o){return t.map(c=>c.path.startsWith(":")?this.findPosParam(e,c,o):this.findOrReturn(c,r))}findPosParam(e,t,r){const o=r[t.path.substring(1)];if(!o)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return o}findOrReturn(e,t){let r=0;for(const o of t){if(o.path===e.path)return t.splice(r),o;r++}return e}}function jb(n){const e={};for(const r of Object.keys(n.children)){const c=jb(n.children[r]);(c.segments.length>0||c.hasChildren())&&(e[r]=c)}return function(n){if(1===n.numberOfChildren&&n.children[Yn]){const e=n.children[Yn];return new sr(n.segments.concat(e.segments),e.children)}return n}(new sr(n.segments,e))}class WM{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class qy{constructor(e,t){this.component=e,this.route=t}}function cV(n,e,t){const r=n._root;return l0(r,e?e._root:null,t,[r.value])}function Zy(n,e,t){const r=function(n){if(!n)return null;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:t).get(n)}function l0(n,e,t,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=n0(e);return n.children.forEach(p=>{(function(n,e,t,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=n.value,p=e?e.value:null,w=t?t.getContext(n.value.outlet):null;if(p&&c.routeConfig===p.routeConfig){const T=function(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!jA(n.url,e.url);case"pathParamsOrQueryParamsChange":return!jA(n.url,e.url)||!nu(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Lb(n,e)||!nu(n.queryParams,e.queryParams);case"paramsChange":default:return!Lb(n,e)}}(p,c,c.routeConfig.runGuardsAndResolvers);T?o.canActivateChecks.push(new WM(r)):(c.data=p.data,c._resolvedData=p._resolvedData),l0(n,e,c.component?w?w.children:null:t,r,o),T&&w&&w.outlet&&w.outlet.isActivated&&o.canDeactivateChecks.push(new qy(w.outlet.component,p))}else p&&c0(e,w,o),o.canActivateChecks.push(new WM(r)),l0(n,null,c.component?w?w.children:null:t,r,o)})(p,c[p.value.outlet],t,r.concat([p.value]),o),delete c[p.value.outlet]}),Go(c,(p,w)=>c0(p,t.getContext(w),o)),o}function c0(n,e,t){const r=n0(n),o=n.value;Go(r,(c,p)=>{c0(c,o.component?e?e.children.getContext(p):null:e,t)}),t.canDeactivateChecks.push(new qy(o.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,o))}class bV{}function QM(n){return new Gn(e=>e.error(n))}class CV{constructor(e,t,r,o,c,p){this.rootComponentType=e,this.config=t,this.urlTree=r,this.url=o,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=p}recognize(){const e=Gy(this.urlTree.root,[],[],this.config.filter(p=>void 0===p.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Yn);if(null===t)return null;const r=new Ny([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Yn,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new dh(r,t),c=new kM(this.url,o);return this.inheritParamsAndData(c._root),c}inheritParamsAndData(e){const t=e.value,r=IM(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(e,t,r){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,r)}processChildren(e,t){const r=[];for(const c of Object.keys(t.children)){const p=t.children[c],w=jM(e,c),T=this.processSegmentGroup(w,p,c);if(null===T)return null;r.push(...T)}const o=XM(r);return function(n){n.sort((e,t)=>e.value.outlet===Yn?-1:t.value.outlet===Yn?1:e.value.outlet.localeCompare(t.value.outlet))}(o),o}processSegment(e,t,r,o){for(const c of e){const p=this.processSegmentAgainstRoute(c,t,r,o);if(null!==p)return p}return HM(t,r,o)?[]:null}processSegmentAgainstRoute(e,t,r,o){if(e.redirectTo||!$M(e,t,r,o))return null;let c,p=[],w=[];if("**"===e.path){const ie=r.length>0?gM(r).parameters:{};c=new Ny(r,ie,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,JM(e),fl(e),e.component,e,YM(t),KM(t)+r.length,eT(e))}else{const ie=jy(t,e,r);if(!ie.matched)return null;p=ie.consumedSegments,w=r.slice(ie.lastChild),c=new Ny(p,ie.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,JM(e),fl(e),e.component,e,YM(t),KM(t)+p.length,eT(e))}const T=function(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(e),{segmentGroup:L,slicedSegments:U}=Gy(t,p,w,T.filter(ie=>void 0===ie.redirectTo),this.relativeLinkResolution);if(0===U.length&&L.hasChildren()){const ie=this.processChildren(T,L);return null===ie?null:[new dh(c,ie)]}if(0===T.length&&0===U.length)return[new dh(c,[])];const W=fl(e)===o,K=this.processSegment(T,L,U,W?Yn:o);return null===K?null:[new dh(c,K)]}}function SV(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function XM(n){const e=[],t=new Set;for(const r of n){if(!SV(r)){e.push(r);continue}const o=e.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...r.children),t.add(o)):e.push(r)}for(const r of t){const o=XM(r.children);e.push(new dh(r.value,o))}return e.filter(r=>!t.has(r))}function YM(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function KM(n){let e=n,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function JM(n){return n.data||{}}function eT(n){return n.resolve||{}}function Gb(n){return eu(e=>{const t=n(e);return t?Lr(t).pipe(An(()=>e)):pn(e)})}class OV extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const $b=new nn("ROUTES");class tT{constructor(e,t,r,o){this.loader=e,this.compiler=t,this.onLoadStartListener=r,this.onLoadEndListener=o}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const o=this.loadModuleFactory(t.loadChildren).pipe(An(c=>{this.onLoadEndListener&&this.onLoadEndListener(t);const p=c.create(e);return new Vb(mM(p.injector.get($b,void 0,Qt.Self|Qt.Optional)).map(Ub),p)}),rd(c=>{throw t._loader$=void 0,c}));return t._loader$=new lc(o,()=>new _i).pipe(Cl()),t._loader$}loadModuleFactory(e){return"string"==typeof e?Lr(this.loader.load(e)):ru(e()).pipe(pr(t=>t instanceof SE?pn(t):Lr(this.compiler.compileModuleAsync(t))))}}class LV{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new $p,this.attachRef=null}}class $p{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const r=this.getOrCreateContext(e);r.outlet=t,this.contexts.set(e,r)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new LV,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class NV{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function zV(n){throw n}function VV(n,e,t){return e.parse("/")}function nT(n,e){return pn(null)}const UV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},jV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ca=(()=>{class n{constructor(t,r,o,c,p,w,T,L){this.rootComponentType=t,this.urlSerializer=r,this.rootContexts=o,this.location=c,this.config=L,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new _i,this.errorHandler=zV,this.malformedUriErrorHandler=VV,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:nT,afterPreactivation:nT},this.urlHandlingStrategy=new NV,this.routeReuseStrategy=new OV,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=p.get(Kc),this.console=p.get(ny);const K=p.get(mi);this.isNgZoneEnabled=K instanceof mi&&mi.isInAngularZone(),this.resetConfig(L),this.currentUrlTree=new UA(new sr([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new tT(w,T,ie=>this.triggerEvent(new hM(ie)),ie=>this.triggerEvent(new dM(ie))),this.routerState=TM(this.currentUrlTree,this.rootComponentType),this.transitions=new Al({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const r=this.events;return t.pipe(tu(o=>0!==o.id),An(o=>Object.assign(Object.assign({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),eu(o=>{let c=!1,p=!1;return pn(o).pipe(bo(w=>{this.currentNavigation={id:w.id,initialUrl:w.currentRawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),eu(w=>{const T=this.browserUrlTree.toString(),L=!this.navigated||w.extractedUrl.toString()!==T||T!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||L)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return Wy(w.source)&&(this.browserUrlTree=w.extractedUrl),pn(w).pipe(eu(W=>{const K=this.transitions.getValue();return r.next(new Mb(W.id,this.serializeUrl(W.extractedUrl),W.source,W.restoredState)),K!==this.transitions.getValue()?Vp:Promise.resolve(W)}),function(n,e,t,r){return eu(o=>function(n,e,t,r,o){return new sV(n,e,t,r,o).apply()}(n,e,t,o.extractedUrl,r).pipe(An(c=>Object.assign(Object.assign({},o),{urlAfterRedirects:c}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),bo(W=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:W.urlAfterRedirects})}),function(n,e,t,r,o){return pr(c=>function(n,e,t,r,o="emptyOnly",c="legacy"){try{const p=new CV(n,e,t,r,o,c).recognize();return null===p?QM(new bV):pn(p)}catch(p){return QM(p)}}(n,e,c.urlAfterRedirects,t(c.urlAfterRedirects),r,o).pipe(An(p=>Object.assign(Object.assign({},c),{targetSnapshot:p}))))}(this.rootComponentType,this.config,W=>this.serializeUrl(W),this.paramsInheritanceStrategy,this.relativeLinkResolution),bo(W=>{"eager"===this.urlUpdateStrategy&&(W.extras.skipLocationChange||this.setBrowserUrl(W.urlAfterRedirects,W),this.browserUrlTree=W.urlAfterRedirects);const K=new n5(W.id,this.serializeUrl(W.extractedUrl),this.serializeUrl(W.urlAfterRedirects),W.targetSnapshot);r.next(K)}));if(L&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:K,extractedUrl:ie,source:fe,restoredState:Ve,extras:Re}=w,Je=new Mb(K,this.serializeUrl(ie),fe,Ve);r.next(Je);const He=TM(ie,this.rootComponentType).snapshot;return pn(Object.assign(Object.assign({},w),{targetSnapshot:He,urlAfterRedirects:ie,extras:Object.assign(Object.assign({},Re),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=w.rawUrl,this.browserUrlTree=w.urlAfterRedirects,w.resolve(null),Vp}),Gb(w=>{const{targetSnapshot:T,id:L,extractedUrl:U,rawUrl:W,extras:{skipLocationChange:K,replaceUrl:ie}}=w;return this.hooks.beforePreactivation(T,{navigationId:L,appliedUrlTree:U,rawUrlTree:W,skipLocationChange:!!K,replaceUrl:!!ie})}),bo(w=>{const T=new r5(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(T)}),An(w=>Object.assign(Object.assign({},w),{guards:cV(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function(n,e){return pr(t=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:p}}=t;return 0===p.length&&0===c.length?pn(Object.assign(Object.assign({},t),{guardsResult:!0})):function(n,e,t,r){return Lr(n).pipe(pr(o=>function(n,e,t,r,o){const c=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return c&&0!==c.length?pn(c.map(w=>{const T=Zy(w,e,o);let L;if(function(n){return n&&od(n.canDeactivate)}(T))L=ru(T.canDeactivate(n,e,t,r));else{if(!od(T))throw new Error("Invalid CanDeactivate guard");L=ru(T(n,e,t,r))}return L.pipe(VA())})).pipe(s0()):pn(!0)}(o.component,o.route,t,e,r)),VA(o=>!0!==o,!0))}(p,r,o,n).pipe(pr(w=>w&&function(n){return"boolean"==typeof n}(w)?function(n,e,t,r){return Lr(e).pipe(Up(o=>Eb(function(n,e){return null!==n&&e&&e(new a5(n)),pn(!0)}(o.route.parent,r),function(n,e){return null!==n&&e&&e(new c5(n)),pn(!0)}(o.route,r),function(n,e,t){const r=e[e.length-1],c=e.slice(0,e.length-1).reverse().map(p=>function(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(p)).filter(p=>null!==p).map(p=>iM(()=>pn(p.guards.map(T=>{const L=Zy(T,p.node,t);let U;if(function(n){return n&&od(n.canActivateChild)}(L))U=ru(L.canActivateChild(r,n));else{if(!od(L))throw new Error("Invalid CanActivateChild guard");U=ru(L(r,n))}return U.pipe(VA())})).pipe(s0())));return pn(c).pipe(s0())}(n,o.path,t),function(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?pn(r.map(c=>iM(()=>{const p=Zy(c,e,t);let w;if(function(n){return n&&od(n.canActivate)}(p))w=ru(p.canActivate(e,n));else{if(!od(p))throw new Error("Invalid CanActivate guard");w=ru(p(e,n))}return w.pipe(VA())}))).pipe(s0()):pn(!0)}(n,o.route,t))),VA(o=>!0!==o,!0))}(r,c,n,e):pn(w)),An(w=>Object.assign(Object.assign({},t),{guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),bo(w=>{if(GA(w.guardsResult)){const L=Tb(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw L.url=w.guardsResult,L}const T=new i5(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(T)}),tu(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),Gb(w=>{if(w.guards.canActivateChecks.length)return pn(w).pipe(bo(T=>{const L=new o5(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(L)}),eu(T=>{let L=!1;return pn(T).pipe(function(n,e){return pr(t=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=t;if(!o.length)return pn(t);let c=0;return Lr(o).pipe(Up(p=>function(n,e,t,r){return function(n,e,t,r){const o=Object.keys(n);if(0===o.length)return pn({});const c={};return Lr(o).pipe(pr(p=>function(n,e,t,r){const o=Zy(n,e,r);return ru(o.resolve?o.resolve(e,t):o(e,t))}(n[p],e,t,r).pipe(bo(w=>{c[p]=w}))),Sb(1),pr(()=>Object.keys(c).length===o.length?pn(c):Vp))}(n._resolve,n,e,r).pipe(An(c=>(n._resolvedData=c,n.data=Object.assign(Object.assign({},n.data),IM(n,t).resolve),null)))}(p.route,r,n,e)),bo(()=>c++),Sb(1),pr(p=>c===o.length?pn(t):Vp))})}(this.paramsInheritanceStrategy,this.ngModule.injector),bo({next:()=>L=!0,complete:()=>{L||(this.restoreHistory(T),this.cancelNavigationTransition(T,"At least one route resolver didn't emit any value."))}}))}),bo(T=>{const L=new s5(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(L)}))}),Gb(w=>{const{targetSnapshot:T,id:L,extractedUrl:U,rawUrl:W,extras:{skipLocationChange:K,replaceUrl:ie}}=w;return this.hooks.afterPreactivation(T,{navigationId:L,appliedUrlTree:U,rawUrlTree:W,skipLocationChange:!!K,replaceUrl:!!ie})}),An(w=>{const T=function(n,e,t){const r=zy(n,e._root,t?t._root:void 0);return new MM(r,e)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return Object.assign(Object.assign({},w),{targetRouterState:T})}),bo(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((n,e,t)=>An(r=>(new $5(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),bo({next(){c=!0},complete(){c=!0}}),function(n){return e=>e.lift(new Jz(n))}(()=>{var w;if(!c&&!p){const T=`Navigation ID ${o.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(o),this.cancelNavigationTransition(o,T)):this.cancelNavigationTransition(o,T)}(null===(w=this.currentNavigation)||void 0===w?void 0:w.id)===o.id&&(this.currentNavigation=null)}),rd(w=>{if(p=!0,function(n){return n&&n[fM]}(w)){const T=GA(w.url);T||(this.navigated=!0,this.restoreHistory(o,!0));const L=new uM(o.id,this.serializeUrl(o.extractedUrl),w.message);r.next(L),T?setTimeout(()=>{const U=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),W={skipLocationChange:o.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Wy(o.source)};this.scheduleNavigation(U,"imperative",null,W,{resolve:o.resolve,reject:o.reject,promise:o.promise})},0):o.resolve(!1)}else{this.restoreHistory(o,!0);const T=new t5(o.id,this.serializeUrl(o.extractedUrl),w);r.next(T);try{o.resolve(this.errorHandler(w))}catch(L){o.reject(L)}}return Vp}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r=this.extractLocationChangeInfoFromEvent(t);this.shouldScheduleNavigation(this.lastLocationChangeInfo,r)&&setTimeout(()=>{const{source:o,state:c,urlTree:p}=r,w={replaceUrl:!0};if(c){const T=Object.assign({},c);delete T.navigationId,delete T.\u0275routerPageId,0!==Object.keys(T).length&&(w.state=T)}this.scheduleNavigation(p,o,c,w)},0),this.lastLocationChangeInfo=r}))}extractLocationChangeInfoFromEvent(t){var r;return{source:"popstate"===t.type?"popstate":"hashchange",urlTree:this.parseUrl(t.url),state:(null===(r=t.state)||void 0===r?void 0:r.navigationId)?t.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(t,r){if(!t)return!0;const o=r.urlTree.toString()===t.urlTree.toString();return r.transitionId!==t.transitionId||!o||!("hashchange"===r.source&&"popstate"===t.source||"popstate"===r.source&&"hashchange"===t.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){UM(t),this.config=t.map(Ub),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:o,queryParams:c,fragment:p,queryParamsHandling:w,preserveFragment:T}=r,L=o||this.routerState.root,U=T?this.currentUrlTree.fragment:p;let W=null;switch(w){case"merge":W=Object.assign(Object.assign({},this.currentUrlTree.queryParams),c);break;case"preserve":W=this.currentUrlTree.queryParams;break;default:W=c||null}return null!==W&&(W=this.removeEmptyProps(W)),function(n,e,t,r,o){if(0===t.length)return Bb(e.root,e.root,e,r,o);const c=function(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new OM(!0,0,n);let e=0,t=!1;const r=n.reduce((o,c,p)=>{if("object"==typeof c&&null!=c){if(c.outlets){const w={};return Go(c.outlets,(T,L)=>{w[L]="string"==typeof T?T.split("/"):T}),[...o,{outlets:w}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===p?(c.split("/").forEach((w,T)=>{0==T&&"."===w||(0==T&&""===w?t=!0:".."===w?e++:""!=w&&o.push(w))}),o):[...o,c]},[]);return new OM(t,e,r)}(t);if(c.toRoot())return Bb(e.root,new sr([],{}),e,r,o);const p=function(n,e,t){if(n.isAbsolute)return new Nb(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const c=t.snapshot._urlSegment;return new Nb(c,c===e.root,0)}const r=Vy(n.commands[0])?0:1;return function(n,e,t){let r=n,o=e,c=t;for(;c>o;){if(c-=o,r=r.parent,!r)throw new Error("Invalid number of '../'");o=r.segments.length}return new Nb(r,!1,o-c)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+r,n.numberOfDoubleDots)}(c,e,n),w=p.processChildren?Uy(p.segmentGroup,p.index,c.commands):LM(p.segmentGroup,p.index,c.commands);return Bb(p.segmentGroup,w,e,r,o)}(L,this.currentUrlTree,t,W,null!=U?U:null)}navigateByUrl(t,r={skipLocationChange:!1}){const o=GA(t)?t:this.parseUrl(t),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,r)}navigate(t,r={skipLocationChange:!1}){return function(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,t)}return r}isActive(t,r){let o;if(o=!0===r?Object.assign({},UV):!1===r?Object.assign({},jV):r,GA(t))return yM(this.currentUrlTree,t,o);const c=this.parseUrl(t);return yM(this.currentUrlTree,c,o)}removeEmptyProps(t){return Object.keys(t).reduce((r,o)=>{const c=t[o];return null!=c&&(r[o]=c),r},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new Jg(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,r,o,c,p){var w,T;if(this.disposed)return Promise.resolve(!1);const L=this.getTransition(),U=Wy(r)&&L&&!Wy(L.source),ie=(this.lastSuccessfulId===L.id||this.currentNavigation?L.rawUrl:L.urlAfterRedirects).toString()===t.toString();if(U&&ie)return Promise.resolve(!0);let fe,Ve,Re;p?(fe=p.resolve,Ve=p.reject,Re=p.promise):Re=new Promise((Rt,Zt)=>{fe=Rt,Ve=Zt});const Je=++this.navigationId;let He;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(o=this.location.getState()),He=o&&o.\u0275routerPageId?o.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?null!==(w=this.browserPageId)&&void 0!==w?w:0:(null!==(T=this.browserPageId)&&void 0!==T?T:0)+1):He=0,this.setTransition({id:Je,targetPageId:He,source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:c,resolve:fe,reject:Ve,promise:Re,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Re.catch(Rt=>Promise.reject(Rt))}setBrowserUrl(t,r){const o=this.urlSerializer.serialize(t),c=Object.assign(Object.assign({},r.extras.state),this.generateNgRouterState(r.id,r.targetPageId));this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl?this.location.replaceState(o,"",c):this.location.go(o,"",c)}restoreHistory(t,r=!1){var o,c;if("computed"===this.canceledNavigationResolution){const p=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)||0===p?this.currentUrlTree===(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)&&0===p&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(p)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,r){const o=new uM(t.id,this.serializeUrl(t.extractedUrl),r);this.triggerEvent(o),t.resolve(!1)}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)(_t(ju),_t(Ib),_t($p),_t(py),_t(Ir),_t(iy),_t(LA),_t(void 0))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function Wy(n){return"imperative"!==n}let rT=(()=>{class n{constructor(t,r,o,c,p){this.parentContexts=t,this.location=r,this.resolver=o,this.changeDetector=p,this.activated=null,this._activatedRoute=null,this.activateEvents=new tt,this.deactivateEvents=new tt,this.name=c||Yn,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const p=(r=r||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),w=this.parentContexts.getOrCreateContext(this.name).children,T=new qV(t,w,this.location.injector);this.activated=this.location.createComponent(p,this.location.length,T),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(at($p),at(Ql),at(RA),function(n){return function(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const r=t.length;let o=0;for(;o<r;){const c=t[o];if(te(c))break;if(0===c)o+=2;else if("number"==typeof c)for(o++;o<r&&"string"==typeof t[o];)o++;else{if(c===e)return t[o+1];o+=2}}}return null}(si(),n)}("name"),at(nx))},n.\u0275dir=Xt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),n})();class qV{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Gp?this.route:e===$p?this.childContexts:this.parent.get(e,t)}}class iT{}class oT{preload(e,t){return pn(null)}}let sT=(()=>{class n{constructor(t,r,o,c,p){this.router=t,this.injector=c,this.preloadingStrategy=p,this.loader=new tT(r,o,L=>t.triggerEvent(new hM(L)),L=>t.triggerEvent(new dM(L)))}setUpPreloading(){this.subscription=this.router.events.pipe(tu(t=>t instanceof Jg),Up(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(Kc);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const o=[];for(const c of r)if(c.loadChildren&&!c.canLoad&&c._loadedConfig){const p=c._loadedConfig;o.push(this.processRoutes(p.module,p.routes))}else c.loadChildren&&!c.canLoad?o.push(this.preloadConfig(t,c)):c.children&&o.push(this.processRoutes(t,c.children));return Lr(o).pipe(Zo(),An(c=>{}))}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>(r._loadedConfig?pn(r._loadedConfig):this.loader.load(t.injector,r)).pipe(pr(c=>(r._loadedConfig=c,this.processRoutes(c.module,c.routes)))))}}return n.\u0275fac=function(t){return new(t||n)(_t(ca),_t(iy),_t(LA),_t(Ir),_t(iT))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),Zb=(()=>{class n{constructor(t,r,o={}){this.router=t,this.viewportScroller=r,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof Mb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Jg&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof AM&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.router.triggerEvent(new AM(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(_t(ca),_t(US),_t(void 0))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const $A=new nn("ROUTER_CONFIGURATION"),aT=new nn("ROUTER_FORROOT_GUARD"),WV=[py,{provide:Ib,useClass:wM},{provide:ca,useFactory:function(n,e,t,r,o,c,p,w={},T,L){const U=new ca(null,n,e,t,r,o,c,mM(p));return T&&(U.urlHandlingStrategy=T),L&&(U.routeReuseStrategy=L),function(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy)}(w,U),w.enableTracing&&U.events.subscribe(W=>{var K,ie;null===(K=console.group)||void 0===K||K.call(console,`Router Event: ${W.constructor.name}`),console.log(W.toString()),console.log(W),null===(ie=console.groupEnd)||void 0===ie||ie.call(console)}),U},deps:[Ib,$p,py,Ir,iy,LA,$b,$A,[class{},new rs],[class{},new rs]]},$p,{provide:Gp,useFactory:function(n){return n.routerState.root},deps:[ca]},{provide:iy,useClass:HL},sT,oT,class{preload(e,t){return t().pipe(rd(()=>pn(null)))}},{provide:$A,useValue:{enableTracing:!1}}];function QV(){return new Nx("Router",ca)}let lT=(()=>{class n{constructor(t,r){}static forRoot(t,r){return{ngModule:n,providers:[WV,cT(t),{provide:aT,useFactory:KV,deps:[[ca,new rs,new Ei]]},{provide:$A,useValue:r||{}},{provide:zp,useFactory:YV,deps:[zA,[new qu(tb),new rs],$A]},{provide:Zb,useFactory:XV,deps:[ca,US,$A]},{provide:iT,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:oT},{provide:Nx,multi:!0,useFactory:QV},[Wb,{provide:jg,multi:!0,useFactory:n8,deps:[Wb]},{provide:uT,useFactory:r8,deps:[Wb]},{provide:ID,multi:!0,useExisting:uT}]]}}static forChild(t){return{ngModule:n,providers:[cT(t)]}}}return n.\u0275fac=function(t){return new(t||n)(_t(aT,8),_t(ca,8))},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({}),n})();function XV(n,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new Zb(n,e,t)}function YV(n,e,t={}){return t.useHash?new dB(n,e):new vS(n,e)}function KV(n){return"guarded"}function cT(n){return[{provide:Vh,multi:!0,useValue:n},{provide:$b,multi:!0,useValue:n}]}let Wb=(()=>{class n{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new _i}appInitializer(){return this.injector.get(cB,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const o=new Promise(w=>r=w),c=this.injector.get(ca),p=this.injector.get($A);return"disabled"===p.initialNavigation?(c.setUpLocationChangeListener(),r(!0)):"enabled"===p.initialNavigation||"enabledBlocking"===p.initialNavigation?(c.hooks.afterPreactivation=()=>this.initNavigation?pn(null):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),c.initialNavigation()):r(!0),o})}bootstrapListener(t){const r=this.injector.get($A),o=this.injector.get(sT),c=this.injector.get(Zb),p=this.injector.get(ca),w=this.injector.get(Lp);t===w.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&p.initialNavigation(),o.setUpPreloading(),c.init(),p.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(t){return new(t||n)(_t(Ir))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function n8(n){return n.appInitializer.bind(n)}function r8(n){return n.bootstrapListener.bind(n)}const uT=new nn("Router Initializer"),o8=[];let s8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({imports:[[lT.forRoot(o8)],lT]}),n})();class a8 extends wt{constructor(e,t){super()}schedule(e,t=0){return this}}class hT extends a8{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(o,this.id,t),this}requestAsyncId(e,t,r=0){return setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let o,r=!1;try{this.work(e)}catch(c){r=!0,o=!!c&&c||new Error(c)}if(r)return this.unsubscribe(),o}_unsubscribe(){const e=this.id,t=this.scheduler,r=t.actions,o=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==o&&r.splice(o,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let dT=(()=>{class n{constructor(t,r=n.now){this.SchedulerAction=t,this.now=r}schedule(t,r=0,o){return new this.SchedulerAction(this,t).schedule(o,r)}}return n.now=()=>Date.now(),n})();class Ah extends dT{constructor(e,t=dT.now){super(e,()=>Ah.delegate&&Ah.delegate!==this?Ah.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,r){return Ah.delegate&&Ah.delegate!==this?Ah.delegate.schedule(e,t,r):super.schedule(e,t,r)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const u8=new class extends Ah{}(class extends hT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(e,t,r):e.flush(this)}});function AT(n,e){return new Gn(e?t=>e.schedule(h8,0,{error:n,subscriber:t}):t=>t.error(n))}function h8({error:n,subscriber:e}){e.error(n)}class pl{constructor(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}}accept(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)}toObservable(){switch(this.kind){case"N":return pn(this.value);case"E":return AT(this.error);case"C":return Py()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new pl("N",e):pl.undefinedValueNotification}static createError(e){return new pl("E",void 0,e)}static createComplete(){return pl.completeNotification}}pl.completeNotification=new pl("C"),pl.undefinedValueNotification=new pl("N",void 0);class Qy extends $n{constructor(e,t,r=0){super(e),this.scheduler=t,this.delay=r}static dispatch(e){const{notification:t,destination:r}=e;t.observe(r),this.unsubscribe()}scheduleMessage(e){this.destination.add(this.scheduler.schedule(Qy.dispatch,this.delay,new A8(e,this.destination)))}_next(e){this.scheduleMessage(pl.createNext(e))}_error(e){this.scheduleMessage(pl.createError(e)),this.unsubscribe()}_complete(){this.scheduleMessage(pl.createComplete()),this.unsubscribe()}}class A8{constructor(e,t){this.notification=e,this.destination=t}}class Qb extends _i{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new f8(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),o=this.scheduler,c=r.length;let p;if(this.closed)throw new gs;if(this.isStopped||this.hasError?p=wt.EMPTY:(this.observers.push(e),p=new yl(this,e)),o&&e.add(e=new Qy(e,o)),t)for(let w=0;w<c&&!e.closed;w++)e.next(r[w]);else for(let w=0;w<c&&!e.closed;w++)e.next(r[w].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),p}_getNow(){return(this.scheduler||u8).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,r=this._windowTime,o=this._events,c=o.length;let p=0;for(;p<c&&!(e-o[p].time<r);)p++;return c>t&&(p=Math.max(p,c-t)),p>0&&o.splice(0,p),o}}class f8{constructor(e,t){this.time=e,this.value=t}}function Xy(n,e,t,r){return Gs(t)&&(r=t,t=void 0),r?Xy(n,e,t).pipe(An(o=>Ho(o)?r(...o):r(o))):new Gn(o=>{fT(n,e,function(p){o.next(arguments.length>1?Array.prototype.slice.call(arguments):p)},o,t)})}function fT(n,e,t,r,o){let c;if(function(n){return n&&"function"==typeof n.addEventListener&&"function"==typeof n.removeEventListener}(n)){const p=n;n.addEventListener(e,t,o),c=()=>p.removeEventListener(e,t,o)}else if(function(n){return n&&"function"==typeof n.on&&"function"==typeof n.off}(n)){const p=n;n.on(e,t),c=()=>p.off(e,t)}else if(function(n){return n&&"function"==typeof n.addListener&&"function"==typeof n.removeListener}(n)){const p=n;n.addListener(e,t),c=()=>p.removeListener(e,t)}else{if(!n||!n.length)throw new TypeError("Invalid event target");for(let p=0,w=n.length;p<w;p++)fT(n[p],e,t,r,o)}r.add(c)}const _8=new Ah(hT);function pT(n,e=_8){return t=>t.lift(new y8(n,e))}class y8{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new v8(e,this.dueTime,this.scheduler))}}class v8 extends $n{constructor(e,t,r){super(e),this.dueTime=t,this.scheduler=r,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(x8,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function x8(n){n.debouncedNext()}function sd(n,e,t,r){return new(t||(t=Promise))(function(c,p){function w(U){try{L(r.next(U))}catch(W){p(W)}}function T(U){try{L(r.throw(U))}catch(W){p(W)}}function L(U){U.done?c(U.value):function(c){return c instanceof t?c:new t(function(p){p(c)})}(U.value).then(w,T)}L((r=r.apply(n,e||[])).next())})}const yT=["*"];var Pr=(()=>(function(n){n.AnnotationChart="AnnotationChart",n.AreaChart="AreaChart",n.Bar="Bar",n.BarChart="BarChart",n.BubbleChart="BubbleChart",n.Calendar="Calendar",n.CandlestickChart="CandlestickChart",n.ColumnChart="ColumnChart",n.ComboChart="ComboChart",n.PieChart="PieChart",n.Gantt="Gantt",n.Gauge="Gauge",n.GeoChart="GeoChart",n.Histogram="Histogram",n.Line="Line",n.LineChart="LineChart",n.Map="Map",n.OrgChart="OrgChart",n.Sankey="Sankey",n.Scatter="Scatter",n.ScatterChart="ScatterChart",n.SteppedAreaChart="SteppedAreaChart",n.Table="Table",n.Timeline="Timeline",n.TreeMap="TreeMap",n.WordTree="wordtree"}(Pr||(Pr={})),Pr))();const D8={[Pr.AnnotationChart]:"annotationchart",[Pr.AreaChart]:"corechart",[Pr.Bar]:"bar",[Pr.BarChart]:"corechart",[Pr.BubbleChart]:"corechart",[Pr.Calendar]:"calendar",[Pr.CandlestickChart]:"corechart",[Pr.ColumnChart]:"corechart",[Pr.ComboChart]:"corechart",[Pr.PieChart]:"corechart",[Pr.Gantt]:"gantt",[Pr.Gauge]:"gauge",[Pr.GeoChart]:"geochart",[Pr.Histogram]:"corechart",[Pr.Line]:"line",[Pr.LineChart]:"corechart",[Pr.Map]:"map",[Pr.OrgChart]:"orgchart",[Pr.Sankey]:"sankey",[Pr.Scatter]:"scatter",[Pr.ScatterChart]:"corechart",[Pr.SteppedAreaChart]:"corechart",[Pr.Table]:"table",[Pr.Timeline]:"timeline",[Pr.TreeMap]:"treemap",[Pr.WordTree]:"wordtree"},bT=new nn("GOOGLE_CHARTS_CONFIG"),M8=new nn("GOOGLE_CHARTS_LAZY_CONFIG",{providedIn:"root",factory:()=>{const n=T0(bT,Qt.Optional);return pn(Object.assign(Object.assign({},{version:"current",safeMode:!1}),n||{}))}});let qp=(()=>{class n{constructor(t,r,o){this.zone=t,this.localeId=r,this.config$=o,this.scriptSource="https://www.gstatic.com/charts/loader.js",this.scriptLoadSubject=new _i}isGoogleChartsAvailable(){return!("undefined"==typeof google||void 0===google.charts)}loadChartPackages(...t){return this.loadGoogleCharts().pipe(pr(()=>this.config$),An(r=>Object.assign(Object.assign({},{version:"current",safeMode:!1}),r||{})),eu(r=>new Gn(o=>{google.charts.load(r.version,{packages:t,language:this.localeId,mapsApiKey:r.mapsApiKey,safeMode:r.safeMode}),google.charts.setOnLoadCallback(()=>{this.zone.run(()=>{o.next(),o.complete()})})})))}loadGoogleCharts(){if(this.isGoogleChartsAvailable())return pn(null);if(!this.isLoadingGoogleCharts()){const t=this.createGoogleChartsScript();t.onload=()=>{this.zone.run(()=>{this.scriptLoadSubject.next(),this.scriptLoadSubject.complete()})},t.onerror=()=>{this.zone.run(()=>{console.error("Failed to load the google charts script!"),this.scriptLoadSubject.error(new Error("Failed to load the google charts script!"))})}}return this.scriptLoadSubject.asObservable()}isLoadingGoogleCharts(){return null!=this.getGoogleChartsScript()}getGoogleChartsScript(){return Array.from(document.getElementsByTagName("script")).find(r=>r.src===this.scriptSource)}createGoogleChartsScript(){const t=document.createElement("script");return t.type="text/javascript",t.src=this.scriptSource,t.async=!0,document.getElementsByTagName("head")[0].appendChild(t),t}}return n.\u0275fac=function(t){return new(t||n)(_t(mi),_t(ah),_t(M8))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),wT=(()=>{class n{create(t,r,o){if(null==t)return;let c=!0;null!=r&&(c=!1);const p=google.visualization.arrayToDataTable(this.getDataAsTable(t,r),c);return o&&this.applyFormatters(p,o),p}getDataAsTable(t,r){return r?[r,...t]:t}applyFormatters(t,r){for(const o of r)o.formatter.format(t,o.colIndex)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({factory:function(){return new n},token:n,providedIn:"root"}),n})(),I8=(()=>{class n{constructor(t){this.loaderService=t,this.error=new tt,this.ready=new tt,this.stateChange=new tt,this.id="_"+Math.random().toString(36).substr(2,9),this.wrapperReadySubject=new Qb(1)}get wrapperReady$(){return this.wrapperReadySubject.asObservable()}get controlWrapper(){if(!this._controlWrapper)throw new Error("Cannot access the control wrapper before it being initialized.");return this._controlWrapper}ngOnInit(){this.loaderService.loadChartPackages("controls").subscribe(()=>{this.createControlWrapper()})}ngOnChanges(t){!this._controlWrapper||(t.type&&this._controlWrapper.setControlType(this.type),t.options&&this._controlWrapper.setOptions(this.options||{}),t.state&&this._controlWrapper.setState(this.state||{}))}createControlWrapper(){this._controlWrapper=new google.visualization.ControlWrapper({containerId:this.id,controlType:this.type,state:this.state,options:this.options}),this.addEventListeners(),this.wrapperReadySubject.next(this._controlWrapper)}addEventListeners(){google.visualization.events.removeAllListeners(this._controlWrapper),google.visualization.events.addListener(this._controlWrapper,"ready",t=>this.ready.emit(t)),google.visualization.events.addListener(this._controlWrapper,"error",t=>this.error.emit(t)),google.visualization.events.addListener(this._controlWrapper,"statechange",t=>this.stateChange.emit(t))}}return n.\u0275fac=function(t){return new(t||n)(at(qp))},n.\u0275cmp=Bo({type:n,selectors:[["control-wrapper"]],hostAttrs:[1,"control-wrapper"],hostVars:1,hostBindings:function(t,r){2&t&&B_("id",r.id)},inputs:{for:"for",type:"type",options:"options",state:"state"},outputs:{error:"error",ready:"ready",stateChange:"stateChange"},exportAs:["controlWrapper"],features:[Dr],decls:0,vars:0,template:function(t,r){},encapsulation:2,changeDetection:0}),n})(),k8=(()=>{class n{constructor(t,r,o){this.element=t,this.loaderService=r,this.dataTableService=o,this.ready=new tt,this.error=new tt,this.initialized=!1}ngOnInit(){this.loaderService.loadChartPackages("controls").subscribe(()=>{this.dataTable=this.dataTableService.create(this.data,this.columns,this.formatters),this.createDashboard(),this.initialized=!0})}ngOnChanges(t){!this.initialized||(t.data||t.columns||t.formatters)&&(this.dataTable=this.dataTableService.create(this.data,this.columns,this.formatters),this.dashboard.draw(this.dataTable))}createDashboard(){const t=this.controlWrappers.map(o=>o.wrapperReady$),r=this.controlWrappers.map(o=>o.for).map(o=>Array.isArray(o)?Cb(o.map(c=>c.wrapperReady$)):o.wrapperReady$);Cb([...t,...r]).subscribe(()=>{this.dashboard=new google.visualization.Dashboard(this.element.nativeElement),this.initializeBindings(),this.registerEvents(),this.dashboard.draw(this.dataTable)})}registerEvents(){google.visualization.events.removeAllListeners(this.dashboard);const t=(r,o,c)=>{google.visualization.events.addListener(r,o,c)};t(this.dashboard,"ready",()=>this.ready.emit()),t(this.dashboard,"error",r=>this.error.emit(r))}initializeBindings(){this.controlWrappers.forEach(t=>{if(Array.isArray(t.for)){const r=t.for.map(o=>o.chartWrapper);this.dashboard.bind(t.controlWrapper,r)}else this.dashboard.bind(t.controlWrapper,t.for.chartWrapper)})}}return n.\u0275fac=function(t){return new(t||n)(at(Wi),at(qp),at(wT))},n.\u0275cmp=Bo({type:n,selectors:[["dashboard"]],contentQueries:function(t,r,o){if(1&t&&function(n,e,t,r){const o=Wn();if(o.firstCreatePass){const c=si();uD(o,new aD(e,t,r),c.index),function(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(o,n),2==(2&t)&&(o.staticContentQueries=!0)}cD(o,ct(),t)}(o,I8,4),2&t){let c;Pp(c=Rp())&&(r.controlWrappers=c)}},hostAttrs:[1,"dashboard"],inputs:{data:"data",columns:"columns",formatters:"formatters"},outputs:{ready:"ready",error:"error"},exportAs:["dashboard"],features:[Dr],ngContentSelectors:yT,decls:1,vars:0,template:function(t,r){1&t&&(function(n){const e=ct()[16][6];if(!e.projection){const r=e.projection=Rc(n?n.length:1,null),o=r.slice();let c=e.child;for(;null!==c;){const p=n?YP(c,n):0;null!==p&&(o[p]?o[p].projectionNext=c:r[p]=c,o[p]=c),c=c.next}}}(),function(n,e=0,t){const r=ct(),o=Wn(),c=Ra(o,20+n,16,null,t||null);null===c.projection&&(c.projection=e),Rl(),64!=(64&c.flags)&&function(n,e,t){vA(e[11],0,e,t,Zf(n,t,e),Xm(t.parent||e[6],t,e))}(o,r,c)}(0))},encapsulation:2,changeDetection:0}),n})(),P8=(()=>{class n{constructor(t,r,o,c){this.element=t,this.scriptLoaderService=r,this.dataTableService=o,this.dashboard=c,this.options={},this.dynamicResize=!1,this.ready=new tt,this.error=new tt,this.select=new tt,this.mouseover=new tt,this.mouseleave=new tt,this.wrapperReadySubject=new Qb(1),this.initialized=!1,this.eventListeners=new Map}get chart(){return this.chartWrapper.getChart()}get wrapperReady$(){return this.wrapperReadySubject.asObservable()}get chartWrapper(){if(!this.wrapper)throw new Error("Trying to access the chart wrapper before it was fully initialized");return this.wrapper}set chartWrapper(t){this.wrapper=t,this.drawChart()}ngOnInit(){this.scriptLoaderService.loadChartPackages(function(n){return D8[n]}(this.type)).subscribe(()=>{this.dataTable=this.dataTableService.create(this.data,this.columns,this.formatters),this.wrapper=new google.visualization.ChartWrapper({container:this.element.nativeElement,chartType:this.type,dataTable:this.dataTable,options:this.mergeOptions()}),this.registerChartEvents(),this.wrapperReadySubject.next(this.wrapper),this.initialized=!0,this.drawChart()})}ngOnChanges(t){if(t.dynamicResize&&this.updateResizeListener(),this.initialized){let r=!1;(t.data||t.columns||t.formatters)&&(this.dataTable=this.dataTableService.create(this.data,this.columns,this.formatters),this.wrapper.setDataTable(this.dataTable),r=!0),t.type&&(this.wrapper.setChartType(this.type),r=!0),(t.options||t.width||t.height||t.title)&&(this.wrapper.setOptions(this.mergeOptions()),r=!0),r&&this.drawChart()}}ngOnDestroy(){this.unsubscribeToResizeIfSubscribed()}addEventListener(t,r){const o=this.registerChartEvent(this.chart,t,r);return this.eventListeners.set(o,{eventName:t,callback:r,handle:o}),o}removeEventListener(t){const r=this.eventListeners.get(t);r&&(google.visualization.events.removeListener(r.handle),this.eventListeners.delete(t))}updateResizeListener(){this.unsubscribeToResizeIfSubscribed(),this.dynamicResize&&(this.resizeSubscription=Xy(window,"resize",{passive:!0}).pipe(pT(100)).subscribe(()=>{this.initialized&&this.drawChart()}))}unsubscribeToResizeIfSubscribed(){null!=this.resizeSubscription&&(this.resizeSubscription.unsubscribe(),this.resizeSubscription=void 0)}mergeOptions(){return Object.assign({title:this.title,width:this.width,height:this.height},this.options)}registerChartEvents(){google.visualization.events.removeAllListeners(this.wrapper),this.registerChartEvent(this.wrapper,"ready",()=>{google.visualization.events.removeAllListeners(this.chart),this.registerChartEvent(this.chart,"onmouseover",t=>this.mouseover.emit(t)),this.registerChartEvent(this.chart,"onmouseout",t=>this.mouseleave.emit(t)),this.registerChartEvent(this.chart,"select",()=>{const t=this.chart.getSelection();this.select.emit({selection:t})}),this.eventListeners.forEach(t=>t.handle=this.registerChartEvent(this.chart,t.eventName,t.callback)),this.ready.emit({chart:this.chart})}),this.registerChartEvent(this.wrapper,"error",t=>this.error.emit(t))}registerChartEvent(t,r,o){return google.visualization.events.addListener(t,r,o)}drawChart(){null==this.dashboard&&this.wrapper.draw()}}return n.\u0275fac=function(t){return new(t||n)(at(Wi),at(qp),at(wT),at(k8,8))},n.\u0275cmp=Bo({type:n,selectors:[["google-chart"]],hostAttrs:[1,"google-chart"],inputs:{options:"options",dynamicResize:"dynamicResize",type:"type",data:"data",columns:"columns",title:"title",width:"width",height:"height",formatters:"formatters"},outputs:{ready:"ready",error:"error",select:"select",mouseover:"mouseover",mouseleave:"mouseleave"},exportAs:["googleChart"],features:[Dr],decls:0,vars:0,template:function(t,r){},styles:["[_nghost-%COMP%] { width: fit-content; display: block; }"],changeDetection:0}),n})(),R8=(()=>{class n{static forRoot(t={}){return{ngModule:n,providers:[{provide:bT,useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({providers:[qp]}),n})();var Zp=Ba(958);class CT extends _i{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(e){return this.hasError?(e.error(this.thrownError),wt.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),wt.EMPTY):super._subscribe(e)}next(e){this.hasCompleted||(this.value=e,this.hasNext=!0)}error(e){this.hasCompleted||super.error(e)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}class O8{constructor(e){this.value=e}call(e,t){return t.subscribe(new L8(e,this.value))}}class L8 extends $n{constructor(e,t){super(e),this.value=t}_next(e){this.destination.next(this.value)}}const B8=["container"],DT=new nn("MapboxApiKey");let Ky=(()=>{class n{constructor(t,r){this.zone=t,this.MAPBOX_API_KEY=r,this.mapCreated=new CT,this.mapLoaded=new CT,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new wt,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(t){this.zone.onStable.pipe(VA()).subscribe(()=>{this.assign(Zp,"accessToken",t.accessToken||this.MAPBOX_API_KEY),t.customMapboxApiUrl&&this.assign(Zp,"config.API_URL",t.customMapboxApiUrl),this.createMap(t.mapOptions),this.hookEvents(t.mapEvents),this.mapEvents=t.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete()})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(t)})}updateMaxZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(t)})}updateMinPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(t)})}updateMaxPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(t)})}updateRenderWorldCopies(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(t)})}updateScrollZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(t)})}updateMaxBounds(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(t)})}changeCanvasCursor(t){this.mapInstance.getCanvasContainer().style.cursor=t}queryRenderedFeatures(t,r){return this.mapInstance.queryRenderedFeatures(t,r)}panTo(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(t,r)})}move(t,r,o,c,p,w){return this.zone.runOutsideAngular(()=>{this.mapInstance[t](Object.assign(Object.assign({},r),{zoom:null!=o?o:this.mapInstance.getZoom(),center:null!=c?c:this.mapInstance.getCenter(),bearing:null!=p?p:this.mapInstance.getBearing(),pitch:null!=w?w:this.mapInstance.getPitch()}))})}addLayer(t,r,o){this.zone.runOutsideAngular(()=>{Object.keys(t.layerOptions).forEach(c=>{void 0===t.layerOptions[c]&&delete t.layerOptions[c]}),this.mapInstance.addLayer(t.layerOptions,o),r&&((t.layerEvents.layerClick.observers.length||t.layerEvents.click.observers.length)&&this.mapInstance.on("click",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerClick.emit(c),t.layerEvents.click.emit(c)})}),(t.layerEvents.layerDblClick.observers.length||t.layerEvents.dblClick.observers.length)&&this.mapInstance.on("dblclick",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerDblClick.emit(c),t.layerEvents.dblClick.emit(c)})}),(t.layerEvents.layerMouseDown.observers.length||t.layerEvents.mouseDown.observers.length)&&this.mapInstance.on("mousedown",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseDown.emit(c),t.layerEvents.mouseDown.emit(c)})}),(t.layerEvents.layerMouseUp.observers.length||t.layerEvents.mouseUp.observers.length)&&this.mapInstance.on("mouseup",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseUp.emit(c),t.layerEvents.mouseUp.emit(c)})}),(t.layerEvents.layerMouseEnter.observers.length||t.layerEvents.mouseEnter.observers.length)&&this.mapInstance.on("mouseenter",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseEnter.emit(c),t.layerEvents.mouseEnter.emit(c)})}),(t.layerEvents.layerMouseLeave.observers.length||t.layerEvents.mouseLeave.observers.length)&&this.mapInstance.on("mouseleave",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseLeave.emit(c),t.layerEvents.mouseLeave.emit(c)})}),(t.layerEvents.layerMouseMove.observers.length||t.layerEvents.mouseMove.observers.length)&&this.mapInstance.on("mousemove",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseMove.emit(c),t.layerEvents.mouseMove.emit(c)})}),(t.layerEvents.layerMouseOver.observers.length||t.layerEvents.mouseOver.observers.length)&&this.mapInstance.on("mouseover",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseOver.emit(c),t.layerEvents.mouseOver.emit(c)})}),(t.layerEvents.layerMouseOut.observers.length||t.layerEvents.mouseOut.observers.length)&&this.mapInstance.on("mouseout",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerMouseOut.emit(c),t.layerEvents.mouseOut.emit(c)})}),(t.layerEvents.layerContextMenu.observers.length||t.layerEvents.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerContextMenu.emit(c),t.layerEvents.contextMenu.emit(c)})}),(t.layerEvents.layerTouchStart.observers.length||t.layerEvents.touchStart.observers.length)&&this.mapInstance.on("touchstart",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerTouchStart.emit(c),t.layerEvents.touchStart.emit(c)})}),(t.layerEvents.layerTouchEnd.observers.length||t.layerEvents.touchEnd.observers.length)&&this.mapInstance.on("touchend",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerTouchEnd.emit(c),t.layerEvents.touchEnd.emit(c)})}),(t.layerEvents.layerTouchCancel.observers.length||t.layerEvents.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",t.layerOptions.id,c=>{this.zone.run(()=>{t.layerEvents.layerTouchCancel.emit(c),t.layerEvents.touchCancel.emit(c)})}))})}removeLayer(t){this.zone.runOutsideAngular(()=>{null!=this.mapInstance.getLayer(t)&&this.mapInstance.removeLayer(t)})}addMarker(t){const r={offset:t.markersOptions.offset,anchor:t.markersOptions.anchor,draggable:!!t.markersOptions.draggable,rotationAlignment:t.markersOptions.rotationAlignment,pitchAlignment:t.markersOptions.pitchAlignment,clickTolerance:t.markersOptions.clickTolerance};t.markersOptions.element.childNodes.length>0&&(r.element=t.markersOptions.element);const o=new Zp.Marker(r);return(t.markersEvents.markerDragStart.observers.length||t.markersEvents.dragStart.observers.length)&&o.on("dragstart",p=>{if(p){const{target:w}=p;this.zone.run(()=>{t.markersEvents.markerDragStart.emit(w),t.markersEvents.dragStart.emit(w)})}}),(t.markersEvents.markerDrag.observers.length||t.markersEvents.drag.observers.length)&&o.on("drag",p=>{if(p){const{target:w}=p;this.zone.run(()=>{t.markersEvents.markerDrag.emit(w),t.markersEvents.drag.emit(w)})}}),(t.markersEvents.markerDragEnd.observers.length||t.markersEvents.dragEnd.observers.length)&&o.on("dragend",p=>{if(p){const{target:w}=p;this.zone.run(()=>{t.markersEvents.markerDragEnd.emit(w),t.markersEvents.dragEnd.emit(w)})}}),o.setLngLat(t.markersOptions.feature?t.markersOptions.feature.geometry.coordinates:t.markersOptions.lngLat),this.zone.runOutsideAngular(()=>(o.addTo(this.mapInstance),o))}removeMarker(t){this.markersToRemove.push(t)}createPopup(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(t.popupOptions).forEach(c=>void 0===t.popupOptions[c]&&delete t.popupOptions[c]);const o=new Zp.Popup(t.popupOptions);return o.setDOMContent(r),(t.popupEvents.popupClose.observers.length||t.popupEvents.close.observers.length)&&o.on("close",()=>{this.zone.run(()=>{t.popupEvents.popupClose.emit(),t.popupEvents.close.emit()})}),(t.popupEvents.popupOpen.observers.length||t.popupEvents.open.observers.length)&&o.on("open",()=>{this.zone.run(()=>{t.popupEvents.popupOpen.emit(),t.popupEvents.open.emit()})}),o})}addPopupToMap(t,r,o=!1){return this.zone.runOutsideAngular(()=>{o&&t._listeners&&delete t._listeners.open,t.setLngLat(r),t.addTo(this.mapInstance)})}addPopupToMarker(t,r){return this.zone.runOutsideAngular(()=>{t.setPopup(r)})}removePopupFromMap(t,r=!1){r&&t._listeners&&delete t._listeners.close,this.popupsToRemove.push(t)}removePopupFromMarker(t){return this.zone.runOutsideAngular(()=>{t.setPopup(void 0)})}addControl(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(t,r)})}removeControl(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(t)})}loadAndAddImage(t,r,o){return sd(this,void 0,void 0,function*(){return this.zone.runOutsideAngular(()=>new Promise((c,p)=>{this.mapInstance.loadImage(r,(w,T)=>{w?p(w):(this.addImage(t,T,o),c())})}))})}addImage(t,r,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(t,r,o)})}removeImage(t){this.imageIdsToRemove.push(t)}addSource(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(o=>void 0===r[o]&&delete r[o]),this.mapInstance.addSource(t,r)})}getSource(t){return this.mapInstance.getSource(t)}removeSource(t){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(t).forEach(r=>this.mapInstance.removeLayer(r.id)),this.mapInstance.removeSource(t)})}setAllLayerPaintProperty(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(o=>{this.mapInstance.setPaintProperty(t,o,r[o])})})}setAllLayerLayoutProperty(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(o=>{this.mapInstance.setLayoutProperty(t,o,r[o])})})}setLayerFilter(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(t,r)})}setLayerBefore(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(t,r)})}setLayerZoomRange(t,r,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(t,r||0,o||20)})}fitBounds(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(t,r)})}fitScreenCoordinates(t,r,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(t[0],t[1],r,o)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(t){mi.assertNotInAngularZone(),Object.keys(t).forEach(o=>{void 0===t[o]&&delete t[o]}),this.mapInstance=new Zp.Map(t),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(t.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(const t of this.markersToRemove)t.remove();this.markersToRemove=[]}removePopups(){for(const t of this.popupsToRemove)t.remove();this.popupsToRemove=[]}removeImages(){for(const t of this.imageIdsToRemove)this.mapInstance.removeImage(t);this.imageIdsToRemove=[]}findLayersBySourceId(t){const r=this.mapInstance.getStyle().layers;return null==r?[]:r.filter(o=>"source"in o&&o.source===t)}hookEvents(t){this.mapInstance.on("load",r=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{t.mapLoad.emit(r.target),t.load.emit(r.target)})}),(t.mapResize.observers.length||t.resize.observers.length)&&this.mapInstance.on("resize",r=>this.zone.run(()=>{t.mapResize.emit(r),t.resize.emit(r)})),(t.mapRemove.observers.length||t.remove.observers.length)&&this.mapInstance.on("remove",r=>this.zone.run(()=>{t.mapRemove.emit(r),t.remove.emit(r)})),(t.mapMouseDown.observers.length||t.mouseDown.observers.length)&&this.mapInstance.on("mousedown",r=>this.zone.run(()=>{t.mapMouseDown.emit(r),t.mouseDown.emit(r)})),(t.mapMouseUp.observers.length||t.mouseUp.observers.length)&&this.mapInstance.on("mouseup",r=>this.zone.run(()=>{t.mapMouseUp.emit(r),t.mouseUp.emit(r)})),(t.mapMouseMove.observers.length||t.mouseMove.observers.length)&&this.mapInstance.on("mousemove",r=>this.zone.run(()=>{t.mapMouseMove.emit(r),t.mouseMove.emit(r)})),(t.mapClick.observers.length||t.click.observers.length)&&this.mapInstance.on("click",r=>this.zone.run(()=>{t.mapClick.emit(r),t.click.emit(r)})),(t.mapDblClick.observers.length||t.dblClick.observers.length)&&this.mapInstance.on("dblclick",r=>this.zone.run(()=>{t.mapDblClick.emit(r),t.dblClick.emit(r)})),(t.mapMouseOver.observers.length||t.mouseOver.observers.length)&&this.mapInstance.on("mouseover",r=>this.zone.run(()=>{t.mapMouseOver.emit(r),t.mouseOver.emit(r)})),(t.mapMouseOut.observers.length||t.mouseOut.observers.length)&&this.mapInstance.on("mouseout",r=>this.zone.run(()=>{t.mapMouseOut.emit(r),t.mouseOut.emit(r)})),(t.mapContextMenu.observers.length||t.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",r=>this.zone.run(()=>{t.mapContextMenu.emit(r),t.contextMenu.emit(r)})),(t.mapTouchStart.observers.length||t.touchStart.observers.length)&&this.mapInstance.on("touchstart",r=>this.zone.run(()=>{t.mapTouchStart.emit(r),t.touchStart.emit(r)})),(t.mapTouchEnd.observers.length||t.touchEnd.observers.length)&&this.mapInstance.on("touchend",r=>this.zone.run(()=>{t.mapTouchEnd.emit(r),t.touchEnd.emit(r)})),(t.mapTouchMove.observers.length||t.touchMove.observers.length)&&this.mapInstance.on("touchmove",r=>this.zone.run(()=>{t.mapTouchMove.emit(r),t.touchMove.emit(r)})),(t.mapTouchCancel.observers.length||t.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",r=>this.zone.run(()=>{t.mapTouchCancel.emit(r),t.touchCancel.emit(r)})),(t.mapWheel.observers.length||t.wheel.observers.length)&&this.mapInstance.on("wheel",r=>this.zone.run(()=>{t.mapWheel.emit(r),t.wheel.emit(r)})),t.moveStart.observers.length&&this.mapInstance.on("movestart",r=>this.zone.run(()=>t.moveStart.emit(r))),t.move.observers.length&&this.mapInstance.on("move",r=>this.zone.run(()=>t.move.emit(r))),t.moveEnd.observers.length&&this.mapInstance.on("moveend",r=>this.zone.run(()=>t.moveEnd.emit(r))),(t.mapDragStart.observers.length||t.dragStart.observers.length)&&this.mapInstance.on("dragstart",r=>this.zone.run(()=>{t.mapDragStart.emit(r),t.dragStart.emit(r)})),(t.mapDrag.observers.length||t.drag.observers.length)&&this.mapInstance.on("drag",r=>this.zone.run(()=>{t.mapDrag.emit(r),t.drag.emit(r)})),(t.mapDragEnd.observers.length||t.dragEnd.observers.length)&&this.mapInstance.on("dragend",r=>this.zone.run(()=>{t.mapDragEnd.emit(r),t.dragEnd.emit(r)})),t.zoomStart.observers.length&&this.mapInstance.on("zoomstart",r=>this.zone.run(()=>t.zoomStart.emit(r))),t.zoomEvt.observers.length&&this.mapInstance.on("zoom",r=>this.zone.run(()=>t.zoomEvt.emit(r))),t.zoomEnd.observers.length&&this.mapInstance.on("zoomend",r=>this.zone.run(()=>t.zoomEnd.emit(r))),t.rotateStart.observers.length&&this.mapInstance.on("rotatestart",r=>this.zone.run(()=>t.rotateStart.emit(r))),t.rotate.observers.length&&this.mapInstance.on("rotate",r=>this.zone.run(()=>t.rotate.emit(r))),t.rotateEnd.observers.length&&this.mapInstance.on("rotateend",r=>this.zone.run(()=>t.rotateEnd.emit(r))),t.pitchStart.observers.length&&this.mapInstance.on("pitchstart",r=>this.zone.run(()=>t.pitchStart.emit(r))),t.pitchEvt.observers.length&&this.mapInstance.on("pitch",r=>this.zone.run(()=>t.pitchEvt.emit(r))),t.pitchEnd.observers.length&&this.mapInstance.on("pitchend",r=>this.zone.run(()=>t.pitchEnd.emit(r))),t.boxZoomStart.observers.length&&this.mapInstance.on("boxzoomstart",r=>this.zone.run(()=>t.boxZoomStart.emit(r))),t.boxZoomEnd.observers.length&&this.mapInstance.on("boxzoomend",r=>this.zone.run(()=>t.boxZoomEnd.emit(r))),t.boxZoomCancel.observers.length&&this.mapInstance.on("boxzoomcancel",r=>this.zone.run(()=>t.boxZoomCancel.emit(r))),t.webGlContextLost.observers.length&&this.mapInstance.on("webglcontextlost",r=>this.zone.run(()=>t.webGlContextLost.emit(r))),t.webGlContextRestored.observers.length&&this.mapInstance.on("webglcontextrestored",r=>this.zone.run(()=>t.webGlContextRestored.emit(r))),t.render.observers.length&&this.mapInstance.on("render",r=>this.zone.run(()=>t.render.emit(r))),(t.mapError.observers.length||t.error.observers.length)&&this.mapInstance.on("error",r=>this.zone.run(()=>{t.mapError.emit(r),t.error.emit(r)})),t.data.observers.length&&this.mapInstance.on("data",r=>this.zone.run(()=>t.data.emit(r))),t.styleData.observers.length&&this.mapInstance.on("styledata",r=>this.zone.run(()=>t.styleData.emit(r))),t.sourceData.observers.length&&this.mapInstance.on("sourcedata",r=>this.zone.run(()=>t.sourceData.emit(r))),t.dataLoading.observers.length&&this.mapInstance.on("dataloading",r=>this.zone.run(()=>t.dataLoading.emit(r))),t.styleDataLoading.observers.length&&this.mapInstance.on("styledataloading",r=>this.zone.run(()=>t.styleDataLoading.emit(r))),t.sourceDataLoading.observers.length&&this.mapInstance.on("sourcedataloading",r=>this.zone.run(()=>t.sourceDataLoading.emit(r))),t.styleImageMissing.observers.length&&this.mapInstance.on("styleimagemissing",r=>this.zone.run(()=>t.styleImageMissing.emit(r))),t.idle.observers.length&&this.mapInstance.on("idle",r=>this.zone.run(()=>t.idle.emit(r)))}assign(t,r,o){if("string"==typeof r&&(r=r.split(".")),r.length>1){const c=r.shift();this.assign(t[c]="[object Object]"===Object.prototype.toString.call(t[c])?t[c]:{},r,o)}else t[r[0]]=o}}return n.\u0275fac=function(t){return new(t||n)(_t(mi),_t(DT,8))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();function ST(n,e,t){console.warn(`[ngx-mapbox-gl]: ${n}: ${e} is deprecated, please use ${t} instead.`)}let j8=(()=>{class n{constructor(t,r){this.MapService=t,this.zone=r,this.updateFeatureData=new _i,this.sub=new wt,this.sourceAdded=!1,this.featureIdCounter=0}ngOnInit(){this.data||(this.data={type:"FeatureCollection",features:[]});const t=this.MapService.mapLoaded$.subscribe(()=>{this.init();const r=Xy(this.MapService.mapInstance,"styledata").pipe(tu(()=>!this.MapService.mapInstance.getSource(this.id))).subscribe(()=>{this.init()});this.sub.add(r)});this.sub.add(t)}ngOnChanges(t){if(this.sourceAdded&&((t.maxzoom&&!t.maxzoom.isFirstChange()||t.attribution&&!t.attribution.isFirstChange()||t.buffer&&!t.buffer.isFirstChange()||t.tolerance&&!t.tolerance.isFirstChange()||t.cluster&&!t.cluster.isFirstChange()||t.clusterRadius&&!t.clusterRadius.isFirstChange()||t.clusterMaxZoom&&!t.clusterMaxZoom.isFirstChange()||t.clusterMinPoints&&!t.clusterMinPoints.isFirstChange()||t.clusterProperties&&!t.clusterProperties.isFirstChange()||t.lineMetrics&&!t.lineMetrics.isFirstChange()||t.generateId&&!t.generateId.isFirstChange()||t.promoteId&&!t.promoteId.isFirstChange()||t.filter&&!t.filter.isFirstChange())&&(this.ngOnDestroy(),this.ngOnInit()),t.data&&!t.data.isFirstChange())){const r=this.MapService.getSource(this.id);if(void 0===r)return;r.setData(this.data)}}ngOnDestroy(){this.sub.unsubscribe(),this.sourceAdded&&(this.MapService.removeSource(this.id),this.sourceAdded=!1)}getClusterExpansionZoom(t){return sd(this,void 0,void 0,function*(){const r=this.MapService.getSource(this.id);return this.zone.run(()=>sd(this,void 0,void 0,function*(){return new Promise((o,c)=>{r.getClusterExpansionZoom(t,(p,w)=>{p?c(p):o(w)})})}))})}getClusterChildren(t){return sd(this,void 0,void 0,function*(){const r=this.MapService.getSource(this.id);return this.zone.run(()=>sd(this,void 0,void 0,function*(){return new Promise((o,c)=>{r.getClusterChildren(t,(p,w)=>{p?c(p):o(w)})})}))})}getClusterLeaves(t,r,o){return sd(this,void 0,void 0,function*(){const c=this.MapService.getSource(this.id);return this.zone.run(()=>sd(this,void 0,void 0,function*(){return new Promise((p,w)=>{c.getClusterLeaves(t,r,o,(T,L)=>{T?w(T):p(L)})})}))})}_addFeature(t){this.data.features.push(t),this.updateFeatureData.next()}_removeFeature(t){const r=this.data,o=r.features.indexOf(t);o>-1&&r.features.splice(o,1),this.updateFeatureData.next()}_getNewFeatureId(){return++this.featureIdCounter}init(){this.MapService.addSource(this.id,{type:"geojson",data:this.data,maxzoom:this.maxzoom,attribution:this.attribution,buffer:this.buffer,tolerance:this.tolerance,cluster:this.cluster,clusterRadius:this.clusterRadius,clusterMaxZoom:this.clusterMaxZoom,clusterMinPoints:this.clusterMinPoints,clusterProperties:this.clusterProperties,lineMetrics:this.lineMetrics,generateId:this.generateId,promoteId:this.promoteId,filter:this.filter});const r=this.updateFeatureData.pipe(pT(0)).subscribe(()=>{const o=this.MapService.getSource(this.id);void 0!==o&&o.setData(this.data)});this.sub.add(r),this.sourceAdded=!0}}return n.\u0275fac=function(t){return new(t||n)(at(Ky),at(mi))},n.\u0275cmp=Bo({type:n,selectors:[["mgl-geojson-source"]],inputs:{id:"id",data:"data",maxzoom:"maxzoom",attribution:"attribution",buffer:"buffer",tolerance:"tolerance",cluster:"cluster",clusterRadius:"clusterRadius",clusterMaxZoom:"clusterMaxZoom",clusterMinPoints:"clusterMinPoints",clusterProperties:"clusterProperties",lineMetrics:"lineMetrics",generateId:"generateId",promoteId:"promoteId",filter:"filter"},features:[Dr],decls:0,vars:0,template:function(t,r){},encapsulation:2,changeDetection:0}),n})(),G8=(()=>{class n{constructor(t){this.MapService=t,this.layerClick=new tt,this.layerDblClick=new tt,this.layerMouseDown=new tt,this.layerMouseUp=new tt,this.layerMouseEnter=new tt,this.layerMouseLeave=new tt,this.layerMouseMove=new tt,this.layerMouseOver=new tt,this.layerMouseOut=new tt,this.layerContextMenu=new tt,this.layerTouchStart=new tt,this.layerTouchEnd=new tt,this.layerTouchCancel=new tt,this.click=new tt,this.dblClick=new tt,this.mouseDown=new tt,this.mouseUp=new tt,this.mouseEnter=new tt,this.mouseLeave=new tt,this.mouseMove=new tt,this.mouseOver=new tt,this.mouseOut=new tt,this.contextMenu=new tt,this.touchStart=new tt,this.touchEnd=new tt,this.touchCancel=new tt,this.layerAdded=!1}ngOnInit(){this.warnDeprecatedOutputs(),this.sub=this.MapService.mapLoaded$.pipe(eu(()=>Xy(this.MapService.mapInstance,"styledata").pipe(e=>e.lift(new O8(!1)),tu(()=>!this.MapService.mapInstance.getLayer(this.id)),sM(!0)))).subscribe(t=>this.init(t))}ngOnChanges(t){!this.layerAdded||(t.paint&&!t.paint.isFirstChange()&&this.MapService.setAllLayerPaintProperty(this.id,t.paint.currentValue),t.layout&&!t.layout.isFirstChange()&&this.MapService.setAllLayerLayoutProperty(this.id,t.layout.currentValue),t.filter&&!t.filter.isFirstChange()&&this.MapService.setLayerFilter(this.id,t.filter.currentValue),t.before&&!t.before.isFirstChange()&&this.MapService.setLayerBefore(this.id,t.before.currentValue),(t.minzoom&&!t.minzoom.isFirstChange()||t.maxzoom&&!t.maxzoom.isFirstChange())&&this.MapService.setLayerZoomRange(this.id,this.minzoom,this.maxzoom))}ngOnDestroy(){this.layerAdded&&this.MapService.removeLayer(this.id),this.sub&&this.sub.unsubscribe()}init(t){this.MapService.addLayer({layerOptions:{id:this.id,type:this.type,source:this.source,metadata:this.metadata,"source-layer":this.sourceLayer,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this.layout,paint:this.paint},layerEvents:{layerClick:this.layerClick,layerDblClick:this.layerDblClick,layerMouseDown:this.layerMouseDown,layerMouseUp:this.layerMouseUp,layerMouseEnter:this.layerMouseEnter,layerMouseLeave:this.layerMouseLeave,layerMouseMove:this.layerMouseMove,layerMouseOver:this.layerMouseOver,layerMouseOut:this.layerMouseOut,layerContextMenu:this.layerContextMenu,layerTouchStart:this.layerTouchStart,layerTouchEnd:this.layerTouchEnd,layerTouchCancel:this.layerTouchCancel,click:this.click,dblClick:this.dblClick,mouseDown:this.mouseDown,mouseUp:this.mouseUp,mouseEnter:this.mouseEnter,mouseLeave:this.mouseLeave,mouseMove:this.mouseMove,mouseOver:this.mouseOver,mouseOut:this.mouseOut,contextMenu:this.contextMenu,touchStart:this.touchStart,touchEnd:this.touchEnd,touchCancel:this.touchCancel}},t,this.before),this.layerAdded=!0}warnDeprecatedOutputs(){const t=ST.bind(void 0,n.name);this.click.observers.length&&t("click","layerClick"),this.dblClick.observers.length&&t("dblClick","layerDblClick"),this.mouseDown.observers.length&&t("mouseDown","layerMouseDown"),this.mouseUp.observers.length&&t("mouseUp","layerMouseUp"),this.mouseEnter.observers.length&&t("mouseEnter","layerMouseEnter"),this.mouseLeave.observers.length&&t("mouseLeave","layerMouseLeave"),this.mouseMove.observers.length&&t("mouseMove","layerMouseMove"),this.mouseOver.observers.length&&t("mouseOver","layerMouseOver"),this.mouseOut.observers.length&&t("mouseOut","layerMouseOut"),this.contextMenu.observers.length&&t("contextMenu","layerContextMenu"),this.touchStart.observers.length&&t("touchStart","layerTouchStart"),this.touchEnd.observers.length&&t("touchEnd","layerTouchEnd"),this.touchCancel.observers.length&&t("touchCancel","layerTouchCancel")}}return n.\u0275fac=function(t){return new(t||n)(at(Ky))},n.\u0275cmp=Bo({type:n,selectors:[["mgl-layer"]],inputs:{id:"id",source:"source",type:"type",metadata:"metadata",sourceLayer:"sourceLayer",filter:"filter",layout:"layout",paint:"paint",before:"before",minzoom:"minzoom",maxzoom:"maxzoom"},outputs:{layerClick:"layerClick",layerDblClick:"layerDblClick",layerMouseDown:"layerMouseDown",layerMouseUp:"layerMouseUp",layerMouseEnter:"layerMouseEnter",layerMouseLeave:"layerMouseLeave",layerMouseMove:"layerMouseMove",layerMouseOver:"layerMouseOver",layerMouseOut:"layerMouseOut",layerContextMenu:"layerContextMenu",layerTouchStart:"layerTouchStart",layerTouchEnd:"layerTouchEnd",layerTouchCancel:"layerTouchCancel",click:"click",dblClick:"dblClick",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseEnter:"mouseEnter",mouseLeave:"mouseLeave",mouseMove:"mouseMove",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchCancel:"touchCancel"},features:[Dr],decls:0,vars:0,template:function(t,r){},encapsulation:2}),n})(),MT=(()=>{class n{constructor(t){this.MapService=t,this.movingMethod="flyTo",this.mapResize=new tt,this.mapRemove=new tt,this.mapMouseDown=new tt,this.mapMouseUp=new tt,this.mapMouseMove=new tt,this.mapClick=new tt,this.mapDblClick=new tt,this.mapMouseOver=new tt,this.mapMouseOut=new tt,this.mapContextMenu=new tt,this.mapTouchStart=new tt,this.mapTouchEnd=new tt,this.mapTouchMove=new tt,this.mapTouchCancel=new tt,this.mapWheel=new tt,this.moveStart=new tt,this.move=new tt,this.moveEnd=new tt,this.mapDragStart=new tt,this.mapDrag=new tt,this.mapDragEnd=new tt,this.zoomStart=new tt,this.zoomEvt=new tt,this.zoomEnd=new tt,this.rotateStart=new tt,this.rotate=new tt,this.rotateEnd=new tt,this.pitchStart=new tt,this.pitchEvt=new tt,this.pitchEnd=new tt,this.boxZoomStart=new tt,this.boxZoomEnd=new tt,this.boxZoomCancel=new tt,this.webGlContextLost=new tt,this.webGlContextRestored=new tt,this.mapLoad=new tt,this.idle=new tt,this.render=new tt,this.mapError=new tt,this.data=new tt,this.styleData=new tt,this.sourceData=new tt,this.dataLoading=new tt,this.styleDataLoading=new tt,this.sourceDataLoading=new tt,this.styleImageMissing=new tt,this.resize=new tt,this.remove=new tt,this.mouseDown=new tt,this.mouseUp=new tt,this.mouseMove=new tt,this.click=new tt,this.dblClick=new tt,this.mouseOver=new tt,this.mouseOut=new tt,this.contextMenu=new tt,this.touchStart=new tt,this.touchEnd=new tt,this.touchMove=new tt,this.touchCancel=new tt,this.wheel=new tt,this.dragStart=new tt,this.drag=new tt,this.dragEnd=new tt,this.load=new tt,this.error=new tt}get mapInstance(){return this.MapService.mapInstance}ngAfterViewInit(){this.warnDeprecatedOutputs(),this.MapService.setup({accessToken:this.accessToken,customMapboxApiUrl:this.customMapboxApiUrl,mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale},mapEvents:this}),this.cursorStyle&&this.MapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.MapService.destroyMap()}ngOnChanges(t){return sd(this,void 0,void 0,function*(){yield this.MapService.mapCreated$.toPromise(),t.cursorStyle&&!t.cursorStyle.isFirstChange()&&this.MapService.changeCanvasCursor(t.cursorStyle.currentValue),t.minZoom&&!t.minZoom.isFirstChange()&&this.MapService.updateMinZoom(t.minZoom.currentValue),t.maxZoom&&!t.maxZoom.isFirstChange()&&this.MapService.updateMaxZoom(t.maxZoom.currentValue),t.minPitch&&!t.minPitch.isFirstChange()&&this.MapService.updateMinPitch(t.minPitch.currentValue),t.maxPitch&&!t.maxPitch.isFirstChange()&&this.MapService.updateMaxPitch(t.maxPitch.currentValue),t.renderWorldCopies&&!t.renderWorldCopies.isFirstChange()&&this.MapService.updateRenderWorldCopies(t.renderWorldCopies.currentValue),t.scrollZoom&&!t.scrollZoom.isFirstChange()&&this.MapService.updateScrollZoom(t.scrollZoom.currentValue),t.dragRotate&&!t.dragRotate.isFirstChange()&&this.MapService.updateDragRotate(t.dragRotate.currentValue),t.touchPitch&&!t.touchPitch.isFirstChange()&&this.MapService.updateTouchPitch(t.touchPitch.currentValue),t.touchZoomRotate&&!t.touchZoomRotate.isFirstChange()&&this.MapService.updateTouchZoomRotate(t.touchZoomRotate.currentValue),t.doubleClickZoom&&!t.doubleClickZoom.isFirstChange()&&this.MapService.updateDoubleClickZoom(t.doubleClickZoom.currentValue),t.keyboard&&!t.keyboard.isFirstChange()&&this.MapService.updateKeyboard(t.keyboard.currentValue),t.dragPan&&!t.dragPan.isFirstChange()&&this.MapService.updateDragPan(t.dragPan.currentValue),t.boxZoom&&!t.boxZoom.isFirstChange()&&this.MapService.updateBoxZoom(t.boxZoom.currentValue),t.style&&!t.style.isFirstChange()&&this.MapService.updateStyle(t.style.currentValue),t.maxBounds&&!t.maxBounds.isFirstChange()&&this.MapService.updateMaxBounds(t.maxBounds.currentValue),t.fitBounds&&t.fitBounds.currentValue&&!t.fitBounds.isFirstChange()&&this.MapService.fitBounds(t.fitBounds.currentValue,this.fitBoundsOptions),t.fitScreenCoordinates&&t.fitScreenCoordinates.currentValue&&((this.center||this.zoom||this.pitch||this.fitBounds)&&t.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),this.MapService.fitScreenCoordinates(t.fitScreenCoordinates.currentValue,this.bearing?this.bearing[0]:0,this.movingOptions)),!this.centerWithPanTo||!t.center||t.center.isFirstChange()||t.zoom||t.bearing||t.pitch?(t.center&&!t.center.isFirstChange()||t.zoom&&!t.zoom.isFirstChange()||t.bearing&&!t.bearing.isFirstChange()&&!t.fitScreenCoordinates||t.pitch&&!t.pitch.isFirstChange())&&this.MapService.move(this.movingMethod,this.movingOptions,t.zoom&&this.zoom?this.zoom[0]:void 0,t.center?this.center:void 0,t.bearing&&this.bearing?this.bearing[0]:void 0,t.pitch&&this.pitch?this.pitch[0]:void 0):this.MapService.panTo(this.center,this.panToOptions)})}warnDeprecatedOutputs(){const t=ST.bind(void 0,n.name);this.resize.observers.length&&t("resize","mapResize"),this.remove.observers.length&&t("remove","mapRemove"),this.mouseDown.observers.length&&t("mouseDown","mapMouseDown"),this.mouseUp.observers.length&&t("mouseUp","mapMouseUp"),this.mouseMove.observers.length&&t("mouseMove","mapMouseMove"),this.click.observers.length&&t("click","mapClick"),this.dblClick.observers.length&&t("dblClick","mapDblClick"),this.mouseOver.observers.length&&t("mouseOver","mapMouseOver"),this.mouseOut.observers.length&&t("mouseOut","mapMouseOut"),this.contextMenu.observers.length&&t("contextMenu","mapContextMenu"),this.touchStart.observers.length&&t("touchStart","mapTouchStart"),this.touchEnd.observers.length&&t("touchEnd","mapTouchEnd"),this.touchMove.observers.length&&t("touchMove","mapTouchMove"),this.touchCancel.observers.length&&t("touchCancel","mapTouchCancel"),this.wheel.observers.length&&t("wheel","mapWheel"),this.dragStart.observers.length&&t("dragStart","mapDragStart"),this.drag.observers.length&&t("drag","mapDrag"),this.dragEnd.observers.length&&t("dragEnd","mapDragEnd"),this.load.observers.length&&t("load","mapLoad"),this.error.observers.length&&t("error","mapError")}}return n.\u0275fac=function(t){return new(t||n)(at(Ky))},n.\u0275cmp=Bo({type:n,selectors:[["mgl-map"]],viewQuery:function(t,r){if(1&t&&Ex(B8,7),2&t){let o;Pp(o=Rp())&&(r.mapContainer=o.first)}},inputs:{accessToken:"accessToken",collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",movingMethod:"movingMethod",movingOptions:"movingOptions",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing",resize:"resize",remove:"remove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseMove:"mouseMove",click:"click",dblClick:"dblClick",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchMove:"touchMove",touchCancel:"touchCancel",wheel:"wheel",dragStart:"dragStart",drag:"drag",dragEnd:"dragEnd",load:"load",error:"error"},features:[ci([Ky]),Dr],decls:2,vars:0,consts:[["container",""]],template:function(t,r){1&t&&kA(0,"div",null,0)},styles:["[_nghost-%COMP%] {\n        display: block;\n      }\n      div[_ngcontent-%COMP%] {\n        height: 100%;\n        width: 100%;\n      }"],changeDetection:0}),n})();const $8=new nn("MapboxApiKey");let H8=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:DT,useValue:t.accessToken},{provide:$8,useValue:t.geocoderAccessToken||t.accessToken}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({imports:[[zS]]}),n})();function TT(...n){if(1===n.length){const e=n[0];if(Ho(e))return Jy(e,null);if(fo(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return Jy(t.map(r=>e[r]),t)}}if("function"==typeof n[n.length-1]){const e=n.pop();return Jy(n=1===n.length&&Ho(n[0])?n[0]:n,null).pipe(An(t=>e(...t)))}return Jy(n,null)}function Jy(n,e){return new Gn(t=>{const r=n.length;if(0===r)return void t.complete();const o=new Array(r);let c=0,p=0;for(let w=0;w<r;w++){const T=Lr(n[w]);let L=!1;t.add(T.subscribe({next:U=>{L||(L=!0,p++),o[w]=U},error:U=>t.error(U),complete:()=>{c++,(c===r||!L)&&(p===r&&t.next(e?e.reduce((U,W,K)=>(U[W]=o[K],U),{}):o),t.complete())}}))}})}class IT{}class kT{}class fh{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const o=t.slice(0,r),c=o.toLowerCase(),p=t.slice(r+1).trim();this.maybeSetNormalizedName(o,c),this.headers.has(c)?this.headers.get(c).push(p):this.headers.set(c,[p])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let r=e[t];const o=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(t,o))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof fh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new fh;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof fh?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const o=("a"===e.op?this.headers.get(t):void 0)||[];o.push(...r),this.headers.set(t,o);break;case"d":const c=e.value;if(c){let p=this.headers.get(t);if(!p)return;p=p.filter(w=>-1===c.indexOf(w)),0===p.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,p)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class q8{encodeKey(e){return PT(e)}encodeValue(e){return PT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const W8=/%(\d[a-f0-9])/gi,Q8={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function PT(n){return encodeURIComponent(n).replace(W8,(e,t)=>{var r;return null!==(r=Q8[t])&&void 0!==r?r:e})}function RT(n){return`${n}`}class ad{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new q8,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(o=>{const c=o.indexOf("="),[p,w]=-1==c?[e.decodeKey(o),""]:[e.decodeKey(o.slice(0,c)),e.decodeValue(o.slice(c+1))],T=t.get(p)||[];T.push(w),t.set(p,T)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const r=e.fromObject[t];this.map.set(t,Array.isArray(r)?r:[r])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(r=>{const o=e[r];Array.isArray(o)?o.forEach(c=>{t.push({param:r,value:c,op:"a"})}):t.push({param:r,value:o,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new ad({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(RT(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const o=r.indexOf(RT(e.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class X8{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function FT(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function OT(n){return"undefined"!=typeof Blob&&n instanceof Blob}function LT(n){return"undefined"!=typeof FormData&&n instanceof FormData}class u0{constructor(e,t,r,o){let c;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,c=o):c=r,c&&(this.reportProgress=!!c.reportProgress,this.withCredentials=!!c.withCredentials,c.responseType&&(this.responseType=c.responseType),c.headers&&(this.headers=c.headers),c.context&&(this.context=c.context),c.params&&(this.params=c.params)),this.headers||(this.headers=new fh),this.context||(this.context=new X8),this.params){const p=this.params.toString();if(0===p.length)this.urlWithParams=t;else{const w=t.indexOf("?");this.urlWithParams=t+(-1===w?"?":w<t.length-1?"&":"")+p}}else this.params=new ad,this.urlWithParams=t}serializeBody(){return null===this.body?null:FT(this.body)||OT(this.body)||LT(this.body)||function(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ad?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||LT(this.body)?null:OT(this.body)?this.body.type||null:FT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ad?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const r=e.method||this.method,o=e.url||this.url,c=e.responseType||this.responseType,p=void 0!==e.body?e.body:this.body,w=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,T=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let L=e.headers||this.headers,U=e.params||this.params;const W=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(L=Object.keys(e.setHeaders).reduce((K,ie)=>K.set(ie,e.setHeaders[ie]),L)),e.setParams&&(U=Object.keys(e.setParams).reduce((K,ie)=>K.set(ie,e.setParams[ie]),U)),new u0(r,o,p,{params:U,headers:L,context:W,reportProgress:T,responseType:c,withCredentials:w})}}var Ii=(()=>((Ii=Ii||{})[Ii.Sent=0]="Sent",Ii[Ii.UploadProgress=1]="UploadProgress",Ii[Ii.ResponseHeader=2]="ResponseHeader",Ii[Ii.DownloadProgress=3]="DownloadProgress",Ii[Ii.Response=4]="Response",Ii[Ii.User=5]="User",Ii))();class Yb{constructor(e,t=200,r="OK"){this.headers=e.headers||new fh,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Kb extends Yb{constructor(e={}){super(e),this.type=Ii.ResponseHeader}clone(e={}){return new Kb({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class ev extends Yb{constructor(e={}){super(e),this.type=Ii.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new ev({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class BT extends Yb{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Jb(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let tv=(()=>{class n{constructor(t){this.handler=t}request(t,r,o={}){let c;if(t instanceof u0)c=t;else{let T,L;T=o.headers instanceof fh?o.headers:new fh(o.headers),o.params&&(L=o.params instanceof ad?o.params:new ad({fromObject:o.params})),c=new u0(t,r,void 0!==o.body?o.body:null,{headers:T,context:o.context,params:L,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const p=pn(c).pipe(Up(T=>this.handler.handle(T)));if(t instanceof u0||"events"===o.observe)return p;const w=p.pipe(tu(T=>T instanceof ev));switch(o.observe||"body"){case"body":switch(c.responseType){case"arraybuffer":return w.pipe(An(T=>{if(null!==T.body&&!(T.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return T.body}));case"blob":return w.pipe(An(T=>{if(null!==T.body&&!(T.body instanceof Blob))throw new Error("Response is not a Blob.");return T.body}));case"text":return w.pipe(An(T=>{if(null!==T.body&&"string"!=typeof T.body)throw new Error("Response is not a string.");return T.body}));case"json":default:return w.pipe(An(T=>T.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new ad).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,o={}){return this.request("PATCH",t,Jb(o,r))}post(t,r,o={}){return this.request("POST",t,Jb(o,r))}put(t,r,o={}){return this.request("PUT",t,Jb(o,r))}}return n.\u0275fac=function(t){return new(t||n)(_t(IT))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();class NT{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const zT=new nn("HTTP_INTERCEPTORS");let J8=(()=>{class n{intercept(t,r){return r.handle(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const e6=/^\)\]\}',?\n/;let VT=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Gn(r=>{const o=this.xhrFactory.build();if(o.open(t.method,t.urlWithParams),t.withCredentials&&(o.withCredentials=!0),t.headers.forEach((ie,fe)=>o.setRequestHeader(ie,fe.join(","))),t.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const ie=t.detectContentTypeHeader();null!==ie&&o.setRequestHeader("Content-Type",ie)}if(t.responseType){const ie=t.responseType.toLowerCase();o.responseType="json"!==ie?ie:"text"}const c=t.serializeBody();let p=null;const w=()=>{if(null!==p)return p;const ie=1223===o.status?204:o.status,fe=o.statusText||"OK",Ve=new fh(o.getAllResponseHeaders()),Re=function(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(o)||t.url;return p=new Kb({headers:Ve,status:ie,statusText:fe,url:Re}),p},T=()=>{let{headers:ie,status:fe,statusText:Ve,url:Re}=w(),Je=null;204!==fe&&(Je=void 0===o.response?o.responseText:o.response),0===fe&&(fe=Je?200:0);let He=fe>=200&&fe<300;if("json"===t.responseType&&"string"==typeof Je){const Rt=Je;Je=Je.replace(e6,"");try{Je=""!==Je?JSON.parse(Je):null}catch(Zt){Je=Rt,He&&(He=!1,Je={error:Zt,text:Je})}}He?(r.next(new ev({body:Je,headers:ie,status:fe,statusText:Ve,url:Re||void 0})),r.complete()):r.error(new BT({error:Je,headers:ie,status:fe,statusText:Ve,url:Re||void 0}))},L=ie=>{const{url:fe}=w(),Ve=new BT({error:ie,status:o.status||0,statusText:o.statusText||"Unknown Error",url:fe||void 0});r.error(Ve)};let U=!1;const W=ie=>{U||(r.next(w()),U=!0);let fe={type:Ii.DownloadProgress,loaded:ie.loaded};ie.lengthComputable&&(fe.total=ie.total),"text"===t.responseType&&!!o.responseText&&(fe.partialText=o.responseText),r.next(fe)},K=ie=>{let fe={type:Ii.UploadProgress,loaded:ie.loaded};ie.lengthComputable&&(fe.total=ie.total),r.next(fe)};return o.addEventListener("load",T),o.addEventListener("error",L),o.addEventListener("timeout",L),o.addEventListener("abort",L),t.reportProgress&&(o.addEventListener("progress",W),null!==c&&o.upload&&o.upload.addEventListener("progress",K)),o.send(c),r.next({type:Ii.Sent}),()=>{o.removeEventListener("error",L),o.removeEventListener("abort",L),o.removeEventListener("load",T),o.removeEventListener("timeout",L),t.reportProgress&&(o.removeEventListener("progress",W),null!==c&&o.upload&&o.upload.removeEventListener("progress",K)),o.readyState!==o.DONE&&o.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(_t(GS))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})();const ew=new nn("XSRF_COOKIE_NAME"),tw=new nn("XSRF_HEADER_NAME");class UT{}let n6=(()=>{class n{constructor(t,r,o){this.doc=t,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=IS(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(_t(lo),_t(ty),_t(ew))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),nw=(()=>{class n{constructor(t,r){this.tokenService=t,this.headerName=r}intercept(t,r){const o=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||o.startsWith("http://")||o.startsWith("https://"))return r.handle(t);const c=this.tokenService.getToken();return null!==c&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,c)})),r.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(_t(UT),_t(tw))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),r6=(()=>{class n{constructor(t,r){this.backend=t,this.injector=r,this.chain=null}handle(t){if(null===this.chain){const r=this.injector.get(zT,[]);this.chain=r.reduceRight((o,c)=>new NT(o,c),this.backend)}return this.chain.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(_t(kT),_t(Ir))},n.\u0275prov=$t({token:n,factory:n.\u0275fac}),n})(),i6=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:nw,useClass:J8}]}}static withOptions(t={}){return{ngModule:n,providers:[t.cookieName?{provide:ew,useValue:t.cookieName}:[],t.headerName?{provide:tw,useValue:t.headerName}:[]]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({providers:[nw,{provide:zT,useExisting:nw,multi:!0},{provide:UT,useClass:n6},{provide:ew,useValue:"XSRF-TOKEN"},{provide:tw,useValue:"X-XSRF-TOKEN"}]}),n})(),o6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({providers:[tv,{provide:IT,useClass:r6},VT,{provide:kT,useExisting:VT}],imports:[[i6.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})();const rw=new nn("Google Sheets API key");let s6=(()=>{class n{constructor(t,r){this.http=t,this.apiKey=r,this.defaultActiveValues=["true","1","yes"]}get(t,r,o){return this.getRows(t,r).pipe(An(c=>this.rowsToEntries(c).map(p=>this.getObjectFromEntry(p,o))))}getActive(t,r,o,c="is_active",p=null){return null===p?p=this.defaultActiveValues:Array.isArray(p)||(p=[p]),this.getRows(t,r).pipe(An(w=>this.rowsToEntries(w).filter(T=>p.includes(T[c].toLowerCase())).map(T=>this.getObjectFromEntry(T,o))))}getSpreadsheetUrl(t,r){return"https://sheets.googleapis.com/v4/spreadsheets/"+t+"/values/"+encodeURI(r)+"?key="+this.apiKey}getRows(t,r){const o=this.getSpreadsheetUrl(t,r);return this.http.get(o).pipe(An(c=>c.values),rd(this.handleError))}rowsToEntries(t){const r=t[0].map(this.cleanColumnName);return t.slice(1).map(o=>r.reduce((c,p,w)=>(c[p]=o.length>w?o[w]:"",c),{}))}cleanColumnName(t){return t.trim()}arrayToObject(t){return t.reduce((r,o)=>(r[o]=o,r),{})}getObjectFromEntry(t,r){return Array.isArray(r)&&(r=this.arrayToObject(r)),this.getObjectFromEntryObject(t,r)}getObjectFromEntryObject(t,r,o=""){const c={};for(const p in Object(r))if(r.hasOwnProperty(p)&&!["_prefix","_listField"].includes(p))if("string"==typeof r[p])c[p]=this.getValueFromEntry(t,o+r[p]);else if("object"==typeof r[p]){let w="";r[p].hasOwnProperty("_prefix")&&(w=r[p]._prefix),c[p]=r[p]._listField?this.getListFromEntry(t,o+w):this.getObjectFromEntryObject(t,r[p],o+w)}else console.log(`Unknown type for ${p}`);return c}getValueFromEntry(t,r){return r=this.cleanColumnName(r),t.hasOwnProperty(r)?t[r]:null}getListFromEntry(t,r){const o=[];let c=1,p=this.getValueFromEntry(t,`${r}${c}`);for(;p;)o.push(p),c++,p=this.getValueFromEntry(t,`${r}${c}`);return o}handleError(t){return t.error instanceof ErrorEvent?console.error("An error occurred:",t.error.message):console.error(`Backend returned code ${t.status}, body was: ${t.error}`),AT("Something bad happened; please try again later.")}}return n.\u0275fac=function(t){return new(t||n)(_t(tv),_t(rw))},n.\u0275prov=$t({factory:function(){return new n(_t(tv),_t(rw))},token:n,providedIn:"root"}),n})();const a6={id:"id",name:"name",group:"group",lon:"lon",lat:"lat"},l6={id:"id",name:"name"},c6={id:"id",name:"name",size:"size"};let iw=(()=>{class n{constructor(t){this.googleSheetsDbService=t}getCities(){return this.googleSheetsDbService.get("15HnwixyXuMjkYlryytSMKOqqDjzFwsaN1vuPpMDFc6Y","Cities",a6).pipe(bo(t=>t.forEach(r=>{r.id=Number(r.id),r.lat=Number(r.lat),r.lon=Number(r.lon)})))}getClassifiers(){return this.googleSheetsDbService.get("15HnwixyXuMjkYlryytSMKOqqDjzFwsaN1vuPpMDFc6Y","Classifiers",l6).pipe(bo(t=>t.forEach(r=>{r.id=Number(r.id)})))}getCsvFiles(){return this.googleSheetsDbService.getActive("10MV6ScSQZe1KbpVYCcSi_ZW79bwmfyS_q1voeoyDNOQ","Files",c6,"active").pipe(bo(t=>t.forEach(r=>{r.size=Number(r.size);var o=r.name.split("_");r.areaId=Number(o[0]),r.clfId=Number(o[1])})))}}return n.\u0275fac=function(t){return new(t||n)(_t(s6))},n.\u0275prov=$t({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jT=(()=>{class n{constructor(t,r){this.googleSheetsDownloaderService=t,this.httpClient=r,this.files=[],this.cache=new Map,this.progressSubject=new Al(0)}setupFiles(){return this.googleSheetsDownloaderService.getCsvFiles().pipe(bo(t=>this.files=t))}_getFileId(t){var r=this.files.find(o=>o.name===t);if(!r)throw Error(`No result ${t}`);return r.id}getFileId(t){return 0==this.files.length?this.googleSheetsDownloaderService.getCsvFiles().pipe(bo(r=>this.files=r),An(()=>this._getFileId(t))):pn(1).pipe(An(()=>this._getFileId(t)))}parseCsv(t){const o=[];return t.split("\n").forEach(p=>{const w=p.split(",");o.push(w)}),o}getHexData(t,r){var o=`${t.id}_${r}`;return this.cache.has(o)?pn(this.cache.get(o)):this.getFileId(o).pipe(pr(p=>this.httpClient.get("https://www.googleapis.com/drive/v3/files/"+p+"?alt=media&key=AIzaSyDVc71t2FNSlJ5sko_IZBGZVre45bYA94U",{responseType:"text",reportProgress:!0,observe:"events"})),bo(p=>{var w=0;p.type===Ii.DownloadProgress?w=Math.round(100*p.loaded/t.sizeBytes):p.type===Ii.Response&&(w=100),this.progressSubject.next(w)}),tu(p=>p.type===Ii.Response),An(p=>{var w=this.parseCsv(p.body);w.shift();var T=w.map(L=>({hex:L[0],value:Number(L[1])}));return this.cache.set(o,T),T}))}}return n.\u0275fac=function(t){return new(t||n)(_t(iw),_t(tv))},n.\u0275prov=$t({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var mt=function(n){var r,e=void 0!==(n=n||{})?n:{},t={};for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);var w,o=[],c="";document.currentScript&&(c=document.currentScript.src),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"",w=function(lt,It,rn){var m=new XMLHttpRequest;m.open("GET",lt,!0),m.responseType="arraybuffer",m.onload=function(){if(200==m.status||0==m.status&&m.response)It(m.response);else{var Cr=Lw(lt);Cr?It(Cr.buffer):rn()}},m.onerror=rn,m.send(null)};var T=e.print||console.log.bind(console),L=e.printErr||console.warn.bind(console);for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);t=null,e.arguments&&(o=e.arguments);var U=0,K=function(){return U},Re=!1;function He(je){var lt=e["_"+je];return function(je,lt){je||YA("Assertion failed: "+lt)}(lt,"Cannot call unknown function "+je+", make sure it is exported"),lt}function Rt(je,lt,It,rn,m){var $r={string:function(Qn){var ar=0;if(null!=Qn&&0!==Qn){var md=1+(Qn.length<<2);!function(je,lt,It){!function(je,lt,It,rn){if(!(rn>0))return 0;for(var $r=It+rn-1,Cr=0;Cr<je.length;++Cr){var pe=je.charCodeAt(Cr);if(pe>=55296&&pe<=57343&&(pe=65536+((1023&pe)<<10)|1023&je.charCodeAt(++Cr)),pe<=127){if(It>=$r)break;lt[It++]=pe}else if(pe<=2047){if(It+1>=$r)break;lt[It++]=192|pe>>6,lt[It++]=128|63&pe}else if(pe<=65535){if(It+2>=$r)break;lt[It++]=224|pe>>12,lt[It++]=128|pe>>6&63,lt[It++]=128|63&pe}else{if(It+3>=$r)break;lt[It++]=240|pe>>18,lt[It++]=128|pe>>12&63,lt[It++]=128|pe>>6&63,lt[It++]=128|63&pe}}lt[It]=0}(je,su,lt,It)}(Qn,ar=Ak(md),md)}return ar},array:function(Qn){var ar=Ak(Qn.length);return function(je,lt){ml.set(je,lt)}(Qn,ar),ar}},pe=He(je),As=[],ha=0;if(rn)for(var nr=0;nr<rn.length;nr++){var ki=$r[It[nr]];ki?(0===ha&&(ha=dj()),As[nr]=ki(rn[nr])):As[nr]=rn[nr]}var Qn,mh=pe.apply(null,As);return Qn=mh,mh="string"===lt?$o(Qn):"boolean"===lt?Boolean(Qn):Qn,0!==ha&&hj(ha),mh}var ou,ml,su,QA,pd,kw,Pw,kn="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function $o(je,lt){return je?function(je,lt,It){for(var rn=lt+It,m=lt;je[m]&&!(m>=rn);)++m;if(m-lt>16&&je.subarray&&kn)return kn.decode(je.subarray(lt,m));for(var $r="";lt<m;){var Cr=je[lt++];if(128&Cr){var pe=63&je[lt++];if(192!=(224&Cr)){var As=63&je[lt++];if((Cr=224==(240&Cr)?(15&Cr)<<12|pe<<6|As:(7&Cr)<<18|pe<<12|As<<6|63&je[lt++])<65536)$r+=String.fromCharCode(Cr);else{var ha=Cr-65536;$r+=String.fromCharCode(55296|ha>>10,56320|1023&ha)}}else $r+=String.fromCharCode((31&Cr)<<6|pe)}else $r+=String.fromCharCode(Cr)}return $r}(su,je,lt):""}function Kp(je,lt){return je%lt>0&&(je+=lt-je%lt),je}function nk(je){ou=je,e.HEAP8=ml=new Int8Array(je),e.HEAP16=QA=new Int16Array(je),e.HEAP32=pd=new Int32Array(je),e.HEAPU8=su=new Uint8Array(je),e.HEAPU16=new Uint16Array(je),e.HEAPU32=new Uint32Array(je),e.HEAPF32=kw=new Float32Array(je),e.HEAPF64=Pw=new Float64Array(je)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var ik=e.TOTAL_MEMORY||33554432;function fv(je){for(;je.length>0;){var lt=je.shift();if("function"!=typeof lt){var It=lt.func;"number"==typeof It?void 0===lt.arg?e.dynCall_v(It):e.dynCall_vi(It,lt.arg):It(void 0===lt.arg?null:lt.arg)}else lt()}}ik=(ou=e.buffer?e.buffer:new ArrayBuffer(ik)).byteLength,nk(ou),pd[6004]=5266928;var ok=[],zU=[],VU=[],sk=[],ZU=Math.abs,WU=Math.ceil,QU=Math.floor,XU=Math.min,XA=0,Rw=null,g0=null;e.preloadedImages={},e.preloadedAudios={};var Jp,Ow,ph=null,Fw="data:application/octet-stream;base64,";function ak(je){return String.prototype.startsWith?je.startsWith(Fw):0===je.indexOf(Fw)}function ck(je){return je.replace(/\b__Z[\w\d_]+/g,function(It){return It==It?It:It+" ["+It+"]"})}function uk(){var je=new Error;if(!je.stack){try{throw new Error(0)}catch(lt){je=lt}if(!je.stack)return"(no stack trace available)"}return je.stack.toString()}function hk(){return ml.length}function dk(je){try{var lt=new ArrayBuffer(je);return lt.byteLength!=je?void 0:(new Int8Array(lt).set(ml),uj(lt),nk(lt),1)}catch(It){}}ph="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var sj="function"==typeof atob?atob:function(je){var m,$r,Cr,pe,As,ha,lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",It="",nr=0;je=je.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{Cr=lt.indexOf(je.charAt(nr++)),m=(15&(pe=lt.indexOf(je.charAt(nr++))))<<4|(As=lt.indexOf(je.charAt(nr++)))>>2,$r=(3&As)<<6|(ha=lt.indexOf(je.charAt(nr++))),It+=String.fromCharCode(Cr<<2|pe>>4),64!==As&&(It+=String.fromCharCode(m)),64!==ha&&(It+=String.fromCharCode($r))}while(nr<je.length);return It};function Lw(je){if(ak(je))return function(je){try{for(var lt=sj(je),It=new Uint8Array(lt.length),rn=0;rn<lt.length;++rn)It[rn]=lt.charCodeAt(rn);return It}catch(m){throw new Error("Converting base64 string to bytes failed.")}}(je.slice(Fw.length))}var je,pv,Tt=function(je,lt,It){var rn=new je.Int8Array(It),m=new je.Int32Array(It),pe=(new je.Uint8Array(It),new je.Float32Array(It),new je.Float64Array(It)),As=0|lt.p,ha=je.Math.floor,nr=je.Math.abs,ki=je.Math.sqrt,mh=je.Math.pow,Qn=je.Math.cos,ar=je.Math.sin,md=je.Math.tan,Aj=je.Math.acos,fj=je.Math.asin,zw=je.Math.atan,gl=je.Math.atan2,mv=je.Math.ceil,gh=je.Math.imul,pj=je.Math.min,KA=je.Math.clz32,Mn=lt.b,De=lt.c,Rr=lt.d,gk=lt.e,mj=lt.f,gj=lt.g,_j=lt.h,yj=lt.i,me=24048;function _k(d,A,y,C){var S=0,k=0;!(0|Vw(d|=0,A|=0,y|=0,C|=0,0))||(oc(0|C,0,(k=1+(0|gh(3*y|0,y+1|0))|0)<<3|0),(S=0|ic(k,4))&&(au(d,A,y,C,S,k,0),Ln(S)))}function Vw(d,A,y,C,S){A|=0,y|=0,S|=0;var ze,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0;if(ze=me,me=me+16|0,Te=ze,m[(k=C|=0)>>2]=d|=0,m[k+4>>2]=A,(k=0!=(0|S))&&(m[S>>2]=0),0|wo(d,A))return me=ze,1;m[Te>>2]=0;e:do{if((0|y)>=1)if(k)for(X=0,ee=1,ye=1,I=0,k=d;;){if(!(I|X)){if(0==(0|(k=0|ho(k,A,4,Te)))&0==(0|(A=0|De()))){k=2;break e}if(0|wo(k,A)){k=1;break e}}if(0==(0|(k=0|ho(k,A,0|m[16+(X<<2)>>2],Te)))&0==(0|(A=0|De()))){k=2;break e}if(m[(d=C+(ye<<3)|0)>>2]=k,m[d+4>>2]=A,m[S+(ye<<2)>>2]=ee,d=(0|(I=I+1|0))==(0|ee),G=6==(0|(O=X+1|0)),0|wo(k,A)){k=1;break e}if((0|(ee=ee+(G&d&1)|0))>(0|y)){k=0;break}X=d?G?0:O:X,ye=ye+1|0,I=d?0:I}else for(X=0,ee=1,ye=1,I=0,k=d;;){if(!(I|X)){if(0==(0|(k=0|ho(k,A,4,Te)))&0==(0|(A=0|De()))){k=2;break e}if(0|wo(k,A)){k=1;break e}}if(0==(0|(k=0|ho(k,A,0|m[16+(X<<2)>>2],Te)))&0==(0|(A=0|De()))){k=2;break e}if(m[(d=C+(ye<<3)|0)>>2]=k,m[d+4>>2]=A,d=(0|(I=I+1|0))==(0|ee),G=6==(0|(O=X+1|0)),0|wo(k,A)){k=1;break e}if((0|(ee=ee+(G&d&1)|0))>(0|y)){k=0;break}X=d?G?0:O:X,ye=ye+1|0,I=d?0:I}else k=0}while(0);return me=ze,0|k}function au(d,A,y,C,S,k,I){y|=0,C|=0,S|=0,k|=0,I|=0;var ee,ye,O=0,G=0,X=0,Te=0,ze=0;if(ye=me,me=me+16|0,ee=ye,0==(0|(d|=0))&0==(0|(A|=0)))me=ye;else{if(O=0|yd(0|d,0|A,0|k,((0|k)<0)<<31>>31|0),De(),!(0==(0|(ze=0|m[(Te=G=C+(O<<3)|0)>>2]))&0==(0|(Te=0|m[Te+4>>2]))|(X=(0|ze)==(0|d)&(0|Te)==(0|A))))do{X=(0|(Te=0|m[(ze=G=C+((O=(O+1|0)%(0|k)|0)<<3)|0)>>2]))==(0|d)&(0|(ze=0|m[ze+4>>2]))==(0|A)}while(!(0==(0|Te)&0==(0|ze)|X));O=S+(O<<2)|0,X&&(0|m[O>>2])<=(0|I)||(m[(ze=G)>>2]=d,m[ze+4>>2]=A,m[O>>2]=I,(0|I)>=(0|y)||(ze=I+1|0,m[ee>>2]=0,au(Te=0|ho(d,A,2,ee),0|De(),y,C,S,k,ze),m[ee>>2]=0,au(Te=0|ho(d,A,3,ee),0|De(),y,C,S,k,ze),m[ee>>2]=0,au(Te=0|ho(d,A,1,ee),0|De(),y,C,S,k,ze),m[ee>>2]=0,au(Te=0|ho(d,A,5,ee),0|De(),y,C,S,k,ze),m[ee>>2]=0,au(Te=0|ho(d,A,4,ee),0|De(),y,C,S,k,ze),m[ee>>2]=0,au(Te=0|ho(d,A,6,ee),0|De(),y,C,S,k,ze))),me=ye}}function ho(d,A,y,C){d|=0,A|=0,y|=0;var O,G,S=0,k=0,I=0,ee=0,ye=0,Te=0,ze=0;if((0|m[(C|=0)>>2])>0){S=0;do{y=0|tf(y),S=S+1|0}while((0|S)<(0|m[C>>2]))}O=0|bt(0|d,0|A,45),De(),G=127&O,k=0|Aa(d,A),S=0|bt(0|d,0|A,52),De(),S&=15;e:do{if(S)for(;;){if(Te=0|bt(0|d,0|A,0|(ye=3*(15-S|0)|0)),De(),Te&=7,ze=0==(0|_l(S)),S=S+-1|0,ee=0|Ot(7,0,0|ye),A&=~(0|De()),d=(ye=0|Ot(0|m[(ze?464:48)+(28*Te|0)+(y<<2)>>2],0,0|ye))|d&~ee,A|=0|De(),!(y=0|m[(ze?672:256)+(28*Te|0)+(y<<2)>>2])){y=0;break e}if(!S){I=6;break}}else I=6}while(0);6==(0|I)&&(d|=Te=0|Ot(0|(ze=0|m[880+(28*G|0)+(y<<2)>>2]),0,45),A=0|De()|-1040385&A,y=0|m[4304+(28*G|0)+(y<<2)>>2],127==(127&ze|0)&&(ze=0|Ot(0|m[880+(28*G|0)+20>>2],0,45),A=0|De()|-1040385&A,y=0|m[4304+(28*G|0)+20>>2],d=0|_d(ze|d,A),A=0|De(),m[C>>2]=1+(0|m[C>>2]))),I=0|bt(0|d,0|A,45),De(),I&=127;e:do{if(0|gi(I)){t:do{if(1==(0|Aa(d,A))){if((0|G)!=(0|I)){if(0|xk(I,0|m[7728+(28*G|0)>>2])){d=0|Xw(d,A),k=1,A=0|De();break}d=0|_d(d,A),k=1,A=0|De();break}switch(0|k){case 5:d=0|Xw(d,A),A=0|De(),m[C>>2]=5+(0|m[C>>2]),k=0;break t;case 3:d=0|_d(d,A),A=0|De(),m[C>>2]=1+(0|m[C>>2]),k=0;break t;default:return ze=0,Mn(0|(Te=0)),0|ze}}else k=0}while(0);if((0|y)>0){S=0;do{d=0|Qw(d,A),A=0|De(),S=S+1|0}while((0|S)!=(0|y))}if((0|G)!=(0|I)){if(!(0|Uw(I))){if(0!=(0|k)|5!=(0|Aa(d,A)))break;m[C>>2]=1+(0|m[C>>2]);break}switch(127&O){case 8:case 118:break e}3!=(0|Aa(d,A))&&(m[C>>2]=1+(0|m[C>>2]))}}else if((0|y)>0){S=0;do{d=0|_d(d,A),A=0|De(),S=S+1|0}while((0|S)!=(0|y))}}while(0);return m[C>>2]=((0|m[C>>2])+y|0)%6|0,ze=d,Mn(0|(Te=A)),0|ze}function yk(d,A,y,C,S,k){y|=0,C|=0,S|=0,k|=0;var Lt,qe,gt,Ie,Nt,zt,kt,Ft,Fr,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,In=0,br=0,Hr=0;if(Fr=me,me=me+48|0,(0|(I=0|m[(d|=0)>>2]))<=0)return me=Fr,0;Lt=d+4|0,qe=8+(zt=Fr+32|0)|0,gt=8+(kt=Fr+16|0)|0,Ie=(Ft=Fr)+8|0,Nt=((0|(A|=0))<0)<<31>>31,Ct=0;e:for(;;){m[zt>>2]=m[(Qe=(O=0|m[Lt>>2])+(Ct<<4)|0)>>2],m[zt+4>>2]=m[Qe+4>>2],m[zt+8>>2]=m[Qe+8>>2],m[zt+12>>2]=m[Qe+12>>2],(0|Ct)==(I+-1|0)?(m[kt>>2]=m[O>>2],m[kt+4>>2]=m[O+4>>2],m[kt+8>>2]=m[O+8>>2],m[kt+12>>2]=m[O+12>>2]):(m[kt>>2]=m[(Qe=O+(Ct+1<<4)|0)>>2],m[kt+4>>2]=m[Qe+4>>2],m[kt+8>>2]=m[Qe+8>>2],m[kt+12>>2]=m[Qe+12>>2]),Qe=0|Nj(zt,kt,y);t:do{if((0|Qe)>0){Ke=+(0|Qe),ze=0;n:for(;;){pe[Ft>>3]=+pe[zt>>3]*(Hr=+(Qe-ze|0))/Ke+ +pe[kt>>3]*(br=+(0|ze))/Ke,pe[Ie>>3]=+pe[qe>>3]*Hr/Ke+ +pe[gt>>3]*br/Ke,O=0|yd(0|(ye=0|Bk(Ft,y)),0|(Te=0|De()),0|A,0|Nt),De(),X=0|m[(G=I=k+(O<<3)|0)>>2],G=0|m[G+4>>2];r:do{if(0==(0|X)&0==(0|G))In=14;else for(ee=0;;){if((0|ee)>(0|A)){I=1;break r}if((0|X)==(0|ye)&(0|G)==(0|Te)){I=7;break r}if(0==(0|(X=0|m[(G=I=k+((O=(O+1|0)%(0|A)|0)<<3)|0)>>2]))&0==(0|(G=0|m[G+4>>2]))){In=14;break}ee=ee+1|0}}while(0);switch(14==(0|In)&&(In=0,0==(0|ye)&0==(0|Te)?I=7:(m[I>>2]=ye,m[I+4>>2]=Te,m[(ee=S+((I=0|m[C>>2])<<3)|0)>>2]=ye,m[ee+4>>2]=Te,m[C>>2]=I+1,I=0)),7&I){case 7:case 0:break;default:break n}if((0|Qe)<=(0|(ze=ze+1|0))){In=8;break t}}if(0|I){I=-1,In=20;break e}}else In=8}while(0);if(8==(0|In)&&(In=0),(0|(Ct=Ct+1|0))>=(0|(I=0|m[d>>2]))){I=0,In=20;break}}return 20==(0|In)?(me=Fr,0|I):0}function gi(d){return 0|m[7728+(28*(d|=0)|0)+16>>2]}function Uw(d){return 4==(0|(d|=0))|117==(0|d)|0}function vk(d){return 0|m[11152+(216*(0|m[(d|=0)>>2])|0)+(72*(0|m[d+4>>2])|0)+(24*(0|m[d+8>>2])|0)+(m[d+12>>2]<<3)>>2]}function Rj(d){return 0|m[11152+(216*(0|m[(d|=0)>>2])|0)+(72*(0|m[d+4>>2])|0)+(24*(0|m[d+8>>2])|0)+(m[d+12>>2]<<3)+4>>2]}function xk(d,A){return(0|m[7728+(28*(d|=0)|0)+20>>2])==(0|(A|=0))?0|(A=1):0|(A=(0|m[7728+(28*d|0)+24>>2])==(0|A))}function jw(d,A){return 0|m[880+(28*(d|=0)|0)+((A|=0)<<2)>>2]}function Gw(d,A){return(0|m[880+(28*(d|=0)|0)>>2])==(0|(A|=0))?0|(A=0):(0|m[880+(28*d|0)+4>>2])==(0|A)?0|(A=1):(0|m[880+(28*d|0)+8>>2])==(0|A)?0|(A=2):(0|m[880+(28*d|0)+12>>2])==(0|A)?0|(A=3):(0|m[880+(28*d|0)+16>>2])==(0|A)?0|(A=4):(0|m[880+(28*d|0)+20>>2])==(0|A)?0|(A=5):0|((0|m[880+(28*d|0)+24>>2])==(0|A)?6:7)}function bk(d){return+pe[16+(d|=0)>>3]<+pe[d+24>>3]|0}function wk(d,A){var y=0,C=0,S=0;return(y=+pe[(A|=0)>>3])>=+pe[8+(d|=0)>>3]&&y<=+pe[d>>3]?(A=(S=+pe[A+8>>3])>=(y=+pe[d+24>>3]),d=S<=(C=+pe[d+16>>3])&1,C<y?A&&(d=1):A||(d=0),0|(A=0!=(0|d))):0|(A=0)}function $w(d,A){d|=0,A|=0;var y,C,S,I,G,X,k=0,O=0;I=me,me=me+288|0,y=I+264|0,C=I+96|0,O=(k=S=I)+96|0;do{m[k>>2]=0,k=k+4|0}while((0|k)<(0|O));return Kw(A,S),nf(O=0|m[(k=S)>>2],k=0|m[k+4>>2],y),rf(O,k,C),G=+v0(y,C+8|0),pe[y>>3]=+pe[d>>3],pe[(k=y+8|0)>>3]=+pe[d+16>>3],pe[C>>3]=+pe[d+8>>3],pe[(O=C+8|0)>>3]=+pe[d+24>>3],X=+v0(y,C),O=~~+mv(+X*X/+Yk(+ +nr(+(+pe[k>>3]-+pe[O>>3])/(+pe[y>>3]-+pe[C>>3])),3)/(G*(2.59807621135*G)*.8)),me=I,0|(0==(0|O)?1:O)}function Nj(d,A,y){d|=0,A|=0,y|=0;var C,S,k,O,X,I=0,G=0;O=me,me=me+288|0,C=O+264|0,S=O+96|0,G=(I=k=O)+96|0;do{m[I>>2]=0,I=I+4|0}while((0|I)<(0|G));return Kw(y,k),nf(I=0|m[(G=k)>>2],G=0|m[G+4>>2],C),rf(I,G,S),X=+v0(C,S+8|0),G=~~+mv(+ +v0(d,A)/(2*X)),me=O,0|(0==(0|G)?1:G)}function zj(d,A,y,C){y|=0,C|=0,m[(d|=0)>>2]=A|=0,m[d+4>>2]=y,m[d+8>>2]=C}function fs(d){var I,A=0,y=0,C=0,S=0,k=0;y=0|m[(I=4+(d|=0)|0)>>2],(0|(A=0|m[d>>2]))<0&&(m[I>>2]=y=y-A|0,m[(k=d+8|0)>>2]=(0|m[k>>2])-A,m[d>>2]=0,A=0),(0|y)<0?(m[d>>2]=A=A-y|0,m[(k=d+8|0)>>2]=S=(0|m[k>>2])-y|0,m[I>>2]=0,y=0):(k=S=d+8|0,S=0|m[S>>2]),(0|S)<0&&(m[d>>2]=A=A-S|0,m[I>>2]=y=y-S|0,m[k>>2]=0,S=0),!((0|(C=(0|S)<(0|(C=(0|y)<(0|A)?y:A))?S:C))<=0)&&(m[d>>2]=A-C,m[I>>2]=y-C,m[k>>2]=S-C)}function JA(d,A){var y,C;pe[(A|=0)>>3]=+((0|m[(d|=0)>>2])-(C=0|m[d+8>>2])|0)-.5*(y=+((0|m[d+4>>2])-C|0)),pe[A+8>>3]=.8660254037844386*y}function Us(d,A,y){m[(y|=0)>>2]=(0|m[(A|=0)>>2])+(0|m[(d|=0)>>2]),m[y+4>>2]=(0|m[A+4>>2])+(0|m[d+4>>2]),m[y+8>>2]=(0|m[A+8>>2])+(0|m[d+8>>2])}function Hw(d,A,y){m[(y|=0)>>2]=(0|m[(d|=0)>>2])-(0|m[(A|=0)>>2]),m[y+4>>2]=(0|m[d+4>>2])-(0|m[A+4>>2]),m[y+8>>2]=(0|m[d+8>>2])-(0|m[A+8>>2])}function Ck(d,A){var C,y=0;y=0|gh(0|m[(d|=0)>>2],A|=0),m[d>>2]=y,C=0|gh(0|m[(y=d+4|0)>>2],A),m[y>>2]=C,A=0|gh(0|m[(d=d+8|0)>>2],A),m[d>>2]=A}function gv(d){var k,I,A=0,y=0,C=0,S=0,O=0;d=(d=(y=(0|(S=(0|m[8+(d|=0)>>2])-((O=(0|(I=0|m[d>>2]))<0)?I:0)+((k=(0|(C=(0|m[d+4>>2])-(O?I:0)|0))<0)?0-C|0:0)|0))<0)?0:S)-((C=(0|(y=(0|d)<(0|(y=(0|(A=(k?0:C)-(y?S:0)|0))<(0|(S=(O?0:I)-(k?C:0)-(y?S:0)|0))?A:S))?d:y))>0)?y:0)|0,A=A-(C?y:0)|0;e:do{switch(S-(C?y:0)|0){case 0:switch(0|A){case 0:return 0|(0==(0|d)?0:1==(0|d)?1:7);case 1:return 0|(0==(0|d)?2:1==(0|d)?3:7);default:break e}case 1:switch(0|A){case 0:return 0|(0==(0|d)?4:1==(0|d)?5:7);case 1:if(d)break e;return 6;default:break e}}}while(0);return 7}function Ek(d){var I,O,A=0,y=0,C=0,S=0,k=0;C=0|bv(+((3*(A=(0|m[(d|=0)>>2])-(y=0|m[(I=d+8|0)>>2])|0)|0)-(y=(0|m[(O=d+4|0)>>2])-y|0)|0)/7),m[d>>2]=C,A=0|bv(+((y<<1)+A|0)/7),m[O>>2]=A,m[I>>2]=0,y=A-C|0,(0|C)<0?(k=0-C|0,m[O>>2]=y,m[I>>2]=k,m[d>>2]=0,A=y,C=0,y=k):y=0,(0|A)<0&&(m[d>>2]=C=C-A|0,m[I>>2]=y=y-A|0,m[O>>2]=0,A=0),k=C-y|0,S=A-y|0,(0|y)<0?(m[d>>2]=k,m[O>>2]=S,m[I>>2]=0,A=S,S=k,y=0):S=C,!((0|(C=(0|y)<(0|(C=(0|A)<(0|S)?A:S))?y:C))<=0)&&(m[d>>2]=S-C,m[O>>2]=A-C,m[I>>2]=y-C)}function qw(d){var I,O,A=0,y=0,C=0,S=0,k=0;C=0|bv(+(((A=(0|m[(d|=0)>>2])-(y=0|m[(I=d+8|0)>>2])|0)<<1)+(y=(0|m[(O=d+4|0)>>2])-y|0)|0)/7),m[d>>2]=C,A=0|bv(+((3*y|0)-A|0)/7),m[O>>2]=A,m[I>>2]=0,y=A-C|0,(0|C)<0?(k=0-C|0,m[O>>2]=y,m[I>>2]=k,m[d>>2]=0,A=y,C=0,y=k):y=0,(0|A)<0&&(m[d>>2]=C=C-A|0,m[I>>2]=y=y-A|0,m[O>>2]=0,A=0),k=C-y|0,S=A-y|0,(0|y)<0?(m[d>>2]=k,m[O>>2]=S,m[I>>2]=0,A=S,S=k,y=0):S=C,!((0|(C=(0|y)<(0|(C=(0|A)<(0|S)?A:S))?y:C))<=0)&&(m[d>>2]=S-C,m[O>>2]=A-C,m[I>>2]=y-C)}function _v(d){var k,I,O,A=0,y=0,C=0,S=0;C=0|m[(O=8+(d|=0)|0)>>2],m[d>>2]=S=(y=0|m[(I=d+4|0)>>2])+(3*(A=0|m[d>>2])|0)|0,m[I>>2]=y=C+(3*y|0)|0,m[O>>2]=A=(3*C|0)+A|0,C=y-S|0,(0|S)<0?(A=A-S|0,m[I>>2]=C,m[O>>2]=A,m[d>>2]=0,y=C,C=0):C=S,(0|y)<0&&(m[d>>2]=C=C-y|0,m[O>>2]=A=A-y|0,m[I>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(m[d>>2]=k,m[I>>2]=S,m[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(m[d>>2]=C-y,m[I>>2]=S-y,m[O>>2]=A-y)}function ef(d){var k,I,O,A=0,y=0,C=0,S=0;C=(3*(A=0|m[(I=4+(d|=0)|0)>>2])|0)+(S=0|m[d>>2])|0,m[d>>2]=S=(y=0|m[(O=d+8|0)>>2])+(3*S|0)|0,m[I>>2]=C,m[O>>2]=A=(3*y|0)+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,m[I>>2]=y,m[O>>2]=A,m[d>>2]=0,S=0):y=C,(0|y)<0&&(m[d>>2]=S=S-y|0,m[O>>2]=A=A-y|0,m[I>>2]=0,y=0),k=S-A|0,C=y-A|0,(0|A)<0?(m[d>>2]=k,m[I>>2]=C,m[O>>2]=0,S=k,A=0):C=y,!((0|(y=(0|A)<(0|(y=(0|C)<(0|S)?C:S))?A:y))<=0)&&(m[d>>2]=S-y,m[I>>2]=C-y,m[O>>2]=A-y)}function Dk(d,A){d|=0;var y=0,C=0,S=0,k=0,I=0,O=0;((A|=0)-1|0)>>>0>=6||(m[d>>2]=S=(0|m[15472+(12*A|0)>>2])+(0|m[d>>2])|0,m[(O=d+4|0)>>2]=C=(0|m[15472+(12*A|0)+4>>2])+(0|m[O>>2])|0,m[(I=d+8|0)>>2]=A=(0|m[15472+(12*A|0)+8>>2])+(0|m[I>>2])|0,y=C-S|0,(0|S)<0?(A=A-S|0,m[O>>2]=y,m[I>>2]=A,m[d>>2]=0,C=0):(y=C,C=S),(0|y)<0&&(m[d>>2]=C=C-y|0,m[I>>2]=A=A-y|0,m[O>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(m[d>>2]=k,m[O>>2]=S,m[I>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(m[d>>2]=C-y,m[O>>2]=S-y,m[I>>2]=A-y))}function Sk(d){var k,I,O,A=0,y=0,C=0,S=0;C=(A=0|m[(I=4+(d|=0)|0)>>2])+(S=0|m[d>>2])|0,m[d>>2]=S=(y=0|m[(O=d+8|0)>>2])+S|0,m[I>>2]=C,m[O>>2]=A=y+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,m[I>>2]=y,m[O>>2]=A,m[d>>2]=0,C=0):(y=C,C=S),(0|y)<0&&(m[d>>2]=C=C-y|0,m[O>>2]=A=A-y|0,m[I>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(m[d>>2]=k,m[I>>2]=S,m[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(m[d>>2]=C-y,m[I>>2]=S-y,m[O>>2]=A-y)}function yv(d){var k,I,O,A=0,y=0,C=0,S=0;y=0|m[(O=8+(d|=0)|0)>>2],m[d>>2]=S=(C=0|m[(I=d+4|0)>>2])+(A=0|m[d>>2])|0,m[I>>2]=C=y+C|0,m[O>>2]=A=y+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,m[I>>2]=y,m[O>>2]=A,m[d>>2]=0,C=0):(y=C,C=S),(0|y)<0&&(m[d>>2]=C=C-y|0,m[O>>2]=A=A-y|0,m[I>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(m[d>>2]=k,m[I>>2]=S,m[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(m[d>>2]=C-y,m[I>>2]=S-y,m[O>>2]=A-y)}function tf(d){switch(0|(d|=0)){case 1:d=5;break;case 5:d=4;break;case 4:d=6;break;case 6:d=2;break;case 2:d=3;break;case 3:d=1}return 0|d}function gd(d){switch(0|(d|=0)){case 1:d=3;break;case 3:d=2;break;case 2:d=6;break;case 6:d=4;break;case 4:d=5;break;case 5:d=1}return 0|d}function Mk(d){var k,I,O,A=0,y=0,C=0,S=0;C=0|m[(O=8+(d|=0)|0)>>2],m[d>>2]=S=(y=0|m[(I=d+4|0)>>2])+((A=0|m[d>>2])<<1)|0,m[I>>2]=y=C+(y<<1)|0,m[O>>2]=A=(C<<1)+A|0,C=y-S|0,(0|S)<0?(A=A-S|0,m[I>>2]=C,m[O>>2]=A,m[d>>2]=0,y=C,C=0):C=S,(0|y)<0&&(m[d>>2]=C=C-y|0,m[O>>2]=A=A-y|0,m[I>>2]=0,y=0),k=C-A|0,S=y-A|0,(0|A)<0?(m[d>>2]=k,m[I>>2]=S,m[O>>2]=0,C=k,A=0):S=y,!((0|(y=(0|A)<(0|(y=(0|S)<(0|C)?S:C))?A:y))<=0)&&(m[d>>2]=C-y,m[I>>2]=S-y,m[O>>2]=A-y)}function Tk(d){var k,I,O,A=0,y=0,C=0,S=0;C=((A=0|m[(I=4+(d|=0)|0)>>2])<<1)+(S=0|m[d>>2])|0,m[d>>2]=S=(y=0|m[(O=d+8|0)>>2])+(S<<1)|0,m[I>>2]=C,m[O>>2]=A=(y<<1)+A|0,y=C-S|0,(0|S)<0?(A=A-S|0,m[I>>2]=y,m[O>>2]=A,m[d>>2]=0,S=0):y=C,(0|y)<0&&(m[d>>2]=S=S-y|0,m[O>>2]=A=A-y|0,m[I>>2]=0,y=0),k=S-A|0,C=y-A|0,(0|A)<0?(m[d>>2]=k,m[I>>2]=C,m[O>>2]=0,S=k,A=0):C=y,!((0|(y=(0|A)<(0|(y=(0|C)<(0|S)?C:S))?A:y))<=0)&&(m[d>>2]=S-y,m[I>>2]=C-y,m[O>>2]=A-y)}function Zw(d,A){var k,I,O,y=0,C=0,S=0;return A=(A=(d=(0|(S=((O=(0|(I=(0|m[(d|=0)>>2])-(0|m[(A|=0)>>2])|0))<0)?0-I|0:0)+(0|m[d+8>>2])-(0|m[A+8>>2])+((k=(0|(C=(0|m[d+4>>2])-(0|m[A+4>>2])-(O?I:0)|0))<0)?0-C|0:0)|0))<0)?0:S)-((C=(0|(d=(0|A)<(0|(d=(0|(y=(k?0:C)-(d?S:0)|0))<(0|(S=(O?0:I)-(k?C:0)-(d?S:0)|0))?y:S))?A:d))>0)?d:0)|0,y=y-(C?d:0)|0,0|((0|(d=(0|(d=S-(C?d:0)|0))>-1?d:0-d|0))>(0|(A=(0|(y=(0|y)>-1?y:0-y|0))>(0|(A=(0|A)>-1?A:0-A|0))?y:A))?d:A)}function Ik(d){var A,y,C,S;m[(d|=0)>>2]=y=(S=0|m[(A=d+8|0)>>2])-(0|m[d>>2])|0,m[(C=d+4|0)>>2]=d=(0|m[C>>2])-S|0,m[A>>2]=0-(d+y)}function Gj(d){var I,O,A=0,y=0,C=0,S=0,k=0;m[(d|=0)>>2]=A=0-(y=0|m[d>>2])|0,m[(I=d+8|0)>>2]=0,S=(C=0|m[(O=d+4|0)>>2])+y|0,(0|y)>0?(m[O>>2]=S,m[I>>2]=y,m[d>>2]=0,A=0,C=S):y=0,(0|C)<0?(m[d>>2]=k=A-C|0,m[I>>2]=y=y-C|0,m[O>>2]=0,S=k-y|0,A=0-y|0,(0|y)<0?(m[d>>2]=S,m[O>>2]=A,m[I>>2]=0,C=A,y=0):(C=0,S=k)):S=A,!((0|(A=(0|y)<(0|(A=(0|C)<(0|S)?C:S))?y:A))<=0)&&(m[d>>2]=S-A,m[O>>2]=C-A,m[I>>2]=y-A)}function _0(d,A,y,C,S){A|=0,y|=0,C|=0,S|=0;var k=0,I=0;if((k=+function(d){var A,y;return+ +ki(+((y=+pe[(d|=0)>>3])*y+(A=+pe[d+8>>3])*A))}(d|=0))<1e-16)return m[S>>2]=m[(A=15568+(A<<4)|0)>>2],m[S+4>>2]=m[A+4>>2],m[S+8>>2]=m[A+8>>2],void(m[S+12>>2]=m[A+12>>2]);if(I=+gl(+ +pe[d+8>>3],+ +pe[d>>3]),(0|y)>0){d=0;do{k/=2.6457513110645907,d=d+1|0}while((0|d)!=(0|y))}C?(k/=3,y=0==(0|_l(y)),k=+zw(.381966011250105*(y?k:k/2.6457513110645907))):(k=+zw(.381966011250105*k),0|_l(y)&&(I=+y0(I+.3334731722518321))),function(d,A,y,C){d|=0,A=+A,C|=0;var S=0,k=0,I=0,O=0;if((y=+y)<1e-16)return m[C>>2]=m[d>>2],m[C+4>>2]=m[d+4>>2],m[C+8>>2]=m[d+8>>2],void(m[C+12>>2]=m[d+12>>2]);k=A<0?A+6.283185307179586:A,k=A>=6.283185307179586?k+-6.283185307179586:k;do{if(!(k<1e-16)){if(S=+nr(+(k+-3.141592653589793))<1e-16,A=+pe[d>>3],S){pe[C>>3]=A-=y,S=C;break}if(I=+Qn(+y),y=+ar(+y),A=I*+ar(+A)+ +Qn(+k)*(y*+Qn(+A)),A=+fj(+((A=A>1?1:A)<-1?-1:A)),pe[C>>3]=A,+nr(+(A+-1.5707963267948966))<1e-16)return pe[C>>3]=1.5707963267948966,void(pe[C+8>>3]=0);if(+nr(+(A+1.5707963267948966))<1e-16)return pe[C>>3]=-1.5707963267948966,void(pe[C+8>>3]=0);if(O=+Qn(+A),k=y*+ar(+k)/O,y=+pe[d>>3],A=(I-+ar(+A)*+ar(+y))/+Qn(+y)/O,(A=+pe[d+8>>3]+ +gl(+((I=k>1?1:k)<-1?-1:I),+((A=A>1?1:A)<-1?-1:A)))>3.141592653589793)do{A+=-6.283185307179586}while(A>3.141592653589793);if(A<-3.141592653589793)do{A+=6.283185307179586}while(A<-3.141592653589793);return void(pe[C+8>>3]=A)}pe[C>>3]=A=+pe[d>>3]+y,S=C}while(0);if(+nr(+(A+-1.5707963267948966))<1e-16)return pe[S>>3]=1.5707963267948966,void(pe[C+8>>3]=0);if(+nr(+(A+1.5707963267948966))<1e-16)return pe[S>>3]=-1.5707963267948966,void(pe[C+8>>3]=0);if((A=+pe[d+8>>3])>3.141592653589793)do{A+=-6.283185307179586}while(A>3.141592653589793);if(A<-3.141592653589793)do{A+=6.283185307179586}while(A<-3.141592653589793);pe[C+8>>3]=A}(15568+(A<<4)|0,+y0(+pe[16368+(24*A|0)>>3]-I),k,S)}function kk(d,A,y,C,S){d|=0,y|=0,C|=0,S|=0;var G,X,ee,ye,Te,ze,Qe,Ke,Ct,Lt,gt,Ie,Nt,zt,kt,Ft,In,Fr,br,Hr,yr,ri,k=0,I=0,O=0,qe=0,ii=0,yn=0;if(ri=me,me=me+272|0,qe=ri+240|0,br=ri,Hr=ri+224|0,yr=ri+208|0,gt=ri+176|0,Ie=ri+160|0,Nt=ri+192|0,zt=ri+144|0,kt=ri+128|0,Ft=ri+112|0,In=ri+96|0,Fr=ri+80|0,m[(k=ri+256|0)>>2]=A|=0,m[qe>>2]=m[d>>2],m[qe+4>>2]=m[d+4>>2],m[qe+8>>2]=m[d+8>>2],m[qe+12>>2]=m[d+12>>2],Pk(qe,k,br),m[S>>2]=0,(0|(qe=C+y+(5==(0|C)&1)|0))<=(0|y))me=ri;else{X=Hr+4|0,ee=gt+4|0,ye=y+5|0,Te=16848+((G=0|m[k>>2])<<2)|0,ze=16928+(G<<2)|0,Qe=kt+8|0,Ke=Ft+8|0,Ct=In+8|0,Lt=yr+4|0,O=y;e:for(;;){m[yr>>2]=m[(I=br+(((0|O)%5|0)<<4)|0)>>2],m[yr+4>>2]=m[I+4>>2],m[yr+8>>2]=m[I+8>>2],m[yr+12>>2]=m[I+12>>2];do{}while(2==(0|em(yr,G,0,1)));if((0|O)>(0|y)&0!=(0|_l(A))){if(m[gt>>2]=m[yr>>2],m[gt+4>>2]=m[yr+4>>2],m[gt+8>>2]=m[yr+8>>2],m[gt+12>>2]=m[yr+12>>2],JA(X,Ie),m[gt>>2]=m[18608+(80*(C=0|m[gt>>2])|0)+(20*(k=0|m[17008+(80*C|0)+(m[Hr>>2]<<2)>>2])|0)>>2],(0|(I=0|m[18608+(80*C|0)+(20*k|0)+16>>2]))>0){d=0;do{Sk(ee),d=d+1|0}while((0|d)<(0|I))}switch(m[Nt>>2]=m[(I=18608+(80*C|0)+(20*k|0)+4|0)>>2],m[Nt+4>>2]=m[I+4>>2],m[Nt+8>>2]=m[I+8>>2],Ck(Nt,3*(0|m[Te>>2])|0),Us(ee,Nt,ee),fs(ee),JA(ee,zt),pe[kt>>3]=3*(ii=+(0|m[ze>>2])),pe[Qe>>3]=0,pe[Ft>>3]=yn=-1.5*ii,pe[Ke>>3]=2.598076211353316*ii,pe[In>>3]=yn,pe[Ct>>3]=-2.598076211353316*ii,0|m[17008+(80*(0|m[gt>>2])|0)+(m[yr>>2]<<2)>>2]){case 1:d=Ft,C=kt;break;case 3:d=In,C=Ft;break;case 2:d=kt,C=In;break;default:d=12;break e}$k(Ie,zt,C,d,Fr),_0(Fr,0|m[gt>>2],G,1,S+8+(m[S>>2]<<4)|0),m[S>>2]=1+(0|m[S>>2])}if((0|O)<(0|ye)&&(JA(Lt,gt),_0(gt,0|m[yr>>2],G,1,S+8+(m[S>>2]<<4)|0),m[S>>2]=1+(0|m[S>>2])),m[Hr>>2]=m[yr>>2],m[Hr+4>>2]=m[yr+4>>2],m[Hr+8>>2]=m[yr+8>>2],m[Hr+12>>2]=m[yr+12>>2],(0|(O=O+1|0))>=(0|qe)){d=3;break}}3!=(0|d)?12==(0|d)&&Rr(22474,22521,581,22531):me=ri}}function Pk(d,A,y){d|=0,A|=0,y|=0;var G,C=0,S=0,k=0,I=0,O=0;G=me,me=me+128|0,S=G,I=20208,O=60+(k=C=G+64|0)|0;do{m[k>>2]=m[I>>2],k=k+4|0,I=I+4|0}while((0|k)<(0|O));I=20272,O=(k=S)+60|0;do{m[k>>2]=m[I>>2],k=k+4|0,I=I+4|0}while((0|k)<(0|O));C=(O=0==(0|_l(0|m[A>>2])))?C:S,Mk(S=d+4|0),Tk(S),0|_l(0|m[A>>2])&&(ef(S),m[A>>2]=1+(0|m[A>>2])),m[y>>2]=m[d>>2],Us(S,C,A=y+4|0),fs(A),m[y+16>>2]=m[d>>2],Us(S,C+12|0,A=y+20|0),fs(A),m[y+32>>2]=m[d>>2],Us(S,C+24|0,A=y+36|0),fs(A),m[y+48>>2]=m[d>>2],Us(S,C+36|0,A=y+52|0),fs(A),m[y+64>>2]=m[d>>2],Us(S,C+48|0,y=y+68|0),fs(y),me=G}function em(d,A,y,C){y|=0;var I,O,X,ee,Te,Qe,S=0,k=0,G=0,ye=0,ze=0;if(Qe=me,me=me+32|0,Te=Qe+12|0,O=Qe,ye=0|m[16928+((A|=0)<<2)>>2],ye=(ee=0!=(0|(C|=0)))?3*ye|0:ye,S=0|m[(ze=4+(d|=0)|0)>>2],I=0|m[(X=d+8|0)>>2],ee){if((0|(S=I+S+(C=0|m[(k=d+12|0)>>2])|0))==(0|ye))return me=Qe,1;G=k}else S=I+S+(C=0|m[(G=d+12|0)>>2])|0;if((0|S)<=(0|ye))return me=Qe,0;do{if((0|C)>0){if(C=0|m[d>>2],(0|I)>0){k=18608+(80*C|0)+60|0,C=d;break}C=18608+(80*C|0)+40|0,y?(zj(Te,ye,0,0),Hw(ze,Te,O),yv(O),Us(O,Te,ze),k=C,C=d):(k=C,C=d)}else k=18608+(80*(0|m[d>>2])|0)+20|0,C=d}while(0);if(m[C>>2]=m[k>>2],(0|m[(S=k+16|0)>>2])>0){C=0;do{Sk(ze),C=C+1|0}while((0|C)<(0|m[S>>2]))}return m[Te>>2]=m[(d=k+4|0)>>2],m[Te+4>>2]=m[d+4>>2],m[Te+8>>2]=m[d+8>>2],A=0|m[16848+(A<<2)>>2],Ck(Te,ee?3*A|0:A),Us(ze,Te,ze),fs(ze),me=Qe,0|(ee&&((0|m[X>>2])+(0|m[ze>>2])+(0|m[G>>2])|0)==(0|ye)?1:2)}function Zj(d,A){d|=0,A|=0;var y=0;do{y=0|em(d,A,0,1)}while(2==(0|y));return 0|y}function Rk(d,A,y,C,S){d|=0,y|=0,C|=0,S|=0;var G,X,ee,ye,Te,ze,Qe,Ke,Ct,Lt,qe,gt,Ie,Nt,zt,kt,Ft,In,k=0,I=0,O=0,Fr=0,br=0;if(In=me,me=me+240|0,Nt=In+208|0,zt=In,kt=In+192|0,Ft=In+176|0,Ct=In+160|0,Lt=In+144|0,qe=In+128|0,gt=In+112|0,Ie=In+96|0,m[(k=In+224|0)>>2]=A|=0,m[Nt>>2]=m[d>>2],m[Nt+4>>2]=m[d+4>>2],m[Nt+8>>2]=m[d+8>>2],m[Nt+12>>2]=m[d+12>>2],Fk(Nt,k,zt),m[S>>2]=0,(0|(Ke=C+y+(6==(0|C)&1)|0))<=(0|y))me=In;else{X=y+6|0,ee=16928+((G=0|m[k>>2])<<2)|0,ye=Lt+8|0,Te=qe+8|0,ze=gt+8|0,Qe=kt+4|0,I=0,O=y,C=-1;e:for(;;){if(m[kt>>2]=m[(d=zt+((k=(0|O)%6|0)<<4)|0)>>2],m[kt+4>>2]=m[d+4>>2],m[kt+8>>2]=m[d+8>>2],m[kt+12>>2]=m[d+12>>2],d=I,I=0|em(kt,G,0,1),(0|O)>(0|y)&0!=(0|_l(A))&&1!=(0|d)&&(0|m[kt>>2])!=(0|C)){switch(JA(zt+(((k+5|0)%6|0)<<4)+4|0,Ft),JA(zt+(k<<4)+4|0,Ct),pe[Lt>>3]=3*(Fr=+(0|m[ee>>2])),pe[ye>>3]=0,pe[qe>>3]=br=-1.5*Fr,pe[Te>>3]=2.598076211353316*Fr,pe[gt>>3]=br,pe[ze>>3]=-2.598076211353316*Fr,0|m[17008+(80*(k=0|m[Nt>>2])|0)+(((0|C)==(0|k)?0|m[kt>>2]:C)<<2)>>2]){case 1:d=qe,C=Lt;break;case 3:d=gt,C=qe;break;case 2:d=Lt,C=gt;break;default:d=8;break e}$k(Ft,Ct,C,d,Ie),!(0|Hk(Ft,Ie))&&!(0|Hk(Ct,Ie))&&(_0(Ie,0|m[Nt>>2],G,1,S+8+(m[S>>2]<<4)|0),m[S>>2]=1+(0|m[S>>2]))}if((0|O)<(0|X)&&(JA(Qe,Ft),_0(Ft,0|m[kt>>2],G,1,S+8+(m[S>>2]<<4)|0),m[S>>2]=1+(0|m[S>>2])),(0|(O=O+1|0))>=(0|Ke)){d=3;break}C=0|m[kt>>2]}3!=(0|d)?8==(0|d)&&Rr(22557,22521,746,22602):me=In}}function Fk(d,A,y){d|=0,A|=0,y|=0;var G,C=0,S=0,k=0,I=0,O=0;G=me,me=me+160|0,S=G,I=20336,O=72+(k=C=G+80|0)|0;do{m[k>>2]=m[I>>2],k=k+4|0,I=I+4|0}while((0|k)<(0|O));I=20416,O=(k=S)+72|0;do{m[k>>2]=m[I>>2],k=k+4|0,I=I+4|0}while((0|k)<(0|O));C=(O=0==(0|_l(0|m[A>>2])))?C:S,Mk(S=d+4|0),Tk(S),0|_l(0|m[A>>2])&&(ef(S),m[A>>2]=1+(0|m[A>>2])),m[y>>2]=m[d>>2],Us(S,C,A=y+4|0),fs(A),m[y+16>>2]=m[d>>2],Us(S,C+12|0,A=y+20|0),fs(A),m[y+32>>2]=m[d>>2],Us(S,C+24|0,A=y+36|0),fs(A),m[y+48>>2]=m[d>>2],Us(S,C+36|0,A=y+52|0),fs(A),m[y+64>>2]=m[d>>2],Us(S,C+48|0,A=y+68|0),fs(A),m[y+80>>2]=m[d>>2],Us(S,C+60|0,y=y+84|0),fs(y),me=G}function y0(d){var A;return A=(d=+d)<0?d+6.283185307179586:d,+(d>=6.283185307179586?A+-6.283185307179586:A)}function tm(d,A){return+nr(+(+pe[(d|=0)>>3]-+pe[(A|=0)>>3]))<17453292519943298e-27?0|(A=+nr(+(+pe[d+8>>3]-+pe[A+8>>3]))<17453292519943298e-27):0|(A=0)}function v0(d,A){var C,S,k,y=0;return y=(k=+ar(.5*((S=+pe[(A|=0)>>3])-(C=+pe[(d|=0)>>3]))))*k+(y=+ar(.5*(+pe[A+8>>3]-+pe[d+8>>3])))*(+Qn(+S)*+Qn(+C)*y),2*+gl(+ +ki(+y),+ +ki(+(1-y)))*6371.007180918475}function nm(d,A,y){y|=0;var O,X,ee,ye,C=0,S=0,k=0,I=0,G=0,Te=0;return G=+ar(.5*((Te=+pe[(A|=0)>>3])-(ee=+pe[(d|=0)>>3]))),I=+ar(.5*((k=+pe[A+8>>3])-(X=+pe[d+8>>3]))),O=+Qn(+ee),ye=+Qn(+Te),I=2*+gl(+ +ki(+(I=G*G+I*(ye*O*I))),+ +ki(+(1-I))),Te=+ar(.5*((G=+pe[y>>3])-Te)),k=+ar(.5*((C=+pe[y+8>>3])-k)),S=+Qn(+G),k=2*+gl(+ +ki(+(k=Te*Te+k*(ye*S*k))),+ +ki(+(1-k))),G=+ar(.5*(ee-G)),C=+ar(.5*(X-C)),C=2*+gl(+ +ki(+(C=G*G+C*(O*S*C))),+ +ki(+(1-C))),4*+zw(+ +ki(+ +md(.5*(S=.5*(I+k+C)))*+md(.5*(S-I))*+md(.5*(S-k))*+md(.5*(S-C))))}function Ok(d,A){return A=0|bt(0|(d|=0),0|(A|=0),45),De(),127&A|0}function Lk(d,A){d|=0;var y=0,C=0,S=0,k=0,I=0,O=0;if(!(!0&134217728==(-16777216&(A|=0)|0))||(I=0|bt(0|d,0|A,45),De(),(I&=127)>>>0>121))return 0;y=0|bt(0|d,0|A,52),De(),y&=15;do{if(0|y){for(S=1,C=0;;){if(k=0|bt(0|d,0|A,3*(15-S|0)|0),De(),0!=(0|(k&=7))&(1^C)){if(1==(0|k)&0!=(0|gi(I))){O=0,C=13;break}C=1}if(7==(0|k)){O=0,C=13;break}if(!(S>>>0<y>>>0)){C=9;break}S=S+1|0}if(9==(0|C)){if(15!=(0|y))break;return 1}if(13==(0|C))return 0|O}}while(0);for(;;){if(O=0|bt(0|d,0|A,3*(14-y|0)|0),De(),!(7==(7&O|0)&!0)){O=0,C=13;break}if(!(y>>>0<14)){O=1,C=13;break}y=y+1|0}return 13==(0|C)?0|O:0}function Ww(d,A,y){y|=0;var C=0,S=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|(C&=15))>=(0|y)){if((0|C)!=(0|y))if(y>>>0<=15){if(d|=S=0|Ot(0|y,0,52),A=0|De()|-15728641&A,(0|C)>(0|y))do{S=0|Ot(7,0,3*(14-y|0)|0),y=y+1|0,d|=S,A=0|De()|A}while((0|y)<(0|C))}else A=0,d=0}else A=0,d=0;return Mn(0|A),0|d}function da(d,A,y,C){y|=0,C|=0;var S=0,k=0,I=0,O=0,G=0,X=0,ee=0;if(I=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|y)<16&(0|(I&=15))<=(0|y)){if((0|I)==(0|y))return m[(y=C)>>2]=d,void(m[y+4>>2]=A);if(X=(0|(G=0|xv(7,y-I|0)))/7|0,O=0|bt(0|d,0|A,45),De(),0|gi(127&O)){e:do{if(I)for(k=1;;){if(S=0|bt(0|d,0|A,3*(15-k|0)|0),De(),0|(S&=7))break e;if(!(k>>>0<I>>>0)){S=0;break}k=k+1|0}else S=0}while(0);k=0==(0|S)}else k=0;if(ee=0|Ot(I+1|0,0,52),S=0|De()|-15728641&A,da(A=(ee|d)&~(A=0|Ot(7,0,0|(O=3*(14-I|0)|0))),I=S&~(0|De()),y,C),S=C+(X<<3)|0,!k)return da((ee=0|Ot(1,0,0|O))|A,0|De()|I,y,S),ee=S+(X<<3)|0,da((G=0|Ot(2,0,0|O))|A,0|De()|I,y,ee),ee=ee+(X<<3)|0,da((G=0|Ot(3,0,0|O))|A,0|De()|I,y,ee),ee=ee+(X<<3)|0,da((G=0|Ot(4,0,0|O))|A,0|De()|I,y,ee),ee=ee+(X<<3)|0,da((G=0|Ot(5,0,0|O))|A,0|De()|I,y,ee),void da((G=0|Ot(6,0,0|O))|A,0|De()|I,y,ee+(X<<3)|0);k=S+(X<<3)|0,(0|G)>6&&(oc(0|S,0,8+(ee=(k>>>0>(G=S+8|0)>>>0?k:G)+-1+(0-S)|0)&-8|0),S=G+(ee>>>3<<3)|0),da((ee=0|Ot(2,0,0|O))|A,0|De()|I,y,S),ee=S+(X<<3)|0,da((G=0|Ot(3,0,0|O))|A,0|De()|I,y,ee),ee=ee+(X<<3)|0,da((G=0|Ot(4,0,0|O))|A,0|De()|I,y,ee),ee=ee+(X<<3)|0,da((G=0|Ot(5,0,0|O))|A,0|De()|I,y,ee),da((G=0|Ot(6,0,0|O))|A,0|De()|I,y,ee+(X<<3)|0)}}function wo(d,A){var y=0,C=0,S=0;if(S=0|bt(0|(d|=0),0|(A|=0),45),De(),!(0|gi(127&S)))return 0;S=0|bt(0|d,0|A,52),De(),S&=15;e:do{if(S)for(C=1;;){if(y=0|bt(0|d,0|A,3*(15-C|0)|0),De(),0|(y&=7))break e;if(!(C>>>0<S>>>0)){y=0;break}C=C+1|0}else y=0}while(0);return 0|0==(0|y)&1}function Aa(d,A){var y=0,C=0,S=0;if(S=0|bt(0|(d|=0),0|(A|=0),52),De(),!(S&=15))return 0;for(C=1;;){if(y=0|bt(0|d,0|A,3*(15-C|0)|0),De(),0|(y&=7)){C=5;break}if(!(C>>>0<S>>>0)){y=0,C=5;break}C=C+1|0}return 5==(0|C)?0|y:0}function Qw(d,A){var y=0,C=0,S=0,k=0,I=0,O=0,G=0;if(G=0|bt(0|(d|=0),0|(A|=0),52),De(),!(G&=15))return G=d,Mn(0|(O=A)),0|G;for(O=1,y=0;;){C=0|Ot(7,0,0|(k=3*(15-O|0)|0)),S=0|De(),I=0|bt(0|d,0|A,0|k),De(),d=(k=0|Ot(0|tf(7&I),0,0|k))|d&~C,A=(I=0|De())|A&~S;e:do{if(!y)if(0==(k&C|0)&0==(I&S|0))y=0;else if(C=0|bt(0|d,0|A,52),De(),C&=15,C){y=1;t:for(;;){switch(I=0|bt(0|d,0|A,3*(15-y|0)|0),De(),7&I){case 1:break t;case 0:break;default:y=1;break e}if(!(y>>>0<C>>>0)){y=1;break e}y=y+1|0}for(y=1;;){if(S=0|bt(0|d,0|A,0|(I=3*(15-y|0)|0)),De(),k=0|Ot(7,0,0|I),A&=~(0|De()),d=d&~k|(I=0|Ot(0|tf(7&S),0,0|I)),A=0|A|De(),!(y>>>0<C>>>0)){y=1;break}y=y+1|0}}else y=1}while(0);if(!(O>>>0<G>>>0))break;O=O+1|0}return Mn(0|A),0|d}function _d(d,A){var y=0,C=0,S=0,k=0,I=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),!(C&=15))return C=d,Mn(0|(y=A)),0|C;for(y=1;I=0|bt(0|d,0|A,0|(k=3*(15-y|0)|0)),De(),S=0|Ot(7,0,0|k),A&=~(0|De()),d=(k=0|Ot(0|tf(7&I),0,0|k))|d&~S,A=0|De()|A,y>>>0<C>>>0;)y=y+1|0;return Mn(0|A),0|d}function m7(d,A){var y=0,C=0,S=0,k=0,I=0,O=0,G=0;if(G=0|bt(0|(d|=0),0|(A|=0),52),De(),!(G&=15))return G=d,Mn(0|(O=A)),0|G;for(O=1,y=0;;){C=0|Ot(7,0,0|(k=3*(15-O|0)|0)),S=0|De(),I=0|bt(0|d,0|A,0|k),De(),d=(k=0|Ot(0|gd(7&I),0,0|k))|d&~C,A=(I=0|De())|A&~S;e:do{if(!y)if(0==(k&C|0)&0==(I&S|0))y=0;else if(C=0|bt(0|d,0|A,52),De(),C&=15,C){y=1;t:for(;;){switch(I=0|bt(0|d,0|A,3*(15-y|0)|0),De(),7&I){case 1:break t;case 0:break;default:y=1;break e}if(!(y>>>0<C>>>0)){y=1;break e}y=y+1|0}for(y=1;;){if(k=0|Ot(7,0,0|(S=3*(15-y|0)|0)),I=A&~(0|De()),A=0|bt(0|d,0|A,0|S),De(),d=d&~k|(A=0|Ot(0|gd(7&A),0,0|S)),A=0|I|De(),!(y>>>0<C>>>0)){y=1;break}y=y+1|0}}else y=1}while(0);if(!(O>>>0<G>>>0))break;O=O+1|0}return Mn(0|A),0|d}function Xw(d,A){var y=0,C=0,S=0,k=0,I=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),!(C&=15))return C=d,Mn(0|(y=A)),0|C;for(y=1;k=0|Ot(7,0,0|(I=3*(15-y|0)|0)),S=A&~(0|De()),A=0|bt(0|d,0|A,0|I),De(),d=(A=0|Ot(0|gd(7&A),0,0|I))|d&~k,A=0|De()|S,y>>>0<C>>>0;)y=y+1|0;return Mn(0|A),0|d}function _l(d){return 0|(0|(d|=0))%2}function Bk(d,A){var y,C;return d|=0,C=me,me=me+16|0,y=C,(A|=0)>>>0<=15&&2146435072!=(2146435072&m[d+4>>2]|0)&&2146435072!=(2146435072&m[d+8+4>>2]|0)?(function(d,A,y){var C,S;C=me,me=me+16|0,function(d,A,y,C){A|=0,y|=0,C|=0;var G,S=0,k=0,I=0,O=0;if(G=me,me=me+32|0,function(d,A){A|=0;var C,S,y=0;C=+Qn(+(y=+pe[(d|=0)>>3])),y=+ar(+y),pe[A+16>>3]=y,S=C*+Qn(+(y=+pe[d+8>>3])),pe[A>>3]=S,y=C*+ar(+y),pe[A+8>>3]=y}(d|=0,k=G),m[y>>2]=0,S=+Ao(15888,k),(I=+Ao(15912,k))<S&&(m[y>>2]=1,S=I),(I=+Ao(15936,k))<S&&(m[y>>2]=2,S=I),(I=+Ao(15960,k))<S&&(m[y>>2]=3,S=I),(I=+Ao(15984,k))<S&&(m[y>>2]=4,S=I),(I=+Ao(16008,k))<S&&(m[y>>2]=5,S=I),(I=+Ao(16032,k))<S&&(m[y>>2]=6,S=I),(I=+Ao(16056,k))<S&&(m[y>>2]=7,S=I),(I=+Ao(16080,k))<S&&(m[y>>2]=8,S=I),(I=+Ao(16104,k))<S&&(m[y>>2]=9,S=I),(I=+Ao(16128,k))<S&&(m[y>>2]=10,S=I),(I=+Ao(16152,k))<S&&(m[y>>2]=11,S=I),(I=+Ao(16176,k))<S&&(m[y>>2]=12,S=I),(I=+Ao(16200,k))<S&&(m[y>>2]=13,S=I),(I=+Ao(16224,k))<S&&(m[y>>2]=14,S=I),(I=+Ao(16248,k))<S&&(m[y>>2]=15,S=I),(I=+Ao(16272,k))<S&&(m[y>>2]=16,S=I),(I=+Ao(16296,k))<S&&(m[y>>2]=17,S=I),(I=+Ao(16320,k))<S&&(m[y>>2]=18,S=I),(I=+Ao(16344,k))<S&&(m[y>>2]=19,S=I),(I=+Aj(+(1-.5*S)))<1e-16)return m[C>>2]=0,m[C+4>>2]=0,m[C+8>>2]=0,m[C+12>>2]=0,void(me=G);if(S=+y0((S=+pe[16368+(24*(y=0|m[y>>2])|0)>>3])-+y0(+function(d,A){var y,C,S,k,I;return d|=0,I=(C=+Qn(+(k=+pe[(A|=0)>>3])))*+ar(+(S=+pe[A+8>>3]-+pe[d+8>>3])),y=+pe[d>>3],+ +gl(+I,+(+ar(+k)*+Qn(+y)-+Qn(+S)*(C*+ar(+y))))}(15568+(y<<4)|0,d))),O=0|_l(A)?+y0(S+-.3334731722518321):S,S=+md(+I)/.381966011250105,(0|A)>0){k=0;do{S*=2.6457513110645907,k=k+1|0}while((0|k)!=(0|A))}I=+Qn(+O)*S,pe[C>>3]=I,O=+ar(+O)*S,pe[C+8>>3]=O,me=G}(d|=0,A|=0,y|=0,S=C),function(d,A){d|=0;var k,G,X,ye,y=0,C=0,S=0,I=0,O=0,ee=0,Te=0;m[(ye=8+(A|=0)|0)>>2]=0,I=+nr(+(G=+pe[d>>3])),I+=.5*(O=+nr(+(X=+pe[d+8>>3]))/.8660254037844386),I-=+(0|(y=~~I)),O-=+(0|(d=~~O));do{if(I<.5){if(I<.3333333333333333){if(m[A>>2]=y,O<.5*(I+1)){m[A+4>>2]=d;break}m[A+4>>2]=d=d+1|0;break}if(m[A+4>>2]=d=(1&!(O<(Te=1-I)))+d|0,Te<=O&O<2*I){m[A>>2]=y=y+1|0;break}m[A>>2]=y;break}if(!(I<.6666666666666666)){if(m[A>>2]=y=y+1|0,O<.5*I){m[A+4>>2]=d;break}m[A+4>>2]=d=d+1|0;break}if(O<1-I){if(m[A+4>>2]=d,2*I-1<O){m[A>>2]=y;break}}else m[A+4>>2]=d=d+1|0;m[A>>2]=y=y+1|0}while(0);do{if(G<0){if(1&d){y=~~(+(0|y)-(2*(+((ee=0|b0(0|y,((0|y)<0)<<31>>31|0,0|(ee=(d+1|0)/2|0),((0|ee)<0)<<31>>31|0))>>>0)+4294967296*+(0|De()))+1)),m[A>>2]=y;break}y=~~(+(0|y)-2*(+((ee=0|b0(0|y,((0|y)<0)<<31>>31|0,0|(ee=(0|d)/2|0),((0|ee)<0)<<31>>31|0))>>>0)+4294967296*+(0|De()))),m[A>>2]=y;break}}while(0);ee=A+4|0,X<0&&(m[A>>2]=y=y-((1|d<<1)/2|0)|0,m[ee>>2]=d=0-d|0),C=d-y|0,(0|y)<0?(S=0-y|0,m[ee>>2]=C,m[ye>>2]=S,m[A>>2]=0,d=C,y=0):S=0,(0|d)<0&&(m[A>>2]=y=y-d|0,m[ye>>2]=S=S-d|0,m[ee>>2]=0,d=0),k=y-S|0,C=d-S|0,(0|S)<0&&(m[A>>2]=k,m[ee>>2]=C,m[ye>>2]=0,d=C,y=k,S=0),!((0|(C=(0|S)<(0|(C=(0|d)<(0|y)?d:y))?S:C))<=0)&&(m[A>>2]=y-C,m[ee>>2]=d-C,m[ye>>2]=S-C)}(S,y+4|0),me=C}(d,A,y),A=0|function(d,A){d|=0;var G,y=0,C=0,S=0,k=0,I=0,O=0,X=0,ee=0;if(G=me,me=me+64|0,O=G+40|0,C=G+24|0,S=G+12|0,k=G,Ot(0|(A|=0),0,52),y=134225919|De(),!A)return(0|m[d+4>>2])>2||(0|m[d+8>>2])>2||(0|m[d+12>>2])>2?(O=0,Mn(0|(I=0)),me=G,0|O):(Ot(0|vk(d),0,45),I=0|De()|y,O=-1,Mn(0|I),me=G,0|O);if(m[O>>2]=m[d>>2],m[O+4>>2]=m[d+4>>2],m[O+8>>2]=m[d+8>>2],m[O+12>>2]=m[d+12>>2],I=O+4|0,(0|A)>0)for(d=-1;m[C>>2]=m[I>>2],m[C+4>>2]=m[I+4>>2],m[C+8>>2]=m[I+8>>2],1&A?(Ek(I),m[S>>2]=m[I>>2],m[S+4>>2]=m[I+4>>2],m[S+8>>2]=m[I+8>>2],_v(S)):(qw(I),m[S>>2]=m[I>>2],m[S+4>>2]=m[I+4>>2],m[S+8>>2]=m[I+8>>2],ef(S)),Hw(C,S,k),fs(k),X=0|Ot(7,0,0|(ee=3*(15-A|0)|0)),y&=~(0|De()),d=(ee=0|Ot(0|gv(k),0,0|ee))|d&~X,y=0|De()|y,(0|A)>1;)A=A+-1|0;else d=-1;e:do{if((0|m[I>>2])<=2&&(0|m[O+8>>2])<=2&&(0|m[O+12>>2])<=2){if(A=0|Ot(0|(C=0|vk(O)),0,45),A|=d,d=0|De()|-1040385&y,k=0|Rj(O),!(0|gi(C))){if((0|k)<=0)break;for(S=0;;){if(C=0|bt(0|A,0|d,52),De(),C&=15)for(y=1;O=0|bt(0|A,0|d,0|(ee=3*(15-y|0)|0)),De(),X=0|Ot(7,0,0|ee),d&=~(0|De()),A=A&~X|(ee=0|Ot(0|tf(7&O),0,0|ee)),d=0|d|De(),y>>>0<C>>>0;)y=y+1|0;if((0|(S=S+1|0))==(0|k))break e}}S=0|bt(0|A,0|d,52),De(),S&=15;t:do{if(S){y=1;n:for(;;){switch(ee=0|bt(0|A,0|d,3*(15-y|0)|0),De(),7&ee){case 1:break n;case 0:break;default:break t}if(!(y>>>0<S>>>0))break t;y=y+1|0}if(0|xk(C,0|m[O>>2]))for(y=1;X=0|Ot(7,0,0|(O=3*(15-y|0)|0)),ee=d&~(0|De()),d=0|bt(0|A,0|d,0|O),De(),A=A&~X|(d=0|Ot(0|gd(7&d),0,0|O)),d=0|ee|De(),y>>>0<S>>>0;)y=y+1|0;else for(y=1;O=0|bt(0|A,0|d,0|(ee=3*(15-y|0)|0)),De(),X=0|Ot(7,0,0|ee),d&=~(0|De()),A=A&~X|(ee=0|Ot(0|tf(7&O),0,0|ee)),d=0|d|De(),y>>>0<S>>>0;)y=y+1|0}}while(0);if((0|k)>0){y=0;do{A=0|Qw(A,d),d=0|De(),y=y+1|0}while((0|y)!=(0|k))}}else A=0,d=0}while(0);return ee=A,Mn(0|(X=d)),me=G,0|ee}(y,A),d=0|De()):(d=0,A=0),Mn(0|d),me=C,0|A}function Yw(d,A,y){var S,C=0,k=0,I=0;if(S=4+(y|=0)|0,k=0|bt(0|(d|=0),0|(A|=0),52),De(),k&=15,I=0|bt(0|d,0|A,45),De(),C=0==(0|k),0|gi(127&I)){if(C)return 1;C=1}else{if(C)return 0;C=0==(0|m[S>>2])&&0==(0|m[y+8>>2])?0!=(0|m[y+12>>2])&1:1}for(y=1;1&y?_v(S):ef(S),I=0|bt(0|d,0|A,3*(15-y|0)|0),De(),Dk(S,7&I),y>>>0<k>>>0;)y=y+1|0;return 0|C}function x0(d,A,y){y|=0;var G,ee,C=0,S=0,k=0,I=0,O=0,X=0;ee=me,me=me+16|0,G=ee,X=0|bt(0|(d|=0),0|(A|=0),45),De(),X&=127;e:do{if(0!=(0|gi(X))&&(k=0|bt(0|d,0|A,52),De(),k&=15,0!=(0|k))){C=1;t:for(;;){switch(O=0|bt(0|d,0|A,3*(15-C|0)|0),De(),7&O){case 5:break t;case 0:break;default:C=A;break e}if(!(C>>>0<k>>>0)){C=A;break e}C=C+1|0}for(S=1,C=A;I=0|Ot(7,0,0|(A=3*(15-S|0)|0)),O=C&~(0|De()),C=0|bt(0|d,0|C,0|A),De(),d=d&~I|(C=0|Ot(0|gd(7&C),0,0|A)),C=0|O|De(),S>>>0<k>>>0;)S=S+1|0}else C=A}while(0);if(m[y>>2]=m[(O=7728+(28*X|0)|0)>>2],m[y+4>>2]=m[O+4>>2],m[y+8>>2]=m[O+8>>2],m[y+12>>2]=m[O+12>>2],0|Yw(d,C,y)){if(m[G>>2]=m[(I=y+4|0)>>2],m[G+4>>2]=m[I+4>>2],m[G+8>>2]=m[I+8>>2],k=0|bt(0|d,0|C,52),De(),O=15&k,1&k?(ef(I),k=O+1|0):k=O,0|gi(X)){e:do{if(O)for(A=1;;){if(S=0|bt(0|d,0|C,3*(15-A|0)|0),De(),0|(S&=7)){C=S;break e}if(!(A>>>0<O>>>0)){C=0;break}A=A+1|0}else C=0}while(0);C=4==(0|C)&1}else C=0;if(0|em(y,k,C,0)){if(0|gi(X))do{}while(0!=(0|em(y,k,0,0)));(0|k)!=(0|O)&&qw(I)}else(0|k)!=(0|O)&&(m[I>>2]=m[G>>2],m[I+4>>2]=m[G+4>>2],m[I+8>>2]=m[G+8>>2]);me=ee}else me=ee}function nf(d,A,y){var C,S;y|=0,C=me,me=me+16|0,x0(d|=0,A|=0,S=C),A=0|bt(0|d,0|A,52),De(),function(d,A,y){var C,S;A|=0,y|=0,C=me,me=me+16|0,JA(4+(d|=0)|0,S=C),_0(S,0|m[d>>2],A,0,y),me=C}(S,15&A,y),me=C}function rf(d,A,y){y|=0;var k,I,C=0,S=0;I=me,me=me+16|0,x0(d|=0,A|=0,k=I),C=0|bt(0|d,0|A,45),De(),C=0==(0|gi(127&C)),S=0|bt(0|d,0|A,52),De(),S&=15;e:do{if(!C){if(0|S)for(C=1;;){if(!(0==((0|Ot(7,0,3*(15-C|0)|0))&d|0)&0==((0|De())&A|0)))break e;if(!(C>>>0<S>>>0))break;C=C+1|0}return kk(k,S,0,5,y),void(me=I)}}while(0);Rk(k,S,0,6,y),me=I}function Kw(d,A){A|=0;var O,y=0,C=0,S=0,k=0,I=0,G=0;if(Ot(0|(d|=0),0,52),O=134225919|De(),(0|d)<1){C=0,y=0;do{0|gi(C)&&(Ot(0|C,0,45),I=0|O|De(),m[(d=A+(y<<3)|0)>>2]=-1,m[d+4>>2]=I,y=y+1|0),C=C+1|0}while(122!=(0|C))}else{I=0,y=0;do{if(0|gi(I)){for(Ot(0|I,0,45),C=1,S=-1,k=0|O|De();S&=~(G=0|Ot(7,0,3*(15-C|0)|0)),k&=~(0|De()),(0|C)!=(0|d);)C=C+1|0;m[(G=A+(y<<3)|0)>>2]=S,m[G+4>>2]=k,y=y+1|0}I=I+1|0}while(122!=(0|I))}}function zk(d,A,y,C){var O,S=0,k=0,I=0,G=0,X=0;if(O=me,me=me+64|0,I=O,(0|(d|=0))==(0|(y|=0))&(0|(A|=0))==(0|(C|=0))|!1|134217728!=(2013265920&A|0)|!1|134217728!=(2013265920&C|0)||(S=0|bt(0|d,0|A,52),De(),S&=15,k=0|bt(0|y,0|C,52),De(),(0|S)!=(15&k|0)))return me=O,0;if(k=S+-1|0,S>>>0>1&&(X=0|Ww(d,A,k),G=0|De(),(0|X)==(0|(k=0|Ww(y,C,k)))&(0|G)==(0|De()))&&(S=0|bt(0|d,0|A,0|(k=3*(15^S)|0)),De(),S&=7,k=0|bt(0|y,0|C,0|k),De(),0==(0|S)|0==(0|(k&=7))||(0|m[21136+(S<<2)>>2])==(0|k)||(0|m[21168+(S<<2)>>2])==(0|k)))return me=O,1;k=(S=I)+56|0;do{m[S>>2]=0,S=S+4|0}while((0|S)<(0|k));return _k(d,A,1,I),S=(0|m[(X=I)>>2])==(0|y)&&(0|m[X+4>>2])==(0|C)||(0|m[(X=I+8|0)>>2])==(0|y)&&(0|m[X+4>>2])==(0|C)||(0|m[(X=I+16|0)>>2])==(0|y)&&(0|m[X+4>>2])==(0|C)||(0|m[(X=I+24|0)>>2])==(0|y)&&(0|m[X+4>>2])==(0|C)||(0|m[(X=I+32|0)>>2])==(0|y)&&(0|m[X+4>>2])==(0|C)||(0|m[(X=I+40|0)>>2])==(0|y)&&(0|m[X+4>>2])==(0|C)?1:1&((0|m[(S=I+48|0)>>2])==(0|y)?(0|m[S+4>>2])==(0|C):0),me=O,0|S}function vv(d,A,y){y|=0;var S,k,I,O,C=0;if(I=me,me=me+16|0,k=I,C=0|bt(0|(d|=0),0|(A|=0),56),De(),-1==(0|(A=0|function(d,A,y){y|=0;var C=0,S=0;return C=0|wo(d|=0,A|=0),(y+-1|0)>>>0>5||1==(0|y)&(S=0!=(0|C))?0|(y=-1):(C=0|function(d,A){var S,k,X,y=0,C=0,I=0,O=0,G=0;if(X=me,me=me+32|0,k=X,x0(d|=0,A|=0,S=X+16|0),I=0|Ok(d,A),G=0|Aa(d,A),function(d,A){m[(A|=0)>>2]=m[(d=7728+(28*(d|=0)|0)|0)>>2],m[A+4>>2]=m[d+4>>2],m[A+8>>2]=m[d+8>>2],m[A+12>>2]=m[d+12>>2]}(I,k),A=0|function(d,A){d|=0;var y=0,C=0;if((A|=0)>>>0>20)return-1;do{if((0|m[11152+(216*A|0)>>2])!=(0|d))if((0|m[11152+(216*A|0)+8>>2])!=(0|d))if((0|m[11152+(216*A|0)+16>>2])!=(0|d))if((0|m[11152+(216*A|0)+24>>2])!=(0|d))if((0|m[11152+(216*A|0)+32>>2])!=(0|d))if((0|m[11152+(216*A|0)+40>>2])!=(0|d))if((0|m[11152+(216*A|0)+48>>2])!=(0|d))if((0|m[11152+(216*A|0)+56>>2])!=(0|d))if((0|m[11152+(216*A|0)+64>>2])!=(0|d))if((0|m[11152+(216*A|0)+72>>2])!=(0|d))if((0|m[11152+(216*A|0)+80>>2])!=(0|d))if((0|m[11152+(216*A|0)+88>>2])!=(0|d))if((0|m[11152+(216*A|0)+96>>2])!=(0|d))if((0|m[11152+(216*A|0)+104>>2])!=(0|d))if((0|m[11152+(216*A|0)+112>>2])!=(0|d))if((0|m[11152+(216*A|0)+120>>2])!=(0|d))if((0|m[11152+(216*A|0)+128>>2])!=(0|d)){if((0|m[11152+(216*A|0)+136>>2])!=(0|d)){if((0|m[11152+(216*A|0)+144>>2])==(0|d)){d=0,y=2,C=0;break}if((0|m[11152+(216*A|0)+152>>2])==(0|d)){d=0,y=2,C=1;break}if((0|m[11152+(216*A|0)+160>>2])==(0|d)){d=0,y=2,C=2;break}if((0|m[11152+(216*A|0)+168>>2])==(0|d)){d=1,y=2,C=0;break}if((0|m[11152+(216*A|0)+176>>2])==(0|d)){d=1,y=2,C=1;break}if((0|m[11152+(216*A|0)+184>>2])==(0|d)){d=1,y=2,C=2;break}if((0|m[11152+(216*A|0)+192>>2])==(0|d)){d=2,y=2,C=0;break}if((0|m[11152+(216*A|0)+200>>2])==(0|d)){d=2,y=2,C=1;break}if((0|m[11152+(216*A|0)+208>>2])==(0|d)){d=2,y=2,C=2;break}return-1}d=2,y=1,C=2}else d=2,y=1,C=1;else d=2,y=1,C=0;else d=1,y=1,C=2;else d=1,y=1,C=1;else d=1,y=1,C=0;else d=0,y=1,C=2;else d=0,y=1,C=1;else d=0,y=1,C=0;else d=2,y=0,C=2;else d=2,y=0,C=1;else d=2,y=0,C=0;else d=1,y=0,C=2;else d=1,y=0,C=1;else d=1,y=0,C=0;else d=0,y=0,C=2;else d=0,y=0,C=1;else d=0,y=0,C=0}while(0);return 0|m[11152+(216*A|0)+(72*y|0)+(24*d|0)+(C<<3)+4>>2]}(I,0|m[S>>2]),!(0|gi(I)))return me=X,0|A;switch(0|I){case 4:d=0,y=14;break;case 14:d=1,y=14;break;case 24:d=2,y=14;break;case 38:d=3,y=14;break;case 49:d=4,y=14;break;case 58:d=5,y=14;break;case 63:d=6,y=14;break;case 72:d=7,y=14;break;case 83:d=8,y=14;break;case 97:d=9,y=14;break;case 107:d=10,y=14;break;case 117:d=11,y=14;break;default:O=0,C=0}return 14==(0|y)&&(O=0|m[22096+(24*d|0)+8>>2],C=0|m[22096+(24*d|0)+16>>2]),(0|(d=0|m[S>>2]))!=(0|m[k>>2])&&(I=0|Uw(I))|(0|(d=0|m[S>>2]))==(0|C)&&(A=(A+1|0)%6|0),3==(0|G)&(0|d)==(0|C)?(me=X,0|(G=(A+5|0)%6|0)):5==(0|G)&(0|d)==(0|O)?(me=X,0|(G=(A+1|0)%6|0)):(me=X,0|(G=A))}(d,A),S?0|(y=(5-C+(0|m[22384+(y<<2)>>2])|0)%5|0):0|(y=(6-C+(0|m[22416+(y<<2)>>2])|0)%6|0))}(S=(O=!0&268435456==(2013265920&A|0))?d:0,d=O?-2130706433&A|134217728:0,7&C))))return m[y>>2]=0,void(me=I);x0(S,d,k),C=0|bt(0|S,0|d,52),De(),C&=15,0|wo(S,d)?kk(k,C,A,2,y):Rk(k,C,A,2,y),me=I}function D7(d){d|=0;var A,y,C=0;return(A=0|ic(1,12))||Rr(22691,22646,49,22704),0|(C=0|m[(y=d+4|0)>>2])?(m[(C=C+8|0)>>2]=A,m[y>>2]=A,0|A):(0|m[d>>2]&&Rr(22721,22646,61,22744),m[(C=d)>>2]=A,m[y>>2]=A,0|A)}function S7(d,A){var y,C;return d|=0,A|=0,(C=0|lu(24))||Rr(22758,22646,78,22772),m[C>>2]=m[A>>2],m[C+4>>2]=m[A+4>>2],m[C+8>>2]=m[A+8>>2],m[C+12>>2]=m[A+12>>2],m[C+16>>2]=0,0|(y=0|m[(A=d+4|0)>>2])?(m[y+16>>2]=C,m[A>>2]=C,0|C):(0|m[d>>2]&&Rr(22787,22646,82,22772),m[d>>2]=C,m[A>>2]=C,0|C)}function Vk(d){var yr,ri,A=0,y=0,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,Lt=0,qe=0,gt=0,Ie=0,Nt=0,zt=0,kt=0,Ft=0,In=0,Fr=0,br=0,Hr=0,ii=0,yn=0;if(0|m[(S=8+(d|=0)|0)>>2])return 1;if(!(C=0|m[d>>2]))return 0;A=C,y=0;do{y=y+1|0,A=0|m[A+8>>2]}while(0!=(0|A));if(y>>>0<2)return 0;(ri=0|lu(y<<2))||Rr(22807,22646,317,22826),(yr=0|lu(y<<5))||Rr(22848,22646,321,22826),m[d>>2]=0,m[(zt=d+4|0)>>2]=0,m[S>>2]=0,y=0,Hr=0,Nt=0,ye=0;e:for(;;){if(ee=0|m[C>>2]){k=0,I=ee;do{if(A=I,+nr(+((G=+pe[I+8>>3])-(O=+pe[(S=(X=0==(0|(I=0|m[I+16>>2])))?ee:I)+8>>3])))>3.141592653589793){yn=14;break}k+=(O-G)*(+pe[A>>3]+ +pe[S>>3])}while(!X);if(14==(0|yn)){yn=0,k=0,A=ee;do{k+=(+pe[A>>3]+ +pe[(Fr=0==(0|(Fr=0|m[(br=A+16|0)>>2]))?ee:Fr)>>3])*(((gt=+pe[Fr+8>>3])<0?gt+6.283185307179586:gt)-((Ie=+pe[A+8>>3])<0?Ie+6.283185307179586:Ie)),A=0|m[(0==(0|A)?C:br)>>2]}while(0!=(0|A))}k>0?(m[ri+(Hr<<2)>>2]=C,Hr=Hr+1|0,S=Nt,A=ye):yn=19}else yn=19;if(19==(0|yn)){yn=0;do{if(!y){if(ye){S=zt,I=ye+8|0,A=C,y=d;break}if(0|m[d>>2]){yn=27;break e}S=zt,I=d,A=C,y=d;break}if(0|m[(A=y+8|0)>>2]){yn=21;break e}if(!(y=0|ic(1,12))){yn=23;break e}m[A>>2]=y,S=y+4|0,I=y,A=ye}while(0);if(m[I>>2]=C,m[S>>2]=C,I=yr+(Nt<<5)|0,X=0|m[C>>2]){for(pe[(ee=yr+(Nt<<5)+8|0)>>3]=17976931348623157e292,pe[(ye=yr+(Nt<<5)+24|0)>>3]=17976931348623157e292,pe[I>>3]=-17976931348623157e292,pe[(Te=yr+(Nt<<5)+16|0)>>3]=-17976931348623157e292,Lt=17976931348623157e292,qe=-17976931348623157e292,S=0,ze=X,G=17976931348623157e292,Ke=17976931348623157e292,Ct=-17976931348623157e292,O=-17976931348623157e292;k=+pe[ze>>3],Ie=+pe[ze+8>>3],gt=+pe[((Qe=0==(0|(ze=0|m[ze+16>>2])))?X:ze)+8>>3],k<G&&(pe[ee>>3]=k,G=k),Ie<Ke&&(pe[ye>>3]=Ie,Ke=Ie),k>Ct?pe[I>>3]=k:k=Ct,Ie>O&&(pe[Te>>3]=Ie,O=Ie),Lt=Ie>0&Ie<Lt?Ie:Lt,qe=Ie<0&Ie>qe?Ie:qe,S|=+nr(+(Ie-gt))>3.141592653589793,!Qe;)Ct=k;S&&(pe[Te>>3]=qe,pe[ye>>3]=Lt)}else m[I>>2]=0,m[I+4>>2]=0,m[I+8>>2]=0,m[I+12>>2]=0,m[I+16>>2]=0,m[I+20>>2]=0,m[I+24>>2]=0,m[I+28>>2]=0;S=Nt+1|0}if(C=0|m[(br=C+8|0)>>2],m[br>>2]=0,!C){yn=45;break}Nt=S,ye=A}if(21==(0|yn))Rr(22624,22646,35,22658);else if(23==(0|yn))Rr(22678,22646,37,22658);else if(27==(0|yn))Rr(22721,22646,61,22744);else if(45==(0|yn)){e:do{if((0|Hr)>0){for(br=0==(0|S),In=S<<2,Fr=0==(0|d),Ft=0,A=0;;){if(kt=0|m[ri+(Ft<<2)>>2],br)yn=73;else{if(!(Nt=0|lu(In))){yn=50;break}if(!(zt=0|lu(In))){yn=52;break}t:do{if(Fr)y=0;else{for(S=0,y=0,I=d;0|Uk(0|m[I>>2],C=yr+(S<<5)|0,0|m[kt>>2])?(m[Nt+(y<<2)>>2]=I,m[zt+(y<<2)>>2]=C,Qe=y+1|0):Qe=y,I=0|m[I+8>>2];)S=S+1|0,y=Qe;if((0|Qe)>0)if(C=0|m[Nt>>2],1==(0|Qe))y=C;else for(Te=0,ze=-1,y=C,ye=C;;){for(X=0|m[ye>>2],C=0,I=0;ee=(0|(S=0|m[m[Nt+(I<<2)>>2]>>2]))==(0|X)?C:C+(1&(0|Uk(S,0|m[zt+(I<<2)>>2],0|m[X>>2])))|0,(0|(I=I+1|0))!=(0|Qe);)C=ee;if(y=(S=(0|ee)>(0|ze))?ye:y,(0|(C=Te+1|0))==(0|Qe))break t;Te=C,ze=S?ee:ze,ye=0|m[Nt+(C<<2)>>2]}else y=0}}while(0);if(Ln(Nt),Ln(zt),y){if(C=0|m[(S=y+4|0)>>2])y=C+8|0;else if(0|m[y>>2]){yn=70;break}m[y>>2]=kt,m[S>>2]=kt}else yn=73}if(73==(0|yn)){if(yn=0,0|(A=0|m[kt>>2]))do{zt=A,A=0|m[A+16>>2],Ln(zt)}while(0!=(0|A));Ln(kt),A=2}if((0|(Ft=Ft+1|0))>=(0|Hr)){ii=A;break e}}50==(0|yn)?Rr(22863,22646,249,22882):52==(0|yn)?Rr(22901,22646,252,22882):70==(0|yn)&&Rr(22721,22646,61,22744)}else ii=0}while(0);return Ln(ri),Ln(yr),0|ii}return 0}function Uk(d,A,y){d|=0;var C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0;if(!(0|wk(A|=0,y|=0)&&(A=0|bk(A),X=+pe[y>>3],C=+pe[y+8>>3],C=A&C<0?C+6.283185307179586:C,d=0|m[d>>2],d)))return 0;if(A){A=0,y=d;e:for(;;){for(;I=+pe[y>>3],G=+pe[y+8>>3],S=+pe[(ee=0==(0|(ee=0|m[(y=y+16|0)>>2]))?d:ee)+8>>3],I>(k=+pe[ee>>3])?(O=I,I=G):(O=k,k=I,I=S,S=G),X<k|X>O;)if(!(y=0|m[y>>2])){y=22;break e}if(C=(I=I<0?I+6.283185307179586:I)==C|(G=S<0?S+6.283185307179586:S)==C?C+-2220446049250313e-31:C,((G+=(X-k)/(O-k)*(I-G))<0?G+6.283185307179586:G)>C&&(A^=1),!(y=0|m[y>>2])){y=22;break}}if(22==(0|y))return 0|A}else{A=0,y=d;e:for(;;){for(;I=+pe[y>>3],G=+pe[y+8>>3],S=+pe[(ee=0==(0|(ee=0|m[(y=y+16|0)>>2]))?d:ee)+8>>3],I>(k=+pe[ee>>3])?(O=I,I=G):(O=k,k=I,I=S,S=G),X<k|X>O;)if(!(y=0|m[y>>2])){y=22;break e}if(S+(X-k)/(O-k)*(I-S)>(C=I==C|S==C?C+-2220446049250313e-31:C)&&(A^=1),!(y=0|m[y>>2])){y=22;break}}if(22==(0|y))return 0|A}return 0}function _h(d,A,y,C,S){y|=0,C|=0,S|=0;var ye,Te,Ct,qe,k=0,I=0,O=0,G=0,X=0,ee=0,ze=0,Qe=0,Ke=0,Lt=0;if(qe=me,me=me+32|0,Lt=qe+16|0,Ct=qe,k=0|bt(0|(d|=0),0|(A|=0),52),De(),k&=15,ze=0|bt(0|y,0|C,52),De(),(0|k)!=(15&ze|0))return me=qe,1;if(X=0|bt(0|d,0|A,45),De(),X&=127,ee=0|bt(0|y,0|C,45),De(),ze=(0|X)!=(0|(ee&=127))){if(7==(0|(O=0|Gw(X,ee))))return me=qe,2;7==(0|(G=0|Gw(ee,X)))?Rr(22925,22949,151,22959):(Qe=O,I=G)}else Qe=0,I=0;ye=0|gi(X),Te=0|gi(ee),m[Lt>>2]=0,m[Lt+4>>2]=0,m[Lt+8>>2]=0,m[Lt+12>>2]=0;do{if(Qe){if(O=(0|(ee=0|m[4304+(28*X|0)+(Qe<<2)>>2]))>0,Te)if(O){X=0,G=y,O=C;do{G=0|m7(G,O),O=0|De(),1==(0|(I=0|gd(I)))&&(I=0|gd(1)),X=X+1|0}while((0|X)!=(0|ee));ee=I,X=G,G=O}else ee=I,X=y,G=C;else if(O){X=0,G=y,O=C;do{G=0|Xw(G,O),O=0|De(),I=0|gd(I),X=X+1|0}while((0|X)!=(0|ee));ee=I,X=G,G=O}else ee=I,X=y,G=C;if(Yw(X,G,Lt),ze||Rr(22972,22949,181,22959),(O=0!=(0|ye))&(I=0!=(0|Te))&&Rr(22999,22949,182,22959),O){if(I=0|Aa(d,A),0|rn[22032+(7*I|0)+Qe>>0]){k=3;break}X=G=0|m[21200+(28*I|0)+(Qe<<2)>>2],Ke=26}else if(I){if(I=0|Aa(X,G),0|rn[22032+(7*I|0)+ee>>0]){k=4;break}X=0,G=0|m[21200+(28*ee|0)+(I<<2)>>2],Ke=26}else I=0;if(26==(0|Ke))if((0|G)<=-1&&Rr(23030,22949,212,22959),(0|X)<=-1&&Rr(23053,22949,213,22959),(0|G)>0){O=Lt+4|0,I=0;do{yv(O),I=I+1|0}while((0|I)!=(0|G));I=X}else I=X;if(m[Ct>>2]=0,m[Ct+4>>2]=0,m[Ct+8>>2]=0,Dk(Ct,Qe),0|k)for(;0|_l(k)?_v(Ct):ef(Ct),(0|k)>1;)k=k+-1|0;if((0|I)>0){k=0;do{yv(Ct),k=k+1|0}while((0|k)!=(0|I))}Us(Ke=Lt+4|0,Ct,Ke),fs(Ke),Ke=50}else if(Yw(y,C,Lt),0!=(0|ye)&0!=(0|Te))if((0|ee)!=(0|X)&&Rr(23077,22949,243,22959),I=0|Aa(d,A),k=0|Aa(y,C),0|rn[22032+(7*I|0)+k>>0])k=5;else if((0|(I=0|m[21200+(28*I|0)+(k<<2)>>2]))>0){O=Lt+4|0,k=0;do{yv(O),k=k+1|0}while((0|k)!=(0|I));Ke=50}else Ke=50;else Ke=50}while(0);return 50==(0|Ke)&&(m[S>>2]=m[(k=Lt+4|0)>>2],m[S+4>>2]=m[k+4>>2],m[S+8>>2]=m[k+8>>2],k=0),me=qe,0|k}function jk(d,A,y,C){y|=0,C|=0;var ee,Qe,S=0,k=0,I=0,O=0,G=0,X=0,ye=0,Te=0,ze=0,Ke=0,Ct=0,Lt=0,qe=0;if(Qe=me,me=me+48|0,I=Qe+36|0,O=Qe+24|0,G=Qe+12|0,X=Qe,k=0|bt(0|(d|=0),0|(A|=0),52),De(),k&=15,Te=0|bt(0|d,0|A,45),De(),ee=0|gi(Te&=127),Ot(0|k,0,52),Ct=134225919|De(),m[(Ke=C)>>2]=-1,m[Ke+4>>2]=Ct,!k)return(0|m[y>>2])>1||(0|m[y+4>>2])>1||(0|m[y+8>>2])>1||127==(0|(S=0|jw(Te,0|gv(y))))?(me=Qe,0|(Ct=1)):(ze=0|Ot(0|S,0,45),Ke=0|De(),Ke|=-1040385&m[(Te=C)+4>>2],m[(Ct=C)>>2]=m[Te>>2]|ze,m[Ct+4>>2]=Ke,me=Qe,0|(Ct=0));for(m[I>>2]=m[y>>2],m[I+4>>2]=m[y+4>>2],m[I+8>>2]=m[y+8>>2];m[O>>2]=m[I>>2],m[O+4>>2]=m[I+4>>2],m[O+8>>2]=m[I+8>>2],0|_l(k)?(Ek(I),m[G>>2]=m[I>>2],m[G+4>>2]=m[I+4>>2],m[G+8>>2]=m[I+8>>2],_v(G)):(qw(I),m[G>>2]=m[I>>2],m[G+4>>2]=m[I+4>>2],m[G+8>>2]=m[I+8>>2],ef(G)),Hw(O,G,X),fs(X),Lt=0|m[(Ke=C)>>2],Ke=0|m[Ke+4>>2],y=0|Ot(7,0,0|(qe=3*(15-k|0)|0)),Ke&=~(0|De()),qe=0|Ot(0|gv(X),0,0|qe),Ke=0|De()|Ke,m[(Ct=C)>>2]=qe|Lt&~y,m[Ct+4>>2]=Ke,(0|k)>1;)k=k+-1|0;e:do{if((0|m[I>>2])<=1&&(0|m[I+4>>2])<=1&&(0|m[I+8>>2])<=1){X=127==(0|(O=0|jw(Te,k=0|gv(I))))?0:0|gi(O);t:do{if(k){if(ee){if(I=21408+(28*(0|Aa(d,A))|0)+(k<<2)|0,(0|(I=0|m[I>>2]))>0){y=0;do{k=0|tf(k),y=y+1|0}while((0|y)!=(0|I))}if(1==(0|k)){S=3;break e}127==(0|(y=0|jw(Te,k)))&&Rr(23104,22949,376,23134),0|gi(y)?Rr(23147,22949,377,23134):(ze=I,ye=k,S=y)}else ze=0,ye=k,S=O;if((0|(G=0|m[4304+(28*Te|0)+(ye<<2)>>2]))<=-1&&Rr(23178,22949,384,23134),!X){if((0|ze)<=-1&&Rr(23030,22949,417,23134),0|ze){k=0,y=0|m[(I=C)>>2],I=0|m[I+4>>2];do{y=0|_d(y,I),I=0|De(),m[(qe=C)>>2]=y,m[qe+4>>2]=I,k=k+1|0}while((0|k)<(0|ze))}if((0|G)<=0){k=54;break}for(k=0,y=0|m[(I=C)>>2],I=0|m[I+4>>2];;)if(y=0|_d(y,I),I=0|De(),m[(qe=C)>>2]=y,m[qe+4>>2]=I,(0|(k=k+1|0))==(0|G)){k=54;break t}}if(7==(0|(O=0|Gw(S,Te)))&&Rr(22925,22949,393,23134),y=0|m[(k=C)>>2],k=0|m[k+4>>2],(0|G)>0){I=0;do{y=0|_d(y,k),k=0|De(),m[(qe=C)>>2]=y,m[qe+4>>2]=k,I=I+1|0}while((0|I)!=(0|G))}if(y=0|Aa(y,k),qe=0|Uw(S),(0|(y=0|m[(qe?21824:21616)+(28*O|0)+(y<<2)>>2]))<=-1&&Rr(23030,22949,412,23134),y){k=0,I=0|m[(O=C)>>2],O=0|m[O+4>>2];do{I=0|Qw(I,O),O=0|De(),m[(qe=C)>>2]=I,m[qe+4>>2]=O,k=k+1|0}while((0|k)<(0|y));k=54}else k=54}else if(0!=(0|ee)&0!=(0|X))if(qe=0|Aa(d,A),k=C,k=21408+(28*qe|0)+((0|Aa(0|m[k>>2],0|m[k+4>>2]))<<2)|0,k=0|m[k>>2],(0|k)<=-1&&Rr(23201,22949,433,23134),k){S=0,y=0|m[(I=C)>>2],I=0|m[I+4>>2];do{y=0|_d(y,I),I=0|De(),m[(qe=C)>>2]=y,m[qe+4>>2]=I,S=S+1|0}while((0|S)<(0|k));S=O,k=54}else S=O,k=55;else S=O,k=54}while(0);if(54==(0|k)&&X&&(k=55),55==(0|k)&&1==(0|Aa(0|m[(qe=C)>>2],0|m[qe+4>>2]))){S=4;break}Ct=0|m[(qe=C)>>2],qe=-1040385&m[qe+4>>2],Lt=0|Ot(0|S,0,45),qe=0|qe|De(),m[(S=C)>>2]=Ct|Lt,m[S+4>>2]=qe,S=0}else S=2}while(0);return me=Qe,0|S}function xv(d,A){var y=0;if(!(A|=0))return 1;y=d|=0,d=1;do{d=0|gh(0==(1&A|0)?1:y,d),A>>=1,y=0|gh(y,y)}while(0!=(0|A));return 0|d}function Gk(d,A,y){d|=0;var ee,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ye=0,Te=0;if(!(0|wk(A|=0,y|=0))||(A=0|bk(A),Te=+pe[y>>3],C=A&(C=+pe[y+8>>3])<0?C+6.283185307179586:C,(0|(ye=0|m[d>>2]))<=0))return 0;if(ee=0|m[d+4>>2],A){A=0,y=-1,d=0;e:for(;;){for(X=d;G=+pe[ee+(X<<4)+8>>3],S=+pe[ee+((d=(y+2|0)%(0|ye)|0)<<4)+8>>3],(I=+pe[ee+(X<<4)>>3])>(k=+pe[ee+(d<<4)>>3])?(O=I,I=G):(O=k,k=I,I=S,S=G),Te<k|Te>O;){if(!((0|(y=X+1|0))<(0|ye))){y=22;break e}d=X,X=y,y=d}if(C=(I=I<0?I+6.283185307179586:I)==C|(G=S<0?S+6.283185307179586:S)==C?C+-2220446049250313e-31:C,((G+=(Te-k)/(O-k)*(I-G))<0?G+6.283185307179586:G)>C&&(A^=1),(0|(d=X+1|0))>=(0|ye)){y=22;break}y=X}if(22==(0|y))return 0|A}else{A=0,y=-1,d=0;e:for(;;){for(X=d;G=+pe[ee+(X<<4)+8>>3],S=+pe[ee+((d=(y+2|0)%(0|ye)|0)<<4)+8>>3],(I=+pe[ee+(X<<4)>>3])>(k=+pe[ee+(d<<4)>>3])?(O=I,I=G):(O=k,k=I,I=S,S=G),Te<k|Te>O;){if(!((0|(y=X+1|0))<(0|ye))){y=22;break e}d=X,X=y,y=d}if(S+(Te-k)/(O-k)*(I-S)>(C=I==C|S==C?C+-2220446049250313e-31:C)&&(A^=1),(0|(d=X+1|0))>=(0|ye)){y=22;break}y=X}if(22==(0|y))return 0|A}return 0}function Jw(d,A){A|=0;var Qe,Ke,Ct,Lt,y=0,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,qe=0;if(!(Qe=0|m[(d|=0)>>2]))return m[A>>2]=0,m[A+4>>2]=0,m[A+8>>2]=0,m[A+12>>2]=0,m[A+16>>2]=0,m[A+20>>2]=0,m[A+24>>2]=0,void(m[A+28>>2]=0);if(pe[(Ke=A+8|0)>>3]=17976931348623157e292,pe[(Ct=A+24|0)>>3]=17976931348623157e292,pe[A>>3]=-17976931348623157e292,pe[(Lt=A+16|0)>>3]=-17976931348623157e292,!((0|Qe)<=0)){for(Te=0|m[d+4>>2],X=17976931348623157e292,ee=-17976931348623157e292,ye=0,d=-1,k=17976931348623157e292,I=17976931348623157e292,G=-17976931348623157e292,C=-17976931348623157e292,ze=0;O=+pe[Te+(ze<<4)+8>>3],S=+pe[Te+(((0|(d=d+2|0))==(0|Qe)?0:d)<<4)+8>>3],(y=+pe[Te+(ze<<4)>>3])<k&&(pe[Ke>>3]=y,k=y),O<I&&(pe[Ct>>3]=O,I=O),y>G?pe[A>>3]=y:y=G,O>C&&(pe[Lt>>3]=O,C=O),X=O>0&O<X?O:X,ee=O<0&O>ee?O:ee,ye|=+nr(+(O-S))>3.141592653589793,(0|(d=ze+1|0))!=(0|Qe);)qe=ze,G=y,ze=d,d=qe;!ye||(pe[Lt>>3]=ee,pe[Ct>>3]=X)}}function O7(d,A,y){var C=0,S=0;if(!(0|Gk(d|=0,A|=0,y|=0)))return 0;if((0|m[(S=d+8|0)>>2])<=0)return 1;for(C=d+12|0,d=0;;){if(0|Gk((0|m[C>>2])+(d<<3)|0,A+((d=d+1|0)<<5)|0,y)){d=0,C=6;break}if((0|d)>=(0|m[S>>2])){d=1,C=6;break}}return 6==(0|C)?0|d:0}function $k(d,A,y,C,S){var I,O,G,X,ee,ye,Te,k=0;pe[(S|=0)>>3]=(X=+pe[(d|=0)>>3])+(G=+pe[(A|=0)>>3]-X)*(k=((k=+pe[(C|=0)>>3]-(ye=+pe[(y|=0)>>3]))*((O=+pe[d+8>>3])-(Te=+pe[y+8>>3]))-(X-ye)*(ee=+pe[C+8>>3]-Te))/(G*ee-(I=+pe[A+8>>3]-O)*k)),pe[S+8>>3]=O+I*k}function Hk(d,A){return+pe[(d|=0)>>3]!=+pe[(A|=0)>>3]?0|(A=0):0|(A=+pe[d+8>>3]==+pe[A+8>>3])}function Ao(d,A){var y,C,S;return+((S=+pe[(d|=0)>>3]-+pe[(A|=0)>>3])*S+(C=+pe[d+8>>3]-+pe[A+8>>3])*C+(y=+pe[d+16>>3]-+pe[A+16>>3])*y)}function qk(d,A,y){d|=0,y|=0;var C=0;(0|(A|=0))>0?(C=0|ic(A,4),m[d>>2]=C,C||Rr(23230,23253,40,23267)):m[d>>2]=0,m[d+4>>2]=A,m[d+8>>2]=0,m[d+12>>2]=y}function Zk(d){var S,k,I,A=0,y=0,C=0,O=0;S=4+(d|=0)|0,k=d+12|0,I=d+8|0;e:for(;;){for(y=0|m[S>>2],A=0;;){if((0|A)>=(0|y))break e;if(O=0|m[(C=0|m[d>>2])+(A<<2)>>2])break;A=A+1|0}A=C+(~~(+nr(+ +mh(10,+ +(15-(0|m[k>>2])|0))*(+pe[O>>3]+ +pe[O+8>>3]))%+(0|y))>>>0<<2)|0,y=0|m[A>>2];t:do{if(0|y){if(C=O+32|0,(0|y)==(0|O))m[A>>2]=m[C>>2];else{if(!(A=0|m[(y=y+32|0)>>2]))break;for(;(0|A)!=(0|O);)if(!(A=0|m[(y=A+32|0)>>2]))break t;m[y>>2]=m[C>>2]}Ln(O),m[I>>2]=(0|m[I>>2])-1}}while(0)}Ln(0|m[d>>2])}function Wk(d){var C,A=0,y=0;for(C=0|m[4+(d|=0)>>2],y=0;;){if((0|y)>=(0|C)){A=0,y=4;break}if(A=0|m[(0|m[d>>2])+(y<<2)>>2]){y=4;break}y=y+1|0}return 4==(0|y)?0|A:0}function Qk(d,A){A|=0;var y=0,C=0,S=0,k=0;if(y=~~(+nr(+ +mh(10,+ +(15-(0|m[12+(d|=0)>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|m[d+4>>2]))>>>0,!(C=0|m[(y=(0|m[d>>2])+(y<<2)|0)>>2]))return 1;k=A+32|0;do{if((0|C)!=(0|A)){if(!(y=0|m[C+32>>2]))return 1;for(S=y;;){if((0|S)==(0|A)){S=8;break}if(!(y=0|m[S+32>>2])){y=1,S=10;break}C=S,S=y}if(8==(0|S)){m[C+32>>2]=m[k>>2];break}if(10==(0|S))return 0|y}else m[y>>2]=m[k>>2]}while(0);return Ln(A),m[(k=d+8|0)>>2]=(0|m[k>>2])-1,0}function Z7(d,A,y){d|=0,A|=0,y|=0;var k,C=0,S=0,I=0;(k=0|lu(40))||Rr(23283,23253,98,23296),m[k>>2]=m[A>>2],m[k+4>>2]=m[A+4>>2],m[k+8>>2]=m[A+8>>2],m[k+12>>2]=m[A+12>>2],m[(S=k+16|0)>>2]=m[y>>2],m[S+4>>2]=m[y+4>>2],m[S+8>>2]=m[y+8>>2],m[S+12>>2]=m[y+12>>2],m[k+32>>2]=0,S=~~(+nr(+ +mh(10,+ +(15-(0|m[d+12>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|m[d+4>>2]))>>>0,C=0|m[(S=(0|m[d>>2])+(S<<2)|0)>>2];do{if(C){for(;!(0|tm(C,A)&&0|tm(C+16|0,y));)if(!(0|m[(C=0==(0|(S=0|m[C+32>>2]))?C:S)+32>>2])){I=10;break}if(10==(0|I)){m[C+32>>2]=k;break}return Ln(k),0|C}m[S>>2]=k}while(0);return m[(I=d+8|0)>>2]=1+(0|m[I>>2]),0|k}function W7(d,A,y){A|=0,y|=0;var C=0,S=0;if(S=~~(+nr(+ +mh(10,+ +(15-(0|m[12+(d|=0)>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|m[d+4>>2]))>>>0,!(S=0|m[(0|m[d>>2])+(S<<2)>>2]))return 0;if(!y){for(d=S;;){if(0|tm(d,A)){C=10;break}if(!(d=0|m[d+32>>2])){d=0,C=10;break}}if(10==(0|C))return 0|d}for(d=S;;){if(0|tm(d,A)&&0|tm(d+16|0,y)){C=10;break}if(!(d=0|m[d+32>>2])){d=0,C=10;break}}return 10==(0|C)?0|d:0}function Q7(d,A){A|=0;var y=0;if(y=~~(+nr(+ +mh(10,+ +(15-(0|m[12+(d|=0)>>2])|0))*(+pe[A>>3]+ +pe[A+8>>3]))%+(0|m[d+4>>2]))>>>0,!(d=0|m[(0|m[d>>2])+(y<<2)>>2]))return 0;for(;;){if(0|tm(d,A)){A=5;break}if(!(d=0|m[d+32>>2])){d=0,A=5;break}}return 5==(0|A)?0|d:0}function bv(d){return 0|~~+function(d){return+ +Kk(+(d=+d))}(d=+d)}function lu(d){d|=0;var Nt,A=0,y=0,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,Lt=0,qe=0,gt=0,Ie=0;Nt=me,me=me+16|0,Te=Nt;do{if(d>>>0<245){if(3&(y=(ye=0|m[5829])>>>(d=(X=d>>>0<11?16:d+11&-8)>>>3))|0)return(0|(k=0|m[(S=8+(C=0|m[(y=8+(d=23356+((A=(1&y^1)+d|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|d)?m[5829]=ye&~(1<<A):(m[k+12>>2]=d,m[y>>2]=k),m[C+4>>2]=3|(Ie=A<<3),m[(Ie=C+Ie+4|0)>>2]=1|m[Ie>>2],me=Nt,0|S;if(X>>>0>(ee=0|m[5831])>>>0){if(0|y)return A=((A=y<<d&((A=2<<d)|0-A))&0-A)-1|0,(0|(y=0|m[(O=8+(k=0|m[(d=8+(A=23356+((C=((y=(A>>>=O=A>>>12&16)>>>5&8)|O|(k=(A>>>=y)>>>2&4)|(d=(A>>>=k)>>>1&2)|(C=(A>>>=d)>>>1&1))+(A>>>C)|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|A)?m[5829]=d=ye&~(1<<C):(m[y+12>>2]=A,m[d>>2]=y,d=ye),I=(Ie=C<<3)-X|0,m[k+4>>2]=3|X,m[4+(S=k+X|0)>>2]=1|I,m[k+Ie>>2]=I,0|ee&&(C=0|m[5834],y=23356+((A=ee>>>3)<<1<<2)|0,d&(A=1<<A)?A=0|m[(d=y+8|0)>>2]:(m[5829]=d|A,A=y,d=y+8|0),m[d>>2]=C,m[A+12>>2]=C,m[C+8>>2]=A,m[C+12>>2]=y),m[5831]=I,m[5834]=S,me=Nt,0|O;if(k=0|m[5830]){for(y=(k&0-k)-1|0,y=G=0|m[23620+(((C=(y>>>=S=y>>>12&16)>>>5&8)|S|(I=(y>>>=C)>>>2&4)|(O=(y>>>=I)>>>1&2)|(G=(y>>>=O)>>>1&1))+(y>>>G)<<2)>>2],O=G,G=(-8&m[G+4>>2])-X|0;(d=0|m[y+16>>2])||(d=0|m[y+20>>2]);)y=d,O=(S=(I=(-8&m[d+4>>2])-X|0)>>>0<G>>>0)?d:O,G=S?I:G;if((I=O+X|0)>>>0>O>>>0){S=0|m[O+24>>2],A=0|m[O+12>>2];do{if((0|A)==(0|O)){if(!(A=0|m[(d=O+20|0)>>2])&&!(A=0|m[(d=O+16|0)>>2])){y=0;break}for(;;)if(y=0|m[(C=A+20|0)>>2])A=y,d=C;else{if(!(y=0|m[(C=A+16|0)>>2]))break;A=y,d=C}m[d>>2]=0,y=A}else m[12+(y=0|m[O+8>>2])>>2]=A,m[A+8>>2]=y,y=A}while(0);do{if(0|S){if((0|O)==(0|m[(d=23620+((A=0|m[O+28>>2])<<2)|0)>>2])){if(m[d>>2]=y,!y){m[5830]=k&~(1<<A);break}}else if(m[((0|m[(Ie=S+16|0)>>2])==(0|O)?Ie:S+20|0)>>2]=y,!y)break;m[y+24>>2]=S,0|(A=0|m[O+16>>2])&&(m[y+16>>2]=A,m[A+24>>2]=y),0|(A=0|m[O+20>>2])&&(m[y+20>>2]=A,m[A+24>>2]=y)}}while(0);return G>>>0<16?(m[O+4>>2]=3|(Ie=G+X|0),m[(Ie=O+Ie+4|0)>>2]=1|m[Ie>>2]):(m[O+4>>2]=3|X,m[I+4>>2]=1|G,m[I+G>>2]=G,0|ee&&(C=0|m[5834],y=23356+((A=ee>>>3)<<1<<2)|0,(A=1<<A)&ye?A=0|m[(d=y+8|0)>>2]:(m[5829]=A|ye,A=y,d=y+8|0),m[d>>2]=C,m[A+12>>2]=C,m[C+8>>2]=A,m[C+12>>2]=y),m[5831]=G,m[5834]=I),me=Nt,0|O+8}ye=X}else ye=X}else ye=X}else if(d>>>0<=4294967231)if(X=-8&(d=d+11|0),C=0|m[5830]){S=0-X|0,G=(d>>>=8)?X>>>0>16777215?31:X>>>(7+(G=14-((O=(520192+(Ke=d<<(ye=(d+1048320|0)>>>16&8))|0)>>>16&4)|ye|(G=(245760+(Ke<<=O)|0)>>>16&2))+(Ke<<G>>>15)|0)|0)&1|G<<1:0,y=0|m[23620+(G<<2)>>2];e:do{if(y)for(d=0,O=X<<(31==(0|G)?0:25-(G>>>1)|0),k=0;;){if((I=(-8&m[y+4>>2])-X|0)>>>0<S>>>0){if(!I){d=y,S=0,Ke=65;break e}d=y,S=I}if(k=0==(0|(Ke=0|m[y+20>>2]))|(0|Ke)==(0|(y=0|m[y+16+(O>>>31<<2)>>2]))?k:Ke,!y){y=k,Ke=61;break}O<<=1}else y=0,d=0,Ke=61}while(0);if(61==(0|Ke)){if(0==(0|y)&0==(0|d)){if(!(d=((d=2<<G)|0-d)&C)){ye=X;break}ye=(d&0-d)-1|0,d=0,y=0|m[23620+(((k=(ye>>>=I=ye>>>12&16)>>>5&8)|I|(O=(ye>>>=k)>>>2&4)|(G=(ye>>>=O)>>>1&2)|(y=(ye>>>=G)>>>1&1))+(ye>>>y)<<2)>>2]}y?Ke=65:(O=d,I=S)}if(65==(0|Ke))for(k=y;;){if(S=(y=(ye=(-8&m[k+4>>2])-X|0)>>>0<S>>>0)?ye:S,d=y?k:d,(y=0|m[k+16>>2])||(y=0|m[k+20>>2]),!y){O=d,I=S;break}k=y}if(0!=(0|O)&&I>>>0<((0|m[5831])-X|0)>>>0&&(ee=O+X|0)>>>0>O>>>0){k=0|m[O+24>>2],A=0|m[O+12>>2];do{if((0|A)==(0|O)){if(!(A=0|m[(d=O+20|0)>>2])&&!(A=0|m[(d=O+16|0)>>2])){A=0;break}for(;;)if(y=0|m[(S=A+20|0)>>2])A=y,d=S;else{if(!(y=0|m[(S=A+16|0)>>2]))break;A=y,d=S}m[d>>2]=0}else m[12+(Ie=0|m[O+8>>2])>>2]=A,m[A+8>>2]=Ie}while(0);do{if(k){if((0|O)==(0|m[(y=23620+((d=0|m[O+28>>2])<<2)|0)>>2])){if(m[y>>2]=A,!A){m[5830]=C&=~(1<<d);break}}else if(m[((0|m[(Ie=k+16|0)>>2])==(0|O)?Ie:k+20|0)>>2]=A,!A)break;m[A+24>>2]=k,0|(d=0|m[O+16>>2])&&(m[A+16>>2]=d,m[d+24>>2]=A),(d=0|m[O+20>>2])&&(m[A+20>>2]=d,m[d+24>>2]=A)}}while(0);e:do{if(I>>>0<16)Ie=I+X|0,m[O+4>>2]=3|Ie,Ie=O+Ie+4|0,m[Ie>>2]=1|m[Ie>>2];else{if(m[O+4>>2]=3|X,m[ee+4>>2]=1|I,m[ee+I>>2]=I,A=I>>>3,I>>>0<256){y=23356+(A<<1<<2)|0,(d=0|m[5829])&(A=1<<A)?A=0|m[(d=y+8|0)>>2]:(m[5829]=d|A,A=y,d=y+8|0),m[d>>2]=ee,m[A+12>>2]=ee,m[ee+8>>2]=A,m[ee+12>>2]=y;break}if(y=(A=I>>>8)?I>>>0>16777215?31:I>>>(7+(y=14-((qe=(520192+(Ie=A<<(gt=(A+1048320|0)>>>16&8))|0)>>>16&4)|gt|(y=(245760+(Ie<<=qe)|0)>>>16&2))+(Ie<<y>>>15)|0)|0)&1|y<<1:0,A=23620+(y<<2)|0,m[ee+28>>2]=y,m[4+(d=ee+16|0)>>2]=0,m[d>>2]=0,!(C&(d=1<<y))){m[5830]=C|d,m[A>>2]=ee,m[ee+24>>2]=A,m[ee+12>>2]=ee,m[ee+8>>2]=ee;break}A=0|m[A>>2];t:do{if((-8&m[A+4>>2]|0)!=(0|I)){for(C=I<<(31==(0|y)?0:25-(y>>>1)|0);d=0|m[(y=A+16+(C>>>31<<2)|0)>>2];){if((-8&m[d+4>>2]|0)==(0|I)){A=d;break t}C<<=1,A=d}m[y>>2]=ee,m[ee+24>>2]=A,m[ee+12>>2]=ee,m[ee+8>>2]=ee;break e}}while(0);m[12+(Ie=0|m[(gt=A+8|0)>>2])>>2]=ee,m[gt>>2]=ee,m[ee+8>>2]=Ie,m[ee+12>>2]=A,m[ee+24>>2]=0}}while(0);return me=Nt,0|O+8}ye=X}else ye=X;else ye=-1}while(0);if((y=0|m[5831])>>>0>=ye>>>0)return d=0|m[5834],(A=y-ye|0)>>>0>15?(m[5834]=Ie=d+ye|0,m[5831]=A,m[Ie+4>>2]=1|A,m[d+y>>2]=A,m[d+4>>2]=3|ye):(m[5831]=0,m[5834]=0,m[d+4>>2]=3|y,m[(Ie=d+y+4|0)>>2]=1|m[Ie>>2]),me=Nt,0|d+8;if((I=0|m[5832])>>>0>ye>>>0)return m[5832]=qe=I-ye|0,m[5835]=gt=(Ie=0|m[5835])+ye|0,m[gt+4>>2]=1|qe,m[Ie+4>>2]=3|ye,me=Nt,0|Ie+8;if(0|m[5947]?d=0|m[5949]:(m[5949]=4096,m[5948]=4096,m[5950]=-1,m[5951]=-1,m[5952]=0,m[5940]=0,m[5947]=-16&Te^1431655768,d=4096),O=ye+48|0,(X=(k=d+(G=ye+47|0)|0)&(S=0-d|0))>>>0<=ye>>>0||0|(d=0|m[5939])&&(Te=(ee=0|m[5937])+X|0)>>>0<=ee>>>0|Te>>>0>d>>>0)return me=Nt,0;e:do{if(4&m[5940])A=0,Ke=143;else{y=0|m[5835];t:do{if(y){for(C=23764;!((Te=0|m[C>>2])>>>0<=y>>>0&&(Te+(0|m[C+4>>2])|0)>>>0>y>>>0);){if(!(d=0|m[C+8>>2])){Ke=128;break t}C=d}if((A=k-I&S)>>>0<2147483647)if((0|(d=0|vd(0|A)))==((0|m[C>>2])+(0|m[C+4>>2])|0)){if(-1!=(0|d)){I=A,k=d,Ke=145;break e}}else C=d,Ke=136;else A=0}else Ke=128}while(0);do{if(128==(0|Ke))if(-1!=(0|(y=0|vd(0)))&&(Qe=(A=(0==((Qe=(ze=0|m[5948])-1|0)&(A=y)|0)?0:(Qe+A&0-ze)-A|0)+X|0)+(ze=0|m[5937])|0,A>>>0>ye>>>0&A>>>0<2147483647)){if(0|(Te=0|m[5939])&&Qe>>>0<=ze>>>0|Qe>>>0>Te>>>0){A=0;break}if((0|(d=0|vd(0|A)))==(0|y)){I=A,k=y,Ke=145;break e}C=d,Ke=136}else A=0}while(0);do{if(136==(0|Ke)){if(y=0-A|0,!(O>>>0>A>>>0&A>>>0<2147483647&-1!=(0|C))){if(-1==(0|C)){A=0;break}I=A,k=C,Ke=145;break e}if((d=G-A+(d=0|m[5949])&0-d)>>>0>=2147483647){I=A,k=C,Ke=145;break e}if(-1==(0|vd(0|d))){vd(0|y),A=0;break}I=d+A|0,k=C,Ke=145;break e}}while(0);m[5940]=4|m[5940],Ke=143}}while(0);if((143==(0|Ke)&&X>>>0<2147483647?!(-1==(0|(qe=0|vd(0|X)))|1^(Lt=(Ct=(Qe=0|vd(0))-qe|0)>>>0>(ye+40|0)>>>0)|qe>>>0<Qe>>>0&-1!=(0|qe)&-1!=(0|Qe)^1):0)&&(I=Lt?Ct:A,k=qe,Ke=145),145==(0|Ke)){m[5937]=A=(0|m[5937])+I|0,A>>>0>(0|m[5938])>>>0&&(m[5938]=A),G=0|m[5835];e:do{if(G){for(A=23764;;){if((0|k)==((d=0|m[A>>2])+(y=0|m[A+4>>2])|0)){Ke=154;break}if(!(C=0|m[A+8>>2]))break;A=C}if(154==(0|Ke)&&(gt=A+4|0,0==(8&m[A+12>>2]|0))&&k>>>0>G>>>0&d>>>0<=G>>>0){m[gt>>2]=y+I,gt=G+(qe=0==(7&(qe=G+8|0)|0)?0:0-qe&7)|0,qe=(Ie=(0|m[5832])+I|0)-qe|0,m[5835]=gt,m[5832]=qe,m[gt+4>>2]=1|qe,m[G+Ie+4>>2]=40,m[5836]=m[5951];break}for(k>>>0<(0|m[5833])>>>0&&(m[5833]=k),y=k+I|0,A=23764;;){if((0|m[A>>2])==(0|y)){Ke=162;break}if(!(d=0|m[A+8>>2]))break;A=d}if(162==(0|Ke)&&0==(8&m[A+12>>2]|0)){m[A>>2]=k,m[(ee=A+4|0)>>2]=(0|m[ee>>2])+I,X=(ee=k+(0==(7&(ee=k+8|0)|0)?0:0-ee&7)|0)+ye|0,O=(A=y+(0==(7&(A=y+8|0)|0)?0:0-A&7)|0)-ee-ye|0,m[ee+4>>2]=3|ye;t:do{if((0|G)==(0|A))Ie=(0|m[5832])+O|0,m[5832]=Ie,m[5835]=X,m[X+4>>2]=1|Ie;else{if((0|m[5834])==(0|A)){m[5831]=Ie=(0|m[5831])+O|0,m[5834]=X,m[X+4>>2]=1|Ie,m[X+Ie>>2]=Ie;break}if(1==(3&(d=0|m[A+4>>2])|0)){I=-8&d,C=d>>>3;n:do{if(d>>>0<256){if((0|(y=0|m[A+12>>2]))==(0|(d=0|m[A+8>>2]))){m[5829]=m[5829]&~(1<<C);break}m[d+12>>2]=y,m[y+8>>2]=d;break}k=0|m[A+24>>2],d=0|m[A+12>>2];do{if((0|d)==(0|A)){if(d=0|m[(C=4+(y=A+16|0)|0)>>2])y=C;else if(!(d=0|m[y>>2])){d=0;break}for(;;)if(C=0|m[(S=d+20|0)>>2])d=C,y=S;else{if(!(C=0|m[(S=d+16|0)>>2]))break;d=C,y=S}m[y>>2]=0}else m[12+(Ie=0|m[A+8>>2])>>2]=d,m[d+8>>2]=Ie}while(0);if(!k)break;C=23620+((y=0|m[A+28>>2])<<2)|0;do{if((0|m[C>>2])==(0|A)){if(m[C>>2]=d,0|d)break;m[5830]=m[5830]&~(1<<y);break n}if(m[((0|m[(Ie=k+16|0)>>2])==(0|A)?Ie:k+20|0)>>2]=d,!d)break n}while(0);if(m[d+24>>2]=k,0|(C=0|m[(y=A+16|0)>>2])&&(m[d+16>>2]=C,m[C+24>>2]=d),!(y=0|m[y+4>>2]))break;m[d+20>>2]=y,m[y+24>>2]=d}while(0);A=A+I|0,S=I+O|0}else S=O;if(m[(A=A+4|0)>>2]=-2&m[A>>2],m[X+4>>2]=1|S,m[X+S>>2]=S,A=S>>>3,S>>>0<256){y=23356+(A<<1<<2)|0,(d=0|m[5829])&(A=1<<A)?A=0|m[(d=y+8|0)>>2]:(m[5829]=d|A,A=y,d=y+8|0),m[d>>2]=X,m[A+12>>2]=X,m[X+8>>2]=A,m[X+12>>2]=y;break}A=S>>>8;do{if(A){if(S>>>0>16777215){C=31;break}C=S>>>(7+(C=14-((qe=(520192+(Ie=A<<(gt=(A+1048320|0)>>>16&8))|0)>>>16&4)|gt|(C=(245760+(Ie<<=qe)|0)>>>16&2))+(Ie<<C>>>15)|0)|0)&1|C<<1}else C=0}while(0);if(A=23620+(C<<2)|0,m[X+28>>2]=C,m[4+(d=X+16|0)>>2]=0,m[d>>2]=0,!((d=0|m[5830])&(y=1<<C))){m[5830]=d|y,m[A>>2]=X,m[X+24>>2]=A,m[X+12>>2]=X,m[X+8>>2]=X;break}A=0|m[A>>2];n:do{if((-8&m[A+4>>2]|0)!=(0|S)){for(C=S<<(31==(0|C)?0:25-(C>>>1)|0);d=0|m[(y=A+16+(C>>>31<<2)|0)>>2];){if((-8&m[d+4>>2]|0)==(0|S)){A=d;break n}C<<=1,A=d}m[y>>2]=X,m[X+24>>2]=A,m[X+12>>2]=X,m[X+8>>2]=X;break t}}while(0);m[12+(Ie=0|m[(gt=A+8|0)>>2])>>2]=X,m[gt>>2]=X,m[X+8>>2]=Ie,m[X+12>>2]=A,m[X+24>>2]=0}}while(0);return me=Nt,0|ee+8}for(A=23764;!((d=0|m[A>>2])>>>0<=G>>>0&&(Ie=d+(0|m[A+4>>2])|0,Ie>>>0>G>>>0));)A=0|m[A+8>>2];A=(d=(d=(S=Ie+-47|0)+(0==(7&(d=S+8|0)|0)?0:0-d&7)|0)>>>0<(S=G+16|0)>>>0?G:d)+8|0,gt=k+(qe=0==(7&(qe=k+8|0)|0)?0:0-qe&7)|0,qe=(y=I+-40|0)-qe|0,m[5835]=gt,m[5832]=qe,m[gt+4>>2]=1|qe,m[k+y+4>>2]=40,m[5836]=m[5951],m[(y=d+4|0)>>2]=27,m[A>>2]=m[5941],m[A+4>>2]=m[5942],m[A+8>>2]=m[5943],m[A+12>>2]=m[5944],m[5941]=k,m[5942]=I,m[5944]=0,m[5943]=A,A=d+24|0;do{gt=A,m[(A=A+4|0)>>2]=7}while((gt+8|0)>>>0<Ie>>>0);if((0|d)!=(0|G)){if(k=d-G|0,m[y>>2]=-2&m[y>>2],m[G+4>>2]=1|k,m[d>>2]=k,A=k>>>3,k>>>0<256){y=23356+(A<<1<<2)|0,(d=0|m[5829])&(A=1<<A)?A=0|m[(d=y+8|0)>>2]:(m[5829]=d|A,A=y,d=y+8|0),m[d>>2]=G,m[A+12>>2]=G,m[G+8>>2]=A,m[G+12>>2]=y;break}if(y=23620+((C=(A=k>>>8)?k>>>0>16777215?31:k>>>(7+(C=14-((qe=(520192+(Ie=A<<(gt=(A+1048320|0)>>>16&8))|0)>>>16&4)|gt|(C=(245760+(Ie<<=qe)|0)>>>16&2))+(Ie<<C>>>15)|0)|0)&1|C<<1:0)<<2)|0,m[G+28>>2]=C,m[G+20>>2]=0,m[S>>2]=0,!((A=0|m[5830])&(d=1<<C))){m[5830]=A|d,m[y>>2]=G,m[G+24>>2]=y,m[G+12>>2]=G,m[G+8>>2]=G;break}A=0|m[y>>2];t:do{if((-8&m[A+4>>2]|0)!=(0|k)){for(C=k<<(31==(0|C)?0:25-(C>>>1)|0);d=0|m[(y=A+16+(C>>>31<<2)|0)>>2];){if((-8&m[d+4>>2]|0)==(0|k)){A=d;break t}C<<=1,A=d}m[y>>2]=G,m[G+24>>2]=A,m[G+12>>2]=G,m[G+8>>2]=G;break e}}while(0);m[12+(Ie=0|m[(gt=A+8|0)>>2])>>2]=G,m[gt>>2]=G,m[G+8>>2]=Ie,m[G+12>>2]=A,m[G+24>>2]=0}}else Ie=0|m[5833],0==(0|Ie)|k>>>0<Ie>>>0&&(m[5833]=k),m[5941]=k,m[5942]=I,m[5944]=0,m[5838]=m[5947],m[5837]=-1,m[5842]=23356,m[5841]=23356,m[5844]=23364,m[5843]=23364,m[5846]=23372,m[5845]=23372,m[5848]=23380,m[5847]=23380,m[5850]=23388,m[5849]=23388,m[5852]=23396,m[5851]=23396,m[5854]=23404,m[5853]=23404,m[5856]=23412,m[5855]=23412,m[5858]=23420,m[5857]=23420,m[5860]=23428,m[5859]=23428,m[5862]=23436,m[5861]=23436,m[5864]=23444,m[5863]=23444,m[5866]=23452,m[5865]=23452,m[5868]=23460,m[5867]=23460,m[5870]=23468,m[5869]=23468,m[5872]=23476,m[5871]=23476,m[5874]=23484,m[5873]=23484,m[5876]=23492,m[5875]=23492,m[5878]=23500,m[5877]=23500,m[5880]=23508,m[5879]=23508,m[5882]=23516,m[5881]=23516,m[5884]=23524,m[5883]=23524,m[5886]=23532,m[5885]=23532,m[5888]=23540,m[5887]=23540,m[5890]=23548,m[5889]=23548,m[5892]=23556,m[5891]=23556,m[5894]=23564,m[5893]=23564,m[5896]=23572,m[5895]=23572,m[5898]=23580,m[5897]=23580,m[5900]=23588,m[5899]=23588,m[5902]=23596,m[5901]=23596,m[5904]=23604,m[5903]=23604,Ie=I+-40|0,qe=k+8|0,qe=0==(7&qe|0)?0:0-qe&7,gt=k+qe|0,qe=Ie-qe|0,m[5835]=gt,m[5832]=qe,m[gt+4>>2]=1|qe,m[k+Ie+4>>2]=40,m[5836]=m[5951]}while(0);if((A=0|m[5832])>>>0>ye>>>0)return m[5832]=qe=A-ye|0,m[5835]=gt=(Ie=0|m[5835])+ye|0,m[gt+4>>2]=1|qe,m[Ie+4>>2]=3|ye,me=Nt,0|Ie+8}return m[(Ie=23312)>>2]=12,me=Nt,0}function Ln(d){var A=0,y=0,C=0,S=0,k=0,I=0,O=0,G=0;if(d|=0){S=0|m[5833],G=(y=d+-8|0)+(A=-8&(d=0|m[d+-4>>2]))|0;do{if(1&d)O=y,I=y;else{if(C=0|m[y>>2],!(3&d)||(k=C+A|0,(I=y+(0-C)|0)>>>0<S>>>0))return;if((0|m[5834])==(0|I)){if(3!=(3&(A=0|m[(d=G+4|0)>>2])|0)){O=I,A=k;break}return m[5831]=k,m[d>>2]=-2&A,m[I+4>>2]=1|k,void(m[I+k>>2]=k)}if(y=C>>>3,C>>>0<256){if((0|(A=0|m[I+12>>2]))==(0|(d=0|m[I+8>>2]))){m[5829]=m[5829]&~(1<<y),O=I,A=k;break}m[d+12>>2]=A,m[A+8>>2]=d,O=I,A=k;break}S=0|m[I+24>>2],d=0|m[I+12>>2];do{if((0|d)==(0|I)){if(d=0|m[(y=4+(A=I+16|0)|0)>>2])A=y;else if(!(d=0|m[A>>2])){d=0;break}for(;;)if(y=0|m[(C=d+20|0)>>2])d=y,A=C;else{if(!(y=0|m[(C=d+16|0)>>2]))break;d=y,A=C}m[A>>2]=0}else m[12+(O=0|m[I+8>>2])>>2]=d,m[d+8>>2]=O}while(0);if(S){if((0|m[(y=23620+((A=0|m[I+28>>2])<<2)|0)>>2])==(0|I)){if(m[y>>2]=d,!d){m[5830]=m[5830]&~(1<<A),O=I,A=k;break}}else if(m[((0|m[(O=S+16|0)>>2])==(0|I)?O:S+20|0)>>2]=d,!d){O=I,A=k;break}m[d+24>>2]=S,0|(y=0|m[(A=I+16|0)>>2])&&(m[d+16>>2]=y,m[y+24>>2]=d),(A=0|m[A+4>>2])?(m[d+20>>2]=A,m[A+24>>2]=d,O=I,A=k):(O=I,A=k)}else O=I,A=k}}while(0);if(!(I>>>0>=G>>>0)&&1&(C=0|m[(d=G+4|0)>>2])){if(2&C)m[d>>2]=-2&C,m[O+4>>2]=1|A,m[I+A>>2]=A,S=A;else{if((0|m[5835])==(0|G)){if(m[5832]=G=(0|m[5832])+A|0,m[5835]=O,m[O+4>>2]=1|G,(0|O)!=(0|m[5834]))return;return m[5834]=0,void(m[5831]=0)}if((0|m[5834])==(0|G))return m[5831]=G=(0|m[5831])+A|0,m[5834]=I,m[O+4>>2]=1|G,void(m[I+G>>2]=G);S=(-8&C)+A|0,y=C>>>3;do{if(C>>>0<256){if((0|(d=0|m[G+12>>2]))==(0|(A=0|m[G+8>>2]))){m[5829]=m[5829]&~(1<<y);break}m[A+12>>2]=d,m[d+8>>2]=A;break}k=0|m[G+24>>2],d=0|m[G+12>>2];do{if((0|d)==(0|G)){if(d=0|m[(y=4+(A=G+16|0)|0)>>2])A=y;else if(!(d=0|m[A>>2])){y=0;break}for(;;)if(y=0|m[(C=d+20|0)>>2])d=y,A=C;else{if(!(y=0|m[(C=d+16|0)>>2]))break;d=y,A=C}m[A>>2]=0,y=d}else m[12+(y=0|m[G+8>>2])>>2]=d,m[d+8>>2]=y,y=d}while(0);if(0|k){if((0|m[(A=23620+((d=0|m[G+28>>2])<<2)|0)>>2])==(0|G)){if(m[A>>2]=y,!y){m[5830]=m[5830]&~(1<<d);break}}else if(m[((0|m[(C=k+16|0)>>2])==(0|G)?C:k+20|0)>>2]=y,!y)break;m[y+24>>2]=k,0|(A=0|m[(d=G+16|0)>>2])&&(m[y+16>>2]=A,m[A+24>>2]=y),0|(d=0|m[d+4>>2])&&(m[y+20>>2]=d,m[d+24>>2]=y)}}while(0);if(m[O+4>>2]=1|S,m[I+S>>2]=S,(0|O)==(0|m[5834]))return void(m[5831]=S)}if(d=S>>>3,S>>>0<256)return y=23356+(d<<1<<2)|0,(A=0|m[5829])&(d=1<<d)?d=0|m[(A=y+8|0)>>2]:(m[5829]=A|d,d=y,A=y+8|0),m[A>>2]=O,m[d+12>>2]=O,m[O+8>>2]=d,void(m[O+12>>2]=y);C=(d=S>>>8)?S>>>0>16777215?31:S>>>(7+(C=14-((k=(520192+(G=d<<(I=(d+1048320|0)>>>16&8))|0)>>>16&4)|I|(C=(245760+(G<<=k)|0)>>>16&2))+(G<<C>>>15)|0)|0)&1|C<<1:0,d=23620+(C<<2)|0,m[O+28>>2]=C,m[O+20>>2]=0,m[O+16>>2]=0,A=0|m[5830],y=1<<C;e:do{if(A&y){d=0|m[d>>2];t:do{if((-8&m[d+4>>2]|0)!=(0|S)){for(C=S<<(31==(0|C)?0:25-(C>>>1)|0);A=0|m[(y=d+16+(C>>>31<<2)|0)>>2];){if((-8&m[A+4>>2]|0)==(0|S)){d=A;break t}C<<=1,d=A}m[y>>2]=O,m[O+24>>2]=d,m[O+12>>2]=O,m[O+8>>2]=O;break e}}while(0);m[12+(G=0|m[(I=d+8|0)>>2])>>2]=O,m[I>>2]=O,m[O+8>>2]=G,m[O+12>>2]=d,m[O+24>>2]=0}else m[5830]=A|y,m[d>>2]=O,m[O+24>>2]=d,m[O+12>>2]=O,m[O+8>>2]=O}while(0);if(m[5837]=G=(0|m[5837])-1|0,!(0|G)){for(d=23772;d=0|m[d>>2];)d=d+8|0;m[5837]=-1}}}}function ic(d,A){A|=0;var y=0;return(d|=0)?(y=0|gh(A,d),(A|d)>>>0>65535&&(y=(0|(y>>>0)/(d>>>0))==(0|A)?y:-1)):y=0,!(d=0|lu(y))||!(3&m[d+-4>>2])||oc(0|d,0,0|y),0|d}function b0(d,A,y,C){return Mn(0|(C=(A|=0)-(C|=0)-((y|=0)>>>0>(d|=0)>>>0|0)>>>0)),0|d-y>>>0}function Xk(d){return 0|((d|=0)?31-(0|KA(d^d-1))|0:32)}function yd(d,A,y,C){var S,k;return k=me,me=me+16|0,function(d,A,y,C,S){S|=0;var k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0;if(ee=d|=0,I=y|=0,O=Te=C|=0,!(X=G=A|=0))return k=0!=(0|S),O?k?(m[S>>2]=0|d,m[S+4>>2]=0&A,S=0,Mn(0|(Te=0)),0|S):(S=0,Mn(0|(Te=0)),0|S):(k&&(m[S>>2]=(ee>>>0)%(I>>>0),m[S+4>>2]=0),S=(ee>>>0)/(I>>>0)>>>0,Mn(0|(Te=0)),0|S);k=0==(0|O);do{if(I){if(!k){if((k=(0|KA(0|O))-(0|KA(0|X))|0)>>>0<=31){I=ye=k+1|0,d=ee>>>(ye>>>0)&(A=k-31>>31)|X<<(O=31-k|0),A&=X>>>(ye>>>0),k=0,O=ee<<O;break}return S?(m[S>>2]=0|d,m[S+4>>2]=G|0&A,S=0,Mn(0|(Te=0)),0|S):(S=0,Mn(0|(Te=0)),0|S)}if((k=I-1|0)&I|0){I=O=33+(0|KA(0|I))-(0|KA(0|X))|0,d=(ye=32-O|0)-1>>31&X>>>((ze=O-32|0)>>>0)|(X<<ye|ee>>>(O>>>0))&(A=ze>>31),A&=X>>>(O>>>0),k=ee<<(Qe=64-O|0)&(G=ye>>31),O=(X<<Qe|ee>>>(ze>>>0))&G|ee<<ye&O-33>>31;break}return 0|S&&(m[S>>2]=k&ee,m[S+4>>2]=0),1==(0|I)?(Qe=0|d,Mn(0|(ze=G|0&A)),0|Qe):(ze=X>>>((Qe=0|Xk(0|I))>>>0)|0,Qe=X<<32-Qe|ee>>>(Qe>>>0)|0,Mn(0|ze),0|Qe)}if(k)return 0|S&&(m[S>>2]=(X>>>0)%(I>>>0),m[S+4>>2]=0),Qe=(X>>>0)/(I>>>0)>>>0,Mn(0|(ze=0)),0|Qe;if(!ee)return 0|S&&(m[S>>2]=0,m[S+4>>2]=(X>>>0)%(O>>>0)),Qe=(X>>>0)/(O>>>0)>>>0,Mn(0|(ze=0)),0|Qe;if(!((k=O-1|0)&O))return 0|S&&(m[S>>2]=0|d,m[S+4>>2]=k&X|0&A),ze=0,Qe=X>>>((0|Xk(0|O))>>>0),Mn(0|ze),0|Qe;if((k=(0|KA(0|O))-(0|KA(0|X))|0)>>>0<=30){I=A=k+1|0,d=X<<(O=31-k|0)|ee>>>(A>>>0),A=X>>>(A>>>0),k=0,O=ee<<O;break}return S?(m[S>>2]=0|d,m[S+4>>2]=G|0&A,Qe=0,Mn(0|(ze=0)),0|Qe):(Qe=0,Mn(0|(ze=0)),0|Qe)}while(0);if(I){X=0|function(d,A,y,C){return Mn((A|=0)+(C|=0)+((y=(d|=0)+(y|=0)>>>0)>>>0<d>>>0|0)>>>0|0),0|y}(0|(ye=0|y),0|(ee=Te|0&C),-1,-1),y=0|De(),G=O,O=0;do{C=G,G=k>>>31|G<<1,k=O|k<<1,b0(0|X,0|y,0|(C=d<<1|C>>>31|0),0|(Te=d>>>31|A<<1|0)),O=1&(ze=(Qe=0|De())>>31|((0|Qe)<0?-1:0)<<1),d=0|b0(0|C,0|Te,ze&ye|0,(((0|Qe)<0?-1:0)>>31|((0|Qe)<0?-1:0)<<1)&ee|0),A=0|De(),I=I-1|0}while(0!=(0|I));X=G,G=0}else X=O,G=0,O=0;I=0,0|S&&(m[S>>2]=d,m[S+4>>2]=A),Qe=-2&(k<<1|0)|O,Mn(0|(ze=(0|k)>>>31|(X|I)<<1|0&(I<<1|k>>>31)|G))}(d|=0,A|=0,y|=0,C|=0,S=0|k),me=k,Mn(0|m[S+4>>2]),0|m[S>>2]}function bt(d,A,y){return d|=0,A|=0,(0|(y|=0))<32?(Mn(A>>>y|0),d>>>y|(A&(1<<y)-1)<<32-y):(Mn(0),A>>>y-32|0)}function Ot(d,A,y){return d|=0,(0|(y|=0))<32?(Mn((A|=0)<<y|(d&(1<<y)-1<<32-y)>>>32-y|0),d<<y):(Mn(d<<y-32|0),0)}function Yk(d,A){return A=+A,(d=+d)!=d?+A:A!=A?+d:+pj(+d,+A)}function wv(d){return(d=+d)>=0?+ha(d+.5):+mv(d-.5)}function Cv(d,A,y){d|=0,A|=0;var S,k,C=0;if((0|(y|=0))>=8192)return gj(0|d,0|A,0|y),0|d;if(k=0|d,S=d+y|0,(3&d)==(3&A)){for(;3&d;){if(!y)return 0|k;rn[d>>0]=0|rn[A>>0],d=d+1|0,A=A+1|0,y=y-1|0}for(C=(y=-4&S|0)-64|0;(0|d)<=(0|C);)m[d>>2]=m[A>>2],m[d+4>>2]=m[A+4>>2],m[d+8>>2]=m[A+8>>2],m[d+12>>2]=m[A+12>>2],m[d+16>>2]=m[A+16>>2],m[d+20>>2]=m[A+20>>2],m[d+24>>2]=m[A+24>>2],m[d+28>>2]=m[A+28>>2],m[d+32>>2]=m[A+32>>2],m[d+36>>2]=m[A+36>>2],m[d+40>>2]=m[A+40>>2],m[d+44>>2]=m[A+44>>2],m[d+48>>2]=m[A+48>>2],m[d+52>>2]=m[A+52>>2],m[d+56>>2]=m[A+56>>2],m[d+60>>2]=m[A+60>>2],d=d+64|0,A=A+64|0;for(;(0|d)<(0|y);)m[d>>2]=m[A>>2],d=d+4|0,A=A+4|0}else for(y=S-4|0;(0|d)<(0|y);)rn[d>>0]=0|rn[A>>0],rn[d+1>>0]=0|rn[A+1>>0],rn[d+2>>0]=0|rn[A+2>>0],rn[d+3>>0]=0|rn[A+3>>0],d=d+4|0,A=A+4|0;for(;(0|d)<(0|S);)rn[d>>0]=0|rn[A>>0],d=d+1|0,A=A+1|0;return 0|k}function oc(d,A,y){A|=0;var k,C=0,S=0,I=0;if(k=(d|=0)+(y|=0)|0,A&=255,(0|y)>=67){for(;3&d;)rn[d>>0]=A,d=d+1|0;for(I=A|A<<8|A<<16|A<<24,S=(C=-4&k|0)-64|0;(0|d)<=(0|S);)m[d>>2]=I,m[d+4>>2]=I,m[d+8>>2]=I,m[d+12>>2]=I,m[d+16>>2]=I,m[d+20>>2]=I,m[d+24>>2]=I,m[d+28>>2]=I,m[d+32>>2]=I,m[d+36>>2]=I,m[d+40>>2]=I,m[d+44>>2]=I,m[d+48>>2]=I,m[d+52>>2]=I,m[d+56>>2]=I,m[d+60>>2]=I,d=d+64|0;for(;(0|d)<(0|C);)m[d>>2]=I,d=d+4|0}for(;(0|d)<(0|k);)rn[d>>0]=A,d=d+1|0;return k-y|0}function Kk(d){return(d=+d)>=0?+ha(d+.5):+mv(d-.5)}function vd(d){var A,y,C;return d|=0,C=0|mj(),(0|d)>0&(0|(A=(y=0|m[As>>2])+d|0))<(0|y)|(0|A)<0?(yj(0|A),gk(12),-1):(0|A)>(0|C)&&!(0|_j(0|A))?(gk(12),-1):(m[As>>2]=A,0|y)}return{___uremdi3:yd,_bitshift64Lshr:bt,_bitshift64Shl:Ot,_calloc:ic,_cellAreaKm2:function(d,A){var C,S,k,y=0;if(k=me,me=me+192|0,S=k,nf(d|=0,A|=0,C=k+168|0),rf(d,A,S),(0|(A=0|m[S>>2]))>0){if(y=+nm(S+8|0,S+8+((1!=(0|A)&1)<<4)|0,C)+0,1!=(0|A)){d=1;do{y+=+nm(S+8+(d<<4)|0,S+8+(((0|(d=d+1|0))%(0|A)|0)<<4)|0,C)}while((0|d)<(0|A))}}else y=0;return me=k,6371.007180918475*y*6371.007180918475},_cellAreaM2:function(d,A){var C,S,k,y=0;if(k=me,me=me+192|0,S=k,nf(d|=0,A|=0,C=k+168|0),rf(d,A,S),(0|(A=0|m[S>>2]))>0){if(y=+nm(S+8|0,S+8+((1!=(0|A)&1)<<4)|0,C)+0,1!=(0|A)){d=1;do{y+=+nm(S+8+(d<<4)|0,S+8+(((0|(d=d+1|0))%(0|A)|0)<<4)|0,C)}while((0|d)<(0|A))}}else y=0;return me=k,6371.007180918475*y*6371.007180918475*1e3*1e3},_cellAreaRads2:function(d,A){var C,S,k,y=0;if(k=me,me=me+192|0,S=k,nf(d|=0,A|=0,C=k+168|0),rf(d,A,S),(0|(A=0|m[S>>2]))<=0)return me=k,+(y=0);if(y=+nm(S+8|0,S+8+((1!=(0|A)&1)<<4)|0,C)+0,1==(0|A))return me=k,+y;d=1;do{y+=+nm(S+8+(d<<4)|0,S+8+(((0|(d=d+1|0))%(0|A)|0)<<4)|0,C)}while((0|d)<(0|A));return me=k,+y},_compact:function(d,A,y){A|=0;var Ie,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,Lt=0,qe=0,gt=0,Nt=0,zt=0,kt=0,Ft=0;if(!(y|=0))return 0;if(C=0|m[(S=d|=0)>>2],!0&0==(15728640&(S=0|m[S+4>>2])|0)){if((0|y)<=0||(m[(kt=A)>>2]=C,m[kt+4>>2]=S,1==(0|y)))return 0;C=1;do{zt=0|m[4+(Nt=d+(C<<3)|0)>>2],m[(kt=A+(C<<3)|0)>>2]=m[Nt>>2],m[kt+4>>2]=zt,C=C+1|0}while((0|C)!=(0|y));return 0}if(!(zt=0|lu(Nt=y<<3)))return-3;if(Cv(0|zt,0|d,0|Nt),!(Ie=0|ic(y,8)))return Ln(zt),-3;C=y;e:for(;;){qe=0|bt(0|(ee=0|m[(I=zt)>>2]),0|(I=0|m[I+4>>2]),52),De(),gt=(qe&=15)-1|0,Lt=(0|C)>0;t:do{if(Lt){if(Ct=((0|C)<0)<<31>>31,Qe=0|Ot(0|gt,0,52),Ke=0|De(),gt>>>0>15)for(S=0,d=ee,y=I;;){if(!(0==(0|d)&0==(0|y))){if(k=0|bt(0|d,0|y,52),De(),O=(0|(k&=15))<(0|gt),k=(0|k)==(0|gt),y=0|yd(0|(X=O?0:k?d:0),0|(d=O?0:k?y:0),0|C,0|Ct),De(),0==(0|(G=0|m[(O=k=Ie+(y<<3)|0)>>2]))&0==(0|(O=0|m[O+4>>2])))y=X;else for(Qe=0,ze=y,Te=O,y=X;;){if((0|Qe)>(0|C)){kt=41;break e}if((0|G)==(0|y)&(-117440513&Te|0)==(0|d)){X=0|bt(0|G,0|Te,56),De(),ye=1+(X&=7)|0,Ke=0|bt(0|G,0|Te,45),De();n:do{if(0|gi(127&Ke)){if(G=0|bt(0|G,0|Te,52),De(),!(G&=15)){O=6;break}for(O=1;;){if(!(0==((Ke=0|Ot(7,0,3*(15-O|0)|0))&y|0)&0==((0|De())&d|0))){O=7;break n}if(!(O>>>0<G>>>0)){O=6;break}O=O+1|0}}else O=7}while(0);if((X+2|0)>>>0>O>>>0){kt=51;break e}Ke=0|Ot(0|ye,0,56),d=0|De()|-117440513&d,m[(O=k)>>2]=0,m[O+4>>2]=0,O=ze,y|=Ke}else O=(ze+1|0)%(0|C)|0;if(0==(0|(G=0|m[(Te=k=Ie+(O<<3)|0)>>2]))&0==(0|(Te=0|m[Te+4>>2])))break;Qe=Qe+1|0,ze=O}m[(Ke=k)>>2]=y,m[Ke+4>>2]=d}if((0|(S=S+1|0))>=(0|C))break t;d=0|m[(y=zt+(S<<3)|0)>>2],y=0|m[y+4>>2]}for(S=0,d=ee,y=I;;){if(!(0==(0|d)&0==(0|y))){if(O=0|bt(0|d,0|y,52),De(),(0|(O&=15))>=(0|gt)){if((0|O)!=(0|gt)&&(d|=Qe,y=-15728641&y|Ke,O>>>0>=qe>>>0)){k=gt;do{ze=0|Ot(7,0,3*(14-k|0)|0),k=k+1|0,d|=ze,y=0|De()|y}while(k>>>0<O>>>0)}}else d=0,y=0;if(O=0|yd(0|d,0|y,0|C,0|Ct),De(),!(0==(0|(X=0|m[(G=k=Ie+(O<<3)|0)>>2]))&0==(0|(G=0|m[G+4>>2]))))for(ze=0;;){if((0|ze)>(0|C)){kt=41;break e}if((0|X)==(0|d)&(-117440513&G|0)==(0|y)){ye=0|bt(0|X,0|G,56),De(),Te=1+(ye&=7)|0,Ft=0|bt(0|X,0|G,45),De();n:do{if(0|gi(127&Ft)){if(X=0|bt(0|X,0|G,52),De(),!(X&=15)){G=6;break}for(G=1;;){if(!(0==((Ft=0|Ot(7,0,3*(15-G|0)|0))&d|0)&0==((0|De())&y|0))){G=7;break n}if(!(G>>>0<X>>>0)){G=6;break}G=G+1|0}}else G=7}while(0);if((ye+2|0)>>>0>G>>>0){kt=51;break e}Ft=0|Ot(0|Te,0,56),y=0|De()|-117440513&y,m[(Te=k)>>2]=0,m[Te+4>>2]=0,d|=Ft}else O=(O+1|0)%(0|C)|0;if(0==(0|(X=0|m[(G=k=Ie+(O<<3)|0)>>2]))&0==(0|(G=0|m[G+4>>2])))break;ze=ze+1|0}m[(Ft=k)>>2]=d,m[Ft+4>>2]=y}if((0|(S=S+1|0))>=(0|C))break t;d=0|m[(y=zt+(S<<3)|0)>>2],y=0|m[y+4>>2]}}}while(0);if((C+5|0)>>>0<11){kt=99;break}if(!(Ke=0|ic((0|C)/6|0,8))){kt=58;break}t:do{if(Lt){ze=0,Te=0;do{if(!(0==(0|(S=0|m[(d=O=Ie+(ze<<3)|0)>>2]))&0==(0|(d=0|m[d+4>>2])))){G=0|bt(0|S,0|d,56),De(),y=1+(G&=7)|0,X=-117440513&d,Ft=0|bt(0|S,0|d,45),De();n:do{if(0|gi(127&Ft)){if(ye=0|bt(0|S,0|d,52),De(),0|(ye&=15))for(k=1;;){if(!(0==(S&(Ft=0|Ot(7,0,3*(15-k|0)|0))|0)&0==(X&(0|De())|0)))break n;if(!(k>>>0<ye>>>0))break;k=k+1|0}S|=d=0|Ot(0|y,0,56),d=0|De()|X,m[(y=O)>>2]=S,m[y+4>>2]=d,y=G+2|0}}while(0);7==(0|y)&&(m[(Ft=Ke+(Te<<3)|0)>>2]=S,m[Ft+4>>2]=-117440513&d,Te=Te+1|0)}ze=ze+1|0}while((0|ze)!=(0|C));if(Lt){if(Qe=((0|C)<0)<<31>>31,ye=0|Ot(0|gt,0,52),ze=0|De(),gt>>>0>15)for(d=0,S=0;;){do{if(!(0==(0|ee)&0==(0|I))){for(G=0|bt(0|ee,0|I,52),De(),k=(0|(G&=15))<(0|gt),G=(0|G)==(0|gt),k=0|yd(0|(O=k?0:G?ee:0),0|(G=k?0:G?I:0),0|C,0|Qe),De(),y=0;;){if((0|y)>(0|C)){kt=98;break e}if((-117440513&(X=0|m[4+(Ft=Ie+(k<<3)|0)>>2])|0)==(0|G)&&(0|m[Ft>>2])==(0|O)){kt=70;break}if((0|m[(Ft=Ie+((k=(k+1|0)%(0|C)|0)<<3)|0)>>2])==(0|O)&&(0|m[Ft+4>>2])==(0|G))break;y=y+1|0}if(70==(0|kt)&&(kt=0,!0&100663296==(117440512&X|0)))break;m[(Ft=A+(S<<3)|0)>>2]=ee,m[Ft+4>>2]=I,S=S+1|0}}while(0);if((0|(d=d+1|0))>=(0|C)){C=Te;break t}ee=0|m[(I=zt+(d<<3)|0)>>2],I=0|m[I+4>>2]}for(d=0,S=0;;){do{if(!(0==(0|ee)&0==(0|I))){if(G=0|bt(0|ee,0|I,52),De(),(0|(G&=15))>=(0|gt))if((0|G)!=(0|gt))if(y=ee|ye,k=-15728641&I|ze,G>>>0<qe>>>0)G=k;else{O=gt;do{Ft=0|Ot(7,0,3*(14-O|0)|0),O=O+1|0,y|=Ft,k=0|De()|k}while(O>>>0<G>>>0);G=k}else y=ee,G=I;else y=0,G=0;for(O=0|yd(0|y,0|G,0|C,0|Qe),De(),k=0;;){if((0|k)>(0|C)){kt=98;break e}if((-117440513&(X=0|m[4+(Ft=Ie+(O<<3)|0)>>2])|0)==(0|G)&&(0|m[Ft>>2])==(0|y)){kt=93;break}if((0|m[(Ft=Ie+((O=(O+1|0)%(0|C)|0)<<3)|0)>>2])==(0|y)&&(0|m[Ft+4>>2])==(0|G))break;k=k+1|0}if(93==(0|kt)&&(kt=0,!0&100663296==(117440512&X|0)))break;m[(Ft=A+(S<<3)|0)>>2]=ee,m[Ft+4>>2]=I,S=S+1|0}}while(0);if((0|(d=d+1|0))>=(0|C)){C=Te;break t}ee=0|m[(I=zt+(d<<3)|0)>>2],I=0|m[I+4>>2]}}else S=0,C=Te}else S=0,C=0}while(0);if(oc(0|Ie,0,0|Nt),Cv(0|zt,0|Ke,C<<3|0),Ln(Ke),!C)break;A=A+(S<<3)|0}return 41==(0|kt)?(Ln(zt),Ln(Ie),0|(Ft=-1)):51==(0|kt)?(Ln(zt),Ln(Ie),0|(Ft=-2)):58==(0|kt)?(Ln(zt),Ln(Ie),0|(Ft=-3)):98==(0|kt)?(Ln(Ke),Ln(zt),Ln(Ie),0|(Ft=-1)):(99==(0|kt)&&Cv(0|A,0|zt,C<<3|0),Ln(zt),Ln(Ie),0|(Ft=0))},_destroyLinkedPolygon:function(d){var A=0,y=0,C=0,S=0;if(d|=0)for(C=1;;){if(0|(A=0|m[d>>2]))do{if(0|(y=0|m[A>>2]))do{S=y,y=0|m[y+16>>2],Ln(S)}while(0!=(0|y));S=A,A=0|m[A+8>>2],Ln(S)}while(0!=(0|A));if(A=d,d=0|m[d+8>>2],C||Ln(A),!d)break;C=0}},_edgeLengthKm:function(d){return+ +pe[20752+((d|=0)<<3)>>3]},_edgeLengthM:function(d){return+ +pe[20880+((d|=0)<<3)>>3]},_emscripten_replace_memory:function(d){return rn=new Int8Array(d),new Uint8Array(d),m=new Int32Array(d),new Float32Array(d),pe=new Float64Array(d),It=d,!0},_exactEdgeLengthKm:function(d,A){var k,I,y=0,C=0,S=0,O=0,G=0,X=0;if(I=me,me=me+176|0,vv(d|=0,A|=0,k=I),(0|(d=0|m[k>>2]))<=1)return me=I,+(S=0);A=d+-1|0,d=0,y=0,C=+pe[k+8>>3],S=+pe[k+16>>3];do{G=C,O=S,O=(X=+ar(.5*((C=+pe[k+8+((d=d+1|0)<<4)>>3])-G)))*X+(O=+ar(.5*((S=+pe[k+8+(d<<4)+8>>3])-O)))*(+Qn(+G)*+Qn(+C)*O),y+=2*+gl(+ +ki(+O),+ +ki(+(1-O)))}while((0|d)!=(0|A));return me=I,+(X=6371.007180918475*y)},_exactEdgeLengthM:function(d,A){var k,I,y=0,C=0,S=0,O=0,G=0,X=0;if(I=me,me=me+176|0,vv(d|=0,A|=0,k=I),(0|(d=0|m[k>>2]))<=1)return me=I,+(S=0);A=d+-1|0,d=0,y=0,C=+pe[k+8>>3],S=+pe[k+16>>3];do{G=C,O=S,O=(X=+ar(.5*((C=+pe[k+8+((d=d+1|0)<<4)>>3])-G)))*X+(O=+ar(.5*((S=+pe[k+8+(d<<4)+8>>3])-O)))*(+Qn(+G)*+Qn(+C)*O),y+=2*+gl(+ +ki(+O),+ +ki(+(1-O)))}while((0|d)!=(0|A));return me=I,+(X=6371.007180918475*y*1e3)},_exactEdgeLengthRads:function(d,A){var k,I,y=0,C=0,S=0,O=0,G=0,X=0;if(I=me,me=me+176|0,vv(d|=0,A|=0,k=I),(0|(d=0|m[k>>2]))<=1)return me=I,+(S=0);A=d+-1|0,d=0,y=0,C=+pe[k+8>>3],S=+pe[k+16>>3];do{G=C,O=S,O=(X=+ar(.5*((C=+pe[k+8+((d=d+1|0)<<4)>>3])-G)))*X+(O=+ar(.5*((S=+pe[k+8+(d<<4)+8>>3])-O)))*(+Qn(+C)*+Qn(+G)*O),y+=2*+gl(+ +ki(+O),+ +ki(+(1-O)))}while((0|d)<(0|A));return me=I,+y},_experimentalH3ToLocalIj:function(d,A,y,C,S){var k,I;return S|=0,I=me,me=me+16|0,(d=0|_h(d|=0,A|=0,y|=0,C|=0,k=I))||(function(d,A){var y;m[(A|=0)>>2]=(0|m[(d|=0)>>2])-(y=0|m[d+8>>2]),m[A+4>>2]=(0|m[d+4>>2])-y}(k,S),d=0),me=I,0|d},_experimentalLocalIjToH3:function(d,A,y,C){var S,k;return d|=0,A|=0,C|=0,S=me,me=me+16|0,function(d,A){var k,I,O,y=0,C=0,S=0;m[(A|=0)>>2]=C=0|m[(d|=0)>>2],m[(I=A+4|0)>>2]=d=0|m[d+4>>2],m[(O=A+8|0)>>2]=0,y=d-C|0,(0|C)<0?(d=0-C|0,m[I>>2]=y,m[O>>2]=d,m[A>>2]=0,C=0):(y=d,d=0),(0|y)<0&&(m[A>>2]=C=C-y|0,m[O>>2]=d=d-y|0,m[I>>2]=0,y=0),k=C-d|0,S=y-d|0,(0|d)<0?(m[A>>2]=k,m[I>>2]=S,m[O>>2]=0,y=S,S=k,d=0):S=C,!((0|(C=(0|d)<(0|(C=(0|y)<(0|S)?y:S))?d:C))<=0)&&(m[A>>2]=S-C,m[I>>2]=y-C,m[O>>2]=d-C)}(y|=0,k=S),C=0|jk(d,A,k,C),me=S,0|C},_free:Ln,_geoToH3:Bk,_getDestinationH3IndexFromUnidirectionalEdge:function(d,A){d|=0;var C,y=0,S=0;return C=me,me=me+16|0,y=C,!0&268435456==(2013265920&(A|=0)|0)?(S=0|bt(0|d,0|A,56),De(),m[y>>2]=0,y=0|ho(d,-2130706433&A|134217728,7&S,y),A=0|De(),Mn(0|A),me=C,0|y):(y=0,Mn(0|(A=0)),me=C,0|y)},_getH3IndexesFromUnidirectionalEdge:function(d,A,y){d|=0;var C,S,k,I,O=0;k=me,me=me+16|0,C=k,S=-2130706433&(A|=0)|134217728,m[(O=y|=0)>>2]=(I=!0&268435456==(2013265920&A|0))?d:0,m[O+4>>2]=I?S:0,I?(A=0|bt(0|d,0|A,56),De(),m[C>>2]=0,d=0|ho(d,S,7&A,C),A=0|De()):(d=0,A=0),m[(O=y+8|0)>>2]=d,m[O+4>>2]=A,me=k},_getH3UnidirectionalEdge:function(d,A,y,C){var I,X,S=0,k=0,O=0,G=0,ee=0;if(X=me,me=me+16|0,I=X,!(0|zk(d|=0,A|=0,y|=0,C|=0)))return G=0,Mn(0|(O=0)),me=X,0|G;for(O=-2130706433&A,S=(S=0==(0|wo(d,A)))?1:2;m[I>>2]=0,k=S+1|0,!((0|(ee=0|ho(d,A,S,I)))==(0|y)&(0|De())==(0|C));){if(!(k>>>0<7)){S=0,d=0,G=6;break}S=k}return 6==(0|G)?(Mn(0|S),me=X,0|d):(ee=0|Ot(0|S,0,56),G=0|O|De()|268435456,ee|=d,Mn(0|G),me=X,0|ee)},_getH3UnidirectionalEdgeBoundary:vv,_getH3UnidirectionalEdgesFromHexagon:function(d,A,y){y|=0;var S,C=0;S=0==(0|wo(d|=0,A|=0)),A&=-2130706433,m[(C=y)>>2]=S?d:0,m[C+4>>2]=S?285212672|A:0,m[(C=y+8|0)>>2]=d,m[C+4>>2]=301989888|A,m[(C=y+16|0)>>2]=d,m[C+4>>2]=318767104|A,m[(C=y+24|0)>>2]=d,m[C+4>>2]=335544320|A,m[(C=y+32|0)>>2]=d,m[C+4>>2]=352321536|A,m[(y=y+40|0)>>2]=d,m[y+4>>2]=369098752|A},_getOriginH3IndexFromUnidirectionalEdge:function(d,A){var y;return d|=0,Mn(0|((y=!0&268435456==(2013265920&(A|=0)|0))?-2130706433&A|134217728:0)),0|(y?d:0)},_getPentagonIndexes:Kw,_getRes0Indexes:function(d){d|=0;var A=0,y=0,C=0;A=0;do{Ot(0|A,0,45),C=134225919|De(),m[(y=d+(A<<3)|0)>>2]=-1,m[y+4>>2]=C,A=A+1|0}while(122!=(0|A))},_h3Distance:function(d,A,y,C){var S,k,I;return y|=0,C|=0,I=me,me=me+32|0,k=I,d=0==(0|_h(d|=0,A|=0,d,A,S=I+12|0))&&0==(0|_h(d,A,y,C,k))?0|Zw(S,k):-1,me=I,0|d},_h3GetBaseCell:Ok,_h3GetFaces:function Nk(d,A,y){y|=0;var ye,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0;ye=me,me=me+128|0,X=ye+112|0,k=ye+96|0,ee=ye,S=0|bt(0|(d|=0),0|(A|=0),52),De(),m[X>>2]=O=15&S,I=0|bt(0|d,0|A,45),De(),I&=127;e:do{if(0|gi(I)){if(0|O)for(C=1;;){if(!(0==((G=0|Ot(7,0,3*(15-C|0)|0))&d|0)&0==((0|De())&A|0))){S=0;break e}if(!(C>>>0<O>>>0))break;C=C+1|0}if(!(1&S))return G=0|Ot(O+1|0,0,52),ee=0|De()|-15728641&A,Nk((G|d)&~(X=0|Ot(7,0,3*(14-O|0)|0)),ee&~(0|De()),y),void(me=ye);S=1}else S=0}while(0);x0(d,A,k),S?(Pk(k,X,ee),G=5):(Fk(k,X,ee),G=6);e:do{if(0|gi(I))if(O)for(C=1;;){if(!(0==((I=0|Ot(7,0,3*(15-C|0)|0))&d|0)&0==((0|De())&A|0))){C=8;break e}if(!(C>>>0<O>>>0)){C=20;break}C=C+1|0}else C=20;else C=8}while(0);if(oc(0|y,-1,0|C),S){S=0;do{for(Zj(k=ee+(S<<4)|0,0|m[X>>2]),k=0|m[k>>2],C=0;!(-1==(0|(O=0|m[(I=y+(C<<2)|0)>>2]))|(0|O)==(0|k));)C=C+1|0;m[I>>2]=k,S=S+1|0}while((0|S)!=(0|G))}else{S=0;do{for(em(k=ee+(S<<4)|0,0|m[X>>2],0,1),k=0|m[k>>2],C=0;!(-1==(0|(O=0|m[(I=y+(C<<2)|0)>>2]))|(0|O)==(0|k));)C=C+1|0;m[I>>2]=k,S=S+1|0}while((0|S)!=(0|G))}me=ye},_h3GetResolution:function(d,A){return A=0|bt(0|(d|=0),0|(A|=0),52),De(),15&A|0},_h3IndexesAreNeighbors:zk,_h3IsPentagon:wo,_h3IsResClassIII:function(d,A){return A=0|bt(0|(d|=0),0|(A|=0),52),De(),1&A|0},_h3IsValid:Lk,_h3Line:function(d,A,y,C,S){y|=0,C|=0,S|=0;var Nt,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,Lt=0,qe=0,gt=0,Ie=0,zt=0;if(Nt=me,me=me+48|0,I=Nt+12|0,Ie=Nt,0==(0|_h(d|=0,A|=0,d,A,k=Nt+24|0))&&0==(0|_h(d,A,y,C,I))){if((0|(gt=0|Zw(k,I)))<0)return me=Nt,0|gt;for(m[k>>2]=0,m[k+4>>2]=0,m[k+8>>2]=0,m[I>>2]=0,m[I+4>>2]=0,m[I+8>>2]=0,_h(d,A,d,A,k),_h(d,A,y,C,I),Ik(k),Ik(I),gt?(qe=k,y=ee=0|m[k>>2],C=ye=0|m[(Ct=k+4|0)>>2],k=Te=0|m[(Lt=k+8|0)>>2],Qe=+((0|m[I>>2])-ee|0)/(ze=+(0|gt)),Ke=+((0|m[I+4>>2])-ye|0)/ze,ze=+((0|m[I+8>>2])-Te|0)/ze):(Ct=C=k+4|0,Lt=Te=k+8|0,qe=k,y=0|m[k>>2],C=0|m[C>>2],k=0|m[Te>>2],Qe=0,Ke=0,ze=0),m[Ie>>2]=y,m[(Te=Ie+4|0)>>2]=C,m[(ye=Ie+8|0)>>2]=k,ee=0;;){zt=Qe*(G=+(0|ee))+ +(0|y),O=Ke*G+ +(0|m[Ct>>2]),G=ze*G+ +(0|m[Lt>>2]),C=~~+wv(+zt),I=~~+wv(+O),y=~~+wv(+G),zt=+nr(+(+(0|C)-zt)),O=+nr(+(+(0|I)-O)),G=+nr(+(+(0|y)-G));do{if(!(zt>O&zt>G)){if(X=0-C|0,O>G){k=X-y|0;break}k=I,y=X-I|0;break}C=0-(I+y)|0,k=I}while(0);if(m[Ie>>2]=C,m[Te>>2]=k,m[ye>>2]=y,Gj(Ie),jk(d,A,Ie,S+(ee<<3)|0),(0|ee)==(0|gt))break;ee=ee+1|0,y=0|m[qe>>2]}return me=Nt,0}return me=Nt,-1},_h3LineSize:function(d,A,y,C){var S,k,I;return y|=0,C|=0,I=me,me=me+32|0,k=I,d=0==(0|_h(d|=0,A|=0,d,A,S=I+12|0))&&0==(0|_h(d,A,y,C,k))?0|Zw(S,k):-1,me=I,(d>>>31^1)+d|0},_h3SetToLinkedGeo:function(d,A,y){y|=0;var C,S,k,I=0;if(k=me,me=me+32|0,C=k,function(d,A,y){d|=0,y|=0;var G,X,C=0,S=0,k=0,I=0,O=0;if(X=me,me=me+176|0,G=X,(0|(A|=0))<1)return qk(y,0,0),void(me=X);I=0|bt(0|m[(I=d)>>2],0|m[I+4>>2],52),De(),qk(y,(0|A)>6?A:6,15&I),I=0;do{if(rf(0|m[(C=d+(I<<3)|0)>>2],0|m[C+4>>2],G),(0|(C=0|m[G>>2]))>0){O=0;do{k=G+8+(O<<4)|0,(S=0|W7(y,C=G+8+(((0|(O=O+1|0))%(0|C)|0)<<4)|0,k))?Qk(y,S):Z7(y,k,C),C=0|m[G>>2]}while((0|O)<(0|C))}I=I+1|0}while((0|I)!=(0|A));me=X}(d|=0,A|=0,S=k+16|0),m[y>>2]=0,m[y+4>>2]=0,m[y+8>>2]=0,!(d=0|Wk(S)))return Vk(y),Zk(S),void(me=k);do{A=0|D7(y);do{S7(A,d),m[C>>2]=m[(I=d+16|0)>>2],m[C+4>>2]=m[I+4>>2],m[C+8>>2]=m[I+8>>2],m[C+12>>2]=m[I+12>>2],Qk(S,d),d=0|Q7(S,C)}while(0!=(0|d));d=0|Wk(S)}while(0!=(0|d));Vk(y),Zk(S),me=k},_h3ToCenterChild:function(d,A,y){y|=0;var C=0,S=0;if(C=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|y)<16&(0|(C&=15))<=(0|y)){if((0|C)!=(0|y)&&(d|=S=0|Ot(0|y,0,52),A=0|De()|-15728641&A,(0|C)<(0|y)))do{S=0|Ot(7,0,3*(14-C|0)|0),C=C+1|0,d&=~S,A&=~(0|De())}while((0|C)<(0|y))}else A=0,d=0;return Mn(0|A),0|d},_h3ToChildren:da,_h3ToGeo:nf,_h3ToGeoBoundary:rf,_h3ToParent:Ww,_h3UnidirectionalEdgeIsValid:function(d,A){var y=0;if(!(!0&268435456==(2013265920&(A|=0)|0)))return 0;switch(y=0|bt(0|(d|=0),0|A,56),De(),7&y){case 0:case 7:return 0}return!0&16777216==(117440512&A|0)&0!=(0|wo(d,y=-2130706433&A|134217728))?0|(y=0):0|(y=0|Lk(d,y))},_hexAreaKm2:function(d){return+ +pe[20496+((d|=0)<<3)>>3]},_hexAreaM2:function(d){return+ +pe[20624+((d|=0)<<3)>>3]},_hexRing:function(d,A,y,C){d|=0,A|=0,C|=0;var ye,S=0,k=0,I=0,O=0,G=0,X=0,ee=0;if(ye=me,me=me+16|0,ee=ye,!(y|=0))return m[(ee=C)>>2]=d,m[ee+4>>2]=A,me=ye,0;m[ee>>2]=0;e:do{if(0|wo(d,A))d=1;else{if(k=(0|y)>0){S=0,X=d;do{if(0==(0|(X=0|ho(X,A,4,ee)))&0==(0|(A=0|De()))){d=2;break e}if(S=S+1|0,0|wo(X,A)){d=1;break e}}while((0|S)<(0|y));if(m[(G=C)>>2]=X,m[G+4>>2]=A,G=y+-1|0,k){k=0,I=1,S=X,d=A;do{if(0==(0|(S=0|ho(S,d,2,ee)))&0==(0|(d=0|De()))){d=2;break e}if(m[(O=C+(I<<3)|0)>>2]=S,m[O+4>>2]=d,I=I+1|0,0|wo(S,d)){d=1;break e}k=k+1|0}while((0|k)<(0|y));O=0,k=I;do{if(0==(0|(S=0|ho(S,d,3,ee)))&0==(0|(d=0|De()))){d=2;break e}if(m[(I=C+(k<<3)|0)>>2]=S,m[I+4>>2]=d,k=k+1|0,0|wo(S,d)){d=1;break e}O=O+1|0}while((0|O)<(0|y));I=0;do{if(0==(0|(S=0|ho(S,d,1,ee)))&0==(0|(d=0|De()))){d=2;break e}if(m[(O=C+(k<<3)|0)>>2]=S,m[O+4>>2]=d,k=k+1|0,0|wo(S,d)){d=1;break e}I=I+1|0}while((0|I)<(0|y));I=0;do{if(0==(0|(S=0|ho(S,d,5,ee)))&0==(0|(d=0|De()))){d=2;break e}if(m[(O=C+(k<<3)|0)>>2]=S,m[O+4>>2]=d,k=k+1|0,0|wo(S,d)){d=1;break e}I=I+1|0}while((0|I)<(0|y));I=0;do{if(0==(0|(S=0|ho(S,d,4,ee)))&0==(0|(d=0|De()))){d=2;break e}if(m[(O=C+(k<<3)|0)>>2]=S,m[O+4>>2]=d,k=k+1|0,0|wo(S,d)){d=1;break e}I=I+1|0}while((0|I)<(0|y));for(I=0;;){if(0==(0|(S=0|ho(S,d,6,ee)))&0==(0|(d=0|De()))){d=2;break e}if((0|I)!=(0|G)){if(m[(O=C+(k<<3)|0)>>2]=S,m[O+4>>2]=d,0|wo(S,d)){d=1;break e}k=k+1|0}if((0|(I=I+1|0))>=(0|y)){I=X,k=A;break}}}else I=X,S=X,k=A,d=A}else m[(I=C)>>2]=d,m[I+4>>2]=A,I=d,S=d,k=A,d=A;d=1&((0|I)!=(0|S)|(0|k)!=(0|d))}}while(0);return me=ye,0|d},_i64Subtract:b0,_kRing:_k,_kRingDistances:function(d,A,y,C,S){var k=0;if(0|Vw(d|=0,A|=0,y|=0,C|=0,S|=0)){if(oc(0|C,0,(k=1+(0|gh(3*y|0,y+1|0))|0)<<3|0),0|S)return oc(0|S,0,k<<2|0),void au(d,A,y,C,S,k,0);(S=0|ic(k,4))&&(au(d,A,y,C,S,k,0),Ln(S))}},_llvm_minnum_f64:Yk,_llvm_round_f64:wv,_malloc:lu,_maxFaceCount:function(d,A){var y=0,C=0;if(C=0|bt(0|(d|=0),0|(A|=0),45),De(),!(0|gi(127&C)))return 2;if(C=0|bt(0|d,0|A,52),De(),!(C&=15))return 5;for(y=1;;){if(!(0==((0|Ot(7,0,3*(15-y|0)|0))&d|0)&0==((0|De())&A|0))){y=2,d=6;break}if(!(y>>>0<C>>>0)){y=5,d=6;break}y=y+1|0}return 6==(0|d)?0|y:0},_maxH3ToChildrenSize:function(d,A,y){return y|=0,d=0|bt(0|(d|=0),0|(A|=0),52),De(),(0|y)<16&(0|(d&=15))<=(0|y)?0|(y=0|xv(7,y-d|0)):0|(y=0)},_maxKringSize:function(d){return 1+(0|gh(3*(d|=0)|0,d+1|0))|0},_maxPolyfillSize:function(d,A){A|=0;var k,y=0,C=0,S=0,I=0,O=0;if(k=me,me=me+48|0,S=k+8|0,I=0|m[4+(O=d|=0)>>2],m[(y=C=k)>>2]=m[O>>2],m[y+4>>2]=I,Jw(C,S),S=0|$w(S,A),A=0|m[C>>2],(0|(C=0|m[d+8>>2]))<=0)return me=k,0|(O=(I=(0|S)<(0|(O=A)))?O:S)+12;y=0|m[d+12>>2],d=0;do{A=(0|m[y+(d<<3)>>2])+A|0,d=d+1|0}while((0|d)<(0|C));return me=k,0|(O=(O=(0|S)<(0|A))?A:S)+12},_maxUncompactSize:function(d,A,y){d|=0;var C=0,S=0,k=0,I=0;if((0|(A|=0))<=0)return 0;if((0|(y|=0))>=16){for(C=0;;){if(!(0==(0|m[(I=d+(C<<3)|0)>>2])&0==(0|m[I+4>>2]))){C=-1,S=13;break}if((0|(C=C+1|0))>=(0|A)){C=0,S=13;break}}if(13==(0|S))return 0|C}C=0,I=0;e:for(;;){k=0|m[(S=d+(I<<3)|0)>>2],S=0|m[S+4>>2];do{if(!(0==(0|k)&0==(0|S))){if(S=0|bt(0|k,0|S,52),De(),(0|(S&=15))>(0|y)){C=-1,S=13;break e}if((0|S)==(0|y)){C=C+1|0;break}C=(0|xv(7,y-S|0))+C|0;break}}while(0);if((0|(I=I+1|0))>=(0|A)){S=13;break}}return 13==(0|S)?0|C:0},_memcpy:Cv,_memset:oc,_numHexagons:function(d){var A;return d=0|m[(A=21008+((d|=0)<<3)|0)>>2],Mn(0|m[A+4>>2]),0|d},_pentagonIndexCount:function(){return 12},_pointDistKm:v0,_pointDistM:function(d,A){var C,S,k,y=0;return y=(k=+ar(.5*((S=+pe[(A|=0)>>3])-(C=+pe[(d|=0)>>3]))))*k+(y=+ar(.5*(+pe[A+8>>3]-+pe[d+8>>3])))*(+Qn(+S)*+Qn(+C)*y),2*+gl(+ +ki(+y),+ +ki(+(1-y)))*6371.007180918475*1e3},_pointDistRads:function(d,A){var C,S,k,y=0;return y=(k=+ar(.5*((S=+pe[(A|=0)>>3])-(C=+pe[(d|=0)>>3]))))*k+(y=+ar(.5*(+pe[A+8>>3]-+pe[d+8>>3])))*(+Qn(+S)*+Qn(+C)*y),2*+gl(+ +ki(+y),+ +ki(+(1-y)))},_polyfill:function(d,A,y){var O,C=0,S=0,k=0,I=0,G=0;if(O=me,me=me+48|0,C=O+8|0,S=O,0|function(d,A,y){A|=0,y|=0;var br,Hr,yr,ri,yn,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,Lt=0,qe=0,gt=0,Ie=0,Nt=0,zt=0,kt=0,Ft=0,In=0,Fr=0,ii=0;if(yn=me,me=me+112|0,Hr=yn+80|0,G=yn+72|0,yr=yn,ri=yn+56|0,(ii=0|lu(32+(m[(X=8+(d|=0)|0)>>2]<<5)|0))||Rr(22848,22448,800,22456),function(d,A){A|=0;var y=0,C=0,S=0,k=0,I=0,O=0,G=0,X=0,ee=0,ye=0,Te=0,ze=0,Qe=0,Ke=0,Ct=0,Lt=0,qe=0,gt=0,Ie=0,Nt=0,zt=0,kt=0;if(Qe=0|m[(d|=0)>>2]){if(pe[(Ke=A+8|0)>>3]=17976931348623157e292,pe[(Ct=A+24|0)>>3]=17976931348623157e292,pe[A>>3]=-17976931348623157e292,pe[(Lt=A+16|0)>>3]=-17976931348623157e292,(0|Qe)>0){for(S=0|m[d+4>>2],Te=17976931348623157e292,ze=-17976931348623157e292,C=0,y=-1,G=17976931348623157e292,X=17976931348623157e292,ye=-17976931348623157e292,I=-17976931348623157e292,qe=0;ee=+pe[S+(qe<<4)+8>>3],O=+pe[S+(((0|(zt=y+2|0))==(0|Qe)?0:zt)<<4)+8>>3],(k=+pe[S+(qe<<4)>>3])<G&&(pe[Ke>>3]=k,G=k),ee<X&&(pe[Ct>>3]=ee,X=ee),k>ye?pe[A>>3]=k:k=ye,ee>I&&(pe[Lt>>3]=ee,I=ee),Te=ee>0&ee<Te?ee:Te,ze=ee<0&ee>ze?ee:ze,C|=+nr(+(ee-O))>3.141592653589793,(0|(y=qe+1|0))!=(0|Qe);)zt=qe,ye=k,qe=y,y=zt;C&&(pe[Lt>>3]=ze,pe[Ct>>3]=Te)}}else m[A>>2]=0,m[A+4>>2]=0,m[A+8>>2]=0,m[A+12>>2]=0,m[A+16>>2]=0,m[A+20>>2]=0,m[A+24>>2]=0,m[A+28>>2]=0;if(!((0|(y=0|m[(zt=d+8|0)>>2]))<=0)){Nt=d+12|0,Ie=0;do{if(C=Ie,Ct=A+((Ie=Ie+1|0)<<5)|0,Lt=0|m[(S=0|m[Nt>>2])+(C<<3)>>2]){if(pe[(qe=A+(Ie<<5)+8|0)>>3]=17976931348623157e292,pe[(d=A+(Ie<<5)+24|0)>>3]=17976931348623157e292,pe[Ct>>3]=-17976931348623157e292,pe[(gt=A+(Ie<<5)+16|0)>>3]=-17976931348623157e292,(0|Lt)>0){for(Qe=0|m[S+(C<<3)+4>>2],Te=17976931348623157e292,ze=-17976931348623157e292,S=0,C=-1,Ke=0,G=17976931348623157e292,X=17976931348623157e292,ee=-17976931348623157e292,I=-17976931348623157e292;ye=+pe[Qe+(Ke<<4)+8>>3],O=+pe[Qe+(((0|(C=C+2|0))==(0|Lt)?0:C)<<4)+8>>3],(k=+pe[Qe+(Ke<<4)>>3])<G&&(pe[qe>>3]=k,G=k),ye<X&&(pe[d>>3]=ye,X=ye),k>ee?pe[Ct>>3]=k:k=ee,ye>I&&(pe[gt>>3]=ye,I=ye),Te=ye>0&ye<Te?ye:Te,ze=ye<0&ye>ze?ye:ze,S|=+nr(+(ye-O))>3.141592653589793,(0|(C=Ke+1|0))!=(0|Lt);)kt=Ke,Ke=C,ee=k,C=kt;S&&(pe[gt>>3]=ze,pe[d>>3]=Te)}}else m[Ct>>2]=0,m[Ct+4>>2]=0,m[Ct+8>>2]=0,m[Ct+12>>2]=0,m[Ct+16>>2]=0,m[Ct+20>>2]=0,m[Ct+24>>2]=0,m[Ct+28>>2]=0,y=0|m[zt>>2]}while((0|Ie)<(0|y))}}(d,ii),C=0|m[(k=d)+4>>2],m[(O=G)>>2]=m[k>>2],m[O+4>>2]=C,Jw(G,Hr),O=0|$w(Hr,A),C=0|m[G>>2],(0|(k=0|m[X>>2]))>0){I=0|m[d+12>>2],S=0;do{C=(0|m[I+(S<<3)>>2])+C|0,S=S+1|0}while((0|S)!=(0|k))}if(S=0|ic(br=(O=(0|O)<(0|C)?C:O)+12|0,8),ee=0|ic(br,8),m[Hr>>2]=0,Fr=0|m[(In=d)+4>>2],m[(C=G)>>2]=m[In>>2],m[C+4>>2]=Fr,0|(C=0|yk(G,br,A,Hr,S,ee)))return Ln(S),Ln(ee),Ln(ii),me=yn,0|C;e:do{if((0|m[X>>2])>0){for(k=d+12|0,C=0;I=0|yk((0|m[k>>2])+(C<<3)|0,br,A,Hr,S,ee),C=C+1|0,!(0|I);)if((0|C)>=(0|m[X>>2]))break e;return Ln(S),Ln(ee),Ln(ii),me=yn,0|I}}while(0);(0|O)>-12&&oc(0|ee,0,((0|br)>1?br:1)<<3|0);e:do{if((0|m[Hr>>2])>0){Fr=((0|br)<0)<<31>>31,Ie=S,Nt=ee,zt=S,kt=S,Ft=ee,In=S,C=S,Ct=S,Lt=ee,qe=ee,gt=ee,S=ee;t:for(;;){for(Ke=0|m[Hr>>2],ze=0,Qe=0,k=0;;){O=(I=yr)+56|0;do{m[I>>2]=0,I=I+4|0}while((0|I)<(0|O));if(0|Vw(G=0|m[(A=Ie+(ze<<3)|0)>>2],A=0|m[A+4>>2],1,yr,0)){O=(I=yr)+56|0;do{m[I>>2]=0,I=I+4|0}while((0|I)<(0|O));0|(I=0|ic(7,4))&&(au(G,A,1,yr,I,7,0),Ln(I))}Te=0;do{ee=0|m[(ye=yr+(Te<<3)|0)>>2],ye=0|m[ye+4>>2];n:do{if(!(0==(0|ee)&0==(0|ye))){if(G=0|yd(0|ee,0|ye,0|br,0|Fr),De(),!(0==(0|(A=0|m[(O=I=y+(G<<3)|0)>>2]))&0==(0|(O=0|m[O+4>>2]))))for(X=0;;){if((0|X)>(0|br))break t;if((0|A)==(0|ee)&(0|O)==(0|ye))break n;if(0==(0|(A=0|m[(O=I=y+((G=(G+1|0)%(0|br)|0)<<3)|0)>>2]))&0==(0|(O=0|m[O+4>>2])))break;X=X+1|0}0==(0|ee)&0==(0|ye)||(nf(ee,ye,ri),0|O7(d,ii,ri)&&(m[(X=I)>>2]=ee,m[X+4>>2]=ye,m[(X=Nt+(k<<3)|0)>>2]=ee,m[X+4>>2]=ye,k=k+1|0))}}while(0);Te=Te+1|0}while(Te>>>0<7);if((0|(Qe=Qe+1|0))>=(0|Ke))break;ze=ze+1|0}if((0|Ke)>0&&oc(0|zt,0,Ke<<3|0),m[Hr>>2]=k,!((0|k)>0))break e;ee=S,ye=gt,Te=In,ze=qe,Qe=Lt,Ke=Nt,S=Ct,gt=C,qe=kt,Lt=zt,Ct=ee,C=ye,In=Ft,Ft=Te,kt=ze,zt=Qe,Nt=Ie,Ie=Ke}return Ln(kt),Ln(Ft),Ln(ii),me=yn,-1}C=ee}while(0);return Ln(ii),Ln(S),Ln(C),me=yn,0}(d|=0,A|=0,y|=0)){if(k=0|m[(G=d)+4>>2],m[(I=S)>>2]=m[G>>2],m[I+4>>2]=k,Jw(S,C),I=0|$w(C,A),A=0|m[S>>2],(0|(k=0|m[d+8>>2]))>0){S=0|m[d+12>>2],C=0;do{A=(0|m[S+(C<<3)>>2])+A|0,C=C+1|0}while((0|C)!=(0|k))}(0|(A=(0|I)<(0|A)?A:I))<=-12||oc(0|y,0,8+(((0|(G=A+11|0))>0?G:0)<<3)|0),me=O}else me=O},_res0IndexCount:function(){return 122},_round:Kk,_sbrk:vd,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(d,A,y,C,S){d|=0,y|=0,C|=0;var k=0,I=0,O=0,G=0,X=0,ee=0;if((0|(A|=0))<=0)return 0;if((0|(S|=0))>=16){for(k=0;;){if(!(0==(0|m[(ee=d+(k<<3)|0)>>2])&0==(0|m[ee+4>>2]))){k=14;break}if((0|(k=k+1|0))>=(0|A)){I=0,k=16;break}}if(14==(0|k))return 0|((0|C)>0?-2:-1);if(16==(0|k))return 0|I}k=0,ee=0;e:for(;;){I=0|m[(O=X=d+(ee<<3)|0)>>2],O=0|m[O+4>>2];do{if(!(0==(0|I)&0==(0|O))){if((0|k)>=(0|C)){I=-1,k=16;break e}if(G=0|bt(0|I,0|O,52),De(),(0|(G&=15))>(0|S)){I=-2,k=16;break e}if((0|G)==(0|S)){m[(X=y+(k<<3)|0)>>2]=I,m[X+4>>2]=O,k=k+1|0;break}if((0|(I=(0|xv(7,S-G|0))+k|0))>(0|C)){I=-1,k=16;break e}da(0|m[X>>2],0|m[X+4>>2],S,y+(k<<3)|0),k=I}}while(0);if((0|(ee=ee+1|0))>=(0|A)){I=0,k=16;break}}return 16==(0|k)?0|I:0},establishStackSpace:function(d,A){me=d|=0},stackAlloc:function(d){var A;return A=me,me=15+(me=me+(d|=0)|0)&-16,0|A},stackRestore:function(d){me=d|=0},stackSave:function(){return 0|me}}}({Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},{a:YA,b:function(je){U=je},c:K,d:function(je,lt,It,rn){YA("Assertion failed: "+$o(je)+", at: "+[lt?$o(lt):"unknown filename",It,rn?$o(rn):"unknown function"])},e:function(je){return e.___errno_location&&(pd[e.___errno_location()>>2]=je),je},f:hk,g:function(je,lt,It){su.set(su.subarray(lt,lt+It),je)},h:function(je){var lt=hk(),rn=2130706432;if(je>rn)return!1;for(var $r=Math.max(lt,16777216);$r<je;)$r=$r<=536870912?Kp(2*$r,16777216):Math.min(Kp((3*$r+2147483648)/4,16777216),rn);return!!dk($r)},i:function(je){YA("OOM")},j:function(je){return je},k:ck,l:dk,m:uk,n:function(){var je=uk();return e.extraStackTrace&&(je+="\n"+e.extraStackTrace()),ck(je)},o:24032,p:24016},ou),uj=(e.___uremdi3=Tt.___uremdi3,e._bitshift64Lshr=Tt._bitshift64Lshr,e._bitshift64Shl=Tt._bitshift64Shl,e._calloc=Tt._calloc,e._cellAreaKm2=Tt._cellAreaKm2,e._cellAreaM2=Tt._cellAreaM2,e._cellAreaRads2=Tt._cellAreaRads2,e._compact=Tt._compact,e._destroyLinkedPolygon=Tt._destroyLinkedPolygon,e._edgeLengthKm=Tt._edgeLengthKm,e._edgeLengthM=Tt._edgeLengthM,e._emscripten_replace_memory=Tt._emscripten_replace_memory),Ak=(e._exactEdgeLengthKm=Tt._exactEdgeLengthKm,e._exactEdgeLengthM=Tt._exactEdgeLengthM,e._exactEdgeLengthRads=Tt._exactEdgeLengthRads,e._experimentalH3ToLocalIj=Tt._experimentalH3ToLocalIj,e._experimentalLocalIjToH3=Tt._experimentalLocalIjToH3,e._free=Tt._free,e._geoToH3=Tt._geoToH3,e._getDestinationH3IndexFromUnidirectionalEdge=Tt._getDestinationH3IndexFromUnidirectionalEdge,e._getH3IndexesFromUnidirectionalEdge=Tt._getH3IndexesFromUnidirectionalEdge,e._getH3UnidirectionalEdge=Tt._getH3UnidirectionalEdge,e._getH3UnidirectionalEdgeBoundary=Tt._getH3UnidirectionalEdgeBoundary,e._getH3UnidirectionalEdgesFromHexagon=Tt._getH3UnidirectionalEdgesFromHexagon,e._getOriginH3IndexFromUnidirectionalEdge=Tt._getOriginH3IndexFromUnidirectionalEdge,e._getPentagonIndexes=Tt._getPentagonIndexes,e._getRes0Indexes=Tt._getRes0Indexes,e._h3Distance=Tt._h3Distance,e._h3GetBaseCell=Tt._h3GetBaseCell,e._h3GetFaces=Tt._h3GetFaces,e._h3GetResolution=Tt._h3GetResolution,e._h3IndexesAreNeighbors=Tt._h3IndexesAreNeighbors,e._h3IsPentagon=Tt._h3IsPentagon,e._h3IsResClassIII=Tt._h3IsResClassIII,e._h3IsValid=Tt._h3IsValid,e._h3Line=Tt._h3Line,e._h3LineSize=Tt._h3LineSize,e._h3SetToLinkedGeo=Tt._h3SetToLinkedGeo,e._h3ToCenterChild=Tt._h3ToCenterChild,e._h3ToChildren=Tt._h3ToChildren,e._h3ToGeo=Tt._h3ToGeo,e._h3ToGeoBoundary=Tt._h3ToGeoBoundary,e._h3ToParent=Tt._h3ToParent,e._h3UnidirectionalEdgeIsValid=Tt._h3UnidirectionalEdgeIsValid,e._hexAreaKm2=Tt._hexAreaKm2,e._hexAreaM2=Tt._hexAreaM2,e._hexRing=Tt._hexRing,e._i64Subtract=Tt._i64Subtract,e._kRing=Tt._kRing,e._kRingDistances=Tt._kRingDistances,e._llvm_minnum_f64=Tt._llvm_minnum_f64,e._llvm_round_f64=Tt._llvm_round_f64,e._malloc=Tt._malloc,e._maxFaceCount=Tt._maxFaceCount,e._maxH3ToChildrenSize=Tt._maxH3ToChildrenSize,e._maxKringSize=Tt._maxKringSize,e._maxPolyfillSize=Tt._maxPolyfillSize,e._maxUncompactSize=Tt._maxUncompactSize,e._memcpy=Tt._memcpy,e._memset=Tt._memset,e._numHexagons=Tt._numHexagons,e._pentagonIndexCount=Tt._pentagonIndexCount,e._pointDistKm=Tt._pointDistKm,e._pointDistM=Tt._pointDistM,e._pointDistRads=Tt._pointDistRads,e._polyfill=Tt._polyfill,e._res0IndexCount=Tt._res0IndexCount,e._round=Tt._round,e._sbrk=Tt._sbrk,e._sizeOfCoordIJ=Tt._sizeOfCoordIJ,e._sizeOfGeoBoundary=Tt._sizeOfGeoBoundary,e._sizeOfGeoCoord=Tt._sizeOfGeoCoord,e._sizeOfGeoPolygon=Tt._sizeOfGeoPolygon,e._sizeOfGeofence=Tt._sizeOfGeofence,e._sizeOfH3Index=Tt._sizeOfH3Index,e._sizeOfLinkedGeoPolygon=Tt._sizeOfLinkedGeoPolygon,e._uncompact=Tt._uncompact,e.establishStackSpace=Tt.establishStackSpace,e.stackAlloc=Tt.stackAlloc),hj=e.stackRestore=Tt.stackRestore,dj=e.stackSave=Tt.stackSave;if(e.asm=Tt,e.cwrap=function(je,lt,It,rn){var m=(It=It||[]).every(function(Cr){return"number"===Cr});return"string"!==lt&&m&&!rn?He(je):function(){return Rt(je,lt,It,arguments)}},e.setValue=function(je,lt,It,rn){switch("*"===(It=It||"i8").charAt(It.length-1)&&(It="i32"),It){case"i1":case"i8":ml[je>>0]=lt;break;case"i16":QA[je>>1]=lt;break;case"i32":pd[je>>2]=lt;break;case"i64":Ow=[lt>>>0,(Jp=lt,+ZU(Jp)>=1?Jp>0?(0|XU(+QU(Jp/4294967296),4294967295))>>>0:~~+WU((Jp-+(~~Jp>>>0))/4294967296)>>>0:0)],pd[je>>2]=Ow[0],pd[je+4>>2]=Ow[1];break;case"float":kw[je>>2]=lt;break;case"double":Pw[je>>3]=lt;break;default:YA("invalid type for setValue: "+It)}},e.getValue=function(je,lt,It){switch("*"===(lt=lt||"i8").charAt(lt.length-1)&&(lt="i32"),lt){case"i1":case"i8":return ml[je>>0];case"i16":return QA[je>>1];case"i32":case"i64":return pd[je>>2];case"float":return kw[je>>2];case"double":return Pw[je>>3];default:YA("invalid type for getValue: "+lt)}return null},e.getTempRet0=K,ph){ak(ph)||(je=ph,ph=e.locateFile?e.locateFile(je,c):c+je),XA++,e.monitorRunDependencies&&e.monitorRunDependencies(XA);var Bw=function(je){je.byteLength&&(je=new Uint8Array(je)),su.set(je,8),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,function(je){if(XA--,e.monitorRunDependencies&&e.monitorRunDependencies(XA),0==XA&&(null!==Rw&&(clearInterval(Rw),Rw=null),g0)){var lt=g0;g0=null,lt()}}()},fk=function(){w(ph,Bw,function(){throw"could not load memory initializer "+ph})},pk=Lw(ph);if(pk)Bw(pk.buffer);else if(e.memoryInitializerRequest){var mk=function(){var je=e.memoryInitializerRequest,lt=je.response;if(200!==je.status&&0!==je.status){var It=Lw(e.memoryInitializerRequestURL);if(!It)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+je.status+", retrying "+ph),void fk();lt=It.buffer}Bw(lt)};e.memoryInitializerRequest.response?setTimeout(mk,0):e.memoryInitializerRequest.addEventListener("load",mk)}else fk()}function Nw(je){function lt(){pv||(pv=!0,!Re&&(fv(zU),fv(VU),e.onRuntimeInitialized&&e.onRuntimeInitialized(),function(){if(e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)je=e.postRun.shift(),sk.unshift(je);var je;fv(sk)}()))}je=je||o,XA>0||(function(){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)je=e.preRun.shift(),ok.unshift(je);var je;fv(ok)}(),XA>0)||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),lt()},1)):lt())}function YA(je){throw e.onAbort&&e.onAbort(je),T(je+=""),L(je),Re=!0,"abort("+je+"). Build with -s ASSERTIONS=1 for more info."}if(g0=function je(){pv||Nw(),pv||(g0=je)},e.run=Nw,e.abort=YA,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Nw(),n}("object"==typeof mt?mt:{}),tn="number",Vt={};[["sizeOfH3Index",tn],["sizeOfGeoCoord",tn],["sizeOfGeoBoundary",tn],["sizeOfGeoPolygon",tn],["sizeOfGeofence",tn],["sizeOfLinkedGeoPolygon",tn],["sizeOfCoordIJ",tn],["h3IsValid",tn,[tn,tn]],["geoToH3",tn,[tn,tn,tn]],["h3ToGeo",null,[tn,tn,tn]],["h3ToGeoBoundary",null,[tn,tn,tn]],["maxKringSize",tn,[tn]],["kRing",null,[tn,tn,tn,tn]],["kRingDistances",null,[tn,tn,tn,tn,tn]],["hexRing",null,[tn,tn,tn,tn]],["maxPolyfillSize",tn,[tn,tn]],["polyfill",null,[tn,tn,tn]],["h3SetToLinkedGeo",null,[tn,tn,tn]],["destroyLinkedPolygon",null,[tn]],["compact",tn,[tn,tn,tn]],["uncompact",tn,[tn,tn,tn,tn,tn]],["maxUncompactSize",tn,[tn,tn,tn]],["h3IsPentagon",tn,[tn,tn]],["h3IsResClassIII",tn,[tn,tn]],["h3GetBaseCell",tn,[tn,tn]],["h3GetResolution",tn,[tn,tn]],["maxFaceCount",tn,[tn,tn]],["h3GetFaces",null,[tn,tn,tn]],["h3ToParent",tn,[tn,tn,tn]],["h3ToChildren",null,[tn,tn,tn,tn]],["h3ToCenterChild",tn,[tn,tn,tn]],["maxH3ToChildrenSize",tn,[tn,tn,tn]],["h3IndexesAreNeighbors",tn,[tn,tn,tn,tn]],["getH3UnidirectionalEdge",tn,[tn,tn,tn,tn]],["getOriginH3IndexFromUnidirectionalEdge",tn,[tn,tn]],["getDestinationH3IndexFromUnidirectionalEdge",tn,[tn,tn]],["h3UnidirectionalEdgeIsValid",tn,[tn,tn]],["getH3IndexesFromUnidirectionalEdge",null,[tn,tn,tn]],["getH3UnidirectionalEdgesFromHexagon",null,[tn,tn,tn]],["getH3UnidirectionalEdgeBoundary",null,[tn,tn,tn]],["h3Distance",tn,[tn,tn,tn,tn]],["h3Line",tn,[tn,tn,tn,tn,tn]],["h3LineSize",tn,[tn,tn,tn,tn]],["experimentalH3ToLocalIj",tn,[tn,tn,tn,tn,tn]],["experimentalLocalIjToH3",tn,[tn,tn,tn,tn]],["hexAreaM2",tn,[tn]],["hexAreaKm2",tn,[tn]],["edgeLengthM",tn,[tn]],["edgeLengthKm",tn,[tn]],["pointDistM",tn,[tn,tn]],["pointDistKm",tn,[tn,tn]],["pointDistRads",tn,[tn,tn]],["cellAreaM2",tn,[tn,tn]],["cellAreaKm2",tn,[tn,tn]],["cellAreaRads2",tn,[tn,tn]],["exactEdgeLengthM",tn,[tn,tn]],["exactEdgeLengthKm",tn,[tn,tn]],["exactEdgeLengthRads",tn,[tn,tn]],["numHexagons",tn,[tn]],["getRes0Indexes",null,[tn]],["res0IndexCount",tn],["getPentagonIndexes",null,[tn,tn]],["pentagonIndexCount",tn]].forEach(function(e){Vt[e[0]]=mt.cwrap.apply(mt,e)}),Vt.sizeOfH3Index(),Vt.sizeOfGeoCoord();var $T=Vt.sizeOfGeoBoundary();Vt.sizeOfGeoPolygon(),Vt.sizeOfGeofence(),Vt.sizeOfLinkedGeoPolygon(),Vt.sizeOfCoordIJ();var A6=/[^0-9a-fA-F]/;function rv(n){return function(n){return 180*n/Math.PI}(mt.getValue(n,"double"))}function aw(n){return[rv(n),rv(n+8)]}function KT(n){return[rv(n+8),rv(n)]}let eI=(()=>{class n{constructor(){}getGeojsonForHex(t){return{type:"Polygon",coordinates:[function(n,e){var t=mt._malloc($T),r=function(n){if(Array.isArray(n)&&2===n.length&&Number.isInteger(n[0])&&Number.isInteger(n[1]))return n;if("string"!=typeof n||A6.test(n))return[0,0];var e=parseInt(n.substring(0,n.length-8),16);return[parseInt(n.substring(n.length-8),16),e]}(n);Vt.h3ToGeoBoundary(r[0],r[1],t);var p=function(n,e,t){for(var r=mt.getValue(n,"i32"),o=n+8,c=[],p=e?KT:aw,w=0;w<2*r;w+=2)c.push(p(o+8*w));return t&&c.push(c[0]),c}(t,true,true);return mt._free(t),p}(t).map(c=>c)]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=$t({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),tI=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(at(oh),at(Wi))},n.\u0275dir=Xt({type:n}),n})(),qA=(()=>{class n extends tI{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Xt({type:n,features:[li]}),n})();const iu=new nn("NgValueAccessor"),E6={provide:iu,useExisting:Hn(()=>cw),multi:!0},S6=new nn("CompositionEventMode");let cw=(()=>{class n extends tI{constructor(t,r,o){super(t,r),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const n=Jc()?Jc().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(at(oh),at(Wi),at(S6,8))},n.\u0275dir=Xt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,r){1&t&&qi("input",function(c){return r._handleInput(c.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(c){return r._compositionEnd(c.target.value)})},features:[ci([E6]),li]}),n})();const ds=new nn("NgValidators"),ud=new nn("NgAsyncValidators");function dI(n){return null!=n}function AI(n){const e=xg(n)?Lr(n):n;return F_(e),e}function fI(n){let e={};return n.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function pI(n,e){return e.map(t=>t(n))}function mI(n){return n.map(e=>function(n){return!n.validate}(e)?e:t=>e.validate(t))}function uw(n){return null!=n?function(n){if(!n)return null;const e=n.filter(dI);return 0==e.length?null:function(t){return fI(pI(t,e))}}(mI(n)):null}function hw(n){return null!=n?function(n){if(!n)return null;const e=n.filter(dI);return 0==e.length?null:function(t){return TT(pI(t,e).map(AI)).pipe(An(fI))}}(mI(n)):null}function yI(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function dw(n){return n?Array.isArray(n)?n:[n]:[]}function iv(n,e){return Array.isArray(n)?n.includes(e):n===e}function bI(n,e){const t=dw(e);return dw(n).forEach(o=>{iv(t,o)||t.push(o)}),t}function wI(n,e){return dw(e).filter(t=>!iv(n,t))}let CI=(()=>{class n{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=uw(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=hw(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,r){return!!this.control&&this.control.hasError(t,r)}getError(t,r){return this.control?this.control.getError(t,r):null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Xt({type:n}),n})(),Vs=(()=>{class n extends CI{get formDirective(){return null}get path(){return null}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Xt({type:n,features:[li]}),n})();class dd extends CI{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let DI=(()=>{class n extends class{constructor(e){this._cd=e}is(e){var t,r,o;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(o=null===(r=this._cd)||void 0===r?void 0:r.control)||void 0===o?void 0:o[e])}}{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(at(dd,2))},n.\u0275dir=Xt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,r){2&t&&bg("ng-untouched",r.is("untouched"))("ng-touched",r.is("touched"))("ng-pristine",r.is("pristine"))("ng-dirty",r.is("dirty"))("ng-valid",r.is("valid"))("ng-invalid",r.is("invalid"))("ng-pending",r.is("pending"))},features:[li]}),n})();function A0(n,e){(function(n,e){const t=function(n){return n._rawValidators}(n);null!==e.validator?n.setValidators(yI(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const r=function(n){return n._rawAsyncValidators}(n);null!==e.asyncValidator?n.setAsyncValidators(yI(r,e.asyncValidator)):"function"==typeof r&&n.setAsyncValidators([r]);const o=()=>n.updateValueAndValidity();lv(e._rawValidators,o),lv(e._rawAsyncValidators,o)})(n,e),e.valueAccessor.writeValue(n.value),function(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&SI(n,e)})}(n,e),function(n,e){const t=(r,o)=>{e.valueAccessor.writeValue(r),o&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&SI(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function(n,e){if(e.valueAccessor.setDisabledState){const t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function lv(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function SI(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function uv(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const f0="VALID",hv="INVALID",Yp="PENDING",p0="DISABLED";function _w(n){return(vw(n)?n.validators:n)||null}function II(n){return Array.isArray(n)?uw(n):n||null}function yw(n,e){return(vw(e)?e.asyncValidators:n)||null}function kI(n){return Array.isArray(n)?hw(n):n||null}function vw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class xw{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=II(this._rawValidators),this._composedAsyncValidatorFn=kI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===f0}get invalid(){return this.status===hv}get pending(){return this.status==Yp}get disabled(){return this.status===p0}get enabled(){return this.status!==p0}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=II(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=kI(e)}addValidators(e){this.setValidators(bI(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(bI(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(wI(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(wI(e,this._rawAsyncValidators))}hasValidator(e){return iv(this._rawValidators,e)}hasAsyncValidator(e){return iv(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Yp,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=p0,this.errors=null,this._forEachChild(r=>{r.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=f0,this._forEachChild(r=>{r.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===f0||this.status===Yp)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?p0:f0}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Yp,this._hasOwnPendingAsyncValidator=!0;const t=AI(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(n,e,t){if(null==e||(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length))return null;let r=n;return e.forEach(o=>{r=r instanceof bw?r.controls.hasOwnProperty(o)?r.controls[o]:null:r instanceof j6&&r.at(o)||null}),r}(this,e)}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new tt,this.statusChanges=new tt}_calculateStatus(){return this._allControlsDisabled()?p0:this.errors?hv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Yp)?Yp:this._anyControlsHaveStatus(hv)?hv:f0}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){vw(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class dv extends xw{constructor(e=null,t,r){super(_w(t),yw(r,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){uv(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){uv(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class bw extends xw{constructor(e,t,r){super(_w(t),yw(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,o)=>{r.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t instanceof dv?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const r=this.controls[t];if(this.contains(t)&&e(r))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,r)=>((t.enabled||this.disabled)&&(e[r]=t.value),e))}_reduceChildren(e,t){let r=e;return this._forEachChild((o,c)=>{r=t(r,o,c)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class j6 extends xw{constructor(e,t,r){super(_w(t),yw(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((r,o)=>{this._throwIfControlMissing(o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,o)=>{r.reset(e[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof dv?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const H6={provide:dd,useExisting:Hn(()=>Cw)},FI=(()=>Promise.resolve(null))();let Cw=(()=>{class n extends dd{constructor(t,r,o,c){super(),this.control=new dv,this._registered=!1,this.update=new tt,this._parent=t,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=function(n,e){if(!e)return null;let t,r,o;return Array.isArray(e),e.forEach(c=>{c.constructor===cw?t=c:function(n){return Object.getPrototypeOf(n.constructor)===qA}(c)?r=c:o=c}),o||r||t||null}(0,c)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?function(n,e){return[...e.path,n]}(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){A0(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){FI.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const r=t.isDisabled.currentValue,o=""===r||r&&"false"!==r;FI.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable()})}}return n.\u0275fac=function(t){return new(t||n)(at(Vs,9),at(ds,10),at(ud,10),at(iu,10))},n.\u0275dir=Xt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ci([H6]),li,Dr]}),n})(),LI=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({}),n})();const Ew=new nn("NgModelWithFormControlWarning"),nU={provide:iu,useExisting:Hn(()=>Av),multi:!0};function jI(n,e){return null==n?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let Av=(()=>{class n extends qA{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const r=this._getOptionId(t);null==r&&this.setProperty("selectedIndex",-1);const o=jI(r,t);this.setProperty("value",o)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){const r=function(n){return n.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r):t}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Xt({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,r){1&t&&qi("change",function(c){return r.onChange(c.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[ci([nU]),li]}),n})(),GI=(()=>{class n{constructor(t,r,o){this._element=t,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(jI(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(at(Wi),at(oh),at(Av,9))},n.\u0275dir=Xt({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})();const iU={provide:iu,useExisting:Hn(()=>Tw),multi:!0};function $I(n,e){return null==n?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let Tw=(()=>{class n extends qA{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let r;if(this.value=t,Array.isArray(t)){const o=t.map(c=>this._getOptionId(c));r=(c,p)=>{c._setSelected(o.indexOf(p.toString())>-1)}}else r=(o,c)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{const o=[];if(void 0!==r.selectedOptions){const c=r.selectedOptions;for(let p=0;p<c.length;p++){const w=c.item(p),T=this._getOptionValue(w.value);o.push(T)}}else{const c=r.options;for(let p=0;p<c.length;p++){const w=c.item(p);if(w.selected){const T=this._getOptionValue(w.value);o.push(T)}}}this.value=o,t(o)}}_registerOption(t){const r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){const r=function(n){return n.split(":")[0]}(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Tn(n)))(r||n)}}(),n.\u0275dir=Xt({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,r){1&t&&qi("change",function(c){return r.onChange(c.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[ci([iU]),li]}),n})(),HI=(()=>{class n{constructor(t,r,o){this._element=t,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue($I(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue($I(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(at(Wi),at(oh),at(Tw,9))},n.\u0275dir=Xt({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})(),tk=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({imports:[[LI]]}),n})(),fU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({imports:[tk]}),n})(),pU=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Ew,useValue:t.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n}),n.\u0275inj=mr({imports:[tk]}),n})();function mU(n,e){if(1&n&&(Ht(0,"option",24),Wr(1),qt()),2&n){const t=e.$implicit,r=Zi(3);or("ngValue",t.id),Fn(1),q1(" ",t.name," (",r.formatBytes(t.sizeBytes),") ")}}function gU(n,e){if(1&n&&(Ht(0,"optgroup",23),jo(1,mU,2,3,"option",11),qt()),2&n){const t=e.$implicit,r=Zi(2);or("label",t),Fn(1),or("ngForOf",r.getCitiesForGroup(t))}}function _U(n,e){if(1&n){const t=xp();Ht(0,"div",7),Ht(1,"span",8),Wr(2,"City"),qt(),Ht(3,"div",9),Ht(4,"select",10),qi("ngModelChange",function(o){return el(t),Zi().currentCityId=o})("ngModelChange",function(){return el(t),Zi().onCitySelect()}),Ht(5,"option",21),Wr(6),qt(),jo(7,gU,2,2,"optgroup",22),qt(),qt(),qt()}if(2&n){const t=Zi();Fn(4),O_("width",8+t.currentCity.name.length,"ch"),or("ngModel",t.currentCityId),Fn(1),or("ngValue",t.currentCityId),Fn(1),ll(" ",t.currentCity.name," "),Fn(1),or("ngForOf",t.cityGroups)}}function yU(n,e){if(1&n&&(Ht(0,"option",24),Wr(1),qt()),2&n){const t=e.$implicit;or("ngValue",t.id),Fn(1),ll(" ",t.name," ")}}function vU(n,e){if(1&n){const t=xp();Ht(0,"div",7),Ht(1,"span",8),Wr(2,"Classifier"),qt(),Ht(3,"div",9),Ht(4,"select",10),qi("ngModelChange",function(o){return el(t),Zi().currentClassifierId=o})("ngModelChange",function(){return el(t),Zi().onClassifierSelect()}),Ht(5,"option",24),Wr(6,"No classifier"),qt(),jo(7,yU,2,2,"option",11),qt(),qt(),qt()}if(2&n){const t=Zi();Fn(4),or("ngModel",t.currentClassifierId),Fn(1),or("ngValue",null),Fn(2),or("ngForOf",t.classifiers)}}function xU(n,e){if(1&n&&(Ht(0,"option",24),Wr(1),qt()),2&n){const t=e.$implicit;or("ngValue",t),Fn(1),ll(" ",100*t,"% ")}}function bU(n,e){if(1&n){const t=xp();Ht(0,"div",7),Ht(1,"span",8),Wr(2,"Opacity"),qt(),Ht(3,"div",9),Ht(4,"select",10),qi("ngModelChange",function(o){return el(t),Zi().currentOpacity=o}),jo(5,xU,2,2,"option",11),qt(),qt(),qt()}if(2&n){const t=Zi();Fn(4),or("ngModel",t.currentOpacity),Fn(1),or("ngForOf",t.opacities)}}function wU(n,e){if(1&n&&(Ht(0,"option",24),Wr(1),qt()),2&n){const t=e.$implicit;or("ngValue",t.name),Fn(1),ll(" ",t.name," ")}}function CU(n,e){if(1&n){const t=xp();Ht(0,"div",7),Ht(1,"span",8),Wr(2,"Gradient"),qt(),Ht(3,"div",9),Ht(4,"select",10),qi("ngModelChange",function(o){return el(t),Zi().currentGradientName=o}),jo(5,wU,2,2,"option",11),qt(),qt(),qt()}if(2&n){const t=Zi();Fn(4),al(t.getGradientCss(t.currentGradient.colors)),or("ngModel",t.currentGradientName),Fn(1),or("ngForOf",t.gradients)}}function EU(n,e){if(1&n&&(Ht(0,"option",24),Wr(1),qt()),2&n){const t=e.$implicit;or("ngValue",t),Fn(1),ll(" ",t.name," ")}}function DU(n,e){if(1&n&&(P_(0),Wr(1),gx(2,"number"),R_()),2&n){const t=Zi().index,r=Zi(2);Fn(1),ll(" ",_x(2,1,r.minValue+t/r.currentGradient.colors.length*(r.maxValue-r.minValue),"1.0-2")," - ")}}function SU(n,e){if(1&n&&(Ht(0,"li"),kA(1,"span"),jo(2,DU,3,4,"ng-container",33),Wr(3),gx(4,"number"),qt()),2&n){const t=e.$implicit,r=e.index,o=Zi(2);Fn(1),O_("background",t),Fn(1),or("ngIf",0==r),Fn(1),ll(" ",_x(4,4,o.minValue+(r+1)/o.currentGradient.colors.length*(o.maxValue-o.minValue),"1.0-2")," ")}}function MU(n,e){if(1&n&&(Ht(0,"div",25),Ht(1,"div",26),Ht(2,"div",27),Ht(3,"div",28),Wr(4),qt(),Ht(5,"div",29),Ht(6,"ul",30),jo(7,SU,5,7,"li",31),qt(),qt(),qt(),qt(),Ht(8,"div",26),kA(9,"google-chart",32),qt(),qt()),2&n){const t=Zi();Fn(4),ll(" Number of hexes: ",t.currentHexes.length," "),Fn(3),or("ngForOf",t.currentGradient.colors),Fn(2),or("type",t.chartType)("data",t.currentHexesValues)("options",t.chartOptions)}}function TU(n,e){if(1&n&&(P_(0),Wr(1),R_()),2&n){const t=Zi(2);Fn(1),ll("(",t.progress,"%)")}}function IU(n,e){if(1&n&&(Ht(0,"div",34),Ht(1,"span",35),Wr(2,"Loading data "),jo(3,TU,2,1,"ng-container",33),qt(),qt()),2&n){const t=Zi();bg("is-loading",t.loading),Fn(3),or("ngIf",t.initialized)}}const kU=function(n){return{"is-active":n}};function PU(n,e){if(1&n){const t=xp();Ht(0,"div",36),Ht(1,"div",37),qi("click",function(){return el(t),Zi().toggleModal()}),qt(),Ht(2,"div",38),Ht(3,"h2",39),Wr(4),qt(),Ht(5,"h4",40),Wr(6," Kamil Raczycki | Piotr Szyma\u0144ski "),qt(),Ht(7,"div",41),Wr(8," Bicycle-sharing systems (BSS) have become a daily reality for many citizens of larger, wealthier cities in developed regions. However, planning the layout of bicycle-sharing stations usually requires expensive data gathering, surveying travel behavior and trip modelling followed by station layout optimization. Many smaller cities and towns, especially in developing areas, may have difficulty financing such projects. Planning a BSS also takes a considerable amount of time. Yet as the pandemic has shown us, municipalities will face the need to adapt rapidly to mobility shifts, which include citizens leaving public transport for bicycles. Laying out a bike sharing system quickly will become critical in addressing the increase in bike demand. This paper addresses the problem of cost and time in BSS layout design and proposes a new solution to streamline and facilitate the process of such planning by using spatial embedding methods. Based only on publicly available data from OpenStreetMap, and station layouts from 34 cities in Europe, a method has been developed to divide cities into micro-regions using the Uber H3 discrete global grid system and to indicate regions where it is worth placing a station based on existing systems in different cities using transfer learning. The result of the work is a mechanism to support planners in their decision making when planning a station layout with a choice of reference cities. "),qt(),Ht(9,"div",42),Ht(10,"a",43),Wr(11,"Github"),qt(),Wr(12," | "),Ht(13,"a",44),Wr(14,"Arxiv"),qt(),qt(),Ht(15,"div",42),Wr(16," Advances in Intelligent and Resilient Cities - 2021 "),qt(),qt(),qt()}if(2&n){const t=Zi();or("ngClass",tD(2,kU,t.isModalActive)),Fn(4),H1(t.title)}}let FU=(()=>{class n{constructor(t,r,o,c,p){this.titleService=t,this.googleSheetsDownloaderService=r,this.googleDriveDownloaderService=o,this.h3Service=c,this.sanitizer=p,this.title="Transfer learning approach to bicycle-sharing systems\u2019 station location planning using OpenStreetMap data",this.isModalActive=!1,this.loading=!1,this.progress=0,this.initialized=!1,this.renderHexes=!1,this.currentCityId=1,this.currentClassifierId=null,this.currentOpacity=.5,this.currentGradientName="Sunset",this.opacities=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1],this.mapStyles=[{name:"Basic",styleUrl:"basic-v9"},{name:"Streets",styleUrl:"streets-v11"},{name:"Light",styleUrl:"light-v10"},{name:"Dark",styleUrl:"dark-v10"},{name:"Satellite",styleUrl:"satellite-v9"},{name:"Satellite streets",styleUrl:"satellite-streets-v11"}],this.gradients=[{name:"PinkYl",colors:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"]},{name:"Sunset",colors:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"]},{name:"SunsetDark",colors:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"]},{name:"Mint",colors:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"]},{name:"DarkMint",colors:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"]},{name:"TealGrn",colors:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"]},{name:"PurpOr",colors:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"]},{name:"Magenta",colors:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"]},{name:"Peach",colors:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"]},{name:"BluYl",colors:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"]},{name:"Emrld",colors:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"]},{name:"Temps",colors:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"]},{name:"Geyser",colors:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"]},{name:"Earth",colors:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"]},{name:"TealRose",colors:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"]},{name:"ArmyRose",colors:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"]}],this.cities=[],this.cityGroups=[],this.classifiers=[],this.currentHexes=[],this.currentHexesValues=[],this.minValue=0,this.maxValue=1,this.currentGeojsonData=null,this.popup=new Zp.Popup({closeButton:!1,closeOnClick:!1}),this.currentPopupId=null,this.chartType=Pr.Histogram,this.chartOptions={width:500,vAxis:{logScale:!0,textPosition:"in"},enableInteractivity:!1,legend:{position:"none"},hAxis:{slantedText:!1,minValue:0,maxValue:1},chartArea:{top:0,width:"95%",height:"80%"},histogram:{minValue:0,maxValue:1},bar:{gap:0},fontName:"Fira Sans"},this.titleService.setTitle(this.title)}toggleModal(){this.isModalActive=!this.isModalActive}ngOnInit(){this.loading=!0,this.currentMapStyle=this.mapStyles[0],this.generateGeojsonData(),this.googleDriveDownloaderService.progressSubject.subscribe(t=>this.progress=t)}ngAfterViewInit(){TT([this.googleSheetsDownloaderService.getCities(),this.googleSheetsDownloaderService.getClassifiers(),this.googleDriveDownloaderService.setupFiles()]).subscribe(([c,p,w])=>{this.loading=!1,this.cities=c.filter(T=>w.some(L=>L.areaId===T.id)).sort((T,L)=>T.name>L.name?1:-1),this.cities.forEach(T=>{var L;return T.sizeBytes=null===(L=w.find(U=>U.areaId===T.id))||void 0===L?void 0:L.size}),this.cityGroups=[...new Set(this.cities.map(T=>T.group))].sort(),this.classifiers=p.sort((T,L)=>T.name>L.name?1:-1),this.currentCityId=this.cities[Math.floor(Math.random()*this.cities.length)].id,this.initialized=!0,this.onCitySelect()})}get currentGradient(){return this.gradients.find(t=>t.name===this.currentGradientName)}get currentCity(){var t=this.cities.find(r=>r.id==this.currentCityId);if(void 0===t)throw new Error("City get error: "+this.currentCityId);return t}getCitiesForGroup(t){return this.cities.filter(r=>r.group===t)}getMapStyle(){return`mapbox://styles/mapbox/${this.currentMapStyle.styleUrl}`}generateGeojsonData(){var t={type:"FeatureCollection",features:this.currentHexes.map(r=>({type:"Feature",geometry:this.h3Service.getGeojsonForHex(r.hex),properties:{value:r.value}}))};this.currentGeojsonData=t}onCitySelect(){var t,r;this.map.mapInstance.getLayer("hex")&&this.map.mapInstance.setLayoutProperty("hex","visibility","none"),this.loading=!0,this.progress=0,this.map.mapInstance.jumpTo({bearing:0,pitch:0,zoom:13,center:[null===(t=this.currentCity)||void 0===t?void 0:t.lon,null===(r=this.currentCity)||void 0===r?void 0:r.lat]}),this.loading=!1,this.onClassifierSelect()}formatBytes(t,r=2){if(!t||0===t)return"0 Bytes";const c=r<0?0:r,w=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,w)).toFixed(c))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][w]}interpolateGradient(){var t=this.gradients.find(p=>p.name===this.currentGradientName),r=[],o=t.colors.length,c=this.maxValue-this.minValue;return t.colors.forEach((p,w)=>{r.push(this.minValue+w/(o-1)*c),r.push(p)}),r}getGradientCss(t){var r="",o=t.length;return t.forEach((c,p)=>{r+=`${c} ${100*p/(o-1)}%`,p<o-1&&(r+=", ")}),this.sanitizer.bypassSecurityTrustStyle(`background-image: linear-gradient(90deg, ${r});`)}getPaint(){return{"fill-color":["interpolate",["linear"],["get","value"],...this.interpolateGradient()],"fill-opacity":this.currentOpacity,"fill-antialias":!1}}showPopup(t){var r;if((null===(r=t.features)||void 0===r?void 0:r.length)>0){var o=t.features[0].properties.value;this.currentPopupId!==t.features[0].id&&(this.popup.remove(),this.popup.setLngLat(t.lngLat).setText(o).addTo(this.map.mapInstance))}}hidePopup(t){this.popup.remove()}onClassifierSelect(){this.loading=!0,this.progress=0,this.renderHexes=!1,this.map.mapInstance.getLayer("hex")&&this.map.mapInstance.setLayoutProperty("hex","visibility","none"),this.currentClassifierId?this.googleDriveDownloaderService.getHexData(this.currentCity,this.currentClassifierId).subscribe(t=>{this.currentHexes=t;var r=this.currentHexes.map(o=>o.value).sort();this.currentHexesValues=r.map(o=>[o]),this.minValue=r[0],this.maxValue=r[r.length-2],this.generateGeojsonData(),this.loading=!1,this.map.mapInstance.setLayoutProperty("hex","visibility","visible")},t=>{console.log(t.message),console.log(t),this.currentHexes=[],this.generateGeojsonData(),this.loading=!1},()=>{this.loading=!1}):(this.currentHexes=[],this.generateGeojsonData(),this.loading=!1)}}return n.\u0275fac=function(t){return new(t||n)(at(tM),at(iw),at(jT),at(eI),at(Iy))},n.\u0275cmp=Bo({type:n,selectors:[["app-root"]],viewQuery:function(t,r){if(1&t&&Ex(MT,5),2&t){let o;Pp(o=Rp())&&(r.map=o.first)}},decls:29,vars:14,consts:[["role","navigation","aria-label","main navigation",1,"navbar"],[1,"navbar-brand"],[1,"navbar-item","is-size-3","has-text-weight-medium"],["id","navbarBasicExample",1,"navbar-menu"],[1,"navbar-start"],["class","navbar-item",4,"ngIf"],[1,"navbar-end"],[1,"navbar-item"],[1,"pr-2"],[1,"select","is-rounded"],[3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"button","is-rounded",3,"click"],["src","assets/pwr_logo.svg",2,"max-height","3rem"],[1,"map-container"],["id","scale-box","class","is-hidden-mobile",4,"ngIf"],["id","loading-overlay",3,"is-loading",4,"ngIf"],["movingMethod","jumpTo",3,"interactive"],["id","hex",3,"data"],["id","hex","type","fill","source","hex",3,"paint","layerMouseMove","layerMouseOut"],["class","modal",3,"ngClass",4,"ngIf"],["hidden","","selected","",3,"ngValue"],[3,"label",4,"ngFor","ngForOf"],[3,"label"],[3,"ngValue"],["id","scale-box",1,"is-hidden-mobile"],[1,"box"],[1,"my-legend"],[1,"legend-title"],[1,"legend-scale"],[1,"legend-labels"],[4,"ngFor","ngForOf"],[3,"type","data","options"],[4,"ngIf"],["id","loading-overlay"],[1,"is-size-3",2,"margin","0 auto"],[1,"modal",3,"ngClass"],[1,"modal-background",3,"click"],[1,"modal-content"],[1,"is-size-3","has-text-centered"],[1,"is-size-4","has-text-centered"],[1,"is-size-6","has-text-justified","mt-4","mb-4"],[1,"is-size-6","has-text-centered"],["href","https://github.com/pwr-inf/Transfer-learning-approach-to-bicycle-sharing-systems-station-location-planning-using-OpenStreetMap/tree/main","target","_blank"],["target","_blank"]],template:function(t,r){1&t&&(Ht(0,"nav",0),Ht(1,"div",1),Ht(2,"h3",2),Wr(3,"OSM \u2794 BSS"),qt(),qt(),Ht(4,"div",3),Ht(5,"div",4),jo(6,_U,8,6,"div",5),jo(7,vU,8,3,"div",5),jo(8,bU,6,2,"div",5),jo(9,CU,6,4,"div",5),qt(),Ht(10,"div",6),Ht(11,"div",7),Ht(12,"span",8),Wr(13,"Map style"),qt(),Ht(14,"div",9),Ht(15,"select",10),qi("ngModelChange",function(c){return r.currentMapStyle=c}),jo(16,EU,2,2,"option",11),qt(),qt(),qt(),Ht(17,"div",7),Ht(18,"button",12),qi("click",function(){return r.toggleModal()}),Wr(19,"About"),qt(),qt(),Ht(20,"div",7),kA(21,"img",13),qt(),qt(),qt(),qt(),Ht(22,"div",14),jo(23,MU,10,5,"div",15),jo(24,IU,4,3,"div",16),Ht(25,"mgl-map",17),kA(26,"mgl-geojson-source",18),Ht(27,"mgl-layer",19),qi("layerMouseMove",function(c){return r.showPopup(c)})("layerMouseOut",function(c){return r.hidePopup(c)}),qt(),qt(),qt(),jo(28,PU,17,4,"div",20)),2&t&&(Fn(6),or("ngIf",r.initialized),Fn(1),or("ngIf",r.initialized),Fn(1),or("ngIf",r.initialized),Fn(1),or("ngIf",r.initialized),Fn(6),or("ngModel",r.currentMapStyle),Fn(1),or("ngForOf",r.mapStyles),Fn(7),or("ngIf",r.currentHexesValues.length>0),Fn(1),or("ngIf",r.loading),Fn(1),al(r.getMapStyle()),or("interactive",!0),Fn(1),or("data",r.currentGeojsonData),Fn(1),or("paint",r.getPaint()),Fn(1),or("ngIf",r.initialized))},directives:[FS,Av,DI,Cw,PS,MT,j8,G8,GI,HI,P8,kS],pipes:[NS],styles:["[_nghost-%COMP%]{height:100vh;display:flex;flex:1;flex-direction:column}[_nghost-%COMP%]   .navbar[_ngcontent-%COMP%]{height:64px}.modal-background[_ngcontent-%COMP%]{background-color:#ffffff80}#loading-overlay[_ngcontent-%COMP%]{background-color:#ffffffe6}@supports ((-webkit-backdrop-filter: none) or (backdrop-filter: none)){.modal-background[_ngcontent-%COMP%], #loading-overlay[_ngcontent-%COMP%]{background-color:transparent;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background-color:#ffffff40}}.modal-content[_ngcontent-%COMP%]{background-color:#ffffff80;padding:3em;border-radius:2rem;width:80vw}.map-container[_ngcontent-%COMP%]{height:calc(100vh - 64px);flex:1;position:relative}.map-container[_ngcontent-%COMP%]   #loading-overlay[_ngcontent-%COMP%], .map-container[_ngcontent-%COMP%]   mgl-map[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0}.map-container[_ngcontent-%COMP%]   #loading-overlay[_ngcontent-%COMP%]{z-index:20;align-items:center;display:flex;pointer-events:none;opacity:0;transition:opacity .6s linear}.map-container[_ngcontent-%COMP%]   .is-loading[_ngcontent-%COMP%]{opacity:1!important}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]{z-index:10;position:absolute;top:1em;right:1em}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]{height:60px;width:500px}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]   .legend-title[_ngcontent-%COMP%]{text-align:left;margin-bottom:8px;font-size:90%}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]   .legend-scale[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0 0 0 5px;padding:0;float:left;list-style:none}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]   .legend-scale[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:block;float:left;width:70px;text-align:center;font-size:80%;list-style:none}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]   ul.legend-labels[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;float:left;height:15px;width:70px}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]   .legend-source[_ngcontent-%COMP%]{font-size:70%;color:#999;clear:both}.map-container[_ngcontent-%COMP%]   #scale-box[_ngcontent-%COMP%]   .my-legend[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#777}"]}),n})(),OU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ui({type:n,bootstrap:[FU]}),n.\u0275inj=mr({providers:[{provide:rw,useValue:"AIzaSyDVc71t2FNSlJ5sko_IZBGZVre45bYA94U"},iw,jT,eI],imports:[[gz,s8,o6,H8.withConfig({accessToken:"pk.eyJ1IjoicmFjemVxIiwiYSI6ImNrb2Fmd3E3cjJwYmIyd2xwa2IwZGhxaXkifQ.VrDUIhReRiZxENDHOzCgqw"}),fU,pU,R8]]}),n})();(function(){if(BD)throw new Error("Cannot enable prod mode after platform setup.");LD=!1})(),pz().bootstrapModule(OU).catch(n=>console.error(n))}},xd=>{xd(xd.s=177)}]);